function Gre(e,t){for(var i=0;i<t.length;i++){const r=t[i];if(typeof r!="string"&&!Array.isArray(r)){for(const n in r)if(n!=="default"&&!(n in e)){const s=Object.getOwnPropertyDescriptor(r,n);s&&Object.defineProperty(e,n,s.get?s:{enumerable:!0,get:()=>r[n]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function i(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=i(n);fetch(n.href,s)}})();var yd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function v0(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var rX={exports:{}},sT={},nX={exports:{}},Ti={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Tw=Symbol.for("react.element"),jre=Symbol.for("react.portal"),Wre=Symbol.for("react.fragment"),Xre=Symbol.for("react.strict_mode"),qre=Symbol.for("react.profiler"),Yre=Symbol.for("react.provider"),Qre=Symbol.for("react.context"),Kre=Symbol.for("react.forward_ref"),Zre=Symbol.for("react.suspense"),$re=Symbol.for("react.memo"),Jre=Symbol.for("react.lazy"),D4=Symbol.iterator;function ene(e){return e===null||typeof e!="object"?null:(e=D4&&e[D4]||e["@@iterator"],typeof e=="function"?e:null)}var sX={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},aX=Object.assign,oX={};function y0(e,t,i){this.props=e,this.context=t,this.refs=oX,this.updater=i||sX}y0.prototype.isReactComponent={};y0.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};y0.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function lX(){}lX.prototype=y0.prototype;function fN(e,t,i){this.props=e,this.context=t,this.refs=oX,this.updater=i||sX}var mN=fN.prototype=new lX;mN.constructor=fN;aX(mN,y0.prototype);mN.isPureReactComponent=!0;var R4=Array.isArray,cX=Object.prototype.hasOwnProperty,gN={current:null},uX={key:!0,ref:!0,__self:!0,__source:!0};function hX(e,t,i){var r,n={},s=null,a=null;if(t!=null)for(r in t.ref!==void 0&&(a=t.ref),t.key!==void 0&&(s=""+t.key),t)cX.call(t,r)&&!uX.hasOwnProperty(r)&&(n[r]=t[r]);var o=arguments.length-2;if(o===1)n.children=i;else if(1<o){for(var l=Array(o),c=0;c<o;c++)l[c]=arguments[c+2];n.children=l}if(e&&e.defaultProps)for(r in o=e.defaultProps,o)n[r]===void 0&&(n[r]=o[r]);return{$$typeof:Tw,type:e,key:s,ref:a,props:n,_owner:gN.current}}function tne(e,t){return{$$typeof:Tw,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function vN(e){return typeof e=="object"&&e!==null&&e.$$typeof===Tw}function ine(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(i){return t[i]})}var I4=/\/+/g;function QP(e,t){return typeof e=="object"&&e!==null&&e.key!=null?ine(""+e.key):t.toString(36)}function JM(e,t,i,r,n){var s=typeof e;(s==="undefined"||s==="boolean")&&(e=null);var a=!1;if(e===null)a=!0;else switch(s){case"string":case"number":a=!0;break;case"object":switch(e.$$typeof){case Tw:case jre:a=!0}}if(a)return a=e,n=n(a),e=r===""?"."+QP(a,0):r,R4(n)?(i="",e!=null&&(i=e.replace(I4,"$&/")+"/"),JM(n,t,i,"",function(c){return c})):n!=null&&(vN(n)&&(n=tne(n,i+(!n.key||a&&a.key===n.key?"":(""+n.key).replace(I4,"$&/")+"/")+e)),t.push(n)),1;if(a=0,r=r===""?".":r+":",R4(e))for(var o=0;o<e.length;o++){s=e[o];var l=r+QP(s,o);a+=JM(s,t,i,l,n)}else if(l=ene(e),typeof l=="function")for(e=l.call(e),o=0;!(s=e.next()).done;)s=s.value,l=r+QP(s,o++),a+=JM(s,t,i,l,n);else if(s==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return a}function a_(e,t,i){if(e==null)return e;var r=[],n=0;return JM(e,r,"","",function(s){return t.call(i,s,n++)}),r}function rne(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(i){(e._status===0||e._status===-1)&&(e._status=1,e._result=i)},function(i){(e._status===0||e._status===-1)&&(e._status=2,e._result=i)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var ba={current:null},eE={transition:null},nne={ReactCurrentDispatcher:ba,ReactCurrentBatchConfig:eE,ReactCurrentOwner:gN};function dX(){throw Error("act(...) is not supported in production builds of React.")}Ti.Children={map:a_,forEach:function(e,t,i){a_(e,function(){t.apply(this,arguments)},i)},count:function(e){var t=0;return a_(e,function(){t++}),t},toArray:function(e){return a_(e,function(t){return t})||[]},only:function(e){if(!vN(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};Ti.Component=y0;Ti.Fragment=Wre;Ti.Profiler=qre;Ti.PureComponent=fN;Ti.StrictMode=Xre;Ti.Suspense=Zre;Ti.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=nne;Ti.act=dX;Ti.cloneElement=function(e,t,i){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=aX({},e.props),n=e.key,s=e.ref,a=e._owner;if(t!=null){if(t.ref!==void 0&&(s=t.ref,a=gN.current),t.key!==void 0&&(n=""+t.key),e.type&&e.type.defaultProps)var o=e.type.defaultProps;for(l in t)cX.call(t,l)&&!uX.hasOwnProperty(l)&&(r[l]=t[l]===void 0&&o!==void 0?o[l]:t[l])}var l=arguments.length-2;if(l===1)r.children=i;else if(1<l){o=Array(l);for(var c=0;c<l;c++)o[c]=arguments[c+2];r.children=o}return{$$typeof:Tw,type:e.type,key:n,ref:s,props:r,_owner:a}};Ti.createContext=function(e){return e={$$typeof:Qre,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:Yre,_context:e},e.Consumer=e};Ti.createElement=hX;Ti.createFactory=function(e){var t=hX.bind(null,e);return t.type=e,t};Ti.createRef=function(){return{current:null}};Ti.forwardRef=function(e){return{$$typeof:Kre,render:e}};Ti.isValidElement=vN;Ti.lazy=function(e){return{$$typeof:Jre,_payload:{_status:-1,_result:e},_init:rne}};Ti.memo=function(e,t){return{$$typeof:$re,type:e,compare:t===void 0?null:t}};Ti.startTransition=function(e){var t=eE.transition;eE.transition={};try{e()}finally{eE.transition=t}};Ti.unstable_act=dX;Ti.useCallback=function(e,t){return ba.current.useCallback(e,t)};Ti.useContext=function(e){return ba.current.useContext(e)};Ti.useDebugValue=function(){};Ti.useDeferredValue=function(e){return ba.current.useDeferredValue(e)};Ti.useEffect=function(e,t){return ba.current.useEffect(e,t)};Ti.useId=function(){return ba.current.useId()};Ti.useImperativeHandle=function(e,t,i){return ba.current.useImperativeHandle(e,t,i)};Ti.useInsertionEffect=function(e,t){return ba.current.useInsertionEffect(e,t)};Ti.useLayoutEffect=function(e,t){return ba.current.useLayoutEffect(e,t)};Ti.useMemo=function(e,t){return ba.current.useMemo(e,t)};Ti.useReducer=function(e,t,i){return ba.current.useReducer(e,t,i)};Ti.useRef=function(e){return ba.current.useRef(e)};Ti.useState=function(e){return ba.current.useState(e)};Ti.useSyncExternalStore=function(e,t,i){return ba.current.useSyncExternalStore(e,t,i)};Ti.useTransition=function(){return ba.current.useTransition()};Ti.version="18.3.1";nX.exports=Ti;var qe=nX.exports;const Ci=v0(qe),L4=Gre({__proto__:null,default:Ci},[qe]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sne=qe,ane=Symbol.for("react.element"),one=Symbol.for("react.fragment"),lne=Object.prototype.hasOwnProperty,cne=sne.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,une={key:!0,ref:!0,__self:!0,__source:!0};function pX(e,t,i){var r,n={},s=null,a=null;i!==void 0&&(s=""+i),t.key!==void 0&&(s=""+t.key),t.ref!==void 0&&(a=t.ref);for(r in t)lne.call(t,r)&&!une.hasOwnProperty(r)&&(n[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps,t)n[r]===void 0&&(n[r]=t[r]);return{$$typeof:ane,type:e,key:s,ref:a,props:n,_owner:cne.current}}sT.Fragment=one;sT.jsx=pX;sT.jsxs=pX;rX.exports=sT;var rt=rX.exports,fX={exports:{}},xo={},mX={exports:{}},gX={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(O,j){var V=O.length;O.push(j);e:for(;0<V;){var W=V-1>>>1,J=O[W];if(0<n(J,j))O[W]=j,O[V]=J,V=W;else break e}}function i(O){return O.length===0?null:O[0]}function r(O){if(O.length===0)return null;var j=O[0],V=O.pop();if(V!==j){O[0]=V;e:for(var W=0,J=O.length,ce=J>>>1;W<ce;){var $=2*(W+1)-1,ne=O[$],ie=$+1,de=O[ie];if(0>n(ne,V))ie<J&&0>n(de,ne)?(O[W]=de,O[ie]=V,W=ie):(O[W]=ne,O[$]=V,W=$);else if(ie<J&&0>n(de,V))O[W]=de,O[ie]=V,W=ie;else break e}}return j}function n(O,j){var V=O.sortIndex-j.sortIndex;return V!==0?V:O.id-j.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;e.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();e.unstable_now=function(){return a.now()-o}}var l=[],c=[],u=1,h=null,d=3,p=!1,f=!1,v=!1,g=typeof setTimeout=="function"?setTimeout:null,m=typeof clearTimeout=="function"?clearTimeout:null,x=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function w(O){for(var j=i(c);j!==null;){if(j.callback===null)r(c);else if(j.startTime<=O)r(c),j.sortIndex=j.expirationTime,t(l,j);else break;j=i(c)}}function _(O){if(v=!1,w(O),!f)if(i(l)!==null)f=!0,Q(M);else{var j=i(c);j!==null&&Y(_,j.startTime-O)}}function M(O,j){f=!1,v&&(v=!1,m(T),T=-1),p=!0;var V=d;try{for(w(j),h=i(l);h!==null&&(!(h.expirationTime>j)||O&&!D());){var W=h.callback;if(typeof W=="function"){h.callback=null,d=h.priorityLevel;var J=W(h.expirationTime<=j);j=e.unstable_now(),typeof J=="function"?h.callback=J:h===i(l)&&r(l),w(j)}else r(l);h=i(l)}if(h!==null)var ce=!0;else{var $=i(c);$!==null&&Y(_,$.startTime-j),ce=!1}return ce}finally{h=null,d=V,p=!1}}var S=!1,A=null,T=-1,E=5,C=-1;function D(){return!(e.unstable_now()-C<E)}function I(){if(A!==null){var O=e.unstable_now();C=O;var j=!0;try{j=A(!0,O)}finally{j?L():(S=!1,A=null)}}else S=!1}var L;if(typeof x=="function")L=function(){x(I)};else if(typeof MessageChannel<"u"){var z=new MessageChannel,F=z.port2;z.port1.onmessage=I,L=function(){F.postMessage(null)}}else L=function(){g(I,0)};function Q(O){A=O,S||(S=!0,L())}function Y(O,j){T=g(function(){O(e.unstable_now())},j)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(O){O.callback=null},e.unstable_continueExecution=function(){f||p||(f=!0,Q(M))},e.unstable_forceFrameRate=function(O){0>O||125<O?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):E=0<O?Math.floor(1e3/O):5},e.unstable_getCurrentPriorityLevel=function(){return d},e.unstable_getFirstCallbackNode=function(){return i(l)},e.unstable_next=function(O){switch(d){case 1:case 2:case 3:var j=3;break;default:j=d}var V=d;d=j;try{return O()}finally{d=V}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(O,j){switch(O){case 1:case 2:case 3:case 4:case 5:break;default:O=3}var V=d;d=O;try{return j()}finally{d=V}},e.unstable_scheduleCallback=function(O,j,V){var W=e.unstable_now();switch(typeof V=="object"&&V!==null?(V=V.delay,V=typeof V=="number"&&0<V?W+V:W):V=W,O){case 1:var J=-1;break;case 2:J=250;break;case 5:J=1073741823;break;case 4:J=1e4;break;default:J=5e3}return J=V+J,O={id:u++,callback:j,priorityLevel:O,startTime:V,expirationTime:J,sortIndex:-1},V>W?(O.sortIndex=V,t(c,O),i(l)===null&&O===i(c)&&(v?(m(T),T=-1):v=!0,Y(_,V-W))):(O.sortIndex=J,t(l,O),f||p||(f=!0,Q(M))),O},e.unstable_shouldYield=D,e.unstable_wrapCallback=function(O){var j=d;return function(){var V=d;d=j;try{return O.apply(this,arguments)}finally{d=V}}}})(gX);mX.exports=gX;var hne=mX.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var dne=qe,go=hne;function mt(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,i=1;i<arguments.length;i++)t+="&args[]="+encodeURIComponent(arguments[i]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var vX=new Set,f1={};function Jf(e,t){kv(e,t),kv(e+"Capture",t)}function kv(e,t){for(f1[e]=t,e=0;e<t.length;e++)vX.add(t[e])}var sh=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),BI=Object.prototype.hasOwnProperty,pne=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,O4={},z4={};function fne(e){return BI.call(z4,e)?!0:BI.call(O4,e)?!1:pne.test(e)?z4[e]=!0:(O4[e]=!0,!1)}function mne(e,t,i,r){if(i!==null&&i.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return r?!1:i!==null?!i.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function gne(e,t,i,r){if(t===null||typeof t>"u"||mne(e,t,i,r))return!0;if(r)return!1;if(i!==null)switch(i.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function _a(e,t,i,r,n,s,a){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=r,this.attributeNamespace=n,this.mustUseProperty=i,this.propertyName=e,this.type=t,this.sanitizeURL=s,this.removeEmptyString=a}var As={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){As[e]=new _a(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];As[t]=new _a(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){As[e]=new _a(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){As[e]=new _a(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){As[e]=new _a(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){As[e]=new _a(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){As[e]=new _a(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){As[e]=new _a(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){As[e]=new _a(e,5,!1,e.toLowerCase(),null,!1,!1)});var yN=/[\-:]([a-z])/g;function xN(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(yN,xN);As[t]=new _a(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(yN,xN);As[t]=new _a(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(yN,xN);As[t]=new _a(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){As[e]=new _a(e,1,!1,e.toLowerCase(),null,!1,!1)});As.xlinkHref=new _a("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){As[e]=new _a(e,1,!1,e.toLowerCase(),null,!0,!0)});function wN(e,t,i,r){var n=As.hasOwnProperty(t)?As[t]:null;(n!==null?n.type!==0:r||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(gne(t,i,n,r)&&(i=null),r||n===null?fne(t)&&(i===null?e.removeAttribute(t):e.setAttribute(t,""+i)):n.mustUseProperty?e[n.propertyName]=i===null?n.type===3?!1:"":i:(t=n.attributeName,r=n.attributeNamespace,i===null?e.removeAttribute(t):(n=n.type,i=n===3||n===4&&i===!0?"":""+i,r?e.setAttributeNS(r,t,i):e.setAttribute(t,i))))}var bh=dne.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,o_=Symbol.for("react.element"),Gg=Symbol.for("react.portal"),jg=Symbol.for("react.fragment"),bN=Symbol.for("react.strict_mode"),kI=Symbol.for("react.profiler"),yX=Symbol.for("react.provider"),xX=Symbol.for("react.context"),_N=Symbol.for("react.forward_ref"),UI=Symbol.for("react.suspense"),FI=Symbol.for("react.suspense_list"),SN=Symbol.for("react.memo"),od=Symbol.for("react.lazy"),wX=Symbol.for("react.offscreen"),N4=Symbol.iterator;function hy(e){return e===null||typeof e!="object"?null:(e=N4&&e[N4]||e["@@iterator"],typeof e=="function"?e:null)}var Ur=Object.assign,KP;function fx(e){if(KP===void 0)try{throw Error()}catch(i){var t=i.stack.trim().match(/\n( *(at )?)/);KP=t&&t[1]||""}return`
`+KP+e}var ZP=!1;function $P(e,t){if(!e||ZP)return"";ZP=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var r=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){r=c}e.call(t.prototype)}else{try{throw Error()}catch(c){r=c}e()}}catch(c){if(c&&r&&typeof c.stack=="string"){for(var n=c.stack.split(`
`),s=r.stack.split(`
`),a=n.length-1,o=s.length-1;1<=a&&0<=o&&n[a]!==s[o];)o--;for(;1<=a&&0<=o;a--,o--)if(n[a]!==s[o]){if(a!==1||o!==1)do if(a--,o--,0>o||n[a]!==s[o]){var l=`
`+n[a].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}while(1<=a&&0<=o);break}}}finally{ZP=!1,Error.prepareStackTrace=i}return(e=e?e.displayName||e.name:"")?fx(e):""}function vne(e){switch(e.tag){case 5:return fx(e.type);case 16:return fx("Lazy");case 13:return fx("Suspense");case 19:return fx("SuspenseList");case 0:case 2:case 15:return e=$P(e.type,!1),e;case 11:return e=$P(e.type.render,!1),e;case 1:return e=$P(e.type,!0),e;default:return""}}function VI(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case jg:return"Fragment";case Gg:return"Portal";case kI:return"Profiler";case bN:return"StrictMode";case UI:return"Suspense";case FI:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case xX:return(e.displayName||"Context")+".Consumer";case yX:return(e._context.displayName||"Context")+".Provider";case _N:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case SN:return t=e.displayName||null,t!==null?t:VI(e.type)||"Memo";case od:t=e._payload,e=e._init;try{return VI(e(t))}catch{}}return null}function yne(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return VI(t);case 8:return t===bN?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function jd(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function bX(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function xne(e){var t=bX(e)?"checked":"value",i=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&typeof i<"u"&&typeof i.get=="function"&&typeof i.set=="function"){var n=i.get,s=i.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return n.call(this)},set:function(a){r=""+a,s.call(this,a)}}),Object.defineProperty(e,t,{enumerable:i.enumerable}),{getValue:function(){return r},setValue:function(a){r=""+a},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function l_(e){e._valueTracker||(e._valueTracker=xne(e))}function _X(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var i=t.getValue(),r="";return e&&(r=bX(e)?e.checked?"true":"false":e.value),e=r,e!==i?(t.setValue(e),!0):!1}function jE(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function HI(e,t){var i=t.checked;return Ur({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:i??e._wrapperState.initialChecked})}function B4(e,t){var i=t.defaultValue==null?"":t.defaultValue,r=t.checked!=null?t.checked:t.defaultChecked;i=jd(t.value!=null?t.value:i),e._wrapperState={initialChecked:r,initialValue:i,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function SX(e,t){t=t.checked,t!=null&&wN(e,"checked",t,!1)}function GI(e,t){SX(e,t);var i=jd(t.value),r=t.type;if(i!=null)r==="number"?(i===0&&e.value===""||e.value!=i)&&(e.value=""+i):e.value!==""+i&&(e.value=""+i);else if(r==="submit"||r==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?jI(e,t.type,i):t.hasOwnProperty("defaultValue")&&jI(e,t.type,jd(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function k4(e,t,i){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!(r!=="submit"&&r!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,i||t===e.value||(e.value=t),e.defaultValue=t}i=e.name,i!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,i!==""&&(e.name=i)}function jI(e,t,i){(t!=="number"||jE(e.ownerDocument)!==e)&&(i==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+i&&(e.defaultValue=""+i))}var mx=Array.isArray;function mv(e,t,i,r){if(e=e.options,t){t={};for(var n=0;n<i.length;n++)t["$"+i[n]]=!0;for(i=0;i<e.length;i++)n=t.hasOwnProperty("$"+e[i].value),e[i].selected!==n&&(e[i].selected=n),n&&r&&(e[i].defaultSelected=!0)}else{for(i=""+jd(i),t=null,n=0;n<e.length;n++){if(e[n].value===i){e[n].selected=!0,r&&(e[n].defaultSelected=!0);return}t!==null||e[n].disabled||(t=e[n])}t!==null&&(t.selected=!0)}}function WI(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(mt(91));return Ur({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function U4(e,t){var i=t.value;if(i==null){if(i=t.children,t=t.defaultValue,i!=null){if(t!=null)throw Error(mt(92));if(mx(i)){if(1<i.length)throw Error(mt(93));i=i[0]}t=i}t==null&&(t=""),i=t}e._wrapperState={initialValue:jd(i)}}function MX(e,t){var i=jd(t.value),r=jd(t.defaultValue);i!=null&&(i=""+i,i!==e.value&&(e.value=i),t.defaultValue==null&&e.defaultValue!==i&&(e.defaultValue=i)),r!=null&&(e.defaultValue=""+r)}function F4(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function EX(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function XI(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?EX(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var c_,AX=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,i,r,n){MSApp.execUnsafeLocalFunction(function(){return e(t,i,r,n)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(c_=c_||document.createElement("div"),c_.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=c_.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function m1(e,t){if(t){var i=e.firstChild;if(i&&i===e.lastChild&&i.nodeType===3){i.nodeValue=t;return}}e.textContent=t}var Lx={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},wne=["Webkit","ms","Moz","O"];Object.keys(Lx).forEach(function(e){wne.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Lx[t]=Lx[e]})});function CX(e,t,i){return t==null||typeof t=="boolean"||t===""?"":i||typeof t!="number"||t===0||Lx.hasOwnProperty(e)&&Lx[e]?(""+t).trim():t+"px"}function TX(e,t){e=e.style;for(var i in t)if(t.hasOwnProperty(i)){var r=i.indexOf("--")===0,n=CX(i,t[i],r);i==="float"&&(i="cssFloat"),r?e.setProperty(i,n):e[i]=n}}var bne=Ur({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function qI(e,t){if(t){if(bne[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(mt(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(mt(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(mt(61))}if(t.style!=null&&typeof t.style!="object")throw Error(mt(62))}}function YI(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var QI=null;function MN(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var KI=null,gv=null,vv=null;function V4(e){if(e=Rw(e)){if(typeof KI!="function")throw Error(mt(280));var t=e.stateNode;t&&(t=uT(t),KI(e.stateNode,e.type,t))}}function PX(e){gv?vv?vv.push(e):vv=[e]:gv=e}function DX(){if(gv){var e=gv,t=vv;if(vv=gv=null,V4(e),t)for(e=0;e<t.length;e++)V4(t[e])}}function RX(e,t){return e(t)}function IX(){}var JP=!1;function LX(e,t,i){if(JP)return e(t,i);JP=!0;try{return RX(e,t,i)}finally{JP=!1,(gv!==null||vv!==null)&&(IX(),DX())}}function g1(e,t){var i=e.stateNode;if(i===null)return null;var r=uT(i);if(r===null)return null;i=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(e=e.type,r=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!r;break e;default:e=!1}if(e)return null;if(i&&typeof i!="function")throw Error(mt(231,t,typeof i));return i}var ZI=!1;if(sh)try{var dy={};Object.defineProperty(dy,"passive",{get:function(){ZI=!0}}),window.addEventListener("test",dy,dy),window.removeEventListener("test",dy,dy)}catch{ZI=!1}function _ne(e,t,i,r,n,s,a,o,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(i,c)}catch(u){this.onError(u)}}var Ox=!1,WE=null,XE=!1,$I=null,Sne={onError:function(e){Ox=!0,WE=e}};function Mne(e,t,i,r,n,s,a,o,l){Ox=!1,WE=null,_ne.apply(Sne,arguments)}function Ene(e,t,i,r,n,s,a,o,l){if(Mne.apply(this,arguments),Ox){if(Ox){var c=WE;Ox=!1,WE=null}else throw Error(mt(198));XE||(XE=!0,$I=c)}}function em(e){var t=e,i=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(i=t.return),e=t.return;while(e)}return t.tag===3?i:null}function OX(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function H4(e){if(em(e)!==e)throw Error(mt(188))}function Ane(e){var t=e.alternate;if(!t){if(t=em(e),t===null)throw Error(mt(188));return t!==e?null:e}for(var i=e,r=t;;){var n=i.return;if(n===null)break;var s=n.alternate;if(s===null){if(r=n.return,r!==null){i=r;continue}break}if(n.child===s.child){for(s=n.child;s;){if(s===i)return H4(n),e;if(s===r)return H4(n),t;s=s.sibling}throw Error(mt(188))}if(i.return!==r.return)i=n,r=s;else{for(var a=!1,o=n.child;o;){if(o===i){a=!0,i=n,r=s;break}if(o===r){a=!0,r=n,i=s;break}o=o.sibling}if(!a){for(o=s.child;o;){if(o===i){a=!0,i=s,r=n;break}if(o===r){a=!0,r=s,i=n;break}o=o.sibling}if(!a)throw Error(mt(189))}}if(i.alternate!==r)throw Error(mt(190))}if(i.tag!==3)throw Error(mt(188));return i.stateNode.current===i?e:t}function zX(e){return e=Ane(e),e!==null?NX(e):null}function NX(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=NX(e);if(t!==null)return t;e=e.sibling}return null}var BX=go.unstable_scheduleCallback,G4=go.unstable_cancelCallback,Cne=go.unstable_shouldYield,Tne=go.unstable_requestPaint,an=go.unstable_now,Pne=go.unstable_getCurrentPriorityLevel,EN=go.unstable_ImmediatePriority,kX=go.unstable_UserBlockingPriority,qE=go.unstable_NormalPriority,Dne=go.unstable_LowPriority,UX=go.unstable_IdlePriority,aT=null,Nc=null;function Rne(e){if(Nc&&typeof Nc.onCommitFiberRoot=="function")try{Nc.onCommitFiberRoot(aT,e,void 0,(e.current.flags&128)===128)}catch{}}var zl=Math.clz32?Math.clz32:One,Ine=Math.log,Lne=Math.LN2;function One(e){return e>>>=0,e===0?32:31-(Ine(e)/Lne|0)|0}var u_=64,h_=4194304;function gx(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function YE(e,t){var i=e.pendingLanes;if(i===0)return 0;var r=0,n=e.suspendedLanes,s=e.pingedLanes,a=i&268435455;if(a!==0){var o=a&~n;o!==0?r=gx(o):(s&=a,s!==0&&(r=gx(s)))}else a=i&~n,a!==0?r=gx(a):s!==0&&(r=gx(s));if(r===0)return 0;if(t!==0&&t!==r&&!(t&n)&&(n=r&-r,s=t&-t,n>=s||n===16&&(s&4194240)!==0))return t;if(r&4&&(r|=i&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=r;0<t;)i=31-zl(t),n=1<<i,r|=e[i],t&=~n;return r}function zne(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Nne(e,t){for(var i=e.suspendedLanes,r=e.pingedLanes,n=e.expirationTimes,s=e.pendingLanes;0<s;){var a=31-zl(s),o=1<<a,l=n[a];l===-1?(!(o&i)||o&r)&&(n[a]=zne(o,t)):l<=t&&(e.expiredLanes|=o),s&=~o}}function JI(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function FX(){var e=u_;return u_<<=1,!(u_&4194240)&&(u_=64),e}function eD(e){for(var t=[],i=0;31>i;i++)t.push(e);return t}function Pw(e,t,i){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-zl(t),e[t]=i}function Bne(e,t){var i=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<i;){var n=31-zl(i),s=1<<n;t[n]=0,r[n]=-1,e[n]=-1,i&=~s}}function AN(e,t){var i=e.entangledLanes|=t;for(e=e.entanglements;i;){var r=31-zl(i),n=1<<r;n&t|e[r]&t&&(e[r]|=t),i&=~n}}var or=0;function VX(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var HX,CN,GX,jX,WX,eL=!1,d_=[],Rd=null,Id=null,Ld=null,v1=new Map,y1=new Map,hd=[],kne="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function j4(e,t){switch(e){case"focusin":case"focusout":Rd=null;break;case"dragenter":case"dragleave":Id=null;break;case"mouseover":case"mouseout":Ld=null;break;case"pointerover":case"pointerout":v1.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":y1.delete(t.pointerId)}}function py(e,t,i,r,n,s){return e===null||e.nativeEvent!==s?(e={blockedOn:t,domEventName:i,eventSystemFlags:r,nativeEvent:s,targetContainers:[n]},t!==null&&(t=Rw(t),t!==null&&CN(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,n!==null&&t.indexOf(n)===-1&&t.push(n),e)}function Une(e,t,i,r,n){switch(t){case"focusin":return Rd=py(Rd,e,t,i,r,n),!0;case"dragenter":return Id=py(Id,e,t,i,r,n),!0;case"mouseover":return Ld=py(Ld,e,t,i,r,n),!0;case"pointerover":var s=n.pointerId;return v1.set(s,py(v1.get(s)||null,e,t,i,r,n)),!0;case"gotpointercapture":return s=n.pointerId,y1.set(s,py(y1.get(s)||null,e,t,i,r,n)),!0}return!1}function XX(e){var t=tf(e.target);if(t!==null){var i=em(t);if(i!==null){if(t=i.tag,t===13){if(t=OX(i),t!==null){e.blockedOn=t,WX(e.priority,function(){GX(i)});return}}else if(t===3&&i.stateNode.current.memoizedState.isDehydrated){e.blockedOn=i.tag===3?i.stateNode.containerInfo:null;return}}}e.blockedOn=null}function tE(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var i=tL(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(i===null){i=e.nativeEvent;var r=new i.constructor(i.type,i);QI=r,i.target.dispatchEvent(r),QI=null}else return t=Rw(i),t!==null&&CN(t),e.blockedOn=i,!1;t.shift()}return!0}function W4(e,t,i){tE(e)&&i.delete(t)}function Fne(){eL=!1,Rd!==null&&tE(Rd)&&(Rd=null),Id!==null&&tE(Id)&&(Id=null),Ld!==null&&tE(Ld)&&(Ld=null),v1.forEach(W4),y1.forEach(W4)}function fy(e,t){e.blockedOn===t&&(e.blockedOn=null,eL||(eL=!0,go.unstable_scheduleCallback(go.unstable_NormalPriority,Fne)))}function x1(e){function t(n){return fy(n,e)}if(0<d_.length){fy(d_[0],e);for(var i=1;i<d_.length;i++){var r=d_[i];r.blockedOn===e&&(r.blockedOn=null)}}for(Rd!==null&&fy(Rd,e),Id!==null&&fy(Id,e),Ld!==null&&fy(Ld,e),v1.forEach(t),y1.forEach(t),i=0;i<hd.length;i++)r=hd[i],r.blockedOn===e&&(r.blockedOn=null);for(;0<hd.length&&(i=hd[0],i.blockedOn===null);)XX(i),i.blockedOn===null&&hd.shift()}var yv=bh.ReactCurrentBatchConfig,QE=!0;function Vne(e,t,i,r){var n=or,s=yv.transition;yv.transition=null;try{or=1,TN(e,t,i,r)}finally{or=n,yv.transition=s}}function Hne(e,t,i,r){var n=or,s=yv.transition;yv.transition=null;try{or=4,TN(e,t,i,r)}finally{or=n,yv.transition=s}}function TN(e,t,i,r){if(QE){var n=tL(e,t,i,r);if(n===null)uD(e,t,r,KE,i),j4(e,r);else if(Une(n,e,t,i,r))r.stopPropagation();else if(j4(e,r),t&4&&-1<kne.indexOf(e)){for(;n!==null;){var s=Rw(n);if(s!==null&&HX(s),s=tL(e,t,i,r),s===null&&uD(e,t,r,KE,i),s===n)break;n=s}n!==null&&r.stopPropagation()}else uD(e,t,r,null,i)}}var KE=null;function tL(e,t,i,r){if(KE=null,e=MN(r),e=tf(e),e!==null)if(t=em(e),t===null)e=null;else if(i=t.tag,i===13){if(e=OX(t),e!==null)return e;e=null}else if(i===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return KE=e,null}function qX(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Pne()){case EN:return 1;case kX:return 4;case qE:case Dne:return 16;case UX:return 536870912;default:return 16}default:return 16}}var xd=null,PN=null,iE=null;function YX(){if(iE)return iE;var e,t=PN,i=t.length,r,n="value"in xd?xd.value:xd.textContent,s=n.length;for(e=0;e<i&&t[e]===n[e];e++);var a=i-e;for(r=1;r<=a&&t[i-r]===n[s-r];r++);return iE=n.slice(e,1<r?1-r:void 0)}function rE(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function p_(){return!0}function X4(){return!1}function wo(e){function t(i,r,n,s,a){this._reactName=i,this._targetInst=n,this.type=r,this.nativeEvent=s,this.target=a,this.currentTarget=null;for(var o in e)e.hasOwnProperty(o)&&(i=e[o],this[o]=i?i(s):s[o]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?p_:X4,this.isPropagationStopped=X4,this}return Ur(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var i=this.nativeEvent;i&&(i.preventDefault?i.preventDefault():typeof i.returnValue!="unknown"&&(i.returnValue=!1),this.isDefaultPrevented=p_)},stopPropagation:function(){var i=this.nativeEvent;i&&(i.stopPropagation?i.stopPropagation():typeof i.cancelBubble!="unknown"&&(i.cancelBubble=!0),this.isPropagationStopped=p_)},persist:function(){},isPersistent:p_}),t}var x0={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},DN=wo(x0),Dw=Ur({},x0,{view:0,detail:0}),Gne=wo(Dw),tD,iD,my,oT=Ur({},Dw,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:RN,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==my&&(my&&e.type==="mousemove"?(tD=e.screenX-my.screenX,iD=e.screenY-my.screenY):iD=tD=0,my=e),tD)},movementY:function(e){return"movementY"in e?e.movementY:iD}}),q4=wo(oT),jne=Ur({},oT,{dataTransfer:0}),Wne=wo(jne),Xne=Ur({},Dw,{relatedTarget:0}),rD=wo(Xne),qne=Ur({},x0,{animationName:0,elapsedTime:0,pseudoElement:0}),Yne=wo(qne),Qne=Ur({},x0,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Kne=wo(Qne),Zne=Ur({},x0,{data:0}),Y4=wo(Zne),$ne={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Jne={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ese={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function tse(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=ese[e])?!!t[e]:!1}function RN(){return tse}var ise=Ur({},Dw,{key:function(e){if(e.key){var t=$ne[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=rE(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Jne[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:RN,charCode:function(e){return e.type==="keypress"?rE(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?rE(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),rse=wo(ise),nse=Ur({},oT,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Q4=wo(nse),sse=Ur({},Dw,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:RN}),ase=wo(sse),ose=Ur({},x0,{propertyName:0,elapsedTime:0,pseudoElement:0}),lse=wo(ose),cse=Ur({},oT,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),use=wo(cse),hse=[9,13,27,32],IN=sh&&"CompositionEvent"in window,zx=null;sh&&"documentMode"in document&&(zx=document.documentMode);var dse=sh&&"TextEvent"in window&&!zx,QX=sh&&(!IN||zx&&8<zx&&11>=zx),K4=" ",Z4=!1;function KX(e,t){switch(e){case"keyup":return hse.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ZX(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Wg=!1;function pse(e,t){switch(e){case"compositionend":return ZX(t);case"keypress":return t.which!==32?null:(Z4=!0,K4);case"textInput":return e=t.data,e===K4&&Z4?null:e;default:return null}}function fse(e,t){if(Wg)return e==="compositionend"||!IN&&KX(e,t)?(e=YX(),iE=PN=xd=null,Wg=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return QX&&t.locale!=="ko"?null:t.data;default:return null}}var mse={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function $4(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!mse[e.type]:t==="textarea"}function $X(e,t,i,r){PX(r),t=ZE(t,"onChange"),0<t.length&&(i=new DN("onChange","change",null,i,r),e.push({event:i,listeners:t}))}var Nx=null,w1=null;function gse(e){cq(e,0)}function lT(e){var t=Yg(e);if(_X(t))return e}function vse(e,t){if(e==="change")return t}var JX=!1;if(sh){var nD;if(sh){var sD="oninput"in document;if(!sD){var J4=document.createElement("div");J4.setAttribute("oninput","return;"),sD=typeof J4.oninput=="function"}nD=sD}else nD=!1;JX=nD&&(!document.documentMode||9<document.documentMode)}function e5(){Nx&&(Nx.detachEvent("onpropertychange",eq),w1=Nx=null)}function eq(e){if(e.propertyName==="value"&&lT(w1)){var t=[];$X(t,w1,e,MN(e)),LX(gse,t)}}function yse(e,t,i){e==="focusin"?(e5(),Nx=t,w1=i,Nx.attachEvent("onpropertychange",eq)):e==="focusout"&&e5()}function xse(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return lT(w1)}function wse(e,t){if(e==="click")return lT(t)}function bse(e,t){if(e==="input"||e==="change")return lT(t)}function _se(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Ul=typeof Object.is=="function"?Object.is:_se;function b1(e,t){if(Ul(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var i=Object.keys(e),r=Object.keys(t);if(i.length!==r.length)return!1;for(r=0;r<i.length;r++){var n=i[r];if(!BI.call(t,n)||!Ul(e[n],t[n]))return!1}return!0}function t5(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function i5(e,t){var i=t5(e);e=0;for(var r;i;){if(i.nodeType===3){if(r=e+i.textContent.length,e<=t&&r>=t)return{node:i,offset:t-e};e=r}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=t5(i)}}function tq(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?tq(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function iq(){for(var e=window,t=jE();t instanceof e.HTMLIFrameElement;){try{var i=typeof t.contentWindow.location.href=="string"}catch{i=!1}if(i)e=t.contentWindow;else break;t=jE(e.document)}return t}function LN(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function Sse(e){var t=iq(),i=e.focusedElem,r=e.selectionRange;if(t!==i&&i&&i.ownerDocument&&tq(i.ownerDocument.documentElement,i)){if(r!==null&&LN(i)){if(t=r.start,e=r.end,e===void 0&&(e=t),"selectionStart"in i)i.selectionStart=t,i.selectionEnd=Math.min(e,i.value.length);else if(e=(t=i.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var n=i.textContent.length,s=Math.min(r.start,n);r=r.end===void 0?s:Math.min(r.end,n),!e.extend&&s>r&&(n=r,r=s,s=n),n=i5(i,s);var a=i5(i,r);n&&a&&(e.rangeCount!==1||e.anchorNode!==n.node||e.anchorOffset!==n.offset||e.focusNode!==a.node||e.focusOffset!==a.offset)&&(t=t.createRange(),t.setStart(n.node,n.offset),e.removeAllRanges(),s>r?(e.addRange(t),e.extend(a.node,a.offset)):(t.setEnd(a.node,a.offset),e.addRange(t)))}}for(t=[],e=i;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof i.focus=="function"&&i.focus(),i=0;i<t.length;i++)e=t[i],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var Mse=sh&&"documentMode"in document&&11>=document.documentMode,Xg=null,iL=null,Bx=null,rL=!1;function r5(e,t,i){var r=i.window===i?i.document:i.nodeType===9?i:i.ownerDocument;rL||Xg==null||Xg!==jE(r)||(r=Xg,"selectionStart"in r&&LN(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Bx&&b1(Bx,r)||(Bx=r,r=ZE(iL,"onSelect"),0<r.length&&(t=new DN("onSelect","select",null,t,i),e.push({event:t,listeners:r}),t.target=Xg)))}function f_(e,t){var i={};return i[e.toLowerCase()]=t.toLowerCase(),i["Webkit"+e]="webkit"+t,i["Moz"+e]="moz"+t,i}var qg={animationend:f_("Animation","AnimationEnd"),animationiteration:f_("Animation","AnimationIteration"),animationstart:f_("Animation","AnimationStart"),transitionend:f_("Transition","TransitionEnd")},aD={},rq={};sh&&(rq=document.createElement("div").style,"AnimationEvent"in window||(delete qg.animationend.animation,delete qg.animationiteration.animation,delete qg.animationstart.animation),"TransitionEvent"in window||delete qg.transitionend.transition);function cT(e){if(aD[e])return aD[e];if(!qg[e])return e;var t=qg[e],i;for(i in t)if(t.hasOwnProperty(i)&&i in rq)return aD[e]=t[i];return e}var nq=cT("animationend"),sq=cT("animationiteration"),aq=cT("animationstart"),oq=cT("transitionend"),lq=new Map,n5="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Jd(e,t){lq.set(e,t),Jf(t,[e])}for(var oD=0;oD<n5.length;oD++){var lD=n5[oD],Ese=lD.toLowerCase(),Ase=lD[0].toUpperCase()+lD.slice(1);Jd(Ese,"on"+Ase)}Jd(nq,"onAnimationEnd");Jd(sq,"onAnimationIteration");Jd(aq,"onAnimationStart");Jd("dblclick","onDoubleClick");Jd("focusin","onFocus");Jd("focusout","onBlur");Jd(oq,"onTransitionEnd");kv("onMouseEnter",["mouseout","mouseover"]);kv("onMouseLeave",["mouseout","mouseover"]);kv("onPointerEnter",["pointerout","pointerover"]);kv("onPointerLeave",["pointerout","pointerover"]);Jf("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Jf("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Jf("onBeforeInput",["compositionend","keypress","textInput","paste"]);Jf("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Jf("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Jf("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var vx="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Cse=new Set("cancel close invalid load scroll toggle".split(" ").concat(vx));function s5(e,t,i){var r=e.type||"unknown-event";e.currentTarget=i,Ene(r,t,void 0,e),e.currentTarget=null}function cq(e,t){t=(t&4)!==0;for(var i=0;i<e.length;i++){var r=e[i],n=r.event;r=r.listeners;e:{var s=void 0;if(t)for(var a=r.length-1;0<=a;a--){var o=r[a],l=o.instance,c=o.currentTarget;if(o=o.listener,l!==s&&n.isPropagationStopped())break e;s5(n,o,c),s=l}else for(a=0;a<r.length;a++){if(o=r[a],l=o.instance,c=o.currentTarget,o=o.listener,l!==s&&n.isPropagationStopped())break e;s5(n,o,c),s=l}}}if(XE)throw e=$I,XE=!1,$I=null,e}function _r(e,t){var i=t[lL];i===void 0&&(i=t[lL]=new Set);var r=e+"__bubble";i.has(r)||(uq(t,e,2,!1),i.add(r))}function cD(e,t,i){var r=0;t&&(r|=4),uq(i,e,r,t)}var m_="_reactListening"+Math.random().toString(36).slice(2);function _1(e){if(!e[m_]){e[m_]=!0,vX.forEach(function(i){i!=="selectionchange"&&(Cse.has(i)||cD(i,!1,e),cD(i,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[m_]||(t[m_]=!0,cD("selectionchange",!1,t))}}function uq(e,t,i,r){switch(qX(t)){case 1:var n=Vne;break;case 4:n=Hne;break;default:n=TN}i=n.bind(null,t,i,e),n=void 0,!ZI||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(n=!0),r?n!==void 0?e.addEventListener(t,i,{capture:!0,passive:n}):e.addEventListener(t,i,!0):n!==void 0?e.addEventListener(t,i,{passive:n}):e.addEventListener(t,i,!1)}function uD(e,t,i,r,n){var s=r;if(!(t&1)&&!(t&2)&&r!==null)e:for(;;){if(r===null)return;var a=r.tag;if(a===3||a===4){var o=r.stateNode.containerInfo;if(o===n||o.nodeType===8&&o.parentNode===n)break;if(a===4)for(a=r.return;a!==null;){var l=a.tag;if((l===3||l===4)&&(l=a.stateNode.containerInfo,l===n||l.nodeType===8&&l.parentNode===n))return;a=a.return}for(;o!==null;){if(a=tf(o),a===null)return;if(l=a.tag,l===5||l===6){r=s=a;continue e}o=o.parentNode}}r=r.return}LX(function(){var c=s,u=MN(i),h=[];e:{var d=lq.get(e);if(d!==void 0){var p=DN,f=e;switch(e){case"keypress":if(rE(i)===0)break e;case"keydown":case"keyup":p=rse;break;case"focusin":f="focus",p=rD;break;case"focusout":f="blur",p=rD;break;case"beforeblur":case"afterblur":p=rD;break;case"click":if(i.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=q4;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=Wne;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=ase;break;case nq:case sq:case aq:p=Yne;break;case oq:p=lse;break;case"scroll":p=Gne;break;case"wheel":p=use;break;case"copy":case"cut":case"paste":p=Kne;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=Q4}var v=(t&4)!==0,g=!v&&e==="scroll",m=v?d!==null?d+"Capture":null:d;v=[];for(var x=c,w;x!==null;){w=x;var _=w.stateNode;if(w.tag===5&&_!==null&&(w=_,m!==null&&(_=g1(x,m),_!=null&&v.push(S1(x,_,w)))),g)break;x=x.return}0<v.length&&(d=new p(d,f,null,i,u),h.push({event:d,listeners:v}))}}if(!(t&7)){e:{if(d=e==="mouseover"||e==="pointerover",p=e==="mouseout"||e==="pointerout",d&&i!==QI&&(f=i.relatedTarget||i.fromElement)&&(tf(f)||f[ah]))break e;if((p||d)&&(d=u.window===u?u:(d=u.ownerDocument)?d.defaultView||d.parentWindow:window,p?(f=i.relatedTarget||i.toElement,p=c,f=f?tf(f):null,f!==null&&(g=em(f),f!==g||f.tag!==5&&f.tag!==6)&&(f=null)):(p=null,f=c),p!==f)){if(v=q4,_="onMouseLeave",m="onMouseEnter",x="mouse",(e==="pointerout"||e==="pointerover")&&(v=Q4,_="onPointerLeave",m="onPointerEnter",x="pointer"),g=p==null?d:Yg(p),w=f==null?d:Yg(f),d=new v(_,x+"leave",p,i,u),d.target=g,d.relatedTarget=w,_=null,tf(u)===c&&(v=new v(m,x+"enter",f,i,u),v.target=w,v.relatedTarget=g,_=v),g=_,p&&f)t:{for(v=p,m=f,x=0,w=v;w;w=Am(w))x++;for(w=0,_=m;_;_=Am(_))w++;for(;0<x-w;)v=Am(v),x--;for(;0<w-x;)m=Am(m),w--;for(;x--;){if(v===m||m!==null&&v===m.alternate)break t;v=Am(v),m=Am(m)}v=null}else v=null;p!==null&&a5(h,d,p,v,!1),f!==null&&g!==null&&a5(h,g,f,v,!0)}}e:{if(d=c?Yg(c):window,p=d.nodeName&&d.nodeName.toLowerCase(),p==="select"||p==="input"&&d.type==="file")var M=vse;else if($4(d))if(JX)M=bse;else{M=xse;var S=yse}else(p=d.nodeName)&&p.toLowerCase()==="input"&&(d.type==="checkbox"||d.type==="radio")&&(M=wse);if(M&&(M=M(e,c))){$X(h,M,i,u);break e}S&&S(e,d,c),e==="focusout"&&(S=d._wrapperState)&&S.controlled&&d.type==="number"&&jI(d,"number",d.value)}switch(S=c?Yg(c):window,e){case"focusin":($4(S)||S.contentEditable==="true")&&(Xg=S,iL=c,Bx=null);break;case"focusout":Bx=iL=Xg=null;break;case"mousedown":rL=!0;break;case"contextmenu":case"mouseup":case"dragend":rL=!1,r5(h,i,u);break;case"selectionchange":if(Mse)break;case"keydown":case"keyup":r5(h,i,u)}var A;if(IN)e:{switch(e){case"compositionstart":var T="onCompositionStart";break e;case"compositionend":T="onCompositionEnd";break e;case"compositionupdate":T="onCompositionUpdate";break e}T=void 0}else Wg?KX(e,i)&&(T="onCompositionEnd"):e==="keydown"&&i.keyCode===229&&(T="onCompositionStart");T&&(QX&&i.locale!=="ko"&&(Wg||T!=="onCompositionStart"?T==="onCompositionEnd"&&Wg&&(A=YX()):(xd=u,PN="value"in xd?xd.value:xd.textContent,Wg=!0)),S=ZE(c,T),0<S.length&&(T=new Y4(T,e,null,i,u),h.push({event:T,listeners:S}),A?T.data=A:(A=ZX(i),A!==null&&(T.data=A)))),(A=dse?pse(e,i):fse(e,i))&&(c=ZE(c,"onBeforeInput"),0<c.length&&(u=new Y4("onBeforeInput","beforeinput",null,i,u),h.push({event:u,listeners:c}),u.data=A))}cq(h,t)})}function S1(e,t,i){return{instance:e,listener:t,currentTarget:i}}function ZE(e,t){for(var i=t+"Capture",r=[];e!==null;){var n=e,s=n.stateNode;n.tag===5&&s!==null&&(n=s,s=g1(e,i),s!=null&&r.unshift(S1(e,s,n)),s=g1(e,t),s!=null&&r.push(S1(e,s,n))),e=e.return}return r}function Am(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function a5(e,t,i,r,n){for(var s=t._reactName,a=[];i!==null&&i!==r;){var o=i,l=o.alternate,c=o.stateNode;if(l!==null&&l===r)break;o.tag===5&&c!==null&&(o=c,n?(l=g1(i,s),l!=null&&a.unshift(S1(i,l,o))):n||(l=g1(i,s),l!=null&&a.push(S1(i,l,o)))),i=i.return}a.length!==0&&e.push({event:t,listeners:a})}var Tse=/\r\n?/g,Pse=/\u0000|\uFFFD/g;function o5(e){return(typeof e=="string"?e:""+e).replace(Tse,`
`).replace(Pse,"")}function g_(e,t,i){if(t=o5(t),o5(e)!==t&&i)throw Error(mt(425))}function $E(){}var nL=null,sL=null;function aL(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var oL=typeof setTimeout=="function"?setTimeout:void 0,Dse=typeof clearTimeout=="function"?clearTimeout:void 0,l5=typeof Promise=="function"?Promise:void 0,Rse=typeof queueMicrotask=="function"?queueMicrotask:typeof l5<"u"?function(e){return l5.resolve(null).then(e).catch(Ise)}:oL;function Ise(e){setTimeout(function(){throw e})}function hD(e,t){var i=t,r=0;do{var n=i.nextSibling;if(e.removeChild(i),n&&n.nodeType===8)if(i=n.data,i==="/$"){if(r===0){e.removeChild(n),x1(t);return}r--}else i!=="$"&&i!=="$?"&&i!=="$!"||r++;i=n}while(i);x1(t)}function Od(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function c5(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var i=e.data;if(i==="$"||i==="$!"||i==="$?"){if(t===0)return e;t--}else i==="/$"&&t++}e=e.previousSibling}return null}var w0=Math.random().toString(36).slice(2),Ac="__reactFiber$"+w0,M1="__reactProps$"+w0,ah="__reactContainer$"+w0,lL="__reactEvents$"+w0,Lse="__reactListeners$"+w0,Ose="__reactHandles$"+w0;function tf(e){var t=e[Ac];if(t)return t;for(var i=e.parentNode;i;){if(t=i[ah]||i[Ac]){if(i=t.alternate,t.child!==null||i!==null&&i.child!==null)for(e=c5(e);e!==null;){if(i=e[Ac])return i;e=c5(e)}return t}e=i,i=e.parentNode}return null}function Rw(e){return e=e[Ac]||e[ah],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function Yg(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(mt(33))}function uT(e){return e[M1]||null}var cL=[],Qg=-1;function ep(e){return{current:e}}function Cr(e){0>Qg||(e.current=cL[Qg],cL[Qg]=null,Qg--)}function wr(e,t){Qg++,cL[Qg]=e.current,e.current=t}var Wd={},$s=ep(Wd),Va=ep(!1),Nf=Wd;function Uv(e,t){var i=e.type.contextTypes;if(!i)return Wd;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var n={},s;for(s in i)n[s]=t[s];return r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=n),n}function Ha(e){return e=e.childContextTypes,e!=null}function JE(){Cr(Va),Cr($s)}function u5(e,t,i){if($s.current!==Wd)throw Error(mt(168));wr($s,t),wr(Va,i)}function hq(e,t,i){var r=e.stateNode;if(t=t.childContextTypes,typeof r.getChildContext!="function")return i;r=r.getChildContext();for(var n in r)if(!(n in t))throw Error(mt(108,yne(e)||"Unknown",n));return Ur({},i,r)}function eA(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Wd,Nf=$s.current,wr($s,e),wr(Va,Va.current),!0}function h5(e,t,i){var r=e.stateNode;if(!r)throw Error(mt(169));i?(e=hq(e,t,Nf),r.__reactInternalMemoizedMergedChildContext=e,Cr(Va),Cr($s),wr($s,e)):Cr(Va),wr(Va,i)}var Lu=null,hT=!1,dD=!1;function dq(e){Lu===null?Lu=[e]:Lu.push(e)}function zse(e){hT=!0,dq(e)}function tp(){if(!dD&&Lu!==null){dD=!0;var e=0,t=or;try{var i=Lu;for(or=1;e<i.length;e++){var r=i[e];do r=r(!0);while(r!==null)}Lu=null,hT=!1}catch(n){throw Lu!==null&&(Lu=Lu.slice(e+1)),BX(EN,tp),n}finally{or=t,dD=!1}}return null}var Kg=[],Zg=0,tA=null,iA=0,Ho=[],Go=0,Bf=null,ju=1,Wu="";function Up(e,t){Kg[Zg++]=iA,Kg[Zg++]=tA,tA=e,iA=t}function pq(e,t,i){Ho[Go++]=ju,Ho[Go++]=Wu,Ho[Go++]=Bf,Bf=e;var r=ju;e=Wu;var n=32-zl(r)-1;r&=~(1<<n),i+=1;var s=32-zl(t)+n;if(30<s){var a=n-n%5;s=(r&(1<<a)-1).toString(32),r>>=a,n-=a,ju=1<<32-zl(t)+n|i<<n|r,Wu=s+e}else ju=1<<s|i<<n|r,Wu=e}function ON(e){e.return!==null&&(Up(e,1),pq(e,1,0))}function zN(e){for(;e===tA;)tA=Kg[--Zg],Kg[Zg]=null,iA=Kg[--Zg],Kg[Zg]=null;for(;e===Bf;)Bf=Ho[--Go],Ho[Go]=null,Wu=Ho[--Go],Ho[Go]=null,ju=Ho[--Go],Ho[Go]=null}var ho=null,co=null,Dr=!1,Cl=null;function fq(e,t){var i=qo(5,null,null,0);i.elementType="DELETED",i.stateNode=t,i.return=e,t=e.deletions,t===null?(e.deletions=[i],e.flags|=16):t.push(i)}function d5(e,t){switch(e.tag){case 5:var i=e.type;return t=t.nodeType!==1||i.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,ho=e,co=Od(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,ho=e,co=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(i=Bf!==null?{id:ju,overflow:Wu}:null,e.memoizedState={dehydrated:t,treeContext:i,retryLane:1073741824},i=qo(18,null,null,0),i.stateNode=t,i.return=e,e.child=i,ho=e,co=null,!0):!1;default:return!1}}function uL(e){return(e.mode&1)!==0&&(e.flags&128)===0}function hL(e){if(Dr){var t=co;if(t){var i=t;if(!d5(e,t)){if(uL(e))throw Error(mt(418));t=Od(i.nextSibling);var r=ho;t&&d5(e,t)?fq(r,i):(e.flags=e.flags&-4097|2,Dr=!1,ho=e)}}else{if(uL(e))throw Error(mt(418));e.flags=e.flags&-4097|2,Dr=!1,ho=e}}}function p5(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;ho=e}function v_(e){if(e!==ho)return!1;if(!Dr)return p5(e),Dr=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!aL(e.type,e.memoizedProps)),t&&(t=co)){if(uL(e))throw mq(),Error(mt(418));for(;t;)fq(e,t),t=Od(t.nextSibling)}if(p5(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(mt(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var i=e.data;if(i==="/$"){if(t===0){co=Od(e.nextSibling);break e}t--}else i!=="$"&&i!=="$!"&&i!=="$?"||t++}e=e.nextSibling}co=null}}else co=ho?Od(e.stateNode.nextSibling):null;return!0}function mq(){for(var e=co;e;)e=Od(e.nextSibling)}function Fv(){co=ho=null,Dr=!1}function NN(e){Cl===null?Cl=[e]:Cl.push(e)}var Nse=bh.ReactCurrentBatchConfig;function gy(e,t,i){if(e=i.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(i._owner){if(i=i._owner,i){if(i.tag!==1)throw Error(mt(309));var r=i.stateNode}if(!r)throw Error(mt(147,e));var n=r,s=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===s?t.ref:(t=function(a){var o=n.refs;a===null?delete o[s]:o[s]=a},t._stringRef=s,t)}if(typeof e!="string")throw Error(mt(284));if(!i._owner)throw Error(mt(290,e))}return e}function y_(e,t){throw e=Object.prototype.toString.call(t),Error(mt(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function f5(e){var t=e._init;return t(e._payload)}function gq(e){function t(m,x){if(e){var w=m.deletions;w===null?(m.deletions=[x],m.flags|=16):w.push(x)}}function i(m,x){if(!e)return null;for(;x!==null;)t(m,x),x=x.sibling;return null}function r(m,x){for(m=new Map;x!==null;)x.key!==null?m.set(x.key,x):m.set(x.index,x),x=x.sibling;return m}function n(m,x){return m=kd(m,x),m.index=0,m.sibling=null,m}function s(m,x,w){return m.index=w,e?(w=m.alternate,w!==null?(w=w.index,w<x?(m.flags|=2,x):w):(m.flags|=2,x)):(m.flags|=1048576,x)}function a(m){return e&&m.alternate===null&&(m.flags|=2),m}function o(m,x,w,_){return x===null||x.tag!==6?(x=xD(w,m.mode,_),x.return=m,x):(x=n(x,w),x.return=m,x)}function l(m,x,w,_){var M=w.type;return M===jg?u(m,x,w.props.children,_,w.key):x!==null&&(x.elementType===M||typeof M=="object"&&M!==null&&M.$$typeof===od&&f5(M)===x.type)?(_=n(x,w.props),_.ref=gy(m,x,w),_.return=m,_):(_=uE(w.type,w.key,w.props,null,m.mode,_),_.ref=gy(m,x,w),_.return=m,_)}function c(m,x,w,_){return x===null||x.tag!==4||x.stateNode.containerInfo!==w.containerInfo||x.stateNode.implementation!==w.implementation?(x=wD(w,m.mode,_),x.return=m,x):(x=n(x,w.children||[]),x.return=m,x)}function u(m,x,w,_,M){return x===null||x.tag!==7?(x=bf(w,m.mode,_,M),x.return=m,x):(x=n(x,w),x.return=m,x)}function h(m,x,w){if(typeof x=="string"&&x!==""||typeof x=="number")return x=xD(""+x,m.mode,w),x.return=m,x;if(typeof x=="object"&&x!==null){switch(x.$$typeof){case o_:return w=uE(x.type,x.key,x.props,null,m.mode,w),w.ref=gy(m,null,x),w.return=m,w;case Gg:return x=wD(x,m.mode,w),x.return=m,x;case od:var _=x._init;return h(m,_(x._payload),w)}if(mx(x)||hy(x))return x=bf(x,m.mode,w,null),x.return=m,x;y_(m,x)}return null}function d(m,x,w,_){var M=x!==null?x.key:null;if(typeof w=="string"&&w!==""||typeof w=="number")return M!==null?null:o(m,x,""+w,_);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case o_:return w.key===M?l(m,x,w,_):null;case Gg:return w.key===M?c(m,x,w,_):null;case od:return M=w._init,d(m,x,M(w._payload),_)}if(mx(w)||hy(w))return M!==null?null:u(m,x,w,_,null);y_(m,w)}return null}function p(m,x,w,_,M){if(typeof _=="string"&&_!==""||typeof _=="number")return m=m.get(w)||null,o(x,m,""+_,M);if(typeof _=="object"&&_!==null){switch(_.$$typeof){case o_:return m=m.get(_.key===null?w:_.key)||null,l(x,m,_,M);case Gg:return m=m.get(_.key===null?w:_.key)||null,c(x,m,_,M);case od:var S=_._init;return p(m,x,w,S(_._payload),M)}if(mx(_)||hy(_))return m=m.get(w)||null,u(x,m,_,M,null);y_(x,_)}return null}function f(m,x,w,_){for(var M=null,S=null,A=x,T=x=0,E=null;A!==null&&T<w.length;T++){A.index>T?(E=A,A=null):E=A.sibling;var C=d(m,A,w[T],_);if(C===null){A===null&&(A=E);break}e&&A&&C.alternate===null&&t(m,A),x=s(C,x,T),S===null?M=C:S.sibling=C,S=C,A=E}if(T===w.length)return i(m,A),Dr&&Up(m,T),M;if(A===null){for(;T<w.length;T++)A=h(m,w[T],_),A!==null&&(x=s(A,x,T),S===null?M=A:S.sibling=A,S=A);return Dr&&Up(m,T),M}for(A=r(m,A);T<w.length;T++)E=p(A,m,T,w[T],_),E!==null&&(e&&E.alternate!==null&&A.delete(E.key===null?T:E.key),x=s(E,x,T),S===null?M=E:S.sibling=E,S=E);return e&&A.forEach(function(D){return t(m,D)}),Dr&&Up(m,T),M}function v(m,x,w,_){var M=hy(w);if(typeof M!="function")throw Error(mt(150));if(w=M.call(w),w==null)throw Error(mt(151));for(var S=M=null,A=x,T=x=0,E=null,C=w.next();A!==null&&!C.done;T++,C=w.next()){A.index>T?(E=A,A=null):E=A.sibling;var D=d(m,A,C.value,_);if(D===null){A===null&&(A=E);break}e&&A&&D.alternate===null&&t(m,A),x=s(D,x,T),S===null?M=D:S.sibling=D,S=D,A=E}if(C.done)return i(m,A),Dr&&Up(m,T),M;if(A===null){for(;!C.done;T++,C=w.next())C=h(m,C.value,_),C!==null&&(x=s(C,x,T),S===null?M=C:S.sibling=C,S=C);return Dr&&Up(m,T),M}for(A=r(m,A);!C.done;T++,C=w.next())C=p(A,m,T,C.value,_),C!==null&&(e&&C.alternate!==null&&A.delete(C.key===null?T:C.key),x=s(C,x,T),S===null?M=C:S.sibling=C,S=C);return e&&A.forEach(function(I){return t(m,I)}),Dr&&Up(m,T),M}function g(m,x,w,_){if(typeof w=="object"&&w!==null&&w.type===jg&&w.key===null&&(w=w.props.children),typeof w=="object"&&w!==null){switch(w.$$typeof){case o_:e:{for(var M=w.key,S=x;S!==null;){if(S.key===M){if(M=w.type,M===jg){if(S.tag===7){i(m,S.sibling),x=n(S,w.props.children),x.return=m,m=x;break e}}else if(S.elementType===M||typeof M=="object"&&M!==null&&M.$$typeof===od&&f5(M)===S.type){i(m,S.sibling),x=n(S,w.props),x.ref=gy(m,S,w),x.return=m,m=x;break e}i(m,S);break}else t(m,S);S=S.sibling}w.type===jg?(x=bf(w.props.children,m.mode,_,w.key),x.return=m,m=x):(_=uE(w.type,w.key,w.props,null,m.mode,_),_.ref=gy(m,x,w),_.return=m,m=_)}return a(m);case Gg:e:{for(S=w.key;x!==null;){if(x.key===S)if(x.tag===4&&x.stateNode.containerInfo===w.containerInfo&&x.stateNode.implementation===w.implementation){i(m,x.sibling),x=n(x,w.children||[]),x.return=m,m=x;break e}else{i(m,x);break}else t(m,x);x=x.sibling}x=wD(w,m.mode,_),x.return=m,m=x}return a(m);case od:return S=w._init,g(m,x,S(w._payload),_)}if(mx(w))return f(m,x,w,_);if(hy(w))return v(m,x,w,_);y_(m,w)}return typeof w=="string"&&w!==""||typeof w=="number"?(w=""+w,x!==null&&x.tag===6?(i(m,x.sibling),x=n(x,w),x.return=m,m=x):(i(m,x),x=xD(w,m.mode,_),x.return=m,m=x),a(m)):i(m,x)}return g}var Vv=gq(!0),vq=gq(!1),rA=ep(null),nA=null,$g=null,BN=null;function kN(){BN=$g=nA=null}function UN(e){var t=rA.current;Cr(rA),e._currentValue=t}function dL(e,t,i){for(;e!==null;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,r!==null&&(r.childLanes|=t)):r!==null&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===i)break;e=e.return}}function xv(e,t){nA=e,BN=$g=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(Na=!0),e.firstContext=null)}function tl(e){var t=e._currentValue;if(BN!==e)if(e={context:e,memoizedValue:t,next:null},$g===null){if(nA===null)throw Error(mt(308));$g=e,nA.dependencies={lanes:0,firstContext:e}}else $g=$g.next=e;return t}var rf=null;function FN(e){rf===null?rf=[e]:rf.push(e)}function yq(e,t,i,r){var n=t.interleaved;return n===null?(i.next=i,FN(t)):(i.next=n.next,n.next=i),t.interleaved=i,oh(e,r)}function oh(e,t){e.lanes|=t;var i=e.alternate;for(i!==null&&(i.lanes|=t),i=e,e=e.return;e!==null;)e.childLanes|=t,i=e.alternate,i!==null&&(i.childLanes|=t),i=e,e=e.return;return i.tag===3?i.stateNode:null}var ld=!1;function VN(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function xq(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function eh(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function zd(e,t,i){var r=e.updateQueue;if(r===null)return null;if(r=r.shared,Bi&2){var n=r.pending;return n===null?t.next=t:(t.next=n.next,n.next=t),r.pending=t,oh(e,i)}return n=r.interleaved,n===null?(t.next=t,FN(r)):(t.next=n.next,n.next=t),r.interleaved=t,oh(e,i)}function nE(e,t,i){if(t=t.updateQueue,t!==null&&(t=t.shared,(i&4194240)!==0)){var r=t.lanes;r&=e.pendingLanes,i|=r,t.lanes=i,AN(e,i)}}function m5(e,t){var i=e.updateQueue,r=e.alternate;if(r!==null&&(r=r.updateQueue,i===r)){var n=null,s=null;if(i=i.firstBaseUpdate,i!==null){do{var a={eventTime:i.eventTime,lane:i.lane,tag:i.tag,payload:i.payload,callback:i.callback,next:null};s===null?n=s=a:s=s.next=a,i=i.next}while(i!==null);s===null?n=s=t:s=s.next=t}else n=s=t;i={baseState:r.baseState,firstBaseUpdate:n,lastBaseUpdate:s,shared:r.shared,effects:r.effects},e.updateQueue=i;return}e=i.lastBaseUpdate,e===null?i.firstBaseUpdate=t:e.next=t,i.lastBaseUpdate=t}function sA(e,t,i,r){var n=e.updateQueue;ld=!1;var s=n.firstBaseUpdate,a=n.lastBaseUpdate,o=n.shared.pending;if(o!==null){n.shared.pending=null;var l=o,c=l.next;l.next=null,a===null?s=c:a.next=c,a=l;var u=e.alternate;u!==null&&(u=u.updateQueue,o=u.lastBaseUpdate,o!==a&&(o===null?u.firstBaseUpdate=c:o.next=c,u.lastBaseUpdate=l))}if(s!==null){var h=n.baseState;a=0,u=c=l=null,o=s;do{var d=o.lane,p=o.eventTime;if((r&d)===d){u!==null&&(u=u.next={eventTime:p,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var f=e,v=o;switch(d=t,p=i,v.tag){case 1:if(f=v.payload,typeof f=="function"){h=f.call(p,h,d);break e}h=f;break e;case 3:f.flags=f.flags&-65537|128;case 0:if(f=v.payload,d=typeof f=="function"?f.call(p,h,d):f,d==null)break e;h=Ur({},h,d);break e;case 2:ld=!0}}o.callback!==null&&o.lane!==0&&(e.flags|=64,d=n.effects,d===null?n.effects=[o]:d.push(o))}else p={eventTime:p,lane:d,tag:o.tag,payload:o.payload,callback:o.callback,next:null},u===null?(c=u=p,l=h):u=u.next=p,a|=d;if(o=o.next,o===null){if(o=n.shared.pending,o===null)break;d=o,o=d.next,d.next=null,n.lastBaseUpdate=d,n.shared.pending=null}}while(!0);if(u===null&&(l=h),n.baseState=l,n.firstBaseUpdate=c,n.lastBaseUpdate=u,t=n.shared.interleaved,t!==null){n=t;do a|=n.lane,n=n.next;while(n!==t)}else s===null&&(n.shared.lanes=0);Uf|=a,e.lanes=a,e.memoizedState=h}}function g5(e,t,i){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var r=e[t],n=r.callback;if(n!==null){if(r.callback=null,r=i,typeof n!="function")throw Error(mt(191,n));n.call(r)}}}var Iw={},Bc=ep(Iw),E1=ep(Iw),A1=ep(Iw);function nf(e){if(e===Iw)throw Error(mt(174));return e}function HN(e,t){switch(wr(A1,t),wr(E1,e),wr(Bc,Iw),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:XI(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=XI(t,e)}Cr(Bc),wr(Bc,t)}function Hv(){Cr(Bc),Cr(E1),Cr(A1)}function wq(e){nf(A1.current);var t=nf(Bc.current),i=XI(t,e.type);t!==i&&(wr(E1,e),wr(Bc,i))}function GN(e){E1.current===e&&(Cr(Bc),Cr(E1))}var Ir=ep(0);function aA(e){for(var t=e;t!==null;){if(t.tag===13){var i=t.memoizedState;if(i!==null&&(i=i.dehydrated,i===null||i.data==="$?"||i.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var pD=[];function jN(){for(var e=0;e<pD.length;e++)pD[e]._workInProgressVersionPrimary=null;pD.length=0}var sE=bh.ReactCurrentDispatcher,fD=bh.ReactCurrentBatchConfig,kf=0,Nr=null,On=null,$n=null,oA=!1,kx=!1,C1=0,Bse=0;function Os(){throw Error(mt(321))}function WN(e,t){if(t===null)return!1;for(var i=0;i<t.length&&i<e.length;i++)if(!Ul(e[i],t[i]))return!1;return!0}function XN(e,t,i,r,n,s){if(kf=s,Nr=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,sE.current=e===null||e.memoizedState===null?Vse:Hse,e=i(r,n),kx){s=0;do{if(kx=!1,C1=0,25<=s)throw Error(mt(301));s+=1,$n=On=null,t.updateQueue=null,sE.current=Gse,e=i(r,n)}while(kx)}if(sE.current=lA,t=On!==null&&On.next!==null,kf=0,$n=On=Nr=null,oA=!1,t)throw Error(mt(300));return e}function qN(){var e=C1!==0;return C1=0,e}function yc(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return $n===null?Nr.memoizedState=$n=e:$n=$n.next=e,$n}function il(){if(On===null){var e=Nr.alternate;e=e!==null?e.memoizedState:null}else e=On.next;var t=$n===null?Nr.memoizedState:$n.next;if(t!==null)$n=t,On=e;else{if(e===null)throw Error(mt(310));On=e,e={memoizedState:On.memoizedState,baseState:On.baseState,baseQueue:On.baseQueue,queue:On.queue,next:null},$n===null?Nr.memoizedState=$n=e:$n=$n.next=e}return $n}function T1(e,t){return typeof t=="function"?t(e):t}function mD(e){var t=il(),i=t.queue;if(i===null)throw Error(mt(311));i.lastRenderedReducer=e;var r=On,n=r.baseQueue,s=i.pending;if(s!==null){if(n!==null){var a=n.next;n.next=s.next,s.next=a}r.baseQueue=n=s,i.pending=null}if(n!==null){s=n.next,r=r.baseState;var o=a=null,l=null,c=s;do{var u=c.lane;if((kf&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),r=c.hasEagerState?c.eagerState:e(r,c.action);else{var h={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(o=l=h,a=r):l=l.next=h,Nr.lanes|=u,Uf|=u}c=c.next}while(c!==null&&c!==s);l===null?a=r:l.next=o,Ul(r,t.memoizedState)||(Na=!0),t.memoizedState=r,t.baseState=a,t.baseQueue=l,i.lastRenderedState=r}if(e=i.interleaved,e!==null){n=e;do s=n.lane,Nr.lanes|=s,Uf|=s,n=n.next;while(n!==e)}else n===null&&(i.lanes=0);return[t.memoizedState,i.dispatch]}function gD(e){var t=il(),i=t.queue;if(i===null)throw Error(mt(311));i.lastRenderedReducer=e;var r=i.dispatch,n=i.pending,s=t.memoizedState;if(n!==null){i.pending=null;var a=n=n.next;do s=e(s,a.action),a=a.next;while(a!==n);Ul(s,t.memoizedState)||(Na=!0),t.memoizedState=s,t.baseQueue===null&&(t.baseState=s),i.lastRenderedState=s}return[s,r]}function bq(){}function _q(e,t){var i=Nr,r=il(),n=t(),s=!Ul(r.memoizedState,n);if(s&&(r.memoizedState=n,Na=!0),r=r.queue,YN(Eq.bind(null,i,r,e),[e]),r.getSnapshot!==t||s||$n!==null&&$n.memoizedState.tag&1){if(i.flags|=2048,P1(9,Mq.bind(null,i,r,n,t),void 0,null),ls===null)throw Error(mt(349));kf&30||Sq(i,t,n)}return n}function Sq(e,t,i){e.flags|=16384,e={getSnapshot:t,value:i},t=Nr.updateQueue,t===null?(t={lastEffect:null,stores:null},Nr.updateQueue=t,t.stores=[e]):(i=t.stores,i===null?t.stores=[e]:i.push(e))}function Mq(e,t,i,r){t.value=i,t.getSnapshot=r,Aq(t)&&Cq(e)}function Eq(e,t,i){return i(function(){Aq(t)&&Cq(e)})}function Aq(e){var t=e.getSnapshot;e=e.value;try{var i=t();return!Ul(e,i)}catch{return!0}}function Cq(e){var t=oh(e,1);t!==null&&Nl(t,e,1,-1)}function v5(e){var t=yc();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:T1,lastRenderedState:e},t.queue=e,e=e.dispatch=Fse.bind(null,Nr,e),[t.memoizedState,e]}function P1(e,t,i,r){return e={tag:e,create:t,destroy:i,deps:r,next:null},t=Nr.updateQueue,t===null?(t={lastEffect:null,stores:null},Nr.updateQueue=t,t.lastEffect=e.next=e):(i=t.lastEffect,i===null?t.lastEffect=e.next=e:(r=i.next,i.next=e,e.next=r,t.lastEffect=e)),e}function Tq(){return il().memoizedState}function aE(e,t,i,r){var n=yc();Nr.flags|=e,n.memoizedState=P1(1|t,i,void 0,r===void 0?null:r)}function dT(e,t,i,r){var n=il();r=r===void 0?null:r;var s=void 0;if(On!==null){var a=On.memoizedState;if(s=a.destroy,r!==null&&WN(r,a.deps)){n.memoizedState=P1(t,i,s,r);return}}Nr.flags|=e,n.memoizedState=P1(1|t,i,s,r)}function y5(e,t){return aE(8390656,8,e,t)}function YN(e,t){return dT(2048,8,e,t)}function Pq(e,t){return dT(4,2,e,t)}function Dq(e,t){return dT(4,4,e,t)}function Rq(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function Iq(e,t,i){return i=i!=null?i.concat([e]):null,dT(4,4,Rq.bind(null,t,e),i)}function QN(){}function Lq(e,t){var i=il();t=t===void 0?null:t;var r=i.memoizedState;return r!==null&&t!==null&&WN(t,r[1])?r[0]:(i.memoizedState=[e,t],e)}function Oq(e,t){var i=il();t=t===void 0?null:t;var r=i.memoizedState;return r!==null&&t!==null&&WN(t,r[1])?r[0]:(e=e(),i.memoizedState=[e,t],e)}function zq(e,t,i){return kf&21?(Ul(i,t)||(i=FX(),Nr.lanes|=i,Uf|=i,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,Na=!0),e.memoizedState=i)}function kse(e,t){var i=or;or=i!==0&&4>i?i:4,e(!0);var r=fD.transition;fD.transition={};try{e(!1),t()}finally{or=i,fD.transition=r}}function Nq(){return il().memoizedState}function Use(e,t,i){var r=Bd(e);if(i={lane:r,action:i,hasEagerState:!1,eagerState:null,next:null},Bq(e))kq(t,i);else if(i=yq(e,t,i,r),i!==null){var n=ga();Nl(i,e,r,n),Uq(i,t,r)}}function Fse(e,t,i){var r=Bd(e),n={lane:r,action:i,hasEagerState:!1,eagerState:null,next:null};if(Bq(e))kq(t,n);else{var s=e.alternate;if(e.lanes===0&&(s===null||s.lanes===0)&&(s=t.lastRenderedReducer,s!==null))try{var a=t.lastRenderedState,o=s(a,i);if(n.hasEagerState=!0,n.eagerState=o,Ul(o,a)){var l=t.interleaved;l===null?(n.next=n,FN(t)):(n.next=l.next,l.next=n),t.interleaved=n;return}}catch{}finally{}i=yq(e,t,n,r),i!==null&&(n=ga(),Nl(i,e,r,n),Uq(i,t,r))}}function Bq(e){var t=e.alternate;return e===Nr||t!==null&&t===Nr}function kq(e,t){kx=oA=!0;var i=e.pending;i===null?t.next=t:(t.next=i.next,i.next=t),e.pending=t}function Uq(e,t,i){if(i&4194240){var r=t.lanes;r&=e.pendingLanes,i|=r,t.lanes=i,AN(e,i)}}var lA={readContext:tl,useCallback:Os,useContext:Os,useEffect:Os,useImperativeHandle:Os,useInsertionEffect:Os,useLayoutEffect:Os,useMemo:Os,useReducer:Os,useRef:Os,useState:Os,useDebugValue:Os,useDeferredValue:Os,useTransition:Os,useMutableSource:Os,useSyncExternalStore:Os,useId:Os,unstable_isNewReconciler:!1},Vse={readContext:tl,useCallback:function(e,t){return yc().memoizedState=[e,t===void 0?null:t],e},useContext:tl,useEffect:y5,useImperativeHandle:function(e,t,i){return i=i!=null?i.concat([e]):null,aE(4194308,4,Rq.bind(null,t,e),i)},useLayoutEffect:function(e,t){return aE(4194308,4,e,t)},useInsertionEffect:function(e,t){return aE(4,2,e,t)},useMemo:function(e,t){var i=yc();return t=t===void 0?null:t,e=e(),i.memoizedState=[e,t],e},useReducer:function(e,t,i){var r=yc();return t=i!==void 0?i(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=Use.bind(null,Nr,e),[r.memoizedState,e]},useRef:function(e){var t=yc();return e={current:e},t.memoizedState=e},useState:v5,useDebugValue:QN,useDeferredValue:function(e){return yc().memoizedState=e},useTransition:function(){var e=v5(!1),t=e[0];return e=kse.bind(null,e[1]),yc().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,i){var r=Nr,n=yc();if(Dr){if(i===void 0)throw Error(mt(407));i=i()}else{if(i=t(),ls===null)throw Error(mt(349));kf&30||Sq(r,t,i)}n.memoizedState=i;var s={value:i,getSnapshot:t};return n.queue=s,y5(Eq.bind(null,r,s,e),[e]),r.flags|=2048,P1(9,Mq.bind(null,r,s,i,t),void 0,null),i},useId:function(){var e=yc(),t=ls.identifierPrefix;if(Dr){var i=Wu,r=ju;i=(r&~(1<<32-zl(r)-1)).toString(32)+i,t=":"+t+"R"+i,i=C1++,0<i&&(t+="H"+i.toString(32)),t+=":"}else i=Bse++,t=":"+t+"r"+i.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},Hse={readContext:tl,useCallback:Lq,useContext:tl,useEffect:YN,useImperativeHandle:Iq,useInsertionEffect:Pq,useLayoutEffect:Dq,useMemo:Oq,useReducer:mD,useRef:Tq,useState:function(){return mD(T1)},useDebugValue:QN,useDeferredValue:function(e){var t=il();return zq(t,On.memoizedState,e)},useTransition:function(){var e=mD(T1)[0],t=il().memoizedState;return[e,t]},useMutableSource:bq,useSyncExternalStore:_q,useId:Nq,unstable_isNewReconciler:!1},Gse={readContext:tl,useCallback:Lq,useContext:tl,useEffect:YN,useImperativeHandle:Iq,useInsertionEffect:Pq,useLayoutEffect:Dq,useMemo:Oq,useReducer:gD,useRef:Tq,useState:function(){return gD(T1)},useDebugValue:QN,useDeferredValue:function(e){var t=il();return On===null?t.memoizedState=e:zq(t,On.memoizedState,e)},useTransition:function(){var e=gD(T1)[0],t=il().memoizedState;return[e,t]},useMutableSource:bq,useSyncExternalStore:_q,useId:Nq,unstable_isNewReconciler:!1};function Ml(e,t){if(e&&e.defaultProps){t=Ur({},t),e=e.defaultProps;for(var i in e)t[i]===void 0&&(t[i]=e[i]);return t}return t}function pL(e,t,i,r){t=e.memoizedState,i=i(r,t),i=i==null?t:Ur({},t,i),e.memoizedState=i,e.lanes===0&&(e.updateQueue.baseState=i)}var pT={isMounted:function(e){return(e=e._reactInternals)?em(e)===e:!1},enqueueSetState:function(e,t,i){e=e._reactInternals;var r=ga(),n=Bd(e),s=eh(r,n);s.payload=t,i!=null&&(s.callback=i),t=zd(e,s,n),t!==null&&(Nl(t,e,n,r),nE(t,e,n))},enqueueReplaceState:function(e,t,i){e=e._reactInternals;var r=ga(),n=Bd(e),s=eh(r,n);s.tag=1,s.payload=t,i!=null&&(s.callback=i),t=zd(e,s,n),t!==null&&(Nl(t,e,n,r),nE(t,e,n))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var i=ga(),r=Bd(e),n=eh(i,r);n.tag=2,t!=null&&(n.callback=t),t=zd(e,n,r),t!==null&&(Nl(t,e,r,i),nE(t,e,r))}};function x5(e,t,i,r,n,s,a){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(r,s,a):t.prototype&&t.prototype.isPureReactComponent?!b1(i,r)||!b1(n,s):!0}function Fq(e,t,i){var r=!1,n=Wd,s=t.contextType;return typeof s=="object"&&s!==null?s=tl(s):(n=Ha(t)?Nf:$s.current,r=t.contextTypes,s=(r=r!=null)?Uv(e,n):Wd),t=new t(i,s),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=pT,e.stateNode=t,t._reactInternals=e,r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=n,e.__reactInternalMemoizedMaskedChildContext=s),t}function w5(e,t,i,r){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(i,r),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(i,r),t.state!==e&&pT.enqueueReplaceState(t,t.state,null)}function fL(e,t,i,r){var n=e.stateNode;n.props=i,n.state=e.memoizedState,n.refs={},VN(e);var s=t.contextType;typeof s=="object"&&s!==null?n.context=tl(s):(s=Ha(t)?Nf:$s.current,n.context=Uv(e,s)),n.state=e.memoizedState,s=t.getDerivedStateFromProps,typeof s=="function"&&(pL(e,t,s,i),n.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof n.getSnapshotBeforeUpdate=="function"||typeof n.UNSAFE_componentWillMount!="function"&&typeof n.componentWillMount!="function"||(t=n.state,typeof n.componentWillMount=="function"&&n.componentWillMount(),typeof n.UNSAFE_componentWillMount=="function"&&n.UNSAFE_componentWillMount(),t!==n.state&&pT.enqueueReplaceState(n,n.state,null),sA(e,i,n,r),n.state=e.memoizedState),typeof n.componentDidMount=="function"&&(e.flags|=4194308)}function Gv(e,t){try{var i="",r=t;do i+=vne(r),r=r.return;while(r);var n=i}catch(s){n=`
Error generating stack: `+s.message+`
`+s.stack}return{value:e,source:t,stack:n,digest:null}}function vD(e,t,i){return{value:e,source:null,stack:i??null,digest:t??null}}function mL(e,t){try{console.error(t.value)}catch(i){setTimeout(function(){throw i})}}var jse=typeof WeakMap=="function"?WeakMap:Map;function Vq(e,t,i){i=eh(-1,i),i.tag=3,i.payload={element:null};var r=t.value;return i.callback=function(){uA||(uA=!0,EL=r),mL(e,t)},i}function Hq(e,t,i){i=eh(-1,i),i.tag=3;var r=e.type.getDerivedStateFromError;if(typeof r=="function"){var n=t.value;i.payload=function(){return r(n)},i.callback=function(){mL(e,t)}}var s=e.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(i.callback=function(){mL(e,t),typeof r!="function"&&(Nd===null?Nd=new Set([this]):Nd.add(this));var a=t.stack;this.componentDidCatch(t.value,{componentStack:a!==null?a:""})}),i}function b5(e,t,i){var r=e.pingCache;if(r===null){r=e.pingCache=new jse;var n=new Set;r.set(t,n)}else n=r.get(t),n===void 0&&(n=new Set,r.set(t,n));n.has(i)||(n.add(i),e=nae.bind(null,e,t,i),t.then(e,e))}function _5(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function S5(e,t,i,r,n){return e.mode&1?(e.flags|=65536,e.lanes=n,e):(e===t?e.flags|=65536:(e.flags|=128,i.flags|=131072,i.flags&=-52805,i.tag===1&&(i.alternate===null?i.tag=17:(t=eh(-1,1),t.tag=2,zd(i,t,1))),i.lanes|=1),e)}var Wse=bh.ReactCurrentOwner,Na=!1;function ua(e,t,i,r){t.child=e===null?vq(t,null,i,r):Vv(t,e.child,i,r)}function M5(e,t,i,r,n){i=i.render;var s=t.ref;return xv(t,n),r=XN(e,t,i,r,s,n),i=qN(),e!==null&&!Na?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n,lh(e,t,n)):(Dr&&i&&ON(t),t.flags|=1,ua(e,t,r,n),t.child)}function E5(e,t,i,r,n){if(e===null){var s=i.type;return typeof s=="function"&&!rB(s)&&s.defaultProps===void 0&&i.compare===null&&i.defaultProps===void 0?(t.tag=15,t.type=s,Gq(e,t,s,r,n)):(e=uE(i.type,null,r,t,t.mode,n),e.ref=t.ref,e.return=t,t.child=e)}if(s=e.child,!(e.lanes&n)){var a=s.memoizedProps;if(i=i.compare,i=i!==null?i:b1,i(a,r)&&e.ref===t.ref)return lh(e,t,n)}return t.flags|=1,e=kd(s,r),e.ref=t.ref,e.return=t,t.child=e}function Gq(e,t,i,r,n){if(e!==null){var s=e.memoizedProps;if(b1(s,r)&&e.ref===t.ref)if(Na=!1,t.pendingProps=r=s,(e.lanes&n)!==0)e.flags&131072&&(Na=!0);else return t.lanes=e.lanes,lh(e,t,n)}return gL(e,t,i,r,n)}function jq(e,t,i){var r=t.pendingProps,n=r.children,s=e!==null?e.memoizedState:null;if(r.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},wr(ev,so),so|=i;else{if(!(i&1073741824))return e=s!==null?s.baseLanes|i:i,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,wr(ev,so),so|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=s!==null?s.baseLanes:i,wr(ev,so),so|=r}else s!==null?(r=s.baseLanes|i,t.memoizedState=null):r=i,wr(ev,so),so|=r;return ua(e,t,n,i),t.child}function Wq(e,t){var i=t.ref;(e===null&&i!==null||e!==null&&e.ref!==i)&&(t.flags|=512,t.flags|=2097152)}function gL(e,t,i,r,n){var s=Ha(i)?Nf:$s.current;return s=Uv(t,s),xv(t,n),i=XN(e,t,i,r,s,n),r=qN(),e!==null&&!Na?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n,lh(e,t,n)):(Dr&&r&&ON(t),t.flags|=1,ua(e,t,i,n),t.child)}function A5(e,t,i,r,n){if(Ha(i)){var s=!0;eA(t)}else s=!1;if(xv(t,n),t.stateNode===null)oE(e,t),Fq(t,i,r),fL(t,i,r,n),r=!0;else if(e===null){var a=t.stateNode,o=t.memoizedProps;a.props=o;var l=a.context,c=i.contextType;typeof c=="object"&&c!==null?c=tl(c):(c=Ha(i)?Nf:$s.current,c=Uv(t,c));var u=i.getDerivedStateFromProps,h=typeof u=="function"||typeof a.getSnapshotBeforeUpdate=="function";h||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==r||l!==c)&&w5(t,a,r,c),ld=!1;var d=t.memoizedState;a.state=d,sA(t,r,a,n),l=t.memoizedState,o!==r||d!==l||Va.current||ld?(typeof u=="function"&&(pL(t,i,u,r),l=t.memoizedState),(o=ld||x5(t,i,o,r,d,l,c))?(h||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(t.flags|=4194308)):(typeof a.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=l),a.props=r,a.state=l,a.context=c,r=o):(typeof a.componentDidMount=="function"&&(t.flags|=4194308),r=!1)}else{a=t.stateNode,xq(e,t),o=t.memoizedProps,c=t.type===t.elementType?o:Ml(t.type,o),a.props=c,h=t.pendingProps,d=a.context,l=i.contextType,typeof l=="object"&&l!==null?l=tl(l):(l=Ha(i)?Nf:$s.current,l=Uv(t,l));var p=i.getDerivedStateFromProps;(u=typeof p=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==h||d!==l)&&w5(t,a,r,l),ld=!1,d=t.memoizedState,a.state=d,sA(t,r,a,n);var f=t.memoizedState;o!==h||d!==f||Va.current||ld?(typeof p=="function"&&(pL(t,i,p,r),f=t.memoizedState),(c=ld||x5(t,i,c,r,d,f,l)||!1)?(u||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(r,f,l),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(r,f,l)),typeof a.componentDidUpdate=="function"&&(t.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof a.componentDidUpdate!="function"||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=f),a.props=r,a.state=f,a.context=l,r=c):(typeof a.componentDidUpdate!="function"||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),r=!1)}return vL(e,t,i,r,s,n)}function vL(e,t,i,r,n,s){Wq(e,t);var a=(t.flags&128)!==0;if(!r&&!a)return n&&h5(t,i,!1),lh(e,t,s);r=t.stateNode,Wse.current=t;var o=a&&typeof i.getDerivedStateFromError!="function"?null:r.render();return t.flags|=1,e!==null&&a?(t.child=Vv(t,e.child,null,s),t.child=Vv(t,null,o,s)):ua(e,t,o,s),t.memoizedState=r.state,n&&h5(t,i,!0),t.child}function Xq(e){var t=e.stateNode;t.pendingContext?u5(e,t.pendingContext,t.pendingContext!==t.context):t.context&&u5(e,t.context,!1),HN(e,t.containerInfo)}function C5(e,t,i,r,n){return Fv(),NN(n),t.flags|=256,ua(e,t,i,r),t.child}var yL={dehydrated:null,treeContext:null,retryLane:0};function xL(e){return{baseLanes:e,cachePool:null,transitions:null}}function qq(e,t,i){var r=t.pendingProps,n=Ir.current,s=!1,a=(t.flags&128)!==0,o;if((o=a)||(o=e!==null&&e.memoizedState===null?!1:(n&2)!==0),o?(s=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(n|=1),wr(Ir,n&1),e===null)return hL(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(a=r.children,e=r.fallback,s?(r=t.mode,s=t.child,a={mode:"hidden",children:a},!(r&1)&&s!==null?(s.childLanes=0,s.pendingProps=a):s=gT(a,r,0,null),e=bf(e,r,i,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=xL(i),t.memoizedState=yL,e):KN(t,a));if(n=e.memoizedState,n!==null&&(o=n.dehydrated,o!==null))return Xse(e,t,a,r,o,n,i);if(s){s=r.fallback,a=t.mode,n=e.child,o=n.sibling;var l={mode:"hidden",children:r.children};return!(a&1)&&t.child!==n?(r=t.child,r.childLanes=0,r.pendingProps=l,t.deletions=null):(r=kd(n,l),r.subtreeFlags=n.subtreeFlags&14680064),o!==null?s=kd(o,s):(s=bf(s,a,i,null),s.flags|=2),s.return=t,r.return=t,r.sibling=s,t.child=r,r=s,s=t.child,a=e.child.memoizedState,a=a===null?xL(i):{baseLanes:a.baseLanes|i,cachePool:null,transitions:a.transitions},s.memoizedState=a,s.childLanes=e.childLanes&~i,t.memoizedState=yL,r}return s=e.child,e=s.sibling,r=kd(s,{mode:"visible",children:r.children}),!(t.mode&1)&&(r.lanes=i),r.return=t,r.sibling=null,e!==null&&(i=t.deletions,i===null?(t.deletions=[e],t.flags|=16):i.push(e)),t.child=r,t.memoizedState=null,r}function KN(e,t){return t=gT({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function x_(e,t,i,r){return r!==null&&NN(r),Vv(t,e.child,null,i),e=KN(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function Xse(e,t,i,r,n,s,a){if(i)return t.flags&256?(t.flags&=-257,r=vD(Error(mt(422))),x_(e,t,a,r)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(s=r.fallback,n=t.mode,r=gT({mode:"visible",children:r.children},n,0,null),s=bf(s,n,a,null),s.flags|=2,r.return=t,s.return=t,r.sibling=s,t.child=r,t.mode&1&&Vv(t,e.child,null,a),t.child.memoizedState=xL(a),t.memoizedState=yL,s);if(!(t.mode&1))return x_(e,t,a,null);if(n.data==="$!"){if(r=n.nextSibling&&n.nextSibling.dataset,r)var o=r.dgst;return r=o,s=Error(mt(419)),r=vD(s,r,void 0),x_(e,t,a,r)}if(o=(a&e.childLanes)!==0,Na||o){if(r=ls,r!==null){switch(a&-a){case 4:n=2;break;case 16:n=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:n=32;break;case 536870912:n=268435456;break;default:n=0}n=n&(r.suspendedLanes|a)?0:n,n!==0&&n!==s.retryLane&&(s.retryLane=n,oh(e,n),Nl(r,e,n,-1))}return iB(),r=vD(Error(mt(421))),x_(e,t,a,r)}return n.data==="$?"?(t.flags|=128,t.child=e.child,t=sae.bind(null,e),n._reactRetry=t,null):(e=s.treeContext,co=Od(n.nextSibling),ho=t,Dr=!0,Cl=null,e!==null&&(Ho[Go++]=ju,Ho[Go++]=Wu,Ho[Go++]=Bf,ju=e.id,Wu=e.overflow,Bf=t),t=KN(t,r.children),t.flags|=4096,t)}function T5(e,t,i){e.lanes|=t;var r=e.alternate;r!==null&&(r.lanes|=t),dL(e.return,t,i)}function yD(e,t,i,r,n){var s=e.memoizedState;s===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:i,tailMode:n}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=i,s.tailMode=n)}function Yq(e,t,i){var r=t.pendingProps,n=r.revealOrder,s=r.tail;if(ua(e,t,r.children,i),r=Ir.current,r&2)r=r&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&T5(e,i,t);else if(e.tag===19)T5(e,i,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(wr(Ir,r),!(t.mode&1))t.memoizedState=null;else switch(n){case"forwards":for(i=t.child,n=null;i!==null;)e=i.alternate,e!==null&&aA(e)===null&&(n=i),i=i.sibling;i=n,i===null?(n=t.child,t.child=null):(n=i.sibling,i.sibling=null),yD(t,!1,n,i,s);break;case"backwards":for(i=null,n=t.child,t.child=null;n!==null;){if(e=n.alternate,e!==null&&aA(e)===null){t.child=n;break}e=n.sibling,n.sibling=i,i=n,n=e}yD(t,!0,i,null,s);break;case"together":yD(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function oE(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function lh(e,t,i){if(e!==null&&(t.dependencies=e.dependencies),Uf|=t.lanes,!(i&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(mt(153));if(t.child!==null){for(e=t.child,i=kd(e,e.pendingProps),t.child=i,i.return=t;e.sibling!==null;)e=e.sibling,i=i.sibling=kd(e,e.pendingProps),i.return=t;i.sibling=null}return t.child}function qse(e,t,i){switch(t.tag){case 3:Xq(t),Fv();break;case 5:wq(t);break;case 1:Ha(t.type)&&eA(t);break;case 4:HN(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,n=t.memoizedProps.value;wr(rA,r._currentValue),r._currentValue=n;break;case 13:if(r=t.memoizedState,r!==null)return r.dehydrated!==null?(wr(Ir,Ir.current&1),t.flags|=128,null):i&t.child.childLanes?qq(e,t,i):(wr(Ir,Ir.current&1),e=lh(e,t,i),e!==null?e.sibling:null);wr(Ir,Ir.current&1);break;case 19:if(r=(i&t.childLanes)!==0,e.flags&128){if(r)return Yq(e,t,i);t.flags|=128}if(n=t.memoizedState,n!==null&&(n.rendering=null,n.tail=null,n.lastEffect=null),wr(Ir,Ir.current),r)break;return null;case 22:case 23:return t.lanes=0,jq(e,t,i)}return lh(e,t,i)}var Qq,wL,Kq,Zq;Qq=function(e,t){for(var i=t.child;i!==null;){if(i.tag===5||i.tag===6)e.appendChild(i.stateNode);else if(i.tag!==4&&i.child!==null){i.child.return=i,i=i.child;continue}if(i===t)break;for(;i.sibling===null;){if(i.return===null||i.return===t)return;i=i.return}i.sibling.return=i.return,i=i.sibling}};wL=function(){};Kq=function(e,t,i,r){var n=e.memoizedProps;if(n!==r){e=t.stateNode,nf(Bc.current);var s=null;switch(i){case"input":n=HI(e,n),r=HI(e,r),s=[];break;case"select":n=Ur({},n,{value:void 0}),r=Ur({},r,{value:void 0}),s=[];break;case"textarea":n=WI(e,n),r=WI(e,r),s=[];break;default:typeof n.onClick!="function"&&typeof r.onClick=="function"&&(e.onclick=$E)}qI(i,r);var a;i=null;for(c in n)if(!r.hasOwnProperty(c)&&n.hasOwnProperty(c)&&n[c]!=null)if(c==="style"){var o=n[c];for(a in o)o.hasOwnProperty(a)&&(i||(i={}),i[a]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(f1.hasOwnProperty(c)?s||(s=[]):(s=s||[]).push(c,null));for(c in r){var l=r[c];if(o=n!=null?n[c]:void 0,r.hasOwnProperty(c)&&l!==o&&(l!=null||o!=null))if(c==="style")if(o){for(a in o)!o.hasOwnProperty(a)||l&&l.hasOwnProperty(a)||(i||(i={}),i[a]="");for(a in l)l.hasOwnProperty(a)&&o[a]!==l[a]&&(i||(i={}),i[a]=l[a])}else i||(s||(s=[]),s.push(c,i)),i=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,o=o?o.__html:void 0,l!=null&&o!==l&&(s=s||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(f1.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&_r("scroll",e),s||o===l||(s=[])):(s=s||[]).push(c,l))}i&&(s=s||[]).push("style",i);var c=s;(t.updateQueue=c)&&(t.flags|=4)}};Zq=function(e,t,i,r){i!==r&&(t.flags|=4)};function vy(e,t){if(!Dr)switch(e.tailMode){case"hidden":t=e.tail;for(var i=null;t!==null;)t.alternate!==null&&(i=t),t=t.sibling;i===null?e.tail=null:i.sibling=null;break;case"collapsed":i=e.tail;for(var r=null;i!==null;)i.alternate!==null&&(r=i),i=i.sibling;r===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:r.sibling=null}}function zs(e){var t=e.alternate!==null&&e.alternate.child===e.child,i=0,r=0;if(t)for(var n=e.child;n!==null;)i|=n.lanes|n.childLanes,r|=n.subtreeFlags&14680064,r|=n.flags&14680064,n.return=e,n=n.sibling;else for(n=e.child;n!==null;)i|=n.lanes|n.childLanes,r|=n.subtreeFlags,r|=n.flags,n.return=e,n=n.sibling;return e.subtreeFlags|=r,e.childLanes=i,t}function Yse(e,t,i){var r=t.pendingProps;switch(zN(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return zs(t),null;case 1:return Ha(t.type)&&JE(),zs(t),null;case 3:return r=t.stateNode,Hv(),Cr(Va),Cr($s),jN(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(e===null||e.child===null)&&(v_(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,Cl!==null&&(TL(Cl),Cl=null))),wL(e,t),zs(t),null;case 5:GN(t);var n=nf(A1.current);if(i=t.type,e!==null&&t.stateNode!=null)Kq(e,t,i,r,n),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(t.stateNode===null)throw Error(mt(166));return zs(t),null}if(e=nf(Bc.current),v_(t)){r=t.stateNode,i=t.type;var s=t.memoizedProps;switch(r[Ac]=t,r[M1]=s,e=(t.mode&1)!==0,i){case"dialog":_r("cancel",r),_r("close",r);break;case"iframe":case"object":case"embed":_r("load",r);break;case"video":case"audio":for(n=0;n<vx.length;n++)_r(vx[n],r);break;case"source":_r("error",r);break;case"img":case"image":case"link":_r("error",r),_r("load",r);break;case"details":_r("toggle",r);break;case"input":B4(r,s),_r("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},_r("invalid",r);break;case"textarea":U4(r,s),_r("invalid",r)}qI(i,s),n=null;for(var a in s)if(s.hasOwnProperty(a)){var o=s[a];a==="children"?typeof o=="string"?r.textContent!==o&&(s.suppressHydrationWarning!==!0&&g_(r.textContent,o,e),n=["children",o]):typeof o=="number"&&r.textContent!==""+o&&(s.suppressHydrationWarning!==!0&&g_(r.textContent,o,e),n=["children",""+o]):f1.hasOwnProperty(a)&&o!=null&&a==="onScroll"&&_r("scroll",r)}switch(i){case"input":l_(r),k4(r,s,!0);break;case"textarea":l_(r),F4(r);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(r.onclick=$E)}r=n,t.updateQueue=r,r!==null&&(t.flags|=4)}else{a=n.nodeType===9?n:n.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=EX(i)),e==="http://www.w3.org/1999/xhtml"?i==="script"?(e=a.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof r.is=="string"?e=a.createElement(i,{is:r.is}):(e=a.createElement(i),i==="select"&&(a=e,r.multiple?a.multiple=!0:r.size&&(a.size=r.size))):e=a.createElementNS(e,i),e[Ac]=t,e[M1]=r,Qq(e,t,!1,!1),t.stateNode=e;e:{switch(a=YI(i,r),i){case"dialog":_r("cancel",e),_r("close",e),n=r;break;case"iframe":case"object":case"embed":_r("load",e),n=r;break;case"video":case"audio":for(n=0;n<vx.length;n++)_r(vx[n],e);n=r;break;case"source":_r("error",e),n=r;break;case"img":case"image":case"link":_r("error",e),_r("load",e),n=r;break;case"details":_r("toggle",e),n=r;break;case"input":B4(e,r),n=HI(e,r),_r("invalid",e);break;case"option":n=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},n=Ur({},r,{value:void 0}),_r("invalid",e);break;case"textarea":U4(e,r),n=WI(e,r),_r("invalid",e);break;default:n=r}qI(i,n),o=n;for(s in o)if(o.hasOwnProperty(s)){var l=o[s];s==="style"?TX(e,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&AX(e,l)):s==="children"?typeof l=="string"?(i!=="textarea"||l!=="")&&m1(e,l):typeof l=="number"&&m1(e,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(f1.hasOwnProperty(s)?l!=null&&s==="onScroll"&&_r("scroll",e):l!=null&&wN(e,s,l,a))}switch(i){case"input":l_(e),k4(e,r,!1);break;case"textarea":l_(e),F4(e);break;case"option":r.value!=null&&e.setAttribute("value",""+jd(r.value));break;case"select":e.multiple=!!r.multiple,s=r.value,s!=null?mv(e,!!r.multiple,s,!1):r.defaultValue!=null&&mv(e,!!r.multiple,r.defaultValue,!0);break;default:typeof n.onClick=="function"&&(e.onclick=$E)}switch(i){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return zs(t),null;case 6:if(e&&t.stateNode!=null)Zq(e,t,e.memoizedProps,r);else{if(typeof r!="string"&&t.stateNode===null)throw Error(mt(166));if(i=nf(A1.current),nf(Bc.current),v_(t)){if(r=t.stateNode,i=t.memoizedProps,r[Ac]=t,(s=r.nodeValue!==i)&&(e=ho,e!==null))switch(e.tag){case 3:g_(r.nodeValue,i,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&g_(r.nodeValue,i,(e.mode&1)!==0)}s&&(t.flags|=4)}else r=(i.nodeType===9?i:i.ownerDocument).createTextNode(r),r[Ac]=t,t.stateNode=r}return zs(t),null;case 13:if(Cr(Ir),r=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(Dr&&co!==null&&t.mode&1&&!(t.flags&128))mq(),Fv(),t.flags|=98560,s=!1;else if(s=v_(t),r!==null&&r.dehydrated!==null){if(e===null){if(!s)throw Error(mt(318));if(s=t.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(mt(317));s[Ac]=t}else Fv(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;zs(t),s=!1}else Cl!==null&&(TL(Cl),Cl=null),s=!0;if(!s)return t.flags&65536?t:null}return t.flags&128?(t.lanes=i,t):(r=r!==null,r!==(e!==null&&e.memoizedState!==null)&&r&&(t.child.flags|=8192,t.mode&1&&(e===null||Ir.current&1?kn===0&&(kn=3):iB())),t.updateQueue!==null&&(t.flags|=4),zs(t),null);case 4:return Hv(),wL(e,t),e===null&&_1(t.stateNode.containerInfo),zs(t),null;case 10:return UN(t.type._context),zs(t),null;case 17:return Ha(t.type)&&JE(),zs(t),null;case 19:if(Cr(Ir),s=t.memoizedState,s===null)return zs(t),null;if(r=(t.flags&128)!==0,a=s.rendering,a===null)if(r)vy(s,!1);else{if(kn!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(a=aA(e),a!==null){for(t.flags|=128,vy(s,!1),r=a.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=i,i=t.child;i!==null;)s=i,e=r,s.flags&=14680066,a=s.alternate,a===null?(s.childLanes=0,s.lanes=e,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=a.childLanes,s.lanes=a.lanes,s.child=a.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=a.memoizedProps,s.memoizedState=a.memoizedState,s.updateQueue=a.updateQueue,s.type=a.type,e=a.dependencies,s.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),i=i.sibling;return wr(Ir,Ir.current&1|2),t.child}e=e.sibling}s.tail!==null&&an()>jv&&(t.flags|=128,r=!0,vy(s,!1),t.lanes=4194304)}else{if(!r)if(e=aA(a),e!==null){if(t.flags|=128,r=!0,i=e.updateQueue,i!==null&&(t.updateQueue=i,t.flags|=4),vy(s,!0),s.tail===null&&s.tailMode==="hidden"&&!a.alternate&&!Dr)return zs(t),null}else 2*an()-s.renderingStartTime>jv&&i!==1073741824&&(t.flags|=128,r=!0,vy(s,!1),t.lanes=4194304);s.isBackwards?(a.sibling=t.child,t.child=a):(i=s.last,i!==null?i.sibling=a:t.child=a,s.last=a)}return s.tail!==null?(t=s.tail,s.rendering=t,s.tail=t.sibling,s.renderingStartTime=an(),t.sibling=null,i=Ir.current,wr(Ir,r?i&1|2:i&1),t):(zs(t),null);case 22:case 23:return tB(),r=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==r&&(t.flags|=8192),r&&t.mode&1?so&1073741824&&(zs(t),t.subtreeFlags&6&&(t.flags|=8192)):zs(t),null;case 24:return null;case 25:return null}throw Error(mt(156,t.tag))}function Qse(e,t){switch(zN(t),t.tag){case 1:return Ha(t.type)&&JE(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return Hv(),Cr(Va),Cr($s),jN(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return GN(t),null;case 13:if(Cr(Ir),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(mt(340));Fv()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return Cr(Ir),null;case 4:return Hv(),null;case 10:return UN(t.type._context),null;case 22:case 23:return tB(),null;case 24:return null;default:return null}}var w_=!1,Hs=!1,Kse=typeof WeakSet=="function"?WeakSet:Set,It=null;function Jg(e,t){var i=e.ref;if(i!==null)if(typeof i=="function")try{i(null)}catch(r){qr(e,t,r)}else i.current=null}function bL(e,t,i){try{i()}catch(r){qr(e,t,r)}}var P5=!1;function Zse(e,t){if(nL=QE,e=iq(),LN(e)){if("selectionStart"in e)var i={start:e.selectionStart,end:e.selectionEnd};else e:{i=(i=e.ownerDocument)&&i.defaultView||window;var r=i.getSelection&&i.getSelection();if(r&&r.rangeCount!==0){i=r.anchorNode;var n=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{i.nodeType,s.nodeType}catch{i=null;break e}var a=0,o=-1,l=-1,c=0,u=0,h=e,d=null;t:for(;;){for(var p;h!==i||n!==0&&h.nodeType!==3||(o=a+n),h!==s||r!==0&&h.nodeType!==3||(l=a+r),h.nodeType===3&&(a+=h.nodeValue.length),(p=h.firstChild)!==null;)d=h,h=p;for(;;){if(h===e)break t;if(d===i&&++c===n&&(o=a),d===s&&++u===r&&(l=a),(p=h.nextSibling)!==null)break;h=d,d=h.parentNode}h=p}i=o===-1||l===-1?null:{start:o,end:l}}else i=null}i=i||{start:0,end:0}}else i=null;for(sL={focusedElem:e,selectionRange:i},QE=!1,It=t;It!==null;)if(t=It,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,It=e;else for(;It!==null;){t=It;try{var f=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(f!==null){var v=f.memoizedProps,g=f.memoizedState,m=t.stateNode,x=m.getSnapshotBeforeUpdate(t.elementType===t.type?v:Ml(t.type,v),g);m.__reactInternalSnapshotBeforeUpdate=x}break;case 3:var w=t.stateNode.containerInfo;w.nodeType===1?w.textContent="":w.nodeType===9&&w.documentElement&&w.removeChild(w.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(mt(163))}}catch(_){qr(t,t.return,_)}if(e=t.sibling,e!==null){e.return=t.return,It=e;break}It=t.return}return f=P5,P5=!1,f}function Ux(e,t,i){var r=t.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var n=r=r.next;do{if((n.tag&e)===e){var s=n.destroy;n.destroy=void 0,s!==void 0&&bL(t,i,s)}n=n.next}while(n!==r)}}function fT(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var i=t=t.next;do{if((i.tag&e)===e){var r=i.create;i.destroy=r()}i=i.next}while(i!==t)}}function _L(e){var t=e.ref;if(t!==null){var i=e.stateNode;switch(e.tag){case 5:e=i;break;default:e=i}typeof t=="function"?t(e):t.current=e}}function $q(e){var t=e.alternate;t!==null&&(e.alternate=null,$q(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[Ac],delete t[M1],delete t[lL],delete t[Lse],delete t[Ose])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function Jq(e){return e.tag===5||e.tag===3||e.tag===4}function D5(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||Jq(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function SL(e,t,i){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?i.nodeType===8?i.parentNode.insertBefore(e,t):i.insertBefore(e,t):(i.nodeType===8?(t=i.parentNode,t.insertBefore(e,i)):(t=i,t.appendChild(e)),i=i._reactRootContainer,i!=null||t.onclick!==null||(t.onclick=$E));else if(r!==4&&(e=e.child,e!==null))for(SL(e,t,i),e=e.sibling;e!==null;)SL(e,t,i),e=e.sibling}function ML(e,t,i){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?i.insertBefore(e,t):i.appendChild(e);else if(r!==4&&(e=e.child,e!==null))for(ML(e,t,i),e=e.sibling;e!==null;)ML(e,t,i),e=e.sibling}var ms=null,Al=!1;function zh(e,t,i){for(i=i.child;i!==null;)eY(e,t,i),i=i.sibling}function eY(e,t,i){if(Nc&&typeof Nc.onCommitFiberUnmount=="function")try{Nc.onCommitFiberUnmount(aT,i)}catch{}switch(i.tag){case 5:Hs||Jg(i,t);case 6:var r=ms,n=Al;ms=null,zh(e,t,i),ms=r,Al=n,ms!==null&&(Al?(e=ms,i=i.stateNode,e.nodeType===8?e.parentNode.removeChild(i):e.removeChild(i)):ms.removeChild(i.stateNode));break;case 18:ms!==null&&(Al?(e=ms,i=i.stateNode,e.nodeType===8?hD(e.parentNode,i):e.nodeType===1&&hD(e,i),x1(e)):hD(ms,i.stateNode));break;case 4:r=ms,n=Al,ms=i.stateNode.containerInfo,Al=!0,zh(e,t,i),ms=r,Al=n;break;case 0:case 11:case 14:case 15:if(!Hs&&(r=i.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){n=r=r.next;do{var s=n,a=s.destroy;s=s.tag,a!==void 0&&(s&2||s&4)&&bL(i,t,a),n=n.next}while(n!==r)}zh(e,t,i);break;case 1:if(!Hs&&(Jg(i,t),r=i.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=i.memoizedProps,r.state=i.memoizedState,r.componentWillUnmount()}catch(o){qr(i,t,o)}zh(e,t,i);break;case 21:zh(e,t,i);break;case 22:i.mode&1?(Hs=(r=Hs)||i.memoizedState!==null,zh(e,t,i),Hs=r):zh(e,t,i);break;default:zh(e,t,i)}}function R5(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var i=e.stateNode;i===null&&(i=e.stateNode=new Kse),t.forEach(function(r){var n=aae.bind(null,e,r);i.has(r)||(i.add(r),r.then(n,n))})}}function ul(e,t){var i=t.deletions;if(i!==null)for(var r=0;r<i.length;r++){var n=i[r];try{var s=e,a=t,o=a;e:for(;o!==null;){switch(o.tag){case 5:ms=o.stateNode,Al=!1;break e;case 3:ms=o.stateNode.containerInfo,Al=!0;break e;case 4:ms=o.stateNode.containerInfo,Al=!0;break e}o=o.return}if(ms===null)throw Error(mt(160));eY(s,a,n),ms=null,Al=!1;var l=n.alternate;l!==null&&(l.return=null),n.return=null}catch(c){qr(n,t,c)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)tY(t,e),t=t.sibling}function tY(e,t){var i=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(ul(t,e),nc(e),r&4){try{Ux(3,e,e.return),fT(3,e)}catch(v){qr(e,e.return,v)}try{Ux(5,e,e.return)}catch(v){qr(e,e.return,v)}}break;case 1:ul(t,e),nc(e),r&512&&i!==null&&Jg(i,i.return);break;case 5:if(ul(t,e),nc(e),r&512&&i!==null&&Jg(i,i.return),e.flags&32){var n=e.stateNode;try{m1(n,"")}catch(v){qr(e,e.return,v)}}if(r&4&&(n=e.stateNode,n!=null)){var s=e.memoizedProps,a=i!==null?i.memoizedProps:s,o=e.type,l=e.updateQueue;if(e.updateQueue=null,l!==null)try{o==="input"&&s.type==="radio"&&s.name!=null&&SX(n,s),YI(o,a);var c=YI(o,s);for(a=0;a<l.length;a+=2){var u=l[a],h=l[a+1];u==="style"?TX(n,h):u==="dangerouslySetInnerHTML"?AX(n,h):u==="children"?m1(n,h):wN(n,u,h,c)}switch(o){case"input":GI(n,s);break;case"textarea":MX(n,s);break;case"select":var d=n._wrapperState.wasMultiple;n._wrapperState.wasMultiple=!!s.multiple;var p=s.value;p!=null?mv(n,!!s.multiple,p,!1):d!==!!s.multiple&&(s.defaultValue!=null?mv(n,!!s.multiple,s.defaultValue,!0):mv(n,!!s.multiple,s.multiple?[]:"",!1))}n[M1]=s}catch(v){qr(e,e.return,v)}}break;case 6:if(ul(t,e),nc(e),r&4){if(e.stateNode===null)throw Error(mt(162));n=e.stateNode,s=e.memoizedProps;try{n.nodeValue=s}catch(v){qr(e,e.return,v)}}break;case 3:if(ul(t,e),nc(e),r&4&&i!==null&&i.memoizedState.isDehydrated)try{x1(t.containerInfo)}catch(v){qr(e,e.return,v)}break;case 4:ul(t,e),nc(e);break;case 13:ul(t,e),nc(e),n=e.child,n.flags&8192&&(s=n.memoizedState!==null,n.stateNode.isHidden=s,!s||n.alternate!==null&&n.alternate.memoizedState!==null||(JN=an())),r&4&&R5(e);break;case 22:if(u=i!==null&&i.memoizedState!==null,e.mode&1?(Hs=(c=Hs)||u,ul(t,e),Hs=c):ul(t,e),nc(e),r&8192){if(c=e.memoizedState!==null,(e.stateNode.isHidden=c)&&!u&&e.mode&1)for(It=e,u=e.child;u!==null;){for(h=It=u;It!==null;){switch(d=It,p=d.child,d.tag){case 0:case 11:case 14:case 15:Ux(4,d,d.return);break;case 1:Jg(d,d.return);var f=d.stateNode;if(typeof f.componentWillUnmount=="function"){r=d,i=d.return;try{t=r,f.props=t.memoizedProps,f.state=t.memoizedState,f.componentWillUnmount()}catch(v){qr(r,i,v)}}break;case 5:Jg(d,d.return);break;case 22:if(d.memoizedState!==null){L5(h);continue}}p!==null?(p.return=d,It=p):L5(h)}u=u.sibling}e:for(u=null,h=e;;){if(h.tag===5){if(u===null){u=h;try{n=h.stateNode,c?(s=n.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(o=h.stateNode,l=h.memoizedProps.style,a=l!=null&&l.hasOwnProperty("display")?l.display:null,o.style.display=CX("display",a))}catch(v){qr(e,e.return,v)}}}else if(h.tag===6){if(u===null)try{h.stateNode.nodeValue=c?"":h.memoizedProps}catch(v){qr(e,e.return,v)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===e)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;h.sibling===null;){if(h.return===null||h.return===e)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:ul(t,e),nc(e),r&4&&R5(e);break;case 21:break;default:ul(t,e),nc(e)}}function nc(e){var t=e.flags;if(t&2){try{e:{for(var i=e.return;i!==null;){if(Jq(i)){var r=i;break e}i=i.return}throw Error(mt(160))}switch(r.tag){case 5:var n=r.stateNode;r.flags&32&&(m1(n,""),r.flags&=-33);var s=D5(e);ML(e,s,n);break;case 3:case 4:var a=r.stateNode.containerInfo,o=D5(e);SL(e,o,a);break;default:throw Error(mt(161))}}catch(l){qr(e,e.return,l)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function $se(e,t,i){It=e,iY(e)}function iY(e,t,i){for(var r=(e.mode&1)!==0;It!==null;){var n=It,s=n.child;if(n.tag===22&&r){var a=n.memoizedState!==null||w_;if(!a){var o=n.alternate,l=o!==null&&o.memoizedState!==null||Hs;o=w_;var c=Hs;if(w_=a,(Hs=l)&&!c)for(It=n;It!==null;)a=It,l=a.child,a.tag===22&&a.memoizedState!==null?O5(n):l!==null?(l.return=a,It=l):O5(n);for(;s!==null;)It=s,iY(s),s=s.sibling;It=n,w_=o,Hs=c}I5(e)}else n.subtreeFlags&8772&&s!==null?(s.return=n,It=s):I5(e)}}function I5(e){for(;It!==null;){var t=It;if(t.flags&8772){var i=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Hs||fT(5,t);break;case 1:var r=t.stateNode;if(t.flags&4&&!Hs)if(i===null)r.componentDidMount();else{var n=t.elementType===t.type?i.memoizedProps:Ml(t.type,i.memoizedProps);r.componentDidUpdate(n,i.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=t.updateQueue;s!==null&&g5(t,s,r);break;case 3:var a=t.updateQueue;if(a!==null){if(i=null,t.child!==null)switch(t.child.tag){case 5:i=t.child.stateNode;break;case 1:i=t.child.stateNode}g5(t,a,i)}break;case 5:var o=t.stateNode;if(i===null&&t.flags&4){i=o;var l=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&i.focus();break;case"img":l.src&&(i.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var c=t.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var h=u.dehydrated;h!==null&&x1(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(mt(163))}Hs||t.flags&512&&_L(t)}catch(d){qr(t,t.return,d)}}if(t===e){It=null;break}if(i=t.sibling,i!==null){i.return=t.return,It=i;break}It=t.return}}function L5(e){for(;It!==null;){var t=It;if(t===e){It=null;break}var i=t.sibling;if(i!==null){i.return=t.return,It=i;break}It=t.return}}function O5(e){for(;It!==null;){var t=It;try{switch(t.tag){case 0:case 11:case 15:var i=t.return;try{fT(4,t)}catch(l){qr(t,i,l)}break;case 1:var r=t.stateNode;if(typeof r.componentDidMount=="function"){var n=t.return;try{r.componentDidMount()}catch(l){qr(t,n,l)}}var s=t.return;try{_L(t)}catch(l){qr(t,s,l)}break;case 5:var a=t.return;try{_L(t)}catch(l){qr(t,a,l)}}}catch(l){qr(t,t.return,l)}if(t===e){It=null;break}var o=t.sibling;if(o!==null){o.return=t.return,It=o;break}It=t.return}}var Jse=Math.ceil,cA=bh.ReactCurrentDispatcher,ZN=bh.ReactCurrentOwner,Zo=bh.ReactCurrentBatchConfig,Bi=0,ls=null,wn=null,Ms=0,so=0,ev=ep(0),kn=0,D1=null,Uf=0,mT=0,$N=0,Fx=null,Ra=null,JN=0,jv=1/0,Pu=null,uA=!1,EL=null,Nd=null,b_=!1,wd=null,hA=0,Vx=0,AL=null,lE=-1,cE=0;function ga(){return Bi&6?an():lE!==-1?lE:lE=an()}function Bd(e){return e.mode&1?Bi&2&&Ms!==0?Ms&-Ms:Nse.transition!==null?(cE===0&&(cE=FX()),cE):(e=or,e!==0||(e=window.event,e=e===void 0?16:qX(e.type)),e):1}function Nl(e,t,i,r){if(50<Vx)throw Vx=0,AL=null,Error(mt(185));Pw(e,i,r),(!(Bi&2)||e!==ls)&&(e===ls&&(!(Bi&2)&&(mT|=i),kn===4&&dd(e,Ms)),Ga(e,r),i===1&&Bi===0&&!(t.mode&1)&&(jv=an()+500,hT&&tp()))}function Ga(e,t){var i=e.callbackNode;Nne(e,t);var r=YE(e,e===ls?Ms:0);if(r===0)i!==null&&G4(i),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(i!=null&&G4(i),t===1)e.tag===0?zse(z5.bind(null,e)):dq(z5.bind(null,e)),Rse(function(){!(Bi&6)&&tp()}),i=null;else{switch(VX(r)){case 1:i=EN;break;case 4:i=kX;break;case 16:i=qE;break;case 536870912:i=UX;break;default:i=qE}i=uY(i,rY.bind(null,e))}e.callbackPriority=t,e.callbackNode=i}}function rY(e,t){if(lE=-1,cE=0,Bi&6)throw Error(mt(327));var i=e.callbackNode;if(wv()&&e.callbackNode!==i)return null;var r=YE(e,e===ls?Ms:0);if(r===0)return null;if(r&30||r&e.expiredLanes||t)t=dA(e,r);else{t=r;var n=Bi;Bi|=2;var s=sY();(ls!==e||Ms!==t)&&(Pu=null,jv=an()+500,wf(e,t));do try{iae();break}catch(o){nY(e,o)}while(!0);kN(),cA.current=s,Bi=n,wn!==null?t=0:(ls=null,Ms=0,t=kn)}if(t!==0){if(t===2&&(n=JI(e),n!==0&&(r=n,t=CL(e,n))),t===1)throw i=D1,wf(e,0),dd(e,r),Ga(e,an()),i;if(t===6)dd(e,r);else{if(n=e.current.alternate,!(r&30)&&!eae(n)&&(t=dA(e,r),t===2&&(s=JI(e),s!==0&&(r=s,t=CL(e,s))),t===1))throw i=D1,wf(e,0),dd(e,r),Ga(e,an()),i;switch(e.finishedWork=n,e.finishedLanes=r,t){case 0:case 1:throw Error(mt(345));case 2:Fp(e,Ra,Pu);break;case 3:if(dd(e,r),(r&130023424)===r&&(t=JN+500-an(),10<t)){if(YE(e,0)!==0)break;if(n=e.suspendedLanes,(n&r)!==r){ga(),e.pingedLanes|=e.suspendedLanes&n;break}e.timeoutHandle=oL(Fp.bind(null,e,Ra,Pu),t);break}Fp(e,Ra,Pu);break;case 4:if(dd(e,r),(r&4194240)===r)break;for(t=e.eventTimes,n=-1;0<r;){var a=31-zl(r);s=1<<a,a=t[a],a>n&&(n=a),r&=~s}if(r=n,r=an()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Jse(r/1960))-r,10<r){e.timeoutHandle=oL(Fp.bind(null,e,Ra,Pu),r);break}Fp(e,Ra,Pu);break;case 5:Fp(e,Ra,Pu);break;default:throw Error(mt(329))}}}return Ga(e,an()),e.callbackNode===i?rY.bind(null,e):null}function CL(e,t){var i=Fx;return e.current.memoizedState.isDehydrated&&(wf(e,t).flags|=256),e=dA(e,t),e!==2&&(t=Ra,Ra=i,t!==null&&TL(t)),e}function TL(e){Ra===null?Ra=e:Ra.push.apply(Ra,e)}function eae(e){for(var t=e;;){if(t.flags&16384){var i=t.updateQueue;if(i!==null&&(i=i.stores,i!==null))for(var r=0;r<i.length;r++){var n=i[r],s=n.getSnapshot;n=n.value;try{if(!Ul(s(),n))return!1}catch{return!1}}}if(i=t.child,t.subtreeFlags&16384&&i!==null)i.return=t,t=i;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function dd(e,t){for(t&=~$N,t&=~mT,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var i=31-zl(t),r=1<<i;e[i]=-1,t&=~r}}function z5(e){if(Bi&6)throw Error(mt(327));wv();var t=YE(e,0);if(!(t&1))return Ga(e,an()),null;var i=dA(e,t);if(e.tag!==0&&i===2){var r=JI(e);r!==0&&(t=r,i=CL(e,r))}if(i===1)throw i=D1,wf(e,0),dd(e,t),Ga(e,an()),i;if(i===6)throw Error(mt(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Fp(e,Ra,Pu),Ga(e,an()),null}function eB(e,t){var i=Bi;Bi|=1;try{return e(t)}finally{Bi=i,Bi===0&&(jv=an()+500,hT&&tp())}}function Ff(e){wd!==null&&wd.tag===0&&!(Bi&6)&&wv();var t=Bi;Bi|=1;var i=Zo.transition,r=or;try{if(Zo.transition=null,or=1,e)return e()}finally{or=r,Zo.transition=i,Bi=t,!(Bi&6)&&tp()}}function tB(){so=ev.current,Cr(ev)}function wf(e,t){e.finishedWork=null,e.finishedLanes=0;var i=e.timeoutHandle;if(i!==-1&&(e.timeoutHandle=-1,Dse(i)),wn!==null)for(i=wn.return;i!==null;){var r=i;switch(zN(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&JE();break;case 3:Hv(),Cr(Va),Cr($s),jN();break;case 5:GN(r);break;case 4:Hv();break;case 13:Cr(Ir);break;case 19:Cr(Ir);break;case 10:UN(r.type._context);break;case 22:case 23:tB()}i=i.return}if(ls=e,wn=e=kd(e.current,null),Ms=so=t,kn=0,D1=null,$N=mT=Uf=0,Ra=Fx=null,rf!==null){for(t=0;t<rf.length;t++)if(i=rf[t],r=i.interleaved,r!==null){i.interleaved=null;var n=r.next,s=i.pending;if(s!==null){var a=s.next;s.next=n,r.next=a}i.pending=r}rf=null}return e}function nY(e,t){do{var i=wn;try{if(kN(),sE.current=lA,oA){for(var r=Nr.memoizedState;r!==null;){var n=r.queue;n!==null&&(n.pending=null),r=r.next}oA=!1}if(kf=0,$n=On=Nr=null,kx=!1,C1=0,ZN.current=null,i===null||i.return===null){kn=1,D1=t,wn=null;break}e:{var s=e,a=i.return,o=i,l=t;if(t=Ms,o.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=o,h=u.tag;if(!(u.mode&1)&&(h===0||h===11||h===15)){var d=u.alternate;d?(u.updateQueue=d.updateQueue,u.memoizedState=d.memoizedState,u.lanes=d.lanes):(u.updateQueue=null,u.memoizedState=null)}var p=_5(a);if(p!==null){p.flags&=-257,S5(p,a,o,s,t),p.mode&1&&b5(s,c,t),t=p,l=c;var f=t.updateQueue;if(f===null){var v=new Set;v.add(l),t.updateQueue=v}else f.add(l);break e}else{if(!(t&1)){b5(s,c,t),iB();break e}l=Error(mt(426))}}else if(Dr&&o.mode&1){var g=_5(a);if(g!==null){!(g.flags&65536)&&(g.flags|=256),S5(g,a,o,s,t),NN(Gv(l,o));break e}}s=l=Gv(l,o),kn!==4&&(kn=2),Fx===null?Fx=[s]:Fx.push(s),s=a;do{switch(s.tag){case 3:s.flags|=65536,t&=-t,s.lanes|=t;var m=Vq(s,l,t);m5(s,m);break e;case 1:o=l;var x=s.type,w=s.stateNode;if(!(s.flags&128)&&(typeof x.getDerivedStateFromError=="function"||w!==null&&typeof w.componentDidCatch=="function"&&(Nd===null||!Nd.has(w)))){s.flags|=65536,t&=-t,s.lanes|=t;var _=Hq(s,o,t);m5(s,_);break e}}s=s.return}while(s!==null)}oY(i)}catch(M){t=M,wn===i&&i!==null&&(wn=i=i.return);continue}break}while(!0)}function sY(){var e=cA.current;return cA.current=lA,e===null?lA:e}function iB(){(kn===0||kn===3||kn===2)&&(kn=4),ls===null||!(Uf&268435455)&&!(mT&268435455)||dd(ls,Ms)}function dA(e,t){var i=Bi;Bi|=2;var r=sY();(ls!==e||Ms!==t)&&(Pu=null,wf(e,t));do try{tae();break}catch(n){nY(e,n)}while(!0);if(kN(),Bi=i,cA.current=r,wn!==null)throw Error(mt(261));return ls=null,Ms=0,kn}function tae(){for(;wn!==null;)aY(wn)}function iae(){for(;wn!==null&&!Cne();)aY(wn)}function aY(e){var t=cY(e.alternate,e,so);e.memoizedProps=e.pendingProps,t===null?oY(e):wn=t,ZN.current=null}function oY(e){var t=e;do{var i=t.alternate;if(e=t.return,t.flags&32768){if(i=Qse(i,t),i!==null){i.flags&=32767,wn=i;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{kn=6,wn=null;return}}else if(i=Yse(i,t,so),i!==null){wn=i;return}if(t=t.sibling,t!==null){wn=t;return}wn=t=e}while(t!==null);kn===0&&(kn=5)}function Fp(e,t,i){var r=or,n=Zo.transition;try{Zo.transition=null,or=1,rae(e,t,i,r)}finally{Zo.transition=n,or=r}return null}function rae(e,t,i,r){do wv();while(wd!==null);if(Bi&6)throw Error(mt(327));i=e.finishedWork;var n=e.finishedLanes;if(i===null)return null;if(e.finishedWork=null,e.finishedLanes=0,i===e.current)throw Error(mt(177));e.callbackNode=null,e.callbackPriority=0;var s=i.lanes|i.childLanes;if(Bne(e,s),e===ls&&(wn=ls=null,Ms=0),!(i.subtreeFlags&2064)&&!(i.flags&2064)||b_||(b_=!0,uY(qE,function(){return wv(),null})),s=(i.flags&15990)!==0,i.subtreeFlags&15990||s){s=Zo.transition,Zo.transition=null;var a=or;or=1;var o=Bi;Bi|=4,ZN.current=null,Zse(e,i),tY(i,e),Sse(sL),QE=!!nL,sL=nL=null,e.current=i,$se(i),Tne(),Bi=o,or=a,Zo.transition=s}else e.current=i;if(b_&&(b_=!1,wd=e,hA=n),s=e.pendingLanes,s===0&&(Nd=null),Rne(i.stateNode),Ga(e,an()),t!==null)for(r=e.onRecoverableError,i=0;i<t.length;i++)n=t[i],r(n.value,{componentStack:n.stack,digest:n.digest});if(uA)throw uA=!1,e=EL,EL=null,e;return hA&1&&e.tag!==0&&wv(),s=e.pendingLanes,s&1?e===AL?Vx++:(Vx=0,AL=e):Vx=0,tp(),null}function wv(){if(wd!==null){var e=VX(hA),t=Zo.transition,i=or;try{if(Zo.transition=null,or=16>e?16:e,wd===null)var r=!1;else{if(e=wd,wd=null,hA=0,Bi&6)throw Error(mt(331));var n=Bi;for(Bi|=4,It=e.current;It!==null;){var s=It,a=s.child;if(It.flags&16){var o=s.deletions;if(o!==null){for(var l=0;l<o.length;l++){var c=o[l];for(It=c;It!==null;){var u=It;switch(u.tag){case 0:case 11:case 15:Ux(8,u,s)}var h=u.child;if(h!==null)h.return=u,It=h;else for(;It!==null;){u=It;var d=u.sibling,p=u.return;if($q(u),u===c){It=null;break}if(d!==null){d.return=p,It=d;break}It=p}}}var f=s.alternate;if(f!==null){var v=f.child;if(v!==null){f.child=null;do{var g=v.sibling;v.sibling=null,v=g}while(v!==null)}}It=s}}if(s.subtreeFlags&2064&&a!==null)a.return=s,It=a;else e:for(;It!==null;){if(s=It,s.flags&2048)switch(s.tag){case 0:case 11:case 15:Ux(9,s,s.return)}var m=s.sibling;if(m!==null){m.return=s.return,It=m;break e}It=s.return}}var x=e.current;for(It=x;It!==null;){a=It;var w=a.child;if(a.subtreeFlags&2064&&w!==null)w.return=a,It=w;else e:for(a=x;It!==null;){if(o=It,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:fT(9,o)}}catch(M){qr(o,o.return,M)}if(o===a){It=null;break e}var _=o.sibling;if(_!==null){_.return=o.return,It=_;break e}It=o.return}}if(Bi=n,tp(),Nc&&typeof Nc.onPostCommitFiberRoot=="function")try{Nc.onPostCommitFiberRoot(aT,e)}catch{}r=!0}return r}finally{or=i,Zo.transition=t}}return!1}function N5(e,t,i){t=Gv(i,t),t=Vq(e,t,1),e=zd(e,t,1),t=ga(),e!==null&&(Pw(e,1,t),Ga(e,t))}function qr(e,t,i){if(e.tag===3)N5(e,e,i);else for(;t!==null;){if(t.tag===3){N5(t,e,i);break}else if(t.tag===1){var r=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Nd===null||!Nd.has(r))){e=Gv(i,e),e=Hq(t,e,1),t=zd(t,e,1),e=ga(),t!==null&&(Pw(t,1,e),Ga(t,e));break}}t=t.return}}function nae(e,t,i){var r=e.pingCache;r!==null&&r.delete(t),t=ga(),e.pingedLanes|=e.suspendedLanes&i,ls===e&&(Ms&i)===i&&(kn===4||kn===3&&(Ms&130023424)===Ms&&500>an()-JN?wf(e,0):$N|=i),Ga(e,t)}function lY(e,t){t===0&&(e.mode&1?(t=h_,h_<<=1,!(h_&130023424)&&(h_=4194304)):t=1);var i=ga();e=oh(e,t),e!==null&&(Pw(e,t,i),Ga(e,i))}function sae(e){var t=e.memoizedState,i=0;t!==null&&(i=t.retryLane),lY(e,i)}function aae(e,t){var i=0;switch(e.tag){case 13:var r=e.stateNode,n=e.memoizedState;n!==null&&(i=n.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(mt(314))}r!==null&&r.delete(t),lY(e,i)}var cY;cY=function(e,t,i){if(e!==null)if(e.memoizedProps!==t.pendingProps||Va.current)Na=!0;else{if(!(e.lanes&i)&&!(t.flags&128))return Na=!1,qse(e,t,i);Na=!!(e.flags&131072)}else Na=!1,Dr&&t.flags&1048576&&pq(t,iA,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;oE(e,t),e=t.pendingProps;var n=Uv(t,$s.current);xv(t,i),n=XN(null,t,r,e,n,i);var s=qN();return t.flags|=1,typeof n=="object"&&n!==null&&typeof n.render=="function"&&n.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Ha(r)?(s=!0,eA(t)):s=!1,t.memoizedState=n.state!==null&&n.state!==void 0?n.state:null,VN(t),n.updater=pT,t.stateNode=n,n._reactInternals=t,fL(t,r,e,i),t=vL(null,t,r,!0,s,i)):(t.tag=0,Dr&&s&&ON(t),ua(null,t,n,i),t=t.child),t;case 16:r=t.elementType;e:{switch(oE(e,t),e=t.pendingProps,n=r._init,r=n(r._payload),t.type=r,n=t.tag=lae(r),e=Ml(r,e),n){case 0:t=gL(null,t,r,e,i);break e;case 1:t=A5(null,t,r,e,i);break e;case 11:t=M5(null,t,r,e,i);break e;case 14:t=E5(null,t,r,Ml(r.type,e),i);break e}throw Error(mt(306,r,""))}return t;case 0:return r=t.type,n=t.pendingProps,n=t.elementType===r?n:Ml(r,n),gL(e,t,r,n,i);case 1:return r=t.type,n=t.pendingProps,n=t.elementType===r?n:Ml(r,n),A5(e,t,r,n,i);case 3:e:{if(Xq(t),e===null)throw Error(mt(387));r=t.pendingProps,s=t.memoizedState,n=s.element,xq(e,t),sA(t,r,null,i);var a=t.memoizedState;if(r=a.element,s.isDehydrated)if(s={element:r,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},t.updateQueue.baseState=s,t.memoizedState=s,t.flags&256){n=Gv(Error(mt(423)),t),t=C5(e,t,r,i,n);break e}else if(r!==n){n=Gv(Error(mt(424)),t),t=C5(e,t,r,i,n);break e}else for(co=Od(t.stateNode.containerInfo.firstChild),ho=t,Dr=!0,Cl=null,i=vq(t,null,r,i),t.child=i;i;)i.flags=i.flags&-3|4096,i=i.sibling;else{if(Fv(),r===n){t=lh(e,t,i);break e}ua(e,t,r,i)}t=t.child}return t;case 5:return wq(t),e===null&&hL(t),r=t.type,n=t.pendingProps,s=e!==null?e.memoizedProps:null,a=n.children,aL(r,n)?a=null:s!==null&&aL(r,s)&&(t.flags|=32),Wq(e,t),ua(e,t,a,i),t.child;case 6:return e===null&&hL(t),null;case 13:return qq(e,t,i);case 4:return HN(t,t.stateNode.containerInfo),r=t.pendingProps,e===null?t.child=Vv(t,null,r,i):ua(e,t,r,i),t.child;case 11:return r=t.type,n=t.pendingProps,n=t.elementType===r?n:Ml(r,n),M5(e,t,r,n,i);case 7:return ua(e,t,t.pendingProps,i),t.child;case 8:return ua(e,t,t.pendingProps.children,i),t.child;case 12:return ua(e,t,t.pendingProps.children,i),t.child;case 10:e:{if(r=t.type._context,n=t.pendingProps,s=t.memoizedProps,a=n.value,wr(rA,r._currentValue),r._currentValue=a,s!==null)if(Ul(s.value,a)){if(s.children===n.children&&!Va.current){t=lh(e,t,i);break e}}else for(s=t.child,s!==null&&(s.return=t);s!==null;){var o=s.dependencies;if(o!==null){a=s.child;for(var l=o.firstContext;l!==null;){if(l.context===r){if(s.tag===1){l=eh(-1,i&-i),l.tag=2;var c=s.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}s.lanes|=i,l=s.alternate,l!==null&&(l.lanes|=i),dL(s.return,i,t),o.lanes|=i;break}l=l.next}}else if(s.tag===10)a=s.type===t.type?null:s.child;else if(s.tag===18){if(a=s.return,a===null)throw Error(mt(341));a.lanes|=i,o=a.alternate,o!==null&&(o.lanes|=i),dL(a,i,t),a=s.sibling}else a=s.child;if(a!==null)a.return=s;else for(a=s;a!==null;){if(a===t){a=null;break}if(s=a.sibling,s!==null){s.return=a.return,a=s;break}a=a.return}s=a}ua(e,t,n.children,i),t=t.child}return t;case 9:return n=t.type,r=t.pendingProps.children,xv(t,i),n=tl(n),r=r(n),t.flags|=1,ua(e,t,r,i),t.child;case 14:return r=t.type,n=Ml(r,t.pendingProps),n=Ml(r.type,n),E5(e,t,r,n,i);case 15:return Gq(e,t,t.type,t.pendingProps,i);case 17:return r=t.type,n=t.pendingProps,n=t.elementType===r?n:Ml(r,n),oE(e,t),t.tag=1,Ha(r)?(e=!0,eA(t)):e=!1,xv(t,i),Fq(t,r,n),fL(t,r,n,i),vL(null,t,r,!0,e,i);case 19:return Yq(e,t,i);case 22:return jq(e,t,i)}throw Error(mt(156,t.tag))};function uY(e,t){return BX(e,t)}function oae(e,t,i,r){this.tag=e,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function qo(e,t,i,r){return new oae(e,t,i,r)}function rB(e){return e=e.prototype,!(!e||!e.isReactComponent)}function lae(e){if(typeof e=="function")return rB(e)?1:0;if(e!=null){if(e=e.$$typeof,e===_N)return 11;if(e===SN)return 14}return 2}function kd(e,t){var i=e.alternate;return i===null?(i=qo(e.tag,t,e.key,e.mode),i.elementType=e.elementType,i.type=e.type,i.stateNode=e.stateNode,i.alternate=e,e.alternate=i):(i.pendingProps=t,i.type=e.type,i.flags=0,i.subtreeFlags=0,i.deletions=null),i.flags=e.flags&14680064,i.childLanes=e.childLanes,i.lanes=e.lanes,i.child=e.child,i.memoizedProps=e.memoizedProps,i.memoizedState=e.memoizedState,i.updateQueue=e.updateQueue,t=e.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},i.sibling=e.sibling,i.index=e.index,i.ref=e.ref,i}function uE(e,t,i,r,n,s){var a=2;if(r=e,typeof e=="function")rB(e)&&(a=1);else if(typeof e=="string")a=5;else e:switch(e){case jg:return bf(i.children,n,s,t);case bN:a=8,n|=8;break;case kI:return e=qo(12,i,t,n|2),e.elementType=kI,e.lanes=s,e;case UI:return e=qo(13,i,t,n),e.elementType=UI,e.lanes=s,e;case FI:return e=qo(19,i,t,n),e.elementType=FI,e.lanes=s,e;case wX:return gT(i,n,s,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case yX:a=10;break e;case xX:a=9;break e;case _N:a=11;break e;case SN:a=14;break e;case od:a=16,r=null;break e}throw Error(mt(130,e==null?e:typeof e,""))}return t=qo(a,i,t,n),t.elementType=e,t.type=r,t.lanes=s,t}function bf(e,t,i,r){return e=qo(7,e,r,t),e.lanes=i,e}function gT(e,t,i,r){return e=qo(22,e,r,t),e.elementType=wX,e.lanes=i,e.stateNode={isHidden:!1},e}function xD(e,t,i){return e=qo(6,e,null,t),e.lanes=i,e}function wD(e,t,i){return t=qo(4,e.children!==null?e.children:[],e.key,t),t.lanes=i,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function cae(e,t,i,r,n){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=eD(0),this.expirationTimes=eD(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=eD(0),this.identifierPrefix=r,this.onRecoverableError=n,this.mutableSourceEagerHydrationData=null}function nB(e,t,i,r,n,s,a,o,l){return e=new cae(e,t,i,o,l),t===1?(t=1,s===!0&&(t|=8)):t=0,s=qo(3,null,null,t),e.current=s,s.stateNode=e,s.memoizedState={element:r,isDehydrated:i,cache:null,transitions:null,pendingSuspenseBoundaries:null},VN(s),e}function uae(e,t,i){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Gg,key:r==null?null:""+r,children:e,containerInfo:t,implementation:i}}function hY(e){if(!e)return Wd;e=e._reactInternals;e:{if(em(e)!==e||e.tag!==1)throw Error(mt(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Ha(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(mt(171))}if(e.tag===1){var i=e.type;if(Ha(i))return hq(e,i,t)}return t}function dY(e,t,i,r,n,s,a,o,l){return e=nB(i,r,!0,e,n,s,a,o,l),e.context=hY(null),i=e.current,r=ga(),n=Bd(i),s=eh(r,n),s.callback=t??null,zd(i,s,n),e.current.lanes=n,Pw(e,n,r),Ga(e,r),e}function vT(e,t,i,r){var n=t.current,s=ga(),a=Bd(n);return i=hY(i),t.context===null?t.context=i:t.pendingContext=i,t=eh(s,a),t.payload={element:e},r=r===void 0?null:r,r!==null&&(t.callback=r),e=zd(n,t,a),e!==null&&(Nl(e,n,a,s),nE(e,n,a)),a}function pA(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function B5(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var i=e.retryLane;e.retryLane=i!==0&&i<t?i:t}}function sB(e,t){B5(e,t),(e=e.alternate)&&B5(e,t)}function hae(){return null}var pY=typeof reportError=="function"?reportError:function(e){console.error(e)};function aB(e){this._internalRoot=e}yT.prototype.render=aB.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(mt(409));vT(e,t,null,null)};yT.prototype.unmount=aB.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Ff(function(){vT(null,e,null,null)}),t[ah]=null}};function yT(e){this._internalRoot=e}yT.prototype.unstable_scheduleHydration=function(e){if(e){var t=jX();e={blockedOn:null,target:e,priority:t};for(var i=0;i<hd.length&&t!==0&&t<hd[i].priority;i++);hd.splice(i,0,e),i===0&&XX(e)}};function oB(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function xT(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function k5(){}function dae(e,t,i,r,n){if(n){if(typeof r=="function"){var s=r;r=function(){var c=pA(a);s.call(c)}}var a=dY(t,r,e,0,null,!1,!1,"",k5);return e._reactRootContainer=a,e[ah]=a.current,_1(e.nodeType===8?e.parentNode:e),Ff(),a}for(;n=e.lastChild;)e.removeChild(n);if(typeof r=="function"){var o=r;r=function(){var c=pA(l);o.call(c)}}var l=nB(e,0,!1,null,null,!1,!1,"",k5);return e._reactRootContainer=l,e[ah]=l.current,_1(e.nodeType===8?e.parentNode:e),Ff(function(){vT(t,l,i,r)}),l}function wT(e,t,i,r,n){var s=i._reactRootContainer;if(s){var a=s;if(typeof n=="function"){var o=n;n=function(){var l=pA(a);o.call(l)}}vT(t,a,e,n)}else a=dae(i,t,e,n,r);return pA(a)}HX=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var i=gx(t.pendingLanes);i!==0&&(AN(t,i|1),Ga(t,an()),!(Bi&6)&&(jv=an()+500,tp()))}break;case 13:Ff(function(){var r=oh(e,1);if(r!==null){var n=ga();Nl(r,e,1,n)}}),sB(e,1)}};CN=function(e){if(e.tag===13){var t=oh(e,134217728);if(t!==null){var i=ga();Nl(t,e,134217728,i)}sB(e,134217728)}};GX=function(e){if(e.tag===13){var t=Bd(e),i=oh(e,t);if(i!==null){var r=ga();Nl(i,e,t,r)}sB(e,t)}};jX=function(){return or};WX=function(e,t){var i=or;try{return or=e,t()}finally{or=i}};KI=function(e,t,i){switch(t){case"input":if(GI(e,i),t=i.name,i.type==="radio"&&t!=null){for(i=e;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<i.length;t++){var r=i[t];if(r!==e&&r.form===e.form){var n=uT(r);if(!n)throw Error(mt(90));_X(r),GI(r,n)}}}break;case"textarea":MX(e,i);break;case"select":t=i.value,t!=null&&mv(e,!!i.multiple,t,!1)}};RX=eB;IX=Ff;var pae={usingClientEntryPoint:!1,Events:[Rw,Yg,uT,PX,DX,eB]},yy={findFiberByHostInstance:tf,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},fae={bundleType:yy.bundleType,version:yy.version,rendererPackageName:yy.rendererPackageName,rendererConfig:yy.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:bh.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=zX(e),e===null?null:e.stateNode},findFiberByHostInstance:yy.findFiberByHostInstance||hae,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var __=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!__.isDisabled&&__.supportsFiber)try{aT=__.inject(fae),Nc=__}catch{}}xo.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=pae;xo.createPortal=function(e,t){var i=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!oB(t))throw Error(mt(200));return uae(e,t,null,i)};xo.createRoot=function(e,t){if(!oB(e))throw Error(mt(299));var i=!1,r="",n=pY;return t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(r=t.identifierPrefix),t.onRecoverableError!==void 0&&(n=t.onRecoverableError)),t=nB(e,1,!1,null,null,i,!1,r,n),e[ah]=t.current,_1(e.nodeType===8?e.parentNode:e),new aB(t)};xo.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(mt(188)):(e=Object.keys(e).join(","),Error(mt(268,e)));return e=zX(t),e=e===null?null:e.stateNode,e};xo.flushSync=function(e){return Ff(e)};xo.hydrate=function(e,t,i){if(!xT(t))throw Error(mt(200));return wT(null,e,t,!0,i)};xo.hydrateRoot=function(e,t,i){if(!oB(e))throw Error(mt(405));var r=i!=null&&i.hydratedSources||null,n=!1,s="",a=pY;if(i!=null&&(i.unstable_strictMode===!0&&(n=!0),i.identifierPrefix!==void 0&&(s=i.identifierPrefix),i.onRecoverableError!==void 0&&(a=i.onRecoverableError)),t=dY(t,null,e,1,i??null,n,!1,s,a),e[ah]=t.current,_1(e),r)for(e=0;e<r.length;e++)i=r[e],n=i._getVersion,n=n(i._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[i,n]:t.mutableSourceEagerHydrationData.push(i,n);return new yT(t)};xo.render=function(e,t,i){if(!xT(t))throw Error(mt(200));return wT(null,e,t,!1,i)};xo.unmountComponentAtNode=function(e){if(!xT(e))throw Error(mt(40));return e._reactRootContainer?(Ff(function(){wT(null,null,e,!1,function(){e._reactRootContainer=null,e[ah]=null})}),!0):!1};xo.unstable_batchedUpdates=eB;xo.unstable_renderSubtreeIntoContainer=function(e,t,i,r){if(!xT(i))throw Error(mt(200));if(e==null||e._reactInternals===void 0)throw Error(mt(38));return wT(e,t,i,!1,r)};xo.version="18.3.1-next-f1338f8080-20240426";function fY(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(fY)}catch(e){console.error(e)}}fY(),fX.exports=xo;var mae=fX.exports,mY,U5=mae;mY=U5.createRoot,U5.hydrateRoot;const gae="modulepreload",vae=function(e){return"/3D_react/"+e},F5={},ip=function(t,i,r){let n=Promise.resolve();if(i&&i.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),o=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));n=Promise.allSettled(i.map(l=>{if(l=vae(l),l in F5)return;F5[l]=!0;const c=l.endsWith(".css"),u=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${u}`))return;const h=document.createElement("link");if(h.rel=c?"stylesheet":gae,c||(h.as="script"),h.crossOrigin="",h.href=l,o&&h.setAttribute("nonce",o),document.head.appendChild(h),c)return new Promise((d,p)=>{h.addEventListener("load",d),h.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${l}`)))})}))}function s(a){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a}return n.then(a=>{for(const o of a||[])o.status==="rejected"&&s(o.reason);return t().catch(s)})};var yae=Object.create,bT=Object.defineProperty,xae=Object.getOwnPropertyDescriptor,wae=Object.getOwnPropertyNames,bae=Object.getPrototypeOf,_ae=Object.prototype.hasOwnProperty,Sae=(e,t,i)=>t in e?bT(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,_h=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),Mae=(e,t)=>{for(var i in t)bT(e,i,{get:t[i],enumerable:!0})},Eae=(e,t,i,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of wae(t))!_ae.call(e,n)&&n!==i&&bT(e,n,{get:()=>t[n],enumerable:!(r=xae(t,n))||r.enumerable});return e},Sh=(e,t,i)=>(i=e!=null?yae(bae(e)):{},Eae(t||!e||!e.__esModule?bT(i,"default",{value:e,enumerable:!0}):i,e)),yx=(e,t,i)=>(Sae(e,typeof t!="symbol"?t+"":t,i),i),Aae=_h((e,t)=>{(function(i,r){typeof e=="object"?t.exports=r():typeof define=="function"&&define.amd?define(r):i.Alea=r()})(e,function(){return i.importState=function(n){var s=new i;return s.importState(n),s},i;function i(){return function(n){var s=0,a=0,o=0,l=1;n.length==0&&(n=[+new Date]);var c=r();s=c(" "),a=c(" "),o=c(" ");for(var u=0;u<n.length;u++)s-=c(n[u]),s<0&&(s+=1),a-=c(n[u]),a<0&&(a+=1),o-=c(n[u]),o<0&&(o+=1);c=null;var h=function(){var d=2091639*s+l*23283064365386963e-26;return s=a,a=o,o=d-(l=d|0)};return h.next=h,h.uint32=function(){return h()*4294967296},h.fract53=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.version="Alea 0.9",h.args=n,h.exportState=function(){return[s,a,o,l]},h.importState=function(d){s=+d[0]||0,a=+d[1]||0,o=+d[2]||0,l=+d[3]||0},h}(Array.prototype.slice.call(arguments))}function r(){var n=4022871197,s=function(a){a=a.toString();for(var o=0;o<a.length;o++){n+=a.charCodeAt(o);var l=.02519603282416938*n;n=l>>>0,l-=n,l*=n,n=l>>>0,l-=n,n+=l*4294967296}return(n>>>0)*23283064365386963e-26};return s.version="Mash 0.9",s}})}),gY=_h((e,t)=>{(function(i,r){typeof e=="object"&&typeof t<"u"?r(e):typeof define=="function"&&define.amd?define(["exports"],r):r((i=typeof globalThis<"u"?globalThis:i||self).SVDJS={})})(e,function(i){i.SVD=function(r,n,s,a,o){if(n=n===void 0||n,s=s===void 0||s,o=1e-64/(a=a||Math.pow(2,-52)),!r)throw new TypeError("Matrix a is not defined");var l,c,u,h,d,p,f,v,g,m,x,w,_=r[0].length,M=r.length;if(M<_)throw new TypeError("Invalid matrix: m < n");for(var S=[],A=[],T=[],E=n==="f"?M:_,C=m=f=0;C<M;C++)A[C]=new Array(E).fill(0);for(C=0;C<_;C++)T[C]=new Array(_).fill(0);var D,I=new Array(_).fill(0);for(C=0;C<M;C++)for(l=0;l<_;l++)A[C][l]=r[C][l];for(C=0;C<_;C++){for(S[C]=f,g=0,u=C+1,l=C;l<M;l++)g+=Math.pow(A[l][C],2);if(g<o)f=0;else for(v=(p=A[C][C])*(f=p<0?Math.sqrt(g):-Math.sqrt(g))-g,A[C][C]=p-f,l=u;l<_;l++){for(g=0,c=C;c<M;c++)g+=A[c][C]*A[c][l];for(p=g/v,c=C;c<M;c++)A[c][l]=A[c][l]+p*A[c][C]}for(I[C]=f,g=0,l=u;l<_;l++)g+=Math.pow(A[C][l],2);if(g<o)f=0;else{for(v=(p=A[C][C+1])*(f=p<0?Math.sqrt(g):-Math.sqrt(g))-g,A[C][C+1]=p-f,l=u;l<_;l++)S[l]=A[C][l]/v;for(l=u;l<M;l++){for(g=0,c=u;c<_;c++)g+=A[l][c]*A[C][c];for(c=u;c<_;c++)A[l][c]=A[l][c]+g*S[c]}}m<(x=Math.abs(I[C])+Math.abs(S[C]))&&(m=x)}if(s)for(C=_-1;0<=C;C--){if(f!==0){for(v=A[C][C+1]*f,l=u;l<_;l++)T[l][C]=A[C][l]/v;for(l=u;l<_;l++){for(g=0,c=u;c<_;c++)g+=A[C][c]*T[c][l];for(c=u;c<_;c++)T[c][l]=T[c][l]+g*T[c][C]}}for(l=u;l<_;l++)T[C][l]=0,T[l][C]=0;T[C][C]=1,f=S[C],u=C}if(n){if(n==="f")for(C=_;C<M;C++){for(l=_;l<M;l++)A[C][l]=0;A[C][C]=1}for(C=_-1;0<=C;C--){for(u=C+1,f=I[C],l=u;l<E;l++)A[C][l]=0;if(f!==0){for(v=A[C][C]*f,l=u;l<E;l++){for(g=0,c=u;c<M;c++)g+=A[c][C]*A[c][l];for(p=g/v,c=C;c<M;c++)A[c][l]=A[c][l]+p*A[c][C]}for(l=C;l<M;l++)A[l][C]=A[l][C]/f}else for(l=C;l<M;l++)A[l][C]=0;A[C][C]=A[C][C]+1}}for(a*=m,c=_-1;0<=c;c--)for(var L=0;L<50;L++){for(D=!1,u=c;0<=u;u--){if(Math.abs(S[u])<=a){D=!0;break}if(Math.abs(I[u-1])<=a)break}if(!D){for(d=0,h=u-(g=1),C=u;C<c+1&&(p=g*S[C],S[C]=d*S[C],!(Math.abs(p)<=a));C++)if(f=I[C],I[C]=Math.sqrt(p*p+f*f),d=f/(v=I[C]),g=-p/v,n)for(l=0;l<M;l++)x=A[l][h],w=A[l][C],A[l][h]=x*d+w*g,A[l][C]=-x*g+w*d}if(w=I[c],u===c){if(w<0&&(I[c]=-w,s))for(l=0;l<_;l++)T[l][c]=-T[l][c];break}for(m=I[u],p=(((x=I[c-1])-w)*(x+w)+((f=S[c-1])-(v=S[c]))*(f+v))/(2*v*x),f=Math.sqrt(p*p+1),p=((m-w)*(m+w)+v*(x/(p<0?p-f:p+f)-v))/m,C=u+(g=d=1);C<c+1;C++){if(f=S[C],x=I[C],v=g*f,f*=d,w=Math.sqrt(p*p+v*v),p=m*(d=p/(S[C-1]=w))+f*(g=v/w),f=-m*g+f*d,v=x*g,x*=d,s)for(l=0;l<_;l++)m=T[l][C-1],w=T[l][C],T[l][C-1]=m*d+w*g,T[l][C]=-m*g+w*d;if(w=Math.sqrt(p*p+v*v),p=(d=p/(I[C-1]=w))*f+(g=v/w)*x,m=-g*f+d*x,n)for(l=0;l<M;l++)x=A[l][C-1],w=A[l][C],A[l][C-1]=x*d+w*g,A[l][C]=-x*g+w*d}S[u]=0,S[c]=p,I[c]=m}for(C=0;C<_;C++)I[C]<a&&(I[C]=0);return{u:A,q:I,v:T}},i.VERSION="1.1.1",Object.defineProperty(i,"__esModule",{value:!0})})}),Cae=_h((e,t)=>{(function(i,r){typeof e=="object"&&typeof t<"u"?t.exports=r():typeof define=="function"&&define.amd?define(r):(i=i||self,i.TinyQueue=r())})(e,function(){var i=function(n,s){if(n===void 0&&(n=[]),s===void 0&&(s=r),this.data=n,this.length=this.data.length,this.compare=s,this.length>0)for(var a=(this.length>>1)-1;a>=0;a--)this._down(a)};i.prototype.push=function(n){this.data.push(n),this.length++,this._up(this.length-1)},i.prototype.pop=function(){if(this.length!==0){var n=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),n}},i.prototype.peek=function(){return this.data[0]},i.prototype._up=function(n){for(var s=this,a=s.data,o=s.compare,l=a[n];n>0;){var c=n-1>>1,u=a[c];if(o(l,u)>=0)break;a[n]=u,n=c}a[n]=l},i.prototype._down=function(n){for(var s=this,a=s.data,o=s.compare,l=this.length>>1,c=a[n];n<l;){var u=(n<<1)+1,h=a[u],d=u+1;if(d<this.length&&o(a[d],h)<0&&(u=d,h=a[d]),o(h,c)>=0)break;a[n]=h,n=u}a[n]=c};function r(n,s){return n<s?-1:n>s?1:0}return i})}),Tae=_h((e,t)=>{var i=Cae();i.default&&(i=i.default),t.exports=r,t.exports.default=r;function r(c,u,h){u=u||1;for(var d,p,f,v,g=0;g<c[0].length;g++){var m=c[0][g];(!g||m[0]<d)&&(d=m[0]),(!g||m[1]<p)&&(p=m[1]),(!g||m[0]>f)&&(f=m[0]),(!g||m[1]>v)&&(v=m[1])}var x=f-d,w=v-p,_=Math.min(x,w),M=_/2;if(_===0){var S=[d,p];return S.distance=0,S}for(var A=new i(void 0,n),T=d;T<f;T+=_)for(var E=p;E<v;E+=_)A.push(new s(T+M,E+M,M,c));var C=o(c),D=new s(d+x/2,p+w/2,0,c);D.d>C.d&&(C=D);for(var I=A.length;A.length;){var L=A.pop();L.d>C.d&&(C=L,h&&console.log("found best %d after %d probes",Math.round(1e4*L.d)/1e4,I)),!(L.max-C.d<=u)&&(M=L.h/2,A.push(new s(L.x-M,L.y-M,M,c)),A.push(new s(L.x+M,L.y-M,M,c)),A.push(new s(L.x-M,L.y+M,M,c)),A.push(new s(L.x+M,L.y+M,M,c)),I+=4)}h&&(console.log("num probes: "+I),console.log("best distance: "+C.d));var z=[C.x,C.y];return z.distance=C.d,z}function n(c,u){return u.max-c.max}function s(c,u,h,d){this.x=c,this.y=u,this.h=h,this.d=a(c,u,d),this.max=this.d+this.h*Math.SQRT2}function a(c,u,h){for(var d=!1,p=1/0,f=0;f<h.length;f++)for(var v=h[f],g=0,m=v.length,x=m-1;g<m;x=g++){var w=v[g],_=v[x];w[1]>u!=_[1]>u&&c<(_[0]-w[0])*(u-w[1])/(_[1]-w[1])+w[0]&&(d=!d),p=Math.min(p,l(c,u,w,_))}return p===0?0:(d?1:-1)*Math.sqrt(p)}function o(c){for(var u=0,h=0,d=0,p=c[0],f=0,v=p.length,g=v-1;f<v;g=f++){var m=p[f],x=p[g],w=m[0]*x[1]-x[0]*m[1];h+=(m[0]+x[0])*w,d+=(m[1]+x[1])*w,u+=w*3}return u===0?new s(p[0][0],p[0][1],0,c):new s(h/u,d/u,0,c)}function l(c,u,h,d){var p=h[0],f=h[1],v=d[0]-p,g=d[1]-f;if(v!==0||g!==0){var m=((c-p)*v+(u-f)*g)/(v*v+g*g);m>1?(p=d[0],f=d[1]):m>0&&(p+=v*m,f+=g*m)}return v=c-p,g=u-f,v*v+g*g}}),Pae=_h((e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=i;function i(r){if(r===null||r===!0||r===!1)return NaN;var n=Number(r);return isNaN(n)?n:n<0?Math.ceil(n):Math.floor(n)}t.exports=e.default}),Dae=_h((e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=i;function i(r){var n=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds()));return n.setUTCFullYear(r.getFullYear()),r.getTime()-n.getTime()}t.exports=e.default}),Rae=_h((e,t)=>{function i(s,a){function o(){this.constructor=s}o.prototype=a.prototype,s.prototype=new o}function r(s,a,o,l){this.message=s,this.expected=a,this.found=o,this.location=l,this.name="SyntaxError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,r)}i(r,Error),r.buildMessage=function(s,a){var o={literal:function(f){return'"'+c(f.text)+'"'},class:function(f){var v="",g;for(g=0;g<f.parts.length;g++)v+=f.parts[g]instanceof Array?u(f.parts[g][0])+"-"+u(f.parts[g][1]):u(f.parts[g]);return"["+(f.inverted?"^":"")+v+"]"},any:function(f){return"any character"},end:function(f){return"end of input"},other:function(f){return f.description}};function l(f){return f.charCodeAt(0).toString(16).toUpperCase()}function c(f){return f.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(v){return"\\x0"+l(v)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(v){return"\\x"+l(v)})}function u(f){return f.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(v){return"\\x0"+l(v)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(v){return"\\x"+l(v)})}function h(f){return o[f.type](f)}function d(f){var v=new Array(f.length),g,m;for(g=0;g<f.length;g++)v[g]=h(f[g]);if(v.sort(),v.length>0){for(g=1,m=1;g<v.length;g++)v[g-1]!==v[g]&&(v[m]=v[g],m++);v.length=m}switch(v.length){case 1:return v[0];case 2:return v[0]+" or "+v[1];default:return v.slice(0,-1).join(", ")+", or "+v[v.length-1]}}function p(f){return f?'"'+c(f)+'"':"end of input"}return"Expected "+d(s)+" but "+p(a)+" found."};function n(s,a){a=a!==void 0?a:{};var o={},l={svg_path:xe},c=xe,u=function(H){if(!H)return[];for(var q=[],me=0;me<H.length;me++)q=q.concat.apply(q,H[me]);var te=q[0];return te&&te.code=="m"&&(delete te.relative,te.code="M"),q},h=function(H,q){return gi(H,q)},d=/^[Mm]/,p=nt(["M","m"],!1,!1),f=function(H,q,me){var te=zi(H,[q]);return me&&(te=te.concat(zi(H=="M"?"L":"l",me[1]))),te},v=/^[Zz]/,g=nt(["Z","z"],!1,!1),m=function(){return zi("Z")},x=/^[Ll]/,w=nt(["L","l"],!1,!1),_=function(H,q){return zi(H,q)},M=/^[Hh]/,S=nt(["H","h"],!1,!1),A=function(H,q){return zi(H,q.map(function(me){return{x:me}}))},T=/^[Vv]/,E=nt(["V","v"],!1,!1),C=function(H,q){return zi(H,q.map(function(me){return{y:me}}))},D=/^[Cc]/,I=nt(["C","c"],!1,!1),L=function(H,q,me){return{x1:H.x,y1:H.y,x2:q.x,y2:q.y,x:me.x,y:me.y}},z=/^[Ss]/,F=nt(["S","s"],!1,!1),Q=function(H,q){return{x2:H.x,y2:H.y,x:q.x,y:q.y}},Y=/^[Qq]/,O=nt(["Q","q"],!1,!1),j=function(H,q){return{x1:H.x,y1:H.y,x:q.x,y:q.y}},V=/^[Tt]/,W=nt(["T","t"],!1,!1),J=/^[Aa]/,ce=nt(["A","a"],!1,!1),$=function(H,q,me,te,Ae,ut){return{rx:H,ry:q,xAxisRotation:me,largeArc:te,sweep:Ae,x:ut.x,y:ut.y}},ne=function(H,q){return{x:H,y:q}},ie=function(H){return H*1},de=function(H){return H.join("")*1},be=/^[01]/,we=nt(["0","1"],!1,!1),_e=function(H){return H=="1"},Me=function(){return""},X=",",ge=je(",",!1),Oe=function(H){return H.join("")},Ie=".",Pe=je(".",!1),Ye=/^[eE]/,ke=nt(["e","E"],!1,!1),Fe=/^[+\-]/,se=nt(["+","-"],!1,!1),Z=/^[0-9]/,K=nt([["0","9"]],!1,!1),k=function(H){return H.join("")},re=/^[ \t\n\r]/,he=nt([" ","	",`
`,"\r"],!1,!1),G=0,Te=[{line:1,column:1}],ze=0,Qe=[],ye;if("startRule"in a){if(!(a.startRule in l))throw new Error(`Can't start parsing from rule "`+a.startRule+'".');c=l[a.startRule]}function je(H,q){return{type:"literal",text:H,ignoreCase:q}}function nt(H,q,me){return{type:"class",parts:H,inverted:q,ignoreCase:me}}function ct(){return{type:"end"}}function tt(H){var q=Te[H],me;if(q)return q;for(me=H-1;!Te[me];)me--;for(q=Te[me],q={line:q.line,column:q.column};me<H;)s.charCodeAt(me)===10?(q.line++,q.column=1):q.column++,me++;return Te[H]=q,q}function ue(H,q){var me=tt(H),te=tt(q);return{start:{offset:H,line:me.line,column:me.column},end:{offset:q,line:te.line,column:te.column}}}function Ue(H){G<ze||(G>ze&&(ze=G,Qe=[]),Qe.push(H))}function dt(H,q,me){return new r(r.buildMessage(H,q),H,q,me)}function xe(){var H,q,me,te,Ae;for(H=G,q=[],me=ft();me!==o;)q.push(me),me=ft();if(q!==o)if(me=ae(),me===o&&(me=null),me!==o){for(te=[],Ae=ft();Ae!==o;)te.push(Ae),Ae=ft();te!==o?(q=u(me),H=q):(G=H,H=o)}else G=H,H=o;else G=H,H=o;return H}function ae(){var H,q,me,te,Ae,ut;if(H=G,q=fe(),q!==o){for(me=[],te=G,Ae=[],ut=ft();ut!==o;)Ae.push(ut),ut=ft();for(Ae!==o?(ut=fe(),ut!==o?(Ae=[Ae,ut],te=Ae):(G=te,te=o)):(G=te,te=o);te!==o;){for(me.push(te),te=G,Ae=[],ut=ft();ut!==o;)Ae.push(ut),ut=ft();Ae!==o?(ut=fe(),ut!==o?(Ae=[Ae,ut],te=Ae):(G=te,te=o)):(G=te,te=o)}me!==o?(q=h(q,me),H=q):(G=H,H=o)}else G=H,H=o;return H}function fe(){var H,q,me,te,Ae,ut;if(H=G,q=Ne(),q!==o){for(me=[],te=G,Ae=[],ut=ft();ut!==o;)Ae.push(ut),ut=ft();for(Ae!==o?(ut=Se(),ut!==o?(Ae=[Ae,ut],te=Ae):(G=te,te=o)):(G=te,te=o);te!==o;){for(me.push(te),te=G,Ae=[],ut=ft();ut!==o;)Ae.push(ut),ut=ft();Ae!==o?(ut=Se(),ut!==o?(Ae=[Ae,ut],te=Ae):(G=te,te=o)):(G=te,te=o)}me!==o?(q=h(q,me),H=q):(G=H,H=o)}else G=H,H=o;return H}function Se(){var H;return H=st(),H===o&&(H=vt(),H===o&&(H=Wt(),H===o&&(H=ci(),H===o&&(H=Ki(),H===o&&(H=eu(),H===o&&(H=le(),H===o&&(H=Ve(),H===o&&(H=Ot())))))))),H}function Ne(){var H,q,me,te,Ae,ut,Zi;if(H=G,d.test(s.charAt(G))?(q=s.charAt(G),G++):(q=o,Ue(p)),q!==o){for(me=[],te=ft();te!==o;)me.push(te),te=ft();me!==o?(te=ee(),te!==o?(Ae=G,ut=Ee(),ut===o&&(ut=null),ut!==o?(Zi=Ut(),Zi!==o?(ut=[ut,Zi],Ae=ut):(G=Ae,Ae=o)):(G=Ae,Ae=o),Ae===o&&(Ae=null),Ae!==o?(q=f(q,te,Ae),H=q):(G=H,H=o)):(G=H,H=o)):(G=H,H=o)}else G=H,H=o;return H}function st(){var H,q;return H=G,v.test(s.charAt(G))?(q=s.charAt(G),G++):(q=o,Ue(g)),q!==o&&(q=m()),H=q,H}function vt(){var H,q,me,te;if(H=G,x.test(s.charAt(G))?(q=s.charAt(G),G++):(q=o,Ue(w)),q!==o){for(me=[],te=ft();te!==o;)me.push(te),te=ft();me!==o?(te=Ut(),te!==o?(q=_(q,te),H=q):(G=H,H=o)):(G=H,H=o)}else G=H,H=o;return H}function Ut(){var H,q,me,te,Ae,ut;if(H=G,q=ee(),q!==o){for(me=[],te=G,Ae=Ee(),Ae===o&&(Ae=null),Ae!==o?(ut=ee(),ut!==o?(Ae=[Ae,ut],te=Ae):(G=te,te=o)):(G=te,te=o);te!==o;)me.push(te),te=G,Ae=Ee(),Ae===o&&(Ae=null),Ae!==o?(ut=ee(),ut!==o?(Ae=[Ae,ut],te=Ae):(G=te,te=o)):(G=te,te=o);me!==o?(q=h(q,me),H=q):(G=H,H=o)}else G=H,H=o;return H}function Wt(){var H,q,me,te;if(H=G,M.test(s.charAt(G))?(q=s.charAt(G),G++):(q=o,Ue(S)),q!==o){for(me=[],te=ft();te!==o;)me.push(te),te=ft();me!==o?(te=Jt(),te!==o?(q=A(q,te),H=q):(G=H,H=o)):(G=H,H=o)}else G=H,H=o;return H}function Jt(){var H,q,me,te,Ae,ut;if(H=G,q=De(),q!==o){for(me=[],te=G,Ae=Ee(),Ae===o&&(Ae=null),Ae!==o?(ut=De(),ut!==o?(Ae=[Ae,ut],te=Ae):(G=te,te=o)):(G=te,te=o);te!==o;)me.push(te),te=G,Ae=Ee(),Ae===o&&(Ae=null),Ae!==o?(ut=De(),ut!==o?(Ae=[Ae,ut],te=Ae):(G=te,te=o)):(G=te,te=o);me!==o?(q=h(q,me),H=q):(G=H,H=o)}else G=H,H=o;return H}function ci(){var H,q,me,te;if(H=G,T.test(s.charAt(G))?(q=s.charAt(G),G++):(q=o,Ue(E)),q!==o){for(me=[],te=ft();te!==o;)me.push(te),te=ft();me!==o?(te=Jt(),te!==o?(q=C(q,te),H=q):(G=H,H=o)):(G=H,H=o)}else G=H,H=o;return H}function Ki(){var H,q,me,te;if(H=G,D.test(s.charAt(G))?(q=s.charAt(G),G++):(q=o,Ue(I)),q!==o){for(me=[],te=ft();te!==o;)me.push(te),te=ft();me!==o?(te=Tn(),te!==o?(q=_(q,te),H=q):(G=H,H=o)):(G=H,H=o)}else G=H,H=o;return H}function Tn(){var H,q,me,te,Ae,ut;if(H=G,q=Ps(),q!==o){for(me=[],te=G,Ae=Ee(),Ae===o&&(Ae=null),Ae!==o?(ut=Ps(),ut!==o?(Ae=[Ae,ut],te=Ae):(G=te,te=o)):(G=te,te=o);te!==o;)me.push(te),te=G,Ae=Ee(),Ae===o&&(Ae=null),Ae!==o?(ut=Ps(),ut!==o?(Ae=[Ae,ut],te=Ae):(G=te,te=o)):(G=te,te=o);me!==o?(q=h(q,me),H=q):(G=H,H=o)}else G=H,H=o;return H}function Ps(){var H,q,me,te,Ae,ut;return H=G,q=ee(),q!==o?(me=Ee(),me===o&&(me=null),me!==o?(te=ee(),te!==o?(Ae=Ee(),Ae===o&&(Ae=null),Ae!==o?(ut=ee(),ut!==o?(q=L(q,te,ut),H=q):(G=H,H=o)):(G=H,H=o)):(G=H,H=o)):(G=H,H=o)):(G=H,H=o),H}function eu(){var H,q,me,te;if(H=G,z.test(s.charAt(G))?(q=s.charAt(G),G++):(q=o,Ue(F)),q!==o){for(me=[],te=ft();te!==o;)me.push(te),te=ft();me!==o?(te=tu(),te!==o?(q=_(q,te),H=q):(G=H,H=o)):(G=H,H=o)}else G=H,H=o;return H}function tu(){var H,q,me,te,Ae,ut;if(H=G,q=bo(),q!==o){for(me=[],te=G,Ae=Ee(),Ae===o&&(Ae=null),Ae!==o?(ut=bo(),ut!==o?(Ae=[Ae,ut],te=Ae):(G=te,te=o)):(G=te,te=o);te!==o;)me.push(te),te=G,Ae=Ee(),Ae===o&&(Ae=null),Ae!==o?(ut=bo(),ut!==o?(Ae=[Ae,ut],te=Ae):(G=te,te=o)):(G=te,te=o);me!==o?(q=h(q,me),H=q):(G=H,H=o)}else G=H,H=o;return H}function bo(){var H,q,me,te;return H=G,q=ee(),q!==o?(me=Ee(),me===o&&(me=null),me!==o?(te=ee(),te!==o?(q=Q(q,te),H=q):(G=H,H=o)):(G=H,H=o)):(G=H,H=o),H}function le(){var H,q,me,te;if(H=G,Y.test(s.charAt(G))?(q=s.charAt(G),G++):(q=o,Ue(O)),q!==o){for(me=[],te=ft();te!==o;)me.push(te),te=ft();me!==o?(te=Ge(),te!==o?(q=_(q,te),H=q):(G=H,H=o)):(G=H,H=o)}else G=H,H=o;return H}function Ge(){var H,q,me,te,Ae,ut;if(H=G,q=$e(),q!==o){for(me=[],te=G,Ae=Ee(),Ae===o&&(Ae=null),Ae!==o?(ut=$e(),ut!==o?(Ae=[Ae,ut],te=Ae):(G=te,te=o)):(G=te,te=o);te!==o;)me.push(te),te=G,Ae=Ee(),Ae===o&&(Ae=null),Ae!==o?(ut=$e(),ut!==o?(Ae=[Ae,ut],te=Ae):(G=te,te=o)):(G=te,te=o);me!==o?(q=h(q,me),H=q):(G=H,H=o)}else G=H,H=o;return H}function $e(){var H,q,me,te;return H=G,q=ee(),q!==o?(me=Ee(),me===o&&(me=null),me!==o?(te=ee(),te!==o?(q=j(q,te),H=q):(G=H,H=o)):(G=H,H=o)):(G=H,H=o),H}function Ve(){var H,q,me,te;if(H=G,V.test(s.charAt(G))?(q=s.charAt(G),G++):(q=o,Ue(W)),q!==o){for(me=[],te=ft();te!==o;)me.push(te),te=ft();me!==o?(te=et(),te!==o?(q=_(q,te),H=q):(G=H,H=o)):(G=H,H=o)}else G=H,H=o;return H}function et(){var H,q,me,te,Ae,ut;if(H=G,q=ee(),q!==o){for(me=[],te=G,Ae=Ee(),Ae===o&&(Ae=null),Ae!==o?(ut=ee(),ut!==o?(Ae=[Ae,ut],te=Ae):(G=te,te=o)):(G=te,te=o);te!==o;)me.push(te),te=G,Ae=Ee(),Ae===o&&(Ae=null),Ae!==o?(ut=ee(),ut!==o?(Ae=[Ae,ut],te=Ae):(G=te,te=o)):(G=te,te=o);me!==o?(q=h(q,me),H=q):(G=H,H=o)}else G=H,H=o;return H}function Ot(){var H,q,me,te;if(H=G,J.test(s.charAt(G))?(q=s.charAt(G),G++):(q=o,Ue(ce)),q!==o){for(me=[],te=ft();te!==o;)me.push(te),te=ft();me!==o?(te=ri(),te!==o?(q=_(q,te),H=q):(G=H,H=o)):(G=H,H=o)}else G=H,H=o;return H}function ri(){var H,q,me,te,Ae,ut;if(H=G,q=oi(),q!==o){for(me=[],te=G,Ae=Ee(),Ae===o&&(Ae=null),Ae!==o?(ut=oi(),ut!==o?(Ae=[Ae,ut],te=Ae):(G=te,te=o)):(G=te,te=o);te!==o;)me.push(te),te=G,Ae=Ee(),Ae===o&&(Ae=null),Ae!==o?(ut=oi(),ut!==o?(Ae=[Ae,ut],te=Ae):(G=te,te=o)):(G=te,te=o);me!==o?(q=h(q,me),H=q):(G=H,H=o)}else G=H,H=o;return H}function oi(){var H,q,me,te,Ae,ut,Zi,Fr,$i,ea,ol,Jr;return H=G,q=Ce(),q!==o?(me=Ee(),me===o&&(me=null),me!==o?(te=Ce(),te!==o?(Ae=Ee(),Ae===o&&(Ae=null),Ae!==o?(ut=De(),ut!==o?(Zi=Ee(),Zi!==o?(Fr=Le(),Fr!==o?($i=Ee(),$i===o&&($i=null),$i!==o?(ea=Le(),ea!==o?(ol=Ee(),ol===o&&(ol=null),ol!==o?(Jr=ee(),Jr!==o?(q=$(q,te,ut,Fr,ea,Jr),H=q):(G=H,H=o)):(G=H,H=o)):(G=H,H=o)):(G=H,H=o)):(G=H,H=o)):(G=H,H=o)):(G=H,H=o)):(G=H,H=o)):(G=H,H=o)):(G=H,H=o)):(G=H,H=o),H}function ee(){var H,q,me,te;return H=G,q=De(),q!==o?(me=Ee(),me===o&&(me=null),me!==o?(te=De(),te!==o?(q=ne(q,te),H=q):(G=H,H=o)):(G=H,H=o)):(G=H,H=o),H}function Ce(){var H,q;return H=G,q=bt(),q===o&&(q=zt()),q!==o&&(q=ie(q)),H=q,H}function De(){var H,q,me,te;return H=G,q=G,me=gt(),me===o&&(me=null),me!==o?(te=bt(),te!==o?(me=[me,te],q=me):(G=q,q=o)):(G=q,q=o),q===o&&(q=G,me=gt(),me===o&&(me=null),me!==o?(te=zt(),te!==o?(me=[me,te],q=me):(G=q,q=o)):(G=q,q=o)),q!==o&&(q=de(q)),H=q,H}function Le(){var H,q;return H=G,be.test(s.charAt(G))?(q=s.charAt(G),G++):(q=o,Ue(we)),q!==o&&(q=_e(q)),H=q,H}function Ee(){var H,q,me,te,Ae;if(H=G,q=[],me=ft(),me!==o)for(;me!==o;)q.push(me),me=ft();else q=o;if(q!==o)if(me=pt(),me===o&&(me=null),me!==o){for(te=[],Ae=ft();Ae!==o;)te.push(Ae),Ae=ft();te!==o?(q=[q,me,te],H=q):(G=H,H=o)}else G=H,H=o;else G=H,H=o;if(H===o){if(H=G,q=G,me=pt(),me!==o){for(te=[],Ae=ft();Ae!==o;)te.push(Ae),Ae=ft();te!==o?(me=[me,te],q=me):(G=q,q=o)}else G=q,q=o;q!==o&&(q=Me()),H=q}return H}function pt(){var H;return s.charCodeAt(G)===44?(H=X,G++):(H=o,Ue(ge)),H}function bt(){var H,q,me,te;return H=G,q=G,me=Ct(),me!==o?(te=yt(),te===o&&(te=null),te!==o?(me=[me,te],q=me):(G=q,q=o)):(G=q,q=o),q===o&&(q=G,me=zt(),me!==o?(te=yt(),te!==o?(me=[me,te],q=me):(G=q,q=o)):(G=q,q=o)),q!==o&&(q=Oe(q)),H=q,H}function Ct(){var H,q,me,te,Ae;return H=G,q=G,me=zt(),me===o&&(me=null),me!==o?(s.charCodeAt(G)===46?(te=Ie,G++):(te=o,Ue(Pe)),te!==o?(Ae=zt(),Ae!==o?(me=[me,te,Ae],q=me):(G=q,q=o)):(G=q,q=o)):(G=q,q=o),q===o&&(q=G,me=zt(),me!==o?(s.charCodeAt(G)===46?(te=Ie,G++):(te=o,Ue(Pe)),te!==o?(me=[me,te],q=me):(G=q,q=o)):(G=q,q=o)),q!==o&&(q=Oe(q)),H=q,H}function yt(){var H,q,me,te,Ae;return H=G,q=G,Ye.test(s.charAt(G))?(me=s.charAt(G),G++):(me=o,Ue(ke)),me!==o?(te=gt(),te===o&&(te=null),te!==o?(Ae=zt(),Ae!==o?(me=[me,te,Ae],q=me):(G=q,q=o)):(G=q,q=o)):(G=q,q=o),q!==o&&(q=Oe(q)),H=q,H}function gt(){var H;return Fe.test(s.charAt(G))?(H=s.charAt(G),G++):(H=o,Ue(se)),H}function zt(){var H,q,me;if(H=G,q=[],Z.test(s.charAt(G))?(me=s.charAt(G),G++):(me=o,Ue(K)),me!==o)for(;me!==o;)q.push(me),Z.test(s.charAt(G))?(me=s.charAt(G),G++):(me=o,Ue(K));else q=o;return q!==o&&(q=k(q)),H=q,H}function ft(){var H,q;return H=G,re.test(s.charAt(G))?(q=s.charAt(G),G++):(q=o,Ue(he)),q!==o&&(q=Me()),H=q,H}function gi(H,q){if(!q)return[H];for(var me=[H],te=0,Ae=q.length;te<Ae;te++)me[te+1]=q[te][1];return me}var Ii={m:"moveto",l:"lineto",h:"horizontal lineto",v:"vertical lineto",c:"curveto",s:"smooth curveto",q:"quadratic curveto",t:"smooth quadratic curveto",a:"elliptical arc",z:"closepath"};for(var Ei in Ii)Ii[Ei.toUpperCase()]=Ii[Ei];function zi(H,q){q||(q=[{}]);for(var me=q.length;me--;){var te={code:H,command:Ii[H]};H==H.toLowerCase()&&(te.relative=!0);for(var Ae in q[me])te[Ae]=q[me][Ae];q[me]=te}return q}if(ye=c(),ye!==o&&G===s.length)return ye;throw ye!==o&&G<s.length&&Ue(ct()),dt(Qe,ze<s.length?s.charAt(ze):null,ze<s.length?ue(ze,ze+1):ue(ze,ze))}t.exports={SyntaxError:r,parse:n}}),vY=_h((e,t)=>{var i=Rae().parse;i.parseSVG=i,i.makeAbsolute=r,t.exports=i;function r(n){var s,a={x:0,y:0},o={x:"x0",y:"y0",x1:"x0",y1:"y0",x2:"x0",y2:"y0"};return n.forEach(function(l){l.command==="moveto"&&(s=l),l.x0=a.x,l.y0=a.y;for(var c in o)c in l&&(l[c]+=l.relative?l[o[c]]:0);"x"in l||(l.x=a.x),"y"in l||(l.y=a.y),l.relative=!1,l.code=l.code.toUpperCase(),l.command=="closepath"&&(l.x=s.x,l.y=s.y),a=l}),n}}),Iae=_h((e,t)=>{t.exports=function(i,r){for(var n=i.split("."),s=r.split("."),a=0;a<3;a++){var o=Number(n[a]),l=Number(s[a]);if(o>l)return 1;if(l>o)return-1;if(!isNaN(o)&&isNaN(l))return 1;if(isNaN(o)&&!isNaN(l))return-1}return 0}}),b0="149",Do={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},Lae=0,V5=1,Oae=2,lB=1,zae=2,xx=3,Fl=0,ns=1,Ws=2,An=0,_f=1,H5=2,G5=3,j5=4,Nae=5,Lg=100,Bae=101,kae=102,W5=103,X5=104,Uae=200,Fae=201,Vae=202,Hae=203,yY=204,xY=205,Gae=206,jae=207,Wae=208,Xae=209,qae=210,Yae=0,Qae=1,Kae=2,PL=3,Zae=4,$ae=5,Jae=6,eoe=7,wY=0,toe=1,ioe=2,kc=0,roe=1,noe=2,soe=3,aoe=4,ooe=5,bY=300,Vf=301,Hf=302,DL=303,RL=304,Lw=306,Xu=1e3,Ar=1001,IL=1002,Qi=1003,q5=1004,bD=1005,pi=1006,loe=1007,Wv=1008,Js=1009,coe=1010,uoe=1011,_Y=1012,hoe=1013,qu=1014,Sn=1015,ch=1016,doe=1017,poe=1018,Sf=1020,foe=1021,is=1023,moe=1024,goe=1025,Mf=1026,Gf=1027,voe=1028,yoe=1029,fA=1030,xoe=1031,SY=1033,_D=33776,SD=33777,MD=33778,ED=33779,Y5=35840,Q5=35841,K5=35842,Z5=35843,woe=36196,$5=37492,J5=37496,eV=37808,tV=37809,iV=37810,rV=37811,nV=37812,sV=37813,aV=37814,oV=37815,lV=37816,cV=37817,uV=37818,hV=37819,dV=37820,pV=37821,AD=36492,boe=36283,fV=36284,mV=36285,gV=36286,MY=2200,EY=2201,cB=2202,mA=2300,gA=2301,CD=2302,tv=2400,iv=2401,vA=2402,uB=2500,_oe=2501,Vl=3e3,hi=3001,Mh=3200,AY=3201,Soe=0,Moe=1,xc="srgb",yA="srgb-linear",TD=7680,Eoe=519,LL=35044,Aoe=35048,vV="300 es",OL=1035,Cs=class{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});let i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;let i=this._listeners;return i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;let i=this._listeners[e];if(i!==void 0){let r=i.indexOf(t);r!==-1&&i.splice(r,1)}}dispatchEvent(e){if(this._listeners===void 0)return;let t=this._listeners[e.type];if(t!==void 0){e.target=this;let i=t.slice(0);for(let r=0,n=i.length;r<n;r++)i[r].call(this,e);e.target=null}}},Ns=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],yV=1234567,Hx=Math.PI/180,R1=180/Math.PI;function $o(){let e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(Ns[e&255]+Ns[e>>8&255]+Ns[e>>16&255]+Ns[e>>24&255]+"-"+Ns[t&255]+Ns[t>>8&255]+"-"+Ns[t>>16&15|64]+Ns[t>>24&255]+"-"+Ns[i&63|128]+Ns[i>>8&255]+"-"+Ns[i>>16&255]+Ns[i>>24&255]+Ns[r&255]+Ns[r>>8&255]+Ns[r>>16&255]+Ns[r>>24&255]).toLowerCase()}function vn(e,t,i){return Math.max(t,Math.min(i,e))}function hB(e,t){return(e%t+t)%t}function Coe(e,t,i,r,n){return r+(e-t)*(n-r)/(i-t)}function Toe(e,t,i){return e!==t?(i-e)/(t-e):0}function Gx(e,t,i){return(1-i)*e+i*t}function Poe(e,t,i,r){return Gx(e,t,1-Math.exp(-i*r))}function Doe(e,t=1){return t-Math.abs(hB(e,t*2)-t)}function Roe(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t),e*e*(3-2*e))}function Ioe(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t),e*e*e*(e*(e*6-15)+10))}function Loe(e,t){return e+Math.floor(Math.random()*(t-e+1))}function Ooe(e,t){return e+Math.random()*(t-e)}function zoe(e){return e*(.5-Math.random())}function Noe(e){e!==void 0&&(yV=e);let t=yV+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}function Boe(e){return e*Hx}function koe(e){return e*R1}function zL(e){return(e&e-1)===0&&e!==0}function CY(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function xA(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function Uoe(e,t,i,r,n){let s=Math.cos,a=Math.sin,o=s(i/2),l=a(i/2),c=s((t+r)/2),u=a((t+r)/2),h=s((t-r)/2),d=a((t-r)/2),p=s((r-t)/2),f=a((r-t)/2);switch(n){case"XYX":e.set(o*u,l*h,l*d,o*c);break;case"YZY":e.set(l*d,o*u,l*h,o*c);break;case"ZXZ":e.set(l*h,l*d,o*u,o*c);break;case"XZX":e.set(o*u,l*f,l*p,o*c);break;case"YXY":e.set(l*p,o*u,l*f,o*c);break;case"ZYZ":e.set(l*f,l*p,o*u,o*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+n)}}function Yu(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function gr(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return Math.round(e*65535);case Uint8Array:return Math.round(e*255);case Int16Array:return Math.round(e*32767);case Int8Array:return Math.round(e*127);default:throw new Error("Invalid component type.")}}var Et=Object.freeze({__proto__:null,DEG2RAD:Hx,RAD2DEG:R1,ceilPowerOfTwo:CY,clamp:vn,damp:Poe,degToRad:Boe,denormalize:Yu,euclideanModulo:hB,floorPowerOfTwo:xA,generateUUID:$o,inverseLerp:Toe,isPowerOfTwo:zL,lerp:Gx,mapLinear:Coe,normalize:gr,pingpong:Doe,radToDeg:koe,randFloat:Ooe,randFloatSpread:zoe,randInt:Loe,seededRandom:Noe,setQuaternionFromProperEuler:Uoe,smootherstep:Ioe,smoothstep:Roe}),ve=class{constructor(t=0,i=0){ve.prototype.isVector2=!0,this.x=t,this.y=i}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,i){return this.x=t,this.y=i,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this}addScaledVector(t,i){return this.x+=t.x*i,this.y+=t.y*i,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){let i=this.x,r=this.y,n=t.elements;return this.x=n[0]*i+n[3]*r+n[6],this.y=n[1]*i+n[4]*r+n[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this}clampScalar(t,i){return this.x=Math.max(t,Math.min(i,this.x)),this.y=Math.max(t,Math.min(i,this.y)),this}clampLength(t,i){let r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(i,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){let i=this.x-t.x,r=this.y-t.y;return i*i+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this}lerpVectors(t,i,r){return this.x=t.x+(i.x-t.x)*r,this.y=t.y+(i.y-t.y)*r,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,i=0){return this.x=t[i],this.y=t[i+1],this}toArray(t=[],i=0){return t[i]=this.x,t[i+1]=this.y,t}fromBufferAttribute(t,i){return this.x=t.getX(i),this.y=t.getY(i),this}rotateAround(t,i){let r=Math.cos(i),n=Math.sin(i),s=this.x-t.x,a=this.y-t.y;return this.x=s*r-a*n+t.x,this.y=s*n+a*r+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},Mn=class{constructor(){Mn.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,t,i,r,n,s,a,o,l){let c=this.elements;return c[0]=e,c[1]=r,c[2]=a,c[3]=t,c[4]=n,c[5]=o,c[6]=i,c[7]=s,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){let t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){let t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let i=e.elements,r=t.elements,n=this.elements,s=i[0],a=i[3],o=i[6],l=i[1],c=i[4],u=i[7],h=i[2],d=i[5],p=i[8],f=r[0],v=r[3],g=r[6],m=r[1],x=r[4],w=r[7],_=r[2],M=r[5],S=r[8];return n[0]=s*f+a*m+o*_,n[3]=s*v+a*x+o*M,n[6]=s*g+a*w+o*S,n[1]=l*f+c*m+u*_,n[4]=l*v+c*x+u*M,n[7]=l*g+c*w+u*S,n[2]=h*f+d*m+p*_,n[5]=h*v+d*x+p*M,n[8]=h*g+d*w+p*S,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){let e=this.elements,t=e[0],i=e[1],r=e[2],n=e[3],s=e[4],a=e[5],o=e[6],l=e[7],c=e[8];return t*s*c-t*a*l-i*n*c+i*a*o+r*n*l-r*s*o}invert(){let e=this.elements,t=e[0],i=e[1],r=e[2],n=e[3],s=e[4],a=e[5],o=e[6],l=e[7],c=e[8],u=c*s-a*l,h=a*o-c*n,d=l*n-s*o,p=t*u+i*h+r*d;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);let f=1/p;return e[0]=u*f,e[1]=(r*l-c*i)*f,e[2]=(a*i-r*s)*f,e[3]=h*f,e[4]=(c*t-r*o)*f,e[5]=(r*n-a*t)*f,e[6]=d*f,e[7]=(i*o-l*t)*f,e[8]=(s*t-i*n)*f,this}transpose(){let e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){let t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,r,n,s,a){let o=Math.cos(n),l=Math.sin(n);return this.set(i*o,i*l,-i*(o*s+l*a)+s+e,-r*l,r*o,-r*(-l*s+o*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(PD.makeScale(e,t)),this}rotate(e){return this.premultiply(PD.makeRotation(-e)),this}translate(e,t){return this.premultiply(PD.makeTranslation(e,t)),this}makeTranslation(e,t){return this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){let t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){let t=this.elements,i=e.elements;for(let r=0;r<9;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){let i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}},PD=new Mn;function TY(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}var Foe={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function S_(e,t){return new Foe[e](t)}function I1(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function Ef(e){return e<.04045?e*.0773993808:Math.pow(e*.9478672986+.0521327014,2.4)}function hE(e){return e<.0031308?e*12.92:1.055*Math.pow(e,.41666)-.055}var DD={[xc]:{[yA]:Ef},[yA]:{[xc]:hE}},ra={legacyMode:!0,get workingColorSpace(){return yA},set workingColorSpace(e){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(e,t,i){if(this.legacyMode||t===i||!t||!i)return e;if(DD[t]&&DD[t][i]!==void 0){let r=DD[t][i];return e.r=r(e.r),e.g=r(e.g),e.b=r(e.b),e}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)}},PY={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Dn={r:0,g:0,b:0},hl={h:0,s:0,l:0},M_={h:0,s:0,l:0};function RD(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+(t-e)*6*i:i<1/2?t:i<2/3?e+(t-e)*6*(2/3-i):e}function E_(e,t){return t.r=e.r,t.g=e.g,t.b=e.b,t}var jt=class{constructor(t,i,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,i===void 0&&r===void 0?this.set(t):this.setRGB(t,i,r)}set(t){return t&&t.isColor?this.copy(t):typeof t=="number"?this.setHex(t):typeof t=="string"&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,i=xc){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,ra.toWorkingColorSpace(this,i),this}setRGB(t,i,r,n=ra.workingColorSpace){return this.r=t,this.g=i,this.b=r,ra.toWorkingColorSpace(this,n),this}setHSL(t,i,r,n=ra.workingColorSpace){if(t=hB(t,1),i=vn(i,0,1),r=vn(r,0,1),i===0)this.r=this.g=this.b=r;else{let s=r<=.5?r*(1+i):r+i-r*i,a=2*r-s;this.r=RD(a,s,t+1/3),this.g=RD(a,s,t),this.b=RD(a,s,t-1/3)}return ra.toWorkingColorSpace(this,n),this}setStyle(t,i=xc){function r(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let s,a=n[1],o=n[2];switch(a){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(s[1],10))/255,this.g=Math.min(255,parseInt(s[2],10))/255,this.b=Math.min(255,parseInt(s[3],10))/255,ra.toWorkingColorSpace(this,i),r(s[4]),this;if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(s[1],10))/100,this.g=Math.min(100,parseInt(s[2],10))/100,this.b=Math.min(100,parseInt(s[3],10))/100,ra.toWorkingColorSpace(this,i),r(s[4]),this;break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o)){let l=parseFloat(s[1])/360,c=parseFloat(s[2])/100,u=parseFloat(s[3])/100;return r(s[4]),this.setHSL(l,c,u,i)}break}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(t)){let s=n[1],a=s.length;if(a===3)return this.r=parseInt(s.charAt(0)+s.charAt(0),16)/255,this.g=parseInt(s.charAt(1)+s.charAt(1),16)/255,this.b=parseInt(s.charAt(2)+s.charAt(2),16)/255,ra.toWorkingColorSpace(this,i),this;if(a===6)return this.r=parseInt(s.charAt(0)+s.charAt(1),16)/255,this.g=parseInt(s.charAt(2)+s.charAt(3),16)/255,this.b=parseInt(s.charAt(4)+s.charAt(5),16)/255,ra.toWorkingColorSpace(this,i),this}return t&&t.length>0?this.setColorName(t,i):this}setColorName(t,i=xc){let r=PY[t.toLowerCase()];return r!==void 0?this.setHex(r,i):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=Ef(t.r),this.g=Ef(t.g),this.b=Ef(t.b),this}copyLinearToSRGB(t){return this.r=hE(t.r),this.g=hE(t.g),this.b=hE(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=xc){return ra.fromWorkingColorSpace(E_(this,Dn),t),vn(Dn.r*255,0,255)<<16^vn(Dn.g*255,0,255)<<8^vn(Dn.b*255,0,255)<<0}getHexString(t=xc){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,i=ra.workingColorSpace){ra.fromWorkingColorSpace(E_(this,Dn),i);let r=Dn.r,n=Dn.g,s=Dn.b,a=Math.max(r,n,s),o=Math.min(r,n,s),l,c,u=(o+a)/2;if(o===a)l=0,c=0;else{let h=a-o;switch(c=u<=.5?h/(a+o):h/(2-a-o),a){case r:l=(n-s)/h+(n<s?6:0);break;case n:l=(s-r)/h+2;break;case s:l=(r-n)/h+4;break}l/=6}return t.h=l,t.s=c,t.l=u,t}getRGB(t,i=ra.workingColorSpace){return ra.fromWorkingColorSpace(E_(this,Dn),i),t.r=Dn.r,t.g=Dn.g,t.b=Dn.b,t}getStyle(t=xc){return ra.fromWorkingColorSpace(E_(this,Dn),t),t!==xc?`color(${t} ${Dn.r} ${Dn.g} ${Dn.b})`:`rgb(${Dn.r*255|0},${Dn.g*255|0},${Dn.b*255|0})`}offsetHSL(t,i,r){return this.getHSL(hl),hl.h+=t,hl.s+=i,hl.l+=r,this.setHSL(hl.h,hl.s,hl.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,i){return this.r=t.r+i.r,this.g=t.g+i.g,this.b=t.b+i.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,i){return this.r+=(t.r-this.r)*i,this.g+=(t.g-this.g)*i,this.b+=(t.b-this.b)*i,this}lerpColors(t,i,r){return this.r=t.r+(i.r-t.r)*r,this.g=t.g+(i.g-t.g)*r,this.b=t.b+(i.b-t.b)*r,this}lerpHSL(t,i){this.getHSL(hl),t.getHSL(M_);let r=Gx(hl.h,M_.h,i),n=Gx(hl.s,M_.s,i),s=Gx(hl.l,M_.l,i);return this.setHSL(r,n,s),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,i=0){return this.r=t[i],this.g=t[i+1],this.b=t[i+2],this}toArray(t=[],i=0){return t[i]=this.r,t[i+1]=this.g,t[i+2]=this.b,t}fromBufferAttribute(t,i){return this.r=t.getX(i),this.g=t.getY(i),this.b=t.getZ(i),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};jt.NAMES=PY;var Cm,DY=class{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{Cm===void 0&&(Cm=I1("canvas")),Cm.width=e.width,Cm.height=e.height;let i=Cm.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=Cm}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){let t=I1("canvas");t.width=e.width,t.height=e.height;let i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);let r=i.getImageData(0,0,e.width,e.height),n=r.data;for(let s=0;s<n.length;s++)n[s]=Ef(n[s]/255)*255;return i.putImageData(r,0,0),t}else if(e.data){let t=e.data.slice(0);for(let i=0;i<t.length;i++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[i]=Math.floor(Ef(t[i]/255)*255):t[i]=Ef(t[i]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}},RY=class{constructor(e=null){this.isSource=!0,this.uuid=$o(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){let t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];let i={uuid:this.uuid,url:""},r=this.data;if(r!==null){let n;if(Array.isArray(r)){n=[];for(let s=0,a=r.length;s<a;s++)r[s].isDataTexture?n.push(ID(r[s].image)):n.push(ID(r[s]))}else n=ID(r);i.url=n}return t||(e.images[this.uuid]=i),i}};function ID(e){return typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap?DY.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}var Voe=0,Br=class extends Cs{constructor(e=Br.DEFAULT_IMAGE,t=Br.DEFAULT_MAPPING,i=Ar,r=Ar,n=pi,s=Wv,a=is,o=Js,l=Br.DEFAULT_ANISOTROPY,c=Vl){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Voe++}),this.uuid=$o(),this.name="",this.source=new RY(e),this.mipmaps=[],this.mapping=t,this.wrapS=i,this.wrapT=r,this.magFilter=n,this.minFilter=s,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=o,this.offset=new ve(0,0),this.repeat=new ve(1,1),this.center=new ve(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Mn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){let t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];let i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==bY)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Xu:e.x=e.x-Math.floor(e.x);break;case Ar:e.x=e.x<0?0:1;break;case IL:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Xu:e.y=e.y-Math.floor(e.y);break;case Ar:e.y=e.y<0?0:1;break;case IL:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}};Br.DEFAULT_IMAGE=null;Br.DEFAULT_MAPPING=bY;Br.DEFAULT_ANISOTROPY=1;var ti=class{constructor(t=0,i=0,r=0,n=1){ti.prototype.isVector4=!0,this.x=t,this.y=i,this.z=r,this.w=n}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,i,r,n){return this.x=t,this.y=i,this.z=r,this.w=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;case 3:this.w=i;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==void 0?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this.w=t.w+i.w,this}addScaledVector(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this.w+=t.w*i,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this.w=t.w-i.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){let i=this.x,r=this.y,n=this.z,s=this.w,a=t.elements;return this.x=a[0]*i+a[4]*r+a[8]*n+a[12]*s,this.y=a[1]*i+a[5]*r+a[9]*n+a[13]*s,this.z=a[2]*i+a[6]*r+a[10]*n+a[14]*s,this.w=a[3]*i+a[7]*r+a[11]*n+a[15]*s,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);let i=Math.sqrt(1-t.w*t.w);return i<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/i,this.y=t.y/i,this.z=t.z/i),this}setAxisAngleFromRotationMatrix(t){let i,r,n,s,a=t.elements,o=a[0],l=a[4],c=a[8],u=a[1],h=a[5],d=a[9],p=a[2],f=a[6],v=a[10];if(Math.abs(l-u)<.01&&Math.abs(c-p)<.01&&Math.abs(d-f)<.01){if(Math.abs(l+u)<.1&&Math.abs(c+p)<.1&&Math.abs(d+f)<.1&&Math.abs(o+h+v-3)<.1)return this.set(1,0,0,0),this;i=Math.PI;let m=(o+1)/2,x=(h+1)/2,w=(v+1)/2,_=(l+u)/4,M=(c+p)/4,S=(d+f)/4;return m>x&&m>w?m<.01?(r=0,n=.707106781,s=.707106781):(r=Math.sqrt(m),n=_/r,s=M/r):x>w?x<.01?(r=.707106781,n=0,s=.707106781):(n=Math.sqrt(x),r=_/n,s=S/n):w<.01?(r=.707106781,n=.707106781,s=0):(s=Math.sqrt(w),r=M/s,n=S/s),this.set(r,n,s,i),this}let g=Math.sqrt((f-d)*(f-d)+(c-p)*(c-p)+(u-l)*(u-l));return Math.abs(g)<.001&&(g=1),this.x=(f-d)/g,this.y=(c-p)/g,this.z=(u-l)/g,this.w=Math.acos((o+h+v-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this.z=Math.max(t.z,Math.min(i.z,this.z)),this.w=Math.max(t.w,Math.min(i.w,this.w)),this}clampScalar(t,i){return this.x=Math.max(t,Math.min(i,this.x)),this.y=Math.max(t,Math.min(i,this.y)),this.z=Math.max(t,Math.min(i,this.z)),this.w=Math.max(t,Math.min(i,this.w)),this}clampLength(t,i){let r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(i,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this.w+=(t.w-this.w)*i,this}lerpVectors(t,i,r){return this.x=t.x+(i.x-t.x)*r,this.y=t.y+(i.y-t.y)*r,this.z=t.z+(i.z-t.z)*r,this.w=t.w+(i.w-t.w)*r,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,i=0){return this.x=t[i],this.y=t[i+1],this.z=t[i+2],this.w=t[i+3],this}toArray(t=[],i=0){return t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t[i+3]=this.w,t}fromBufferAttribute(t,i){return this.x=t.getX(i),this.y=t.getY(i),this.z=t.getZ(i),this.w=t.getW(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}},Wi=class extends Cs{constructor(t=1,i=1,r={}){super(),this.isWebGLRenderTarget=!0,this.width=t,this.height=i,this.depth=1,this.scissor=new ti(0,0,t,i),this.scissorTest=!1,this.viewport=new ti(0,0,t,i);let n={width:t,height:i,depth:1};this.texture=new Br(n,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=r.generateMipmaps!==void 0?r.generateMipmaps:!1,this.texture.internalFormat=r.internalFormat!==void 0?r.internalFormat:null,this.texture.minFilter=r.minFilter!==void 0?r.minFilter:pi,this.depthBuffer=r.depthBuffer!==void 0?r.depthBuffer:!0,this.stencilBuffer=r.stencilBuffer!==void 0?r.stencilBuffer:!1,this.depthTexture=r.depthTexture!==void 0?r.depthTexture:null,this.samples=r.samples!==void 0?r.samples:0}setSize(t,i,r=1){(this.width!==t||this.height!==i||this.depth!==r)&&(this.width=t,this.height=i,this.depth=r,this.texture.image.width=t,this.texture.image.height=i,this.texture.image.depth=r,this.dispose()),this.viewport.set(0,0,t,i),this.scissor.set(0,0,t,i)}clone(){return new this.constructor().copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.texture.isRenderTargetTexture=!0;let i=Object.assign({},t.texture.image);return this.texture.source=new RY(i),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,t.depthTexture!==null&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}},IY=class extends Br{constructor(e=null,t=1,i=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=Qi,this.minFilter=Qi,this.wrapR=Ar,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},Hoe=class extends Br{constructor(e=null,t=1,i=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=Qi,this.minFilter=Qi,this.wrapR=Ar,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},Goe=class extends Wi{constructor(e=1,t=1,i=1,r={}){super(e,t,r),this.isWebGLMultipleRenderTargets=!0;let n=this.texture;this.texture=[];for(let s=0;s<i;s++)this.texture[s]=n.clone(),this.texture[s].isRenderTargetTexture=!0}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let r=0,n=this.texture.length;r<n;r++)this.texture[r].image.width=e,this.texture[r].image.height=t,this.texture[r].image.depth=i;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.texture.length=0;for(let t=0,i=e.texture.length;t<i;t++)this.texture[t]=e.texture[t].clone(),this.texture[t].isRenderTargetTexture=!0;return this}},ei=class{constructor(t=0,i=0,r=0,n=1){this.isQuaternion=!0,this._x=t,this._y=i,this._z=r,this._w=n}static slerpFlat(t,i,r,n,s,a,o){let l=r[n+0],c=r[n+1],u=r[n+2],h=r[n+3],d=s[a+0],p=s[a+1],f=s[a+2],v=s[a+3];if(o===0){t[i+0]=l,t[i+1]=c,t[i+2]=u,t[i+3]=h;return}if(o===1){t[i+0]=d,t[i+1]=p,t[i+2]=f,t[i+3]=v;return}if(h!==v||l!==d||c!==p||u!==f){let g=1-o,m=l*d+c*p+u*f+h*v,x=m>=0?1:-1,w=1-m*m;if(w>Number.EPSILON){let M=Math.sqrt(w),S=Math.atan2(M,m*x);g=Math.sin(g*S)/M,o=Math.sin(o*S)/M}let _=o*x;if(l=l*g+d*_,c=c*g+p*_,u=u*g+f*_,h=h*g+v*_,g===1-o){let M=1/Math.sqrt(l*l+c*c+u*u+h*h);l*=M,c*=M,u*=M,h*=M}}t[i]=l,t[i+1]=c,t[i+2]=u,t[i+3]=h}static multiplyQuaternionsFlat(t,i,r,n,s,a){let o=r[n],l=r[n+1],c=r[n+2],u=r[n+3],h=s[a],d=s[a+1],p=s[a+2],f=s[a+3];return t[i]=o*f+u*h+l*p-c*d,t[i+1]=l*f+u*d+c*h-o*p,t[i+2]=c*f+u*p+o*d-l*h,t[i+3]=u*f-o*h-l*d-c*p,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,i,r,n){return this._x=t,this._y=i,this._z=r,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,i){let r=t._x,n=t._y,s=t._z,a=t._order,o=Math.cos,l=Math.sin,c=o(r/2),u=o(n/2),h=o(s/2),d=l(r/2),p=l(n/2),f=l(s/2);switch(a){case"XYZ":this._x=d*u*h+c*p*f,this._y=c*p*h-d*u*f,this._z=c*u*f+d*p*h,this._w=c*u*h-d*p*f;break;case"YXZ":this._x=d*u*h+c*p*f,this._y=c*p*h-d*u*f,this._z=c*u*f-d*p*h,this._w=c*u*h+d*p*f;break;case"ZXY":this._x=d*u*h-c*p*f,this._y=c*p*h+d*u*f,this._z=c*u*f+d*p*h,this._w=c*u*h-d*p*f;break;case"ZYX":this._x=d*u*h-c*p*f,this._y=c*p*h+d*u*f,this._z=c*u*f-d*p*h,this._w=c*u*h+d*p*f;break;case"YZX":this._x=d*u*h+c*p*f,this._y=c*p*h+d*u*f,this._z=c*u*f-d*p*h,this._w=c*u*h-d*p*f;break;case"XZY":this._x=d*u*h-c*p*f,this._y=c*p*h-d*u*f,this._z=c*u*f+d*p*h,this._w=c*u*h+d*p*f;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return i!==!1&&this._onChangeCallback(),this}setFromAxisAngle(t,i){let r=i/2,n=Math.sin(r);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(t){let i=t.elements,r=i[0],n=i[4],s=i[8],a=i[1],o=i[5],l=i[9],c=i[2],u=i[6],h=i[10],d=r+o+h;if(d>0){let p=.5/Math.sqrt(d+1);this._w=.25/p,this._x=(u-l)*p,this._y=(s-c)*p,this._z=(a-n)*p}else if(r>o&&r>h){let p=2*Math.sqrt(1+r-o-h);this._w=(u-l)/p,this._x=.25*p,this._y=(n+a)/p,this._z=(s+c)/p}else if(o>h){let p=2*Math.sqrt(1+o-r-h);this._w=(s-c)/p,this._x=(n+a)/p,this._y=.25*p,this._z=(l+u)/p}else{let p=2*Math.sqrt(1+h-r-o);this._w=(a-n)/p,this._x=(s+c)/p,this._y=(l+u)/p,this._z=.25*p}return this._onChangeCallback(),this}setFromUnitVectors(t,i){let r=t.dot(i)+1;return r<Number.EPSILON?(r=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=r):(this._x=0,this._y=-t.z,this._z=t.y,this._w=r)):(this._x=t.y*i.z-t.z*i.y,this._y=t.z*i.x-t.x*i.z,this._z=t.x*i.y-t.y*i.x,this._w=r),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(vn(this.dot(t),-1,1)))}rotateTowards(t,i){let r=this.angleTo(t);if(r===0)return this;let n=Math.min(1,i/r);return this.slerp(t,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,i){let r=t._x,n=t._y,s=t._z,a=t._w,o=i._x,l=i._y,c=i._z,u=i._w;return this._x=r*u+a*o+n*c-s*l,this._y=n*u+a*l+s*o-r*c,this._z=s*u+a*c+r*l-n*o,this._w=a*u-r*o-n*l-s*c,this._onChangeCallback(),this}slerp(t,i){if(i===0)return this;if(i===1)return this.copy(t);let r=this._x,n=this._y,s=this._z,a=this._w,o=a*t._w+r*t._x+n*t._y+s*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=a,this._x=r,this._y=n,this._z=s,this;let l=1-o*o;if(l<=Number.EPSILON){let p=1-i;return this._w=p*a+i*this._w,this._x=p*r+i*this._x,this._y=p*n+i*this._y,this._z=p*s+i*this._z,this.normalize(),this._onChangeCallback(),this}let c=Math.sqrt(l),u=Math.atan2(c,o),h=Math.sin((1-i)*u)/c,d=Math.sin(i*u)/c;return this._w=a*h+this._w*d,this._x=r*h+this._x*d,this._y=n*h+this._y*d,this._z=s*h+this._z*d,this._onChangeCallback(),this}slerpQuaternions(t,i,r){return this.copy(t).slerp(i,r)}random(){let t=Math.random(),i=Math.sqrt(1-t),r=Math.sqrt(t),n=2*Math.PI*Math.random(),s=2*Math.PI*Math.random();return this.set(i*Math.cos(n),r*Math.sin(s),r*Math.cos(s),i*Math.sin(n))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,i=0){return this._x=t[i],this._y=t[i+1],this._z=t[i+2],this._w=t[i+3],this._onChangeCallback(),this}toArray(t=[],i=0){return t[i]=this._x,t[i+1]=this._y,t[i+2]=this._z,t[i+3]=this._w,t}fromBufferAttribute(t,i){return this._x=t.getX(i),this._y=t.getY(i),this._z=t.getZ(i),this._w=t.getW(i),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},B=class{constructor(e=0,t=0,i=0){B.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return i===void 0&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(xV.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(xV.setFromAxisAngle(e,t))}applyMatrix3(e){let t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6]*r,this.y=n[1]*t+n[4]*i+n[7]*r,this.z=n[2]*t+n[5]*i+n[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){let t=this.x,i=this.y,r=this.z,n=e.elements,s=1/(n[3]*t+n[7]*i+n[11]*r+n[15]);return this.x=(n[0]*t+n[4]*i+n[8]*r+n[12])*s,this.y=(n[1]*t+n[5]*i+n[9]*r+n[13])*s,this.z=(n[2]*t+n[6]*i+n[10]*r+n[14])*s,this}applyQuaternion(e){let t=this.x,i=this.y,r=this.z,n=e.x,s=e.y,a=e.z,o=e.w,l=o*t+s*r-a*i,c=o*i+a*t-n*r,u=o*r+n*i-s*t,h=-n*t-s*i-a*r;return this.x=l*o+h*-n+c*-a-u*-s,this.y=c*o+h*-s+u*-n-l*-a,this.z=u*o+h*-a+l*-s-c*-n,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){let t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[4]*i+n[8]*r,this.y=n[1]*t+n[5]*i+n[9]*r,this.z=n[2]*t+n[6]*i+n[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){let i=e.x,r=e.y,n=e.z,s=t.x,a=t.y,o=t.z;return this.x=r*o-n*a,this.y=n*s-i*o,this.z=i*a-r*s,this}projectOnVector(e){let t=e.lengthSq();if(t===0)return this.set(0,0,0);let i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return LD.copy(this).projectOnVector(e),this.sub(LD)}reflect(e){return this.sub(LD.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){let t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;let i=this.dot(e)/t;return Math.acos(vn(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){let r=Math.sin(t)*e;return this.x=r*Math.sin(i),this.y=Math.cos(t)*e,this.z=r*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){let t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){let t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,i=Math.sqrt(1-e**2);return this.x=i*Math.cos(t),this.y=i*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}},LD=new B,xV=new ei,cn=class{constructor(e=new B(1/0,1/0,1/0),t=new B(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,i=1/0,r=1/0,n=-1/0,s=-1/0,a=-1/0;for(let o=0,l=e.length;o<l;o+=3){let c=e[o],u=e[o+1],h=e[o+2];c<t&&(t=c),u<i&&(i=u),h<r&&(r=h),c>n&&(n=c),u>s&&(s=u),h>a&&(a=h)}return this.min.set(t,i,r),this.max.set(n,s,a),this}setFromBufferAttribute(e){let t=1/0,i=1/0,r=1/0,n=-1/0,s=-1/0,a=-1/0;for(let o=0,l=e.count;o<l;o++){let c=e.getX(o),u=e.getY(o),h=e.getZ(o);c<t&&(t=c),u<i&&(i=u),h<r&&(r=h),c>n&&(n=c),u>s&&(s=u),h>a&&(a=h)}return this.min.set(t,i,r),this.max.set(n,s,a),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let i=yp.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);let i=e.geometry;if(i!==void 0)if(t&&i.attributes!=null&&i.attributes.position!==void 0){let n=i.attributes.position;for(let s=0,a=n.count;s<a;s++)yp.fromBufferAttribute(n,s).applyMatrix4(e.matrixWorld),this.expandByPoint(yp)}else i.boundingBox===null&&i.computeBoundingBox(),OD.copy(i.boundingBox),OD.applyMatrix4(e.matrixWorld),this.union(OD);let r=e.children;for(let n=0,s=r.length;n<s;n++)this.expandByObject(r[n],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,yp),yp.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(xy),A_.subVectors(this.max,xy),Tm.subVectors(e.a,xy),Pm.subVectors(e.b,xy),Dm.subVectors(e.c,xy),Nh.subVectors(Pm,Tm),Bh.subVectors(Dm,Pm),xp.subVectors(Tm,Dm);let t=[0,-Nh.z,Nh.y,0,-Bh.z,Bh.y,0,-xp.z,xp.y,Nh.z,0,-Nh.x,Bh.z,0,-Bh.x,xp.z,0,-xp.x,-Nh.y,Nh.x,0,-Bh.y,Bh.x,0,-xp.y,xp.x,0];return!zD(t,Tm,Pm,Dm,A_)||(t=[1,0,0,0,1,0,0,0,1],!zD(t,Tm,Pm,Dm,A_))?!1:(C_.crossVectors(Nh,Bh),t=[C_.x,C_.y,C_.z],zD(t,Tm,Pm,Dm,A_))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return yp.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=this.getSize(yp).length()*.5,e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(lu[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),lu[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),lu[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),lu[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),lu[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),lu[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),lu[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),lu[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(lu),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},lu=[new B,new B,new B,new B,new B,new B,new B,new B],yp=new B,OD=new cn,Tm=new B,Pm=new B,Dm=new B,Nh=new B,Bh=new B,xp=new B,xy=new B,A_=new B,C_=new B,wp=new B;function zD(e,t,i,r,n){for(let s=0,a=e.length-3;s<=a;s+=3){wp.fromArray(e,s);let o=n.x*Math.abs(wp.x)+n.y*Math.abs(wp.y)+n.z*Math.abs(wp.z),l=t.dot(wp),c=i.dot(wp),u=r.dot(wp);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>o)return!1}return!0}var joe=new cn,wy=new B,ND=new B,ja=class{constructor(e=new B,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){let i=this.center;t!==void 0?i.copy(t):joe.setFromPoints(e).getCenter(i);let r=0;for(let n=0,s=e.length;n<s;n++)r=Math.max(r,i.distanceToSquared(e[n]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){let t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){let i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;wy.subVectors(e,this.center);let t=wy.lengthSq();if(t>this.radius*this.radius){let i=Math.sqrt(t),r=(i-this.radius)*.5;this.center.addScaledVector(wy,r/i),this.radius+=r}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(ND.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(wy.copy(e.center).add(ND)),this.expandByPoint(wy.copy(e.center).sub(ND))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}},cu=new B,BD=new B,T_=new B,kh=new B,kD=new B,P_=new B,UD=new B,_0=class{constructor(e=new B,t=new B(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,cu)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);let i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){let t=cu.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(cu.copy(this.direction).multiplyScalar(t).add(this.origin),cu.distanceToSquared(e))}distanceSqToSegment(e,t,i,r){BD.copy(e).add(t).multiplyScalar(.5),T_.copy(t).sub(e).normalize(),kh.copy(this.origin).sub(BD);let n=e.distanceTo(t)*.5,s=-this.direction.dot(T_),a=kh.dot(this.direction),o=-kh.dot(T_),l=kh.lengthSq(),c=Math.abs(1-s*s),u,h,d,p;if(c>0)if(u=s*o-a,h=s*a-o,p=n*c,u>=0)if(h>=-p)if(h<=p){let f=1/c;u*=f,h*=f,d=u*(u+s*h+2*a)+h*(s*u+h+2*o)+l}else h=n,u=Math.max(0,-(s*h+a)),d=-u*u+h*(h+2*o)+l;else h=-n,u=Math.max(0,-(s*h+a)),d=-u*u+h*(h+2*o)+l;else h<=-p?(u=Math.max(0,-(-s*n+a)),h=u>0?-n:Math.min(Math.max(-n,-o),n),d=-u*u+h*(h+2*o)+l):h<=p?(u=0,h=Math.min(Math.max(-n,-o),n),d=h*(h+2*o)+l):(u=Math.max(0,-(s*n+a)),h=u>0?n:Math.min(Math.max(-n,-o),n),d=-u*u+h*(h+2*o)+l);else h=s>0?-n:n,u=Math.max(0,-(s*h+a)),d=-u*u+h*(h+2*o)+l;return i&&i.copy(this.direction).multiplyScalar(u).add(this.origin),r&&r.copy(T_).multiplyScalar(h).add(BD),d}intersectSphere(e,t){cu.subVectors(e.center,this.origin);let i=cu.dot(this.direction),r=cu.dot(cu)-i*i,n=e.radius*e.radius;if(r>n)return null;let s=Math.sqrt(n-r),a=i-s,o=i+s;return a<0&&o<0?null:a<0?this.at(o,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){let t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;let i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){let i=this.distanceToPlane(e);return i===null?null:this.at(i,t)}intersectsPlane(e){let t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,r,n,s,a,o,l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(i=(e.min.x-h.x)*l,r=(e.max.x-h.x)*l):(i=(e.max.x-h.x)*l,r=(e.min.x-h.x)*l),c>=0?(n=(e.min.y-h.y)*c,s=(e.max.y-h.y)*c):(n=(e.max.y-h.y)*c,s=(e.min.y-h.y)*c),i>s||n>r||((n>i||isNaN(i))&&(i=n),(s<r||isNaN(r))&&(r=s),u>=0?(a=(e.min.z-h.z)*u,o=(e.max.z-h.z)*u):(a=(e.max.z-h.z)*u,o=(e.min.z-h.z)*u),i>o||a>r)||((a>i||i!==i)&&(i=a),(o<r||r!==r)&&(r=o),r<0)?null:this.at(i>=0?i:r,t)}intersectsBox(e){return this.intersectBox(e,cu)!==null}intersectTriangle(e,t,i,r,n){kD.subVectors(t,e),P_.subVectors(i,e),UD.crossVectors(kD,P_);let s=this.direction.dot(UD),a;if(s>0){if(r)return null;a=1}else if(s<0)a=-1,s=-s;else return null;kh.subVectors(this.origin,e);let o=a*this.direction.dot(P_.crossVectors(kh,P_));if(o<0)return null;let l=a*this.direction.dot(kD.cross(kh));if(l<0||o+l>s)return null;let c=-a*kh.dot(UD);return c<0?null:this.at(c/s,n)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}},ht=class{constructor(){ht.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(t,i,r,n,s,a,o,l,c,u,h,d,p,f,v,g){let m=this.elements;return m[0]=t,m[4]=i,m[8]=r,m[12]=n,m[1]=s,m[5]=a,m[9]=o,m[13]=l,m[2]=c,m[6]=u,m[10]=h,m[14]=d,m[3]=p,m[7]=f,m[11]=v,m[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new ht().fromArray(this.elements)}copy(t){let i=this.elements,r=t.elements;return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[8]=r[8],i[9]=r[9],i[10]=r[10],i[11]=r[11],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15],this}copyPosition(t){let i=this.elements,r=t.elements;return i[12]=r[12],i[13]=r[13],i[14]=r[14],this}setFromMatrix3(t){let i=t.elements;return this.set(i[0],i[3],i[6],0,i[1],i[4],i[7],0,i[2],i[5],i[8],0,0,0,0,1),this}extractBasis(t,i,r){return t.setFromMatrixColumn(this,0),i.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(t,i,r){return this.set(t.x,i.x,r.x,0,t.y,i.y,r.y,0,t.z,i.z,r.z,0,0,0,0,1),this}extractRotation(t){let i=this.elements,r=t.elements,n=1/Rm.setFromMatrixColumn(t,0).length(),s=1/Rm.setFromMatrixColumn(t,1).length(),a=1/Rm.setFromMatrixColumn(t,2).length();return i[0]=r[0]*n,i[1]=r[1]*n,i[2]=r[2]*n,i[3]=0,i[4]=r[4]*s,i[5]=r[5]*s,i[6]=r[6]*s,i[7]=0,i[8]=r[8]*a,i[9]=r[9]*a,i[10]=r[10]*a,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromEuler(t){let i=this.elements,r=t.x,n=t.y,s=t.z,a=Math.cos(r),o=Math.sin(r),l=Math.cos(n),c=Math.sin(n),u=Math.cos(s),h=Math.sin(s);if(t.order==="XYZ"){let d=a*u,p=a*h,f=o*u,v=o*h;i[0]=l*u,i[4]=-l*h,i[8]=c,i[1]=p+f*c,i[5]=d-v*c,i[9]=-o*l,i[2]=v-d*c,i[6]=f+p*c,i[10]=a*l}else if(t.order==="YXZ"){let d=l*u,p=l*h,f=c*u,v=c*h;i[0]=d+v*o,i[4]=f*o-p,i[8]=a*c,i[1]=a*h,i[5]=a*u,i[9]=-o,i[2]=p*o-f,i[6]=v+d*o,i[10]=a*l}else if(t.order==="ZXY"){let d=l*u,p=l*h,f=c*u,v=c*h;i[0]=d-v*o,i[4]=-a*h,i[8]=f+p*o,i[1]=p+f*o,i[5]=a*u,i[9]=v-d*o,i[2]=-a*c,i[6]=o,i[10]=a*l}else if(t.order==="ZYX"){let d=a*u,p=a*h,f=o*u,v=o*h;i[0]=l*u,i[4]=f*c-p,i[8]=d*c+v,i[1]=l*h,i[5]=v*c+d,i[9]=p*c-f,i[2]=-c,i[6]=o*l,i[10]=a*l}else if(t.order==="YZX"){let d=a*l,p=a*c,f=o*l,v=o*c;i[0]=l*u,i[4]=v-d*h,i[8]=f*h+p,i[1]=h,i[5]=a*u,i[9]=-o*u,i[2]=-c*u,i[6]=p*h+f,i[10]=d-v*h}else if(t.order==="XZY"){let d=a*l,p=a*c,f=o*l,v=o*c;i[0]=l*u,i[4]=-h,i[8]=c*u,i[1]=d*h+v,i[5]=a*u,i[9]=p*h-f,i[2]=f*h-p,i[6]=o*u,i[10]=v*h+d}return i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromQuaternion(t){return this.compose(Woe,t,Xoe)}lookAt(t,i,r){let n=this.elements;return eo.subVectors(t,i),eo.lengthSq()===0&&(eo.z=1),eo.normalize(),Uh.crossVectors(r,eo),Uh.lengthSq()===0&&(Math.abs(r.z)===1?eo.x+=1e-4:eo.z+=1e-4,eo.normalize(),Uh.crossVectors(r,eo)),Uh.normalize(),D_.crossVectors(eo,Uh),n[0]=Uh.x,n[4]=D_.x,n[8]=eo.x,n[1]=Uh.y,n[5]=D_.y,n[9]=eo.y,n[2]=Uh.z,n[6]=D_.z,n[10]=eo.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,i){let r=t.elements,n=i.elements,s=this.elements,a=r[0],o=r[4],l=r[8],c=r[12],u=r[1],h=r[5],d=r[9],p=r[13],f=r[2],v=r[6],g=r[10],m=r[14],x=r[3],w=r[7],_=r[11],M=r[15],S=n[0],A=n[4],T=n[8],E=n[12],C=n[1],D=n[5],I=n[9],L=n[13],z=n[2],F=n[6],Q=n[10],Y=n[14],O=n[3],j=n[7],V=n[11],W=n[15];return s[0]=a*S+o*C+l*z+c*O,s[4]=a*A+o*D+l*F+c*j,s[8]=a*T+o*I+l*Q+c*V,s[12]=a*E+o*L+l*Y+c*W,s[1]=u*S+h*C+d*z+p*O,s[5]=u*A+h*D+d*F+p*j,s[9]=u*T+h*I+d*Q+p*V,s[13]=u*E+h*L+d*Y+p*W,s[2]=f*S+v*C+g*z+m*O,s[6]=f*A+v*D+g*F+m*j,s[10]=f*T+v*I+g*Q+m*V,s[14]=f*E+v*L+g*Y+m*W,s[3]=x*S+w*C+_*z+M*O,s[7]=x*A+w*D+_*F+M*j,s[11]=x*T+w*I+_*Q+M*V,s[15]=x*E+w*L+_*Y+M*W,this}multiplyScalar(t){let i=this.elements;return i[0]*=t,i[4]*=t,i[8]*=t,i[12]*=t,i[1]*=t,i[5]*=t,i[9]*=t,i[13]*=t,i[2]*=t,i[6]*=t,i[10]*=t,i[14]*=t,i[3]*=t,i[7]*=t,i[11]*=t,i[15]*=t,this}determinant(){let t=this.elements,i=t[0],r=t[4],n=t[8],s=t[12],a=t[1],o=t[5],l=t[9],c=t[13],u=t[2],h=t[6],d=t[10],p=t[14],f=t[3],v=t[7],g=t[11],m=t[15];return f*(+s*l*h-n*c*h-s*o*d+r*c*d+n*o*p-r*l*p)+v*(+i*l*p-i*c*d+s*a*d-n*a*p+n*c*u-s*l*u)+g*(+i*c*h-i*o*p-s*a*h+r*a*p+s*o*u-r*c*u)+m*(-n*o*u-i*l*h+i*o*d+n*a*h-r*a*d+r*l*u)}transpose(){let t=this.elements,i;return i=t[1],t[1]=t[4],t[4]=i,i=t[2],t[2]=t[8],t[8]=i,i=t[6],t[6]=t[9],t[9]=i,i=t[3],t[3]=t[12],t[12]=i,i=t[7],t[7]=t[13],t[13]=i,i=t[11],t[11]=t[14],t[14]=i,this}setPosition(t,i,r){let n=this.elements;return t.isVector3?(n[12]=t.x,n[13]=t.y,n[14]=t.z):(n[12]=t,n[13]=i,n[14]=r),this}invert(){let t=this.elements,i=t[0],r=t[1],n=t[2],s=t[3],a=t[4],o=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],v=t[13],g=t[14],m=t[15],x=h*g*c-v*d*c+v*l*p-o*g*p-h*l*m+o*d*m,w=f*d*c-u*g*c-f*l*p+a*g*p+u*l*m-a*d*m,_=u*v*c-f*h*c+f*o*p-a*v*p-u*o*m+a*h*m,M=f*h*l-u*v*l-f*o*d+a*v*d+u*o*g-a*h*g,S=i*x+r*w+n*_+s*M;if(S===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let A=1/S;return t[0]=x*A,t[1]=(v*d*s-h*g*s-v*n*p+r*g*p+h*n*m-r*d*m)*A,t[2]=(o*g*s-v*l*s+v*n*c-r*g*c-o*n*m+r*l*m)*A,t[3]=(h*l*s-o*d*s-h*n*c+r*d*c+o*n*p-r*l*p)*A,t[4]=w*A,t[5]=(u*g*s-f*d*s+f*n*p-i*g*p-u*n*m+i*d*m)*A,t[6]=(f*l*s-a*g*s-f*n*c+i*g*c+a*n*m-i*l*m)*A,t[7]=(a*d*s-u*l*s+u*n*c-i*d*c-a*n*p+i*l*p)*A,t[8]=_*A,t[9]=(f*h*s-u*v*s-f*r*p+i*v*p+u*r*m-i*h*m)*A,t[10]=(a*v*s-f*o*s+f*r*c-i*v*c-a*r*m+i*o*m)*A,t[11]=(u*o*s-a*h*s-u*r*c+i*h*c+a*r*p-i*o*p)*A,t[12]=M*A,t[13]=(u*v*n-f*h*n+f*r*d-i*v*d-u*r*g+i*h*g)*A,t[14]=(f*o*n-a*v*n-f*r*l+i*v*l+a*r*g-i*o*g)*A,t[15]=(a*h*n-u*o*n+u*r*l-i*h*l-a*r*d+i*o*d)*A,this}scale(t){let i=this.elements,r=t.x,n=t.y,s=t.z;return i[0]*=r,i[4]*=n,i[8]*=s,i[1]*=r,i[5]*=n,i[9]*=s,i[2]*=r,i[6]*=n,i[10]*=s,i[3]*=r,i[7]*=n,i[11]*=s,this}getMaxScaleOnAxis(){let t=this.elements,i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],r=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(i,r,n))}makeTranslation(t,i,r){return this.set(1,0,0,t,0,1,0,i,0,0,1,r,0,0,0,1),this}makeRotationX(t){let i=Math.cos(t),r=Math.sin(t);return this.set(1,0,0,0,0,i,-r,0,0,r,i,0,0,0,0,1),this}makeRotationY(t){let i=Math.cos(t),r=Math.sin(t);return this.set(i,0,r,0,0,1,0,0,-r,0,i,0,0,0,0,1),this}makeRotationZ(t){let i=Math.cos(t),r=Math.sin(t);return this.set(i,-r,0,0,r,i,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,i){let r=Math.cos(i),n=Math.sin(i),s=1-r,a=t.x,o=t.y,l=t.z,c=s*a,u=s*o;return this.set(c*a+r,c*o-n*l,c*l+n*o,0,c*o+n*l,u*o+r,u*l-n*a,0,c*l-n*o,u*l+n*a,s*l*l+r,0,0,0,0,1),this}makeScale(t,i,r){return this.set(t,0,0,0,0,i,0,0,0,0,r,0,0,0,0,1),this}makeShear(t,i,r,n,s,a){return this.set(1,r,s,0,t,1,a,0,i,n,1,0,0,0,0,1),this}compose(t,i,r){let n=this.elements,s=i._x,a=i._y,o=i._z,l=i._w,c=s+s,u=a+a,h=o+o,d=s*c,p=s*u,f=s*h,v=a*u,g=a*h,m=o*h,x=l*c,w=l*u,_=l*h,M=r.x,S=r.y,A=r.z;return n[0]=(1-(v+m))*M,n[1]=(p+_)*M,n[2]=(f-w)*M,n[3]=0,n[4]=(p-_)*S,n[5]=(1-(d+m))*S,n[6]=(g+x)*S,n[7]=0,n[8]=(f+w)*A,n[9]=(g-x)*A,n[10]=(1-(d+v))*A,n[11]=0,n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=1,this}decompose(t,i,r){let n=this.elements,s=Rm.set(n[0],n[1],n[2]).length(),a=Rm.set(n[4],n[5],n[6]).length(),o=Rm.set(n[8],n[9],n[10]).length();this.determinant()<0&&(s=-s),t.x=n[12],t.y=n[13],t.z=n[14],dl.copy(this);let l=1/s,c=1/a,u=1/o;return dl.elements[0]*=l,dl.elements[1]*=l,dl.elements[2]*=l,dl.elements[4]*=c,dl.elements[5]*=c,dl.elements[6]*=c,dl.elements[8]*=u,dl.elements[9]*=u,dl.elements[10]*=u,i.setFromRotationMatrix(dl),r.x=s,r.y=a,r.z=o,this}makePerspective(t,i,r,n,s,a){let o=this.elements,l=2*s/(i-t),c=2*s/(r-n),u=(i+t)/(i-t),h=(r+n)/(r-n),d=-(a+s)/(a-s),p=-2*a*s/(a-s);return o[0]=l,o[4]=0,o[8]=u,o[12]=0,o[1]=0,o[5]=c,o[9]=h,o[13]=0,o[2]=0,o[6]=0,o[10]=d,o[14]=p,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(t,i,r,n,s,a){let o=this.elements,l=1/(i-t),c=1/(r-n),u=1/(a-s),h=(i+t)*l,d=(r+n)*c,p=(a+s)*u;return o[0]=2*l,o[4]=0,o[8]=0,o[12]=-h,o[1]=0,o[5]=2*c,o[9]=0,o[13]=-d,o[2]=0,o[6]=0,o[10]=-2*u,o[14]=-p,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(t){let i=this.elements,r=t.elements;for(let n=0;n<16;n++)if(i[n]!==r[n])return!1;return!0}fromArray(t,i=0){for(let r=0;r<16;r++)this.elements[r]=t[r+i];return this}toArray(t=[],i=0){let r=this.elements;return t[i]=r[0],t[i+1]=r[1],t[i+2]=r[2],t[i+3]=r[3],t[i+4]=r[4],t[i+5]=r[5],t[i+6]=r[6],t[i+7]=r[7],t[i+8]=r[8],t[i+9]=r[9],t[i+10]=r[10],t[i+11]=r[11],t[i+12]=r[12],t[i+13]=r[13],t[i+14]=r[14],t[i+15]=r[15],t}},Rm=new B,dl=new ht,Woe=new B(0,0,0),Xoe=new B(1,1,1),Uh=new B,D_=new B,eo=new B,wV=new ht,bV=new ei,Nn=class{constructor(e=0,t=0,i=0,r=Nn.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,r=this._order){return this._x=e,this._y=t,this._z=i,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){let r=e.elements,n=r[0],s=r[4],a=r[8],o=r[1],l=r[5],c=r[9],u=r[2],h=r[6],d=r[10];switch(t){case"XYZ":this._y=Math.asin(vn(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-s,n)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-vn(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(a,d),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-u,n),this._z=0);break;case"ZXY":this._x=Math.asin(vn(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-u,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(o,n));break;case"ZYX":this._y=Math.asin(-vn(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(h,d),this._z=Math.atan2(o,n)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(vn(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-u,n)):(this._x=0,this._y=Math.atan2(a,d));break;case"XZY":this._z=Math.asin(-vn(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(a,n)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return wV.makeRotationFromQuaternion(e),this.setFromRotationMatrix(wV,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return bV.setFromEuler(this),this.setFromQuaternion(bV,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}};Nn.DEFAULT_ORDER="XYZ";var dB=class{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}},qoe=0,_V=new B,Im=new ei,uu=new ht,R_=new B,by=new B,Yoe=new B,Qoe=new ei,SV=new B(1,0,0),MV=new B(0,1,0),EV=new B(0,0,1),Koe={type:"added"},AV={type:"removed"},ir=class extends Cs{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:qoe++}),this.uuid=$o(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=ir.DEFAULT_UP.clone();let e=new B,t=new Nn,i=new ei,r=new B(1,1,1);function n(){i.setFromEuler(t,!1)}function s(){t.setFromQuaternion(i,void 0,!1)}t._onChange(n),i._onChange(s),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new ht},normalMatrix:{value:new Mn}}),this.matrix=new ht,this.matrixWorld=new ht,this.matrixAutoUpdate=ir.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=ir.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new dB,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Im.setFromAxisAngle(e,t),this.quaternion.multiply(Im),this}rotateOnWorldAxis(e,t){return Im.setFromAxisAngle(e,t),this.quaternion.premultiply(Im),this}rotateX(e){return this.rotateOnAxis(SV,e)}rotateY(e){return this.rotateOnAxis(MV,e)}rotateZ(e){return this.rotateOnAxis(EV,e)}translateOnAxis(e,t){return _V.copy(e).applyQuaternion(this.quaternion),this.position.add(_V.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(SV,e)}translateY(e){return this.translateOnAxis(MV,e)}translateZ(e){return this.translateOnAxis(EV,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(uu.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?R_.copy(e):R_.set(e,t,i);let r=this.parent;this.updateWorldMatrix(!0,!1),by.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?uu.lookAt(by,R_,this.up):uu.lookAt(R_,by,this.up),this.quaternion.setFromRotationMatrix(uu),r&&(uu.extractRotation(r.matrixWorld),Im.setFromRotationMatrix(uu),this.quaternion.premultiply(Im.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(Koe)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}let t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(AV)),this}removeFromParent(){let e=this.parent;return e!==null&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){let t=this.children[e];t.parent=null,t.dispatchEvent(AV)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),uu.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),uu.multiply(e.parent.matrixWorld)),e.applyMatrix4(uu),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,r=this.children.length;i<r;i++){let n=this.children[i].getObjectByProperty(e,t);if(n!==void 0)return n}}getObjectsByProperty(e,t){let i=[];this[e]===t&&i.push(this);for(let r=0,n=this.children.length;r<n;r++){let s=this.children[r].getObjectsByProperty(e,t);s.length>0&&(i=i.concat(s))}return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(by,e,Yoe),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(by,Qoe,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);let t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);let t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverseVisible(e)}traverseAncestors(e){let t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);let t=this.children;for(let i=0,r=t.length;i<r;i++){let n=t[i];(n.matrixWorldAutoUpdate===!0||e===!0)&&n.updateMatrixWorld(e)}}updateWorldMatrix(e,t){let i=this.parent;if(e===!0&&i!==null&&i.matrixWorldAutoUpdate===!0&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){let r=this.children;for(let n=0,s=r.length;n<s;n++){let a=r[n];a.matrixWorldAutoUpdate===!0&&a.updateWorldMatrix(!1,!0)}}}toJSON(e){let t=e===void 0||typeof e=="string",i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});let r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON()));function n(a,o){return a[o.uuid]===void 0&&(a[o.uuid]=o.toJSON(e)),o.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=n(e.geometries,this.geometry);let a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){let o=a.shapes;if(Array.isArray(o))for(let l=0,c=o.length;l<c;l++){let u=o[l];n(e.shapes,u)}else n(e.shapes,o)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(n(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){let a=[];for(let o=0,l=this.material.length;o<l;o++)a.push(n(e.materials,this.material[o]));r.material=a}else r.material=n(e.materials,this.material);if(this.children.length>0){r.children=[];for(let a=0;a<this.children.length;a++)r.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let a=0;a<this.animations.length;a++){let o=this.animations[a];r.animations.push(n(e.animations,o))}}if(t){let a=s(e.geometries),o=s(e.materials),l=s(e.textures),c=s(e.images),u=s(e.shapes),h=s(e.skeletons),d=s(e.animations),p=s(e.nodes);a.length>0&&(i.geometries=a),o.length>0&&(i.materials=o),l.length>0&&(i.textures=l),c.length>0&&(i.images=c),u.length>0&&(i.shapes=u),h.length>0&&(i.skeletons=h),d.length>0&&(i.animations=d),p.length>0&&(i.nodes=p)}return i.object=r,i;function s(a){let o=[];for(let l in a){let c=a[l];delete c.metadata,o.push(c)}return o}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let i=0;i<e.children.length;i++){let r=e.children[i];this.add(r.clone())}return this}};ir.DEFAULT_UP=new B(0,1,0);ir.DEFAULT_MATRIX_AUTO_UPDATE=!0;ir.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;var pl=new B,hu=new B,FD=new B,du=new B,Lm=new B,Om=new B,CV=new B,VD=new B,HD=new B,GD=new B,ws=class{constructor(e=new B,t=new B,i=new B){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,r){r.subVectors(i,t),pl.subVectors(e,t),r.cross(pl);let n=r.lengthSq();return n>0?r.multiplyScalar(1/Math.sqrt(n)):r.set(0,0,0)}static getBarycoord(e,t,i,r,n){pl.subVectors(r,t),hu.subVectors(i,t),FD.subVectors(e,t);let s=pl.dot(pl),a=pl.dot(hu),o=pl.dot(FD),l=hu.dot(hu),c=hu.dot(FD),u=s*l-a*a;if(u===0)return n.set(-2,-1,-1);let h=1/u,d=(l*o-a*c)*h,p=(s*c-a*o)*h;return n.set(1-d-p,p,d)}static containsPoint(e,t,i,r){return this.getBarycoord(e,t,i,r,du),du.x>=0&&du.y>=0&&du.x+du.y<=1}static getUV(e,t,i,r,n,s,a,o){return this.getBarycoord(e,t,i,r,du),o.set(0,0),o.addScaledVector(n,du.x),o.addScaledVector(s,du.y),o.addScaledVector(a,du.z),o}static isFrontFacing(e,t,i,r){return pl.subVectors(i,t),hu.subVectors(e,t),pl.cross(hu).dot(r)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,r){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,i,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return pl.subVectors(this.c,this.b),hu.subVectors(this.a,this.b),pl.cross(hu).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return ws.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return ws.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,i,r,n){return ws.getUV(e,this.a,this.b,this.c,t,i,r,n)}containsPoint(e){return ws.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return ws.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){let i=this.a,r=this.b,n=this.c,s,a;Lm.subVectors(r,i),Om.subVectors(n,i),VD.subVectors(e,i);let o=Lm.dot(VD),l=Om.dot(VD);if(o<=0&&l<=0)return t.copy(i);HD.subVectors(e,r);let c=Lm.dot(HD),u=Om.dot(HD);if(c>=0&&u<=c)return t.copy(r);let h=o*u-c*l;if(h<=0&&o>=0&&c<=0)return s=o/(o-c),t.copy(i).addScaledVector(Lm,s);GD.subVectors(e,n);let d=Lm.dot(GD),p=Om.dot(GD);if(p>=0&&d<=p)return t.copy(n);let f=d*l-o*p;if(f<=0&&l>=0&&p<=0)return a=l/(l-p),t.copy(i).addScaledVector(Om,a);let v=c*p-d*u;if(v<=0&&u-c>=0&&d-p>=0)return CV.subVectors(n,r),a=(u-c)/(u-c+(d-p)),t.copy(r).addScaledVector(CV,a);let g=1/(v+f+h);return s=f*g,a=h*g,t.copy(i).addScaledVector(Lm,s).addScaledVector(Om,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}},Zoe=0,Ow=class extends Cs{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Zoe++}),this.uuid=$o(),this.name="",this.type="Material",this.blending=_f,this.side=Fl,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=yY,this.blendDst=xY,this.blendEquation=Lg,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=PL,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Eoe,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=TD,this.stencilZFail=TD,this.stencilZPass=TD,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(let t in e){let i=e[t];if(i===void 0){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}let r=this[t];if(r===void 0){console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.");continue}r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[t]=i}}toJSON(e){let t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});let i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==_f&&(i.blending=this.blending),this.side!==Fl&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(i.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=this.premultipliedAlpha),this.forceSinglePass===!0&&(i.forceSinglePass=this.forceSinglePass),this.wireframe===!0&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=this.flatShading),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function r(n){let s=[];for(let a in n){let o=n[a];delete o.metadata,s.push(o)}return s}if(t){let n=r(e.textures),s=r(e.images);n.length>0&&(i.textures=n),s.length>0&&(i.images=s)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;let t=e.clippingPlanes,i=null;if(t!==null){let r=t.length;i=new Array(r);for(let n=0;n!==r;++n)i[n]=t[n].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}},uh=class extends Ow{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new jt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=wY,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}},fn=new B,I_=new ve,$t=class{constructor(t,i,r=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=i,this.count=t!==void 0?t.length/i:0,this.normalized=r,this.usage=LL,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this}copyAt(t,i,r){t*=this.itemSize,r*=i.itemSize;for(let n=0,s=this.itemSize;n<s;n++)this.array[t+n]=i.array[r+n];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(this.itemSize===2)for(let i=0,r=this.count;i<r;i++)I_.fromBufferAttribute(this,i),I_.applyMatrix3(t),this.setXY(i,I_.x,I_.y);else if(this.itemSize===3)for(let i=0,r=this.count;i<r;i++)fn.fromBufferAttribute(this,i),fn.applyMatrix3(t),this.setXYZ(i,fn.x,fn.y,fn.z);return this}applyMatrix4(t){for(let i=0,r=this.count;i<r;i++)fn.fromBufferAttribute(this,i),fn.applyMatrix4(t),this.setXYZ(i,fn.x,fn.y,fn.z);return this}applyNormalMatrix(t){for(let i=0,r=this.count;i<r;i++)fn.fromBufferAttribute(this,i),fn.applyNormalMatrix(t),this.setXYZ(i,fn.x,fn.y,fn.z);return this}transformDirection(t){for(let i=0,r=this.count;i<r;i++)fn.fromBufferAttribute(this,i),fn.transformDirection(t),this.setXYZ(i,fn.x,fn.y,fn.z);return this}set(t,i=0){return this.array.set(t,i),this}getX(t){let i=this.array[t*this.itemSize];return this.normalized&&(i=Yu(i,this.array)),i}setX(t,i){return this.normalized&&(i=gr(i,this.array)),this.array[t*this.itemSize]=i,this}getY(t){let i=this.array[t*this.itemSize+1];return this.normalized&&(i=Yu(i,this.array)),i}setY(t,i){return this.normalized&&(i=gr(i,this.array)),this.array[t*this.itemSize+1]=i,this}getZ(t){let i=this.array[t*this.itemSize+2];return this.normalized&&(i=Yu(i,this.array)),i}setZ(t,i){return this.normalized&&(i=gr(i,this.array)),this.array[t*this.itemSize+2]=i,this}getW(t){let i=this.array[t*this.itemSize+3];return this.normalized&&(i=Yu(i,this.array)),i}setW(t,i){return this.normalized&&(i=gr(i,this.array)),this.array[t*this.itemSize+3]=i,this}setXY(t,i,r){return t*=this.itemSize,this.normalized&&(i=gr(i,this.array),r=gr(r,this.array)),this.array[t+0]=i,this.array[t+1]=r,this}setXYZ(t,i,r,n){return t*=this.itemSize,this.normalized&&(i=gr(i,this.array),r=gr(r,this.array),n=gr(n,this.array)),this.array[t+0]=i,this.array[t+1]=r,this.array[t+2]=n,this}setXYZW(t,i,r,n,s){return t*=this.itemSize,this.normalized&&(i=gr(i,this.array),r=gr(r,this.array),n=gr(n,this.array),s=gr(s,this.array)),this.array[t+0]=i,this.array[t+1]=r,this.array[t+2]=n,this.array[t+3]=s,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(t.name=this.name),this.usage!==LL&&(t.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(t.updateRange=this.updateRange),t}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}},LY=class extends $t{constructor(e,t,i){super(new Uint16Array(e),t,i)}},bv=class extends $t{constructor(e,t,i){super(new Uint32Array(e),t,i)}},St=class extends $t{constructor(t,i,r){super(new Float32Array(t),i,r)}},$oe=0,Ro=new ht,jD=new ir,zm=new B,to=new cn,_y=new cn,qn=new B,Bt=class extends Cs{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:$oe++}),this.uuid=$o(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(TY(t)?bv:LY)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,i){return this.attributes[t]=i,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return this.attributes[t]!==void 0}addGroup(t,i,r=0){this.groups.push({start:t,count:i,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(t,i){this.drawRange.start=t,this.drawRange.count=i}applyMatrix4(t){let i=this.attributes.position;i!==void 0&&(i.applyMatrix4(t),i.needsUpdate=!0);let r=this.attributes.normal;if(r!==void 0){let s=new Mn().getNormalMatrix(t);r.applyNormalMatrix(s),r.needsUpdate=!0}let n=this.attributes.tangent;return n!==void 0&&(n.transformDirection(t),n.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(t){return Ro.makeRotationFromQuaternion(t),this.applyMatrix4(Ro),this}rotateX(t){return Ro.makeRotationX(t),this.applyMatrix4(Ro),this}rotateY(t){return Ro.makeRotationY(t),this.applyMatrix4(Ro),this}rotateZ(t){return Ro.makeRotationZ(t),this.applyMatrix4(Ro),this}translate(t,i,r){return Ro.makeTranslation(t,i,r),this.applyMatrix4(Ro),this}scale(t,i,r){return Ro.makeScale(t,i,r),this.applyMatrix4(Ro),this}lookAt(t){return jD.lookAt(t),jD.updateMatrix(),this.applyMatrix4(jD.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(zm).negate(),this.translate(zm.x,zm.y,zm.z),this}setFromPoints(t){let i=[];for(let r=0,n=t.length;r<n;r++){let s=t[r];i.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new St(i,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new cn);let t=this.attributes.position,i=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new B(-1/0,-1/0,-1/0),new B(1/0,1/0,1/0));return}if(t!==void 0){if(this.boundingBox.setFromBufferAttribute(t),i)for(let r=0,n=i.length;r<n;r++){let s=i[r];to.setFromBufferAttribute(s),this.morphTargetsRelative?(qn.addVectors(this.boundingBox.min,to.min),this.boundingBox.expandByPoint(qn),qn.addVectors(this.boundingBox.max,to.max),this.boundingBox.expandByPoint(qn)):(this.boundingBox.expandByPoint(to.min),this.boundingBox.expandByPoint(to.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new ja);let t=this.attributes.position,i=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new B,1/0);return}if(t){let r=this.boundingSphere.center;if(to.setFromBufferAttribute(t),i)for(let s=0,a=i.length;s<a;s++){let o=i[s];_y.setFromBufferAttribute(o),this.morphTargetsRelative?(qn.addVectors(to.min,_y.min),to.expandByPoint(qn),qn.addVectors(to.max,_y.max),to.expandByPoint(qn)):(to.expandByPoint(_y.min),to.expandByPoint(_y.max))}to.getCenter(r);let n=0;for(let s=0,a=t.count;s<a;s++)qn.fromBufferAttribute(t,s),n=Math.max(n,r.distanceToSquared(qn));if(i)for(let s=0,a=i.length;s<a;s++){let o=i[s],l=this.morphTargetsRelative;for(let c=0,u=o.count;c<u;c++)qn.fromBufferAttribute(o,c),l&&(zm.fromBufferAttribute(t,c),qn.add(zm)),n=Math.max(n,r.distanceToSquared(qn))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){let t=this.index,i=this.attributes;if(t===null||i.position===void 0||i.normal===void 0||i.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}let r=t.array,n=i.position.array,s=i.normal.array,a=i.uv.array,o=n.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new $t(new Float32Array(4*o),4));let l=this.getAttribute("tangent").array,c=[],u=[];for(let C=0;C<o;C++)c[C]=new B,u[C]=new B;let h=new B,d=new B,p=new B,f=new ve,v=new ve,g=new ve,m=new B,x=new B;function w(C,D,I){h.fromArray(n,C*3),d.fromArray(n,D*3),p.fromArray(n,I*3),f.fromArray(a,C*2),v.fromArray(a,D*2),g.fromArray(a,I*2),d.sub(h),p.sub(h),v.sub(f),g.sub(f);let L=1/(v.x*g.y-g.x*v.y);!isFinite(L)||(m.copy(d).multiplyScalar(g.y).addScaledVector(p,-v.y).multiplyScalar(L),x.copy(p).multiplyScalar(v.x).addScaledVector(d,-g.x).multiplyScalar(L),c[C].add(m),c[D].add(m),c[I].add(m),u[C].add(x),u[D].add(x),u[I].add(x))}let _=this.groups;_.length===0&&(_=[{start:0,count:r.length}]);for(let C=0,D=_.length;C<D;++C){let I=_[C],L=I.start,z=I.count;for(let F=L,Q=L+z;F<Q;F+=3)w(r[F+0],r[F+1],r[F+2])}let M=new B,S=new B,A=new B,T=new B;function E(C){A.fromArray(s,C*3),T.copy(A);let D=c[C];M.copy(D),M.sub(A.multiplyScalar(A.dot(D))).normalize(),S.crossVectors(T,D);let I=S.dot(u[C])<0?-1:1;l[C*4]=M.x,l[C*4+1]=M.y,l[C*4+2]=M.z,l[C*4+3]=I}for(let C=0,D=_.length;C<D;++C){let I=_[C],L=I.start,z=I.count;for(let F=L,Q=L+z;F<Q;F+=3)E(r[F+0]),E(r[F+1]),E(r[F+2])}}computeVertexNormals(){let t=this.index,i=this.getAttribute("position");if(i!==void 0){let r=this.getAttribute("normal");if(r===void 0)r=new $t(new Float32Array(i.count*3),3),this.setAttribute("normal",r);else for(let d=0,p=r.count;d<p;d++)r.setXYZ(d,0,0,0);let n=new B,s=new B,a=new B,o=new B,l=new B,c=new B,u=new B,h=new B;if(t)for(let d=0,p=t.count;d<p;d+=3){let f=t.getX(d+0),v=t.getX(d+1),g=t.getX(d+2);n.fromBufferAttribute(i,f),s.fromBufferAttribute(i,v),a.fromBufferAttribute(i,g),u.subVectors(a,s),h.subVectors(n,s),u.cross(h),o.fromBufferAttribute(r,f),l.fromBufferAttribute(r,v),c.fromBufferAttribute(r,g),o.add(u),l.add(u),c.add(u),r.setXYZ(f,o.x,o.y,o.z),r.setXYZ(v,l.x,l.y,l.z),r.setXYZ(g,c.x,c.y,c.z)}else for(let d=0,p=i.count;d<p;d+=3)n.fromBufferAttribute(i,d+0),s.fromBufferAttribute(i,d+1),a.fromBufferAttribute(i,d+2),u.subVectors(a,s),h.subVectors(n,s),u.cross(h),r.setXYZ(d+0,u.x,u.y,u.z),r.setXYZ(d+1,u.x,u.y,u.z),r.setXYZ(d+2,u.x,u.y,u.z);this.normalizeNormals(),r.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){let t=this.attributes.normal;for(let i=0,r=t.count;i<r;i++)qn.fromBufferAttribute(t,i),qn.normalize(),t.setXYZ(i,qn.x,qn.y,qn.z)}toNonIndexed(){function t(o,l){let c=o.array,u=o.itemSize,h=o.normalized,d=new c.constructor(l.length*u),p=0,f=0;for(let v=0,g=l.length;v<g;v++){o.isInterleavedBufferAttribute?p=l[v]*o.data.stride+o.offset:p=l[v]*u;for(let m=0;m<u;m++)d[f++]=c[p++]}return new $t(d,u,h)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let i=new Bt,r=this.index.array,n=this.attributes;for(let o in n){let l=n[o],c=t(l,r);i.setAttribute(o,c)}let s=this.morphAttributes;for(let o in s){let l=[],c=s[o];for(let u=0,h=c.length;u<h;u++){let d=c[u],p=t(d,r);l.push(p)}i.morphAttributes[o]=l}i.morphTargetsRelative=this.morphTargetsRelative;let a=this.groups;for(let o=0,l=a.length;o<l;o++){let c=a[o];i.addGroup(c.start,c.count,c.materialIndex)}return i}toJSON(){let t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),this.parameters!==void 0){let l=this.parameters;for(let c in l)l[c]!==void 0&&(t[c]=l[c]);return t}t.data={attributes:{}};let i=this.index;i!==null&&(t.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)});let r=this.attributes;for(let l in r){let c=r[l];t.data.attributes[l]=c.toJSON(t.data)}let n={},s=!1;for(let l in this.morphAttributes){let c=this.morphAttributes[l],u=[];for(let h=0,d=c.length;h<d;h++){let p=c[h];u.push(p.toJSON(t.data))}u.length>0&&(n[l]=u,s=!0)}s&&(t.data.morphAttributes=n,t.data.morphTargetsRelative=this.morphTargetsRelative);let a=this.groups;a.length>0&&(t.data.groups=JSON.parse(JSON.stringify(a)));let o=this.boundingSphere;return o!==null&&(t.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),t}clone(){return new this.constructor().copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let i={};this.name=t.name;let r=t.index;r!==null&&this.setIndex(r.clone(i));let n=t.attributes;for(let c in n){let u=n[c];this.setAttribute(c,u.clone(i))}let s=t.morphAttributes;for(let c in s){let u=[],h=s[c];for(let d=0,p=h.length;d<p;d++)u.push(h[d].clone(i));this.morphAttributes[c]=u}this.morphTargetsRelative=t.morphTargetsRelative;let a=t.groups;for(let c=0,u=a.length;c<u;c++){let h=a[c];this.addGroup(h.start,h.count,h.materialIndex)}let o=t.boundingBox;o!==null&&(this.boundingBox=o.clone());let l=t.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,t.parameters!==void 0&&(this.parameters=Object.assign({},t.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}},TV=new ht,Nm=new _0,WD=new ja,Sy=new B,My=new B,Ey=new B,XD=new B,L_=new B,O_=new ve,z_=new ve,N_=new ve,qD=new B,B_=new B,zr=class extends ir{constructor(e=new Bt,t=new uh){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){let e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){let i=e[t[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,n=i.length;r<n;r++){let s=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=r}}}}getVertexPosition(e,t){let i=this.geometry,r=i.attributes.position,n=i.morphAttributes.position,s=i.morphTargetsRelative;t.fromBufferAttribute(r,e);let a=this.morphTargetInfluences;if(n&&a){L_.set(0,0,0);for(let o=0,l=n.length;o<l;o++){let c=a[o],u=n[o];c!==0&&(XD.fromBufferAttribute(u,e),s?L_.addScaledVector(XD,c):L_.addScaledVector(XD.sub(t),c))}t.add(L_)}return this.isSkinnedMesh&&this.boneTransform(e,t),t}raycast(e,t){let i=this.geometry,r=this.material,n=this.matrixWorld;if(r===void 0||(i.boundingSphere===null&&i.computeBoundingSphere(),WD.copy(i.boundingSphere),WD.applyMatrix4(n),e.ray.intersectsSphere(WD)===!1)||(TV.copy(n).invert(),Nm.copy(e.ray).applyMatrix4(TV),i.boundingBox!==null&&Nm.intersectsBox(i.boundingBox)===!1))return;let s,a=i.index,o=i.attributes.position,l=i.attributes.uv,c=i.attributes.uv2,u=i.groups,h=i.drawRange;if(a!==null)if(Array.isArray(r))for(let d=0,p=u.length;d<p;d++){let f=u[d],v=r[f.materialIndex],g=Math.max(f.start,h.start),m=Math.min(a.count,Math.min(f.start+f.count,h.start+h.count));for(let x=g,w=m;x<w;x+=3){let _=a.getX(x),M=a.getX(x+1),S=a.getX(x+2);s=k_(this,v,e,Nm,l,c,_,M,S),s&&(s.faceIndex=Math.floor(x/3),s.face.materialIndex=f.materialIndex,t.push(s))}}else{let d=Math.max(0,h.start),p=Math.min(a.count,h.start+h.count);for(let f=d,v=p;f<v;f+=3){let g=a.getX(f),m=a.getX(f+1),x=a.getX(f+2);s=k_(this,r,e,Nm,l,c,g,m,x),s&&(s.faceIndex=Math.floor(f/3),t.push(s))}}else if(o!==void 0)if(Array.isArray(r))for(let d=0,p=u.length;d<p;d++){let f=u[d],v=r[f.materialIndex],g=Math.max(f.start,h.start),m=Math.min(o.count,Math.min(f.start+f.count,h.start+h.count));for(let x=g,w=m;x<w;x+=3){let _=x,M=x+1,S=x+2;s=k_(this,v,e,Nm,l,c,_,M,S),s&&(s.faceIndex=Math.floor(x/3),s.face.materialIndex=f.materialIndex,t.push(s))}}else{let d=Math.max(0,h.start),p=Math.min(o.count,h.start+h.count);for(let f=d,v=p;f<v;f+=3){let g=f,m=f+1,x=f+2;s=k_(this,r,e,Nm,l,c,g,m,x),s&&(s.faceIndex=Math.floor(f/3),t.push(s))}}}};function Joe(e,t,i,r,n,s,a,o){let l;if(t.side===ns?l=r.intersectTriangle(a,s,n,!0,o):l=r.intersectTriangle(n,s,a,t.side===Fl,o),l===null)return null;B_.copy(o),B_.applyMatrix4(e.matrixWorld);let c=i.ray.origin.distanceTo(B_);return c<i.near||c>i.far?null:{distance:c,point:B_.clone(),object:e}}function k_(e,t,i,r,n,s,a,o,l){e.getVertexPosition(a,Sy),e.getVertexPosition(o,My),e.getVertexPosition(l,Ey);let c=Joe(e,t,i,r,Sy,My,Ey,qD);if(c){n&&(O_.fromBufferAttribute(n,a),z_.fromBufferAttribute(n,o),N_.fromBufferAttribute(n,l),c.uv=ws.getUV(qD,Sy,My,Ey,O_,z_,N_,new ve)),s&&(O_.fromBufferAttribute(s,a),z_.fromBufferAttribute(s,o),N_.fromBufferAttribute(s,l),c.uv2=ws.getUV(qD,Sy,My,Ey,O_,z_,N_,new ve));let u={a,b:o,c:l,normal:new B,materialIndex:0};ws.getNormal(Sy,My,Ey,u.normal),c.face=u}return c}var Hl=class extends Bt{constructor(e=1,t=1,i=1,r=1,n=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:r,heightSegments:n,depthSegments:s};let a=this;r=Math.floor(r),n=Math.floor(n),s=Math.floor(s);let o=[],l=[],c=[],u=[],h=0,d=0;p("z","y","x",-1,-1,i,t,e,s,n,0),p("z","y","x",1,-1,i,t,-e,s,n,1),p("x","z","y",1,1,e,i,t,r,s,2),p("x","z","y",1,-1,e,i,-t,r,s,3),p("x","y","z",1,-1,e,t,i,r,n,4),p("x","y","z",-1,-1,e,t,-i,r,n,5),this.setIndex(o),this.setAttribute("position",new St(l,3)),this.setAttribute("normal",new St(c,3)),this.setAttribute("uv",new St(u,2));function p(f,v,g,m,x,w,_,M,S,A,T){let E=w/S,C=_/A,D=w/2,I=_/2,L=M/2,z=S+1,F=A+1,Q=0,Y=0,O=new B;for(let j=0;j<F;j++){let V=j*C-I;for(let W=0;W<z;W++){let J=W*E-D;O[f]=J*m,O[v]=V*x,O[g]=L,l.push(O.x,O.y,O.z),O[f]=0,O[v]=0,O[g]=M>0?1:-1,c.push(O.x,O.y,O.z),u.push(W/S),u.push(1-j/A),Q+=1}}for(let j=0;j<A;j++)for(let V=0;V<S;V++){let W=h+V+z*j,J=h+V+z*(j+1),ce=h+(V+1)+z*(j+1),$=h+(V+1)+z*j;o.push(W,J,$),o.push(J,ce,$),Y+=6}a.addGroup(d,Y,T),d+=Y,h+=Q}}static fromJSON(e){return new Hl(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}};function Xv(e){let t={};for(let i in e){t[i]={};for(let r in e[i]){let n=e[i][r];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture||n.isQuaternion)?t[i][r]=n.clone():Array.isArray(n)?t[i][r]=n.slice():t[i][r]=n}}return t}function la(e){let t={};for(let i=0;i<e.length;i++){let r=Xv(e[i]);for(let n in r)t[n]=r[n]}return t}function ele(e){let t=[];for(let i=0;i<e.length;i++)t.push(e[i].clone());return t}function OY(e){return e.getRenderTarget()===null&&e.outputEncoding===hi?xc:yA}var S0={clone:Xv,merge:la},tle=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,ile=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,Ui=class extends Ow{constructor(t){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=tle,this.fragmentShader=ile,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,t!==void 0&&this.setValues(t)}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=Xv(t.uniforms),this.uniformsGroups=ele(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){let i=super.toJSON(t);i.glslVersion=this.glslVersion,i.uniforms={};for(let n in this.uniforms){let s=this.uniforms[n].value;s&&s.isTexture?i.uniforms[n]={type:"t",value:s.toJSON(t).uuid}:s&&s.isColor?i.uniforms[n]={type:"c",value:s.getHex()}:s&&s.isVector2?i.uniforms[n]={type:"v2",value:s.toArray()}:s&&s.isVector3?i.uniforms[n]={type:"v3",value:s.toArray()}:s&&s.isVector4?i.uniforms[n]={type:"v4",value:s.toArray()}:s&&s.isMatrix3?i.uniforms[n]={type:"m3",value:s.toArray()}:s&&s.isMatrix4?i.uniforms[n]={type:"m4",value:s.toArray()}:i.uniforms[n]={value:s}}Object.keys(this.defines).length>0&&(i.defines=this.defines),i.vertexShader=this.vertexShader,i.fragmentShader=this.fragmentShader;let r={};for(let n in this.extensions)this.extensions[n]===!0&&(r[n]=!0);return Object.keys(r).length>0&&(i.extensions=r),i}},tm=class extends ir{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new ht,this.projectionMatrix=new ht,this.projectionMatrixInverse=new ht}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}},Gs=class extends tm{constructor(e=50,t=1,i=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){let t=.5*this.getFilmHeight()/e;this.fov=R1*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){let e=Math.tan(Hx*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return R1*2*Math.atan(Math.tan(Hx*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,i,r,n,s){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=n,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=this.near,t=e*Math.tan(Hx*.5*this.fov)/this.zoom,i=2*t,r=this.aspect*i,n=-.5*r,s=this.view;if(this.view!==null&&this.view.enabled){let o=s.fullWidth,l=s.fullHeight;n+=s.offsetX*r/o,t-=s.offsetY*i/l,r*=s.width/o,i*=s.height/l}let a=this.filmOffset;a!==0&&(n+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(n,n+r,t,t-i,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}},Bm=-90,km=1,rle=class extends ir{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i;let r=new Gs(Bm,km,e,t);r.layers=this.layers,r.up.set(0,1,0),r.lookAt(1,0,0),this.add(r);let n=new Gs(Bm,km,e,t);n.layers=this.layers,n.up.set(0,1,0),n.lookAt(-1,0,0),this.add(n);let s=new Gs(Bm,km,e,t);s.layers=this.layers,s.up.set(0,0,-1),s.lookAt(0,1,0),this.add(s);let a=new Gs(Bm,km,e,t);a.layers=this.layers,a.up.set(0,0,1),a.lookAt(0,-1,0),this.add(a);let o=new Gs(Bm,km,e,t);o.layers=this.layers,o.up.set(0,1,0),o.lookAt(0,0,1),this.add(o);let l=new Gs(Bm,km,e,t);l.layers=this.layers,l.up.set(0,1,0),l.lookAt(0,0,-1),this.add(l)}update(e,t){this.parent===null&&this.updateMatrixWorld();let i=this.renderTarget,[r,n,s,a,o,l]=this.children,c=e.getRenderTarget(),u=e.toneMapping,h=e.xr.enabled;e.toneMapping=kc,e.xr.enabled=!1;let d=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0),e.render(t,r),e.setRenderTarget(i,1),e.render(t,n),e.setRenderTarget(i,2),e.render(t,s),e.setRenderTarget(i,3),e.render(t,a),e.setRenderTarget(i,4),e.render(t,o),i.texture.generateMipmaps=d,e.setRenderTarget(i,5),e.render(t,l),e.setRenderTarget(c),e.toneMapping=u,e.xr.enabled=h,i.texture.needsPMREMUpdate=!0}},pB=class extends Br{constructor(e,t,i,r,n,s,a,o,l,c){e=e!==void 0?e:[],t=t!==void 0?t:Vf,super(e,t,i,r,n,s,a,o,l,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}},nle=class extends Wi{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;let i={width:e,height:e,depth:1},r=[i,i,i,i,i,i];this.texture=new pB(r,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:pi}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;let i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new Hl(5,5,5),n=new Ui({name:"CubemapFromEquirect",uniforms:Xv(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:ns,blending:An});n.uniforms.tEquirect.value=t;let s=new zr(r,n),a=t.minFilter;return t.minFilter===Wv&&(t.minFilter=pi),new rle(1,10,this).update(e,s),t.minFilter=a,s.geometry.dispose(),s.material.dispose(),this}clear(e,t,i,r){let n=e.getRenderTarget();for(let s=0;s<6;s++)e.setRenderTarget(this,s),e.clear(t,i,r);e.setRenderTarget(n)}},YD=new B,sle=new B,ale=new Mn,Ia=class{constructor(e=new B(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){let r=YD.subVectors(i,t).cross(sle.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){let e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){let i=e.delta(YD),r=this.normal.dot(i);if(r===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;let n=-(e.start.dot(this.normal)+this.constant)/r;return n<0||n>1?null:t.copy(i).multiplyScalar(n).add(e.start)}intersectsLine(e){let t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){let i=t||ale.getNormalMatrix(e),r=this.coplanarPoint(YD).applyMatrix4(e),n=this.normal.applyMatrix3(i).normalize();return this.constant=-r.dot(n),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}},Um=new ja,U_=new B,fB=class{constructor(e=new Ia,t=new Ia,i=new Ia,r=new Ia,n=new Ia,s=new Ia){this.planes=[e,t,i,r,n,s]}set(e,t,i,r,n,s){let a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(i),a[3].copy(r),a[4].copy(n),a[5].copy(s),this}copy(e){let t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e){let t=this.planes,i=e.elements,r=i[0],n=i[1],s=i[2],a=i[3],o=i[4],l=i[5],c=i[6],u=i[7],h=i[8],d=i[9],p=i[10],f=i[11],v=i[12],g=i[13],m=i[14],x=i[15];return t[0].setComponents(a-r,u-o,f-h,x-v).normalize(),t[1].setComponents(a+r,u+o,f+h,x+v).normalize(),t[2].setComponents(a+n,u+l,f+d,x+g).normalize(),t[3].setComponents(a-n,u-l,f-d,x-g).normalize(),t[4].setComponents(a-s,u-c,f-p,x-m).normalize(),t[5].setComponents(a+s,u+c,f+p,x+m).normalize(),this}intersectsObject(e){let t=e.geometry;return t.boundingSphere===null&&t.computeBoundingSphere(),Um.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Um)}intersectsSprite(e){return Um.center.set(0,0,0),Um.radius=.7071067811865476,Um.applyMatrix4(e.matrixWorld),this.intersectsSphere(Um)}intersectsSphere(e){let t=this.planes,i=e.center,r=-e.radius;for(let n=0;n<6;n++)if(t[n].distanceToPoint(i)<r)return!1;return!0}intersectsBox(e){let t=this.planes;for(let i=0;i<6;i++){let r=t[i];if(U_.x=r.normal.x>0?e.max.x:e.min.x,U_.y=r.normal.y>0?e.max.y:e.min.y,U_.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(U_)<0)return!1}return!0}containsPoint(e){let t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}};function zY(){let e=null,t=!1,i=null,r=null;function n(s,a){i(s,a),r=e.requestAnimationFrame(n)}return{start:function(){t!==!0&&i!==null&&(r=e.requestAnimationFrame(n),t=!0)},stop:function(){e.cancelAnimationFrame(r),t=!1},setAnimationLoop:function(s){i=s},setContext:function(s){e=s}}}function ole(e,t){let i=t.isWebGL2,r=new WeakMap;function n(c,u){let h=c.array,d=c.usage,p=e.createBuffer();e.bindBuffer(u,p),e.bufferData(u,h,d),c.onUploadCallback();let f;if(h instanceof Float32Array)f=5126;else if(h instanceof Uint16Array)if(c.isFloat16BufferAttribute)if(i)f=5131;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else f=5123;else if(h instanceof Int16Array)f=5122;else if(h instanceof Uint32Array)f=5125;else if(h instanceof Int32Array)f=5124;else if(h instanceof Int8Array)f=5120;else if(h instanceof Uint8Array)f=5121;else if(h instanceof Uint8ClampedArray)f=5121;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+h);return{buffer:p,type:f,bytesPerElement:h.BYTES_PER_ELEMENT,version:c.version}}function s(c,u,h){let d=u.array,p=u.updateRange;e.bindBuffer(h,c),p.count===-1?e.bufferSubData(h,0,d):(i?e.bufferSubData(h,p.offset*d.BYTES_PER_ELEMENT,d,p.offset,p.count):e.bufferSubData(h,p.offset*d.BYTES_PER_ELEMENT,d.subarray(p.offset,p.offset+p.count)),p.count=-1),u.onUploadCallback()}function a(c){return c.isInterleavedBufferAttribute&&(c=c.data),r.get(c)}function o(c){c.isInterleavedBufferAttribute&&(c=c.data);let u=r.get(c);u&&(e.deleteBuffer(u.buffer),r.delete(c))}function l(c,u){if(c.isGLBufferAttribute){let d=r.get(c);(!d||d.version<c.version)&&r.set(c,{buffer:c.buffer,type:c.type,bytesPerElement:c.elementSize,version:c.version});return}c.isInterleavedBufferAttribute&&(c=c.data);let h=r.get(c);h===void 0?r.set(c,n(c,u)):h.version<c.version&&(s(h.buffer,c,u),h.version=c.version)}return{get:a,remove:o,update:l}}var hh=class extends Bt{constructor(e=1,t=1,i=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:r};let n=e/2,s=t/2,a=Math.floor(i),o=Math.floor(r),l=a+1,c=o+1,u=e/a,h=t/o,d=[],p=[],f=[],v=[];for(let g=0;g<c;g++){let m=g*h-s;for(let x=0;x<l;x++){let w=x*u-n;p.push(w,-m,0),f.push(0,0,1),v.push(x/a),v.push(1-g/o)}}for(let g=0;g<o;g++)for(let m=0;m<a;m++){let x=m+l*g,w=m+l*(g+1),_=m+1+l*(g+1),M=m+1+l*g;d.push(x,w,M),d.push(w,_,M)}this.setIndex(d),this.setAttribute("position",new St(p,3)),this.setAttribute("normal",new St(f,3)),this.setAttribute("uv",new St(v,2))}static fromJSON(e){return new hh(e.width,e.height,e.widthSegments,e.heightSegments)}},lle=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,cle=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,ule=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,hle=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,dle=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,ple=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,fle="vec3 transformed = vec3( position );",mle=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,gle=`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
#ifdef USE_IRIDESCENCE
	vec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,vle=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,yle=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,xle=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,wle=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,ble=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,_le=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,Sle=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,Mle=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,Ele=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,Ale=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,Cle=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,Tle=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,Ple=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,Dle=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,Rle=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,Ile=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,Lle=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,Ole="gl_FragColor = linearToOutputTexel( gl_FragColor );",zle=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,Nle=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,Ble=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,kle=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,Ule=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,Fle=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,Vle=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,Hle=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,Gle=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,jle=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,Wle=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,Xle=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,qle=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,Yle=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,Qle=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,Kle=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,Zle=`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,$le=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,Jle=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,ece=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,tce=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,ice=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,rce=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	#ifdef USE_IRIDESCENCE
		reflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );
	#else
		reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,nce=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,sce=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,ace=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,oce=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,lce=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,cce=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,uce=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,hce=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,dce=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,pce=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,fce=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,mce=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,gce=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,vce=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,yce=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,xce=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,wce=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,bce=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,_ce=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,Sce=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Mce=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Ece=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,Ace=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,Cce=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,Tce=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,Pce=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,Dce=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,Rce=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,Ice=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,Lce=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,Oce=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,zce=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,Nce=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,Bce=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,kce=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,Uce=`#if NUM_SPOT_LIGHT_COORDS > 0
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,Fce=`#if NUM_SPOT_LIGHT_COORDS > 0
  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,Vce=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,Hce=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,Gce=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,jce=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,Wce=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,Xce=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,qce=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,Yce=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,Qce=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,Kce=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,Zce=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
#endif`,$ce=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef texture2DLodEXT
			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#else
			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#endif
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,Jce=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,eue=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,tue=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,iue=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,rue=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,nue=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,sue=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,aue=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,oue=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,lue=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,cue=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,uue=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,hue=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,due=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,pue=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,fue=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,mue=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,gue=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,vue=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,yue=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,xue=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,wue=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,bue=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,_ue=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Sue=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Mue=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,Eue=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Aue=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,Cue=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,Tue=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Pue=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Due=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,Rue=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Iue=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Lue=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Oue=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,zue=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,Nue=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Bue=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,kue=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Uue=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,di={alphamap_fragment:lle,alphamap_pars_fragment:cle,alphatest_fragment:ule,alphatest_pars_fragment:hle,aomap_fragment:dle,aomap_pars_fragment:ple,begin_vertex:fle,beginnormal_vertex:mle,bsdfs:gle,iridescence_fragment:vle,bumpmap_pars_fragment:yle,clipping_planes_fragment:xle,clipping_planes_pars_fragment:wle,clipping_planes_pars_vertex:ble,clipping_planes_vertex:_le,color_fragment:Sle,color_pars_fragment:Mle,color_pars_vertex:Ele,color_vertex:Ale,common:Cle,cube_uv_reflection_fragment:Tle,defaultnormal_vertex:Ple,displacementmap_pars_vertex:Dle,displacementmap_vertex:Rle,emissivemap_fragment:Ile,emissivemap_pars_fragment:Lle,encodings_fragment:Ole,encodings_pars_fragment:zle,envmap_fragment:Nle,envmap_common_pars_fragment:Ble,envmap_pars_fragment:kle,envmap_pars_vertex:Ule,envmap_physical_pars_fragment:Zle,envmap_vertex:Fle,fog_vertex:Vle,fog_pars_vertex:Hle,fog_fragment:Gle,fog_pars_fragment:jle,gradientmap_pars_fragment:Wle,lightmap_fragment:Xle,lightmap_pars_fragment:qle,lights_lambert_fragment:Yle,lights_lambert_pars_fragment:Qle,lights_pars_begin:Kle,lights_toon_fragment:$le,lights_toon_pars_fragment:Jle,lights_phong_fragment:ece,lights_phong_pars_fragment:tce,lights_physical_fragment:ice,lights_physical_pars_fragment:rce,lights_fragment_begin:nce,lights_fragment_maps:sce,lights_fragment_end:ace,logdepthbuf_fragment:oce,logdepthbuf_pars_fragment:lce,logdepthbuf_pars_vertex:cce,logdepthbuf_vertex:uce,map_fragment:hce,map_pars_fragment:dce,map_particle_fragment:pce,map_particle_pars_fragment:fce,metalnessmap_fragment:mce,metalnessmap_pars_fragment:gce,morphcolor_vertex:vce,morphnormal_vertex:yce,morphtarget_pars_vertex:xce,morphtarget_vertex:wce,normal_fragment_begin:bce,normal_fragment_maps:_ce,normal_pars_fragment:Sce,normal_pars_vertex:Mce,normal_vertex:Ece,normalmap_pars_fragment:Ace,clearcoat_normal_fragment_begin:Cce,clearcoat_normal_fragment_maps:Tce,clearcoat_pars_fragment:Pce,iridescence_pars_fragment:Dce,output_fragment:Rce,packing:Ice,premultiplied_alpha_fragment:Lce,project_vertex:Oce,dithering_fragment:zce,dithering_pars_fragment:Nce,roughnessmap_fragment:Bce,roughnessmap_pars_fragment:kce,shadowmap_pars_fragment:Uce,shadowmap_pars_vertex:Fce,shadowmap_vertex:Vce,shadowmask_pars_fragment:Hce,skinbase_vertex:Gce,skinning_pars_vertex:jce,skinning_vertex:Wce,skinnormal_vertex:Xce,specularmap_fragment:qce,specularmap_pars_fragment:Yce,tonemapping_fragment:Qce,tonemapping_pars_fragment:Kce,transmission_fragment:Zce,transmission_pars_fragment:$ce,uv_pars_fragment:Jce,uv_pars_vertex:eue,uv_vertex:tue,uv2_pars_fragment:iue,uv2_pars_vertex:rue,uv2_vertex:nue,worldpos_vertex:sue,background_vert:aue,background_frag:oue,backgroundCube_vert:lue,backgroundCube_frag:cue,cube_vert:uue,cube_frag:hue,depth_vert:due,depth_frag:pue,distanceRGBA_vert:fue,distanceRGBA_frag:mue,equirect_vert:gue,equirect_frag:vue,linedashed_vert:yue,linedashed_frag:xue,meshbasic_vert:wue,meshbasic_frag:bue,meshlambert_vert:_ue,meshlambert_frag:Sue,meshmatcap_vert:Mue,meshmatcap_frag:Eue,meshnormal_vert:Aue,meshnormal_frag:Cue,meshphong_vert:Tue,meshphong_frag:Pue,meshphysical_vert:Due,meshphysical_frag:Rue,meshtoon_vert:Iue,meshtoon_frag:Lue,points_vert:Oue,points_frag:zue,shadow_vert:Nue,shadow_frag:Bue,sprite_vert:kue,sprite_frag:Uue},wt={common:{diffuse:{value:new jt(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Mn},uv2Transform:{value:new Mn},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new ve(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new jt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new jt(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Mn}},sprite:{diffuse:{value:new jt(16777215)},opacity:{value:1},center:{value:new ve(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Mn}}},bc={basic:{uniforms:la([wt.common,wt.specularmap,wt.envmap,wt.aomap,wt.lightmap,wt.fog]),vertexShader:di.meshbasic_vert,fragmentShader:di.meshbasic_frag},lambert:{uniforms:la([wt.common,wt.specularmap,wt.envmap,wt.aomap,wt.lightmap,wt.emissivemap,wt.bumpmap,wt.normalmap,wt.displacementmap,wt.fog,wt.lights,{emissive:{value:new jt(0)}}]),vertexShader:di.meshlambert_vert,fragmentShader:di.meshlambert_frag},phong:{uniforms:la([wt.common,wt.specularmap,wt.envmap,wt.aomap,wt.lightmap,wt.emissivemap,wt.bumpmap,wt.normalmap,wt.displacementmap,wt.fog,wt.lights,{emissive:{value:new jt(0)},specular:{value:new jt(1118481)},shininess:{value:30}}]),vertexShader:di.meshphong_vert,fragmentShader:di.meshphong_frag},standard:{uniforms:la([wt.common,wt.envmap,wt.aomap,wt.lightmap,wt.emissivemap,wt.bumpmap,wt.normalmap,wt.displacementmap,wt.roughnessmap,wt.metalnessmap,wt.fog,wt.lights,{emissive:{value:new jt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:di.meshphysical_vert,fragmentShader:di.meshphysical_frag},toon:{uniforms:la([wt.common,wt.aomap,wt.lightmap,wt.emissivemap,wt.bumpmap,wt.normalmap,wt.displacementmap,wt.gradientmap,wt.fog,wt.lights,{emissive:{value:new jt(0)}}]),vertexShader:di.meshtoon_vert,fragmentShader:di.meshtoon_frag},matcap:{uniforms:la([wt.common,wt.bumpmap,wt.normalmap,wt.displacementmap,wt.fog,{matcap:{value:null}}]),vertexShader:di.meshmatcap_vert,fragmentShader:di.meshmatcap_frag},points:{uniforms:la([wt.points,wt.fog]),vertexShader:di.points_vert,fragmentShader:di.points_frag},dashed:{uniforms:la([wt.common,wt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:di.linedashed_vert,fragmentShader:di.linedashed_frag},depth:{uniforms:la([wt.common,wt.displacementmap]),vertexShader:di.depth_vert,fragmentShader:di.depth_frag},normal:{uniforms:la([wt.common,wt.bumpmap,wt.normalmap,wt.displacementmap,{opacity:{value:1}}]),vertexShader:di.meshnormal_vert,fragmentShader:di.meshnormal_frag},sprite:{uniforms:la([wt.sprite,wt.fog]),vertexShader:di.sprite_vert,fragmentShader:di.sprite_frag},background:{uniforms:{uvTransform:{value:new Mn},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:di.background_vert,fragmentShader:di.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:di.backgroundCube_vert,fragmentShader:di.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:di.cube_vert,fragmentShader:di.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:di.equirect_vert,fragmentShader:di.equirect_frag},distanceRGBA:{uniforms:la([wt.common,wt.displacementmap,{referencePosition:{value:new B},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:di.distanceRGBA_vert,fragmentShader:di.distanceRGBA_frag},shadow:{uniforms:la([wt.lights,wt.fog,{color:{value:new jt(0)},opacity:{value:1}}]),vertexShader:di.shadow_vert,fragmentShader:di.shadow_frag}};bc.physical={uniforms:la([bc.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new ve(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new jt(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new ve},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new jt(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new jt(1,1,1)},specularColorMap:{value:null}}]),vertexShader:di.meshphysical_vert,fragmentShader:di.meshphysical_frag};var F_={r:0,b:0,g:0};function Fue(e,t,i,r,n,s,a){let o=new jt(0),l=s===!0?0:1,c,u,h=null,d=0,p=null;function f(g,m){let x=!1,w=m.isScene===!0?m.background:null;w&&w.isTexture&&(w=(m.backgroundBlurriness>0?i:t).get(w));let _=e.xr,M=_.getSession&&_.getSession();M&&M.environmentBlendMode==="additive"&&(w=null),w===null?v(o,l):w&&w.isColor&&(v(w,1),x=!0),(e.autoClear||x)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),w&&(w.isCubeTexture||w.mapping===Lw)?(u===void 0&&(u=new zr(new Hl(1,1,1),new Ui({name:"BackgroundCubeMaterial",uniforms:Xv(bc.backgroundCube.uniforms),vertexShader:bc.backgroundCube.vertexShader,fragmentShader:bc.backgroundCube.fragmentShader,side:ns,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(S,A,T){this.matrixWorld.copyPosition(T.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(u)),u.material.uniforms.envMap.value=w,u.material.uniforms.flipEnvMap.value=w.isCubeTexture&&w.isRenderTargetTexture===!1?-1:1,u.material.uniforms.backgroundBlurriness.value=m.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=m.backgroundIntensity,u.material.toneMapped=w.encoding!==hi,(h!==w||d!==w.version||p!==e.toneMapping)&&(u.material.needsUpdate=!0,h=w,d=w.version,p=e.toneMapping),u.layers.enableAll(),g.unshift(u,u.geometry,u.material,0,0,null)):w&&w.isTexture&&(c===void 0&&(c=new zr(new hh(2,2),new Ui({name:"BackgroundMaterial",uniforms:Xv(bc.background.uniforms),vertexShader:bc.background.vertexShader,fragmentShader:bc.background.fragmentShader,side:Fl,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(c)),c.material.uniforms.t2D.value=w,c.material.uniforms.backgroundIntensity.value=m.backgroundIntensity,c.material.toneMapped=w.encoding!==hi,w.matrixAutoUpdate===!0&&w.updateMatrix(),c.material.uniforms.uvTransform.value.copy(w.matrix),(h!==w||d!==w.version||p!==e.toneMapping)&&(c.material.needsUpdate=!0,h=w,d=w.version,p=e.toneMapping),c.layers.enableAll(),g.unshift(c,c.geometry,c.material,0,0,null))}function v(g,m){g.getRGB(F_,OY(e)),r.buffers.color.setClear(F_.r,F_.g,F_.b,m,a)}return{getClearColor:function(){return o},setClearColor:function(g,m=1){o.set(g),l=m,v(o,l)},getClearAlpha:function(){return l},setClearAlpha:function(g){l=g,v(o,l)},render:f}}function Vue(e,t,i,r){let n=e.getParameter(34921),s=r.isWebGL2?null:t.get("OES_vertex_array_object"),a=r.isWebGL2||s!==null,o={},l=g(null),c=l,u=!1;function h(z,F,Q,Y,O){let j=!1;if(a){let V=v(Y,Q,F);c!==V&&(c=V,p(c.object)),j=m(z,Y,Q,O),j&&x(z,Y,Q,O)}else{let V=F.wireframe===!0;(c.geometry!==Y.id||c.program!==Q.id||c.wireframe!==V)&&(c.geometry=Y.id,c.program=Q.id,c.wireframe=V,j=!0)}O!==null&&i.update(O,34963),(j||u)&&(u=!1,T(z,F,Q,Y),O!==null&&e.bindBuffer(34963,i.get(O).buffer))}function d(){return r.isWebGL2?e.createVertexArray():s.createVertexArrayOES()}function p(z){return r.isWebGL2?e.bindVertexArray(z):s.bindVertexArrayOES(z)}function f(z){return r.isWebGL2?e.deleteVertexArray(z):s.deleteVertexArrayOES(z)}function v(z,F,Q){let Y=Q.wireframe===!0,O=o[z.id];O===void 0&&(O={},o[z.id]=O);let j=O[F.id];j===void 0&&(j={},O[F.id]=j);let V=j[Y];return V===void 0&&(V=g(d()),j[Y]=V),V}function g(z){let F=[],Q=[],Y=[];for(let O=0;O<n;O++)F[O]=0,Q[O]=0,Y[O]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:F,enabledAttributes:Q,attributeDivisors:Y,object:z,attributes:{},index:null}}function m(z,F,Q,Y){let O=c.attributes,j=F.attributes,V=0,W=Q.getAttributes();for(let J in W)if(W[J].location>=0){let ce=O[J],$=j[J];if($===void 0&&(J==="instanceMatrix"&&z.instanceMatrix&&($=z.instanceMatrix),J==="instanceColor"&&z.instanceColor&&($=z.instanceColor)),ce===void 0||ce.attribute!==$||$&&ce.data!==$.data)return!0;V++}return c.attributesNum!==V||c.index!==Y}function x(z,F,Q,Y){let O={},j=F.attributes,V=0,W=Q.getAttributes();for(let J in W)if(W[J].location>=0){let ce=j[J];ce===void 0&&(J==="instanceMatrix"&&z.instanceMatrix&&(ce=z.instanceMatrix),J==="instanceColor"&&z.instanceColor&&(ce=z.instanceColor));let $={};$.attribute=ce,ce&&ce.data&&($.data=ce.data),O[J]=$,V++}c.attributes=O,c.attributesNum=V,c.index=Y}function w(){let z=c.newAttributes;for(let F=0,Q=z.length;F<Q;F++)z[F]=0}function _(z){M(z,0)}function M(z,F){let Q=c.newAttributes,Y=c.enabledAttributes,O=c.attributeDivisors;Q[z]=1,Y[z]===0&&(e.enableVertexAttribArray(z),Y[z]=1),O[z]!==F&&((r.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](z,F),O[z]=F)}function S(){let z=c.newAttributes,F=c.enabledAttributes;for(let Q=0,Y=F.length;Q<Y;Q++)F[Q]!==z[Q]&&(e.disableVertexAttribArray(Q),F[Q]=0)}function A(z,F,Q,Y,O,j){r.isWebGL2===!0&&(Q===5124||Q===5125)?e.vertexAttribIPointer(z,F,Q,O,j):e.vertexAttribPointer(z,F,Q,Y,O,j)}function T(z,F,Q,Y){if(r.isWebGL2===!1&&(z.isInstancedMesh||Y.isInstancedBufferGeometry)&&t.get("ANGLE_instanced_arrays")===null)return;w();let O=Y.attributes,j=Q.getAttributes(),V=F.defaultAttributeValues;for(let W in j){let J=j[W];if(J.location>=0){let ce=O[W];if(ce===void 0&&(W==="instanceMatrix"&&z.instanceMatrix&&(ce=z.instanceMatrix),W==="instanceColor"&&z.instanceColor&&(ce=z.instanceColor)),ce!==void 0){let $=ce.normalized,ne=ce.itemSize,ie=i.get(ce);if(ie===void 0)continue;let de=ie.buffer,be=ie.type,we=ie.bytesPerElement;if(ce.isInterleavedBufferAttribute){let _e=ce.data,Me=_e.stride,X=ce.offset;if(_e.isInstancedInterleavedBuffer){for(let ge=0;ge<J.locationSize;ge++)M(J.location+ge,_e.meshPerAttribute);z.isInstancedMesh!==!0&&Y._maxInstanceCount===void 0&&(Y._maxInstanceCount=_e.meshPerAttribute*_e.count)}else for(let ge=0;ge<J.locationSize;ge++)_(J.location+ge);e.bindBuffer(34962,de);for(let ge=0;ge<J.locationSize;ge++)A(J.location+ge,ne/J.locationSize,be,$,Me*we,(X+ne/J.locationSize*ge)*we)}else{if(ce.isInstancedBufferAttribute){for(let _e=0;_e<J.locationSize;_e++)M(J.location+_e,ce.meshPerAttribute);z.isInstancedMesh!==!0&&Y._maxInstanceCount===void 0&&(Y._maxInstanceCount=ce.meshPerAttribute*ce.count)}else for(let _e=0;_e<J.locationSize;_e++)_(J.location+_e);e.bindBuffer(34962,de);for(let _e=0;_e<J.locationSize;_e++)A(J.location+_e,ne/J.locationSize,be,$,ne*we,ne/J.locationSize*_e*we)}}else if(V!==void 0){let $=V[W];if($!==void 0)switch($.length){case 2:e.vertexAttrib2fv(J.location,$);break;case 3:e.vertexAttrib3fv(J.location,$);break;case 4:e.vertexAttrib4fv(J.location,$);break;default:e.vertexAttrib1fv(J.location,$)}}}}S()}function E(){I();for(let z in o){let F=o[z];for(let Q in F){let Y=F[Q];for(let O in Y)f(Y[O].object),delete Y[O];delete F[Q]}delete o[z]}}function C(z){if(o[z.id]===void 0)return;let F=o[z.id];for(let Q in F){let Y=F[Q];for(let O in Y)f(Y[O].object),delete Y[O];delete F[Q]}delete o[z.id]}function D(z){for(let F in o){let Q=o[F];if(Q[z.id]===void 0)continue;let Y=Q[z.id];for(let O in Y)f(Y[O].object),delete Y[O];delete Q[z.id]}}function I(){L(),u=!0,c!==l&&(c=l,p(c.object))}function L(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:h,reset:I,resetDefaultState:L,dispose:E,releaseStatesOfGeometry:C,releaseStatesOfProgram:D,initAttributes:w,enableAttribute:_,disableUnusedAttributes:S}}function Hue(e,t,i,r){let n=r.isWebGL2,s;function a(c){s=c}function o(c,u){e.drawArrays(s,c,u),i.update(u,s,1)}function l(c,u,h){if(h===0)return;let d,p;if(n)d=e,p="drawArraysInstanced";else if(d=t.get("ANGLE_instanced_arrays"),p="drawArraysInstancedANGLE",d===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}d[p](s,c,u,h),i.update(u,s,h)}this.setMode=a,this.render=o,this.renderInstances=l}function Gue(e,t,i){let r;function n(){if(r!==void 0)return r;if(t.has("EXT_texture_filter_anisotropic")===!0){let A=t.get("EXT_texture_filter_anisotropic");r=e.getParameter(A.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r}function s(A){if(A==="highp"){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";A="mediump"}return A==="mediump"&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}let a=typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext,o=i.precision!==void 0?i.precision:"highp",l=s(o);l!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",l,"instead."),o=l);let c=a||t.has("WEBGL_draw_buffers"),u=i.logarithmicDepthBuffer===!0,h=e.getParameter(34930),d=e.getParameter(35660),p=e.getParameter(3379),f=e.getParameter(34076),v=e.getParameter(34921),g=e.getParameter(36347),m=e.getParameter(36348),x=e.getParameter(36349),w=d>0,_=a||t.has("OES_texture_float"),M=w&&_,S=a?e.getParameter(36183):0;return{isWebGL2:a,drawBuffers:c,getMaxAnisotropy:n,getMaxPrecision:s,precision:o,logarithmicDepthBuffer:u,maxTextures:h,maxVertexTextures:d,maxTextureSize:p,maxCubemapSize:f,maxAttributes:v,maxVertexUniforms:g,maxVaryings:m,maxFragmentUniforms:x,vertexTextures:w,floatFragmentTextures:_,floatVertexTextures:M,maxSamples:S}}function jue(e){let t=this,i=null,r=0,n=!1,s=!1,a=new Ia,o=new Mn,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(h,d){let p=h.length!==0||d||r!==0||n;return n=d,r=h.length,p},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(h,d){i=u(h,d,0)},this.setState=function(h,d,p){let f=h.clippingPlanes,v=h.clipIntersection,g=h.clipShadows,m=e.get(h);if(!n||f===null||f.length===0||s&&!g)s?u(null):c();else{let x=s?0:r,w=x*4,_=m.clippingState||null;l.value=_,_=u(f,d,w,p);for(let M=0;M!==w;++M)_[M]=i[M];m.clippingState=_,this.numIntersection=v?this.numPlanes:0,this.numPlanes+=x}};function c(){l.value!==i&&(l.value=i,l.needsUpdate=r>0),t.numPlanes=r,t.numIntersection=0}function u(h,d,p,f){let v=h!==null?h.length:0,g=null;if(v!==0){if(g=l.value,f!==!0||g===null){let m=p+v*4,x=d.matrixWorldInverse;o.getNormalMatrix(x),(g===null||g.length<m)&&(g=new Float32Array(m));for(let w=0,_=p;w!==v;++w,_+=4)a.copy(h[w]).applyMatrix4(x,o),a.normal.toArray(g,_),g[_+3]=a.constant}l.value=g,l.needsUpdate=!0}return t.numPlanes=v,t.numIntersection=0,g}}function Wue(e){let t=new WeakMap;function i(a,o){return o===DL?a.mapping=Vf:o===RL&&(a.mapping=Hf),a}function r(a){if(a&&a.isTexture&&a.isRenderTargetTexture===!1){let o=a.mapping;if(o===DL||o===RL)if(t.has(a)){let l=t.get(a).texture;return i(l,a.mapping)}else{let l=a.image;if(l&&l.height>0){let c=new nle(l.height/2);return c.fromEquirectangularTexture(e,a),t.set(a,c),a.addEventListener("dispose",n),i(c.texture,a.mapping)}else return null}}return a}function n(a){let o=a.target;o.removeEventListener("dispose",n);let l=t.get(o);l!==void 0&&(t.delete(o),l.dispose())}function s(){t=new WeakMap}return{get:r,dispose:s}}var _T=class extends tm{constructor(e=-1,t=1,i=1,r=-1,n=.1,s=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=r,this.near=n,this.far=s,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,i,r,n,s){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=n,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2,n=i-e,s=i+e,a=r+t,o=r-t;if(this.view!==null&&this.view.enabled){let l=(this.right-this.left)/this.view.fullWidth/this.zoom,c=(this.top-this.bottom)/this.view.fullHeight/this.zoom;n+=l*this.view.offsetX,s=n+l*this.view.width,a-=c*this.view.offsetY,o=a-c*this.view.height}this.projectionMatrix.makeOrthographic(n,s,a,o,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}},rv=4,PV=[.125,.215,.35,.446,.526,.582],Qp=20,QD=new _T,DV=new jt,KD=null,Vp=(1+Math.sqrt(5))/2,Fm=1/Vp,RV=[new B(1,1,1),new B(-1,1,1),new B(1,1,-1),new B(-1,1,-1),new B(0,Vp,Fm),new B(0,Vp,-Fm),new B(Fm,0,Vp),new B(-Fm,0,Vp),new B(Vp,Fm,0),new B(-Vp,Fm,0)],IV=class{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,r=100){KD=this._renderer.getRenderTarget(),this._setSize(256);let n=this._allocateTargets();return n.depthBuffer=!0,this._sceneToCubeUV(e,i,r,n),t>0&&this._blur(n,0,0,t),this._applyPMREM(n),this._cleanup(n),n}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=zV(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=OV(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(KD),e.scissorTest=!1,V_(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===Vf||e.mapping===Hf?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),KD=this._renderer.getRenderTarget();let i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){let e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:pi,minFilter:pi,generateMipmaps:!1,type:ch,format:is,encoding:Vl,depthBuffer:!1},r=LV(e,t,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=LV(e,t,i);let{_lodMax:n}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=Xue(n)),this._blurMaterial=que(n,e,t)}return r}_compileMaterial(e){let t=new zr(this._lodPlanes[0],e);this._renderer.compile(t,QD)}_sceneToCubeUV(e,t,i,r){let n=new Gs(90,1,t,i),s=[1,-1,1,1,1,1],a=[1,1,1,-1,-1,-1],o=this._renderer,l=o.autoClear,c=o.toneMapping;o.getClearColor(DV),o.toneMapping=kc,o.autoClear=!1;let u=new uh({name:"PMREM.Background",side:ns,depthWrite:!1,depthTest:!1}),h=new zr(new Hl,u),d=!1,p=e.background;p?p.isColor&&(u.color.copy(p),e.background=null,d=!0):(u.color.copy(DV),d=!0);for(let f=0;f<6;f++){let v=f%3;v===0?(n.up.set(0,s[f],0),n.lookAt(a[f],0,0)):v===1?(n.up.set(0,0,s[f]),n.lookAt(0,a[f],0)):(n.up.set(0,s[f],0),n.lookAt(0,0,a[f]));let g=this._cubeSize;V_(r,v*g,f>2?g:0,g,g),o.setRenderTarget(r),d&&o.render(h,n),o.render(e,n)}h.geometry.dispose(),h.material.dispose(),o.toneMapping=c,o.autoClear=l,e.background=p}_textureToCubeUV(e,t){let i=this._renderer,r=e.mapping===Vf||e.mapping===Hf;r?(this._cubemapMaterial===null&&(this._cubemapMaterial=zV()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=OV());let n=r?this._cubemapMaterial:this._equirectMaterial,s=new zr(this._lodPlanes[0],n),a=n.uniforms;a.envMap.value=e;let o=this._cubeSize;V_(t,0,0,3*o,2*o),i.setRenderTarget(t),i.render(s,QD)}_applyPMREM(e){let t=this._renderer,i=t.autoClear;t.autoClear=!1;for(let r=1;r<this._lodPlanes.length;r++){let n=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),s=RV[(r-1)%RV.length];this._blur(e,r-1,r,n,s)}t.autoClear=i}_blur(e,t,i,r,n){let s=this._pingPongRenderTarget;this._halfBlur(e,s,t,i,r,"latitudinal",n),this._halfBlur(s,e,i,i,r,"longitudinal",n)}_halfBlur(e,t,i,r,n,s,a){let o=this._renderer,l=this._blurMaterial;s!=="latitudinal"&&s!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");let c=3,u=new zr(this._lodPlanes[r],l),h=l.uniforms,d=this._sizeLods[i]-1,p=isFinite(n)?Math.PI/(2*d):2*Math.PI/(2*Qp-1),f=n/p,v=isFinite(n)?1+Math.floor(c*f):Qp;v>Qp&&console.warn(`sigmaRadians, ${n}, is too large and will clip, as it requested ${v} samples when the maximum is set to ${Qp}`);let g=[],m=0;for(let S=0;S<Qp;++S){let A=S/f,T=Math.exp(-A*A/2);g.push(T),S===0?m+=T:S<v&&(m+=2*T)}for(let S=0;S<g.length;S++)g[S]=g[S]/m;h.envMap.value=e.texture,h.samples.value=v,h.weights.value=g,h.latitudinal.value=s==="latitudinal",a&&(h.poleAxis.value=a);let{_lodMax:x}=this;h.dTheta.value=p,h.mipInt.value=x-i;let w=this._sizeLods[r],_=3*w*(r>x-rv?r-x+rv:0),M=4*(this._cubeSize-w);V_(t,_,M,3*w,2*w),o.setRenderTarget(t),o.render(u,QD)}};function Xue(e){let t=[],i=[],r=[],n=e,s=e-rv+1+PV.length;for(let a=0;a<s;a++){let o=Math.pow(2,n);i.push(o);let l=1/o;a>e-rv?l=PV[a-e+rv-1]:a===0&&(l=0),r.push(l);let c=1/(o-2),u=-c,h=1+c,d=[u,u,h,u,h,h,u,u,h,h,u,h],p=6,f=6,v=3,g=2,m=1,x=new Float32Array(v*f*p),w=new Float32Array(g*f*p),_=new Float32Array(m*f*p);for(let S=0;S<p;S++){let A=S%3*2/3-1,T=S>2?0:-1,E=[A,T,0,A+2/3,T,0,A+2/3,T+1,0,A,T,0,A+2/3,T+1,0,A,T+1,0];x.set(E,v*f*S),w.set(d,g*f*S);let C=[S,S,S,S,S,S];_.set(C,m*f*S)}let M=new Bt;M.setAttribute("position",new $t(x,v)),M.setAttribute("uv",new $t(w,g)),M.setAttribute("faceIndex",new $t(_,m)),t.push(M),n>rv&&n--}return{lodPlanes:t,sizeLods:i,sigmas:r}}function LV(e,t,i){let r=new Wi(e,t,i);return r.texture.mapping=Lw,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function V_(e,t,i,r,n){e.viewport.set(t,i,r,n),e.scissor.set(t,i,r,n)}function que(e,t,i){let r=new Float32Array(Qp),n=new B(0,1,0);return new Ui({name:"SphericalGaussianBlur",defines:{n:Qp,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n}},vertexShader:mB(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:An,depthTest:!1,depthWrite:!1})}function OV(){return new Ui({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:mB(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:An,depthTest:!1,depthWrite:!1})}function zV(){return new Ui({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:mB(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:An,depthTest:!1,depthWrite:!1})}function mB(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function Yue(e){let t=new WeakMap,i=null;function r(o){if(o&&o.isTexture){let l=o.mapping,c=l===DL||l===RL,u=l===Vf||l===Hf;if(c||u)if(o.isRenderTargetTexture&&o.needsPMREMUpdate===!0){o.needsPMREMUpdate=!1;let h=t.get(o);return i===null&&(i=new IV(e)),h=c?i.fromEquirectangular(o,h):i.fromCubemap(o,h),t.set(o,h),h.texture}else{if(t.has(o))return t.get(o).texture;{let h=o.image;if(c&&h&&h.height>0||u&&h&&n(h)){i===null&&(i=new IV(e));let d=c?i.fromEquirectangular(o):i.fromCubemap(o);return t.set(o,d),o.addEventListener("dispose",s),d.texture}else return null}}}return o}function n(o){let l=0,c=6;for(let u=0;u<c;u++)o[u]!==void 0&&l++;return l===c}function s(o){let l=o.target;l.removeEventListener("dispose",s);let c=t.get(l);c!==void 0&&(t.delete(l),c.dispose())}function a(){t=new WeakMap,i!==null&&(i.dispose(),i=null)}return{get:r,dispose:a}}function Que(e){let t={};function i(r){if(t[r]!==void 0)return t[r];let n;switch(r){case"WEBGL_depth_texture":n=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=e.getExtension(r)}return t[r]=n,n}return{has:function(r){return i(r)!==null},init:function(r){r.isWebGL2?i("EXT_color_buffer_float"):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture")},get:function(r){let n=i(r);return n===null&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),n}}}function Kue(e,t,i,r){let n={},s=new WeakMap;function a(h){let d=h.target;d.index!==null&&t.remove(d.index);for(let f in d.attributes)t.remove(d.attributes[f]);d.removeEventListener("dispose",a),delete n[d.id];let p=s.get(d);p&&(t.remove(p),s.delete(d)),r.releaseStatesOfGeometry(d),d.isInstancedBufferGeometry===!0&&delete d._maxInstanceCount,i.memory.geometries--}function o(h,d){return n[d.id]===!0||(d.addEventListener("dispose",a),n[d.id]=!0,i.memory.geometries++),d}function l(h){let d=h.attributes;for(let f in d)t.update(d[f],34962);let p=h.morphAttributes;for(let f in p){let v=p[f];for(let g=0,m=v.length;g<m;g++)t.update(v[g],34962)}}function c(h){let d=[],p=h.index,f=h.attributes.position,v=0;if(p!==null){let x=p.array;v=p.version;for(let w=0,_=x.length;w<_;w+=3){let M=x[w+0],S=x[w+1],A=x[w+2];d.push(M,S,S,A,A,M)}}else{let x=f.array;v=f.version;for(let w=0,_=x.length/3-1;w<_;w+=3){let M=w+0,S=w+1,A=w+2;d.push(M,S,S,A,A,M)}}let g=new(TY(d)?bv:LY)(d,1);g.version=v;let m=s.get(h);m&&t.remove(m),s.set(h,g)}function u(h){let d=s.get(h);if(d){let p=h.index;p!==null&&d.version<p.version&&c(h)}else c(h);return s.get(h)}return{get:o,update:l,getWireframeAttribute:u}}function Zue(e,t,i,r){let n=r.isWebGL2,s;function a(d){s=d}let o,l;function c(d){o=d.type,l=d.bytesPerElement}function u(d,p){e.drawElements(s,p,o,d*l),i.update(p,s,1)}function h(d,p,f){if(f===0)return;let v,g;if(n)v=e,g="drawElementsInstanced";else if(v=t.get("ANGLE_instanced_arrays"),g="drawElementsInstancedANGLE",v===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}v[g](s,p,o,d*l,f),i.update(p,s,f)}this.setMode=a,this.setIndex=c,this.render=u,this.renderInstances=h}function $ue(e){let t={geometries:0,textures:0},i={frame:0,calls:0,triangles:0,points:0,lines:0};function r(s,a,o){switch(i.calls++,a){case 4:i.triangles+=o*(s/3);break;case 1:i.lines+=o*(s/2);break;case 3:i.lines+=o*(s-1);break;case 2:i.lines+=o*s;break;case 0:i.points+=o*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",a);break}}function n(){i.frame++,i.calls=0,i.triangles=0,i.points=0,i.lines=0}return{memory:t,render:i,programs:null,autoReset:!0,reset:n,update:r}}function Jue(e,t){return e[0]-t[0]}function ehe(e,t){return Math.abs(t[1])-Math.abs(e[1])}function the(e,t,i){let r={},n=new Float32Array(8),s=new WeakMap,a=new ti,o=[];for(let c=0;c<8;c++)o[c]=[c,0];function l(c,u,h,d){let p=c.morphTargetInfluences;if(t.isWebGL2===!0){let f=u.morphAttributes.position||u.morphAttributes.normal||u.morphAttributes.color,v=f!==void 0?f.length:0,g=s.get(u);if(g===void 0||g.count!==v){let w=function(){z.dispose(),s.delete(u),u.removeEventListener("dispose",w)};g!==void 0&&g.texture.dispose();let _=u.morphAttributes.position!==void 0,M=u.morphAttributes.normal!==void 0,S=u.morphAttributes.color!==void 0,A=u.morphAttributes.position||[],T=u.morphAttributes.normal||[],E=u.morphAttributes.color||[],C=0;_===!0&&(C=1),M===!0&&(C=2),S===!0&&(C=3);let D=u.attributes.position.count*C,I=1;D>t.maxTextureSize&&(I=Math.ceil(D/t.maxTextureSize),D=t.maxTextureSize);let L=new Float32Array(D*I*4*v),z=new IY(L,D,I,v);z.type=Sn,z.needsUpdate=!0;let F=C*4;for(let Q=0;Q<v;Q++){let Y=A[Q],O=T[Q],j=E[Q],V=D*I*4*Q;for(let W=0;W<Y.count;W++){let J=W*F;_===!0&&(a.fromBufferAttribute(Y,W),L[V+J+0]=a.x,L[V+J+1]=a.y,L[V+J+2]=a.z,L[V+J+3]=0),M===!0&&(a.fromBufferAttribute(O,W),L[V+J+4]=a.x,L[V+J+5]=a.y,L[V+J+6]=a.z,L[V+J+7]=0),S===!0&&(a.fromBufferAttribute(j,W),L[V+J+8]=a.x,L[V+J+9]=a.y,L[V+J+10]=a.z,L[V+J+11]=j.itemSize===4?a.w:1)}}g={count:v,texture:z,size:new ve(D,I)},s.set(u,g),u.addEventListener("dispose",w)}let m=0;for(let w=0;w<p.length;w++)m+=p[w];let x=u.morphTargetsRelative?1:1-m;d.getUniforms().setValue(e,"morphTargetBaseInfluence",x),d.getUniforms().setValue(e,"morphTargetInfluences",p),d.getUniforms().setValue(e,"morphTargetsTexture",g.texture,i),d.getUniforms().setValue(e,"morphTargetsTextureSize",g.size)}else{let f=p===void 0?0:p.length,v=r[u.id];if(v===void 0||v.length!==f){v=[];for(let _=0;_<f;_++)v[_]=[_,0];r[u.id]=v}for(let _=0;_<f;_++){let M=v[_];M[0]=_,M[1]=p[_]}v.sort(ehe);for(let _=0;_<8;_++)_<f&&v[_][1]?(o[_][0]=v[_][0],o[_][1]=v[_][1]):(o[_][0]=Number.MAX_SAFE_INTEGER,o[_][1]=0);o.sort(Jue);let g=u.morphAttributes.position,m=u.morphAttributes.normal,x=0;for(let _=0;_<8;_++){let M=o[_],S=M[0],A=M[1];S!==Number.MAX_SAFE_INTEGER&&A?(g&&u.getAttribute("morphTarget"+_)!==g[S]&&u.setAttribute("morphTarget"+_,g[S]),m&&u.getAttribute("morphNormal"+_)!==m[S]&&u.setAttribute("morphNormal"+_,m[S]),n[_]=A,x+=A):(g&&u.hasAttribute("morphTarget"+_)===!0&&u.deleteAttribute("morphTarget"+_),m&&u.hasAttribute("morphNormal"+_)===!0&&u.deleteAttribute("morphNormal"+_),n[_]=0)}let w=u.morphTargetsRelative?1:1-x;d.getUniforms().setValue(e,"morphTargetBaseInfluence",w),d.getUniforms().setValue(e,"morphTargetInfluences",n)}}return{update:l}}function ihe(e,t,i,r){let n=new WeakMap;function s(l){let c=r.render.frame,u=l.geometry,h=t.get(l,u);return n.get(h)!==c&&(t.update(h),n.set(h,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",o)===!1&&l.addEventListener("dispose",o),i.update(l.instanceMatrix,34962),l.instanceColor!==null&&i.update(l.instanceColor,34962)),h}function a(){n=new WeakMap}function o(l){let c=l.target;c.removeEventListener("dispose",o),i.remove(c.instanceMatrix),c.instanceColor!==null&&i.remove(c.instanceColor)}return{update:s,dispose:a}}var NY=new Br,BY=new IY,kY=new Hoe,UY=new pB,NV=[],BV=[],kV=new Float32Array(16),UV=new Float32Array(9),FV=new Float32Array(4);function M0(e,t,i){let r=e[0];if(r<=0||r>0)return e;let n=t*i,s=NV[n];if(s===void 0&&(s=new Float32Array(n),NV[n]=s),t!==0){r.toArray(s,0);for(let a=1,o=0;a!==t;++a)o+=i,e[a].toArray(s,o)}return s}function Un(e,t){if(e.length!==t.length)return!1;for(let i=0,r=e.length;i<r;i++)if(e[i]!==t[i])return!1;return!0}function Fn(e,t){for(let i=0,r=t.length;i<r;i++)e[i]=t[i]}function ST(e,t){let i=BV[t];i===void 0&&(i=new Int32Array(t),BV[t]=i);for(let r=0;r!==t;++r)i[r]=e.allocateTextureUnit();return i}function rhe(e,t){let i=this.cache;i[0]!==t&&(e.uniform1f(this.addr,t),i[0]=t)}function nhe(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2f(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(Un(i,t))return;e.uniform2fv(this.addr,t),Fn(i,t)}}function she(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3f(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else if(t.r!==void 0)(i[0]!==t.r||i[1]!==t.g||i[2]!==t.b)&&(e.uniform3f(this.addr,t.r,t.g,t.b),i[0]=t.r,i[1]=t.g,i[2]=t.b);else{if(Un(i,t))return;e.uniform3fv(this.addr,t),Fn(i,t)}}function ahe(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(Un(i,t))return;e.uniform4fv(this.addr,t),Fn(i,t)}}function ohe(e,t){let i=this.cache,r=t.elements;if(r===void 0){if(Un(i,t))return;e.uniformMatrix2fv(this.addr,!1,t),Fn(i,t)}else{if(Un(i,r))return;FV.set(r),e.uniformMatrix2fv(this.addr,!1,FV),Fn(i,r)}}function lhe(e,t){let i=this.cache,r=t.elements;if(r===void 0){if(Un(i,t))return;e.uniformMatrix3fv(this.addr,!1,t),Fn(i,t)}else{if(Un(i,r))return;UV.set(r),e.uniformMatrix3fv(this.addr,!1,UV),Fn(i,r)}}function che(e,t){let i=this.cache,r=t.elements;if(r===void 0){if(Un(i,t))return;e.uniformMatrix4fv(this.addr,!1,t),Fn(i,t)}else{if(Un(i,r))return;kV.set(r),e.uniformMatrix4fv(this.addr,!1,kV),Fn(i,r)}}function uhe(e,t){let i=this.cache;i[0]!==t&&(e.uniform1i(this.addr,t),i[0]=t)}function hhe(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2i(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(Un(i,t))return;e.uniform2iv(this.addr,t),Fn(i,t)}}function dhe(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3i(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else{if(Un(i,t))return;e.uniform3iv(this.addr,t),Fn(i,t)}}function phe(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(Un(i,t))return;e.uniform4iv(this.addr,t),Fn(i,t)}}function fhe(e,t){let i=this.cache;i[0]!==t&&(e.uniform1ui(this.addr,t),i[0]=t)}function mhe(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2ui(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(Un(i,t))return;e.uniform2uiv(this.addr,t),Fn(i,t)}}function ghe(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3ui(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else{if(Un(i,t))return;e.uniform3uiv(this.addr,t),Fn(i,t)}}function vhe(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(Un(i,t))return;e.uniform4uiv(this.addr,t),Fn(i,t)}}function yhe(e,t,i){let r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTexture2D(t||NY,n)}function xhe(e,t,i){let r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTexture3D(t||kY,n)}function whe(e,t,i){let r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTextureCube(t||UY,n)}function bhe(e,t,i){let r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTexture2DArray(t||BY,n)}function _he(e){switch(e){case 5126:return rhe;case 35664:return nhe;case 35665:return she;case 35666:return ahe;case 35674:return ohe;case 35675:return lhe;case 35676:return che;case 5124:case 35670:return uhe;case 35667:case 35671:return hhe;case 35668:case 35672:return dhe;case 35669:case 35673:return phe;case 5125:return fhe;case 36294:return mhe;case 36295:return ghe;case 36296:return vhe;case 35678:case 36198:case 36298:case 36306:case 35682:return yhe;case 35679:case 36299:case 36307:return xhe;case 35680:case 36300:case 36308:case 36293:return whe;case 36289:case 36303:case 36311:case 36292:return bhe}}function She(e,t){e.uniform1fv(this.addr,t)}function Mhe(e,t){let i=M0(t,this.size,2);e.uniform2fv(this.addr,i)}function Ehe(e,t){let i=M0(t,this.size,3);e.uniform3fv(this.addr,i)}function Ahe(e,t){let i=M0(t,this.size,4);e.uniform4fv(this.addr,i)}function Che(e,t){let i=M0(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,i)}function The(e,t){let i=M0(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,i)}function Phe(e,t){let i=M0(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,i)}function Dhe(e,t){e.uniform1iv(this.addr,t)}function Rhe(e,t){e.uniform2iv(this.addr,t)}function Ihe(e,t){e.uniform3iv(this.addr,t)}function Lhe(e,t){e.uniform4iv(this.addr,t)}function Ohe(e,t){e.uniform1uiv(this.addr,t)}function zhe(e,t){e.uniform2uiv(this.addr,t)}function Nhe(e,t){e.uniform3uiv(this.addr,t)}function Bhe(e,t){e.uniform4uiv(this.addr,t)}function khe(e,t,i){let r=this.cache,n=t.length,s=ST(i,n);Un(r,s)||(e.uniform1iv(this.addr,s),Fn(r,s));for(let a=0;a!==n;++a)i.setTexture2D(t[a]||NY,s[a])}function Uhe(e,t,i){let r=this.cache,n=t.length,s=ST(i,n);Un(r,s)||(e.uniform1iv(this.addr,s),Fn(r,s));for(let a=0;a!==n;++a)i.setTexture3D(t[a]||kY,s[a])}function Fhe(e,t,i){let r=this.cache,n=t.length,s=ST(i,n);Un(r,s)||(e.uniform1iv(this.addr,s),Fn(r,s));for(let a=0;a!==n;++a)i.setTextureCube(t[a]||UY,s[a])}function Vhe(e,t,i){let r=this.cache,n=t.length,s=ST(i,n);Un(r,s)||(e.uniform1iv(this.addr,s),Fn(r,s));for(let a=0;a!==n;++a)i.setTexture2DArray(t[a]||BY,s[a])}function Hhe(e){switch(e){case 5126:return She;case 35664:return Mhe;case 35665:return Ehe;case 35666:return Ahe;case 35674:return Che;case 35675:return The;case 35676:return Phe;case 5124:case 35670:return Dhe;case 35667:case 35671:return Rhe;case 35668:case 35672:return Ihe;case 35669:case 35673:return Lhe;case 5125:return Ohe;case 36294:return zhe;case 36295:return Nhe;case 36296:return Bhe;case 35678:case 36198:case 36298:case 36306:case 35682:return khe;case 35679:case 36299:case 36307:return Uhe;case 35680:case 36300:case 36308:case 36293:return Fhe;case 36289:case 36303:case 36311:case 36292:return Vhe}}var Ghe=class{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.setValue=_he(t.type)}},jhe=class{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.size=t.size,this.setValue=Hhe(t.type)}},Whe=class{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){let r=this.seq;for(let n=0,s=r.length;n!==s;++n){let a=r[n];a.setValue(e,t[a.id],i)}}},ZD=/(\w+)(\])?(\[|\.)?/g;function VV(e,t){e.seq.push(t),e.map[t.id]=t}function Xhe(e,t,i){let r=e.name,n=r.length;for(ZD.lastIndex=0;;){let s=ZD.exec(r),a=ZD.lastIndex,o=s[1],l=s[2]==="]",c=s[3];if(l&&(o=o|0),c===void 0||c==="["&&a+2===n){VV(i,c===void 0?new Ghe(o,e,t):new jhe(o,e,t));break}else{let u=i.map[o];u===void 0&&(u=new Whe(o),VV(i,u)),i=u}}}var dE=class{constructor(e,t){this.seq=[],this.map={};let i=e.getProgramParameter(t,35718);for(let r=0;r<i;++r){let n=e.getActiveUniform(t,r),s=e.getUniformLocation(t,n.name);Xhe(n,s,this)}}setValue(e,t,i,r){let n=this.map[t];n!==void 0&&n.setValue(e,i,r)}setOptional(e,t,i){let r=t[i];r!==void 0&&this.setValue(e,i,r)}static upload(e,t,i,r){for(let n=0,s=t.length;n!==s;++n){let a=t[n],o=i[a.id];o.needsUpdate!==!1&&a.setValue(e,o.value,r)}}static seqWithValue(e,t){let i=[];for(let r=0,n=e.length;r!==n;++r){let s=e[r];s.id in t&&i.push(s)}return i}};function HV(e,t,i){let r=e.createShader(t);return e.shaderSource(r,i),e.compileShader(r),r}var qhe=0;function Yhe(e,t){let i=e.split(`
`),r=[],n=Math.max(t-6,0),s=Math.min(t+6,i.length);for(let a=n;a<s;a++){let o=a+1;r.push(`${o===t?">":" "} ${o}: ${i[a]}`)}return r.join(`
`)}function Qhe(e){switch(e){case Vl:return["Linear","( value )"];case hi:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}function GV(e,t,i){let r=e.getShaderParameter(t,35713),n=e.getShaderInfoLog(t).trim();if(r&&n==="")return"";let s=/ERROR: 0:(\d+)/.exec(n);if(s){let a=parseInt(s[1]);return i.toUpperCase()+`

`+n+`

`+Yhe(e.getShaderSource(t),a)}else return n}function Khe(e,t){let i=Qhe(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function Zhe(e,t){let i;switch(t){case roe:i="Linear";break;case noe:i="Reinhard";break;case soe:i="OptimizedCineon";break;case aoe:i="ACESFilmic";break;case ooe:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),i="Linear"}return"vec3 "+e+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function $he(e){return[e.extensionDerivatives||e.envMapCubeUVHeight||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||e.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(wx).join(`
`)}function Jhe(e){let t=[];for(let i in e){let r=e[i];r!==!1&&t.push("#define "+i+" "+r)}return t.join(`
`)}function ede(e,t){let i={},r=e.getProgramParameter(t,35721);for(let n=0;n<r;n++){let s=e.getActiveAttrib(t,n),a=s.name,o=1;s.type===35674&&(o=2),s.type===35675&&(o=3),s.type===35676&&(o=4),i[a]={type:s.type,location:e.getAttribLocation(t,a),locationSize:o}}return i}function wx(e){return e!==""}function jV(e,t){let i=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,i).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function WV(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var tde=/^[ \t]*#include +<([\w\d./]+)>/gm;function NL(e){return e.replace(tde,ide)}function ide(e,t){let i=di[t];if(i===void 0)throw new Error("Can not resolve #include <"+t+">");return NL(i)}var rde=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function XV(e){return e.replace(rde,nde)}function nde(e,t,i,r){let n="";for(let s=parseInt(t);s<parseInt(i);s++)n+=r.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return n}function qV(e){let t="precision "+e.precision+` float;
precision `+e.precision+" int;";return e.precision==="highp"?t+=`
#define HIGH_PRECISION`:e.precision==="mediump"?t+=`
#define MEDIUM_PRECISION`:e.precision==="lowp"&&(t+=`
#define LOW_PRECISION`),t}function sde(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===lB?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===zae?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===xx&&(t="SHADOWMAP_TYPE_VSM"),t}function ade(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case Vf:case Hf:t="ENVMAP_TYPE_CUBE";break;case Lw:t="ENVMAP_TYPE_CUBE_UV";break}return t}function ode(e){let t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case Hf:t="ENVMAP_MODE_REFRACTION";break}return t}function lde(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case wY:t="ENVMAP_BLENDING_MULTIPLY";break;case toe:t="ENVMAP_BLENDING_MIX";break;case ioe:t="ENVMAP_BLENDING_ADD";break}return t}function cde(e){let t=e.envMapCubeUVHeight;if(t===null)return null;let i=Math.log2(t)-2,r=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,i),7*16)),texelHeight:r,maxMip:i}}function ude(e,t,i,r){let n=e.getContext(),s=i.defines,a=i.vertexShader,o=i.fragmentShader,l=sde(i),c=ade(i),u=ode(i),h=lde(i),d=cde(i),p=i.isWebGL2?"":$he(i),f=Jhe(s),v=n.createProgram(),g,m,x=i.glslVersion?"#version "+i.glslVersion+`
`:"";i.isRawShaderMaterial?(g=[f].filter(wx).join(`
`),g.length>0&&(g+=`
`),m=[p,f].filter(wx).join(`
`),m.length>0&&(m+=`
`)):(g=[qV(i),"#define SHADER_NAME "+i.shaderName,f,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+u:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&i.flatShading===!1?"#define USE_MORPHNORMALS":"",i.morphColors&&i.isWebGL2?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(wx).join(`
`),m=[p,qV(i),"#define SHADER_NAME "+i.shaderName,f,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+c:"",i.envMap?"#define "+u:"",i.envMap?"#define "+h:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescence?"#define USE_IRIDESCENCE":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==kc?"#define TONE_MAPPING":"",i.toneMapping!==kc?di.tonemapping_pars_fragment:"",i.toneMapping!==kc?Zhe("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",di.encodings_pars_fragment,Khe("linearToOutputTexel",i.outputEncoding),i.useDepthPacking?"#define DEPTH_PACKING "+i.depthPacking:"",`
`].filter(wx).join(`
`)),a=NL(a),a=jV(a,i),a=WV(a,i),o=NL(o),o=jV(o,i),o=WV(o,i),a=XV(a),o=XV(o),i.isWebGL2&&i.isRawShaderMaterial!==!0&&(x=`#version 300 es
`,g=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+g,m=["#define varying in",i.glslVersion===vV?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===vV?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+m);let w=x+g+a,_=x+m+o,M=HV(n,35633,w),S=HV(n,35632,_);if(n.attachShader(v,M),n.attachShader(v,S),i.index0AttributeName!==void 0?n.bindAttribLocation(v,0,i.index0AttributeName):i.morphTargets===!0&&n.bindAttribLocation(v,0,"position"),n.linkProgram(v),e.debug.checkShaderErrors){let E=n.getProgramInfoLog(v).trim(),C=n.getShaderInfoLog(M).trim(),D=n.getShaderInfoLog(S).trim(),I=!0,L=!0;if(n.getProgramParameter(v,35714)===!1){I=!1;let z=GV(n,M,"vertex"),F=GV(n,S,"fragment");console.error("THREE.WebGLProgram: Shader Error "+n.getError()+" - VALIDATE_STATUS "+n.getProgramParameter(v,35715)+`

Program Info Log: `+E+`
`+z+`
`+F)}else E!==""?console.warn("THREE.WebGLProgram: Program Info Log:",E):(C===""||D==="")&&(L=!1);L&&(this.diagnostics={runnable:I,programLog:E,vertexShader:{log:C,prefix:g},fragmentShader:{log:D,prefix:m}})}n.deleteShader(M),n.deleteShader(S);let A;this.getUniforms=function(){return A===void 0&&(A=new dE(n,v)),A};let T;return this.getAttributes=function(){return T===void 0&&(T=ede(n,v)),T},this.destroy=function(){r.releaseStatesOfProgram(this),n.deleteProgram(v),this.program=void 0},this.name=i.shaderName,this.id=qhe++,this.cacheKey=t,this.usedTimes=1,this.program=v,this.vertexShader=M,this.fragmentShader=S,this}var hde=0,dde=class{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){let t=e.vertexShader,i=e.fragmentShader,r=this._getShaderStage(t),n=this._getShaderStage(i),s=this._getShaderCacheForMaterial(e);return s.has(r)===!1&&(s.add(r),r.usedTimes++),s.has(n)===!1&&(s.add(n),n.usedTimes++),this}remove(e){let t=this.materialCache.get(e);for(let i of t)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){let t=this.materialCache,i=t.get(e);return i===void 0&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){let t=this.shaderCache,i=t.get(e);return i===void 0&&(i=new pde(e),t.set(e,i)),i}},pde=class{constructor(e){this.id=hde++,this.code=e,this.usedTimes=0}};function fde(e,t,i,r,n,s,a){let o=new dB,l=new dde,c=[],u=n.isWebGL2,h=n.logarithmicDepthBuffer,d=n.vertexTextures,p=n.precision,f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function v(T,E,C,D,I){let L=D.fog,z=I.geometry,F=T.isMeshStandardMaterial?D.environment:null,Q=(T.isMeshStandardMaterial?i:t).get(T.envMap||F),Y=Q&&Q.mapping===Lw?Q.image.height:null,O=f[T.type];T.precision!==null&&(p=n.getMaxPrecision(T.precision),p!==T.precision&&console.warn("THREE.WebGLProgram.getParameters:",T.precision,"not supported, using",p,"instead."));let j=z.morphAttributes.position||z.morphAttributes.normal||z.morphAttributes.color,V=j!==void 0?j.length:0,W=0;z.morphAttributes.position!==void 0&&(W=1),z.morphAttributes.normal!==void 0&&(W=2),z.morphAttributes.color!==void 0&&(W=3);let J,ce,$,ne;if(O){let _e=bc[O];J=_e.vertexShader,ce=_e.fragmentShader}else J=T.vertexShader,ce=T.fragmentShader,l.update(T),$=l.getVertexShaderID(T),ne=l.getFragmentShaderID(T);let ie=e.getRenderTarget(),de=T.alphaTest>0,be=T.clearcoat>0,we=T.iridescence>0;return{isWebGL2:u,shaderID:O,shaderName:T.type,vertexShader:J,fragmentShader:ce,defines:T.defines,customVertexShaderID:$,customFragmentShaderID:ne,isRawShaderMaterial:T.isRawShaderMaterial===!0,glslVersion:T.glslVersion,precision:p,instancing:I.isInstancedMesh===!0,instancingColor:I.isInstancedMesh===!0&&I.instanceColor!==null,supportsVertexTextures:d,outputEncoding:ie===null?e.outputEncoding:ie.isXRRenderTarget===!0?ie.texture.encoding:Vl,map:!!T.map,matcap:!!T.matcap,envMap:!!Q,envMapMode:Q&&Q.mapping,envMapCubeUVHeight:Y,lightMap:!!T.lightMap,aoMap:!!T.aoMap,emissiveMap:!!T.emissiveMap,bumpMap:!!T.bumpMap,normalMap:!!T.normalMap,objectSpaceNormalMap:T.normalMapType===Moe,tangentSpaceNormalMap:T.normalMapType===Soe,decodeVideoTexture:!!T.map&&T.map.isVideoTexture===!0&&T.map.encoding===hi,clearcoat:be,clearcoatMap:be&&!!T.clearcoatMap,clearcoatRoughnessMap:be&&!!T.clearcoatRoughnessMap,clearcoatNormalMap:be&&!!T.clearcoatNormalMap,iridescence:we,iridescenceMap:we&&!!T.iridescenceMap,iridescenceThicknessMap:we&&!!T.iridescenceThicknessMap,displacementMap:!!T.displacementMap,roughnessMap:!!T.roughnessMap,metalnessMap:!!T.metalnessMap,specularMap:!!T.specularMap,specularIntensityMap:!!T.specularIntensityMap,specularColorMap:!!T.specularColorMap,opaque:T.transparent===!1&&T.blending===_f,alphaMap:!!T.alphaMap,alphaTest:de,gradientMap:!!T.gradientMap,sheen:T.sheen>0,sheenColorMap:!!T.sheenColorMap,sheenRoughnessMap:!!T.sheenRoughnessMap,transmission:T.transmission>0,transmissionMap:!!T.transmissionMap,thicknessMap:!!T.thicknessMap,combine:T.combine,vertexTangents:!!T.normalMap&&!!z.attributes.tangent,vertexColors:T.vertexColors,vertexAlphas:T.vertexColors===!0&&!!z.attributes.color&&z.attributes.color.itemSize===4,vertexUvs:!!T.map||!!T.bumpMap||!!T.normalMap||!!T.specularMap||!!T.alphaMap||!!T.emissiveMap||!!T.roughnessMap||!!T.metalnessMap||!!T.clearcoatMap||!!T.clearcoatRoughnessMap||!!T.clearcoatNormalMap||!!T.iridescenceMap||!!T.iridescenceThicknessMap||!!T.displacementMap||!!T.transmissionMap||!!T.thicknessMap||!!T.specularIntensityMap||!!T.specularColorMap||!!T.sheenColorMap||!!T.sheenRoughnessMap,uvsVertexOnly:!(T.map||T.bumpMap||T.normalMap||T.specularMap||T.alphaMap||T.emissiveMap||T.roughnessMap||T.metalnessMap||T.clearcoatNormalMap||T.iridescenceMap||T.iridescenceThicknessMap||T.transmission>0||T.transmissionMap||T.thicknessMap||T.specularIntensityMap||T.specularColorMap||T.sheen>0||T.sheenColorMap||T.sheenRoughnessMap)&&!!T.displacementMap,fog:!!L,useFog:T.fog===!0,fogExp2:L&&L.isFogExp2,flatShading:!!T.flatShading,sizeAttenuation:T.sizeAttenuation,logarithmicDepthBuffer:h,skinning:I.isSkinnedMesh===!0,morphTargets:z.morphAttributes.position!==void 0,morphNormals:z.morphAttributes.normal!==void 0,morphColors:z.morphAttributes.color!==void 0,morphTargetsCount:V,morphTextureStride:W,numDirLights:E.directional.length,numPointLights:E.point.length,numSpotLights:E.spot.length,numSpotLightMaps:E.spotLightMap.length,numRectAreaLights:E.rectArea.length,numHemiLights:E.hemi.length,numDirLightShadows:E.directionalShadowMap.length,numPointLightShadows:E.pointShadowMap.length,numSpotLightShadows:E.spotShadowMap.length,numSpotLightShadowsWithMaps:E.numSpotLightShadowsWithMaps,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:T.dithering,shadowMapEnabled:e.shadowMap.enabled&&C.length>0,shadowMapType:e.shadowMap.type,toneMapping:T.toneMapped?e.toneMapping:kc,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:T.premultipliedAlpha,doubleSided:T.side===Ws,flipSided:T.side===ns,useDepthPacking:!!T.depthPacking,depthPacking:T.depthPacking||0,index0AttributeName:T.index0AttributeName,extensionDerivatives:T.extensions&&T.extensions.derivatives,extensionFragDepth:T.extensions&&T.extensions.fragDepth,extensionDrawBuffers:T.extensions&&T.extensions.drawBuffers,extensionShaderTextureLOD:T.extensions&&T.extensions.shaderTextureLOD,rendererExtensionFragDepth:u||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||r.has("EXT_shader_texture_lod"),customProgramCacheKey:T.customProgramCacheKey()}}function g(T){let E=[];if(T.shaderID?E.push(T.shaderID):(E.push(T.customVertexShaderID),E.push(T.customFragmentShaderID)),T.defines!==void 0)for(let C in T.defines)E.push(C),E.push(T.defines[C]);return T.isRawShaderMaterial===!1&&(m(E,T),x(E,T),E.push(e.outputEncoding)),E.push(T.customProgramCacheKey),E.join()}function m(T,E){T.push(E.precision),T.push(E.outputEncoding),T.push(E.envMapMode),T.push(E.envMapCubeUVHeight),T.push(E.combine),T.push(E.vertexUvs),T.push(E.fogExp2),T.push(E.sizeAttenuation),T.push(E.morphTargetsCount),T.push(E.morphAttributeCount),T.push(E.numDirLights),T.push(E.numPointLights),T.push(E.numSpotLights),T.push(E.numSpotLightMaps),T.push(E.numHemiLights),T.push(E.numRectAreaLights),T.push(E.numDirLightShadows),T.push(E.numPointLightShadows),T.push(E.numSpotLightShadows),T.push(E.numSpotLightShadowsWithMaps),T.push(E.shadowMapType),T.push(E.toneMapping),T.push(E.numClippingPlanes),T.push(E.numClipIntersection),T.push(E.depthPacking)}function x(T,E){o.disableAll(),E.isWebGL2&&o.enable(0),E.supportsVertexTextures&&o.enable(1),E.instancing&&o.enable(2),E.instancingColor&&o.enable(3),E.map&&o.enable(4),E.matcap&&o.enable(5),E.envMap&&o.enable(6),E.lightMap&&o.enable(7),E.aoMap&&o.enable(8),E.emissiveMap&&o.enable(9),E.bumpMap&&o.enable(10),E.normalMap&&o.enable(11),E.objectSpaceNormalMap&&o.enable(12),E.tangentSpaceNormalMap&&o.enable(13),E.clearcoat&&o.enable(14),E.clearcoatMap&&o.enable(15),E.clearcoatRoughnessMap&&o.enable(16),E.clearcoatNormalMap&&o.enable(17),E.iridescence&&o.enable(18),E.iridescenceMap&&o.enable(19),E.iridescenceThicknessMap&&o.enable(20),E.displacementMap&&o.enable(21),E.specularMap&&o.enable(22),E.roughnessMap&&o.enable(23),E.metalnessMap&&o.enable(24),E.gradientMap&&o.enable(25),E.alphaMap&&o.enable(26),E.alphaTest&&o.enable(27),E.vertexColors&&o.enable(28),E.vertexAlphas&&o.enable(29),E.vertexUvs&&o.enable(30),E.vertexTangents&&o.enable(31),E.uvsVertexOnly&&o.enable(32),T.push(o.mask),o.disableAll(),E.fog&&o.enable(0),E.useFog&&o.enable(1),E.flatShading&&o.enable(2),E.logarithmicDepthBuffer&&o.enable(3),E.skinning&&o.enable(4),E.morphTargets&&o.enable(5),E.morphNormals&&o.enable(6),E.morphColors&&o.enable(7),E.premultipliedAlpha&&o.enable(8),E.shadowMapEnabled&&o.enable(9),E.physicallyCorrectLights&&o.enable(10),E.doubleSided&&o.enable(11),E.flipSided&&o.enable(12),E.useDepthPacking&&o.enable(13),E.dithering&&o.enable(14),E.specularIntensityMap&&o.enable(15),E.specularColorMap&&o.enable(16),E.transmission&&o.enable(17),E.transmissionMap&&o.enable(18),E.thicknessMap&&o.enable(19),E.sheen&&o.enable(20),E.sheenColorMap&&o.enable(21),E.sheenRoughnessMap&&o.enable(22),E.decodeVideoTexture&&o.enable(23),E.opaque&&o.enable(24),T.push(o.mask)}function w(T){let E=f[T.type],C;if(E){let D=bc[E];C=S0.clone(D.uniforms)}else C=T.uniforms;return C}function _(T,E){let C;for(let D=0,I=c.length;D<I;D++){let L=c[D];if(L.cacheKey===E){C=L,++C.usedTimes;break}}return C===void 0&&(C=new ude(e,E,T,s),c.push(C)),C}function M(T){if(--T.usedTimes===0){let E=c.indexOf(T);c[E]=c[c.length-1],c.pop(),T.destroy()}}function S(T){l.remove(T)}function A(){l.dispose()}return{getParameters:v,getProgramCacheKey:g,getUniforms:w,acquireProgram:_,releaseProgram:M,releaseShaderCache:S,programs:c,dispose:A}}function mde(){let e=new WeakMap;function t(s){let a=e.get(s);return a===void 0&&(a={},e.set(s,a)),a}function i(s){e.delete(s)}function r(s,a,o){e.get(s)[a]=o}function n(){e=new WeakMap}return{get:t,remove:i,update:r,dispose:n}}function gde(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function YV(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function QV(){let e=[],t=0,i=[],r=[],n=[];function s(){t=0,i.length=0,r.length=0,n.length=0}function a(h,d,p,f,v,g){let m=e[t];return m===void 0?(m={id:h.id,object:h,geometry:d,material:p,groupOrder:f,renderOrder:h.renderOrder,z:v,group:g},e[t]=m):(m.id=h.id,m.object=h,m.geometry=d,m.material=p,m.groupOrder=f,m.renderOrder=h.renderOrder,m.z=v,m.group=g),t++,m}function o(h,d,p,f,v,g){let m=a(h,d,p,f,v,g);p.transmission>0?r.push(m):p.transparent===!0?n.push(m):i.push(m)}function l(h,d,p,f,v,g){let m=a(h,d,p,f,v,g);p.transmission>0?r.unshift(m):p.transparent===!0?n.unshift(m):i.unshift(m)}function c(h,d){i.length>1&&i.sort(h||gde),r.length>1&&r.sort(d||YV),n.length>1&&n.sort(d||YV)}function u(){for(let h=t,d=e.length;h<d;h++){let p=e[h];if(p.id===null)break;p.id=null,p.object=null,p.geometry=null,p.material=null,p.group=null}}return{opaque:i,transmissive:r,transparent:n,init:s,push:o,unshift:l,finish:u,sort:c}}function vde(){let e=new WeakMap;function t(r,n){let s=e.get(r),a;return s===void 0?(a=new QV,e.set(r,[a])):n>=s.length?(a=new QV,s.push(a)):a=s[n],a}function i(){e=new WeakMap}return{get:t,dispose:i}}function yde(){let e={};return{get:function(t){if(e[t.id]!==void 0)return e[t.id];let i;switch(t.type){case"DirectionalLight":i={direction:new B,color:new jt};break;case"SpotLight":i={position:new B,direction:new B,color:new jt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new B,color:new jt,distance:0,decay:0};break;case"HemisphereLight":i={direction:new B,skyColor:new jt,groundColor:new jt};break;case"RectAreaLight":i={color:new jt,position:new B,halfWidth:new B,halfHeight:new B};break}return e[t.id]=i,i}}}function xde(){let e={};return{get:function(t){if(e[t.id]!==void 0)return e[t.id];let i;switch(t.type){case"DirectionalLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ve};break;case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ve};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ve,shadowCameraNear:1,shadowCameraFar:1e3};break}return e[t.id]=i,i}}}var wde=0;function bde(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function _de(e,t){let i=new yde,r=xde(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let u=0;u<9;u++)n.probe.push(new B);let s=new B,a=new ht,o=new ht;function l(u,h){let d=0,p=0,f=0;for(let D=0;D<9;D++)n.probe[D].set(0,0,0);let v=0,g=0,m=0,x=0,w=0,_=0,M=0,S=0,A=0,T=0;u.sort(bde);let E=h!==!0?Math.PI:1;for(let D=0,I=u.length;D<I;D++){let L=u[D],z=L.color,F=L.intensity,Q=L.distance,Y=L.shadow&&L.shadow.map?L.shadow.map.texture:null;if(L.isAmbientLight)d+=z.r*F*E,p+=z.g*F*E,f+=z.b*F*E;else if(L.isLightProbe)for(let O=0;O<9;O++)n.probe[O].addScaledVector(L.sh.coefficients[O],F);else if(L.isDirectionalLight){let O=i.get(L);if(O.color.copy(L.color).multiplyScalar(L.intensity*E),L.castShadow){let j=L.shadow,V=r.get(L);V.shadowBias=j.bias,V.shadowNormalBias=j.normalBias,V.shadowRadius=j.radius,V.shadowMapSize=j.mapSize,n.directionalShadow[v]=V,n.directionalShadowMap[v]=Y,n.directionalShadowMatrix[v]=L.shadow.matrix,_++}n.directional[v]=O,v++}else if(L.isSpotLight){let O=i.get(L);O.position.setFromMatrixPosition(L.matrixWorld),O.color.copy(z).multiplyScalar(F*E),O.distance=Q,O.coneCos=Math.cos(L.angle),O.penumbraCos=Math.cos(L.angle*(1-L.penumbra)),O.decay=L.decay,n.spot[m]=O;let j=L.shadow;if(L.map&&(n.spotLightMap[A]=L.map,A++,j.updateMatrices(L),L.castShadow&&T++),n.spotLightMatrix[m]=j.matrix,L.castShadow){let V=r.get(L);V.shadowBias=j.bias,V.shadowNormalBias=j.normalBias,V.shadowRadius=j.radius,V.shadowMapSize=j.mapSize,n.spotShadow[m]=V,n.spotShadowMap[m]=Y,S++}m++}else if(L.isRectAreaLight){let O=i.get(L);O.color.copy(z).multiplyScalar(F),O.halfWidth.set(L.width*.5,0,0),O.halfHeight.set(0,L.height*.5,0),n.rectArea[x]=O,x++}else if(L.isPointLight){let O=i.get(L);if(O.color.copy(L.color).multiplyScalar(L.intensity*E),O.distance=L.distance,O.decay=L.decay,L.castShadow){let j=L.shadow,V=r.get(L);V.shadowBias=j.bias,V.shadowNormalBias=j.normalBias,V.shadowRadius=j.radius,V.shadowMapSize=j.mapSize,V.shadowCameraNear=j.camera.near,V.shadowCameraFar=j.camera.far,n.pointShadow[g]=V,n.pointShadowMap[g]=Y,n.pointShadowMatrix[g]=L.shadow.matrix,M++}n.point[g]=O,g++}else if(L.isHemisphereLight){let O=i.get(L);O.skyColor.copy(L.color).multiplyScalar(F*E),O.groundColor.copy(L.groundColor).multiplyScalar(F*E),n.hemi[w]=O,w++}}x>0&&(t.isWebGL2||e.has("OES_texture_float_linear")===!0?(n.rectAreaLTC1=wt.LTC_FLOAT_1,n.rectAreaLTC2=wt.LTC_FLOAT_2):e.has("OES_texture_half_float_linear")===!0?(n.rectAreaLTC1=wt.LTC_HALF_1,n.rectAreaLTC2=wt.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),n.ambient[0]=d,n.ambient[1]=p,n.ambient[2]=f;let C=n.hash;(C.directionalLength!==v||C.pointLength!==g||C.spotLength!==m||C.rectAreaLength!==x||C.hemiLength!==w||C.numDirectionalShadows!==_||C.numPointShadows!==M||C.numSpotShadows!==S||C.numSpotMaps!==A)&&(n.directional.length=v,n.spot.length=m,n.rectArea.length=x,n.point.length=g,n.hemi.length=w,n.directionalShadow.length=_,n.directionalShadowMap.length=_,n.pointShadow.length=M,n.pointShadowMap.length=M,n.spotShadow.length=S,n.spotShadowMap.length=S,n.directionalShadowMatrix.length=_,n.pointShadowMatrix.length=M,n.spotLightMatrix.length=S+A-T,n.spotLightMap.length=A,n.numSpotLightShadowsWithMaps=T,C.directionalLength=v,C.pointLength=g,C.spotLength=m,C.rectAreaLength=x,C.hemiLength=w,C.numDirectionalShadows=_,C.numPointShadows=M,C.numSpotShadows=S,C.numSpotMaps=A,n.version=wde++)}function c(u,h){let d=0,p=0,f=0,v=0,g=0,m=h.matrixWorldInverse;for(let x=0,w=u.length;x<w;x++){let _=u[x];if(_.isDirectionalLight){let M=n.directional[d];M.direction.setFromMatrixPosition(_.matrixWorld),s.setFromMatrixPosition(_.target.matrixWorld),M.direction.sub(s),M.direction.transformDirection(m),d++}else if(_.isSpotLight){let M=n.spot[f];M.position.setFromMatrixPosition(_.matrixWorld),M.position.applyMatrix4(m),M.direction.setFromMatrixPosition(_.matrixWorld),s.setFromMatrixPosition(_.target.matrixWorld),M.direction.sub(s),M.direction.transformDirection(m),f++}else if(_.isRectAreaLight){let M=n.rectArea[v];M.position.setFromMatrixPosition(_.matrixWorld),M.position.applyMatrix4(m),o.identity(),a.copy(_.matrixWorld),a.premultiply(m),o.extractRotation(a),M.halfWidth.set(_.width*.5,0,0),M.halfHeight.set(0,_.height*.5,0),M.halfWidth.applyMatrix4(o),M.halfHeight.applyMatrix4(o),v++}else if(_.isPointLight){let M=n.point[p];M.position.setFromMatrixPosition(_.matrixWorld),M.position.applyMatrix4(m),p++}else if(_.isHemisphereLight){let M=n.hemi[g];M.direction.setFromMatrixPosition(_.matrixWorld),M.direction.transformDirection(m),g++}}}return{setup:l,setupView:c,state:n}}function KV(e,t){let i=new _de(e,t),r=[],n=[];function s(){r.length=0,n.length=0}function a(u){r.push(u)}function o(u){n.push(u)}function l(u){i.setup(r,u)}function c(u){i.setupView(r,u)}return{init:s,state:{lightsArray:r,shadowsArray:n,lights:i},setupLights:l,setupLightsView:c,pushLight:a,pushShadow:o}}function Sde(e,t){let i=new WeakMap;function r(s,a=0){let o=i.get(s),l;return o===void 0?(l=new KV(e,t),i.set(s,[l])):a>=o.length?(l=new KV(e,t),o.push(l)):l=o[a],l}function n(){i=new WeakMap}return{get:r,dispose:n}}var FY=class extends Ow{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=Mh,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}},Mde=class extends Ow{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new B,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}},Ede=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,Ade=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function Cde(e,t,i){let r=new fB,n=new ve,s=new ve,a=new ti,o=new FY({depthPacking:AY}),l=new Mde,c={},u=i.maxTextureSize,h={[Fl]:ns,[ns]:Fl,[Ws]:Ws},d=new Ui({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new ve},radius:{value:4}},vertexShader:Ede,fragmentShader:Ade}),p=d.clone();p.defines.HORIZONTAL_PASS=1;let f=new Bt;f.setAttribute("position",new $t(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));let v=new zr(f,d),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=lB,this.render=function(_,M,S){if(g.enabled===!1||g.autoUpdate===!1&&g.needsUpdate===!1||_.length===0)return;let A=e.getRenderTarget(),T=e.getActiveCubeFace(),E=e.getActiveMipmapLevel(),C=e.state;C.setBlending(An),C.buffers.color.setClear(1,1,1,1),C.buffers.depth.setTest(!0),C.setScissorTest(!1);for(let D=0,I=_.length;D<I;D++){let L=_[D],z=L.shadow;if(z===void 0){console.warn("THREE.WebGLShadowMap:",L,"has no shadow.");continue}if(z.autoUpdate===!1&&z.needsUpdate===!1)continue;n.copy(z.mapSize);let F=z.getFrameExtents();if(n.multiply(F),s.copy(z.mapSize),(n.x>u||n.y>u)&&(n.x>u&&(s.x=Math.floor(u/F.x),n.x=s.x*F.x,z.mapSize.x=s.x),n.y>u&&(s.y=Math.floor(u/F.y),n.y=s.y*F.y,z.mapSize.y=s.y)),z.map===null){let Y=this.type!==xx?{minFilter:Qi,magFilter:Qi}:{};z.map=new Wi(n.x,n.y,Y),z.map.texture.name=L.name+".shadowMap",z.camera.updateProjectionMatrix()}e.setRenderTarget(z.map),e.clear();let Q=z.getViewportCount();for(let Y=0;Y<Q;Y++){let O=z.getViewport(Y);a.set(s.x*O.x,s.y*O.y,s.x*O.z,s.y*O.w),C.viewport(a),z.updateMatrices(L,Y),r=z.getFrustum(),w(M,S,z.camera,L,this.type)}z.isPointLightShadow!==!0&&this.type===xx&&m(z,S),z.needsUpdate=!1}g.needsUpdate=!1,e.setRenderTarget(A,T,E)};function m(_,M){let S=t.update(v);d.defines.VSM_SAMPLES!==_.blurSamples&&(d.defines.VSM_SAMPLES=_.blurSamples,p.defines.VSM_SAMPLES=_.blurSamples,d.needsUpdate=!0,p.needsUpdate=!0),_.mapPass===null&&(_.mapPass=new Wi(n.x,n.y)),d.uniforms.shadow_pass.value=_.map.texture,d.uniforms.resolution.value=_.mapSize,d.uniforms.radius.value=_.radius,e.setRenderTarget(_.mapPass),e.clear(),e.renderBufferDirect(M,null,S,d,v,null),p.uniforms.shadow_pass.value=_.mapPass.texture,p.uniforms.resolution.value=_.mapSize,p.uniforms.radius.value=_.radius,e.setRenderTarget(_.map),e.clear(),e.renderBufferDirect(M,null,S,p,v,null)}function x(_,M,S,A,T,E){let C=null,D=S.isPointLight===!0?_.customDistanceMaterial:_.customDepthMaterial;if(D!==void 0)C=D;else if(C=S.isPointLight===!0?l:o,e.localClippingEnabled&&M.clipShadows===!0&&Array.isArray(M.clippingPlanes)&&M.clippingPlanes.length!==0||M.displacementMap&&M.displacementScale!==0||M.alphaMap&&M.alphaTest>0||M.map&&M.alphaTest>0){let I=C.uuid,L=M.uuid,z=c[I];z===void 0&&(z={},c[I]=z);let F=z[L];F===void 0&&(F=C.clone(),z[L]=F),C=F}return C.visible=M.visible,C.wireframe=M.wireframe,E===xx?C.side=M.shadowSide!==null?M.shadowSide:M.side:C.side=M.shadowSide!==null?M.shadowSide:h[M.side],C.alphaMap=M.alphaMap,C.alphaTest=M.alphaTest,C.map=M.map,C.clipShadows=M.clipShadows,C.clippingPlanes=M.clippingPlanes,C.clipIntersection=M.clipIntersection,C.displacementMap=M.displacementMap,C.displacementScale=M.displacementScale,C.displacementBias=M.displacementBias,C.wireframeLinewidth=M.wireframeLinewidth,C.linewidth=M.linewidth,S.isPointLight===!0&&C.isMeshDistanceMaterial===!0&&(C.referencePosition.setFromMatrixPosition(S.matrixWorld),C.nearDistance=A,C.farDistance=T),C}function w(_,M,S,A,T){if(_.visible===!1)return;if(_.layers.test(M.layers)&&(_.isMesh||_.isLine||_.isPoints)&&(_.castShadow||_.receiveShadow&&T===xx)&&(!_.frustumCulled||r.intersectsObject(_))){_.modelViewMatrix.multiplyMatrices(S.matrixWorldInverse,_.matrixWorld);let C=t.update(_),D=_.material;if(Array.isArray(D)){let I=C.groups;for(let L=0,z=I.length;L<z;L++){let F=I[L],Q=D[F.materialIndex];if(Q&&Q.visible){let Y=x(_,Q,A,S.near,S.far,T);e.renderBufferDirect(S,null,C,Y,_,F)}}}else if(D.visible){let I=x(_,D,A,S.near,S.far,T);e.renderBufferDirect(S,null,C,I,_,null)}}let E=_.children;for(let C=0,D=E.length;C<D;C++)w(E[C],M,S,A,T)}}function Tde(e,t,i){let r=i.isWebGL2;function n(){let ae=!1,fe=new ti,Se=null,Ne=new ti(0,0,0,0);return{setMask:function(st){Se!==st&&!ae&&(e.colorMask(st,st,st,st),Se=st)},setLocked:function(st){ae=st},setClear:function(st,vt,Ut,Wt,Jt){Jt===!0&&(st*=Wt,vt*=Wt,Ut*=Wt),fe.set(st,vt,Ut,Wt),Ne.equals(fe)===!1&&(e.clearColor(st,vt,Ut,Wt),Ne.copy(fe))},reset:function(){ae=!1,Se=null,Ne.set(-1,0,0,0)}}}function s(){let ae=!1,fe=null,Se=null,Ne=null;return{setTest:function(st){st?de(2929):be(2929)},setMask:function(st){fe!==st&&!ae&&(e.depthMask(st),fe=st)},setFunc:function(st){if(Se!==st){switch(st){case Yae:e.depthFunc(512);break;case Qae:e.depthFunc(519);break;case Kae:e.depthFunc(513);break;case PL:e.depthFunc(515);break;case Zae:e.depthFunc(514);break;case $ae:e.depthFunc(518);break;case Jae:e.depthFunc(516);break;case eoe:e.depthFunc(517);break;default:e.depthFunc(515)}Se=st}},setLocked:function(st){ae=st},setClear:function(st){Ne!==st&&(e.clearDepth(st),Ne=st)},reset:function(){ae=!1,fe=null,Se=null,Ne=null}}}function a(){let ae=!1,fe=null,Se=null,Ne=null,st=null,vt=null,Ut=null,Wt=null,Jt=null;return{setTest:function(ci){ae||(ci?de(2960):be(2960))},setMask:function(ci){fe!==ci&&!ae&&(e.stencilMask(ci),fe=ci)},setFunc:function(ci,Ki,Tn){(Se!==ci||Ne!==Ki||st!==Tn)&&(e.stencilFunc(ci,Ki,Tn),Se=ci,Ne=Ki,st=Tn)},setOp:function(ci,Ki,Tn){(vt!==ci||Ut!==Ki||Wt!==Tn)&&(e.stencilOp(ci,Ki,Tn),vt=ci,Ut=Ki,Wt=Tn)},setLocked:function(ci){ae=ci},setClear:function(ci){Jt!==ci&&(e.clearStencil(ci),Jt=ci)},reset:function(){ae=!1,fe=null,Se=null,Ne=null,st=null,vt=null,Ut=null,Wt=null,Jt=null}}}let o=new n,l=new s,c=new a,u=new WeakMap,h=new WeakMap,d={},p={},f=new WeakMap,v=[],g=null,m=!1,x=null,w=null,_=null,M=null,S=null,A=null,T=null,E=!1,C=null,D=null,I=null,L=null,z=null,F=e.getParameter(35661),Q=!1,Y=0,O=e.getParameter(7938);O.indexOf("WebGL")!==-1?(Y=parseFloat(/^WebGL (\d)/.exec(O)[1]),Q=Y>=1):O.indexOf("OpenGL ES")!==-1&&(Y=parseFloat(/^OpenGL ES (\d)/.exec(O)[1]),Q=Y>=2);let j=null,V={},W=e.getParameter(3088),J=e.getParameter(2978),ce=new ti().fromArray(W),$=new ti().fromArray(J);function ne(ae,fe,Se){let Ne=new Uint8Array(4),st=e.createTexture();e.bindTexture(ae,st),e.texParameteri(ae,10241,9728),e.texParameteri(ae,10240,9728);for(let vt=0;vt<Se;vt++)e.texImage2D(fe+vt,0,6408,1,1,0,6408,5121,Ne);return st}let ie={};ie[3553]=ne(3553,3553,1),ie[34067]=ne(34067,34069,6),o.setClear(0,0,0,1),l.setClear(1),c.setClear(0),de(2929),l.setFunc(PL),Pe(!1),Ye(V5),de(2884),Oe(An);function de(ae){d[ae]!==!0&&(e.enable(ae),d[ae]=!0)}function be(ae){d[ae]!==!1&&(e.disable(ae),d[ae]=!1)}function we(ae,fe){return p[ae]!==fe?(e.bindFramebuffer(ae,fe),p[ae]=fe,r&&(ae===36009&&(p[36160]=fe),ae===36160&&(p[36009]=fe)),!0):!1}function _e(ae,fe){let Se=v,Ne=!1;if(ae)if(Se=f.get(fe),Se===void 0&&(Se=[],f.set(fe,Se)),ae.isWebGLMultipleRenderTargets){let st=ae.texture;if(Se.length!==st.length||Se[0]!==36064){for(let vt=0,Ut=st.length;vt<Ut;vt++)Se[vt]=36064+vt;Se.length=st.length,Ne=!0}}else Se[0]!==36064&&(Se[0]=36064,Ne=!0);else Se[0]!==1029&&(Se[0]=1029,Ne=!0);Ne&&(i.isWebGL2?e.drawBuffers(Se):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(Se))}function Me(ae){return g!==ae?(e.useProgram(ae),g=ae,!0):!1}let X={[Lg]:32774,[Bae]:32778,[kae]:32779};if(r)X[W5]=32775,X[X5]=32776;else{let ae=t.get("EXT_blend_minmax");ae!==null&&(X[W5]=ae.MIN_EXT,X[X5]=ae.MAX_EXT)}let ge={[Uae]:0,[Fae]:1,[Vae]:768,[yY]:770,[qae]:776,[Wae]:774,[Gae]:772,[Hae]:769,[xY]:771,[Xae]:775,[jae]:773};function Oe(ae,fe,Se,Ne,st,vt,Ut,Wt){if(ae===An){m===!0&&(be(3042),m=!1);return}if(m===!1&&(de(3042),m=!0),ae!==Nae){if(ae!==x||Wt!==E){if((w!==Lg||S!==Lg)&&(e.blendEquation(32774),w=Lg,S=Lg),Wt)switch(ae){case _f:e.blendFuncSeparate(1,771,1,771);break;case H5:e.blendFunc(1,1);break;case G5:e.blendFuncSeparate(0,769,0,1);break;case j5:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",ae);break}else switch(ae){case _f:e.blendFuncSeparate(770,771,1,771);break;case H5:e.blendFunc(770,1);break;case G5:e.blendFuncSeparate(0,769,0,1);break;case j5:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",ae);break}_=null,M=null,A=null,T=null,x=ae,E=Wt}return}st=st||fe,vt=vt||Se,Ut=Ut||Ne,(fe!==w||st!==S)&&(e.blendEquationSeparate(X[fe],X[st]),w=fe,S=st),(Se!==_||Ne!==M||vt!==A||Ut!==T)&&(e.blendFuncSeparate(ge[Se],ge[Ne],ge[vt],ge[Ut]),_=Se,M=Ne,A=vt,T=Ut),x=ae,E=!1}function Ie(ae,fe){ae.side===Ws?be(2884):de(2884);let Se=ae.side===ns;fe&&(Se=!Se),Pe(Se),ae.blending===_f&&ae.transparent===!1?Oe(An):Oe(ae.blending,ae.blendEquation,ae.blendSrc,ae.blendDst,ae.blendEquationAlpha,ae.blendSrcAlpha,ae.blendDstAlpha,ae.premultipliedAlpha),l.setFunc(ae.depthFunc),l.setTest(ae.depthTest),l.setMask(ae.depthWrite),o.setMask(ae.colorWrite);let Ne=ae.stencilWrite;c.setTest(Ne),Ne&&(c.setMask(ae.stencilWriteMask),c.setFunc(ae.stencilFunc,ae.stencilRef,ae.stencilFuncMask),c.setOp(ae.stencilFail,ae.stencilZFail,ae.stencilZPass)),Fe(ae.polygonOffset,ae.polygonOffsetFactor,ae.polygonOffsetUnits),ae.alphaToCoverage===!0?de(32926):be(32926)}function Pe(ae){C!==ae&&(ae?e.frontFace(2304):e.frontFace(2305),C=ae)}function Ye(ae){ae!==Lae?(de(2884),ae!==D&&(ae===V5?e.cullFace(1029):ae===Oae?e.cullFace(1028):e.cullFace(1032))):be(2884),D=ae}function ke(ae){ae!==I&&(Q&&e.lineWidth(ae),I=ae)}function Fe(ae,fe,Se){ae?(de(32823),(L!==fe||z!==Se)&&(e.polygonOffset(fe,Se),L=fe,z=Se)):be(32823)}function se(ae){ae?de(3089):be(3089)}function Z(ae){ae===void 0&&(ae=33984+F-1),j!==ae&&(e.activeTexture(ae),j=ae)}function K(ae,fe,Se){Se===void 0&&(j===null?Se=33984+F-1:Se=j);let Ne=V[Se];Ne===void 0&&(Ne={type:void 0,texture:void 0},V[Se]=Ne),(Ne.type!==ae||Ne.texture!==fe)&&(j!==Se&&(e.activeTexture(Se),j=Se),e.bindTexture(ae,fe||ie[ae]),Ne.type=ae,Ne.texture=fe)}function k(){let ae=V[j];ae!==void 0&&ae.type!==void 0&&(e.bindTexture(ae.type,null),ae.type=void 0,ae.texture=void 0)}function re(){try{e.compressedTexImage2D.apply(e,arguments)}catch(ae){console.error("THREE.WebGLState:",ae)}}function he(){try{e.compressedTexImage3D.apply(e,arguments)}catch(ae){console.error("THREE.WebGLState:",ae)}}function G(){try{e.texSubImage2D.apply(e,arguments)}catch(ae){console.error("THREE.WebGLState:",ae)}}function Te(){try{e.texSubImage3D.apply(e,arguments)}catch(ae){console.error("THREE.WebGLState:",ae)}}function ze(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(ae){console.error("THREE.WebGLState:",ae)}}function Qe(){try{e.compressedTexSubImage3D.apply(e,arguments)}catch(ae){console.error("THREE.WebGLState:",ae)}}function ye(){try{e.texStorage2D.apply(e,arguments)}catch(ae){console.error("THREE.WebGLState:",ae)}}function je(){try{e.texStorage3D.apply(e,arguments)}catch(ae){console.error("THREE.WebGLState:",ae)}}function nt(){try{e.texImage2D.apply(e,arguments)}catch(ae){console.error("THREE.WebGLState:",ae)}}function ct(){try{e.texImage3D.apply(e,arguments)}catch(ae){console.error("THREE.WebGLState:",ae)}}function tt(ae){ce.equals(ae)===!1&&(e.scissor(ae.x,ae.y,ae.z,ae.w),ce.copy(ae))}function ue(ae){$.equals(ae)===!1&&(e.viewport(ae.x,ae.y,ae.z,ae.w),$.copy(ae))}function Ue(ae,fe){let Se=h.get(fe);Se===void 0&&(Se=new WeakMap,h.set(fe,Se));let Ne=Se.get(ae);Ne===void 0&&(Ne=e.getUniformBlockIndex(fe,ae.name),Se.set(ae,Ne))}function dt(ae,fe){let Se=h.get(fe).get(ae);u.get(fe)!==Se&&(e.uniformBlockBinding(fe,Se,ae.__bindingPointIndex),u.set(fe,Se))}function xe(){e.disable(3042),e.disable(2884),e.disable(2929),e.disable(32823),e.disable(3089),e.disable(2960),e.disable(32926),e.blendEquation(32774),e.blendFunc(1,0),e.blendFuncSeparate(1,0,1,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(513),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(519,0,4294967295),e.stencilOp(7680,7680,7680),e.clearStencil(0),e.cullFace(1029),e.frontFace(2305),e.polygonOffset(0,0),e.activeTexture(33984),e.bindFramebuffer(36160,null),r===!0&&(e.bindFramebuffer(36009,null),e.bindFramebuffer(36008,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),d={},j=null,V={},p={},f=new WeakMap,v=[],g=null,m=!1,x=null,w=null,_=null,M=null,S=null,A=null,T=null,E=!1,C=null,D=null,I=null,L=null,z=null,ce.set(0,0,e.canvas.width,e.canvas.height),$.set(0,0,e.canvas.width,e.canvas.height),o.reset(),l.reset(),c.reset()}return{buffers:{color:o,depth:l,stencil:c},enable:de,disable:be,bindFramebuffer:we,drawBuffers:_e,useProgram:Me,setBlending:Oe,setMaterial:Ie,setFlipSided:Pe,setCullFace:Ye,setLineWidth:ke,setPolygonOffset:Fe,setScissorTest:se,activeTexture:Z,bindTexture:K,unbindTexture:k,compressedTexImage2D:re,compressedTexImage3D:he,texImage2D:nt,texImage3D:ct,updateUBOMapping:Ue,uniformBlockBinding:dt,texStorage2D:ye,texStorage3D:je,texSubImage2D:G,texSubImage3D:Te,compressedTexSubImage2D:ze,compressedTexSubImage3D:Qe,scissor:tt,viewport:ue,reset:xe}}function Pde(e,t,i,r,n,s,a){let o=n.isWebGL2,l=n.maxTextures,c=n.maxCubemapSize,u=n.maxTextureSize,h=n.maxSamples,d=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,p=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),f=new WeakMap,v,g=new WeakMap,m=!1;try{m=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function x(K,k){return m?new OffscreenCanvas(K,k):I1("canvas")}function w(K,k,re,he){let G=1;if((K.width>he||K.height>he)&&(G=he/Math.max(K.width,K.height)),G<1||k===!0)if(typeof HTMLImageElement<"u"&&K instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&K instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&K instanceof ImageBitmap){let Te=k?xA:Math.floor,ze=Te(G*K.width),Qe=Te(G*K.height);v===void 0&&(v=x(ze,Qe));let ye=re?x(ze,Qe):v;return ye.width=ze,ye.height=Qe,ye.getContext("2d").drawImage(K,0,0,ze,Qe),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+K.width+"x"+K.height+") to ("+ze+"x"+Qe+")."),ye}else return"data"in K&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+K.width+"x"+K.height+")."),K;return K}function _(K){return zL(K.width)&&zL(K.height)}function M(K){return o?!1:K.wrapS!==Ar||K.wrapT!==Ar||K.minFilter!==Qi&&K.minFilter!==pi}function S(K,k){return K.generateMipmaps&&k&&K.minFilter!==Qi&&K.minFilter!==pi}function A(K){e.generateMipmap(K)}function T(K,k,re,he,G=!1){if(o===!1)return k;if(K!==null){if(e[K]!==void 0)return e[K];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+K+"'")}let Te=k;return k===6403&&(re===5126&&(Te=33326),re===5131&&(Te=33325),re===5121&&(Te=33321)),k===33319&&(re===5126&&(Te=33328),re===5131&&(Te=33327),re===5121&&(Te=33323)),k===6408&&(re===5126&&(Te=34836),re===5131&&(Te=34842),re===5121&&(Te=he===hi&&G===!1?35907:32856),re===32819&&(Te=32854),re===32820&&(Te=32855)),(Te===33325||Te===33326||Te===33327||Te===33328||Te===34842||Te===34836)&&t.get("EXT_color_buffer_float"),Te}function E(K,k,re){return S(K,re)===!0||K.isFramebufferTexture&&K.minFilter!==Qi&&K.minFilter!==pi?Math.log2(Math.max(k.width,k.height))+1:K.mipmaps!==void 0&&K.mipmaps.length>0?K.mipmaps.length:K.isCompressedTexture&&Array.isArray(K.image)?k.mipmaps.length:1}function C(K){return K===Qi||K===q5||K===bD?9728:9729}function D(K){let k=K.target;k.removeEventListener("dispose",D),L(k),k.isVideoTexture&&f.delete(k)}function I(K){let k=K.target;k.removeEventListener("dispose",I),F(k)}function L(K){let k=r.get(K);if(k.__webglInit===void 0)return;let re=K.source,he=g.get(re);if(he){let G=he[k.__cacheKey];G.usedTimes--,G.usedTimes===0&&z(K),Object.keys(he).length===0&&g.delete(re)}r.remove(K)}function z(K){let k=r.get(K);e.deleteTexture(k.__webglTexture);let re=K.source,he=g.get(re);delete he[k.__cacheKey],a.memory.textures--}function F(K){let k=K.texture,re=r.get(K),he=r.get(k);if(he.__webglTexture!==void 0&&(e.deleteTexture(he.__webglTexture),a.memory.textures--),K.depthTexture&&K.depthTexture.dispose(),K.isWebGLCubeRenderTarget)for(let G=0;G<6;G++)e.deleteFramebuffer(re.__webglFramebuffer[G]),re.__webglDepthbuffer&&e.deleteRenderbuffer(re.__webglDepthbuffer[G]);else{if(e.deleteFramebuffer(re.__webglFramebuffer),re.__webglDepthbuffer&&e.deleteRenderbuffer(re.__webglDepthbuffer),re.__webglMultisampledFramebuffer&&e.deleteFramebuffer(re.__webglMultisampledFramebuffer),re.__webglColorRenderbuffer)for(let G=0;G<re.__webglColorRenderbuffer.length;G++)re.__webglColorRenderbuffer[G]&&e.deleteRenderbuffer(re.__webglColorRenderbuffer[G]);re.__webglDepthRenderbuffer&&e.deleteRenderbuffer(re.__webglDepthRenderbuffer)}if(K.isWebGLMultipleRenderTargets)for(let G=0,Te=k.length;G<Te;G++){let ze=r.get(k[G]);ze.__webglTexture&&(e.deleteTexture(ze.__webglTexture),a.memory.textures--),r.remove(k[G])}r.remove(k),r.remove(K)}let Q=0;function Y(){Q=0}function O(){let K=Q;return K>=l&&console.warn("THREE.WebGLTextures: Trying to use "+K+" texture units while this GPU supports only "+l),Q+=1,K}function j(K){let k=[];return k.push(K.wrapS),k.push(K.wrapT),k.push(K.wrapR||0),k.push(K.magFilter),k.push(K.minFilter),k.push(K.anisotropy),k.push(K.internalFormat),k.push(K.format),k.push(K.type),k.push(K.generateMipmaps),k.push(K.premultiplyAlpha),k.push(K.flipY),k.push(K.unpackAlignment),k.push(K.encoding),k.join()}function V(K,k){let re=r.get(K);if(K.isVideoTexture&&se(K),K.isRenderTargetTexture===!1&&K.version>0&&re.__version!==K.version){let he=K.image;if(he===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(he.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{be(re,K,k);return}}i.bindTexture(3553,re.__webglTexture,33984+k)}function W(K,k){let re=r.get(K);if(K.version>0&&re.__version!==K.version){be(re,K,k);return}i.bindTexture(35866,re.__webglTexture,33984+k)}function J(K,k){let re=r.get(K);if(K.version>0&&re.__version!==K.version){be(re,K,k);return}i.bindTexture(32879,re.__webglTexture,33984+k)}function ce(K,k){let re=r.get(K);if(K.version>0&&re.__version!==K.version){we(re,K,k);return}i.bindTexture(34067,re.__webglTexture,33984+k)}let $={[Xu]:10497,[Ar]:33071,[IL]:33648},ne={[Qi]:9728,[q5]:9984,[bD]:9986,[pi]:9729,[loe]:9985,[Wv]:9987};function ie(K,k,re){if(re?(e.texParameteri(K,10242,$[k.wrapS]),e.texParameteri(K,10243,$[k.wrapT]),(K===32879||K===35866)&&e.texParameteri(K,32882,$[k.wrapR]),e.texParameteri(K,10240,ne[k.magFilter]),e.texParameteri(K,10241,ne[k.minFilter])):(e.texParameteri(K,10242,33071),e.texParameteri(K,10243,33071),(K===32879||K===35866)&&e.texParameteri(K,32882,33071),(k.wrapS!==Ar||k.wrapT!==Ar)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(K,10240,C(k.magFilter)),e.texParameteri(K,10241,C(k.minFilter)),k.minFilter!==Qi&&k.minFilter!==pi&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),t.has("EXT_texture_filter_anisotropic")===!0){let he=t.get("EXT_texture_filter_anisotropic");if(k.magFilter===Qi||k.minFilter!==bD&&k.minFilter!==Wv||k.type===Sn&&t.has("OES_texture_float_linear")===!1||o===!1&&k.type===ch&&t.has("OES_texture_half_float_linear")===!1)return;(k.anisotropy>1||r.get(k).__currentAnisotropy)&&(e.texParameterf(K,he.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(k.anisotropy,n.getMaxAnisotropy())),r.get(k).__currentAnisotropy=k.anisotropy)}}function de(K,k){let re=!1;K.__webglInit===void 0&&(K.__webglInit=!0,k.addEventListener("dispose",D));let he=k.source,G=g.get(he);G===void 0&&(G={},g.set(he,G));let Te=j(k);if(Te!==K.__cacheKey){G[Te]===void 0&&(G[Te]={texture:e.createTexture(),usedTimes:0},a.memory.textures++,re=!0),G[Te].usedTimes++;let ze=G[K.__cacheKey];ze!==void 0&&(G[K.__cacheKey].usedTimes--,ze.usedTimes===0&&z(k)),K.__cacheKey=Te,K.__webglTexture=G[Te].texture}return re}function be(K,k,re){let he=3553;(k.isDataArrayTexture||k.isCompressedArrayTexture)&&(he=35866),k.isData3DTexture&&(he=32879);let G=de(K,k),Te=k.source;i.bindTexture(he,K.__webglTexture,33984+re);let ze=r.get(Te);if(Te.version!==ze.__version||G===!0){i.activeTexture(33984+re),e.pixelStorei(37440,k.flipY),e.pixelStorei(37441,k.premultiplyAlpha),e.pixelStorei(3317,k.unpackAlignment),e.pixelStorei(37443,0);let Qe=M(k)&&_(k.image)===!1,ye=w(k.image,Qe,!1,u);ye=Z(k,ye);let je=_(ye)||o,nt=s.convert(k.format,k.encoding),ct=s.convert(k.type),tt=T(k.internalFormat,nt,ct,k.encoding,k.isVideoTexture);ie(he,k,je);let ue,Ue=k.mipmaps,dt=o&&k.isVideoTexture!==!0,xe=ze.__version===void 0||G===!0,ae=E(k,ye,je);if(k.isDepthTexture)tt=6402,o?k.type===Sn?tt=36012:k.type===qu?tt=33190:k.type===Sf?tt=35056:tt=33189:k.type===Sn&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),k.format===Mf&&tt===6402&&k.type!==_Y&&k.type!==qu&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),k.type=qu,ct=s.convert(k.type)),k.format===Gf&&tt===6402&&(tt=34041,k.type!==Sf&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),k.type=Sf,ct=s.convert(k.type))),xe&&(dt?i.texStorage2D(3553,1,tt,ye.width,ye.height):i.texImage2D(3553,0,tt,ye.width,ye.height,0,nt,ct,null));else if(k.isDataTexture)if(Ue.length>0&&je){dt&&xe&&i.texStorage2D(3553,ae,tt,Ue[0].width,Ue[0].height);for(let fe=0,Se=Ue.length;fe<Se;fe++)ue=Ue[fe],dt?i.texSubImage2D(3553,fe,0,0,ue.width,ue.height,nt,ct,ue.data):i.texImage2D(3553,fe,tt,ue.width,ue.height,0,nt,ct,ue.data);k.generateMipmaps=!1}else dt?(xe&&i.texStorage2D(3553,ae,tt,ye.width,ye.height),i.texSubImage2D(3553,0,0,0,ye.width,ye.height,nt,ct,ye.data)):i.texImage2D(3553,0,tt,ye.width,ye.height,0,nt,ct,ye.data);else if(k.isCompressedTexture)if(k.isCompressedArrayTexture){dt&&xe&&i.texStorage3D(35866,ae,tt,Ue[0].width,Ue[0].height,ye.depth);for(let fe=0,Se=Ue.length;fe<Se;fe++)ue=Ue[fe],k.format!==is?nt!==null?dt?i.compressedTexSubImage3D(35866,fe,0,0,0,ue.width,ue.height,ye.depth,nt,ue.data,0,0):i.compressedTexImage3D(35866,fe,tt,ue.width,ue.height,ye.depth,0,ue.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):dt?i.texSubImage3D(35866,fe,0,0,0,ue.width,ue.height,ye.depth,nt,ct,ue.data):i.texImage3D(35866,fe,tt,ue.width,ue.height,ye.depth,0,nt,ct,ue.data)}else{dt&&xe&&i.texStorage2D(3553,ae,tt,Ue[0].width,Ue[0].height);for(let fe=0,Se=Ue.length;fe<Se;fe++)ue=Ue[fe],k.format!==is?nt!==null?dt?i.compressedTexSubImage2D(3553,fe,0,0,ue.width,ue.height,nt,ue.data):i.compressedTexImage2D(3553,fe,tt,ue.width,ue.height,0,ue.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):dt?i.texSubImage2D(3553,fe,0,0,ue.width,ue.height,nt,ct,ue.data):i.texImage2D(3553,fe,tt,ue.width,ue.height,0,nt,ct,ue.data)}else if(k.isDataArrayTexture)dt?(xe&&i.texStorage3D(35866,ae,tt,ye.width,ye.height,ye.depth),i.texSubImage3D(35866,0,0,0,0,ye.width,ye.height,ye.depth,nt,ct,ye.data)):i.texImage3D(35866,0,tt,ye.width,ye.height,ye.depth,0,nt,ct,ye.data);else if(k.isData3DTexture)dt?(xe&&i.texStorage3D(32879,ae,tt,ye.width,ye.height,ye.depth),i.texSubImage3D(32879,0,0,0,0,ye.width,ye.height,ye.depth,nt,ct,ye.data)):i.texImage3D(32879,0,tt,ye.width,ye.height,ye.depth,0,nt,ct,ye.data);else if(k.isFramebufferTexture){if(xe)if(dt)i.texStorage2D(3553,ae,tt,ye.width,ye.height);else{let fe=ye.width,Se=ye.height;for(let Ne=0;Ne<ae;Ne++)i.texImage2D(3553,Ne,tt,fe,Se,0,nt,ct,null),fe>>=1,Se>>=1}}else if(Ue.length>0&&je){dt&&xe&&i.texStorage2D(3553,ae,tt,Ue[0].width,Ue[0].height);for(let fe=0,Se=Ue.length;fe<Se;fe++)ue=Ue[fe],dt?i.texSubImage2D(3553,fe,0,0,nt,ct,ue):i.texImage2D(3553,fe,tt,nt,ct,ue);k.generateMipmaps=!1}else dt?(xe&&i.texStorage2D(3553,ae,tt,ye.width,ye.height),i.texSubImage2D(3553,0,0,0,nt,ct,ye)):i.texImage2D(3553,0,tt,nt,ct,ye);S(k,je)&&A(he),ze.__version=Te.version,k.onUpdate&&k.onUpdate(k)}K.__version=k.version}function we(K,k,re){if(k.image.length!==6)return;let he=de(K,k),G=k.source;i.bindTexture(34067,K.__webglTexture,33984+re);let Te=r.get(G);if(G.version!==Te.__version||he===!0){i.activeTexture(33984+re),e.pixelStorei(37440,k.flipY),e.pixelStorei(37441,k.premultiplyAlpha),e.pixelStorei(3317,k.unpackAlignment),e.pixelStorei(37443,0);let ze=k.isCompressedTexture||k.image[0].isCompressedTexture,Qe=k.image[0]&&k.image[0].isDataTexture,ye=[];for(let fe=0;fe<6;fe++)!ze&&!Qe?ye[fe]=w(k.image[fe],!1,!0,c):ye[fe]=Qe?k.image[fe].image:k.image[fe],ye[fe]=Z(k,ye[fe]);let je=ye[0],nt=_(je)||o,ct=s.convert(k.format,k.encoding),tt=s.convert(k.type),ue=T(k.internalFormat,ct,tt,k.encoding),Ue=o&&k.isVideoTexture!==!0,dt=Te.__version===void 0||he===!0,xe=E(k,je,nt);ie(34067,k,nt);let ae;if(ze){Ue&&dt&&i.texStorage2D(34067,xe,ue,je.width,je.height);for(let fe=0;fe<6;fe++){ae=ye[fe].mipmaps;for(let Se=0;Se<ae.length;Se++){let Ne=ae[Se];k.format!==is?ct!==null?Ue?i.compressedTexSubImage2D(34069+fe,Se,0,0,Ne.width,Ne.height,ct,Ne.data):i.compressedTexImage2D(34069+fe,Se,ue,Ne.width,Ne.height,0,Ne.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Ue?i.texSubImage2D(34069+fe,Se,0,0,Ne.width,Ne.height,ct,tt,Ne.data):i.texImage2D(34069+fe,Se,ue,Ne.width,Ne.height,0,ct,tt,Ne.data)}}}else{ae=k.mipmaps,Ue&&dt&&(ae.length>0&&xe++,i.texStorage2D(34067,xe,ue,ye[0].width,ye[0].height));for(let fe=0;fe<6;fe++)if(Qe){Ue?i.texSubImage2D(34069+fe,0,0,0,ye[fe].width,ye[fe].height,ct,tt,ye[fe].data):i.texImage2D(34069+fe,0,ue,ye[fe].width,ye[fe].height,0,ct,tt,ye[fe].data);for(let Se=0;Se<ae.length;Se++){let Ne=ae[Se].image[fe].image;Ue?i.texSubImage2D(34069+fe,Se+1,0,0,Ne.width,Ne.height,ct,tt,Ne.data):i.texImage2D(34069+fe,Se+1,ue,Ne.width,Ne.height,0,ct,tt,Ne.data)}}else{Ue?i.texSubImage2D(34069+fe,0,0,0,ct,tt,ye[fe]):i.texImage2D(34069+fe,0,ue,ct,tt,ye[fe]);for(let Se=0;Se<ae.length;Se++){let Ne=ae[Se];Ue?i.texSubImage2D(34069+fe,Se+1,0,0,ct,tt,Ne.image[fe]):i.texImage2D(34069+fe,Se+1,ue,ct,tt,Ne.image[fe])}}}S(k,nt)&&A(34067),Te.__version=G.version,k.onUpdate&&k.onUpdate(k)}K.__version=k.version}function _e(K,k,re,he,G){let Te=s.convert(re.format,re.encoding),ze=s.convert(re.type),Qe=T(re.internalFormat,Te,ze,re.encoding);r.get(k).__hasExternalTextures||(G===32879||G===35866?i.texImage3D(G,0,Qe,k.width,k.height,k.depth,0,Te,ze,null):i.texImage2D(G,0,Qe,k.width,k.height,0,Te,ze,null)),i.bindFramebuffer(36160,K),Fe(k)?d.framebufferTexture2DMultisampleEXT(36160,he,G,r.get(re).__webglTexture,0,ke(k)):(G===3553||G>=34069&&G<=34074)&&e.framebufferTexture2D(36160,he,G,r.get(re).__webglTexture,0),i.bindFramebuffer(36160,null)}function Me(K,k,re){if(e.bindRenderbuffer(36161,K),k.depthBuffer&&!k.stencilBuffer){let he=33189;if(re||Fe(k)){let G=k.depthTexture;G&&G.isDepthTexture&&(G.type===Sn?he=36012:G.type===qu&&(he=33190));let Te=ke(k);Fe(k)?d.renderbufferStorageMultisampleEXT(36161,Te,he,k.width,k.height):e.renderbufferStorageMultisample(36161,Te,he,k.width,k.height)}else e.renderbufferStorage(36161,he,k.width,k.height);e.framebufferRenderbuffer(36160,36096,36161,K)}else if(k.depthBuffer&&k.stencilBuffer){let he=ke(k);re&&Fe(k)===!1?e.renderbufferStorageMultisample(36161,he,35056,k.width,k.height):Fe(k)?d.renderbufferStorageMultisampleEXT(36161,he,35056,k.width,k.height):e.renderbufferStorage(36161,34041,k.width,k.height),e.framebufferRenderbuffer(36160,33306,36161,K)}else{let he=k.isWebGLMultipleRenderTargets===!0?k.texture:[k.texture];for(let G=0;G<he.length;G++){let Te=he[G],ze=s.convert(Te.format,Te.encoding),Qe=s.convert(Te.type),ye=T(Te.internalFormat,ze,Qe,Te.encoding),je=ke(k);re&&Fe(k)===!1?e.renderbufferStorageMultisample(36161,je,ye,k.width,k.height):Fe(k)?d.renderbufferStorageMultisampleEXT(36161,je,ye,k.width,k.height):e.renderbufferStorage(36161,ye,k.width,k.height)}}e.bindRenderbuffer(36161,null)}function X(K,k){if(k&&k.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(36160,K),!(k.depthTexture&&k.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!r.get(k.depthTexture).__webglTexture||k.depthTexture.image.width!==k.width||k.depthTexture.image.height!==k.height)&&(k.depthTexture.image.width=k.width,k.depthTexture.image.height=k.height,k.depthTexture.needsUpdate=!0),V(k.depthTexture,0);let re=r.get(k.depthTexture).__webglTexture,he=ke(k);if(k.depthTexture.format===Mf)Fe(k)?d.framebufferTexture2DMultisampleEXT(36160,36096,3553,re,0,he):e.framebufferTexture2D(36160,36096,3553,re,0);else if(k.depthTexture.format===Gf)Fe(k)?d.framebufferTexture2DMultisampleEXT(36160,33306,3553,re,0,he):e.framebufferTexture2D(36160,33306,3553,re,0);else throw new Error("Unknown depthTexture format")}function ge(K){let k=r.get(K),re=K.isWebGLCubeRenderTarget===!0;if(K.depthTexture&&!k.__autoAllocateDepthBuffer){if(re)throw new Error("target.depthTexture not supported in Cube render targets");X(k.__webglFramebuffer,K)}else if(re){k.__webglDepthbuffer=[];for(let he=0;he<6;he++)i.bindFramebuffer(36160,k.__webglFramebuffer[he]),k.__webglDepthbuffer[he]=e.createRenderbuffer(),Me(k.__webglDepthbuffer[he],K,!1)}else i.bindFramebuffer(36160,k.__webglFramebuffer),k.__webglDepthbuffer=e.createRenderbuffer(),Me(k.__webglDepthbuffer,K,!1);i.bindFramebuffer(36160,null)}function Oe(K,k,re){let he=r.get(K);k!==void 0&&_e(he.__webglFramebuffer,K,K.texture,36064,3553),re!==void 0&&ge(K)}function Ie(K){let k=K.texture,re=r.get(K),he=r.get(k);K.addEventListener("dispose",I),K.isWebGLMultipleRenderTargets!==!0&&(he.__webglTexture===void 0&&(he.__webglTexture=e.createTexture()),he.__version=k.version,a.memory.textures++);let G=K.isWebGLCubeRenderTarget===!0,Te=K.isWebGLMultipleRenderTargets===!0,ze=_(K)||o;if(G){re.__webglFramebuffer=[];for(let Qe=0;Qe<6;Qe++)re.__webglFramebuffer[Qe]=e.createFramebuffer()}else{if(re.__webglFramebuffer=e.createFramebuffer(),Te)if(n.drawBuffers){let Qe=K.texture;for(let ye=0,je=Qe.length;ye<je;ye++){let nt=r.get(Qe[ye]);nt.__webglTexture===void 0&&(nt.__webglTexture=e.createTexture(),a.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(o&&K.samples>0&&Fe(K)===!1){let Qe=Te?k:[k];re.__webglMultisampledFramebuffer=e.createFramebuffer(),re.__webglColorRenderbuffer=[],i.bindFramebuffer(36160,re.__webglMultisampledFramebuffer);for(let ye=0;ye<Qe.length;ye++){let je=Qe[ye];re.__webglColorRenderbuffer[ye]=e.createRenderbuffer(),e.bindRenderbuffer(36161,re.__webglColorRenderbuffer[ye]);let nt=s.convert(je.format,je.encoding),ct=s.convert(je.type),tt=T(je.internalFormat,nt,ct,je.encoding,K.isXRRenderTarget===!0),ue=ke(K);e.renderbufferStorageMultisample(36161,ue,tt,K.width,K.height),e.framebufferRenderbuffer(36160,36064+ye,36161,re.__webglColorRenderbuffer[ye])}e.bindRenderbuffer(36161,null),K.depthBuffer&&(re.__webglDepthRenderbuffer=e.createRenderbuffer(),Me(re.__webglDepthRenderbuffer,K,!0)),i.bindFramebuffer(36160,null)}}if(G){i.bindTexture(34067,he.__webglTexture),ie(34067,k,ze);for(let Qe=0;Qe<6;Qe++)_e(re.__webglFramebuffer[Qe],K,k,36064,34069+Qe);S(k,ze)&&A(34067),i.unbindTexture()}else if(Te){let Qe=K.texture;for(let ye=0,je=Qe.length;ye<je;ye++){let nt=Qe[ye],ct=r.get(nt);i.bindTexture(3553,ct.__webglTexture),ie(3553,nt,ze),_e(re.__webglFramebuffer,K,nt,36064+ye,3553),S(nt,ze)&&A(3553)}i.unbindTexture()}else{let Qe=3553;(K.isWebGL3DRenderTarget||K.isWebGLArrayRenderTarget)&&(o?Qe=K.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),i.bindTexture(Qe,he.__webglTexture),ie(Qe,k,ze),_e(re.__webglFramebuffer,K,k,36064,Qe),S(k,ze)&&A(Qe),i.unbindTexture()}K.depthBuffer&&ge(K)}function Pe(K){let k=_(K)||o,re=K.isWebGLMultipleRenderTargets===!0?K.texture:[K.texture];for(let he=0,G=re.length;he<G;he++){let Te=re[he];if(S(Te,k)){let ze=K.isWebGLCubeRenderTarget?34067:3553,Qe=r.get(Te).__webglTexture;i.bindTexture(ze,Qe),A(ze),i.unbindTexture()}}}function Ye(K){if(o&&K.samples>0&&Fe(K)===!1){let k=K.isWebGLMultipleRenderTargets?K.texture:[K.texture],re=K.width,he=K.height,G=16384,Te=[],ze=K.stencilBuffer?33306:36096,Qe=r.get(K),ye=K.isWebGLMultipleRenderTargets===!0;if(ye)for(let je=0;je<k.length;je++)i.bindFramebuffer(36160,Qe.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+je,36161,null),i.bindFramebuffer(36160,Qe.__webglFramebuffer),e.framebufferTexture2D(36009,36064+je,3553,null,0);i.bindFramebuffer(36008,Qe.__webglMultisampledFramebuffer),i.bindFramebuffer(36009,Qe.__webglFramebuffer);for(let je=0;je<k.length;je++){Te.push(36064+je),K.depthBuffer&&Te.push(ze);let nt=Qe.__ignoreDepthValues!==void 0?Qe.__ignoreDepthValues:!1;if(nt===!1&&(K.depthBuffer&&(G|=256),K.stencilBuffer&&(G|=1024)),ye&&e.framebufferRenderbuffer(36008,36064,36161,Qe.__webglColorRenderbuffer[je]),nt===!0&&(e.invalidateFramebuffer(36008,[ze]),e.invalidateFramebuffer(36009,[ze])),ye){let ct=r.get(k[je]).__webglTexture;e.framebufferTexture2D(36009,36064,3553,ct,0)}e.blitFramebuffer(0,0,re,he,0,0,re,he,G,9728),p&&e.invalidateFramebuffer(36008,Te)}if(i.bindFramebuffer(36008,null),i.bindFramebuffer(36009,null),ye)for(let je=0;je<k.length;je++){i.bindFramebuffer(36160,Qe.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+je,36161,Qe.__webglColorRenderbuffer[je]);let nt=r.get(k[je]).__webglTexture;i.bindFramebuffer(36160,Qe.__webglFramebuffer),e.framebufferTexture2D(36009,36064+je,3553,nt,0)}i.bindFramebuffer(36009,Qe.__webglMultisampledFramebuffer)}}function ke(K){return Math.min(h,K.samples)}function Fe(K){let k=r.get(K);return o&&K.samples>0&&t.has("WEBGL_multisampled_render_to_texture")===!0&&k.__useRenderToTexture!==!1}function se(K){let k=a.render.frame;f.get(K)!==k&&(f.set(K,k),K.update())}function Z(K,k){let re=K.encoding,he=K.format,G=K.type;return K.isCompressedTexture===!0||K.isVideoTexture===!0||K.format===OL||re!==Vl&&(re===hi?o===!1?t.has("EXT_sRGB")===!0&&he===is?(K.format=OL,K.minFilter=pi,K.generateMipmaps=!1):k=DY.sRGBToLinear(k):(he!==is||G!==Js)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",re)),k}this.allocateTextureUnit=O,this.resetTextureUnits=Y,this.setTexture2D=V,this.setTexture2DArray=W,this.setTexture3D=J,this.setTextureCube=ce,this.rebindTextures=Oe,this.setupRenderTarget=Ie,this.updateRenderTargetMipmap=Pe,this.updateMultisampleRenderTarget=Ye,this.setupDepthRenderbuffer=ge,this.setupFrameBufferTexture=_e,this.useMultisampledRTT=Fe}function Dde(e,t,i){let r=i.isWebGL2;function n(s,a=null){let o;if(s===Js)return 5121;if(s===doe)return 32819;if(s===poe)return 32820;if(s===coe)return 5120;if(s===uoe)return 5122;if(s===_Y)return 5123;if(s===hoe)return 5124;if(s===qu)return 5125;if(s===Sn)return 5126;if(s===ch)return r?5131:(o=t.get("OES_texture_half_float"),o!==null?o.HALF_FLOAT_OES:null);if(s===foe)return 6406;if(s===is)return 6408;if(s===moe)return 6409;if(s===goe)return 6410;if(s===Mf)return 6402;if(s===Gf)return 34041;if(s===OL)return o=t.get("EXT_sRGB"),o!==null?o.SRGB_ALPHA_EXT:null;if(s===voe)return 6403;if(s===yoe)return 36244;if(s===fA)return 33319;if(s===xoe)return 33320;if(s===SY)return 36249;if(s===_D||s===SD||s===MD||s===ED)if(a===hi)if(o=t.get("WEBGL_compressed_texture_s3tc_srgb"),o!==null){if(s===_D)return o.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(s===SD)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(s===MD)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(s===ED)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(o=t.get("WEBGL_compressed_texture_s3tc"),o!==null){if(s===_D)return o.COMPRESSED_RGB_S3TC_DXT1_EXT;if(s===SD)return o.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(s===MD)return o.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(s===ED)return o.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(s===Y5||s===Q5||s===K5||s===Z5)if(o=t.get("WEBGL_compressed_texture_pvrtc"),o!==null){if(s===Y5)return o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(s===Q5)return o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(s===K5)return o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(s===Z5)return o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(s===woe)return o=t.get("WEBGL_compressed_texture_etc1"),o!==null?o.COMPRESSED_RGB_ETC1_WEBGL:null;if(s===$5||s===J5)if(o=t.get("WEBGL_compressed_texture_etc"),o!==null){if(s===$5)return a===hi?o.COMPRESSED_SRGB8_ETC2:o.COMPRESSED_RGB8_ETC2;if(s===J5)return a===hi?o.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:o.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(s===eV||s===tV||s===iV||s===rV||s===nV||s===sV||s===aV||s===oV||s===lV||s===cV||s===uV||s===hV||s===dV||s===pV)if(o=t.get("WEBGL_compressed_texture_astc"),o!==null){if(s===eV)return a===hi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:o.COMPRESSED_RGBA_ASTC_4x4_KHR;if(s===tV)return a===hi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:o.COMPRESSED_RGBA_ASTC_5x4_KHR;if(s===iV)return a===hi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:o.COMPRESSED_RGBA_ASTC_5x5_KHR;if(s===rV)return a===hi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:o.COMPRESSED_RGBA_ASTC_6x5_KHR;if(s===nV)return a===hi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:o.COMPRESSED_RGBA_ASTC_6x6_KHR;if(s===sV)return a===hi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:o.COMPRESSED_RGBA_ASTC_8x5_KHR;if(s===aV)return a===hi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:o.COMPRESSED_RGBA_ASTC_8x6_KHR;if(s===oV)return a===hi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:o.COMPRESSED_RGBA_ASTC_8x8_KHR;if(s===lV)return a===hi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:o.COMPRESSED_RGBA_ASTC_10x5_KHR;if(s===cV)return a===hi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:o.COMPRESSED_RGBA_ASTC_10x6_KHR;if(s===uV)return a===hi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:o.COMPRESSED_RGBA_ASTC_10x8_KHR;if(s===hV)return a===hi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:o.COMPRESSED_RGBA_ASTC_10x10_KHR;if(s===dV)return a===hi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:o.COMPRESSED_RGBA_ASTC_12x10_KHR;if(s===pV)return a===hi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:o.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(s===AD)if(o=t.get("EXT_texture_compression_bptc"),o!==null){if(s===AD)return a===hi?o.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:o.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(s===boe||s===fV||s===mV||s===gV)if(o=t.get("EXT_texture_compression_rgtc"),o!==null){if(s===AD)return o.COMPRESSED_RED_RGTC1_EXT;if(s===fV)return o.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(s===mV)return o.COMPRESSED_RED_GREEN_RGTC2_EXT;if(s===gV)return o.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return s===Sf?r?34042:(o=t.get("WEBGL_depth_texture"),o!==null?o.UNSIGNED_INT_24_8_WEBGL:null):e[s]!==void 0?e[s]:null}return{convert:n}}var Rde=class extends Gs{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}},Qu=class extends ir{constructor(){super(),this.isGroup=!0,this.type="Group"}},Ide={type:"move"},$D=class{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Qu,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Qu,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new B,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new B),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Qu,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new B,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new B),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){let t=this._hand;if(t)for(let i of e.hand.values())this._getHandJoint(t,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,i){let r=null,n=null,s=null,a=this._targetRay,o=this._grip,l=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(l&&e.hand){s=!0;for(let f of e.hand.values()){let v=t.getJointPose(f,i),g=this._getHandJoint(l,f);v!==null&&(g.matrix.fromArray(v.transform.matrix),g.matrix.decompose(g.position,g.rotation,g.scale),g.jointRadius=v.radius),g.visible=v!==null}let c=l.joints["index-finger-tip"],u=l.joints["thumb-tip"],h=c.position.distanceTo(u.position),d=.02,p=.005;l.inputState.pinching&&h>d+p?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&h<=d-p&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else o!==null&&e.gripSpace&&(n=t.getPose(e.gripSpace,i),n!==null&&(o.matrix.fromArray(n.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),n.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(n.linearVelocity)):o.hasLinearVelocity=!1,n.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(n.angularVelocity)):o.hasAngularVelocity=!1));a!==null&&(r=t.getPose(e.targetRaySpace,i),r===null&&n!==null&&(r=n),r!==null&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(Ide)))}return a!==null&&(a.visible=r!==null),o!==null&&(o.visible=n!==null),l!==null&&(l.visible=s!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){let i=new Qu;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[t.jointName]=i,e.add(i)}return e.joints[t.jointName]}},qv=class extends Br{constructor(e,t,i,r,n,s,a,o,l,c){if(c=c!==void 0?c:Mf,c!==Mf&&c!==Gf)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&c===Mf&&(i=qu),i===void 0&&c===Gf&&(i=Sf),super(null,r,n,s,a,o,c,i,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=a!==void 0?a:Qi,this.minFilter=o!==void 0?o:Qi,this.flipY=!1,this.generateMipmaps=!1}},Lde=class extends Cs{constructor(e,t){super();let i=this,r=null,n=1,s=null,a="local-floor",o=1,l=null,c=null,u=null,h=null,d=null,p=null,f=t.getContextAttributes(),v=null,g=null,m=[],x=[],w=new Set,_=new Map,M=new Gs;M.layers.enable(1),M.viewport=new ti;let S=new Gs;S.layers.enable(2),S.viewport=new ti;let A=[M,S],T=new Rde;T.layers.enable(1),T.layers.enable(2);let E=null,C=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(W){let J=m[W];return J===void 0&&(J=new $D,m[W]=J),J.getTargetRaySpace()},this.getControllerGrip=function(W){let J=m[W];return J===void 0&&(J=new $D,m[W]=J),J.getGripSpace()},this.getHand=function(W){let J=m[W];return J===void 0&&(J=new $D,m[W]=J),J.getHandSpace()};function D(W){let J=x.indexOf(W.inputSource);if(J===-1)return;let ce=m[J];ce!==void 0&&ce.dispatchEvent({type:W.type,data:W.inputSource})}function I(){r.removeEventListener("select",D),r.removeEventListener("selectstart",D),r.removeEventListener("selectend",D),r.removeEventListener("squeeze",D),r.removeEventListener("squeezestart",D),r.removeEventListener("squeezeend",D),r.removeEventListener("end",I),r.removeEventListener("inputsourceschange",L);for(let W=0;W<m.length;W++){let J=x[W];J!==null&&(x[W]=null,m[W].disconnect(J))}E=null,C=null,e.setRenderTarget(v),d=null,h=null,u=null,r=null,g=null,V.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(W){n=W,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(W){a=W,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||s},this.setReferenceSpace=function(W){l=W},this.getBaseLayer=function(){return h!==null?h:d},this.getBinding=function(){return u},this.getFrame=function(){return p},this.getSession=function(){return r},this.setSession=async function(W){if(r=W,r!==null){if(v=e.getRenderTarget(),r.addEventListener("select",D),r.addEventListener("selectstart",D),r.addEventListener("selectend",D),r.addEventListener("squeeze",D),r.addEventListener("squeezestart",D),r.addEventListener("squeezeend",D),r.addEventListener("end",I),r.addEventListener("inputsourceschange",L),f.xrCompatible!==!0&&await t.makeXRCompatible(),r.renderState.layers===void 0||e.capabilities.isWebGL2===!1){let J={antialias:r.renderState.layers===void 0?f.antialias:!0,alpha:f.alpha,depth:f.depth,stencil:f.stencil,framebufferScaleFactor:n};d=new XRWebGLLayer(r,t,J),r.updateRenderState({baseLayer:d}),g=new Wi(d.framebufferWidth,d.framebufferHeight,{format:is,type:Js,encoding:e.outputEncoding,stencilBuffer:f.stencil})}else{let J=null,ce=null,$=null;f.depth&&($=f.stencil?35056:33190,J=f.stencil?Gf:Mf,ce=f.stencil?Sf:qu);let ne={colorFormat:32856,depthFormat:$,scaleFactor:n};u=new XRWebGLBinding(r,t),h=u.createProjectionLayer(ne),r.updateRenderState({layers:[h]}),g=new Wi(h.textureWidth,h.textureHeight,{format:is,type:Js,depthTexture:new qv(h.textureWidth,h.textureHeight,ce,void 0,void 0,void 0,void 0,void 0,void 0,J),stencilBuffer:f.stencil,encoding:e.outputEncoding,samples:f.antialias?4:0});let ie=e.properties.get(g);ie.__ignoreDepthValues=h.ignoreDepthValues}g.isXRRenderTarget=!0,this.setFoveation(o),l=null,s=await r.requestReferenceSpace(a),V.setContext(r),V.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}};function L(W){for(let J=0;J<W.removed.length;J++){let ce=W.removed[J],$=x.indexOf(ce);$>=0&&(x[$]=null,m[$].disconnect(ce))}for(let J=0;J<W.added.length;J++){let ce=W.added[J],$=x.indexOf(ce);if($===-1){for(let ie=0;ie<m.length;ie++)if(ie>=x.length){x.push(ce),$=ie;break}else if(x[ie]===null){x[ie]=ce,$=ie;break}if($===-1)break}let ne=m[$];ne&&ne.connect(ce)}}let z=new B,F=new B;function Q(W,J,ce){z.setFromMatrixPosition(J.matrixWorld),F.setFromMatrixPosition(ce.matrixWorld);let $=z.distanceTo(F),ne=J.projectionMatrix.elements,ie=ce.projectionMatrix.elements,de=ne[14]/(ne[10]-1),be=ne[14]/(ne[10]+1),we=(ne[9]+1)/ne[5],_e=(ne[9]-1)/ne[5],Me=(ne[8]-1)/ne[0],X=(ie[8]+1)/ie[0],ge=de*Me,Oe=de*X,Ie=$/(-Me+X),Pe=Ie*-Me;J.matrixWorld.decompose(W.position,W.quaternion,W.scale),W.translateX(Pe),W.translateZ(Ie),W.matrixWorld.compose(W.position,W.quaternion,W.scale),W.matrixWorldInverse.copy(W.matrixWorld).invert();let Ye=de+Ie,ke=be+Ie,Fe=ge-Pe,se=Oe+($-Pe),Z=we*be/ke*Ye,K=_e*be/ke*Ye;W.projectionMatrix.makePerspective(Fe,se,Z,K,Ye,ke)}function Y(W,J){J===null?W.matrixWorld.copy(W.matrix):W.matrixWorld.multiplyMatrices(J.matrixWorld,W.matrix),W.matrixWorldInverse.copy(W.matrixWorld).invert()}this.updateCamera=function(W){if(r===null)return;T.near=S.near=M.near=W.near,T.far=S.far=M.far=W.far,(E!==T.near||C!==T.far)&&(r.updateRenderState({depthNear:T.near,depthFar:T.far}),E=T.near,C=T.far);let J=W.parent,ce=T.cameras;Y(T,J);for(let ne=0;ne<ce.length;ne++)Y(ce[ne],J);T.matrixWorld.decompose(T.position,T.quaternion,T.scale),W.matrix.copy(T.matrix),W.matrix.decompose(W.position,W.quaternion,W.scale);let $=W.children;for(let ne=0,ie=$.length;ne<ie;ne++)$[ne].updateMatrixWorld(!0);ce.length===2?Q(T,M,S):T.projectionMatrix.copy(M.projectionMatrix)},this.getCamera=function(){return T},this.getFoveation=function(){if(!(h===null&&d===null))return o},this.setFoveation=function(W){o=W,h!==null&&(h.fixedFoveation=W),d!==null&&d.fixedFoveation!==void 0&&(d.fixedFoveation=W)},this.getPlanes=function(){return w};let O=null;function j(W,J){if(c=J.getViewerPose(l||s),p=J,c!==null){let ce=c.views;d!==null&&(e.setRenderTargetFramebuffer(g,d.framebuffer),e.setRenderTarget(g));let $=!1;ce.length!==T.cameras.length&&(T.cameras.length=0,$=!0);for(let ne=0;ne<ce.length;ne++){let ie=ce[ne],de=null;if(d!==null)de=d.getViewport(ie);else{let we=u.getViewSubImage(h,ie);de=we.viewport,ne===0&&(e.setRenderTargetTextures(g,we.colorTexture,h.ignoreDepthValues?void 0:we.depthStencilTexture),e.setRenderTarget(g))}let be=A[ne];be===void 0&&(be=new Gs,be.layers.enable(ne),be.viewport=new ti,A[ne]=be),be.matrix.fromArray(ie.transform.matrix),be.projectionMatrix.fromArray(ie.projectionMatrix),be.viewport.set(de.x,de.y,de.width,de.height),ne===0&&T.matrix.copy(be.matrix),$===!0&&T.cameras.push(be)}}for(let ce=0;ce<m.length;ce++){let $=x[ce],ne=m[ce];$!==null&&ne!==void 0&&ne.update($,J,l||s)}if(O&&O(W,J),J.detectedPlanes){i.dispatchEvent({type:"planesdetected",data:J.detectedPlanes});let ce=null;for(let $ of w)J.detectedPlanes.has($)||(ce===null&&(ce=[]),ce.push($));if(ce!==null)for(let $ of ce)w.delete($),_.delete($),i.dispatchEvent({type:"planeremoved",data:$});for(let $ of J.detectedPlanes)if(!w.has($))w.add($),_.set($,J.lastChangedTime),i.dispatchEvent({type:"planeadded",data:$});else{let ne=_.get($);$.lastChangedTime>ne&&(_.set($,$.lastChangedTime),i.dispatchEvent({type:"planechanged",data:$}))}}p=null}let V=new zY;V.setAnimationLoop(j),this.setAnimationLoop=function(W){O=W},this.dispose=function(){}}};function Ode(e,t){function i(v,g){g.color.getRGB(v.fogColor.value,OY(e)),g.isFog?(v.fogNear.value=g.near,v.fogFar.value=g.far):g.isFogExp2&&(v.fogDensity.value=g.density)}function r(v,g,m,x,w){g.isMeshBasicMaterial||g.isMeshLambertMaterial?n(v,g):g.isMeshToonMaterial?(n(v,g),u(v,g)):g.isMeshPhongMaterial?(n(v,g),c(v,g)):g.isMeshStandardMaterial?(n(v,g),h(v,g),g.isMeshPhysicalMaterial&&d(v,g,w)):g.isMeshMatcapMaterial?(n(v,g),p(v,g)):g.isMeshDepthMaterial?n(v,g):g.isMeshDistanceMaterial?(n(v,g),f(v,g)):g.isMeshNormalMaterial?n(v,g):g.isLineBasicMaterial?(s(v,g),g.isLineDashedMaterial&&a(v,g)):g.isPointsMaterial?o(v,g,m,x):g.isSpriteMaterial?l(v,g):g.isShadowMaterial?(v.color.value.copy(g.color),v.opacity.value=g.opacity):g.isShaderMaterial&&(g.uniformsNeedUpdate=!1)}function n(v,g){v.opacity.value=g.opacity,g.color&&v.diffuse.value.copy(g.color),g.emissive&&v.emissive.value.copy(g.emissive).multiplyScalar(g.emissiveIntensity),g.map&&(v.map.value=g.map),g.alphaMap&&(v.alphaMap.value=g.alphaMap),g.bumpMap&&(v.bumpMap.value=g.bumpMap,v.bumpScale.value=g.bumpScale,g.side===ns&&(v.bumpScale.value*=-1)),g.displacementMap&&(v.displacementMap.value=g.displacementMap,v.displacementScale.value=g.displacementScale,v.displacementBias.value=g.displacementBias),g.emissiveMap&&(v.emissiveMap.value=g.emissiveMap),g.normalMap&&(v.normalMap.value=g.normalMap,v.normalScale.value.copy(g.normalScale),g.side===ns&&v.normalScale.value.negate()),g.specularMap&&(v.specularMap.value=g.specularMap),g.alphaTest>0&&(v.alphaTest.value=g.alphaTest);let m=t.get(g).envMap;if(m&&(v.envMap.value=m,v.flipEnvMap.value=m.isCubeTexture&&m.isRenderTargetTexture===!1?-1:1,v.reflectivity.value=g.reflectivity,v.ior.value=g.ior,v.refractionRatio.value=g.refractionRatio),g.lightMap){v.lightMap.value=g.lightMap;let _=e.physicallyCorrectLights!==!0?Math.PI:1;v.lightMapIntensity.value=g.lightMapIntensity*_}g.aoMap&&(v.aoMap.value=g.aoMap,v.aoMapIntensity.value=g.aoMapIntensity);let x;g.map?x=g.map:g.specularMap?x=g.specularMap:g.displacementMap?x=g.displacementMap:g.normalMap?x=g.normalMap:g.bumpMap?x=g.bumpMap:g.roughnessMap?x=g.roughnessMap:g.metalnessMap?x=g.metalnessMap:g.alphaMap?x=g.alphaMap:g.emissiveMap?x=g.emissiveMap:g.clearcoatMap?x=g.clearcoatMap:g.clearcoatNormalMap?x=g.clearcoatNormalMap:g.clearcoatRoughnessMap?x=g.clearcoatRoughnessMap:g.iridescenceMap?x=g.iridescenceMap:g.iridescenceThicknessMap?x=g.iridescenceThicknessMap:g.specularIntensityMap?x=g.specularIntensityMap:g.specularColorMap?x=g.specularColorMap:g.transmissionMap?x=g.transmissionMap:g.thicknessMap?x=g.thicknessMap:g.sheenColorMap?x=g.sheenColorMap:g.sheenRoughnessMap&&(x=g.sheenRoughnessMap),x!==void 0&&(x.isWebGLRenderTarget&&(x=x.texture),x.matrixAutoUpdate===!0&&x.updateMatrix(),v.uvTransform.value.copy(x.matrix));let w;g.aoMap?w=g.aoMap:g.lightMap&&(w=g.lightMap),w!==void 0&&(w.isWebGLRenderTarget&&(w=w.texture),w.matrixAutoUpdate===!0&&w.updateMatrix(),v.uv2Transform.value.copy(w.matrix))}function s(v,g){v.diffuse.value.copy(g.color),v.opacity.value=g.opacity}function a(v,g){v.dashSize.value=g.dashSize,v.totalSize.value=g.dashSize+g.gapSize,v.scale.value=g.scale}function o(v,g,m,x){v.diffuse.value.copy(g.color),v.opacity.value=g.opacity,v.size.value=g.size*m,v.scale.value=x*.5,g.map&&(v.map.value=g.map),g.alphaMap&&(v.alphaMap.value=g.alphaMap),g.alphaTest>0&&(v.alphaTest.value=g.alphaTest);let w;g.map?w=g.map:g.alphaMap&&(w=g.alphaMap),w!==void 0&&(w.matrixAutoUpdate===!0&&w.updateMatrix(),v.uvTransform.value.copy(w.matrix))}function l(v,g){v.diffuse.value.copy(g.color),v.opacity.value=g.opacity,v.rotation.value=g.rotation,g.map&&(v.map.value=g.map),g.alphaMap&&(v.alphaMap.value=g.alphaMap),g.alphaTest>0&&(v.alphaTest.value=g.alphaTest);let m;g.map?m=g.map:g.alphaMap&&(m=g.alphaMap),m!==void 0&&(m.matrixAutoUpdate===!0&&m.updateMatrix(),v.uvTransform.value.copy(m.matrix))}function c(v,g){v.specular.value.copy(g.specular),v.shininess.value=Math.max(g.shininess,1e-4)}function u(v,g){g.gradientMap&&(v.gradientMap.value=g.gradientMap)}function h(v,g){v.roughness.value=g.roughness,v.metalness.value=g.metalness,g.roughnessMap&&(v.roughnessMap.value=g.roughnessMap),g.metalnessMap&&(v.metalnessMap.value=g.metalnessMap),t.get(g).envMap&&(v.envMapIntensity.value=g.envMapIntensity)}function d(v,g,m){v.ior.value=g.ior,g.sheen>0&&(v.sheenColor.value.copy(g.sheenColor).multiplyScalar(g.sheen),v.sheenRoughness.value=g.sheenRoughness,g.sheenColorMap&&(v.sheenColorMap.value=g.sheenColorMap),g.sheenRoughnessMap&&(v.sheenRoughnessMap.value=g.sheenRoughnessMap)),g.clearcoat>0&&(v.clearcoat.value=g.clearcoat,v.clearcoatRoughness.value=g.clearcoatRoughness,g.clearcoatMap&&(v.clearcoatMap.value=g.clearcoatMap),g.clearcoatRoughnessMap&&(v.clearcoatRoughnessMap.value=g.clearcoatRoughnessMap),g.clearcoatNormalMap&&(v.clearcoatNormalScale.value.copy(g.clearcoatNormalScale),v.clearcoatNormalMap.value=g.clearcoatNormalMap,g.side===ns&&v.clearcoatNormalScale.value.negate())),g.iridescence>0&&(v.iridescence.value=g.iridescence,v.iridescenceIOR.value=g.iridescenceIOR,v.iridescenceThicknessMinimum.value=g.iridescenceThicknessRange[0],v.iridescenceThicknessMaximum.value=g.iridescenceThicknessRange[1],g.iridescenceMap&&(v.iridescenceMap.value=g.iridescenceMap),g.iridescenceThicknessMap&&(v.iridescenceThicknessMap.value=g.iridescenceThicknessMap)),g.transmission>0&&(v.transmission.value=g.transmission,v.transmissionSamplerMap.value=m.texture,v.transmissionSamplerSize.value.set(m.width,m.height),g.transmissionMap&&(v.transmissionMap.value=g.transmissionMap),v.thickness.value=g.thickness,g.thicknessMap&&(v.thicknessMap.value=g.thicknessMap),v.attenuationDistance.value=g.attenuationDistance,v.attenuationColor.value.copy(g.attenuationColor)),v.specularIntensity.value=g.specularIntensity,v.specularColor.value.copy(g.specularColor),g.specularIntensityMap&&(v.specularIntensityMap.value=g.specularIntensityMap),g.specularColorMap&&(v.specularColorMap.value=g.specularColorMap)}function p(v,g){g.matcap&&(v.matcap.value=g.matcap)}function f(v,g){v.referencePosition.value.copy(g.referencePosition),v.nearDistance.value=g.nearDistance,v.farDistance.value=g.farDistance}return{refreshFogUniforms:i,refreshMaterialUniforms:r}}function zde(e,t,i,r){let n={},s={},a=[],o=i.isWebGL2?e.getParameter(35375):0;function l(x,w){let _=w.program;r.uniformBlockBinding(x,_)}function c(x,w){let _=n[x.id];_===void 0&&(f(x),_=u(x),n[x.id]=_,x.addEventListener("dispose",g));let M=w.program;r.updateUBOMapping(x,M);let S=t.render.frame;s[x.id]!==S&&(d(x),s[x.id]=S)}function u(x){let w=h();x.__bindingPointIndex=w;let _=e.createBuffer(),M=x.__size,S=x.usage;return e.bindBuffer(35345,_),e.bufferData(35345,M,S),e.bindBuffer(35345,null),e.bindBufferBase(35345,w,_),_}function h(){for(let x=0;x<o;x++)if(a.indexOf(x)===-1)return a.push(x),x;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function d(x){let w=n[x.id],_=x.uniforms,M=x.__cache;e.bindBuffer(35345,w);for(let S=0,A=_.length;S<A;S++){let T=_[S];if(p(T,S,M)===!0){let E=T.__offset,C=Array.isArray(T.value)?T.value:[T.value],D=0;for(let I=0;I<C.length;I++){let L=C[I],z=v(L);typeof L=="number"?(T.__data[0]=L,e.bufferSubData(35345,E+D,T.__data)):L.isMatrix3?(T.__data[0]=L.elements[0],T.__data[1]=L.elements[1],T.__data[2]=L.elements[2],T.__data[3]=L.elements[0],T.__data[4]=L.elements[3],T.__data[5]=L.elements[4],T.__data[6]=L.elements[5],T.__data[7]=L.elements[0],T.__data[8]=L.elements[6],T.__data[9]=L.elements[7],T.__data[10]=L.elements[8],T.__data[11]=L.elements[0]):(L.toArray(T.__data,D),D+=z.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(35345,E,T.__data)}}e.bindBuffer(35345,null)}function p(x,w,_){let M=x.value;if(_[w]===void 0){if(typeof M=="number")_[w]=M;else{let S=Array.isArray(M)?M:[M],A=[];for(let T=0;T<S.length;T++)A.push(S[T].clone());_[w]=A}return!0}else if(typeof M=="number"){if(_[w]!==M)return _[w]=M,!0}else{let S=Array.isArray(_[w])?_[w]:[_[w]],A=Array.isArray(M)?M:[M];for(let T=0;T<S.length;T++){let E=S[T];if(E.equals(A[T])===!1)return E.copy(A[T]),!0}}return!1}function f(x){let w=x.uniforms,_=0,M=16,S=0;for(let A=0,T=w.length;A<T;A++){let E=w[A],C={boundary:0,storage:0},D=Array.isArray(E.value)?E.value:[E.value];for(let I=0,L=D.length;I<L;I++){let z=D[I],F=v(z);C.boundary+=F.boundary,C.storage+=F.storage}if(E.__data=new Float32Array(C.storage/Float32Array.BYTES_PER_ELEMENT),E.__offset=_,A>0){S=_%M;let I=M-S;S!==0&&I-C.boundary<0&&(_+=M-S,E.__offset=_)}_+=C.storage}return S=_%M,S>0&&(_+=M-S),x.__size=_,x.__cache={},this}function v(x){let w={boundary:0,storage:0};return typeof x=="number"?(w.boundary=4,w.storage=4):x.isVector2?(w.boundary=8,w.storage=8):x.isVector3||x.isColor?(w.boundary=16,w.storage=12):x.isVector4?(w.boundary=16,w.storage=16):x.isMatrix3?(w.boundary=48,w.storage=48):x.isMatrix4?(w.boundary=64,w.storage=64):x.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",x),w}function g(x){let w=x.target;w.removeEventListener("dispose",g);let _=a.indexOf(w.__bindingPointIndex);a.splice(_,1),e.deleteBuffer(n[w.id]),delete n[w.id],delete s[w.id]}function m(){for(let x in n)e.deleteBuffer(n[x]);a=[],n={},s={}}return{bind:l,update:c,dispose:m}}function Nde(){let e=I1("canvas");return e.style.display="block",e}function VY(e={}){this.isWebGLRenderer=!0;let t=e.canvas!==void 0?e.canvas:Nde(),i=e.context!==void 0?e.context:null,r=e.depth!==void 0?e.depth:!0,n=e.stencil!==void 0?e.stencil:!0,s=e.antialias!==void 0?e.antialias:!1,a=e.premultipliedAlpha!==void 0?e.premultipliedAlpha:!0,o=e.preserveDrawingBuffer!==void 0?e.preserveDrawingBuffer:!1,l=e.powerPreference!==void 0?e.powerPreference:"default",c=e.failIfMajorPerformanceCaveat!==void 0?e.failIfMajorPerformanceCaveat:!1,u;i!==null?u=i.getContextAttributes().alpha:u=e.alpha!==void 0?e.alpha:!1;let h=null,d=null,p=[],f=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=Vl,this.physicallyCorrectLights=!1,this.toneMapping=kc,this.toneMappingExposure=1;let v=this,g=!1,m=0,x=0,w=null,_=-1,M=null,S=new ti,A=new ti,T=null,E=t.width,C=t.height,D=1,I=null,L=null,z=new ti(0,0,E,C),F=new ti(0,0,E,C),Q=!1,Y=new fB,O=!1,j=!1,V=null,W=new ht,J=new ve,ce=new B,$={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function ne(){return w===null?D:1}let ie=i;function de(le,Ge){for(let $e=0;$e<le.length;$e++){let Ve=le[$e],et=t.getContext(Ve,Ge);if(et!==null)return et}return null}try{let le={alpha:!0,depth:r,stencil:n,antialias:s,premultipliedAlpha:a,preserveDrawingBuffer:o,powerPreference:l,failIfMajorPerformanceCaveat:c};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${b0}`),t.addEventListener("webglcontextlost",tt,!1),t.addEventListener("webglcontextrestored",ue,!1),t.addEventListener("webglcontextcreationerror",Ue,!1),ie===null){let Ge=["webgl2","webgl","experimental-webgl"];if(v.isWebGL1Renderer===!0&&Ge.shift(),ie=de(Ge,le),ie===null)throw de(Ge)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}ie.getShaderPrecisionFormat===void 0&&(ie.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(le){throw console.error("THREE.WebGLRenderer: "+le.message),le}let be,we,_e,Me,X,ge,Oe,Ie,Pe,Ye,ke,Fe,se,Z,K,k,re,he,G,Te,ze,Qe,ye,je;function nt(){be=new Que(ie),we=new Gue(ie,be,e),be.init(we),Qe=new Dde(ie,be,we),_e=new Tde(ie,be,we),Me=new $ue,X=new mde,ge=new Pde(ie,be,_e,X,we,Qe,Me),Oe=new Wue(v),Ie=new Yue(v),Pe=new ole(ie,we),ye=new Vue(ie,be,Pe,we),Ye=new Kue(ie,Pe,Me,ye),ke=new ihe(ie,Ye,Pe,Me),G=new the(ie,we,ge),k=new jue(X),Fe=new fde(v,Oe,Ie,be,we,ye,k),se=new Ode(v,X),Z=new vde,K=new Sde(be,we),he=new Fue(v,Oe,Ie,_e,ke,u,a),re=new Cde(v,ke,we),je=new zde(ie,Me,we,_e),Te=new Hue(ie,be,Me,we),ze=new Zue(ie,be,Me,we),Me.programs=Fe.programs,v.capabilities=we,v.extensions=be,v.properties=X,v.renderLists=Z,v.shadowMap=re,v.state=_e,v.info=Me}nt();let ct=new Lde(v,ie);this.xr=ct,this.getContext=function(){return ie},this.getContextAttributes=function(){return ie.getContextAttributes()},this.forceContextLoss=function(){let le=be.get("WEBGL_lose_context");le&&le.loseContext()},this.forceContextRestore=function(){let le=be.get("WEBGL_lose_context");le&&le.restoreContext()},this.getPixelRatio=function(){return D},this.setPixelRatio=function(le){le!==void 0&&(D=le,this.setSize(E,C,!1))},this.getSize=function(le){return le.set(E,C)},this.setSize=function(le,Ge,$e){if(ct.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}E=le,C=Ge,t.width=Math.floor(le*D),t.height=Math.floor(Ge*D),$e!==!1&&(t.style.width=le+"px",t.style.height=Ge+"px"),this.setViewport(0,0,le,Ge)},this.getDrawingBufferSize=function(le){return le.set(E*D,C*D).floor()},this.setDrawingBufferSize=function(le,Ge,$e){E=le,C=Ge,D=$e,t.width=Math.floor(le*$e),t.height=Math.floor(Ge*$e),this.setViewport(0,0,le,Ge)},this.getCurrentViewport=function(le){return le.copy(S)},this.getViewport=function(le){return le.copy(z)},this.setViewport=function(le,Ge,$e,Ve){le.isVector4?z.set(le.x,le.y,le.z,le.w):z.set(le,Ge,$e,Ve),_e.viewport(S.copy(z).multiplyScalar(D).floor())},this.getScissor=function(le){return le.copy(F)},this.setScissor=function(le,Ge,$e,Ve){le.isVector4?F.set(le.x,le.y,le.z,le.w):F.set(le,Ge,$e,Ve),_e.scissor(A.copy(F).multiplyScalar(D).floor())},this.getScissorTest=function(){return Q},this.setScissorTest=function(le){_e.setScissorTest(Q=le)},this.setOpaqueSort=function(le){I=le},this.setTransparentSort=function(le){L=le},this.getClearColor=function(le){return le.copy(he.getClearColor())},this.setClearColor=function(){he.setClearColor.apply(he,arguments)},this.getClearAlpha=function(){return he.getClearAlpha()},this.setClearAlpha=function(){he.setClearAlpha.apply(he,arguments)},this.clear=function(le=!0,Ge=!0,$e=!0){let Ve=0;le&&(Ve|=16384),Ge&&(Ve|=256),$e&&(Ve|=1024),ie.clear(Ve)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",tt,!1),t.removeEventListener("webglcontextrestored",ue,!1),t.removeEventListener("webglcontextcreationerror",Ue,!1),Z.dispose(),K.dispose(),X.dispose(),Oe.dispose(),Ie.dispose(),ke.dispose(),ye.dispose(),je.dispose(),Fe.dispose(),ct.dispose(),ct.removeEventListener("sessionstart",Ne),ct.removeEventListener("sessionend",st),V&&(V.dispose(),V=null),vt.stop()};function tt(le){le.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),g=!0}function ue(){console.log("THREE.WebGLRenderer: Context Restored."),g=!1;let le=Me.autoReset,Ge=re.enabled,$e=re.autoUpdate,Ve=re.needsUpdate,et=re.type;nt(),Me.autoReset=le,re.enabled=Ge,re.autoUpdate=$e,re.needsUpdate=Ve,re.type=et}function Ue(le){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",le.statusMessage)}function dt(le){let Ge=le.target;Ge.removeEventListener("dispose",dt),xe(Ge)}function xe(le){ae(le),X.remove(le)}function ae(le){let Ge=X.get(le).programs;Ge!==void 0&&(Ge.forEach(function($e){Fe.releaseProgram($e)}),le.isShaderMaterial&&Fe.releaseShaderCache(le))}this.renderBufferDirect=function(le,Ge,$e,Ve,et,Ot){Ge===null&&(Ge=$);let ri=et.isMesh&&et.matrixWorld.determinant()<0,oi=eu(le,Ge,$e,Ve,et);_e.setMaterial(Ve,ri);let ee=$e.index,Ce=1;Ve.wireframe===!0&&(ee=Ye.getWireframeAttribute($e),Ce=2);let De=$e.drawRange,Le=$e.attributes.position,Ee=De.start*Ce,pt=(De.start+De.count)*Ce;Ot!==null&&(Ee=Math.max(Ee,Ot.start*Ce),pt=Math.min(pt,(Ot.start+Ot.count)*Ce)),ee!==null?(Ee=Math.max(Ee,0),pt=Math.min(pt,ee.count)):Le!=null&&(Ee=Math.max(Ee,0),pt=Math.min(pt,Le.count));let bt=pt-Ee;if(bt<0||bt===1/0)return;ye.setup(et,Ve,oi,$e,ee);let Ct,yt=Te;if(ee!==null&&(Ct=Pe.get(ee),yt=ze,yt.setIndex(Ct)),et.isMesh)Ve.wireframe===!0?(_e.setLineWidth(Ve.wireframeLinewidth*ne()),yt.setMode(1)):yt.setMode(4);else if(et.isLine){let gt=Ve.linewidth;gt===void 0&&(gt=1),_e.setLineWidth(gt*ne()),et.isLineSegments?yt.setMode(1):et.isLineLoop?yt.setMode(2):yt.setMode(3)}else et.isPoints?yt.setMode(0):et.isSprite&&yt.setMode(4);if(et.isInstancedMesh)yt.renderInstances(Ee,bt,et.count);else if($e.isInstancedBufferGeometry){let gt=$e._maxInstanceCount!==void 0?$e._maxInstanceCount:1/0,zt=Math.min($e.instanceCount,gt);yt.renderInstances(Ee,bt,zt)}else yt.render(Ee,bt)},this.compile=function(le,Ge){function $e(Ve,et,Ot){Ve.transparent===!0&&Ve.side===Ws&&Ve.forceSinglePass===!1?(Ve.side=ns,Ve.needsUpdate=!0,Tn(Ve,et,Ot),Ve.side=Fl,Ve.needsUpdate=!0,Tn(Ve,et,Ot),Ve.side=Ws):Tn(Ve,et,Ot)}d=K.get(le),d.init(),f.push(d),le.traverseVisible(function(Ve){Ve.isLight&&Ve.layers.test(Ge.layers)&&(d.pushLight(Ve),Ve.castShadow&&d.pushShadow(Ve))}),d.setupLights(v.physicallyCorrectLights),le.traverse(function(Ve){let et=Ve.material;if(et)if(Array.isArray(et))for(let Ot=0;Ot<et.length;Ot++){let ri=et[Ot];$e(ri,le,Ve)}else $e(et,le,Ve)}),f.pop(),d=null};let fe=null;function Se(le){fe&&fe(le)}function Ne(){vt.stop()}function st(){vt.start()}let vt=new zY;vt.setAnimationLoop(Se),typeof self<"u"&&vt.setContext(self),this.setAnimationLoop=function(le){fe=le,ct.setAnimationLoop(le),le===null?vt.stop():vt.start()},ct.addEventListener("sessionstart",Ne),ct.addEventListener("sessionend",st),this.render=function(le,Ge){if(Ge!==void 0&&Ge.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(g===!0)return;le.matrixWorldAutoUpdate===!0&&le.updateMatrixWorld(),Ge.parent===null&&Ge.matrixWorldAutoUpdate===!0&&Ge.updateMatrixWorld(),ct.enabled===!0&&ct.isPresenting===!0&&(ct.cameraAutoUpdate===!0&&ct.updateCamera(Ge),Ge=ct.getCamera()),le.isScene===!0&&le.onBeforeRender(v,le,Ge,w),d=K.get(le,f.length),d.init(),f.push(d),W.multiplyMatrices(Ge.projectionMatrix,Ge.matrixWorldInverse),Y.setFromProjectionMatrix(W),j=this.localClippingEnabled,O=k.init(this.clippingPlanes,j),h=Z.get(le,p.length),h.init(),p.push(h),Ut(le,Ge,0,v.sortObjects),h.finish(),v.sortObjects===!0&&h.sort(I,L),O===!0&&k.beginShadows();let $e=d.state.shadowsArray;if(re.render($e,le,Ge),O===!0&&k.endShadows(),this.info.autoReset===!0&&this.info.reset(),he.render(h,le),d.setupLights(v.physicallyCorrectLights),Ge.isArrayCamera){let Ve=Ge.cameras;for(let et=0,Ot=Ve.length;et<Ot;et++){let ri=Ve[et];Wt(h,le,ri,ri.viewport)}}else Wt(h,le,Ge);w!==null&&(ge.updateMultisampleRenderTarget(w),ge.updateRenderTargetMipmap(w)),le.isScene===!0&&le.onAfterRender(v,le,Ge),ye.resetDefaultState(),_=-1,M=null,f.pop(),f.length>0?d=f[f.length-1]:d=null,p.pop(),p.length>0?h=p[p.length-1]:h=null};function Ut(le,Ge,$e,Ve){if(le.visible===!1)return;if(le.layers.test(Ge.layers)){if(le.isGroup)$e=le.renderOrder;else if(le.isLOD)le.autoUpdate===!0&&le.update(Ge);else if(le.isLight)d.pushLight(le),le.castShadow&&d.pushShadow(le);else if(le.isSprite){if(!le.frustumCulled||Y.intersectsSprite(le)){Ve&&ce.setFromMatrixPosition(le.matrixWorld).applyMatrix4(W);let Ot=ke.update(le),ri=le.material;ri.visible&&h.push(le,Ot,ri,$e,ce.z,null)}}else if((le.isMesh||le.isLine||le.isPoints)&&(le.isSkinnedMesh&&le.skeleton.frame!==Me.render.frame&&(le.skeleton.update(),le.skeleton.frame=Me.render.frame),!le.frustumCulled||Y.intersectsObject(le))){Ve&&ce.setFromMatrixPosition(le.matrixWorld).applyMatrix4(W);let Ot=ke.update(le),ri=le.material;if(Array.isArray(ri)){let oi=Ot.groups;for(let ee=0,Ce=oi.length;ee<Ce;ee++){let De=oi[ee],Le=ri[De.materialIndex];Le&&Le.visible&&h.push(le,Ot,Le,$e,ce.z,De)}}else ri.visible&&h.push(le,Ot,ri,$e,ce.z,null)}}let et=le.children;for(let Ot=0,ri=et.length;Ot<ri;Ot++)Ut(et[Ot],Ge,$e,Ve)}function Wt(le,Ge,$e,Ve){let et=le.opaque,Ot=le.transmissive,ri=le.transparent;d.setupLightsView($e),O===!0&&k.setGlobalState(v.clippingPlanes,$e),Ot.length>0&&Jt(et,Ge,$e),Ve&&_e.viewport(S.copy(Ve)),et.length>0&&ci(et,Ge,$e),Ot.length>0&&ci(Ot,Ge,$e),ri.length>0&&ci(ri,Ge,$e),_e.buffers.depth.setTest(!0),_e.buffers.depth.setMask(!0),_e.buffers.color.setMask(!0),_e.setPolygonOffset(!1)}function Jt(le,Ge,$e){let Ve=we.isWebGL2;V===null&&(V=new Wi(1,1,{generateMipmaps:!0,type:be.has("EXT_color_buffer_half_float")?ch:Js,minFilter:Wv,samples:Ve&&s===!0?4:0})),v.getDrawingBufferSize(J),Ve?V.setSize(J.x,J.y):V.setSize(xA(J.x),xA(J.y));let et=v.getRenderTarget();v.setRenderTarget(V),v.clear();let Ot=v.toneMapping;v.toneMapping=kc,ci(le,Ge,$e),v.toneMapping=Ot,ge.updateMultisampleRenderTarget(V),ge.updateRenderTargetMipmap(V),v.setRenderTarget(et)}function ci(le,Ge,$e){let Ve=Ge.isScene===!0?Ge.overrideMaterial:null;for(let et=0,Ot=le.length;et<Ot;et++){let ri=le[et],oi=ri.object,ee=ri.geometry,Ce=Ve===null?ri.material:Ve,De=ri.group;oi.layers.test($e.layers)&&Ki(oi,Ge,$e,ee,Ce,De)}}function Ki(le,Ge,$e,Ve,et,Ot){le.onBeforeRender(v,Ge,$e,Ve,et,Ot),le.modelViewMatrix.multiplyMatrices($e.matrixWorldInverse,le.matrixWorld),le.normalMatrix.getNormalMatrix(le.modelViewMatrix),et.onBeforeRender(v,Ge,$e,Ve,le,Ot),et.transparent===!0&&et.side===Ws&&et.forceSinglePass===!1?(et.side=ns,et.needsUpdate=!0,v.renderBufferDirect($e,Ge,Ve,et,le,Ot),et.side=Fl,et.needsUpdate=!0,v.renderBufferDirect($e,Ge,Ve,et,le,Ot),et.side=Ws):v.renderBufferDirect($e,Ge,Ve,et,le,Ot),le.onAfterRender(v,Ge,$e,Ve,et,Ot)}function Tn(le,Ge,$e){Ge.isScene!==!0&&(Ge=$);let Ve=X.get(le),et=d.state.lights,Ot=d.state.shadowsArray,ri=et.state.version,oi=Fe.getParameters(le,et.state,Ot,Ge,$e),ee=Fe.getProgramCacheKey(oi),Ce=Ve.programs;Ve.environment=le.isMeshStandardMaterial?Ge.environment:null,Ve.fog=Ge.fog,Ve.envMap=(le.isMeshStandardMaterial?Ie:Oe).get(le.envMap||Ve.environment),Ce===void 0&&(le.addEventListener("dispose",dt),Ce=new Map,Ve.programs=Ce);let De=Ce.get(ee);if(De!==void 0){if(Ve.currentProgram===De&&Ve.lightsStateVersion===ri)return Ps(le,oi),De}else oi.uniforms=Fe.getUniforms(le),le.onBuild($e,oi,v),le.onBeforeCompile(oi,v),De=Fe.acquireProgram(oi,ee),Ce.set(ee,De),Ve.uniforms=oi.uniforms;let Le=Ve.uniforms;(!le.isShaderMaterial&&!le.isRawShaderMaterial||le.clipping===!0)&&(Le.clippingPlanes=k.uniform),Ps(le,oi),Ve.needsLights=bo(le),Ve.lightsStateVersion=ri,Ve.needsLights&&(Le.ambientLightColor.value=et.state.ambient,Le.lightProbe.value=et.state.probe,Le.directionalLights.value=et.state.directional,Le.directionalLightShadows.value=et.state.directionalShadow,Le.spotLights.value=et.state.spot,Le.spotLightShadows.value=et.state.spotShadow,Le.rectAreaLights.value=et.state.rectArea,Le.ltc_1.value=et.state.rectAreaLTC1,Le.ltc_2.value=et.state.rectAreaLTC2,Le.pointLights.value=et.state.point,Le.pointLightShadows.value=et.state.pointShadow,Le.hemisphereLights.value=et.state.hemi,Le.directionalShadowMap.value=et.state.directionalShadowMap,Le.directionalShadowMatrix.value=et.state.directionalShadowMatrix,Le.spotShadowMap.value=et.state.spotShadowMap,Le.spotLightMatrix.value=et.state.spotLightMatrix,Le.spotLightMap.value=et.state.spotLightMap,Le.pointShadowMap.value=et.state.pointShadowMap,Le.pointShadowMatrix.value=et.state.pointShadowMatrix);let Ee=De.getUniforms(),pt=dE.seqWithValue(Ee.seq,Le);return Ve.currentProgram=De,Ve.uniformsList=pt,De}function Ps(le,Ge){let $e=X.get(le);$e.outputEncoding=Ge.outputEncoding,$e.instancing=Ge.instancing,$e.skinning=Ge.skinning,$e.morphTargets=Ge.morphTargets,$e.morphNormals=Ge.morphNormals,$e.morphColors=Ge.morphColors,$e.morphTargetsCount=Ge.morphTargetsCount,$e.numClippingPlanes=Ge.numClippingPlanes,$e.numIntersection=Ge.numClipIntersection,$e.vertexAlphas=Ge.vertexAlphas,$e.vertexTangents=Ge.vertexTangents,$e.toneMapping=Ge.toneMapping}function eu(le,Ge,$e,Ve,et){Ge.isScene!==!0&&(Ge=$),ge.resetTextureUnits();let Ot=Ge.fog,ri=Ve.isMeshStandardMaterial?Ge.environment:null,oi=w===null?v.outputEncoding:w.isXRRenderTarget===!0?w.texture.encoding:Vl,ee=(Ve.isMeshStandardMaterial?Ie:Oe).get(Ve.envMap||ri),Ce=Ve.vertexColors===!0&&!!$e.attributes.color&&$e.attributes.color.itemSize===4,De=!!Ve.normalMap&&!!$e.attributes.tangent,Le=!!$e.morphAttributes.position,Ee=!!$e.morphAttributes.normal,pt=!!$e.morphAttributes.color,bt=Ve.toneMapped?v.toneMapping:kc,Ct=$e.morphAttributes.position||$e.morphAttributes.normal||$e.morphAttributes.color,yt=Ct!==void 0?Ct.length:0,gt=X.get(Ve),zt=d.state.lights;if(O===!0&&(j===!0||le!==M)){let te=le===M&&Ve.id===_;k.setState(Ve,le,te)}let ft=!1;Ve.version===gt.__version?(gt.needsLights&&gt.lightsStateVersion!==zt.state.version||gt.outputEncoding!==oi||et.isInstancedMesh&&gt.instancing===!1||!et.isInstancedMesh&&gt.instancing===!0||et.isSkinnedMesh&&gt.skinning===!1||!et.isSkinnedMesh&&gt.skinning===!0||gt.envMap!==ee||Ve.fog===!0&&gt.fog!==Ot||gt.numClippingPlanes!==void 0&&(gt.numClippingPlanes!==k.numPlanes||gt.numIntersection!==k.numIntersection)||gt.vertexAlphas!==Ce||gt.vertexTangents!==De||gt.morphTargets!==Le||gt.morphNormals!==Ee||gt.morphColors!==pt||gt.toneMapping!==bt||we.isWebGL2===!0&&gt.morphTargetsCount!==yt)&&(ft=!0):(ft=!0,gt.__version=Ve.version);let gi=gt.currentProgram;ft===!0&&(gi=Tn(Ve,Ge,et));let Ii=!1,Ei=!1,zi=!1,H=gi.getUniforms(),q=gt.uniforms;if(_e.useProgram(gi.program)&&(Ii=!0,Ei=!0,zi=!0),Ve.id!==_&&(_=Ve.id,Ei=!0),Ii||M!==le){if(H.setValue(ie,"projectionMatrix",le.projectionMatrix),we.logarithmicDepthBuffer&&H.setValue(ie,"logDepthBufFC",2/(Math.log(le.far+1)/Math.LN2)),M!==le&&(M=le,Ei=!0,zi=!0),Ve.isShaderMaterial||Ve.isMeshPhongMaterial||Ve.isMeshToonMaterial||Ve.isMeshStandardMaterial||Ve.envMap){let te=H.map.cameraPosition;te!==void 0&&te.setValue(ie,ce.setFromMatrixPosition(le.matrixWorld))}(Ve.isMeshPhongMaterial||Ve.isMeshToonMaterial||Ve.isMeshLambertMaterial||Ve.isMeshBasicMaterial||Ve.isMeshStandardMaterial||Ve.isShaderMaterial)&&H.setValue(ie,"isOrthographic",le.isOrthographicCamera===!0),(Ve.isMeshPhongMaterial||Ve.isMeshToonMaterial||Ve.isMeshLambertMaterial||Ve.isMeshBasicMaterial||Ve.isMeshStandardMaterial||Ve.isShaderMaterial||Ve.isShadowMaterial||et.isSkinnedMesh)&&H.setValue(ie,"viewMatrix",le.matrixWorldInverse)}if(et.isSkinnedMesh){H.setOptional(ie,et,"bindMatrix"),H.setOptional(ie,et,"bindMatrixInverse");let te=et.skeleton;te&&(we.floatVertexTextures?(te.boneTexture===null&&te.computeBoneTexture(),H.setValue(ie,"boneTexture",te.boneTexture,ge),H.setValue(ie,"boneTextureSize",te.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}let me=$e.morphAttributes;if((me.position!==void 0||me.normal!==void 0||me.color!==void 0&&we.isWebGL2===!0)&&G.update(et,$e,Ve,gi),(Ei||gt.receiveShadow!==et.receiveShadow)&&(gt.receiveShadow=et.receiveShadow,H.setValue(ie,"receiveShadow",et.receiveShadow)),Ve.isMeshGouraudMaterial&&Ve.envMap!==null&&(q.envMap.value=ee,q.flipEnvMap.value=ee.isCubeTexture&&ee.isRenderTargetTexture===!1?-1:1),Ei&&(H.setValue(ie,"toneMappingExposure",v.toneMappingExposure),gt.needsLights&&tu(q,zi),Ot&&Ve.fog===!0&&se.refreshFogUniforms(q,Ot),se.refreshMaterialUniforms(q,Ve,D,C,V),dE.upload(ie,gt.uniformsList,q,ge)),Ve.isShaderMaterial&&Ve.uniformsNeedUpdate===!0&&(dE.upload(ie,gt.uniformsList,q,ge),Ve.uniformsNeedUpdate=!1),Ve.isSpriteMaterial&&H.setValue(ie,"center",et.center),H.setValue(ie,"modelViewMatrix",et.modelViewMatrix),H.setValue(ie,"normalMatrix",et.normalMatrix),H.setValue(ie,"modelMatrix",et.matrixWorld),et.previousModelViewMatrix&&H.setValue(ie,"previousModelViewMatrix",et.previousModelViewMatrix),le.previousProjectionMatrix&&H.setValue(ie,"previousProjectionMatrix",le.previousProjectionMatrix),Ve.isShaderMaterial||Ve.isRawShaderMaterial){let te=Ve.uniformsGroups;for(let Ae=0,ut=te.length;Ae<ut;Ae++)if(we.isWebGL2){let Zi=te[Ae];je.update(Zi,gi),je.bind(Zi,gi)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return gi}function tu(le,Ge){le.ambientLightColor.needsUpdate=Ge,le.lightProbe.needsUpdate=Ge,le.directionalLights.needsUpdate=Ge,le.directionalLightShadows.needsUpdate=Ge,le.pointLights.needsUpdate=Ge,le.pointLightShadows.needsUpdate=Ge,le.spotLights.needsUpdate=Ge,le.spotLightShadows.needsUpdate=Ge,le.rectAreaLights.needsUpdate=Ge,le.hemisphereLights.needsUpdate=Ge}function bo(le){return le.isMeshLambertMaterial||le.isMeshToonMaterial||le.isMeshPhongMaterial||le.isMeshStandardMaterial||le.isShadowMaterial||le.isShaderMaterial&&le.lights===!0}this.getActiveCubeFace=function(){return m},this.getActiveMipmapLevel=function(){return x},this.getRenderTarget=function(){return w},this.setRenderTargetTextures=function(le,Ge,$e){X.get(le.texture).__webglTexture=Ge,X.get(le.depthTexture).__webglTexture=$e;let Ve=X.get(le);Ve.__hasExternalTextures=!0,Ve.__hasExternalTextures&&(Ve.__autoAllocateDepthBuffer=$e===void 0,Ve.__autoAllocateDepthBuffer||be.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Ve.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(le,Ge){let $e=X.get(le);$e.__webglFramebuffer=Ge,$e.__useDefaultFramebuffer=Ge===void 0},this.setRenderTarget=function(le,Ge=0,$e=0){w=le,m=Ge,x=$e;let Ve=!0,et=null,Ot=!1,ri=!1;if(le){let oi=X.get(le);oi.__useDefaultFramebuffer!==void 0?(_e.bindFramebuffer(36160,null),Ve=!1):oi.__webglFramebuffer===void 0?ge.setupRenderTarget(le):oi.__hasExternalTextures&&ge.rebindTextures(le,X.get(le.texture).__webglTexture,X.get(le.depthTexture).__webglTexture);let ee=le.texture;(ee.isData3DTexture||ee.isDataArrayTexture||ee.isCompressedArrayTexture)&&(ri=!0);let Ce=X.get(le).__webglFramebuffer;le.isWebGLCubeRenderTarget?(et=Ce[Ge],Ot=!0):we.isWebGL2&&le.samples>0&&ge.useMultisampledRTT(le)===!1?et=X.get(le).__webglMultisampledFramebuffer:et=Ce,S.copy(le.viewport),A.copy(le.scissor),T=le.scissorTest}else S.copy(z).multiplyScalar(D).floor(),A.copy(F).multiplyScalar(D).floor(),T=Q;if(_e.bindFramebuffer(36160,et)&&we.drawBuffers&&Ve&&_e.drawBuffers(le,et),_e.viewport(S),_e.scissor(A),_e.setScissorTest(T),Ot){let oi=X.get(le.texture);ie.framebufferTexture2D(36160,36064,34069+Ge,oi.__webglTexture,$e)}else if(ri){let oi=X.get(le.texture),ee=Ge||0;ie.framebufferTextureLayer(36160,36064,oi.__webglTexture,$e||0,ee)}_=-1},this.readRenderTargetPixels=function(le,Ge,$e,Ve,et,Ot,ri){if(!(le&&le.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let oi=X.get(le).__webglFramebuffer;if(le.isWebGLCubeRenderTarget&&ri!==void 0&&(oi=oi[ri]),oi){_e.bindFramebuffer(36160,oi);try{let ee=le.texture,Ce=ee.format,De=ee.type;if(Ce!==is&&Qe.convert(Ce)!==ie.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}let Le=De===ch&&(be.has("EXT_color_buffer_half_float")||we.isWebGL2&&be.has("EXT_color_buffer_float"));if(De!==Js&&Qe.convert(De)!==ie.getParameter(35738)&&!(De===Sn&&(we.isWebGL2||be.has("OES_texture_float")||be.has("WEBGL_color_buffer_float")))&&!Le){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}Ge>=0&&Ge<=le.width-Ve&&$e>=0&&$e<=le.height-et&&ie.readPixels(Ge,$e,Ve,et,Qe.convert(Ce),Qe.convert(De),Ot)}finally{let ee=w!==null?X.get(w).__webglFramebuffer:null;_e.bindFramebuffer(36160,ee)}}},this.copyFramebufferToTexture=function(le,Ge,$e=0){let Ve=Math.pow(2,-$e),et=Math.floor(Ge.image.width*Ve),Ot=Math.floor(Ge.image.height*Ve);ge.setTexture2D(Ge,0),ie.copyTexSubImage2D(3553,$e,0,0,le.x,le.y,et,Ot),_e.unbindTexture()},this.copyTextureToTexture=function(le,Ge,$e,Ve=0){let et=Ge.image.width,Ot=Ge.image.height,ri=Qe.convert($e.format),oi=Qe.convert($e.type);ge.setTexture2D($e,0),ie.pixelStorei(37440,$e.flipY),ie.pixelStorei(37441,$e.premultiplyAlpha),ie.pixelStorei(3317,$e.unpackAlignment),Ge.isDataTexture?ie.texSubImage2D(3553,Ve,le.x,le.y,et,Ot,ri,oi,Ge.image.data):Ge.isCompressedTexture?ie.compressedTexSubImage2D(3553,Ve,le.x,le.y,Ge.mipmaps[0].width,Ge.mipmaps[0].height,ri,Ge.mipmaps[0].data):ie.texSubImage2D(3553,Ve,le.x,le.y,ri,oi,Ge.image),Ve===0&&$e.generateMipmaps&&ie.generateMipmap(3553),_e.unbindTexture()},this.copyTextureToTexture3D=function(le,Ge,$e,Ve,et=0){if(v.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}let Ot=le.max.x-le.min.x+1,ri=le.max.y-le.min.y+1,oi=le.max.z-le.min.z+1,ee=Qe.convert(Ve.format),Ce=Qe.convert(Ve.type),De;if(Ve.isData3DTexture)ge.setTexture3D(Ve,0),De=32879;else if(Ve.isDataArrayTexture)ge.setTexture2DArray(Ve,0),De=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}ie.pixelStorei(37440,Ve.flipY),ie.pixelStorei(37441,Ve.premultiplyAlpha),ie.pixelStorei(3317,Ve.unpackAlignment);let Le=ie.getParameter(3314),Ee=ie.getParameter(32878),pt=ie.getParameter(3316),bt=ie.getParameter(3315),Ct=ie.getParameter(32877),yt=$e.isCompressedTexture?$e.mipmaps[0]:$e.image;ie.pixelStorei(3314,yt.width),ie.pixelStorei(32878,yt.height),ie.pixelStorei(3316,le.min.x),ie.pixelStorei(3315,le.min.y),ie.pixelStorei(32877,le.min.z),$e.isDataTexture||$e.isData3DTexture?ie.texSubImage3D(De,et,Ge.x,Ge.y,Ge.z,Ot,ri,oi,ee,Ce,yt.data):$e.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),ie.compressedTexSubImage3D(De,et,Ge.x,Ge.y,Ge.z,Ot,ri,oi,ee,yt.data)):ie.texSubImage3D(De,et,Ge.x,Ge.y,Ge.z,Ot,ri,oi,ee,Ce,yt),ie.pixelStorei(3314,Le),ie.pixelStorei(32878,Ee),ie.pixelStorei(3316,pt),ie.pixelStorei(3315,bt),ie.pixelStorei(32877,Ct),et===0&&Ve.generateMipmaps&&ie.generateMipmap(De),_e.unbindTexture()},this.initTexture=function(le){le.isCubeTexture?ge.setTextureCube(le,0):le.isData3DTexture?ge.setTexture3D(le,0):le.isDataArrayTexture||le.isCompressedArrayTexture?ge.setTexture2DArray(le,0):ge.setTexture2D(le,0),_e.unbindTexture()},this.resetState=function(){m=0,x=0,w=null,_e.reset(),ye.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}var Bde=class extends VY{};Bde.prototype.isWebGL1Renderer=!0;var HY=class{constructor(e,t=1,i=1e3){this.isFog=!0,this.name="",this.color=new jt(e),this.near=t,this.far=i}clone(){return new HY(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}},Uc=class extends ir{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){let t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(e){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=e}},kde=class{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=LL,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=$o()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let r=0,n=this.stride;r<n;r++)this.array[e+r]=t.array[i+r];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=$o()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);let t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=$o()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}},na=new B,BL=class{constructor(e,t,i,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)na.fromBufferAttribute(this,t),na.applyMatrix4(e),this.setXYZ(t,na.x,na.y,na.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)na.fromBufferAttribute(this,t),na.applyNormalMatrix(e),this.setXYZ(t,na.x,na.y,na.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)na.fromBufferAttribute(this,t),na.transformDirection(e),this.setXYZ(t,na.x,na.y,na.z);return this}setX(e,t){return this.normalized&&(t=gr(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=gr(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=gr(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=gr(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=Yu(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=Yu(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=Yu(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=Yu(t,this.array)),t}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=gr(t,this.array),i=gr(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=gr(t,this.array),i=gr(i,this.array),r=gr(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this}setXYZW(e,t,i,r,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=gr(t,this.array),i=gr(i,this.array),r=gr(r,this.array),n=gr(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this.data.array[e+3]=n,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");let t=[];for(let i=0;i<this.count;i++){let r=i*this.data.stride+this.offset;for(let n=0;n<this.itemSize;n++)t.push(this.data.array[r+n])}return new $t(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new BL(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");let t=[];for(let i=0;i<this.count;i++){let r=i*this.data.stride+this.offset;for(let n=0;n<this.itemSize;n++)t.push(this.data.array[r+n])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}},GY=class extends ir{constructor(){super(),this.isBone=!0,this.type="Bone"}},Yo=class extends Br{constructor(e=null,t=1,i=1,r,n,s,a,o,l=Qi,c=Qi,u,h){super(null,s,a,o,l,c,r,n,u,h),this.isDataTexture=!0,this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},ZV=new ht,Ude=new ht,gB=class{constructor(e=[],t=[]){this.uuid=$o(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){let e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,r=this.bones.length;i<r;i++)this.boneInverses.push(new ht)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){let i=new ht;this.bones[e]&&i.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){let i=this.bones[e];i&&i.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){let i=this.bones[e];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){let e=this.bones,t=this.boneInverses,i=this.boneMatrices,r=this.boneTexture;for(let n=0,s=e.length;n<s;n++){let a=e[n]?e[n].matrixWorld:Ude;ZV.multiplyMatrices(a,t[n]),ZV.toArray(i,n*16)}r!==null&&(r.needsUpdate=!0)}clone(){return new gB(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=CY(e),e=Math.max(e,4);let t=new Float32Array(e*e*4);t.set(this.boneMatrices);let i=new Yo(t,e,e,is,Sn);return i.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=i,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,i=this.bones.length;t<i;t++){let r=this.bones[t];if(r.name===e)return r}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let i=0,r=e.bones.length;i<r;i++){let n=e.bones[i],s=t[n];s===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",n),s=new GY),this.bones.push(s),this.boneInverses.push(new ht().fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){let e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;let t=this.bones,i=this.boneInverses;for(let r=0,n=t.length;r<n;r++){let s=t[r];e.bones.push(s.uuid);let a=i[r];e.boneInverses.push(a.toArray())}return e}},L1=class extends $t{constructor(e,t,i,r=1){super(e,t,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){let e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}},$V=new ht,JV=new ht,H_=[],Fde=new ht,Ay=new zr,Vde=class extends zr{constructor(e,t,i){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new L1(new Float32Array(i*16),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1;for(let r=0;r<i;r++)this.setMatrixAt(r,Fde)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}raycast(e,t){let i=this.matrixWorld,r=this.count;if(Ay.geometry=this.geometry,Ay.material=this.material,Ay.material!==void 0)for(let n=0;n<r;n++){this.getMatrixAt(n,$V),JV.multiplyMatrices(i,$V),Ay.matrixWorld=JV,Ay.raycast(e,H_);for(let s=0,a=H_.length;s<a;s++){let o=H_[s];o.instanceId=n,o.object=this,t.push(o)}H_.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new L1(new Float32Array(this.instanceMatrix.count*3),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}},rp=class extends Ow{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new jt(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}},eH=new B,tH=new B,iH=new ht,JD=new _0,G_=new ja,wA=class extends ir{constructor(e=new Bt,t=new rp){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){let e=this.geometry;if(e.index===null){let t=e.attributes.position,i=[0];for(let r=1,n=t.count;r<n;r++)eH.fromBufferAttribute(t,r-1),tH.fromBufferAttribute(t,r),i[r]=i[r-1],i[r]+=eH.distanceTo(tH);e.setAttribute("lineDistance",new St(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){let i=this.geometry,r=this.matrixWorld,n=e.params.Line.threshold,s=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),G_.copy(i.boundingSphere),G_.applyMatrix4(r),G_.radius+=n,e.ray.intersectsSphere(G_)===!1)return;iH.copy(r).invert(),JD.copy(e.ray).applyMatrix4(iH);let a=n/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,l=new B,c=new B,u=new B,h=new B,d=this.isLineSegments?2:1,p=i.index,f=i.attributes.position;if(p!==null){let v=Math.max(0,s.start),g=Math.min(p.count,s.start+s.count);for(let m=v,x=g-1;m<x;m+=d){let w=p.getX(m),_=p.getX(m+1);if(l.fromBufferAttribute(f,w),c.fromBufferAttribute(f,_),JD.distanceSqToSegment(l,c,h,u)>o)continue;h.applyMatrix4(this.matrixWorld);let M=e.ray.origin.distanceTo(h);M<e.near||M>e.far||t.push({distance:M,point:u.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this})}}else{let v=Math.max(0,s.start),g=Math.min(f.count,s.start+s.count);for(let m=v,x=g-1;m<x;m+=d){if(l.fromBufferAttribute(f,m),c.fromBufferAttribute(f,m+1),JD.distanceSqToSegment(l,c,h,u)>o)continue;h.applyMatrix4(this.matrixWorld);let w=e.ray.origin.distanceTo(h);w<e.near||w>e.far||t.push({distance:w,point:u.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){let e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){let i=e[t[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,n=i.length;r<n;r++){let s=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=r}}}}},rH=new B,nH=new B,zw=class extends wA{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){let e=this.geometry;if(e.index===null){let t=e.attributes.position,i=[];for(let r=0,n=t.count;r<n;r+=2)rH.fromBufferAttribute(t,r),nH.fromBufferAttribute(t,r+1),i[r]=r===0?0:i[r-1],i[r+1]=i[r]+rH.distanceTo(nH);e.setAttribute("lineDistance",new St(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}},Hde=class extends Br{constructor(e,t,i,r,n,s,a,o,l){super(e,t,i,r,n,s,a,o,l),this.isVideoTexture=!0,this.minFilter=s!==void 0?s:pi,this.magFilter=n!==void 0?n:pi,this.generateMipmaps=!1;let c=this;function u(){c.needsUpdate=!0,e.requestVideoFrameCallback(u)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(u)}clone(){return new this.constructor(this.image).copy(this)}update(){let e=this.image;!("requestVideoFrameCallback"in e)&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}},Gde=class extends Br{constructor(e,t,i,r,n,s,a,o,l){super(e,t,i,r,n,s,a,o,l),this.isCanvasTexture=!0,this.needsUpdate=!0}},Qc=class{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){let i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){let t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){let t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){let e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;let t=[],i,r=this.getPoint(0),n=0;t.push(0);for(let s=1;s<=e;s++)i=this.getPoint(s/e),n+=i.distanceTo(r),t.push(n),r=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){let i=this.getLengths(),r=0,n=i.length,s;t?s=t:s=e*i[n-1];let a=0,o=n-1,l;for(;a<=o;)if(r=Math.floor(a+(o-a)/2),l=i[r]-s,l<0)a=r+1;else if(l>0)o=r-1;else{o=r;break}if(r=o,i[r]===s)return r/(n-1);let c=i[r],u=i[r+1]-c,h=(s-c)/u;return(r+h)/(n-1)}getTangent(e,t){let i=e-1e-4,r=e+1e-4;i<0&&(i=0),r>1&&(r=1);let n=this.getPoint(i),s=this.getPoint(r),a=t||(n.isVector2?new ve:new B);return a.copy(s).sub(n).normalize(),a}getTangentAt(e,t){let i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t){let i=new B,r=[],n=[],s=[],a=new B,o=new ht;for(let d=0;d<=e;d++){let p=d/e;r[d]=this.getTangentAt(p,new B)}n[0]=new B,s[0]=new B;let l=Number.MAX_VALUE,c=Math.abs(r[0].x),u=Math.abs(r[0].y),h=Math.abs(r[0].z);c<=l&&(l=c,i.set(1,0,0)),u<=l&&(l=u,i.set(0,1,0)),h<=l&&i.set(0,0,1),a.crossVectors(r[0],i).normalize(),n[0].crossVectors(r[0],a),s[0].crossVectors(r[0],n[0]);for(let d=1;d<=e;d++){if(n[d]=n[d-1].clone(),s[d]=s[d-1].clone(),a.crossVectors(r[d-1],r[d]),a.length()>Number.EPSILON){a.normalize();let p=Math.acos(vn(r[d-1].dot(r[d]),-1,1));n[d].applyMatrix4(o.makeRotationAxis(a,p))}s[d].crossVectors(r[d],n[d])}if(t===!0){let d=Math.acos(vn(n[0].dot(n[e]),-1,1));d/=e,r[0].dot(a.crossVectors(n[0],n[e]))>0&&(d=-d);for(let p=1;p<=e;p++)n[p].applyMatrix4(o.makeRotationAxis(r[p],d*p)),s[p].crossVectors(r[p],n[p])}return{tangents:r,normals:n,binormals:s}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){let e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}},MT=class extends Qc{constructor(e=0,t=0,i=1,r=1,n=0,s=Math.PI*2,a=!1,o=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=r,this.aStartAngle=n,this.aEndAngle=s,this.aClockwise=a,this.aRotation=o}getPoint(e,t){let i=t||new ve,r=Math.PI*2,n=this.aEndAngle-this.aStartAngle,s=Math.abs(n)<Number.EPSILON;for(;n<0;)n+=r;for(;n>r;)n-=r;n<Number.EPSILON&&(s?n=0:n=r),this.aClockwise===!0&&!s&&(n===r?n=-r:n=n-r);let a=this.aStartAngle+e*n,o=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(this.aRotation!==0){let c=Math.cos(this.aRotation),u=Math.sin(this.aRotation),h=o-this.aX,d=l-this.aY;o=h*c-d*u+this.aX,l=h*u+d*c+this.aY}return i.set(o,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){let e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}},jde=class extends MT{constructor(e,t,i,r,n,s){super(e,t,i,i,r,n,s),this.isArcCurve=!0,this.type="ArcCurve"}};function vB(){let e=0,t=0,i=0,r=0;function n(s,a,o,l){e=s,t=o,i=-3*s+3*a-2*o-l,r=2*s-2*a+o+l}return{initCatmullRom:function(s,a,o,l,c){n(a,o,c*(o-s),c*(l-a))},initNonuniformCatmullRom:function(s,a,o,l,c,u,h){let d=(a-s)/c-(o-s)/(c+u)+(o-a)/u,p=(o-a)/u-(l-a)/(u+h)+(l-o)/h;d*=u,p*=u,n(a,o,d,p)},calc:function(s){let a=s*s,o=a*s;return e+t*s+i*a+r*o}}}var j_=new B,e3=new vB,t3=new vB,i3=new vB,Wde=class extends Qc{constructor(e=[],t=!1,i="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=r}getPoint(e,t=new B){let i=t,r=this.points,n=r.length,s=(n-(this.closed?0:1))*e,a=Math.floor(s),o=s-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/n)+1)*n:o===0&&a===n-1&&(a=n-2,o=1);let l,c;this.closed||a>0?l=r[(a-1)%n]:(j_.subVectors(r[0],r[1]).add(r[0]),l=j_);let u=r[a%n],h=r[(a+1)%n];if(this.closed||a+2<n?c=r[(a+2)%n]:(j_.subVectors(r[n-1],r[n-2]).add(r[n-1]),c=j_),this.curveType==="centripetal"||this.curveType==="chordal"){let d=this.curveType==="chordal"?.5:.25,p=Math.pow(l.distanceToSquared(u),d),f=Math.pow(u.distanceToSquared(h),d),v=Math.pow(h.distanceToSquared(c),d);f<1e-4&&(f=1),p<1e-4&&(p=f),v<1e-4&&(v=f),e3.initNonuniformCatmullRom(l.x,u.x,h.x,c.x,p,f,v),t3.initNonuniformCatmullRom(l.y,u.y,h.y,c.y,p,f,v),i3.initNonuniformCatmullRom(l.z,u.z,h.z,c.z,p,f,v)}else this.curveType==="catmullrom"&&(e3.initCatmullRom(l.x,u.x,h.x,c.x,this.tension),t3.initCatmullRom(l.y,u.y,h.y,c.y,this.tension),i3.initCatmullRom(l.z,u.z,h.z,c.z,this.tension));return i.set(e3.calc(o),t3.calc(o),i3.calc(o)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){let r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let r=e.points[t];this.points.push(new B().fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}};function sH(e,t,i,r,n){let s=(r-t)*.5,a=(n-i)*.5,o=e*e,l=e*o;return(2*i-2*r+s+a)*l+(-3*i+3*r-2*s-a)*o+s*e+i}function Xde(e,t){let i=1-e;return i*i*t}function qde(e,t){return 2*(1-e)*e*t}function Yde(e,t){return e*e*t}function jx(e,t,i,r){return Xde(e,t)+qde(e,i)+Yde(e,r)}function Qde(e,t){let i=1-e;return i*i*i*t}function Kde(e,t){let i=1-e;return 3*i*i*e*t}function Zde(e,t){return 3*(1-e)*e*e*t}function $de(e,t){return e*e*e*t}function Wx(e,t,i,r,n){return Qde(e,t)+Kde(e,i)+Zde(e,r)+$de(e,n)}var Rl=class extends Qc{constructor(e=new ve,t=new ve,i=new ve,r=new ve){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=r}getPoint(e,t=new ve){let i=t,r=this.v0,n=this.v1,s=this.v2,a=this.v3;return i.set(Wx(e,r.x,n.x,s.x,a.x),Wx(e,r.y,n.y,s.y,a.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}},pE=class extends Qc{constructor(e=new B,t=new B,i=new B,r=new B){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=r}getPoint(e,t=new B){let i=t,r=this.v0,n=this.v1,s=this.v2,a=this.v3;return i.set(Wx(e,r.x,n.x,s.x,a.x),Wx(e,r.y,n.y,s.y,a.y),Wx(e,r.z,n.z,s.z,a.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}},Bl=class extends Qc{constructor(e=new ve,t=new ve){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new ve){let i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){let i=t||new ve;return i.copy(this.v2).sub(this.v1).normalize(),i}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},jY=class extends Qc{constructor(e=new B,t=new B){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new B){let i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},Xd=class extends Qc{constructor(e=new ve,t=new ve,i=new ve){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new ve){let i=t,r=this.v0,n=this.v1,s=this.v2;return i.set(jx(e,r.x,n.x,s.x),jx(e,r.y,n.y,s.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},Jde=class extends Qc{constructor(e=new B,t=new B,i=new B){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new B){let i=t,r=this.v0,n=this.v1,s=this.v2;return i.set(jx(e,r.x,n.x,s.x),jx(e,r.y,n.y,s.y),jx(e,r.z,n.z,s.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},yB=class extends Qc{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new ve){let i=t,r=this.points,n=(r.length-1)*e,s=Math.floor(n),a=n-s,o=r[s===0?s:s-1],l=r[s],c=r[s>r.length-2?r.length-1:s+1],u=r[s>r.length-3?r.length-1:s+2];return i.set(sH(a,o.x,l.x,c.x,u.x),sH(a,o.y,l.y,c.y,u.y)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let r=e.points[t];this.points.push(r.clone())}return this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){let r=this.points[t];e.points.push(r.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let r=e.points[t];this.points.push(new ve().fromArray(r))}return this}},epe=Object.freeze({__proto__:null,ArcCurve:jde,CatmullRomCurve3:Wde,CubicBezierCurve:Rl,CubicBezierCurve3:pE,EllipseCurve:MT,LineCurve:Bl,LineCurve3:jY,QuadraticBezierCurve:Xd,QuadraticBezierCurve3:Jde,SplineCurve:yB}),WY=class extends Qc{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){let e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Bl(t,e))}getPoint(e,t){let i=e*this.getLength(),r=this.getCurveLengths(),n=0;for(;n<r.length;){if(r[n]>=i){let s=r[n]-i,a=this.curves[n],o=a.getLength(),l=o===0?0:1-s/o;return a.getPointAt(l,t)}n++}return null}getLength(){let e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;let e=[],t=0;for(let i=0,r=this.curves.length;i<r;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){let t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){let t=[],i;for(let r=0,n=this.curves;r<n.length;r++){let s=n[r],a=s.isEllipseCurve?e*2:s.isLineCurve||s.isLineCurve3?1:s.isSplineCurve?e*s.points.length:e,o=s.getPoints(a);for(let l=0;l<o.length;l++){let c=o[l];i&&i.equals(c)||(t.push(c),i=c)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){let r=e.curves[t];this.curves.push(r.clone())}return this.autoClose=e.autoClose,this}toJSON(){let e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,i=this.curves.length;t<i;t++){let r=this.curves[t];e.curves.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){let r=e.curves[t];this.curves.push(new epe[r.type]().fromJSON(r))}return this}},bA=class extends WY{constructor(e){super(),this.type="Path",this.currentPoint=new ve,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){let i=new Bl(this.currentPoint.clone(),new ve(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,i,r){let n=new Xd(this.currentPoint.clone(),new ve(e,t),new ve(i,r));return this.curves.push(n),this.currentPoint.set(i,r),this}bezierCurveTo(e,t,i,r,n,s){let a=new Rl(this.currentPoint.clone(),new ve(e,t),new ve(i,r),new ve(n,s));return this.curves.push(a),this.currentPoint.set(n,s),this}splineThru(e){let t=[this.currentPoint.clone()].concat(e),i=new yB(t);return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,i,r,n,s){let a=this.currentPoint.x,o=this.currentPoint.y;return this.absarc(e+a,t+o,i,r,n,s),this}absarc(e,t,i,r,n,s){return this.absellipse(e,t,i,i,r,n,s),this}ellipse(e,t,i,r,n,s,a,o){let l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,i,r,n,s,a,o),this}absellipse(e,t,i,r,n,s,a,o){let l=new MT(e,t,i,r,n,s,a,o);if(this.curves.length>0){let u=l.getPoint(0);u.equals(this.currentPoint)||this.lineTo(u.x,u.y)}this.curves.push(l);let c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){let e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}},XY=class extends Bt{constructor(e=[new ve(0,-.5),new ve(.5,0),new ve(0,.5)],t=12,i=0,r=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:r},t=Math.floor(t),r=vn(r,0,Math.PI*2);let n=[],s=[],a=[],o=[],l=[],c=1/t,u=new B,h=new ve,d=new B,p=new B,f=new B,v=0,g=0;for(let m=0;m<=e.length-1;m++)switch(m){case 0:v=e[m+1].x-e[m].x,g=e[m+1].y-e[m].y,d.x=g*1,d.y=-v,d.z=g*0,f.copy(d),d.normalize(),o.push(d.x,d.y,d.z);break;case e.length-1:o.push(f.x,f.y,f.z);break;default:v=e[m+1].x-e[m].x,g=e[m+1].y-e[m].y,d.x=g*1,d.y=-v,d.z=g*0,p.copy(d),d.x+=f.x,d.y+=f.y,d.z+=f.z,d.normalize(),o.push(d.x,d.y,d.z),f.copy(p)}for(let m=0;m<=t;m++){let x=i+m*c*r,w=Math.sin(x),_=Math.cos(x);for(let M=0;M<=e.length-1;M++){u.x=e[M].x*w,u.y=e[M].y,u.z=e[M].x*_,s.push(u.x,u.y,u.z),h.x=m/t,h.y=M/(e.length-1),a.push(h.x,h.y);let S=o[3*M+0]*w,A=o[3*M+1],T=o[3*M+0]*_;l.push(S,A,T)}}for(let m=0;m<t;m++)for(let x=0;x<e.length-1;x++){let w=x+m*e.length,_=w,M=w+e.length,S=w+e.length+1,A=w+1;n.push(_,M,A),n.push(S,A,M)}this.setIndex(n),this.setAttribute("position",new St(s,3)),this.setAttribute("uv",new St(a,2)),this.setAttribute("normal",new St(l,3))}static fromJSON(e){return new XY(e.points,e.segments,e.phiStart,e.phiLength)}},xB=class extends Bt{constructor(e=1,t=1,i=1,r=32,n=1,s=!1,a=0,o=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:r,heightSegments:n,openEnded:s,thetaStart:a,thetaLength:o};let l=this;r=Math.floor(r),n=Math.floor(n);let c=[],u=[],h=[],d=[],p=0,f=[],v=i/2,g=0;m(),s===!1&&(e>0&&x(!0),t>0&&x(!1)),this.setIndex(c),this.setAttribute("position",new St(u,3)),this.setAttribute("normal",new St(h,3)),this.setAttribute("uv",new St(d,2));function m(){let w=new B,_=new B,M=0,S=(t-e)/i;for(let A=0;A<=n;A++){let T=[],E=A/n,C=E*(t-e)+e;for(let D=0;D<=r;D++){let I=D/r,L=I*o+a,z=Math.sin(L),F=Math.cos(L);_.x=C*z,_.y=-E*i+v,_.z=C*F,u.push(_.x,_.y,_.z),w.set(z,S,F).normalize(),h.push(w.x,w.y,w.z),d.push(I,1-E),T.push(p++)}f.push(T)}for(let A=0;A<r;A++)for(let T=0;T<n;T++){let E=f[T][A],C=f[T+1][A],D=f[T+1][A+1],I=f[T][A+1];c.push(E,C,I),c.push(C,D,I),M+=6}l.addGroup(g,M,0),g+=M}function x(w){let _=p,M=new ve,S=new B,A=0,T=w===!0?e:t,E=w===!0?1:-1;for(let D=1;D<=r;D++)u.push(0,v*E,0),h.push(0,E,0),d.push(.5,.5),p++;let C=p;for(let D=0;D<=r;D++){let I=D/r*o+a,L=Math.cos(I),z=Math.sin(I);S.x=T*z,S.y=v*E,S.z=T*L,u.push(S.x,S.y,S.z),h.push(0,E,0),M.x=L*.5+.5,M.y=z*.5*E+.5,d.push(M.x,M.y),p++}for(let D=0;D<r;D++){let I=_+D,L=C+D;w===!0?c.push(L,L+1,I):c.push(L+1,L,I),A+=3}l.addGroup(g,A,w===!0?1:2),g+=A}}static fromJSON(e){return new xB(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}},wB=class extends xB{constructor(e=1,t=1,i=32,r=1,n=!1,s=0,a=Math.PI*2){super(0,e,t,i,r,n,s,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:r,openEnded:n,thetaStart:s,thetaLength:a}}static fromJSON(e){return new wB(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}},bB=class extends Bt{constructor(e=[],t=[],i=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:r};let n=[],s=[];a(r),l(i),c(),this.setAttribute("position",new St(n,3)),this.setAttribute("normal",new St(n.slice(),3)),this.setAttribute("uv",new St(s,2)),r===0?this.computeVertexNormals():this.normalizeNormals();function a(m){let x=new B,w=new B,_=new B;for(let M=0;M<t.length;M+=3)d(t[M+0],x),d(t[M+1],w),d(t[M+2],_),o(x,w,_,m)}function o(m,x,w,_){let M=_+1,S=[];for(let A=0;A<=M;A++){S[A]=[];let T=m.clone().lerp(w,A/M),E=x.clone().lerp(w,A/M),C=M-A;for(let D=0;D<=C;D++)D===0&&A===M?S[A][D]=T:S[A][D]=T.clone().lerp(E,D/C)}for(let A=0;A<M;A++)for(let T=0;T<2*(M-A)-1;T++){let E=Math.floor(T/2);T%2===0?(h(S[A][E+1]),h(S[A+1][E]),h(S[A][E])):(h(S[A][E+1]),h(S[A+1][E+1]),h(S[A+1][E]))}}function l(m){let x=new B;for(let w=0;w<n.length;w+=3)x.x=n[w+0],x.y=n[w+1],x.z=n[w+2],x.normalize().multiplyScalar(m),n[w+0]=x.x,n[w+1]=x.y,n[w+2]=x.z}function c(){let m=new B;for(let x=0;x<n.length;x+=3){m.x=n[x+0],m.y=n[x+1],m.z=n[x+2];let w=v(m)/2/Math.PI+.5,_=g(m)/Math.PI+.5;s.push(w,1-_)}p(),u()}function u(){for(let m=0;m<s.length;m+=6){let x=s[m+0],w=s[m+2],_=s[m+4],M=Math.max(x,w,_),S=Math.min(x,w,_);M>.9&&S<.1&&(x<.2&&(s[m+0]+=1),w<.2&&(s[m+2]+=1),_<.2&&(s[m+4]+=1))}}function h(m){n.push(m.x,m.y,m.z)}function d(m,x){let w=m*3;x.x=e[w+0],x.y=e[w+1],x.z=e[w+2]}function p(){let m=new B,x=new B,w=new B,_=new B,M=new ve,S=new ve,A=new ve;for(let T=0,E=0;T<n.length;T+=9,E+=6){m.set(n[T+0],n[T+1],n[T+2]),x.set(n[T+3],n[T+4],n[T+5]),w.set(n[T+6],n[T+7],n[T+8]),M.set(s[E+0],s[E+1]),S.set(s[E+2],s[E+3]),A.set(s[E+4],s[E+5]),_.copy(m).add(x).add(w).divideScalar(3);let C=v(_);f(M,E+0,m,C),f(S,E+2,x,C),f(A,E+4,w,C)}}function f(m,x,w,_){_<0&&m.x===1&&(s[x]=m.x-1),w.x===0&&w.z===0&&(s[x]=_/2/Math.PI+.5)}function v(m){return Math.atan2(m.z,-m.x)}function g(m){return Math.atan2(-m.y,Math.sqrt(m.x*m.x+m.z*m.z))}}static fromJSON(e){return new bB(e.vertices,e.indices,e.radius,e.details)}},qY=class extends bB{constructor(e=1,t=0){let i=(1+Math.sqrt(5))/2,r=1/i,n=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-i,0,-r,i,0,r,-i,0,r,i,-r,-i,0,-r,i,0,r,-i,0,r,i,0,-i,0,-r,i,0,-r,-i,0,r,i,0,r],s=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(n,s,e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new qY(e.radius,e.detail)}},_A=class extends bA{constructor(e){super(e),this.uuid=$o(),this.type="Shape",this.holes=[]}getPointsHoles(e){let t=[];for(let i=0,r=this.holes.length;i<r;i++)t[i]=this.holes[i].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){let r=e.holes[t];this.holes.push(r.clone())}return this}toJSON(){let e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,i=this.holes.length;t<i;t++){let r=this.holes[t];e.holes.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){let r=e.holes[t];this.holes.push(new bA().fromJSON(r))}return this}},tpe={triangulate:function(e,t,i=2){let r=t&&t.length,n=r?t[0]*i:e.length,s=YY(e,0,n,i,!0),a=[];if(!s||s.next===s.prev)return a;let o,l,c,u,h,d,p;if(r&&(s=ape(e,t,s,i)),e.length>80*i){o=c=e[0],l=u=e[1];for(let f=i;f<n;f+=i)h=e[f],d=e[f+1],h<o&&(o=h),d<l&&(l=d),h>c&&(c=h),d>u&&(u=d);p=Math.max(c-o,u-l),p=p!==0?32767/p:0}return O1(s,a,i,o,l,p,0),a}};function YY(e,t,i,r,n){let s,a;if(n===vpe(e,t,i,r)>0)for(s=t;s<i;s+=r)a=aH(s,e[s],e[s+1],a);else for(s=i-r;s>=t;s-=r)a=aH(s,e[s],e[s+1],a);return a&&ET(a,a.next)&&(N1(a),a=a.next),a}function jf(e,t){if(!e)return e;t||(t=e);let i=e,r;do if(r=!1,!i.steiner&&(ET(i,i.next)||Lr(i.prev,i,i.next)===0)){if(N1(i),i=t=i.prev,i===i.next)break;r=!0}else i=i.next;while(r||i!==t);return t}function O1(e,t,i,r,n,s,a){if(!e)return;!a&&s&&hpe(e,r,n,s);let o=e,l,c;for(;e.prev!==e.next;){if(l=e.prev,c=e.next,s?rpe(e,r,n,s):ipe(e)){t.push(l.i/i|0),t.push(e.i/i|0),t.push(c.i/i|0),N1(e),e=c.next,o=c.next;continue}if(e=c,e===o){a?a===1?(e=npe(jf(e),t,i),O1(e,t,i,r,n,s,2)):a===2&&spe(e,t,i,r,n,s):O1(jf(e),t,i,r,n,s,1);break}}}function ipe(e){let t=e.prev,i=e,r=e.next;if(Lr(t,i,r)>=0)return!1;let n=t.x,s=i.x,a=r.x,o=t.y,l=i.y,c=r.y,u=n<s?n<a?n:a:s<a?s:a,h=o<l?o<c?o:c:l<c?l:c,d=n>s?n>a?n:a:s>a?s:a,p=o>l?o>c?o:c:l>c?l:c,f=r.next;for(;f!==t;){if(f.x>=u&&f.x<=d&&f.y>=h&&f.y<=p&&nv(n,o,s,l,a,c,f.x,f.y)&&Lr(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function rpe(e,t,i,r){let n=e.prev,s=e,a=e.next;if(Lr(n,s,a)>=0)return!1;let o=n.x,l=s.x,c=a.x,u=n.y,h=s.y,d=a.y,p=o<l?o<c?o:c:l<c?l:c,f=u<h?u<d?u:d:h<d?h:d,v=o>l?o>c?o:c:l>c?l:c,g=u>h?u>d?u:d:h>d?h:d,m=kL(p,f,t,i,r),x=kL(v,g,t,i,r),w=e.prevZ,_=e.nextZ;for(;w&&w.z>=m&&_&&_.z<=x;){if(w.x>=p&&w.x<=v&&w.y>=f&&w.y<=g&&w!==n&&w!==a&&nv(o,u,l,h,c,d,w.x,w.y)&&Lr(w.prev,w,w.next)>=0||(w=w.prevZ,_.x>=p&&_.x<=v&&_.y>=f&&_.y<=g&&_!==n&&_!==a&&nv(o,u,l,h,c,d,_.x,_.y)&&Lr(_.prev,_,_.next)>=0))return!1;_=_.nextZ}for(;w&&w.z>=m;){if(w.x>=p&&w.x<=v&&w.y>=f&&w.y<=g&&w!==n&&w!==a&&nv(o,u,l,h,c,d,w.x,w.y)&&Lr(w.prev,w,w.next)>=0)return!1;w=w.prevZ}for(;_&&_.z<=x;){if(_.x>=p&&_.x<=v&&_.y>=f&&_.y<=g&&_!==n&&_!==a&&nv(o,u,l,h,c,d,_.x,_.y)&&Lr(_.prev,_,_.next)>=0)return!1;_=_.nextZ}return!0}function npe(e,t,i){let r=e;do{let n=r.prev,s=r.next.next;!ET(n,s)&&QY(n,r,r.next,s)&&z1(n,s)&&z1(s,n)&&(t.push(n.i/i|0),t.push(r.i/i|0),t.push(s.i/i|0),N1(r),N1(r.next),r=e=s),r=r.next}while(r!==e);return jf(r)}function spe(e,t,i,r,n,s){let a=e;do{let o=a.next.next;for(;o!==a.prev;){if(a.i!==o.i&&fpe(a,o)){let l=KY(a,o);a=jf(a,a.next),l=jf(l,l.next),O1(a,t,i,r,n,s,0),O1(l,t,i,r,n,s,0);return}o=o.next}a=a.next}while(a!==e)}function ape(e,t,i,r){let n=[],s,a,o,l,c;for(s=0,a=t.length;s<a;s++)o=t[s]*r,l=s<a-1?t[s+1]*r:e.length,c=YY(e,o,l,r,!1),c===c.next&&(c.steiner=!0),n.push(ppe(c));for(n.sort(ope),s=0;s<n.length;s++)i=lpe(n[s],i);return i}function ope(e,t){return e.x-t.x}function lpe(e,t){let i=cpe(e,t);if(!i)return t;let r=KY(i,e);return jf(r,r.next),jf(i,i.next)}function cpe(e,t){let i=t,r=-1/0,n,s=e.x,a=e.y;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){let d=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(d<=s&&d>r&&(r=d,n=i.x<i.next.x?i:i.next,d===s))return n}i=i.next}while(i!==t);if(!n)return null;let o=n,l=n.x,c=n.y,u=1/0,h;i=n;do s>=i.x&&i.x>=l&&s!==i.x&&nv(a<c?s:r,a,l,c,a<c?r:s,a,i.x,i.y)&&(h=Math.abs(a-i.y)/(s-i.x),z1(i,e)&&(h<u||h===u&&(i.x>n.x||i.x===n.x&&upe(n,i)))&&(n=i,u=h)),i=i.next;while(i!==o);return n}function upe(e,t){return Lr(e.prev,e,t.prev)<0&&Lr(t.next,e,e.next)<0}function hpe(e,t,i,r){let n=e;do n.z===0&&(n.z=kL(n.x,n.y,t,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,dpe(n)}function dpe(e){let t,i,r,n,s,a,o,l,c=1;do{for(i=e,e=null,s=null,a=0;i;){for(a++,r=i,o=0,t=0;t<c&&(o++,r=r.nextZ,!!r);t++);for(l=c;o>0||l>0&&r;)o!==0&&(l===0||!r||i.z<=r.z)?(n=i,i=i.nextZ,o--):(n=r,r=r.nextZ,l--),s?s.nextZ=n:e=n,n.prevZ=s,s=n;i=r}s.nextZ=null,c*=2}while(a>1);return e}function kL(e,t,i,r,n){return e=(e-i)*n|0,t=(t-r)*n|0,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function ppe(e){let t=e,i=e;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==e);return i}function nv(e,t,i,r,n,s,a,o){return(n-a)*(t-o)>=(e-a)*(s-o)&&(e-a)*(r-o)>=(i-a)*(t-o)&&(i-a)*(s-o)>=(n-a)*(r-o)}function fpe(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!mpe(e,t)&&(z1(e,t)&&z1(t,e)&&gpe(e,t)&&(Lr(e.prev,e,t.prev)||Lr(e,t.prev,t))||ET(e,t)&&Lr(e.prev,e,e.next)>0&&Lr(t.prev,t,t.next)>0)}function Lr(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function ET(e,t){return e.x===t.x&&e.y===t.y}function QY(e,t,i,r){let n=X_(Lr(e,t,i)),s=X_(Lr(e,t,r)),a=X_(Lr(i,r,e)),o=X_(Lr(i,r,t));return!!(n!==s&&a!==o||n===0&&W_(e,i,t)||s===0&&W_(e,r,t)||a===0&&W_(i,e,r)||o===0&&W_(i,t,r))}function W_(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function X_(e){return e>0?1:e<0?-1:0}function mpe(e,t){let i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&QY(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}function z1(e,t){return Lr(e.prev,e,e.next)<0?Lr(e,t,e.next)>=0&&Lr(e,e.prev,t)>=0:Lr(e,t,e.prev)<0||Lr(e,e.next,t)<0}function gpe(e,t){let i=e,r=!1,n=(e.x+t.x)/2,s=(e.y+t.y)/2;do i.y>s!=i.next.y>s&&i.next.y!==i.y&&n<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next;while(i!==e);return r}function KY(e,t){let i=new UL(e.i,e.x,e.y),r=new UL(t.i,t.x,t.y),n=e.next,s=t.prev;return e.next=t,t.prev=e,i.next=n,n.prev=i,r.next=i,i.prev=r,s.next=r,r.prev=s,r}function aH(e,t,i,r){let n=new UL(e,t,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function N1(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function UL(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function vpe(e,t,i,r){let n=0;for(let s=t,a=i-r;s<i;s+=r)n+=(e[a]-e[s])*(e[s+1]+e[a+1]),a=s;return n}var ZY=class{static area(e){let t=e.length,i=0;for(let r=t-1,n=0;n<t;r=n++)i+=e[r].x*e[n].y-e[n].x*e[r].y;return i*.5}static isClockWise(e){return ZY.area(e)<0}static triangulateShape(e,t){let i=[],r=[],n=[];oH(e),lH(i,e);let s=e.length;t.forEach(oH);for(let o=0;o<t.length;o++)r.push(s),s+=t[o].length,lH(i,t[o]);let a=tpe.triangulate(i,r);for(let o=0;o<a.length;o+=3)n.push(a.slice(o,o+3));return n}};function oH(e){let t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function lH(e,t){for(let i=0;i<t.length;i++)e.push(t[i].x),e.push(t[i].y)}var $Y=class extends bB{constructor(e=1,t=0){let i=(1+Math.sqrt(5))/2,r=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],n=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(r,n,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new $Y(e.radius,e.detail)}},_v=class extends Bt{constructor(e=1,t=32,i=16,r=0,n=Math.PI*2,s=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:r,phiLength:n,thetaStart:s,thetaLength:a},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));let o=Math.min(s+a,Math.PI),l=0,c=[],u=new B,h=new B,d=[],p=[],f=[],v=[];for(let g=0;g<=i;g++){let m=[],x=g/i,w=0;g==0&&s==0?w=.5/t:g==i&&o==Math.PI&&(w=-.5/t);for(let _=0;_<=t;_++){let M=_/t;u.x=-e*Math.cos(r+M*n)*Math.sin(s+x*a),u.y=e*Math.cos(s+x*a),u.z=e*Math.sin(r+M*n)*Math.sin(s+x*a),p.push(u.x,u.y,u.z),h.copy(u).normalize(),f.push(h.x,h.y,h.z),v.push(M+w,1-x),m.push(l++)}c.push(m)}for(let g=0;g<i;g++)for(let m=0;m<t;m++){let x=c[g][m+1],w=c[g][m],_=c[g+1][m],M=c[g+1][m+1];(g!==0||s>0)&&d.push(x,w,M),(g!==i-1||o<Math.PI)&&d.push(w,_,M)}this.setIndex(d),this.setAttribute("position",new St(p,3)),this.setAttribute("normal",new St(f,3)),this.setAttribute("uv",new St(v,2))}static fromJSON(e){return new _v(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}},JY=class extends Bt{constructor(e=1,t=.4,i=12,r=48,n=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:r,arc:n},i=Math.floor(i),r=Math.floor(r);let s=[],a=[],o=[],l=[],c=new B,u=new B,h=new B;for(let d=0;d<=i;d++)for(let p=0;p<=r;p++){let f=p/r*n,v=d/i*Math.PI*2;u.x=(e+t*Math.cos(v))*Math.cos(f),u.y=(e+t*Math.cos(v))*Math.sin(f),u.z=t*Math.sin(v),a.push(u.x,u.y,u.z),c.x=e*Math.cos(f),c.y=e*Math.sin(f),h.subVectors(u,c).normalize(),o.push(h.x,h.y,h.z),l.push(p/r),l.push(d/i)}for(let d=1;d<=i;d++)for(let p=1;p<=r;p++){let f=(r+1)*d+p-1,v=(r+1)*(d-1)+p-1,g=(r+1)*(d-1)+p,m=(r+1)*d+p;s.push(f,v,m),s.push(v,g,m)}this.setIndex(s),this.setAttribute("position",new St(a,3)),this.setAttribute("normal",new St(o,3)),this.setAttribute("uv",new St(l,2))}static fromJSON(e){return new JY(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}},eQ=class extends Bt{constructor(e=1,t=.4,i=64,r=8,n=2,s=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:r,p:n,q:s},i=Math.floor(i),r=Math.floor(r);let a=[],o=[],l=[],c=[],u=new B,h=new B,d=new B,p=new B,f=new B,v=new B,g=new B;for(let x=0;x<=i;++x){let w=x/i*n*Math.PI*2;m(w,n,s,e,d),m(w+.01,n,s,e,p),v.subVectors(p,d),g.addVectors(p,d),f.crossVectors(v,g),g.crossVectors(f,v),f.normalize(),g.normalize();for(let _=0;_<=r;++_){let M=_/r*Math.PI*2,S=-t*Math.cos(M),A=t*Math.sin(M);u.x=d.x+(S*g.x+A*f.x),u.y=d.y+(S*g.y+A*f.y),u.z=d.z+(S*g.z+A*f.z),o.push(u.x,u.y,u.z),h.subVectors(u,d).normalize(),l.push(h.x,h.y,h.z),c.push(x/i),c.push(_/r)}}for(let x=1;x<=i;x++)for(let w=1;w<=r;w++){let _=(r+1)*(x-1)+(w-1),M=(r+1)*x+(w-1),S=(r+1)*x+w,A=(r+1)*(x-1)+w;a.push(_,M,A),a.push(M,S,A)}this.setIndex(a),this.setAttribute("position",new St(o,3)),this.setAttribute("normal",new St(l,3)),this.setAttribute("uv",new St(c,2));function m(x,w,_,M,S){let A=Math.cos(x),T=Math.sin(x),E=_/w*x,C=Math.cos(E);S.x=M*(2+C)*.5*A,S.y=M*(2+C)*T*.5,S.z=M*Math.sin(E)*.5}}static fromJSON(e){return new eQ(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}};function Fh(e,t,i){return tQ(e)?new e.constructor(e.subarray(t,i!==void 0?i:e.length)):e.slice(t,i)}function q_(e,t,i){return!e||e.constructor===t?e:typeof t.BYTES_PER_ELEMENT=="number"?new t(e):Array.prototype.slice.call(e)}function tQ(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function ype(e){function t(n,s){return e[n]-e[s]}let i=e.length,r=new Array(i);for(let n=0;n!==i;++n)r[n]=n;return r.sort(t),r}function cH(e,t,i){let r=e.length,n=new e.constructor(r);for(let s=0,a=0;a!==r;++s){let o=i[s]*t;for(let l=0;l!==t;++l)n[a++]=e[o+l]}return n}function iQ(e,t,i,r){let n=1,s=e[0];for(;s!==void 0&&s[r]===void 0;)s=e[n++];if(s===void 0)return;let a=s[r];if(a!==void 0)if(Array.isArray(a))do a=s[r],a!==void 0&&(t.push(s.time),i.push.apply(i,a)),s=e[n++];while(s!==void 0);else if(a.toArray!==void 0)do a=s[r],a!==void 0&&(t.push(s.time),a.toArray(i,i.length)),s=e[n++];while(s!==void 0);else do a=s[r],a!==void 0&&(t.push(s.time),i.push(a)),s=e[n++];while(s!==void 0)}var AT=class{constructor(e,t,i,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=r!==void 0?r:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){let t=this.parameterPositions,i=this._cachedIndex,r=t[i],n=t[i-1];e:{t:{let s;i:{r:if(!(e<r)){for(let a=i+2;;){if(r===void 0){if(e<n)break r;return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===a)break;if(n=r,r=t[++i],e<r)break t}s=t.length;break i}if(!(e>=n)){let a=t[1];e<a&&(i=2,n=a);for(let o=i-2;;){if(n===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===o)break;if(r=n,n=t[--i-1],e>=n)break t}s=i,i=0;break i}break e}for(;i<s;){let a=i+s>>>1;e<t[a]?s=a:i=a+1}if(r=t[i],n=t[i-1],n===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===void 0)return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,n,r)}return this.interpolate_(i,n,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){let t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,n=e*r;for(let s=0;s!==r;++s)t[s]=i[n+s];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}},xpe=class extends AT{constructor(e,t,i,r){super(e,t,i,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:tv,endingEnd:tv}}intervalChanged_(e,t,i){let r=this.parameterPositions,n=e-2,s=e+1,a=r[n],o=r[s];if(a===void 0)switch(this.getSettings_().endingStart){case iv:n=e,a=2*t-i;break;case vA:n=r.length-2,a=t+r[n]-r[n+1];break;default:n=e,a=i}if(o===void 0)switch(this.getSettings_().endingEnd){case iv:s=e,o=2*i-t;break;case vA:s=1,o=i+r[1]-r[0];break;default:s=e-1,o=t}let l=(i-t)*.5,c=this.valueSize;this._weightPrev=l/(t-a),this._weightNext=l/(o-i),this._offsetPrev=n*c,this._offsetNext=s*c}interpolate_(e,t,i,r){let n=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=e*a,l=o-a,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(i-t)/(r-t),f=p*p,v=f*p,g=-h*v+2*h*f-h*p,m=(1+h)*v+(-1.5-2*h)*f+(-.5+h)*p+1,x=(-1-d)*v+(1.5+d)*f+.5*p,w=d*v-d*f;for(let _=0;_!==a;++_)n[_]=g*s[c+_]+m*s[l+_]+x*s[o+_]+w*s[u+_];return n}},rQ=class extends AT{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){let n=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=e*a,l=o-a,c=(i-t)/(r-t),u=1-c;for(let h=0;h!==a;++h)n[h]=s[l+h]*u+s[o+h]*c;return n}},wpe=class extends AT{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e){return this.copySampleValue_(e-1)}},Kc=class{constructor(e,t,i,r){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=q_(t,this.TimeBufferType),this.values=q_(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){let t=e.constructor,i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:q_(e.times,Array),values:q_(e.values,Array)};let r=e.getInterpolation();r!==e.DefaultInterpolation&&(i.interpolation=r)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new wpe(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new rQ(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new xpe(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case mA:t=this.InterpolantFactoryMethodDiscrete;break;case gA:t=this.InterpolantFactoryMethodLinear;break;case CD:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){let i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return mA;case this.InterpolantFactoryMethodLinear:return gA;case this.InterpolantFactoryMethodSmooth:return CD}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){let t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]+=e}return this}scale(e){if(e!==1){let t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]*=e}return this}trim(e,t){let i=this.times,r=i.length,n=0,s=r-1;for(;n!==r&&i[n]<e;)++n;for(;s!==-1&&i[s]>t;)--s;if(++s,n!==0||s!==r){n>=s&&(s=Math.max(s,1),n=s-1);let a=this.getValueSize();this.times=Fh(i,n,s),this.values=Fh(this.values,n*a,s*a)}return this}validate(){let e=!0,t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);let i=this.times,r=this.values,n=i.length;n===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let s=null;for(let a=0;a!==n;a++){let o=i[a];if(typeof o=="number"&&isNaN(o)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,o),e=!1;break}if(s!==null&&s>o){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,o,s),e=!1;break}s=o}if(r!==void 0&&tQ(r))for(let a=0,o=r.length;a!==o;++a){let l=r[a];if(isNaN(l)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,l),e=!1;break}}return e}optimize(){let e=Fh(this.times),t=Fh(this.values),i=this.getValueSize(),r=this.getInterpolation()===CD,n=e.length-1,s=1;for(let a=1;a<n;++a){let o=!1,l=e[a],c=e[a+1];if(l!==c&&(a!==1||l!==e[0]))if(r)o=!0;else{let u=a*i,h=u-i,d=u+i;for(let p=0;p!==i;++p){let f=t[u+p];if(f!==t[h+p]||f!==t[d+p]){o=!0;break}}}if(o){if(a!==s){e[s]=e[a];let u=a*i,h=s*i;for(let d=0;d!==i;++d)t[h+d]=t[u+d]}++s}}if(n>0){e[s]=e[n];for(let a=n*i,o=s*i,l=0;l!==i;++l)t[o+l]=t[a+l];++s}return s!==e.length?(this.times=Fh(e,0,s),this.values=Fh(t,0,s*i)):(this.times=e,this.values=t),this}clone(){let e=Fh(this.times,0),t=Fh(this.values,0),i=this.constructor,r=new i(this.name,e,t);return r.createInterpolant=this.createInterpolant,r}};Kc.prototype.TimeBufferType=Float32Array;Kc.prototype.ValueBufferType=Float32Array;Kc.prototype.DefaultInterpolation=gA;var E0=class extends Kc{};E0.prototype.ValueTypeName="bool";E0.prototype.ValueBufferType=Array;E0.prototype.DefaultInterpolation=mA;E0.prototype.InterpolantFactoryMethodLinear=void 0;E0.prototype.InterpolantFactoryMethodSmooth=void 0;var nQ=class extends Kc{};nQ.prototype.ValueTypeName="color";var SA=class extends Kc{};SA.prototype.ValueTypeName="number";var bpe=class extends AT{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){let n=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=(i-t)/(r-t),l=e*a;for(let c=l+a;l!==c;l+=4)ei.slerpFlat(n,0,s,l-a,s,l,o);return n}},Nw=class extends Kc{InterpolantFactoryMethodLinear(e){return new bpe(this.times,this.values,this.getValueSize(),e)}};Nw.prototype.ValueTypeName="quaternion";Nw.prototype.DefaultInterpolation=gA;Nw.prototype.InterpolantFactoryMethodSmooth=void 0;var A0=class extends Kc{};A0.prototype.ValueTypeName="string";A0.prototype.ValueBufferType=Array;A0.prototype.DefaultInterpolation=mA;A0.prototype.InterpolantFactoryMethodLinear=void 0;A0.prototype.InterpolantFactoryMethodSmooth=void 0;var MA=class extends Kc{};MA.prototype.ValueTypeName="vector";var FL=class{constructor(e,t=-1,i,r=uB){this.name=e,this.tracks=i,this.duration=t,this.blendMode=r,this.uuid=$o(),this.duration<0&&this.resetDuration()}static parse(e){let t=[],i=e.tracks,r=1/(e.fps||1);for(let s=0,a=i.length;s!==a;++s)t.push(Spe(i[s]).scale(r));let n=new this(e.name,e.duration,t,e.blendMode);return n.uuid=e.uuid,n}static toJSON(e){let t=[],i=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let n=0,s=i.length;n!==s;++n)t.push(Kc.toJSON(i[n]));return r}static CreateFromMorphTargetSequence(e,t,i,r){let n=t.length,s=[];for(let a=0;a<n;a++){let o=[],l=[];o.push((a+n-1)%n,a,(a+1)%n),l.push(0,1,0);let c=ype(o);o=cH(o,1,c),l=cH(l,1,c),!r&&o[0]===0&&(o.push(n),l.push(l[0])),s.push(new SA(".morphTargetInfluences["+t[a].name+"]",o,l).scale(1/i))}return new this(e,-1,s)}static findByName(e,t){let i=e;if(!Array.isArray(e)){let r=e;i=r.geometry&&r.geometry.animations||r.animations}for(let r=0;r<i.length;r++)if(i[r].name===t)return i[r];return null}static CreateClipsFromMorphTargetSequences(e,t,i){let r={},n=/^([\w-]*?)([\d]+)$/;for(let a=0,o=e.length;a<o;a++){let l=e[a],c=l.name.match(n);if(c&&c.length>1){let u=c[1],h=r[u];h||(r[u]=h=[]),h.push(l)}}let s=[];for(let a in r)s.push(this.CreateFromMorphTargetSequence(a,r[a],t,i));return s}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;let i=function(c,u,h,d,p){if(h.length!==0){let f=[],v=[];iQ(h,f,v,d),f.length!==0&&p.push(new c(u,f,v))}},r=[],n=e.name||"default",s=e.fps||30,a=e.blendMode,o=e.length||-1,l=e.hierarchy||[];for(let c=0;c<l.length;c++){let u=l[c].keys;if(!(!u||u.length===0))if(u[0].morphTargets){let h={},d;for(d=0;d<u.length;d++)if(u[d].morphTargets)for(let p=0;p<u[d].morphTargets.length;p++)h[u[d].morphTargets[p]]=-1;for(let p in h){let f=[],v=[];for(let g=0;g!==u[d].morphTargets.length;++g){let m=u[d];f.push(m.time),v.push(m.morphTarget===p?1:0)}r.push(new SA(".morphTargetInfluence["+p+"]",f,v))}o=h.length*s}else{let h=".bones["+t[c].name+"]";i(MA,h+".position",u,"pos",r),i(Nw,h+".quaternion",u,"rot",r),i(MA,h+".scale",u,"scl",r)}}return r.length===0?null:new this(n,o,r,a)}resetDuration(){let e=this.tracks,t=0;for(let i=0,r=e.length;i!==r;++i){let n=this.tracks[i];t=Math.max(t,n.times[n.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){let e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}};function _pe(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return SA;case"vector":case"vector2":case"vector3":case"vector4":return MA;case"color":return nQ;case"quaternion":return Nw;case"bool":case"boolean":return E0;case"string":return A0}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}function Spe(e){if(e.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");let t=_pe(e.type);if(e.times===void 0){let i=[],r=[];iQ(e.keys,i,r,"value"),e.times=i,e.values=r}return t.parse!==void 0?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}var EA={enabled:!1,files:{},add:function(e,t){this.enabled!==!1&&(this.files[e]=t)},get:function(e){if(this.enabled!==!1)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},sQ=class{constructor(e,t,i){let r=this,n=!1,s=0,a=0,o,l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(c){a++,n===!1&&r.onStart!==void 0&&r.onStart(c,s,a),n=!0},this.itemEnd=function(c){s++,r.onProgress!==void 0&&r.onProgress(c,s,a),s===a&&(n=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(c){r.onError!==void 0&&r.onError(c)},this.resolveURL=function(c){return o?o(c):c},this.setURLModifier=function(c){return o=c,this},this.addHandler=function(c,u){return l.push(c,u),this},this.removeHandler=function(c){let u=l.indexOf(c);return u!==-1&&l.splice(u,2),this},this.getHandler=function(c){for(let u=0,h=l.length;u<h;u+=2){let d=l[u],p=l[u+1];if(d.global&&(d.lastIndex=0),d.test(c))return p}return null}}},Mpe=new sQ,Bw=class{constructor(e){this.manager=e!==void 0?e:Mpe,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){let i=this;return new Promise(function(r,n){i.load(e,r,t,n)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}},pu={},Epe=class extends Error{constructor(e,t){super(e),this.response=t}},VL=class extends Bw{constructor(e){super(e)}load(e,t,i,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);let n=EA.get(e);if(n!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(n),this.manager.itemEnd(e)},0),n;if(pu[e]!==void 0){pu[e].push({onLoad:t,onProgress:i,onError:r});return}pu[e]=[],pu[e].push({onLoad:t,onProgress:i,onError:r});let s=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,o=this.responseType;fetch(s).then(l=>{if(l.status===200||l.status===0){if(l.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||l.body===void 0||l.body.getReader===void 0)return l;let c=pu[e],u=l.body.getReader(),h=l.headers.get("Content-Length")||l.headers.get("X-File-Size"),d=h?parseInt(h):0,p=d!==0,f=0,v=new ReadableStream({start(g){m();function m(){u.read().then(({done:x,value:w})=>{if(x)g.close();else{f+=w.byteLength;let _=new ProgressEvent("progress",{lengthComputable:p,loaded:f,total:d});for(let M=0,S=c.length;M<S;M++){let A=c[M];A.onProgress&&A.onProgress(_)}g.enqueue(w),m()}})}}});return new Response(v)}else throw new Epe(`fetch for "${l.url}" responded with ${l.status}: ${l.statusText}`,l)}).then(l=>{switch(o){case"arraybuffer":return l.arrayBuffer();case"blob":return l.blob();case"document":return l.text().then(c=>new DOMParser().parseFromString(c,a));case"json":return l.json();default:if(a===void 0)return l.text();{let c=/charset="?([^;"\s]*)"?/i.exec(a),u=c&&c[1]?c[1].toLowerCase():void 0,h=new TextDecoder(u);return l.arrayBuffer().then(d=>h.decode(d))}}}).then(l=>{EA.add(e,l);let c=pu[e];delete pu[e];for(let u=0,h=c.length;u<h;u++){let d=c[u];d.onLoad&&d.onLoad(l)}}).catch(l=>{let c=pu[e];if(c===void 0)throw this.manager.itemError(e),l;delete pu[e];for(let u=0,h=c.length;u<h;u++){let d=c[u];d.onError&&d.onError(l)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}},Ape=class extends Bw{constructor(e){super(e)}load(e,t,i,r){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);let n=this,s=EA.get(e);if(s!==void 0)return n.manager.itemStart(e),setTimeout(function(){t&&t(s),n.manager.itemEnd(e)},0),s;let a=I1("img");function o(){c(),EA.add(e,this),t&&t(this),n.manager.itemEnd(e)}function l(u){c(),r&&r(u),n.manager.itemError(e),n.manager.itemEnd(e)}function c(){a.removeEventListener("load",o,!1),a.removeEventListener("error",l,!1)}return a.addEventListener("load",o,!1),a.addEventListener("error",l,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),n.manager.itemStart(e),a.src=e,a}},Cpe=class extends Bw{constructor(e){super(e)}load(e,t,i,r){let n=new Br,s=new Ape(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(e,function(a){n.image=a,n.needsUpdate=!0,t!==void 0&&t(n)},i,r),n}},kw=class extends ir{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new jt(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){let t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}},Tpe=class extends kw{constructor(e,t,i){super(e,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(ir.DEFAULT_UP),this.updateMatrix(),this.groundColor=new jt(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}},r3=new ht,uH=new B,hH=new B,_B=class{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new ve(512,512),this.map=null,this.mapPass=null,this.matrix=new ht,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new fB,this._frameExtents=new ve(1,1),this._viewportCount=1,this._viewports=[new ti(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){let t=this.camera,i=this.matrix;uH.setFromMatrixPosition(e.matrixWorld),t.position.copy(uH),hH.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(hH),t.updateMatrixWorld(),r3.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(r3),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(r3)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){let e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}},Ppe=class extends _B{constructor(){super(new Gs(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){let t=this.camera,i=R1*2*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,n=e.distance||t.far;(i!==t.fov||r!==t.aspect||n!==t.far)&&(t.fov=i,t.aspect=r,t.far=n,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}},Dpe=class extends kw{constructor(t,i,r=0,n=Math.PI/3,s=0,a=2){super(t,i),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(ir.DEFAULT_UP),this.updateMatrix(),this.target=new ir,this.distance=r,this.angle=n,this.penumbra=s,this.decay=a,this.map=null,this.shadow=new Ppe}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t,i){return super.copy(t,i),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}},dH=new ht,Cy=new B,n3=new B,Rpe=class extends _B{constructor(){super(new Gs(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new ve(4,2),this._viewportCount=6,this._viewports=[new ti(2,1,1,1),new ti(0,1,1,1),new ti(3,1,1,1),new ti(1,1,1,1),new ti(3,0,1,1),new ti(1,0,1,1)],this._cubeDirections=[new B(1,0,0),new B(-1,0,0),new B(0,0,1),new B(0,0,-1),new B(0,1,0),new B(0,-1,0)],this._cubeUps=[new B(0,1,0),new B(0,1,0),new B(0,1,0),new B(0,1,0),new B(0,0,1),new B(0,0,-1)]}updateMatrices(e,t=0){let i=this.camera,r=this.matrix,n=e.distance||i.far;n!==i.far&&(i.far=n,i.updateProjectionMatrix()),Cy.setFromMatrixPosition(e.matrixWorld),i.position.copy(Cy),n3.copy(i.position),n3.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(n3),i.updateMatrixWorld(),r.makeTranslation(-Cy.x,-Cy.y,-Cy.z),dH.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(dH)}},Ipe=class extends kw{constructor(e,t,i=0,r=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=r,this.shadow=new Rpe}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}},Lpe=class extends _B{constructor(){super(new _T(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}},Ope=class extends kw{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(ir.DEFAULT_UP),this.updateMatrix(),this.target=new ir,this.shadow=new Lpe}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}},aQ=class extends Bt{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){let e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}},oQ=class extends Bw{constructor(e){super(e)}load(e,t,i,r){let n=this,s=new VL(n.manager);s.setPath(n.path),s.setRequestHeader(n.requestHeader),s.setWithCredentials(n.withCredentials),s.load(e,function(a){try{t(n.parse(JSON.parse(a)))}catch(o){r?r(o):console.error(o),n.manager.itemError(e)}},i,r)}parse(e){let t={},i={};function r(h,d){if(t[d]!==void 0)return t[d];let p=h.interleavedBuffers[d],f=n(h,p.buffer),v=S_(p.type,f),g=new kde(v,p.stride);return g.uuid=p.uuid,t[d]=g,g}function n(h,d){if(i[d]!==void 0)return i[d];let p=h.arrayBuffers[d],f=new Uint32Array(p).buffer;return i[d]=f,f}let s=e.isInstancedBufferGeometry?new aQ:new Bt,a=e.data.index;if(a!==void 0){let h=S_(a.type,a.array);s.setIndex(new $t(h,1))}let o=e.data.attributes;for(let h in o){let d=o[h],p;if(d.isInterleavedBufferAttribute){let f=r(e.data,d.data);p=new BL(f,d.itemSize,d.offset,d.normalized)}else{let f=S_(d.type,d.array),v=d.isInstancedBufferAttribute?L1:$t;p=new v(f,d.itemSize,d.normalized)}d.name!==void 0&&(p.name=d.name),d.usage!==void 0&&p.setUsage(d.usage),d.updateRange!==void 0&&(p.updateRange.offset=d.updateRange.offset,p.updateRange.count=d.updateRange.count),s.setAttribute(h,p)}let l=e.data.morphAttributes;if(l)for(let h in l){let d=l[h],p=[];for(let f=0,v=d.length;f<v;f++){let g=d[f],m;if(g.isInterleavedBufferAttribute){let x=r(e.data,g.data);m=new BL(x,g.itemSize,g.offset,g.normalized)}else{let x=S_(g.type,g.array);m=new $t(x,g.itemSize,g.normalized)}g.name!==void 0&&(m.name=g.name),p.push(m)}s.morphAttributes[h]=p}e.data.morphTargetsRelative&&(s.morphTargetsRelative=!0);let c=e.data.groups||e.data.drawcalls||e.data.offsets;if(c!==void 0)for(let h=0,d=c.length;h!==d;++h){let p=c[h];s.addGroup(p.start,p.count,p.materialIndex)}let u=e.data.boundingSphere;if(u!==void 0){let h=new B;u.center!==void 0&&h.fromArray(u.center),s.boundingSphere=new ja(h,u.radius)}return e.name&&(s.name=e.name),e.userData&&(s.userData=e.userData),s}},zpe=class{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=pH(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){let t=pH();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}};function pH(){return(typeof performance>"u"?Date:performance).now()}var Npe=class{constructor(e,t,i){this.binding=e,this.valueSize=i;let r,n,s;switch(t){case"quaternion":r=this._slerp,n=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(i*6),this._workIndex=5;break;case"string":case"bool":r=this._select,n=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(i*5);break;default:r=this._lerp,n=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(i*5)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=n,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){let i=this.buffer,r=this.valueSize,n=e*r+r,s=this.cumulativeWeight;if(s===0){for(let a=0;a!==r;++a)i[n+a]=i[a];s=t}else{s+=t;let a=t/s;this._mixBufferRegion(i,n,0,a,r)}this.cumulativeWeight=s}accumulateAdditive(e){let t=this.buffer,i=this.valueSize,r=i*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,r,0,e,i),this.cumulativeWeightAdditive+=e}apply(e){let t=this.valueSize,i=this.buffer,r=e*t+t,n=this.cumulativeWeight,s=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,n<1){let o=t*this._origIndex;this._mixBufferRegion(i,r,o,1-n,t)}s>0&&this._mixBufferRegionAdditive(i,r,this._addIndex*t,1,t);for(let o=t,l=t+t;o!==l;++o)if(i[o]!==i[o+t]){a.setValue(i,r);break}}saveOriginalState(){let e=this.binding,t=this.buffer,i=this.valueSize,r=i*this._origIndex;e.getValue(t,r);for(let n=i,s=r;n!==s;++n)t[n]=t[r+n%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){let e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){let e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let i=e;i<t;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){let e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[t+i]=this.buffer[e+i]}_select(e,t,i,r,n){if(r>=.5)for(let s=0;s!==n;++s)e[t+s]=e[i+s]}_slerp(e,t,i,r){ei.slerpFlat(e,t,e,t,e,i,r)}_slerpAdditive(e,t,i,r,n){let s=this._workIndex*n;ei.multiplyQuaternionsFlat(e,s,e,t,e,i),ei.slerpFlat(e,t,e,t,e,s,r)}_lerp(e,t,i,r,n){let s=1-r;for(let a=0;a!==n;++a){let o=t+a;e[o]=e[o]*s+e[i+a]*r}}_lerpAdditive(e,t,i,r,n){for(let s=0;s!==n;++s){let a=t+s;e[a]=e[a]+e[i+s]*r}}},SB="\\[\\]\\.:\\/",Bpe=new RegExp("["+SB+"]","g"),MB="[^"+SB+"]",kpe="[^"+SB.replace("\\.","")+"]",Upe=/((?:WC+[\/:])*)/.source.replace("WC",MB),Fpe=/(WCOD+)?/.source.replace("WCOD",kpe),Vpe=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",MB),Hpe=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",MB),Gpe=new RegExp("^"+Upe+Fpe+Vpe+Hpe+"$"),jpe=["material","materials","bones","map"],Wpe=class{constructor(e,t,i){let r=i||cr.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();let i=this._targetGroup.nCachedObjects_,r=this._bindings[i];r!==void 0&&r.getValue(e,t)}setValue(e,t){let i=this._bindings;for(let r=this._targetGroup.nCachedObjects_,n=i.length;r!==n;++r)i[r].setValue(e,t)}bind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}},cr=class{constructor(e,t,i){this.path=t,this.parsedPath=i||cr.parseTrackName(t),this.node=cr.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,i){return e&&e.isAnimationObjectGroup?new cr.Composite(e,t,i):new cr(e,t,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(Bpe,"")}static parseTrackName(e){let t=Gpe.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);let i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=i.nodeName&&i.nodeName.lastIndexOf(".");if(r!==void 0&&r!==-1){let n=i.nodeName.substring(r+1);jpe.indexOf(n)!==-1&&(i.nodeName=i.nodeName.substring(0,r),i.objectName=n)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){let i=e.skeleton.getBoneByName(t);if(i!==void 0)return i}if(e.children){let i=function(n){for(let s=0;s<n.length;s++){let a=n[s];if(a.name===t||a.uuid===t)return a;let o=i(a.children);if(o)return o}return null},r=i(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){let i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)e[t++]=i[r]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){let i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)i[r]=e[t++]}_setValue_array_setNeedsUpdate(e,t){let i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)i[r]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){let i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)i[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node,t=this.parsedPath,i=t.objectName,r=t.propertyName,n=t.propertyIndex;if(e||(e=cr.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(i){let l=t.objectIndex;switch(i){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let c=0;c<e.length;c++)if(e[c].name===l){l=c;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[i]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[i]}if(l!==void 0){if(e[l]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[l]}}let s=e[r];if(s===void 0){let l=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+l+"."+r+" but it wasn't found.",e);return}let a=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?a=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let o=this.BindingType.Direct;if(n!==void 0){if(r==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[n]!==void 0&&(n=e.morphTargetDictionary[n])}o=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=n}else s.fromArray!==void 0&&s.toArray!==void 0?(o=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(o=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=r;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}};cr.Composite=Wpe;cr.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};cr.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};cr.prototype.GetterByBindingType=[cr.prototype._getValue_direct,cr.prototype._getValue_array,cr.prototype._getValue_arrayElement,cr.prototype._getValue_toArray];cr.prototype.SetterByBindingTypeAndVersioning=[[cr.prototype._setValue_direct,cr.prototype._setValue_direct_setNeedsUpdate,cr.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[cr.prototype._setValue_array,cr.prototype._setValue_array_setNeedsUpdate,cr.prototype._setValue_array_setMatrixWorldNeedsUpdate],[cr.prototype._setValue_arrayElement,cr.prototype._setValue_arrayElement_setNeedsUpdate,cr.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[cr.prototype._setValue_fromArray,cr.prototype._setValue_fromArray_setNeedsUpdate,cr.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];var Xpe=class{constructor(e,t,i=null,r=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=i,this.blendMode=r;let n=t.tracks,s=n.length,a=new Array(s),o={endingStart:tv,endingEnd:tv};for(let l=0;l!==s;++l){let c=n[l].createInterpolant(null);a[l]=c,c.settings=o}this._interpolantSettings=o,this._interpolants=a,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=EY,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){let r=this._clip.duration,n=e._clip.duration,s=n/r,a=r/n;e.warp(1,s,t),this.warp(a,1,t)}return this}crossFadeTo(e,t,i){return e.crossFadeFrom(this,t,i)}stopFading(){let e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,i){let r=this._mixer,n=r.time,s=this.timeScale,a=this._timeScaleInterpolant;a===null&&(a=r._lendControlInterpolant(),this._timeScaleInterpolant=a);let o=a.parameterPositions,l=a.sampleValues;return o[0]=n,o[1]=n+i,l[0]=e/s,l[1]=t/s,this}stopWarping(){let e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,i,r){if(!this.enabled){this._updateWeight(e);return}let n=this._startTime;if(n!==null){let o=(e-n)*i;o<0||i===0?t=0:(this._startTime=null,t=i*o)}t*=this._updateTimeScale(e);let s=this._updateTime(t),a=this._updateWeight(e);if(a>0){let o=this._interpolants,l=this._propertyBindings;switch(this.blendMode){case _oe:for(let c=0,u=o.length;c!==u;++c)o[c].evaluate(s),l[c].accumulateAdditive(a);break;case uB:default:for(let c=0,u=o.length;c!==u;++c)o[c].evaluate(s),l[c].accumulate(r,a)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;let i=this._weightInterpolant;if(i!==null){let r=i.evaluate(e)[0];t*=r,e>i.parameterPositions[1]&&(this.stopFading(),r===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;let i=this._timeScaleInterpolant;if(i!==null){let r=i.evaluate(e)[0];t*=r,e>i.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){let t=this._clip.duration,i=this.loop,r=this.time+e,n=this._loopCount,s=i===cB;if(e===0)return n===-1?r:s&&(n&1)===1?t-r:r;if(i===MY){n===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=t)r=t;else if(r<0)r=0;else{this.time=r;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(n===-1&&(e>=0?(n=0,this._setEndings(!0,this.repetitions===0,s)):this._setEndings(this.repetitions===0,!0,s)),r>=t||r<0){let a=Math.floor(r/t);r-=t*a,n+=Math.abs(a);let o=this.repetitions-n;if(o<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?t:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(o===1){let l=e<0;this._setEndings(l,!l,s)}else this._setEndings(!1,!1,s);this._loopCount=n,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=r;if(s&&(n&1)===1)return t-r}return r}_setEndings(e,t,i){let r=this._interpolantSettings;i?(r.endingStart=iv,r.endingEnd=iv):(e?r.endingStart=this.zeroSlopeAtStart?iv:tv:r.endingStart=vA,t?r.endingEnd=this.zeroSlopeAtEnd?iv:tv:r.endingEnd=vA)}_scheduleFading(e,t,i){let r=this._mixer,n=r.time,s=this._weightInterpolant;s===null&&(s=r._lendControlInterpolant(),this._weightInterpolant=s);let a=s.parameterPositions,o=s.sampleValues;return a[0]=n,o[0]=t,a[1]=n+e,o[1]=i,this}},qpe=new Float32Array(1),Ype=class extends Cs{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){let i=e._localRoot||this._root,r=e._clip.tracks,n=r.length,s=e._propertyBindings,a=e._interpolants,o=i.uuid,l=this._bindingsByRootAndName,c=l[o];c===void 0&&(c={},l[o]=c);for(let u=0;u!==n;++u){let h=r[u],d=h.name,p=c[d];if(p!==void 0)++p.referenceCount,s[u]=p;else{if(p=s[u],p!==void 0){p._cacheIndex===null&&(++p.referenceCount,this._addInactiveBinding(p,o,d));continue}let f=t&&t._propertyBindings[u].binding.parsedPath;p=new Npe(cr.create(i,d,f),h.ValueTypeName,h.getValueSize()),++p.referenceCount,this._addInactiveBinding(p,o,d),s[u]=p}a[u].resultBuffer=p.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){let i=(e._localRoot||this._root).uuid,r=e._clip.uuid,n=this._actionsByClip[r];this._bindAction(e,n&&n.knownActions[0]),this._addInactiveAction(e,r,i)}let t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){let n=t[i];n.useCount++===0&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){let t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){let n=t[i];--n.useCount===0&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;let e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){let t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,i){let r=this._actions,n=this._actionsByClip,s=n[t];if(s===void 0)s={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,n[t]=s;else{let a=s.knownActions;e._byClipCacheIndex=a.length,a.push(e)}e._cacheIndex=r.length,r.push(e),s.actionByRoot[i]=e}_removeInactiveAction(e){let t=this._actions,i=t[t.length-1],r=e._cacheIndex;i._cacheIndex=r,t[r]=i,t.pop(),e._cacheIndex=null;let n=e._clip.uuid,s=this._actionsByClip,a=s[n],o=a.knownActions,l=o[o.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,o[c]=l,o.pop(),e._byClipCacheIndex=null;let u=a.actionByRoot,h=(e._localRoot||this._root).uuid;delete u[h],o.length===0&&delete s[n],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){let t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){let n=t[i];--n.referenceCount===0&&this._removeInactiveBinding(n)}}_lendAction(e){let t=this._actions,i=e._cacheIndex,r=this._nActiveActions++,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n}_takeBackAction(e){let t=this._actions,i=e._cacheIndex,r=--this._nActiveActions,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n}_addInactiveBinding(e,t,i){let r=this._bindingsByRootAndName,n=this._bindings,s=r[t];s===void 0&&(s={},r[t]=s),s[i]=e,e._cacheIndex=n.length,n.push(e)}_removeInactiveBinding(e){let t=this._bindings,i=e.binding,r=i.rootNode.uuid,n=i.path,s=this._bindingsByRootAndName,a=s[r],o=t[t.length-1],l=e._cacheIndex;o._cacheIndex=l,t[l]=o,t.pop(),delete a[n],Object.keys(a).length===0&&delete s[r]}_lendBinding(e){let t=this._bindings,i=e._cacheIndex,r=this._nActiveBindings++,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n}_takeBackBinding(e){let t=this._bindings,i=e._cacheIndex,r=--this._nActiveBindings,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n}_lendControlInterpolant(){let e=this._controlInterpolants,t=this._nActiveControlInterpolants++,i=e[t];return i===void 0&&(i=new rQ(new Float32Array(2),new Float32Array(2),1,qpe),i.__cacheIndex=t,e[t]=i),i}_takeBackControlInterpolant(e){let t=this._controlInterpolants,i=e.__cacheIndex,r=--this._nActiveControlInterpolants,n=t[r];e.__cacheIndex=r,t[r]=e,n.__cacheIndex=i,t[i]=n}clipAction(e,t,i){let r=t||this._root,n=r.uuid,s=typeof e=="string"?FL.findByName(r,e):e,a=s!==null?s.uuid:e,o=this._actionsByClip[a],l=null;if(i===void 0&&(s!==null?i=s.blendMode:i=uB),o!==void 0){let u=o.actionByRoot[n];if(u!==void 0&&u.blendMode===i)return u;l=o.knownActions[0],s===null&&(s=l._clip)}if(s===null)return null;let c=new Xpe(this,s,t,i);return this._bindAction(c,l),this._addInactiveAction(c,a,n),c}existingAction(e,t){let i=t||this._root,r=i.uuid,n=typeof e=="string"?FL.findByName(i,e):e,s=n?n.uuid:e,a=this._actionsByClip[s];return a!==void 0&&a.actionByRoot[r]||null}stopAllAction(){let e=this._actions,t=this._nActiveActions;for(let i=t-1;i>=0;--i)e[i].stop();return this}update(e){e*=this.timeScale;let t=this._actions,i=this._nActiveActions,r=this.time+=e,n=Math.sign(e),s=this._accuIndex^=1;for(let l=0;l!==i;++l)t[l]._update(r,e,n,s);let a=this._bindings,o=this._nActiveBindings;for(let l=0;l!==o;++l)a[l].apply(s);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){let t=this._actions,i=e.uuid,r=this._actionsByClip,n=r[i];if(n!==void 0){let s=n.knownActions;for(let a=0,o=s.length;a!==o;++a){let l=s[a];this._deactivateAction(l);let c=l._cacheIndex,u=t[t.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,u._cacheIndex=c,t[c]=u,t.pop(),this._removeInactiveBindingsForAction(l)}delete r[i]}}uncacheRoot(e){let t=e.uuid,i=this._actionsByClip;for(let s in i){let a=i[s].actionByRoot,o=a[t];o!==void 0&&(this._deactivateAction(o),this._removeInactiveAction(o))}let r=this._bindingsByRootAndName,n=r[t];if(n!==void 0)for(let s in n){let a=n[s];a.restoreOriginalState(),this._removeInactiveBinding(a)}}uncacheAction(e,t){let i=this.existingAction(e,t);i!==null&&(this._deactivateAction(i),this._removeInactiveAction(i))}},at=class{constructor(t){this.value=t}clone(){return new at(this.value.clone===void 0?this.value:this.value.clone())}},lQ=class{constructor(e,t,i=0,r=1/0){this.ray=new _0(e,t),this.near=i,this.far=r,this.camera=null,this.layers=new dB,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,i=[]){return HL(e,this,i,t),i.sort(fH),i}intersectObjects(e,t=!0,i=[]){for(let r=0,n=e.length;r<n;r++)HL(e[r],this,i,t);return i.sort(fH),i}};function fH(e,t){return e.distance-t.distance}function HL(e,t,i,r){if(e.layers.test(t.layers)&&e.raycast(t,i),r===!0){let n=e.children;for(let s=0,a=n.length;s<a;s++)HL(n[s],t,i,!0)}}var mH=class{constructor(e=1,t=0,i=0){return this.radius=e,this.phi=t,this.theta=i,this}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(vn(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}},gH=new ve,cQ=class{constructor(e=new ve(1/0,1/0),t=new ve(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let i=gH.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return gH.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},vH=new B,Y_=new B,Jo=class{constructor(e=new B,t=new B){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){vH.subVectors(e,this.start),Y_.subVectors(this.end,this.start);let i=Y_.dot(Y_),r=Y_.dot(vH)/i;return t&&(r=vn(r,0,1)),r}closestPointToPoint(e,t,i){let r=this.closestPointToPointParameter(e,t);return this.delta(i).multiplyScalar(r).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}},yH=new B,Qpe=class extends ir{constructor(e,t){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";let i=new Bt,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let s=0,a=1,o=32;s<o;s++,a++){let l=s/o*Math.PI*2,c=a/o*Math.PI*2;r.push(Math.cos(l),Math.sin(l),1,Math.cos(c),Math.sin(c),1)}i.setAttribute("position",new St(r,3));let n=new rp({fog:!1,toneMapped:!1});this.cone=new zw(i,n),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);let e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),yH.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(yH),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},Kpe=class extends zr{constructor(e,t,i){let r=new _v(t,4,2),n=new uh({wireframe:!0,fog:!1,toneMapped:!1});super(r,n),this.light=e,this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},xH=new B,Q_=new B,wH=new B,Zpe=class extends ir{constructor(e,t,i){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="DirectionalLightHelper",t===void 0&&(t=1);let r=new Bt;r.setAttribute("position",new St([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));let n=new rp({fog:!1,toneMapped:!1});this.lightPlane=new wA(r,n),this.add(this.lightPlane),r=new Bt,r.setAttribute("position",new St([0,0,0,0,0,1],3)),this.targetLine=new wA(r,n),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),xH.setFromMatrixPosition(this.light.matrixWorld),Q_.setFromMatrixPosition(this.light.target.matrixWorld),wH.subVectors(Q_,xH),this.lightPlane.lookAt(Q_),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Q_),this.targetLine.scale.z=wH.length()}},K_=new B,Hr=new tm,AA=class extends zw{constructor(e){let t=new Bt,i=new rp({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],n=[],s={};a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4");function a(p,f){o(p),o(f)}function o(p){r.push(0,0,0),n.push(0,0,0),s[p]===void 0&&(s[p]=[]),s[p].push(r.length/3-1)}t.setAttribute("position",new St(r,3)),t.setAttribute("color",new St(n,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update();let l=new jt(16755200),c=new jt(16711680),u=new jt(43775),h=new jt(16777215),d=new jt(3355443);this.setColors(l,c,u,h,d)}setColors(e,t,i,r,n){let s=this.geometry.getAttribute("color");s.setXYZ(0,e.r,e.g,e.b),s.setXYZ(1,e.r,e.g,e.b),s.setXYZ(2,e.r,e.g,e.b),s.setXYZ(3,e.r,e.g,e.b),s.setXYZ(4,e.r,e.g,e.b),s.setXYZ(5,e.r,e.g,e.b),s.setXYZ(6,e.r,e.g,e.b),s.setXYZ(7,e.r,e.g,e.b),s.setXYZ(8,e.r,e.g,e.b),s.setXYZ(9,e.r,e.g,e.b),s.setXYZ(10,e.r,e.g,e.b),s.setXYZ(11,e.r,e.g,e.b),s.setXYZ(12,e.r,e.g,e.b),s.setXYZ(13,e.r,e.g,e.b),s.setXYZ(14,e.r,e.g,e.b),s.setXYZ(15,e.r,e.g,e.b),s.setXYZ(16,e.r,e.g,e.b),s.setXYZ(17,e.r,e.g,e.b),s.setXYZ(18,e.r,e.g,e.b),s.setXYZ(19,e.r,e.g,e.b),s.setXYZ(20,e.r,e.g,e.b),s.setXYZ(21,e.r,e.g,e.b),s.setXYZ(22,e.r,e.g,e.b),s.setXYZ(23,e.r,e.g,e.b),s.setXYZ(24,t.r,t.g,t.b),s.setXYZ(25,t.r,t.g,t.b),s.setXYZ(26,t.r,t.g,t.b),s.setXYZ(27,t.r,t.g,t.b),s.setXYZ(28,t.r,t.g,t.b),s.setXYZ(29,t.r,t.g,t.b),s.setXYZ(30,t.r,t.g,t.b),s.setXYZ(31,t.r,t.g,t.b),s.setXYZ(32,i.r,i.g,i.b),s.setXYZ(33,i.r,i.g,i.b),s.setXYZ(34,i.r,i.g,i.b),s.setXYZ(35,i.r,i.g,i.b),s.setXYZ(36,i.r,i.g,i.b),s.setXYZ(37,i.r,i.g,i.b),s.setXYZ(38,r.r,r.g,r.b),s.setXYZ(39,r.r,r.g,r.b),s.setXYZ(40,n.r,n.g,n.b),s.setXYZ(41,n.r,n.g,n.b),s.setXYZ(42,n.r,n.g,n.b),s.setXYZ(43,n.r,n.g,n.b),s.setXYZ(44,n.r,n.g,n.b),s.setXYZ(45,n.r,n.g,n.b),s.setXYZ(46,n.r,n.g,n.b),s.setXYZ(47,n.r,n.g,n.b),s.setXYZ(48,n.r,n.g,n.b),s.setXYZ(49,n.r,n.g,n.b),s.needsUpdate=!0}update(){let e=this.geometry,t=this.pointMap,i=1,r=1;Hr.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),tn("c",t,e,Hr,0,0,-1),tn("t",t,e,Hr,0,0,1),tn("n1",t,e,Hr,-i,-r,-1),tn("n2",t,e,Hr,i,-r,-1),tn("n3",t,e,Hr,-i,r,-1),tn("n4",t,e,Hr,i,r,-1),tn("f1",t,e,Hr,-i,-r,1),tn("f2",t,e,Hr,i,-r,1),tn("f3",t,e,Hr,-i,r,1),tn("f4",t,e,Hr,i,r,1),tn("u1",t,e,Hr,i*.7,r*1.1,-1),tn("u2",t,e,Hr,-i*.7,r*1.1,-1),tn("u3",t,e,Hr,0,r*2,-1),tn("cf1",t,e,Hr,-i,0,1),tn("cf2",t,e,Hr,i,0,1),tn("cf3",t,e,Hr,0,-r,1),tn("cf4",t,e,Hr,0,r,1),tn("cn1",t,e,Hr,-i,0,-1),tn("cn2",t,e,Hr,i,0,-1),tn("cn3",t,e,Hr,0,-r,-1),tn("cn4",t,e,Hr,0,r,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function tn(e,t,i,r,n,s,a){K_.set(n,s,a).unproject(r);let o=t[e];if(o!==void 0){let l=i.getAttribute("position");for(let c=0,u=o.length;c<u;c++)l.setXYZ(o[c],K_.x,K_.y,K_.z)}}var CA=class extends zw{constructor(e,t=16776960){let i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],n=new Bt;n.setIndex(new $t(i,1)),n.setAttribute("position",new St(r,3)),super(n,new rp({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){let t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}},$pe=class extends zw{constructor(e=1){let t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],i=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],r=new Bt;r.setAttribute("position",new St(t,3)),r.setAttribute("color",new St(i,3));let n=new rp({vertexColors:!0,toneMapped:!1});super(r,n),this.type="AxesHelper"}setColors(e,t,i){let r=new jt,n=this.geometry.attributes.color.array;return r.set(e),r.toArray(n,0),r.toArray(n,3),r.set(t),r.toArray(n,6),r.toArray(n,9),r.set(i),r.toArray(n,12),r.toArray(n,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}},Uu=Jpe();function Jpe(){let e=new ArrayBuffer(4),t=new Float32Array(e),i=new Uint32Array(e),r=new Uint32Array(512),n=new Uint32Array(512);for(let l=0;l<256;++l){let c=l-127;c<-27?(r[l]=0,r[l|256]=32768,n[l]=24,n[l|256]=24):c<-14?(r[l]=1024>>-c-14,r[l|256]=1024>>-c-14|32768,n[l]=-c-1,n[l|256]=-c-1):c<=15?(r[l]=c+15<<10,r[l|256]=c+15<<10|32768,n[l]=13,n[l|256]=13):c<128?(r[l]=31744,r[l|256]=64512,n[l]=24,n[l|256]=24):(r[l]=31744,r[l|256]=64512,n[l]=13,n[l|256]=13)}let s=new Uint32Array(2048),a=new Uint32Array(64),o=new Uint32Array(64);for(let l=1;l<1024;++l){let c=l<<13,u=0;for(;!(c&8388608);)c<<=1,u-=8388608;c&=-8388609,u+=947912704,s[l]=c|u}for(let l=1024;l<2048;++l)s[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)a[l]=l<<23;a[31]=1199570944,a[32]=2147483648;for(let l=33;l<63;++l)a[l]=2147483648+(l-32<<23);a[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(o[l]=1024);return{floatView:t,uint32View:i,baseTable:r,shiftTable:n,mantissaTable:s,exponentTable:a,offsetTable:o}}function efe(e){Math.abs(e)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),e=vn(e,-65504,65504),Uu.floatView[0]=e;let t=Uu.uint32View[0],i=t>>23&511;return Uu.baseTable[i]+((t&8388607)>>Uu.shiftTable[i])}function tfe(e){let t=e>>10;return Uu.uint32View[0]=Uu.mantissaTable[Uu.offsetTable[t]+(e&1023)]+Uu.exponentTable[t],Uu.floatView[0]}var ife=Object.freeze({__proto__:null,fromHalfFloat:tfe,toHalfFloat:efe});typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:b0}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=b0);var Ty=".",EB=Symbol("target"),uQ=Symbol("unsubscribe");function GL(e){return e instanceof Date||e instanceof Set||e instanceof Map||e instanceof WeakSet||e instanceof WeakMap||ArrayBuffer.isView(e)}function rfe(e){return(typeof e=="object"?e===null:typeof e!="function")||e instanceof RegExp}var Cc=Array.isArray;function AB(e){return typeof e=="symbol"}var nfe={after:(e,t)=>Cc(e)?e.slice(t.length):t===""?e:e.slice(t.length+1),concat:(e,t)=>Cc(e)?(e=[...e],t&&e.push(t),e):t&&t.toString!==void 0?(e!==""&&(e+=Ty),AB(t)?e+t.toString():e+t):e,initial:e=>{if(Cc(e))return e.slice(0,-1);if(e==="")return e;let t=e.lastIndexOf(Ty);return t===-1?"":e.slice(0,t)},last:e=>{if(Cc(e))return e[e.length-1]||"";if(e==="")return e;let t=e.lastIndexOf(Ty);return t===-1?e:e.slice(t+1)},walk:(e,t)=>{if(Cc(e))for(let i of e)t(i);else if(e!==""){let i=0,r=e.indexOf(Ty);if(r===-1)t(e);else for(;i<e.length;)r===-1&&(r=e.length),t(e.slice(i,r)),i=r+1,r=e.indexOf(Ty,i)}},get(e,t){return this.walk(t,i=>{e&&(e=e[i])}),e}},ko=nfe;function sfe(e){return typeof e=="object"&&typeof e.next=="function"}function afe(e,t,i,r,n){let s=e.next;if(t.name==="entries")e.next=function(){let a=s.call(this);return a.done===!1&&(a.value[0]=n(a.value[0],t,a.value[0],r),a.value[1]=n(a.value[1],t,a.value[0],r)),a};else if(t.name==="values"){let a=i[EB].keys();e.next=function(){let o=s.call(this);return o.done===!1&&(o.value=n(o.value,t,a.next().value,r)),o}}else e.next=function(){let a=s.call(this);return a.done===!1&&(a.value=n(a.value,t,a.value,r)),a};return e}function bH(e,t,i){return e.isUnsubscribed||t.ignoreSymbols&&AB(i)||t.ignoreUnderscores&&i.charAt(0)==="_"||"ignoreKeys"in t&&t.ignoreKeys.includes(i)}var ofe=class{constructor(e){this._equals=e,this._proxyCache=new WeakMap,this._pathCache=new WeakMap,this.isUnsubscribed=!1}_getDescriptorCache(){return this._descriptorCache===void 0&&(this._descriptorCache=new WeakMap),this._descriptorCache}_getProperties(e){let t=this._getDescriptorCache(),i=t.get(e);return i===void 0&&(i={},t.set(e,i)),i}_getOwnPropertyDescriptor(e,t){if(this.isUnsubscribed)return Reflect.getOwnPropertyDescriptor(e,t);let i=this._getProperties(e),r=i[t];return r===void 0&&(r=Reflect.getOwnPropertyDescriptor(e,t),i[t]=r),r}getProxy(e,t,i,r){if(this.isUnsubscribed)return e;let n=e[r],s=n||e;this._pathCache.set(s,t);let a=this._proxyCache.get(s);return a===void 0&&(a=n===void 0?new Proxy(e,i):e,this._proxyCache.set(s,a)),a}getPath(e){return this.isUnsubscribed?void 0:this._pathCache.get(e)}isDetached(e,t){return!Object.is(e,ko.get(t,this.getPath(e)))}defineProperty(e,t,i){return Reflect.defineProperty(e,t,i)?(this.isUnsubscribed||(this._getProperties(e)[t]=i),!0):!1}setProperty(e,t,i,r,n){if(!this._equals(n,i)||!(t in e)){let s=this._getOwnPropertyDescriptor(e,t);return s!==void 0&&"set"in s?Reflect.set(e,t,i,r):Reflect.set(e,t,i)}return!0}deleteProperty(e,t,i){if(Reflect.deleteProperty(e,t)){if(!this.isUnsubscribed){let r=this._getDescriptorCache().get(e);r&&(delete r[t],this._pathCache.delete(i))}return!0}return!1}isSameDescriptor(e,t,i){let r=this._getOwnPropertyDescriptor(t,i);return e!==void 0&&r!==void 0&&Object.is(e.value,r.value)&&(e.writable||!1)===(r.writable||!1)&&(e.enumerable||!1)===(r.enumerable||!1)&&(e.configurable||!1)===(r.configurable||!1)&&e.get===r.get&&e.set===r.set}isGetInvariant(e,t){let i=this._getOwnPropertyDescriptor(e,t);return i!==void 0&&i.configurable!==!0&&i.writable!==!0}unsubscribe(){this._descriptorCache=null,this._pathCache=null,this._proxyCache=null,this.isUnsubscribed=!0}};function jL(e){return toString.call(e)==="[object Object]"}function Z_(){return!0}function Vm(e,t){return e.length!==t.length||e.some((i,r)=>t[r]!==i)}var hQ=new Set(["hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]),lfe=new Set(["concat","includes","indexOf","join","keys","lastIndexOf"]),dQ={push:Z_,pop:Z_,shift:Z_,unshift:Z_,copyWithin:Vm,reverse:Vm,sort:Vm,splice:Vm,flat:Vm,fill:Vm},cfe=new Set([...hQ,...lfe,...Object.keys(dQ)]);function $_(e,t){if(e.size!==t.size)return!0;for(let i of e)if(!t.has(i))return!0;return!1}var pQ=["keys","values","entries"],fQ=new Set(["has","toString"]),mQ={add:$_,clear:$_,delete:$_,forEach:$_},ufe=new Set([...fQ,...Object.keys(mQ),...pQ]);function J_(e,t){if(e.size!==t.size)return!0;let i;for(let[r,n]of e)if(i=t.get(r),i!==n||i===void 0&&!t.has(r))return!0;return!1}var hfe=new Set([...fQ,"get"]),gQ={set:J_,clear:J_,delete:J_,forEach:J_},dfe=new Set([...hfe,...Object.keys(gQ),...pQ]),qd=class{constructor(e,t,i,r){this._path=t,this._isChanged=!1,this._clonedCache=new Set,this._hasOnValidate=r,this._changes=r?[]:null,this.clone=t===void 0?e:this._shallowClone(e)}static isHandledMethod(e){return hQ.has(e)}_shallowClone(e){let t=e;if(jL(e))t={...e};else if(Cc(e))t=[...e];else if(e instanceof Date)t=new Date(e);else if(e instanceof Set)t=new Set([...e].map(i=>this._shallowClone(i)));else if(e instanceof Map){t=new Map;for(let[i,r]of e.entries())t.set(i,this._shallowClone(r))}return this._clonedCache.add(t),t}preferredThisArg(e,t,i,r){return e?(Cc(r)?this._onIsChanged=dQ[t]:r instanceof Set?this._onIsChanged=mQ[t]:r instanceof Map&&(this._onIsChanged=gQ[t]),r):i}update(e,t,i){let r=ko.after(e,this._path);if(t!=="length"){let n=this.clone;ko.walk(r,s=>{n&&n[s]&&(this._clonedCache.has(n[s])||(n[s]=this._shallowClone(n[s])),n=n[s])}),this._hasOnValidate&&this._changes.push({path:r,property:t,previous:i}),n&&n[t]&&(n[t]=i)}this._isChanged=!0}undo(e){let t;for(let i=this._changes.length-1;i!==-1;i--)t=this._changes[i],ko.get(e,t.path)[t.property]=t.previous}isChanged(e){return this._onIsChanged===void 0?this._isChanged:this._onIsChanged(this.clone,e)}},_H=class extends qd{static isHandledMethod(e){return cfe.has(e)}},pfe=class extends qd{undo(e){e.setTime(this.clone.getTime())}isChanged(e,t){return!t(this.clone.valueOf(),e.valueOf())}},SH=class extends qd{static isHandledMethod(e){return ufe.has(e)}undo(e){for(let t of this.clone)e.add(t);for(let t of e)this.clone.has(t)||e.delete(t)}},MH=class extends qd{static isHandledMethod(e){return dfe.has(e)}undo(e){for(let[t,i]of this.clone.entries())e.set(t,i);for(let t of e.keys())this.clone.has(t)||e.delete(t)}},ffe=class extends qd{constructor(e,t,i,r){super(void 0,t,i,r),this._arg1=i[0],this._weakValue=e.has(this._arg1)}isChanged(e){return this._weakValue!==e.has(this._arg1)}undo(e){this._weakValue&&!e.has(this._arg1)?e.add(this._arg1):e.delete(this._arg1)}},mfe=class extends qd{constructor(e,t,i,r){super(void 0,t,i,r),this._weakKey=i[0],this._weakHas=e.has(this._weakKey),this._weakValue=e.get(this._weakKey)}isChanged(e){return this._weakValue!==e.get(this._weakKey)}undo(e){let t=e.has(this._weakKey);this._weakHas&&!t?e.set(this._weakKey,this._weakValue):!this._weakHas&&t?e.delete(this._weakKey):this._weakValue!==e.get(this._weakKey)&&e.set(this._weakKey,this._weakValue)}},Og=class{constructor(e){this._stack=[],this._hasOnValidate=e}static isHandledType(e){return jL(e)||Cc(e)||GL(e)}static isHandledMethod(e,t){return jL(e)?qd.isHandledMethod(t):Cc(e)?_H.isHandledMethod(t):e instanceof Set?SH.isHandledMethod(t):e instanceof Map?MH.isHandledMethod(t):GL(e)}get isCloning(){return this._stack.length>0}start(e,t,i){let r=qd;Cc(e)?r=_H:e instanceof Date?r=pfe:e instanceof Set?r=SH:e instanceof Map?r=MH:e instanceof WeakSet?r=ffe:e instanceof WeakMap&&(r=mfe),this._stack.push(new r(e,t,i,this._hasOnValidate))}update(e,t,i){this._stack[this._stack.length-1].update(e,t,i)}preferredThisArg(e,t,i){let{name:r}=e,n=Og.isHandledMethod(i,r);return this._stack[this._stack.length-1].preferredThisArg(n,r,t,i)}isChanged(e,t,i){return this._stack[this._stack.length-1].isChanged(e,t,i)}undo(e){this._previousClone!==void 0&&this._previousClone.undo(e)}stop(){return this._previousClone=this._stack.pop(),this._previousClone.clone}},gfe={equals:Object.is,isShallow:!1,pathAsArray:!1,ignoreSymbols:!1,ignoreUnderscores:!1,ignoreDetached:!1,details:!1},CB=(e,t,i={})=>{i={...gfe,...i};let r=Symbol("ProxyTarget"),{equals:n,isShallow:s,ignoreDetached:a,details:o}=i,l=new ofe(n),c=typeof i.onValidate=="function",u=new Og(c),h=(x,w,_,M,S)=>!c||u.isCloning||i.onValidate(ko.concat(l.getPath(x),w),_,M,S)===!0,d=(x,w,_,M)=>{!bH(l,i,w)&&!(a&&l.isDetached(x,e))&&p(l.getPath(x),w,_,M)},p=(x,w,_,M,S)=>{u.isCloning?u.update(x,w,M):t(ko.concat(x,w),_,M,S)},f=x=>x&&(x[r]||x),v=(x,w,_,M)=>rfe(x)||_==="constructor"||s&&!Og.isHandledMethod(w,_)||bH(l,i,_)||l.isGetInvariant(w,_)||a&&l.isDetached(w,e)?x:(M===void 0&&(M=l.getPath(w)),l.getProxy(x,ko.concat(M,_),g,r)),g={get(x,w,_){if(AB(w)){if(w===r||w===EB)return x;if(w===uQ&&!l.isUnsubscribed&&l.getPath(x).length===0)return l.unsubscribe(),x}let M=GL(x)?Reflect.get(x,w):Reflect.get(x,w,_);return v(M,x,w)},set(x,w,_,M){_=f(_);let S=x[r]||x,A=S[w];if(n(A,_)&&w in x)return!0;let T=h(x,w,_,A);return T&&l.setProperty(S,w,_,M,A)?(d(x,w,x[w],A),!0):!T},defineProperty(x,w,_){if(!l.isSameDescriptor(_,x,w)){let M=x[w];h(x,w,_.value,M)&&l.defineProperty(x,w,_,M)&&d(x,w,_.value,M)}return!0},deleteProperty(x,w){if(!Reflect.has(x,w))return!0;let _=Reflect.get(x,w),M=h(x,w,void 0,_);return M&&l.deleteProperty(x,w,_)?(d(x,w,void 0,_),!0):!M},apply(x,w,_){let M=w[r]||w;if(l.isUnsubscribed)return Reflect.apply(x,M,_);if((o===!1||o!==!0&&!o.includes(x.name))&&Og.isHandledType(M)){let S=ko.initial(l.getPath(x)),A=Og.isHandledMethod(M,x.name);u.start(M,S,_);let T=Reflect.apply(x,u.preferredThisArg(x,w,M),A?_.map(D=>f(D)):_),E=u.isChanged(M,n),C=u.stop();if(Og.isHandledType(T)&&A&&(w instanceof Map&&x.name==="get"&&(S=ko.concat(S,_[0])),T=l.getProxy(T,S,g)),E){let D={name:x.name,args:_,result:T},I=u.isCloning?ko.initial(S):S,L=u.isCloning?ko.last(S):"";h(ko.get(e,I),L,M,C,D)?p(I,L,M,C,D):u.undo(M)}return(w instanceof Map||w instanceof Set)&&sfe(T)?afe(T,x,w,S,v):T}return Reflect.apply(x,w,_)}},m=l.getProxy(e,i.pathAsArray?[]:"",g);return t=t.bind(m),c&&(i.onValidate=i.onValidate.bind(m)),m};CB.target=e=>e&&e[EB]||e;CB.unsubscribe=e=>e[uQ]||e;var EH=CB,vfe=typeof global=="object"&&global&&global.Object===Object&&global,vQ=vfe,yfe=typeof self=="object"&&self&&self.Object===Object&&self,xfe=vQ||yfe||Function("return this")(),ql=xfe,wfe=ql.Symbol,rl=wfe,yQ=Object.prototype,bfe=yQ.hasOwnProperty,_fe=yQ.toString,Py=rl?rl.toStringTag:void 0;function Sfe(e){var t=bfe.call(e,Py),i=e[Py];try{e[Py]=void 0;var r=!0}catch{}var n=_fe.call(e);return r&&(t?e[Py]=i:delete e[Py]),n}var Mfe=Sfe,Efe=Object.prototype,Afe=Efe.toString;function Cfe(e){return Afe.call(e)}var Tfe=Cfe,Pfe="[object Null]",Dfe="[object Undefined]",AH=rl?rl.toStringTag:void 0;function Rfe(e){return e==null?e===void 0?Dfe:Pfe:AH&&AH in Object(e)?Mfe(e):Tfe(e)}var im=Rfe;function Ife(e){return e!=null&&typeof e=="object"}var dh=Ife,Lfe="[object Symbol]";function Ofe(e){return typeof e=="symbol"||dh(e)&&im(e)==Lfe}var Uw=Ofe;function zfe(e,t){for(var i=-1,r=e==null?0:e.length,n=Array(r);++i<r;)n[i]=t(e[i],i,e);return n}var xQ=zfe,Nfe=Array.isArray,Xc=Nfe,Bfe=1/0,CH=rl?rl.prototype:void 0,TH=CH?CH.toString:void 0;function wQ(e){if(typeof e=="string")return e;if(Xc(e))return xQ(e,wQ)+"";if(Uw(e))return TH?TH.call(e):"";var t=e+"";return t=="0"&&1/e==-Bfe?"-0":t}var kfe=wQ,Ufe=/\s/;function Ffe(e){for(var t=e.length;t--&&Ufe.test(e.charAt(t)););return t}var Vfe=Ffe,Hfe=/^\s+/;function Gfe(e){return e&&e.slice(0,Vfe(e)+1).replace(Hfe,"")}var jfe=Gfe;function Wfe(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var Gl=Wfe,PH=NaN,Xfe=/^[-+]0x[0-9a-f]+$/i,qfe=/^0b[01]+$/i,Yfe=/^0o[0-7]+$/i,Qfe=parseInt;function Kfe(e){if(typeof e=="number")return e;if(Uw(e))return PH;if(Gl(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=Gl(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=jfe(e);var i=qfe.test(e);return i||Yfe.test(e)?Qfe(e.slice(2),i?2:8):Xfe.test(e)?PH:+e}var DH=Kfe;function Zfe(e){return e}var bQ=Zfe,$fe="[object AsyncFunction]",Jfe="[object Function]",eme="[object GeneratorFunction]",tme="[object Proxy]";function ime(e){if(!Gl(e))return!1;var t=im(e);return t==Jfe||t==eme||t==$fe||t==tme}var _Q=ime,rme=ql["__core-js_shared__"],s3=rme,RH=function(){var e=/[^.]+$/.exec(s3&&s3.keys&&s3.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function nme(e){return!!RH&&RH in e}var sme=nme,ame=Function.prototype,ome=ame.toString;function lme(e){if(e!=null){try{return ome.call(e)}catch{}try{return e+""}catch{}}return""}var rm=lme,cme=/[\\^$.*+?()[\]{}|]/g,ume=/^\[object .+?Constructor\]$/,hme=Function.prototype,dme=Object.prototype,pme=hme.toString,fme=dme.hasOwnProperty,mme=RegExp("^"+pme.call(fme).replace(cme,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function gme(e){if(!Gl(e)||sme(e))return!1;var t=_Q(e)?mme:ume;return t.test(rm(e))}var vme=gme;function yme(e,t){return e==null?void 0:e[t]}var xme=yme;function wme(e,t){var i=xme(e,t);return vme(i)?i:void 0}var nm=wme,bme=nm(ql,"WeakMap"),WL=bme,IH=Object.create,_me=function(){function e(){}return function(t){if(!Gl(t))return{};if(IH)return IH(t);e.prototype=t;var i=new e;return e.prototype=void 0,i}}(),Sme=_me;function Mme(e,t,i){switch(i.length){case 0:return e.call(t);case 1:return e.call(t,i[0]);case 2:return e.call(t,i[0],i[1]);case 3:return e.call(t,i[0],i[1],i[2])}return e.apply(t,i)}var Eme=Mme;function Ame(e,t){var i=-1,r=e.length;for(t||(t=Array(r));++i<r;)t[i]=e[i];return t}var Cme=Ame,Tme=800,Pme=16,Dme=Date.now;function Rme(e){var t=0,i=0;return function(){var r=Dme(),n=Pme-(r-i);if(i=r,n>0){if(++t>=Tme)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}var Ime=Rme;function Lme(e){return function(){return e}}var Ome=Lme,zme=function(){try{var e=nm(Object,"defineProperty");return e({},"",{}),e}catch{}}(),TA=zme,Nme=TA?function(e,t){return TA(e,"toString",{configurable:!0,enumerable:!1,value:Ome(t),writable:!0})}:bQ,Bme=Nme,kme=Ime(Bme),Ume=kme;function Fme(e,t){for(var i=-1,r=e==null?0:e.length;++i<r&&t(e[i],i,e)!==!1;);return e}var Vme=Fme,Hme=9007199254740991,Gme=/^(?:0|[1-9]\d*)$/;function jme(e,t){var i=typeof e;return t=t??Hme,!!t&&(i=="number"||i!="symbol"&&Gme.test(e))&&e>-1&&e%1==0&&e<t}var TB=jme;function Wme(e,t,i){t=="__proto__"&&TA?TA(e,t,{configurable:!0,enumerable:!0,value:i,writable:!0}):e[t]=i}var SQ=Wme;function Xme(e,t){return e===t||e!==e&&t!==t}var PB=Xme,qme=Object.prototype,Yme=qme.hasOwnProperty;function Qme(e,t,i){var r=e[t];(!(Yme.call(e,t)&&PB(r,i))||i===void 0&&!(t in e))&&SQ(e,t,i)}var DB=Qme;function Kme(e,t,i,r){var n=!i;i||(i={});for(var s=-1,a=t.length;++s<a;){var o=t[s],l=r?r(i[o],e[o],o,i,e):void 0;l===void 0&&(l=e[o]),n?SQ(i,o,l):DB(i,o,l)}return i}var Fw=Kme,LH=Math.max;function Zme(e,t,i){return t=LH(t===void 0?e.length-1:t,0),function(){for(var r=arguments,n=-1,s=LH(r.length-t,0),a=Array(s);++n<s;)a[n]=r[t+n];n=-1;for(var o=Array(t+1);++n<t;)o[n]=r[n];return o[t]=i(a),Eme(e,this,o)}}var $me=Zme,Jme=9007199254740991;function ege(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=Jme}var RB=ege;function tge(e){return e!=null&&RB(e.length)&&!_Q(e)}var MQ=tge,ige=Object.prototype;function rge(e){var t=e&&e.constructor,i=typeof t=="function"&&t.prototype||ige;return e===i}var IB=rge;function nge(e,t){for(var i=-1,r=Array(e);++i<e;)r[i]=t(i);return r}var sge=nge,age="[object Arguments]";function oge(e){return dh(e)&&im(e)==age}var OH=oge,EQ=Object.prototype,lge=EQ.hasOwnProperty,cge=EQ.propertyIsEnumerable,uge=OH(function(){return arguments}())?OH:function(e){return dh(e)&&lge.call(e,"callee")&&!cge.call(e,"callee")},LB=uge;function hge(){return!1}var dge=hge,AQ=typeof exports=="object"&&exports&&!exports.nodeType&&exports,zH=AQ&&typeof module=="object"&&module&&!module.nodeType&&module,pge=zH&&zH.exports===AQ,NH=pge?ql.Buffer:void 0,fge=NH?NH.isBuffer:void 0,mge=fge||dge,PA=mge,gge="[object Arguments]",vge="[object Array]",yge="[object Boolean]",xge="[object Date]",wge="[object Error]",bge="[object Function]",_ge="[object Map]",Sge="[object Number]",Mge="[object Object]",Ege="[object RegExp]",Age="[object Set]",Cge="[object String]",Tge="[object WeakMap]",Pge="[object ArrayBuffer]",Dge="[object DataView]",Rge="[object Float32Array]",Ige="[object Float64Array]",Lge="[object Int8Array]",Oge="[object Int16Array]",zge="[object Int32Array]",Nge="[object Uint8Array]",Bge="[object Uint8ClampedArray]",kge="[object Uint16Array]",Uge="[object Uint32Array]",Mr={};Mr[Rge]=Mr[Ige]=Mr[Lge]=Mr[Oge]=Mr[zge]=Mr[Nge]=Mr[Bge]=Mr[kge]=Mr[Uge]=!0;Mr[gge]=Mr[vge]=Mr[Pge]=Mr[yge]=Mr[Dge]=Mr[xge]=Mr[wge]=Mr[bge]=Mr[_ge]=Mr[Sge]=Mr[Mge]=Mr[Ege]=Mr[Age]=Mr[Cge]=Mr[Tge]=!1;function Fge(e){return dh(e)&&RB(e.length)&&!!Mr[im(e)]}var Vge=Fge;function Hge(e){return function(t){return e(t)}}var OB=Hge,CQ=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Xx=CQ&&typeof module=="object"&&module&&!module.nodeType&&module,Gge=Xx&&Xx.exports===CQ,a3=Gge&&vQ.process,jge=function(){try{var e=Xx&&Xx.require&&Xx.require("util").types;return e||a3&&a3.binding&&a3.binding("util")}catch{}}(),Yv=jge,BH=Yv&&Yv.isTypedArray,Wge=BH?OB(BH):Vge,TQ=Wge,Xge=Object.prototype,qge=Xge.hasOwnProperty;function Yge(e,t){var i=Xc(e),r=!i&&LB(e),n=!i&&!r&&PA(e),s=!i&&!r&&!n&&TQ(e),a=i||r||n||s,o=a?sge(e.length,String):[],l=o.length;for(var c in e)(t||qge.call(e,c))&&!(a&&(c=="length"||n&&(c=="offset"||c=="parent")||s&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||TB(c,l)))&&o.push(c);return o}var PQ=Yge;function Qge(e,t){return function(i){return e(t(i))}}var DQ=Qge,Kge=DQ(Object.keys,Object),Zge=Kge,$ge=Object.prototype,Jge=$ge.hasOwnProperty;function eve(e){if(!IB(e))return Zge(e);var t=[];for(var i in Object(e))Jge.call(e,i)&&i!="constructor"&&t.push(i);return t}var tve=eve;function ive(e){return MQ(e)?PQ(e):tve(e)}var zB=ive;function rve(e){var t=[];if(e!=null)for(var i in Object(e))t.push(i);return t}var nve=rve,sve=Object.prototype,ave=sve.hasOwnProperty;function ove(e){if(!Gl(e))return nve(e);var t=IB(e),i=[];for(var r in e)r=="constructor"&&(t||!ave.call(e,r))||i.push(r);return i}var lve=ove;function cve(e){return MQ(e)?PQ(e,!0):lve(e)}var sf=cve,uve=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,hve=/^\w*$/;function dve(e,t){if(Xc(e))return!1;var i=typeof e;return i=="number"||i=="symbol"||i=="boolean"||e==null||Uw(e)?!0:hve.test(e)||!uve.test(e)||t!=null&&e in Object(t)}var pve=dve,fve=nm(Object,"create"),B1=fve;function mve(){this.__data__=B1?B1(null):{},this.size=0}var gve=mve;function vve(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var yve=vve,xve="__lodash_hash_undefined__",wve=Object.prototype,bve=wve.hasOwnProperty;function _ve(e){var t=this.__data__;if(B1){var i=t[e];return i===xve?void 0:i}return bve.call(t,e)?t[e]:void 0}var Sve=_ve,Mve=Object.prototype,Eve=Mve.hasOwnProperty;function Ave(e){var t=this.__data__;return B1?t[e]!==void 0:Eve.call(t,e)}var Cve=Ave,Tve="__lodash_hash_undefined__";function Pve(e,t){var i=this.__data__;return this.size+=this.has(e)?0:1,i[e]=B1&&t===void 0?Tve:t,this}var Dve=Pve;function C0(e){var t=-1,i=e==null?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}C0.prototype.clear=gve;C0.prototype.delete=yve;C0.prototype.get=Sve;C0.prototype.has=Cve;C0.prototype.set=Dve;var kH=C0;function Rve(){this.__data__=[],this.size=0}var Ive=Rve;function Lve(e,t){for(var i=e.length;i--;)if(PB(e[i][0],t))return i;return-1}var CT=Lve,Ove=Array.prototype,zve=Ove.splice;function Nve(e){var t=this.__data__,i=CT(t,e);if(i<0)return!1;var r=t.length-1;return i==r?t.pop():zve.call(t,i,1),--this.size,!0}var Bve=Nve;function kve(e){var t=this.__data__,i=CT(t,e);return i<0?void 0:t[i][1]}var Uve=kve;function Fve(e){return CT(this.__data__,e)>-1}var Vve=Fve;function Hve(e,t){var i=this.__data__,r=CT(i,e);return r<0?(++this.size,i.push([e,t])):i[r][1]=t,this}var Gve=Hve;function T0(e){var t=-1,i=e==null?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}T0.prototype.clear=Ive;T0.prototype.delete=Bve;T0.prototype.get=Uve;T0.prototype.has=Vve;T0.prototype.set=Gve;var TT=T0,jve=nm(ql,"Map"),k1=jve;function Wve(){this.size=0,this.__data__={hash:new kH,map:new(k1||TT),string:new kH}}var Xve=Wve;function qve(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}var Yve=qve;function Qve(e,t){var i=e.__data__;return Yve(t)?i[typeof t=="string"?"string":"hash"]:i.map}var PT=Qve;function Kve(e){var t=PT(this,e).delete(e);return this.size-=t?1:0,t}var Zve=Kve;function $ve(e){return PT(this,e).get(e)}var Jve=$ve;function e0e(e){return PT(this,e).has(e)}var t0e=e0e;function i0e(e,t){var i=PT(this,e),r=i.size;return i.set(e,t),this.size+=i.size==r?0:1,this}var r0e=i0e;function P0(e){var t=-1,i=e==null?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}P0.prototype.clear=Xve;P0.prototype.delete=Zve;P0.prototype.get=Jve;P0.prototype.has=t0e;P0.prototype.set=r0e;var DT=P0,n0e="Expected a function";function NB(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(n0e);var i=function(){var r=arguments,n=t?t.apply(this,r):r[0],s=i.cache;if(s.has(n))return s.get(n);var a=e.apply(this,r);return i.cache=s.set(n,a)||s,a};return i.cache=new(NB.Cache||DT),i}NB.Cache=DT;var s0e=NB,a0e=500;function o0e(e){var t=s0e(e,function(r){return i.size===a0e&&i.clear(),r}),i=t.cache;return t}var l0e=o0e,c0e=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,u0e=/\\(\\)?/g,h0e=l0e(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(c0e,function(i,r,n,s){t.push(n?s.replace(u0e,"$1"):r||i)}),t}),d0e=h0e;function p0e(e){return e==null?"":kfe(e)}var f0e=p0e;function m0e(e,t){return Xc(e)?e:pve(e,t)?[e]:d0e(f0e(e))}var D0=m0e,g0e=1/0;function v0e(e){if(typeof e=="string"||Uw(e))return e;var t=e+"";return t=="0"&&1/e==-g0e?"-0":t}var RT=v0e;function y0e(e,t){t=D0(t,e);for(var i=0,r=t.length;e!=null&&i<r;)e=e[RT(t[i++])];return i&&i==r?e:void 0}var RQ=y0e;function x0e(e,t){for(var i=-1,r=t.length,n=e.length;++i<r;)e[n+i]=t[i];return e}var BB=x0e,UH=rl?rl.isConcatSpreadable:void 0;function w0e(e){return Xc(e)||LB(e)||!!(UH&&e&&e[UH])}var b0e=w0e;function IQ(e,t,i,r,n){var s=-1,a=e.length;for(i||(i=b0e),n||(n=[]);++s<a;){var o=e[s];t>0&&i(o)?t>1?IQ(o,t-1,i,r,n):BB(n,o):r||(n[n.length]=o)}return n}var _0e=IQ;function S0e(e){var t=e==null?0:e.length;return t?_0e(e,1):[]}var M0e=S0e;function E0e(e){return Ume($me(e,void 0,M0e),e+"")}var LQ=E0e,A0e=DQ(Object.getPrototypeOf,Object),kB=A0e,C0e="[object Object]",T0e=Function.prototype,P0e=Object.prototype,OQ=T0e.toString,D0e=P0e.hasOwnProperty,R0e=OQ.call(Object);function I0e(e){if(!dh(e)||im(e)!=C0e)return!1;var t=kB(e);if(t===null)return!0;var i=D0e.call(t,"constructor")&&t.constructor;return typeof i=="function"&&i instanceof i&&OQ.call(i)==R0e}var L0e=I0e;function O0e(e,t,i){var r=-1,n=e.length;t<0&&(t=-t>n?0:n+t),i=i>n?n:i,i<0&&(i+=n),n=t>i?0:i-t>>>0,t>>>=0;for(var s=Array(n);++r<n;)s[r]=e[r+t];return s}var z0e=O0e;function N0e(){this.__data__=new TT,this.size=0}var B0e=N0e;function k0e(e){var t=this.__data__,i=t.delete(e);return this.size=t.size,i}var U0e=k0e;function F0e(e){return this.__data__.get(e)}var V0e=F0e;function H0e(e){return this.__data__.has(e)}var G0e=H0e,j0e=200;function W0e(e,t){var i=this.__data__;if(i instanceof TT){var r=i.__data__;if(!k1||r.length<j0e-1)return r.push([e,t]),this.size=++i.size,this;i=this.__data__=new DT(r)}return i.set(e,t),this.size=i.size,this}var X0e=W0e;function R0(e){var t=this.__data__=new TT(e);this.size=t.size}R0.prototype.clear=B0e;R0.prototype.delete=U0e;R0.prototype.get=V0e;R0.prototype.has=G0e;R0.prototype.set=X0e;var fE=R0;function q0e(e,t){return e&&Fw(t,zB(t),e)}var Y0e=q0e;function Q0e(e,t){return e&&Fw(t,sf(t),e)}var K0e=Q0e,zQ=typeof exports=="object"&&exports&&!exports.nodeType&&exports,FH=zQ&&typeof module=="object"&&module&&!module.nodeType&&module,Z0e=FH&&FH.exports===zQ,VH=Z0e?ql.Buffer:void 0,HH=VH?VH.allocUnsafe:void 0;function $0e(e,t){if(t)return e.slice();var i=e.length,r=HH?HH(i):new e.constructor(i);return e.copy(r),r}var J0e=$0e;function eye(e,t){for(var i=-1,r=e==null?0:e.length,n=0,s=[];++i<r;){var a=e[i];t(a,i,e)&&(s[n++]=a)}return s}var tye=eye;function iye(){return[]}var NQ=iye,rye=Object.prototype,nye=rye.propertyIsEnumerable,GH=Object.getOwnPropertySymbols,sye=GH?function(e){return e==null?[]:(e=Object(e),tye(GH(e),function(t){return nye.call(e,t)}))}:NQ,UB=sye;function aye(e,t){return Fw(e,UB(e),t)}var oye=aye,lye=Object.getOwnPropertySymbols,cye=lye?function(e){for(var t=[];e;)BB(t,UB(e)),e=kB(e);return t}:NQ,BQ=cye;function uye(e,t){return Fw(e,BQ(e),t)}var hye=uye;function dye(e,t,i){var r=t(e);return Xc(e)?r:BB(r,i(e))}var kQ=dye;function pye(e){return kQ(e,zB,UB)}var XL=pye;function fye(e){return kQ(e,sf,BQ)}var UQ=fye,mye=nm(ql,"DataView"),qL=mye,gye=nm(ql,"Promise"),YL=gye,vye=nm(ql,"Set"),QL=vye,jH="[object Map]",yye="[object Object]",WH="[object Promise]",XH="[object Set]",qH="[object WeakMap]",YH="[object DataView]",xye=rm(qL),wye=rm(k1),bye=rm(YL),_ye=rm(QL),Sye=rm(WL),Hp=im;(qL&&Hp(new qL(new ArrayBuffer(1)))!=YH||k1&&Hp(new k1)!=jH||YL&&Hp(YL.resolve())!=WH||QL&&Hp(new QL)!=XH||WL&&Hp(new WL)!=qH)&&(Hp=function(e){var t=im(e),i=t==yye?e.constructor:void 0,r=i?rm(i):"";if(r)switch(r){case xye:return YH;case wye:return jH;case bye:return WH;case _ye:return XH;case Sye:return qH}return t});var U1=Hp,Mye=Object.prototype,Eye=Mye.hasOwnProperty;function Aye(e){var t=e.length,i=new e.constructor(t);return t&&typeof e[0]=="string"&&Eye.call(e,"index")&&(i.index=e.index,i.input=e.input),i}var Cye=Aye,Tye=ql.Uint8Array,DA=Tye;function Pye(e){var t=new e.constructor(e.byteLength);return new DA(t).set(new DA(e)),t}var FB=Pye;function Dye(e,t){var i=t?FB(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.byteLength)}var Rye=Dye,Iye=/\w*$/;function Lye(e){var t=new e.constructor(e.source,Iye.exec(e));return t.lastIndex=e.lastIndex,t}var Oye=Lye,QH=rl?rl.prototype:void 0,KH=QH?QH.valueOf:void 0;function zye(e){return KH?Object(KH.call(e)):{}}var Nye=zye;function Bye(e,t){var i=t?FB(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.length)}var kye=Bye,Uye="[object Boolean]",Fye="[object Date]",Vye="[object Map]",Hye="[object Number]",Gye="[object RegExp]",jye="[object Set]",Wye="[object String]",Xye="[object Symbol]",qye="[object ArrayBuffer]",Yye="[object DataView]",Qye="[object Float32Array]",Kye="[object Float64Array]",Zye="[object Int8Array]",$ye="[object Int16Array]",Jye="[object Int32Array]",exe="[object Uint8Array]",txe="[object Uint8ClampedArray]",ixe="[object Uint16Array]",rxe="[object Uint32Array]";function nxe(e,t,i){var r=e.constructor;switch(t){case qye:return FB(e);case Uye:case Fye:return new r(+e);case Yye:return Rye(e,i);case Qye:case Kye:case Zye:case $ye:case Jye:case exe:case txe:case ixe:case rxe:return kye(e,i);case Vye:return new r;case Hye:case Wye:return new r(e);case Gye:return Oye(e);case jye:return new r;case Xye:return Nye(e)}}var sxe=nxe;function axe(e){return typeof e.constructor=="function"&&!IB(e)?Sme(kB(e)):{}}var oxe=axe,lxe="[object Map]";function cxe(e){return dh(e)&&U1(e)==lxe}var uxe=cxe,ZH=Yv&&Yv.isMap,hxe=ZH?OB(ZH):uxe,dxe=hxe,pxe="[object Set]";function fxe(e){return dh(e)&&U1(e)==pxe}var mxe=fxe,$H=Yv&&Yv.isSet,gxe=$H?OB($H):mxe,vxe=gxe,yxe=1,xxe=2,wxe=4,FQ="[object Arguments]",bxe="[object Array]",_xe="[object Boolean]",Sxe="[object Date]",Mxe="[object Error]",VQ="[object Function]",Exe="[object GeneratorFunction]",Axe="[object Map]",Cxe="[object Number]",HQ="[object Object]",Txe="[object RegExp]",Pxe="[object Set]",Dxe="[object String]",Rxe="[object Symbol]",Ixe="[object WeakMap]",Lxe="[object ArrayBuffer]",Oxe="[object DataView]",zxe="[object Float32Array]",Nxe="[object Float64Array]",Bxe="[object Int8Array]",kxe="[object Int16Array]",Uxe="[object Int32Array]",Fxe="[object Uint8Array]",Vxe="[object Uint8ClampedArray]",Hxe="[object Uint16Array]",Gxe="[object Uint32Array]",vr={};vr[FQ]=vr[bxe]=vr[Lxe]=vr[Oxe]=vr[_xe]=vr[Sxe]=vr[zxe]=vr[Nxe]=vr[Bxe]=vr[kxe]=vr[Uxe]=vr[Axe]=vr[Cxe]=vr[HQ]=vr[Txe]=vr[Pxe]=vr[Dxe]=vr[Rxe]=vr[Fxe]=vr[Vxe]=vr[Hxe]=vr[Gxe]=!0;vr[Mxe]=vr[VQ]=vr[Ixe]=!1;function mE(e,t,i,r,n,s){var a,o=t&yxe,l=t&xxe,c=t&wxe;if(i&&(a=n?i(e,r,n,s):i(e)),a!==void 0)return a;if(!Gl(e))return e;var u=Xc(e);if(u){if(a=Cye(e),!o)return Cme(e,a)}else{var h=U1(e),d=h==VQ||h==Exe;if(PA(e))return J0e(e,o);if(h==HQ||h==FQ||d&&!n){if(a=l||d?{}:oxe(e),!o)return l?hye(e,K0e(a,e)):oye(e,Y0e(a,e))}else{if(!vr[h])return n?e:{};a=sxe(e,h,o)}}s||(s=new fE);var p=s.get(e);if(p)return p;s.set(e,a),vxe(e)?e.forEach(function(g){a.add(mE(g,t,i,g,e,s))}):dxe(e)&&e.forEach(function(g,m){a.set(m,mE(g,t,i,m,e,s))});var f=c?l?UQ:XL:l?sf:zB,v=u?void 0:f(e);return Vme(v||e,function(g,m){v&&(m=g,g=e[m]),DB(a,m,mE(g,t,i,m,e,s))}),a}var GQ=mE,jxe=1,Wxe=4;function Xxe(e){return GQ(e,jxe|Wxe)}var IT=Xxe,qxe="__lodash_hash_undefined__";function Yxe(e){return this.__data__.set(e,qxe),this}var Qxe=Yxe;function Kxe(e){return this.__data__.has(e)}var Zxe=Kxe;function RA(e){var t=-1,i=e==null?0:e.length;for(this.__data__=new DT;++t<i;)this.add(e[t])}RA.prototype.add=RA.prototype.push=Qxe;RA.prototype.has=Zxe;var $xe=RA;function Jxe(e,t){for(var i=-1,r=e==null?0:e.length;++i<r;)if(t(e[i],i,e))return!0;return!1}var e1e=Jxe;function t1e(e,t){return e.has(t)}var i1e=t1e,r1e=1,n1e=2;function s1e(e,t,i,r,n,s){var a=i&r1e,o=e.length,l=t.length;if(o!=l&&!(a&&l>o))return!1;var c=s.get(e),u=s.get(t);if(c&&u)return c==t&&u==e;var h=-1,d=!0,p=i&n1e?new $xe:void 0;for(s.set(e,t),s.set(t,e);++h<o;){var f=e[h],v=t[h];if(r)var g=a?r(v,f,h,t,e,s):r(f,v,h,e,t,s);if(g!==void 0){if(g)continue;d=!1;break}if(p){if(!e1e(t,function(m,x){if(!i1e(p,x)&&(f===m||n(f,m,i,r,s)))return p.push(x)})){d=!1;break}}else if(!(f===v||n(f,v,i,r,s))){d=!1;break}}return s.delete(e),s.delete(t),d}var jQ=s1e;function a1e(e){var t=-1,i=Array(e.size);return e.forEach(function(r,n){i[++t]=[n,r]}),i}var o1e=a1e;function l1e(e){var t=-1,i=Array(e.size);return e.forEach(function(r){i[++t]=r}),i}var c1e=l1e,u1e=1,h1e=2,d1e="[object Boolean]",p1e="[object Date]",f1e="[object Error]",m1e="[object Map]",g1e="[object Number]",v1e="[object RegExp]",y1e="[object Set]",x1e="[object String]",w1e="[object Symbol]",b1e="[object ArrayBuffer]",_1e="[object DataView]",JH=rl?rl.prototype:void 0,o3=JH?JH.valueOf:void 0;function S1e(e,t,i,r,n,s,a){switch(i){case _1e:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case b1e:return!(e.byteLength!=t.byteLength||!s(new DA(e),new DA(t)));case d1e:case p1e:case g1e:return PB(+e,+t);case f1e:return e.name==t.name&&e.message==t.message;case v1e:case x1e:return e==t+"";case m1e:var o=o1e;case y1e:var l=r&u1e;if(o||(o=c1e),e.size!=t.size&&!l)return!1;var c=a.get(e);if(c)return c==t;r|=h1e,a.set(e,t);var u=jQ(o(e),o(t),r,n,s,a);return a.delete(e),u;case w1e:if(o3)return o3.call(e)==o3.call(t)}return!1}var M1e=S1e,E1e=1,A1e=Object.prototype,C1e=A1e.hasOwnProperty;function T1e(e,t,i,r,n,s){var a=i&E1e,o=XL(e),l=o.length,c=XL(t),u=c.length;if(l!=u&&!a)return!1;for(var h=l;h--;){var d=o[h];if(!(a?d in t:C1e.call(t,d)))return!1}var p=s.get(e),f=s.get(t);if(p&&f)return p==t&&f==e;var v=!0;s.set(e,t),s.set(t,e);for(var g=a;++h<l;){d=o[h];var m=e[d],x=t[d];if(r)var w=a?r(x,m,d,t,e,s):r(m,x,d,e,t,s);if(!(w===void 0?m===x||n(m,x,i,r,s):w)){v=!1;break}g||(g=d=="constructor")}if(v&&!g){var _=e.constructor,M=t.constructor;_!=M&&"constructor"in e&&"constructor"in t&&!(typeof _=="function"&&_ instanceof _&&typeof M=="function"&&M instanceof M)&&(v=!1)}return s.delete(e),s.delete(t),v}var P1e=T1e,D1e=1,eG="[object Arguments]",tG="[object Array]",eS="[object Object]",R1e=Object.prototype,iG=R1e.hasOwnProperty;function I1e(e,t,i,r,n,s){var a=Xc(e),o=Xc(t),l=a?tG:U1(e),c=o?tG:U1(t);l=l==eG?eS:l,c=c==eG?eS:c;var u=l==eS,h=c==eS,d=l==c;if(d&&PA(e)){if(!PA(t))return!1;a=!0,u=!1}if(d&&!u)return s||(s=new fE),a||TQ(e)?jQ(e,t,i,r,n,s):M1e(e,t,l,i,r,n,s);if(!(i&D1e)){var p=u&&iG.call(e,"__wrapped__"),f=h&&iG.call(t,"__wrapped__");if(p||f){var v=p?e.value():e,g=f?t.value():t;return s||(s=new fE),n(v,g,i,r,s)}}return d?(s||(s=new fE),P1e(e,t,i,r,n,s)):!1}var L1e=I1e;function WQ(e,t,i,r,n){return e===t?!0:e==null||t==null||!dh(e)&&!dh(t)?e!==e&&t!==t:L1e(e,t,i,r,WQ,n)}var O1e=WQ;function z1e(e,t){return e!=null&&t in Object(e)}var N1e=z1e;function B1e(e,t,i){t=D0(t,e);for(var r=-1,n=t.length,s=!1;++r<n;){var a=RT(t[r]);if(!(s=e!=null&&i(e,a)))break;e=e[a]}return s||++r!=n?s:(n=e==null?0:e.length,!!n&&RB(n)&&TB(a,n)&&(Xc(e)||LB(e)))}var k1e=B1e;function U1e(e,t){return e!=null&&k1e(e,t,N1e)}var F1e=U1e,V1e=function(){return ql.Date.now()},l3=V1e,H1e="Expected a function",G1e=Math.max,j1e=Math.min;function W1e(e,t,i){var r,n,s,a,o,l,c=0,u=!1,h=!1,d=!0;if(typeof e!="function")throw new TypeError(H1e);t=DH(t)||0,Gl(i)&&(u=!!i.leading,h="maxWait"in i,s=h?G1e(DH(i.maxWait)||0,t):s,d="trailing"in i?!!i.trailing:d);function p(S){var A=r,T=n;return r=n=void 0,c=S,a=e.apply(T,A),a}function f(S){return c=S,o=setTimeout(m,t),u?p(S):a}function v(S){var A=S-l,T=S-c,E=t-A;return h?j1e(E,s-T):E}function g(S){var A=S-l,T=S-c;return l===void 0||A>=t||A<0||h&&T>=s}function m(){var S=l3();if(g(S))return x(S);o=setTimeout(m,v(S))}function x(S){return o=void 0,d&&r?p(S):(r=n=void 0,a)}function w(){o!==void 0&&clearTimeout(o),c=0,r=l=n=o=void 0}function _(){return o===void 0?a:x(l3())}function M(){var S=l3(),A=g(S);if(r=arguments,n=this,l=S,A){if(o===void 0)return f(l);if(h)return clearTimeout(o),o=setTimeout(m,t),p(l)}return o===void 0&&(o=setTimeout(m,t)),a}return M.cancel=w,M.flush=_,M}var VB=W1e;function X1e(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}var q1e=X1e;function Y1e(e,t){return e>t}var Q1e=Y1e;function K1e(e,t){return t.length<2?e:RQ(e,z0e(t,0,-1))}var Z1e=K1e;function $1e(e,t){return O1e(e,t)}var HB=$1e;function J1e(e,t,i){for(var r=-1,n=e.length;++r<n;){var s=e[r],a=t(s);if(a!=null&&(o===void 0?a===a&&!Uw(a):i(a,o)))var o=a,l=s}return l}var ewe=J1e;function twe(e){return e&&e.length?ewe(e,bQ,Q1e):void 0}var iwe=twe;function rwe(e,t){return t=D0(t,e),e=Z1e(e,t),e==null||delete e[RT(q1e(t))]}var nwe=rwe;function swe(e){return L0e(e)?void 0:e}var awe=swe,owe=1,lwe=2,cwe=4,uwe=LQ(function(e,t){var i={};if(e==null)return i;var r=!1;t=xQ(t,function(s){return s=D0(s,e),r||(r=s.length>1),s}),Fw(e,UQ(e),i),r&&(i=GQ(i,owe|lwe|cwe,awe));for(var n=t.length;n--;)nwe(i,t[n]);return i}),KL=uwe;function hwe(e,t,i,r){if(!Gl(e))return e;t=D0(t,e);for(var n=-1,s=t.length,a=s-1,o=e;o!=null&&++n<s;){var l=RT(t[n]),c=i;if(l==="__proto__"||l==="constructor"||l==="prototype")return e;if(n!=a){var u=o[l];c=r?r(u,l,o):void 0,c===void 0&&(c=Gl(u)?u:TB(t[n+1])?[]:{})}DB(o,l,c),o=o[l]}return e}var dwe=hwe;function pwe(e,t,i){for(var r=-1,n=t.length,s={};++r<n;){var a=t[r],o=RQ(e,a);i(o,a)&&dwe(s,D0(a,e),o)}return s}var fwe=pwe;function mwe(e,t){return fwe(e,t,function(i,r){return F1e(e,r)})}var gwe=mwe,vwe=LQ(function(e,t){return e==null?{}:gwe(e,t)}),th=vwe,ywe="Expected a function";function xwe(e,t,i){var r=!0,n=!0;if(typeof e!="function")throw new TypeError(ywe);return Gl(i)&&(r="leading"in i?!!i.leading:r,n="trailing"in i?!!i.trailing:n),VB(e,t,{leading:r,maxWait:t,trailing:n})}var wwe=xwe;function XQ(e){for(let t of Object.keys(e))e[t]===void 0&&delete e[t];return e}function nl(e,t){return Object.setPrototypeOf(e,t),e}var bwe=()=>typeof window>"u"?!1:window.navigator.userAgent.toLowerCase().includes(" electron/"),_we=()=>typeof window>"u"?!1:window.navigator.platform.toUpperCase().includes("MAC"),Swe=()=>typeof window>"u"?!1:/iPad|iPhone|iPod/.test(window.navigator.userAgent)||LT&&"ontouchend"in document,Mwe=()=>typeof window>"u"?!1:window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1,Ewe=()=>typeof window>"u"?!1:"ontouchstart"in window||navigator.maxTouchPoints>0,Awe=()=>{if(typeof window>"u")return!1;let e=navigator.userAgent,t=navigator.vendor;return/Safari/i.test(e)&&/Apple Computer/.test(t)},Cwe=()=>{if(typeof window>"u")return null;let e=navigator.userAgent.match(/Version\/(\d+\.\d)/);return e&&e[1]},Twe=()=>{if(typeof window>"u")return;let e=new URLSearchParams(window.location.search).get("desktop-app-version");return e?(window.localStorage.setItem("desktop-app-version",e),e):window.localStorage.getItem("desktop-app-version")??"0.0.6"},qQ=bwe();qQ&&Twe();var LT=_we(),Vw=Swe(),Pwe=Mwe(),uo=Ewe(),rG=Awe(),Dwe=Number(Cwe());function YQ(e){return Array.isArray(e)?e:[e]}function QQ(e,t){let i=0;for(;i<e.length&&i<t.length;){if(e[i]<t[i])return-1;if(e[i]>t[i])return 1;i+=1}return i!==t.length?-1:i!==e.length?1:0}function tS(e){return LT?e.metaKey:e.ctrlKey}function Rwe(e){return e.wheelDeltaY===0||e.deltaY===0?LT&&e.shiftKey&&Math.abs(e.wheelDeltaX)>=120?!1:e.wheelDeltaX?e.wheelDeltaX===-3*e.deltaX||e.wheelDeltaX===-3*window.devicePixelRatio*e.deltaX:e.deltaMode===0:e.wheelDeltaY?e.wheelDeltaY===-3*e.deltaY||e.wheelDeltaY===-3*window.devicePixelRatio*e.deltaY:e.deltaMode===0}var Yt=[],IA={},bx={},gE={};function KQ(e){Yt.includes(e)||Yt.push(e)}function Sv(e){delete IA[e.pointerId];for(let t=0;t<Yt.length;t++)if(Yt[t].pointerId===e.pointerId){Yt.splice(t,1);break}}function Iwe(){Yt.splice(0,Yt.length)}function LA(e){if(e.pointerType!=="touch")return;let t=IA[e.pointerId];t===void 0&&(t={x:0,y:0},IA[e.pointerId]=t),t.x=e.pageX,t.y=e.pageY}function c3(e){let t=e.pointerId===Yt[0].pointerId?Yt[1]:Yt[0];return IA[t.pointerId]}function ZQ(e){bx[e.key]=!0,gE[e.key]=gE[e.key]===void 0?1:gE[e.key]+1}function $Q(e){if(LT&&bx.Meta)for(let t in bx)bx[t]=!1;else bx[e.key]=!1;gE={}}function Lwe(e){e.addEventListener("pointerdown",KQ,!0),e.addEventListener("pointerdown",LA,!0),e.addEventListener("pointermove",LA,!0),e.addEventListener("pointerup",Sv,!0),e.addEventListener("pointercancel",Sv,!0),e.addEventListener("pointerleave",Sv,!0),window.addEventListener("keydown",ZQ,!0),window.addEventListener("keyup",$Q,!0)}function Owe(e){e.removeEventListener("pointerdown",KQ,!0),e.removeEventListener("pointerdown",LA,!0),e.removeEventListener("pointermove",LA,!0),e.removeEventListener("pointerup",Sv,!0),e.removeEventListener("pointercancel",Sv,!0),e.removeEventListener("pointerleave",Sv,!0),window.removeEventListener("keydown",ZQ,!0),window.removeEventListener("keyup",$Q,!0)}var JQ,zwe=new Promise(e=>{JQ=e}),iS;function Nwe(){if(iS)return iS;async function e(){let t="https://unpkg.com/@splinetool/navmesh-wasm@1.9.25/build",i=ip(()=>import("./navmesh-BFd9Mv4x.js"),[]),[r,n]=await Promise.all([i,fetch(`${t}/navmesh.wasm`).then(o=>o.arrayBuffer())]),s=r.default,a=await s({wasmBinary:n});JQ(a)}return iS=e(),iS}var eK,Bwe=new Promise(e=>{eK=e}),rS;function kwe(){if(rS)return rS;async function e(){let t=await ip(()=>import("./physics-BM4kW-A5.js"),[]);await t.init(),eK(t)}return rS=e(),rS}var Gt=class{modifyById(t,i){let r=this;if(r[t]===void 0)throw new Error("not expected");{let n={...r,[t]:i};return Object.setPrototypeOf(n,Gt.prototype),n}}add(t,i){var r;return((r=this.runOp({type:1,id:t,data:i}))==null?void 0:r.data)??this}runOp(t){let i=this;if(t.type===1){let r=i[t.id],n;r===void 0?n={type:2,id:t.id}:n={type:1,id:t.id,data:r};let{id:s,data:a}=t,o={...i,[s]:a};return Object.setPrototypeOf(o,Gt.prototype),{data:o,actual:t,reverse:n}}else if(t.type===2){let{id:r}=t,n=i[r];if(n===void 0)return null;{let s={...i};return Object.setPrototypeOf(s,Gt.prototype),delete s[r],{data:s,actual:t,reverse:{type:1,id:r,data:n}}}}return null}};function GB(e){if(e.deepFreeze!==void 0){e.deepFreeze(e);return}let t=Object.getOwnPropertyNames(e);for(let i of t){let r=e[i];r&&typeof r=="object"&&GB(r)}return Object.freeze(e)}function Uwe(e,t){let i=0;for(;i<e.length&&i<t.length;){if(e[i]<t[i])return-1;if(e[i]>t[i])return 1;i+=1}return i!==t.length?-1:i!==e.length?1:0}var tK=class extends Error{};function u3(e){let t={...e};return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),t}function bd(e,t,i){if(e===void 0?t===void 0?(e=0,t=10):e=t-10:t===void 0&&(t=e+10),e>t){let s=e;e=t,t=s}let r=[],n=1/(i+1);for(let s=0;s<i;s++){let a=e+(t-e)*(s+.75+Math.random()*.5)*n;r.push(a)}return r}function jB(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array}function Fwe(){return typeof process<"u"}function iK(e,t){for(let i of e)t(i.id,i.data)!==!0&&iK(i.children,t)}function rK(e,t){if(t(e.id,e.data)!==!0)for(let i of e.children)rK(i,t)}var bs=class extends Array{constructor(...e){super(...e),Object.setPrototypeOf(this,bs.prototype)}deepFreeze(){let e=0;for(;e<this.length;)GB(this[e]),e++}fillCaches0(e,t){this.objCaches.set(e.id,e),this.parentCaches.set(e.id,t);for(let i of e.children)this.fillCaches0(i,e.id)}fillCaches(){if(this.objCaches===void 0){this.objCaches=new Map,this.parentCaches=new Map;for(let e of this)this.fillCaches0(e,null)}}randomId(){this.fillCaches();let e=Array.from(this.objCaches.keys());if(e.length!==0)return e[Math.max(0,Math.floor(Math.random()*e.length)-1)]}nonExistOrDescendantOf(e,t){if(!this.has(e))return!0;for(;e;){let i=this.parent(e);if(i===t)return!0;e=i}return!1}rootAcestor(e){for(;e;){let t=this.parent(e);if(t)e=t;else return e}return e}isDescendantOf(e,t){for(;e;){let i=this.parent(e);if(i===t)return!0;e=i}return!1}data(e){var t;return(t=this.get(e))==null?void 0:t.data}has(e){return this.childrenOf(e)!==void 0}get(e){return this.fillCaches(),this.objCaches.get(e)}childrenOf(e){var t;return e===null?this:(t=this.get(e))==null?void 0:t.children}traverseFrom(e,t){if(e===null)this.traverse(t);else{let i=this.get(e);i&&rK(i,t)}}traverse(e){iK(this,e)}totalSize(){return this.fillCaches(),this.objCaches.size}parent(e){return this.fillCaches(),this.parentCaches.get(e)}childrenArray(e){return e===null?this:this.get(e).children}modifyById(e,t){if(this.get(e)===void 0)throw new Error("not expected");{let i=this.parent(e),r=this.childrenArray(i),n=r.findIndex(a=>a.id===e);if(n<0)throw new Error("not expected");let s=r[n];return r=[...r],r[n]={...s,data:t},this.modifyArrayBy(i,r)}}modifyArrayBy(e,t){let i=e,r=t;for(;i!==null;){let s=r,a=i;if(i=this.parent(i),i===void 0)throw new Error;r=this.childrenArray(i);let o=r.findIndex(l=>l.id===a);if(o<0)throw new Error;r=[...r],r[o]={...r[o],children:s}}Object.setPrototypeOf(r,bs.prototype);let n=r;return n.fillCaches(),n}runOp(e){switch(e.type){case 7:return this.addOp(e);case 8:return this.deleteOp(e);case 9:return this.moveOp(e)}return null}checkDuplicatedIdRec({id:e,children:t}){if(this.get(e)!==void 0)return!0;for(let i of t)if(this.checkDuplicatedIdRec(i))return!0;return!1}addOp(e){let{parent:t,fi:i,id:r,data:n,children:s}=e;if(t!==null&&this.get(t)===void 0||this.checkDuplicatedIdRec(e))return null;{let a=t,o=this.childrenArray(a),l={fi:i,id:r,data:n,children:s};return o=[...o,l],o.sort((c,u)=>c.fi-u.fi),e.localIndex=o.indexOf(l),{data:this.modifyArrayBy(a,o),actual:e,reverse:{type:8,id:r}}}}deleteOp(e){let{id:t}=e;if(this.get(t)===null)return null;{let i=this.parent(t);if(i===void 0)return null;let r=this.childrenArray(i),n=r.findIndex(a=>a.id===t);e.localIndex=n,r=[...r];let s=r.splice(n,1)[0];return{data:this.modifyArrayBy(i,r),actual:e,reverse:{type:7,...s,parent:i}}}}moveOp(e){let{parent:t,fi:i,id:r}=e;if(t!==null&&this.get(t)===void 0)return this.deleteOp({type:8,id:r});if(t!==null){let h=t;for(;h!==null;){if(h===void 0)throw new Error;if(h===r)throw new tK("cyclic tree");h=this.parent(h)}}let n=this.parent(r);if(n===void 0)return null;let s=n,a=this.childrenArray(n),o=a.findIndex(h=>h.id===r);a=[...a];let l=a.splice(o,1)[0],c=this.modifyArrayBy(n,a);n=t,a=c.childrenArray(n);let u=l.fi;return l={...l,fi:i},a=[...a,l],a.sort((h,d)=>h.fi-d.fi),e.localIndex=a.indexOf(l),c=c.modifyArrayBy(n,a),{data:c,actual:e,reverse:{type:9,parent:s,fi:u,id:r}}}previous(e,t){if(t===null){let r=this.childrenArray(e);return r.length===0?null:r[r.length-1].id}let i=null;for(let r of this.childrenArray(e)){if(r.id===t)return i;i=r.id}return null}traverseSortNext(e){let t=this.parent(e);if(t!==void 0){let i=this.childrenArray(t),r=i.findIndex(n=>n.id===e)+1;if(r<i.length)return i[r].id;if(t)return this.traverseSortNext(t)}}sortNext(e){let t=this.childrenArray(e);return t.length>0?t[0].id:this.traverseSortNext(e)}traverseSortPrevious(e){let t=this.childrenArray(e);return t.length>0?this.traverseSortPrevious(t[t.length-1].id):e}sortPrevious(e){let t=this.parent(e);if(t!==void 0){let i=this.childrenArray(t),r=i.findIndex(n=>n.id===e)-1;return r>=0?this.traverseSortPrevious(i[r].id):t}}getAllSorted(e){let t=[];for(let i of e){let r=this.getWithSortKey(i.id);r!==void 0&&t.push({...i,...r})}t.sort((i,r)=>Uwe(i.sortKey,r.sortKey));for(let i of t)delete i.sortKey;return t}getWithSortKey(e){var t=e;let i=[],r=this.get(t),n=r;if(r!==void 0){for(;t;)i.splice(0,0,r.fi),t=this.parent(t),t!==null&&(r=this.get(t));return{...n,sortKey:i}}}insertBeforeHelper(e,t,i){return this.insertAfterHelper(e,this.previous(e,t),i)}insertAfterHelper(e,t,i){let r=this.childrenArray(e);if(t===null){if(r.length===0)return bd(0,i,i);{let n=r[0].fi;return bd(n-i,n,i)}}else{let n=this.get(t);if(n===void 0||this.parent(t)!==e)throw new Error("illegal args");let s=r.find(a=>a.fi>n.fi);if(s===void 0){let a=r[r.length-1].fi;return bd(a,a+i,i)}else return bd(n.fi,s.fi,i)}}},OA;(e=>{function t(i,r){if(r.type!==0)return null;if(Array.isArray(i)){let n=r.props,s={},a=[...i],o=!1;if(n)for(let l of Object.keys(n)){let c=parseInt(l);if(isNaN(c))throw new Error("wrong index");s[l]=a[c],a[c]=n[l],o=!0}return o?{data:a,actual:r,reverse:{type:0,props:s}}:null}else{let n=r.props,s={},a={...i},o=!1;if(n)for(let l of Object.keys(n)){s[l]=a[l];let c=n[l];c===void 0?delete a[l]:a[l]=c,o=!0}return o?{data:a,actual:r,reverse:{type:0,props:s}}:null}}e.runOp=t})(OA||(OA={}));var Nt=class extends Array{constructor(...t){super(...t),Object.setPrototypeOf(this,Nt.prototype)}deepFreeze(){let t=0;for(;t<this.length;)GB(this[t]),t++}fillCaches0(t){this.objCaches.set(t.id,t)}fillCaches(){if(this.objCaches===void 0){this.objCaches=new Map,Object.getOwnPropertyDescriptor(this,"objCaches").enumerable=!1;for(let t of this)this.fillCaches0(t)}}randomId(){this.fillCaches();let t=Array.from(this.objCaches.keys());if(t.length!==0)return t[Math.max(0,Math.floor(Math.random()*t.length)-1)]}data(t){var i;return(i=this.get(t))==null?void 0:i.data}get(t){return this.fillCaches(),this.objCaches.get(t)}modifyById(t,i){if(this.get(t)===void 0)throw new Error("not expected");{let r=this,n=r.findIndex(a=>a.id===t);if(n<0)throw new Error("not expected");let s=r[n];return r=[...r],r[n]={...s,data:i},this.modifyArrayBy(r)}}modifyArrayBy(t){Object.setPrototypeOf(t,Nt.prototype);let i=t;return Fwe()||i.fillCaches(),i}runOp(t){switch(t.type){case 4:return this.addOp(t);case 5:return this.deleteOp(t);case 6:return this.moveOp(t)}return null}addOp(t){let{fi:i,id:r,data:n}=t,s=this,a={fi:i,id:r,data:n};return s=[...s,a],s.sort((o,l)=>o.fi-l.fi),t.localIndex=s.indexOf(a),{data:this.modifyArrayBy(s),actual:t,reverse:{type:5,id:r}}}deleteOp(t){let{id:i}=t,r=this,n=r.findIndex(a=>a.id===i);if(n===-1)return null;t.localIndex=n,r=[...r];let s=r.splice(n,1)[0];return{data:this.modifyArrayBy(r),actual:t,reverse:{type:4,...s}}}moveOp(t){let{fi:i,id:r}=t,n=this;n=[...n];let s=n.findIndex(l=>l.id===r);if(s===-1)return null;let a=n[s].fi,o={...n[s],fi:i};return n[s]=o,n.sort((l,c)=>l.fi-c.fi),t.localIndex=n.indexOf(o),{data:this.modifyArrayBy(n),actual:t,reverse:{type:6,fi:a,id:r}}}previous(t){if(t===null)return this.length===0?null:this[this.length-1].id;let i=null;for(let r of this){if(r.id===t)return i;i=r.id}return null}insertBeforeHelper(t,i){return this.insertAfterHelper(this.previous(t),i)}insertAfterHelper(t,i){let r=this;if(t===null){if(r.length===0)return bd(0,i,i);{let n=r[0].fi;return bd(n-i,n,i)}}else{let n=this.get(t);if(n===void 0)throw new Error("illegal args");let s=r.find(a=>a.fi>n.fi);if(s===void 0){let a=r[r.length-1].fi;return bd(a,a+i,i)}else return bd(n.fi,s.fi,i)}}};function Qv(e){return e&&typeof e=="object"&&e instanceof Cn}var Cn=class{unusedFunOverridesTable(e){}runOp(e){let t=[],i=this,r=0,n={};for(;r<e.path.length;){if(t.push(i),i=i===void 0?void 0:i[e.path[r]],i!==void 0&&!Qv(i))return null;r+=1}i=i?u3(i):new Cn;for(let[o,l]of Object.entries(e.props)){let c=i[o];n[o]=c,l===void 0?delete i[o]:i[o]=l}for(;r>0;){if(Object.keys(i).length===0){let o=t[r-1];o&&(i=u3(o),delete i[e.path[r-1]])}else{let o=t[r-1];if(o){let l=u3(o);l[e.path[r-1]]=i,i=l}else{let l=new Cn;l[e.path[r-1]]=i,i=l}}r-=1}let s=Object.setPrototypeOf(i,Cn.prototype),a={...e,props:n};return{data:s,actual:e,reverse:a}}},Ud;(e=>{function t(n,s){return F1(n,s)??n}e.apply=t;function i(n,s){return XB(n,s)}e.merge=i;function r(n,s){let a=0,o=s.path,l=n;for(;a<o.length&&l!==void 0;){if(l=Bn.zoomOnce(l,o[a]),l===void 0)return s;if(!Qv(l))return;a+=1}if(l===void 0)return s;if(Qv(l))if(s.type===0){let c={...s.props};for(let u of Object.keys(l))delete c[u];return{...s,props:c}}else if(s.type===1||s.type===4||s.type===7){let c=WB([s],l);return c?(console.log(c),c):s}else return s}e.filterOp=r})(Ud||(Ud={}));function WB(e,t){if(t===void 0)return;let i=!1,r=e.map(n=>{let s=n.id,a=F1(n.data,t[s]);if(i=i||a!==void 0,a===void 0&&(a=n.data),n.children){let o=WB(n.children,t);return o!==void 0?i=!0:o=n.children,{...n,id:s,data:a,children:o}}else return{...n,id:s,data:a}});if(i)return r}function Vwe(e,t){if(t===void 0)return;let i=!1,r=e.map(n=>{let s=n.id,a=F1(n.data,t[s]);return i=i||a!==void 0,a===void 0&&(a=n.data),{...n,id:s,data:a}});if(i)return Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r}function F1(e,t){if(!Qv(t))return t;if(e instanceof bs){let i=WB(e,t);return i!==void 0&&Object.setPrototypeOf(i,Object.getPrototypeOf(e)),i}else{if(e instanceof Nt)return Vwe(e,t);if(Array.isArray(e)){let i=!1,r=e.map((n,s)=>{let a=F1(n,t[s]);return i=i||a!==void 0,a===void 0&&(a=n),a});return i?(Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r):void 0}else{if(e instanceof Cn)return XB(e,t);if(e&&typeof e=="object"){let i={},r=!1;for(let[n,s]of Object.entries(e)){let a=F1(s,t[n]);r=r||a!==void 0,a===void 0&&(a=s),i[n]=a}return r?(Object.setPrototypeOf(i,Object.getPrototypeOf(e)),i):void 0}}}}function XB(e,t){if(e===void 0)return t;if(t===void 0)return e;if(!Qv(t))return t;if(!Qv(e))return Ud.apply(e,t);let i=new Set;for(let n of Object.keys(e))i.add(n);for(let n of Object.keys(t))i.add(n);let r=new Cn;for(let n of i){let s=XB(e===void 0?void 0:e[n],t===void 0?void 0:t[n]);r[n]=s}return r}function Hwe(e,t){let i={cur:[],result:[],len:0};return e=V1(e,t,i)??e,[e,i.result]}function zA(e,t){return e===null?null:(e.cur[e.len]=t,e.len+=1,e)}function NA(e){e&&(e.len-=1)}function Gwe(e){if(e===null)return null;e.result.push(e.cur.slice(0,e.len))}function nK(e,t,i){let r=!1,n=e.map(s=>{let a=s.id,o=t[a];if(o!==void 0&&typeof o=="string"&&(r=!0,a=o,i!==null))throw new Error("not supported");let l=V1(s.data,t,zA(i,a));NA(i),r=r||l!==void 0,l===void 0&&(l=s.data);let c=nK(s.children,t,i);return c!==void 0?r=!0:c=s.children,{...s,id:a,data:l,children:c}});if(r)return n}function jwe(e,t,i){let r=!1,n=e.map(s=>{let a=s.id,o=t[a];if(o!==void 0&&typeof o=="string"&&(r=!0,a=o,i!==null))throw new Error("not supported");let l=V1(s.data,t,zA(i,a));return NA(i),r=r||l!==void 0,l===void 0&&(l=s.data),{...s,id:a,data:l}});if(r)return Object.setPrototypeOf(n,Object.getPrototypeOf(e)),n}function V1(e,t,i){if(e instanceof bs){let r=nK(e,t,i);return r!==void 0&&Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r}else{if(e instanceof Nt)return jwe(e,t,i);if(Array.isArray(e)){let r=!1,n=e.map((s,a)=>{let o=V1(s,t,zA(i,a));return NA(i),r=r||o!==void 0,o===void 0&&(o=s),o});return r?(Object.setPrototypeOf(n,Object.getPrototypeOf(e)),n):void 0}else if(e&&typeof e=="object"&&!jB(e)){let r={},n=!1;for(let[s,a]of Object.entries(e))if(s!=="name"&&s!=="variableId"){let o=t[s];if(typeof o=="string"){if(i!==null)throw new Error("not supported");n=!0,s=o}let l=V1(a,t,zA(i,s));NA(i),n=n||l!==void 0,l===void 0&&(l=a),r[s]=l}else r[s]=a;return n?(Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r):void 0}else if(typeof e=="string"){let r=t[e];return r!==void 0&&Gwe(i),r}else return}}var BA;(e=>{function t(i,r){let n=Bn.zoom(r,i.path);if(typeof n=="object"){let s={};for(let a of Object.keys(i.props))s[a]=n[a];return{...i,props:s}}else return{...i,props:{}}}e.replaceProps=t})(BA||(BA={}));var rs;(e=>{function t(l,c){return{...l,path:l.path.slice(c)}}e.drop=t;function i(l,c){var u;return((u=r(l,c))==null?void 0:u.data)??l}e.applySimple=i;function r(l,c){var d,p;let u=c.path;for(var h=[];;){let f;if(l instanceof Cn&&c.type===0&&(f=l.runOp({...c,path:u.slice(h.length)}),f===null&&(f=void 0)),f===void 0&&h.length===u.length&&(l instanceof bs||l instanceof Nt||l instanceof Gt?f=l.runOp(c):f=OA.runOp(l,c)),f!==void 0)if(f!==null){let m=f.data;for(let x=h.length-1;x>=0;x--){let w=u[x],_=h[x];if(_ instanceof bs){if(typeof w=="number")throw new Error("illegal arg");m=_.modifyById(w,m)}else if(_ instanceof Nt){if(typeof w=="number")throw new Error("illegal arg");m=_.modifyById(w,m)}else if(_ instanceof Gt){if(typeof w=="number")throw new Error("illegal arg");m=_.modifyById(w,m)}else if(_ instanceof Cn){let M={..._,[w]:m};m=Object.setPrototypeOf(M,Cn.prototype)}else if(typeof _=="object")if(Array.isArray(_)){if(typeof w=="string"&&(w=parseInt(w),isNaN(w)))throw new Error("Invalid path");let M=m;m=[..._],m[w]=M}else m={..._,[w]:m};else return null}return{data:m,actual:{...f.actual,path:u},reverse:{...f.reverse,path:u}}}else return null;let v=u[h.length],g;if(l instanceof bs){if(typeof v=="number")throw new Error("");g=(d=l.get(v))==null?void 0:d.data}else if(l instanceof Nt){if(typeof v=="number")throw new Error("");g=(p=l.get(v))==null?void 0:p.data}else l!==null&&(g=l[v]);if(g!==void 0)h.push(l),l=g;else return null}}e.apply=r;function n(l,c){for(let u=0;u<l.length&&u<c.length;u++)if(l[u]!==c[u])return!0;return!1}e.pathDisjoint=n;function s(l,c){if(l.length!==c.length)return!1;for(let u=0;u<l.length;u++)if(l[u]!==c[u])return!1;return!0}e.pathEq=s;function a(l,c){return n(l.path,c.path)}e.commutative=a;function o(l,c){return l.type===0&&c.type===0&&s(l.path,c.path)?Object.keys(l.props).every(u=>c.props[u]!==void 0):!1}e.subsumed=o})(rs||(rs={}));var ZL;(e=>{function t(){return[]}e.empty=t;function i(c,u){let h=[];for(let d of c){let[p,...f]=d.path;p===u&&h.push({...d,path:f})}return h}e.removePrefix=i;function r(c,u){return c.map(h=>({...h,path:[u,...h.path]}))}e.addPrefix=r;function n(c,u){return[...c,...u]}e.concat=n;function s(c,u){return[...c.filter(h=>!u.some(d=>rs.subsumed(h,d))),...u]}e.compress=s;function a(c,u){return c.every(h=>u.every(d=>rs.commutative(h,d)))}e.commutative=a;function o(c,u){for(let h of u){let d=l(c,h);d!==null&&(c=d.data)}return c}e.applyAll=o;function l(c,u){var h=c;let d=[],p=[];for(let f of u)try{if(f.type===3||f.type===5&&f.path[f.path.length-1]==="variables"){let v,g,m;if(f.type===3?(v=Bn.zoom(h,[...f.path,f.id]),m=rs.apply(h,{...f,type:2})):(v=Bn.zoom(h,[...f.path,f.id,"value"]),m=rs.apply(h,f)),m!==null){h=m.data;let[x,w]=Hwe(h,{[f.id]:v});h=x;for(let _=0;_<w.length;_++){let M=w[_],S=M.pop();if(typeof S=="number"){let A=[S];for(let E=_+1;E<w.length;E++){let C=w[E],D=C[C.length-1];if(typeof D=="number"&&Bn.equal(M,C.slice(0,C.length-1)))A.push(D),w.splice(E,1);else break}let T=Bn.zoom(h,M);g=T.map((E,C)=>A.includes(C)?f.id:E),v=T,S=M.pop()}else{if(S==="alphaOverride"||S==="alpha"){v/=100;let A=v,T=Bn.zoom(h,M.slice(0,M.length-2)),E=T.layers.map(C=>C.id===M[M.length-1]?{...C,data:{...C.data,[S]:A}}:C);Object.setPrototypeOf(E,Object.getPrototypeOf(T.layers)),T.layers=E}g=f.id}d.push({type:0,path:M,props:{[S]:v}}),p.push({type:0,path:M,props:{[S]:g}})}p.push(m.reverse),d.push(m.actual)}}else{let v=rs.apply(h,f);v!==null&&(d.push(v.actual),h=v.data,p.push(v.reverse))}}catch(v){if(v instanceof tK)return null;throw v}return{data:h,actual:d,reverse:p.reverse()}}e.apply=l})(ZL||(ZL={}));var sK=Symbol(),Wwe=Symbol(),OT=Symbol(),Hw=class{reportOp(e,t,i=[]){let r=this;if(t===null)return;r._current=t.data;let n=i;for(;!(r instanceof oK);){let s=r._path,a=r._current;if(s!==""&&n.splice(0,0,s),r=r._parent,r===null)return;r.update(s,a)}r.push(n,e,t.actual,t.reverse)}deleteChildren(e){if(this._children){let t=this._children[e];if(t){let i=t[OT];i&&i(),delete this._children[e]}}}},Xwe=class extends Hw{constructor(e,t,i){super(),this._parent=e,this._path=t,this._current=i}update(e,t){if(Array.isArray(this._current)){if(typeof e=="string"&&(e=parseInt(e),isNaN(e)))throw new Error("Invalid path");this._current=[...this._current],this._current[e]=t}else this._current={...this._current,[e]:t}}runOp(e){this.reportOp(e,OA.runOp(this._current,e),e.path)}},qwe=class extends Hw{constructor(e,t,i){super(),this._parent=e,this._path=t,this._current=i}update(e,t){this._current={...this._current,[e]:t},Object.setPrototypeOf(this._current,Gt.prototype)}runOp(e){this.reportOp(e,this._current.runOp(e))}},aK={get(e,t){if(t===OT)return()=>{e._parent=null};if(t===sK)return e._current;if(t===Wwe)return e;let{_current:i,_children:r}=e;if(t==="push"&&Array.isArray(i))throw new Error("not supported to expand array");let n=r===void 0?void 0:r[t];if(n!==void 0)return n;let s=i[t],a=zT(e,t,s);return a!==s?(r===void 0&&(r={},e._children=r),r[t]=a,a):s},has(e,t){return t in e._current},ownKeys(e){return Reflect.ownKeys(e._current)},defineProperty(){throw Error("not supported")},getPrototypeOf(e){return Object.getPrototypeOf(e._current)},setPrototypeOf(){throw Error("not supported")},getOwnPropertyDescriptor(e,t){let i=e._current,r=Reflect.getOwnPropertyDescriptor(i,t);return r&&{writable:!0,configurable:!0,enumerable:r.enumerable,value:i[t]}}},Ywe={...aK,set(e,t,i){let r={type:0,props:{[t]:on(i)??i}};return e.deleteChildren(t),e.runOp(r),!0},deleteProperty(e,t){let i={type:0,props:{[t]:void 0}};return e.deleteChildren(t),e.runOp(i),!0}},Qwe={...aK,set(e,t,i){return i===void 0?this.deleteProperty(e,t):(e.deleteChildren(t),e.runOp({type:1,id:t,data:i})),!0},deleteProperty(e,t){return e.runOp({type:2,id:t}),!0}},qB=class extends Hw{constructor(e,t,i){super(),this._children={},this._parent=e,this._path=t,this._current=i,this[OT]=()=>{this._parent=null}}unproxy(){return this._current}update(e,t){this._current=this._current.modifyById(e,t)}runOp(e){this.reportOp(e,this._current.runOp(e))}randomId(){return this._current.randomId()}isDescendantOf(e,t){return this._current.isDescendantOf(e,t)}childrenOf(e){return this._current.childrenOf(e)}traverse(e){return this._current.traverse(e)}get(e){return this._current.get(e)}parent(e){return this._current.parent(e)}traverse(e){this._current.traverse((t,i)=>{e(t,this.data(t))})}data(e){var a;let{_current:t,_children:i}=this,r=i===void 0?void 0:i[e];if(r!==void 0)return r;let n=(a=t.get(e))==null?void 0:a.data,s=zT(this,e,n);return s!==n?(i===void 0&&(i={},this._children=i),i[e]=s,s):n}add(e,t,i,r,n){this.runOp({type:7,parent:e,fi:t,id:i,data:r,children:n})}move(e,t,i){this.runOp({type:9,parent:e,fi:t,id:i})}insertAfter(e,t,i){let r=this._current.insertAfterHelper(e,t,i.length);for(let n=0;n<i.length;n++){let s=i[n];this.add(e,r[n],s.id,s.data,s.children)}}insertBefore(e,t,i){let r=this._current.insertBeforeHelper(e,t,i.length);for(let n=0;n<i.length;n++){let s=i[n];this.add(e,r[n],s.id,s.data,s.children)}}moveAfter(e,t,i){let r=this._current.insertAfterHelper(e,t,i.length);for(let n=0;n<i.length;n++){let s=i[n];this.move(e,r[n],s)}}moveBefore(e,t,i){let r=this._current.insertBeforeHelper(e,t,i.length);for(let n=0;n<i.length;n++){let s=i[n];this.move(e,r[n],s)}}delete(e){this.deleteChildren(e),this.runOp({type:8,id:e})}sortNext(e){return this._current.sortNext(e)}sortPrevious(e){return this._current.sortPrevious(e)}getAllSorted(e){return this._current.getAllSorted(e)}},YB=class extends Hw{constructor(e,t,i){super(),this._children={},this._parent=e,this._path=t,this._current=i,this[OT]=()=>{this._parent=null}}unproxy(){return this._current}get length(){return this._current.length}forEach(e){let t=this.length;for(let i=0;i<t;i++){let r=this._current[i].id,n=this._current[i].fi;e(this.data(this._current[i].id),r,n)}}find(e){let t=this.length;for(let i=0;i<t;i++){let r=this._current[i].id;if(e(this.data(r),r))return this.get(r)}}update(e,t){this._current=this._current.modifyById(e,t)}randomId(){return this._current.randomId()}get(e){return{...this._current.get(e),data:this.data(e)}}data(e){var a;let{_current:t,_children:i}=this,r=i===void 0?void 0:i[e];if(r!==void 0)return r;let n=(a=t.get(e))==null?void 0:a.data,s=zT(this,e,n);return s!==n?(i===void 0&&(i={},this._children=i),i[e]=s,s):n}runOp(e){this.reportOp(e,this._current.runOp(e))}add(e,t,i){this.runOp({type:4,fi:e,id:t,data:i})}move(e,t){this.runOp({type:6,fi:e,id:t})}insertAfter(e,t){let i=this._current.insertAfterHelper(e,t.length);for(let r=0;r<t.length;r++){let n=t[r];this.add(i[r],n.id,n.data)}}insertBefore(e,t){let i=this._current.insertBeforeHelper(e,t.length);for(let r=0;r<t.length;r++){let n=t[r];this.add(i[r],n.id,n.data)}}moveAfter(e,t){let i=this._current.insertAfterHelper(e,t.length);for(let r=0;r<t.length;r++){let n=t[r];this.move(i[r],n)}}moveBefore(e,t){let i=this._current.insertBeforeHelper(e,t.length);for(let r=0;r<t.length;r++){let n=t[r];this.move(i[r],n)}}delete(e){this.deleteChildren(e),this.runOp({type:5,id:e})}};function h3(e,t,i){if(e.length>0){let r=e[e.length-1];if(r.type===0&&t.type===0&&Bn.equal(r.path,i)){Object.assign(r.props,t.props);return}}e.push({...t,path:i})}var oK=class extends Hw{constructor(e){super(),this.ts=[],this.actual=[],this.reverse=[],this._current=e}update(e,t){if(e!=="")throw new Error("");this._current=t}push(e,t,i,r){h3(this.ts,t,e),h3(this.actual,i,e),h3(this.reverse,r,e)}result(){return{data:this._current,ts:this.ts,actual:this.actual,reverse:this.reverse.reverse()}}};function zT(e,t,i){return i instanceof bs?new qB(e,t,i):i instanceof Nt?new YB(e,t,i):i instanceof Gt?new Proxy(new qwe(e,t,i),Qwe):i!==null&&typeof i=="object"?jB(i)?i:new Proxy(new Xwe(e,t,i),Ywe):i}function lK(e){let t=new oK(e);return[zT(t,"",e),t]}function H1(e,t){let[i,r]=lK(e);return t(i),r.result()}function on(e){return e instanceof qB||e instanceof YB?e._current:e!==null&&typeof e=="object"?e[sK]:e}var Bn;(e=>{function t(s,a){if(a.length===s.length)for(var o=0;o<s.length;){if(s[o]!==a[o])return!1;o+=1}else return!1;return!0}e.equal=t;function i(s,a,o){let l=n(o,s);if(l!==void 0&&typeof l=="object"&&l!==null){let c={...a};return Object.keys(l).forEach(u=>{delete c[u]}),c}else return a}e.removeOverridden=i;function r(s,a){if((s instanceof bs||s instanceof qB)&&typeof a=="string"||(s instanceof Nt||s instanceof YB)&&typeof a=="string")return s.data(a);if(typeof a=="number"&&Array.isArray(s)||typeof a=="string"&&typeof s=="object"&&s!==null)return s[a]}e.zoomOnce=r;function n(s,a,o=0){for(;o<a.length&&s!==void 0;)s=r(s,a[o]),o+=1;return s}e.zoom=n})(Bn||(Bn={}));function Kwe(e,t){let i=[];if(t.length===e.length)for(var r=0;r<e.length;){if(t[r]==="*")i.push(e[r]);else if(e[r]!==t[r])return null;r+=1}else return null;return i}function hr(e,t){let i=[];if(t.length<=e.length)for(var r=0;r<t.length;){if(t[r]==="*")i.push(e[r]);else if(e[r]!==t[r])return null;r+=1}else return null;return i}var cK=class{},nG=class extends cK{constructor(e){super(),this.id=e}},sG=class extends cK{constructor(e){super(),this.data=e}},$L;try{$L=new TextDecoder}catch{}var Dt,Fd,He=0,Oa={},ji,_d,Uo=0,Tc=0,ao,ih,xa=[],er,aG={useRecords:!1,mapsAsObjects:!0},uK=class{},hK=new uK;hK.name="MessagePack 0xC1";var Kv=!1,kA=class{constructor(e){e&&(e.useRecords===!1&&e.mapsAsObjects===void 0&&(e.mapsAsObjects=!0),e.structures?e.structures.sharedLength=e.structures.length:e.getStructures&&((e.structures=[]).uninitialized=!0,e.structures.sharedLength=0)),Object.assign(this,e)}unpack(e,t){if(Dt)return vK(()=>(eO(),this?this.unpack(e,t):kA.prototype.unpack.call(aG,e,t)));Fd=t>-1?t:e.length,He=0,Tc=0,_d=null,ao=null,Dt=e;try{er=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(i){throw Dt=null,e instanceof Uint8Array?i:new Error("Source must be a Uint8Array or Buffer but was a "+(e&&typeof e=="object"?e.constructor.name:typeof e))}if(this instanceof kA){if(Oa=this,this.structures)return ji=this.structures,nS();(!ji||ji.length>0)&&(ji=[])}else Oa=aG,(!ji||ji.length>0)&&(ji=[]);return nS()}unpackMultiple(e,t){let i,r=0;try{Kv=!0;let n=e.length,s=this?this.unpack(e,n):BT.unpack(e,n);if(t){for(t(s);He<n;)if(r=He,t(nS())===!1)return}else{for(i=[s];He<n;)r=He,i.push(nS());return i}}catch(n){throw n.lastPosition=r,n.values=i,n}finally{Kv=!1,eO()}}_mergeStructures(e,t){e=e||[];for(let i=0,r=e.length;i<r;i++){let n=e[i];n&&(n.isShared=!0,i>=32&&(n.highByte=i-32>>5))}e.sharedLength=e.length;for(let i in t||[])if(i>=0){let r=e[i],n=t[i];n&&(r&&((e.restoreStructures||(e.restoreStructures=[]))[i]=r),e[i]=n)}return this.structures=e}decode(e,t){return this.unpack(e,t)}};function nS(){try{if(!Oa.trusted&&!Kv){let t=ji.sharedLength||0;t<ji.length&&(ji.length=t)}let e=Yr();if(He==Fd)ji.restoreStructures&&oG(),ji=null,Dt=null,ih&&(ih=null);else if(He>Fd){let t=new Error("Unexpected end of MessagePack data");throw t.incomplete=!0,t}else if(!Kv)throw new Error("Data read, but end of buffer not reached");return e}catch(e){throw ji.restoreStructures&&oG(),eO(),(e instanceof RangeError||e.message.startsWith("Unexpected end of buffer"))&&(e.incomplete=!0),e}}function oG(){for(let e in ji.restoreStructures)ji[e]=ji.restoreStructures[e];ji.restoreStructures=null}function Yr(){let e=Dt[He++];if(e<160)if(e<128){if(e<64)return e;{let t=ji[e&63]||Oa.getStructures&&dK()[e&63];return t?(t.read||(t.read=QB(t,e&63)),t.read()):e}}else if(e<144)if(e-=128,Oa.mapsAsObjects){let t={};for(let i=0;i<e;i++)t[fK()]=Yr();return t}else{let t=new Map;for(let i=0;i<e;i++)t.set(Yr(),Yr());return t}else{e-=144;let t=new Array(e);for(let i=0;i<e;i++)t[i]=Yr();return t}else if(e<192){let t=e-160;if(Tc>=He)return _d.slice(He-Uo,(He+=t)-Uo);if(Tc==0&&Fd<140){let i=t<16?KB(t):pK(t);if(i!=null)return i}return JL(t)}else{let t;switch(e){case 192:return null;case 193:return ao?(t=Yr(),t>0?ao[1].slice(ao.position1,ao.position1+=t):ao[0].slice(ao.position0,ao.position0-=t)):hK;case 194:return!1;case 195:return!0;case 196:return d3(Dt[He++]);case 197:return t=er.getUint16(He),He+=2,d3(t);case 198:return t=er.getUint32(He),He+=4,d3(t);case 199:return bp(Dt[He++]);case 200:return t=er.getUint16(He),He+=2,bp(t);case 201:return t=er.getUint32(He),He+=4,bp(t);case 202:if(t=er.getFloat32(He),Oa.useFloat32>2){let i=ZB[(Dt[He]&127)<<1|Dt[He+1]>>7];return He+=4,(i*t+(t>0?.5:-.5)>>0)/i}return He+=4,t;case 203:return t=er.getFloat64(He),He+=8,t;case 204:return Dt[He++];case 205:return t=er.getUint16(He),He+=2,t;case 206:return t=er.getUint32(He),He+=4,t;case 207:return Oa.int64AsNumber?(t=er.getUint32(He)*4294967296,t+=er.getUint32(He+4)):t=er.getBigUint64(He),He+=8,t;case 208:return er.getInt8(He++);case 209:return t=er.getInt16(He),He+=2,t;case 210:return t=er.getInt32(He),He+=4,t;case 211:return Oa.int64AsNumber?(t=er.getInt32(He)*4294967296,t+=er.getUint32(He+4)):t=er.getBigInt64(He),He+=8,t;case 212:if(t=Dt[He++],t==114)return dG(Dt[He++]&63);{let i=xa[t];if(i)return i.read?(He++,i.read(Yr())):i.noBuffer?(He++,i()):i(Dt.subarray(He,++He));throw new Error("Unknown extension "+t)}case 213:return t=Dt[He],t==114?(He++,dG(Dt[He++]&63,Dt[He++])):bp(2);case 214:return bp(4);case 215:return bp(8);case 216:return bp(16);case 217:return t=Dt[He++],Tc>=He?_d.slice(He-Uo,(He+=t)-Uo):$we(t);case 218:return t=er.getUint16(He),He+=2,Tc>=He?_d.slice(He-Uo,(He+=t)-Uo):Jwe(t);case 219:return t=er.getUint32(He),He+=4,Tc>=He?_d.slice(He-Uo,(He+=t)-Uo):ebe(t);case 220:return t=er.getUint16(He),He+=2,cG(t);case 221:return t=er.getUint32(He),He+=4,cG(t);case 222:return t=er.getUint16(He),He+=2,uG(t);case 223:return t=er.getUint32(He),He+=4,uG(t);default:if(e>=224)return e-256;if(e===void 0){let i=new Error("Unexpected end of MessagePack data");throw i.incomplete=!0,i}throw new Error("Unknown MessagePack token "+e)}}}var Zwe=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function QB(e,t){function i(){if(i.count++>2){let n=e.read=new Function("r","return function(){return {"+e.map(s=>Zwe.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"}}")(Yr);return e.highByte===0&&(e.read=lG(t,e.read)),n()}let r={};for(let n=0,s=e.length;n<s;n++){let a=e[n];r[a]=Yr()}return r}return i.count=0,e.highByte===0?lG(t,i):i}var lG=(e,t)=>function(){let i=Dt[He++];if(i===0)return t();let r=e<32?-(e+(i<<5)):e+(i<<5),n=ji[r]||dK()[r];if(!n)throw new Error("Record id is not defined for "+r);return n.read||(n.read=QB(n,e)),n.read()};function dK(){let e=vK(()=>(Dt=null,Oa.getStructures()));return ji=Oa._mergeStructures(e,ji)}var JL=NT,$we=NT,Jwe=NT,ebe=NT;function NT(e){let t;if(e<16&&(t=KB(e)))return t;if(e>64&&$L)return $L.decode(Dt.subarray(He,He+=e));let i=He+e,r=[];for(t="";He<i;){let n=Dt[He++];if(!(n&128))r.push(n);else if((n&224)===192){let s=Dt[He++]&63;r.push((n&31)<<6|s)}else if((n&240)===224){let s=Dt[He++]&63,a=Dt[He++]&63;r.push((n&31)<<12|s<<6|a)}else if((n&248)===240){let s=Dt[He++]&63,a=Dt[He++]&63,o=Dt[He++]&63,l=(n&7)<<18|s<<12|a<<6|o;l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|l&1023),r.push(l)}else r.push(n);r.length>=4096&&(t+=Kn.apply(String,r),r.length=0)}return r.length>0&&(t+=Kn.apply(String,r)),t}function cG(e){let t=new Array(e);for(let i=0;i<e;i++)t[i]=Yr();return t}function uG(e){if(Oa.mapsAsObjects){let t={};for(let i=0;i<e;i++)t[fK()]=Yr();return t}else{let t=new Map;for(let i=0;i<e;i++)t.set(Yr(),Yr());return t}}var Kn=String.fromCharCode;function pK(e){let t=He,i=new Array(e);for(let r=0;r<e;r++){let n=Dt[He++];if((n&128)>0){He=t;return}i[r]=n}return Kn.apply(String,i)}function KB(e){if(e<4)if(e<2){if(e===0)return"";{let t=Dt[He++];if((t&128)>1){He-=1;return}return Kn(t)}}else{let t=Dt[He++],i=Dt[He++];if((t&128)>0||(i&128)>0){He-=2;return}if(e<3)return Kn(t,i);let r=Dt[He++];if((r&128)>0){He-=3;return}return Kn(t,i,r)}else{let t=Dt[He++],i=Dt[He++],r=Dt[He++],n=Dt[He++];if((t&128)>0||(i&128)>0||(r&128)>0||(n&128)>0){He-=4;return}if(e<6){if(e===4)return Kn(t,i,r,n);{let s=Dt[He++];if((s&128)>0){He-=5;return}return Kn(t,i,r,n,s)}}else if(e<8){let s=Dt[He++],a=Dt[He++];if((s&128)>0||(a&128)>0){He-=6;return}if(e<7)return Kn(t,i,r,n,s,a);let o=Dt[He++];if((o&128)>0){He-=7;return}return Kn(t,i,r,n,s,a,o)}else{let s=Dt[He++],a=Dt[He++],o=Dt[He++],l=Dt[He++];if((s&128)>0||(a&128)>0||(o&128)>0||(l&128)>0){He-=8;return}if(e<10){if(e===8)return Kn(t,i,r,n,s,a,o,l);{let c=Dt[He++];if((c&128)>0){He-=9;return}return Kn(t,i,r,n,s,a,o,l,c)}}else if(e<12){let c=Dt[He++],u=Dt[He++];if((c&128)>0||(u&128)>0){He-=10;return}if(e<11)return Kn(t,i,r,n,s,a,o,l,c,u);let h=Dt[He++];if((h&128)>0){He-=11;return}return Kn(t,i,r,n,s,a,o,l,c,u,h)}else{let c=Dt[He++],u=Dt[He++],h=Dt[He++],d=Dt[He++];if((c&128)>0||(u&128)>0||(h&128)>0||(d&128)>0){He-=12;return}if(e<14){if(e===12)return Kn(t,i,r,n,s,a,o,l,c,u,h,d);{let p=Dt[He++];if((p&128)>0){He-=13;return}return Kn(t,i,r,n,s,a,o,l,c,u,h,d,p)}}else{let p=Dt[He++],f=Dt[He++];if((p&128)>0||(f&128)>0){He-=14;return}if(e<15)return Kn(t,i,r,n,s,a,o,l,c,u,h,d,p,f);let v=Dt[He++];if((v&128)>0){He-=15;return}return Kn(t,i,r,n,s,a,o,l,c,u,h,d,p,f,v)}}}}}function d3(e){return Oa.copyBuffers?Uint8Array.prototype.slice.call(Dt,He,He+=e):Dt.subarray(He,He+=e)}function bp(e){let t=Dt[He++];if(xa[t])return xa[t](Dt.subarray(He,He+=e));throw new Error("Unknown extension type "+t)}var hG=new Array(4096);function fK(){let e=Dt[He++];if(e>=160&&e<192){if(e=e-160,Tc>=He)return _d.slice(He-Uo,(He+=e)-Uo);if(!(Tc==0&&Fd<180))return JL(e)}else return He--,Yr();let t=(e<<5^(e>1?er.getUint16(He):e>0?Dt[He]:0))&4095,i=hG[t],r=He,n=He+e-3,s,a=0;if(i&&i.bytes==e){for(;r<n;){if(s=er.getUint32(r),s!=i[a++]){r=1879048192;break}r+=4}for(n+=3;r<n;)if(s=Dt[r++],s!=i[a++]){r=1879048192;break}if(r===n)return He=r,i.string;n-=3,r=He}for(i=[],hG[t]=i,i.bytes=e;r<n;)s=er.getUint32(r),i.push(s),r+=4;for(n+=3;r<n;)s=Dt[r++],i.push(s);let o=e<16?KB(e):pK(e);return o!=null?i.string=o:i.string=JL(e)}var dG=(e,t)=>{var i=Yr();let r=e;t!==void 0&&(e=e<32?-((t<<5)+e):(t<<5)+e,i.highByte=t);let n=ji[e];return n&&n.isShared&&((ji.restoreStructures||(ji.restoreStructures=[]))[e]=n),ji[e]=i,i.read=QB(i,r),i.read()},mK=typeof self=="object"?self:global;xa[0]=()=>{};xa[0].noBuffer=!0;xa[101]=()=>{let e=Yr();return(mK[e[0]]||Error)(e[1])};xa[105]=e=>{let t=er.getUint32(He-4);ih||(ih=new Map);let i=Dt[He],r;i>=144&&i<160||i==220||i==221?r=[]:r={};let n={target:r};ih.set(t,n);let s=Yr();return n.used?Object.assign(r,s):(n.target=s,s)};xa[112]=e=>{let t=er.getUint32(He-4),i=ih.get(t);return i.used=!0,i.target};xa[115]=()=>new Set(Yr());var gK=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(e=>e+"Array");xa[116]=e=>{let t=e[0],i=gK[t];if(!i)throw new Error("Could not find typed array for code "+t);return new mK[i](Uint8Array.prototype.slice.call(e,1).buffer)};xa[120]=()=>{let e=Yr();return new RegExp(e[0],e[1])};xa[98]=e=>{let t=(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3],i=He;He+=t-4,ao=[Yr(),Yr()],ao.position0=0,ao.position1=0;let r=He;He=i;try{return Yr()}finally{He=r}};xa[255]=e=>e.length==4?new Date((e[0]*16777216+(e[1]<<16)+(e[2]<<8)+e[3])*1e3):e.length==8?new Date(((e[0]<<22)+(e[1]<<14)+(e[2]<<6)+(e[3]>>2))/1e6+((e[3]&3)*4294967296+e[4]*16777216+(e[5]<<16)+(e[6]<<8)+e[7])*1e3):e.length==12?new Date(((e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3])/1e6+((e[4]&128?-281474976710656:0)+e[6]*1099511627776+e[7]*4294967296+e[8]*16777216+(e[9]<<16)+(e[10]<<8)+e[11])*1e3):new Date("invalid");function vK(e){let t=Fd,i=He,r=Uo,n=Tc,s=_d,a=ih,o=ao,l=new Uint8Array(Dt.slice(0,Fd)),c=ji,u=ji.slice(0,ji.length),h=Oa,d=Kv,p=e();return Fd=t,He=i,Uo=r,Tc=n,_d=s,ih=a,ao=o,Dt=l,Kv=d,ji=c,ji.splice(0,ji.length,...u),Oa=h,er=new DataView(Dt.buffer,Dt.byteOffset,Dt.byteLength),p}function eO(){Dt=null,ih=null,ji=null}function tbe(e){e.unpack?xa[e.type]=e.unpack:xa[e.type]=e}var ZB=new Array(147);for(let e=0;e<256;e++)ZB[e]=+("1e"+Math.floor(45.15-e*.30103));var BT=new kA({useRecords:!1});BT.unpack;BT.unpackMultiple;BT.unpack;var ibe=new Float32Array(1);new Uint8Array(ibe.buffer,0,4);var vE;try{vE=new TextEncoder}catch{}var UA,$B,kT=typeof Buffer<"u",p3=kT?Buffer.allocUnsafeSlow:Uint8Array,yK=kT?Buffer:Uint8Array,pG=kT?4294967296:2144337920,lt,rn,Xe=0,sc,ac=null,rbe=/[\u0080-\uFFFF]/,Dy=Symbol("record-id"),xK=class extends kA{constructor(e){super(e),this.offset=0;let t,i,r,n,s,a=0,o=yK.prototype.utf8Write?function(S,A,T){return lt.utf8Write(S,A,T)}:vE&&vE.encodeInto?function(S,A){return vE.encodeInto(S,lt.subarray(A)).written}:!1,l=this;e||(e={});let c=e&&e.sequential,u=e.structures||e.saveStructures,h=e.maxSharedStructures;if(h==null&&(h=u?32:0),h>8160)throw new Error("Maximum maxSharedStructure is 8160");let d=e.maxOwnStructures;d==null&&(d=u?32:64),c&&!e.saveStructures&&(this.structures=[]);let p=h>32||d+h>64,f=h+64,v=h+d+64;if(v>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let g=[],m=0,x=0;this.pack=this.encode=function(S,A){if(lt||(lt=new p3(8192),rn=new DataView(lt.buffer,0,8192),Xe=0),sc=lt.length-10,sc-Xe<2048?(lt=new p3(lt.length),rn=new DataView(lt.buffer,0,lt.length),sc=lt.length-10,Xe=0):Xe=Xe+7&2147483640,t=Xe,s=l.structuredClone?new Map:null,l.bundleStrings?(ac=["",""],lt[Xe++]=214,lt[Xe++]=98,ac.position=Xe-t,Xe+=4):ac=null,i=l.structures,i){i.uninitialized&&(i=l._mergeStructures(l.getStructures()));let T=i.sharedLength||0;if(T>h)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let E=0;E<T;E++){let C=i[E];if(!C)continue;let D,I=i.transitions;for(let L=0,z=C.length;L<z;L++){let F=C[L];D=I[F],D||(D=I[F]=Object.create(null)),I=D}I[Dy]=E+64}a=T}c||(i.nextId=T+64)}r&&(r=!1),n=i||[];try{if(w(S),ac){rn.setUint32(ac.position+t,Xe-ac.position-t);let T=ac;ac=null,w(T[0]),w(T[1])}if(l.offset=Xe,s&&s.idsToInsert){Xe+=s.idsToInsert.length*6,Xe>sc&&M(Xe),l.offset=Xe;let T=sbe(lt.subarray(t,Xe),s.idsToInsert);return s=null,T}return A&abe?(lt.start=t,lt.end=Xe,lt):lt.subarray(t,Xe)}finally{if(i){if(x<10&&x++,m>1e4)i.transitions=null,x=0,m=0,g.length>0&&(g=[]);else if(g.length>0&&!c){for(let T=0,E=g.length;T<E;T++)g[T][Dy]=0;g=[]}if(r&&l.saveStructures){let T=i.sharedLength||h;i.length>T&&(i=i.slice(0,T));let E=lt.subarray(t,Xe);return l.saveStructures(i,a)===!1?(l._mergeStructures(l.getStructures()),l.pack(S)):(a=T,E)}}A&obe&&(Xe=t)}};let w=S=>{Xe>sc&&(lt=M(Xe));var A=typeof S,T;if(A==="string"){let E=S.length;if(ac&&E>=8&&E<4096){let I=rbe.test(S);ac[I?0:1]+=S,lt[Xe++]=193,w(I?-E:E);return}let C;E<32?C=1:E<256?C=2:E<65536?C=3:C=5;let D=E*3;if(Xe+D>sc&&(lt=M(Xe+D)),E<64||!o){let I,L,z,F=Xe+C;for(I=0;I<E;I++)L=S.charCodeAt(I),L<128?lt[F++]=L:L<2048?(lt[F++]=L>>6|192,lt[F++]=L&63|128):(L&64512)===55296&&((z=S.charCodeAt(I+1))&64512)===56320?(L=65536+((L&1023)<<10)+(z&1023),I++,lt[F++]=L>>18|240,lt[F++]=L>>12&63|128,lt[F++]=L>>6&63|128,lt[F++]=L&63|128):(lt[F++]=L>>12|224,lt[F++]=L>>6&63|128,lt[F++]=L&63|128);T=F-Xe-C}else T=o(S,Xe+C,D);T<32?lt[Xe++]=160|T:T<256?(C<2&&lt.copyWithin(Xe+2,Xe+1,Xe+1+T),lt[Xe++]=217,lt[Xe++]=T):T<65536?(C<3&&lt.copyWithin(Xe+3,Xe+2,Xe+2+T),lt[Xe++]=218,lt[Xe++]=T>>8,lt[Xe++]=T&255):(C<5&&lt.copyWithin(Xe+5,Xe+3,Xe+3+T),lt[Xe++]=219,rn.setUint32(Xe,T),Xe+=4),Xe+=T}else if(A==="number")if(S>>>0===S)S<64?lt[Xe++]=S:S<256?(lt[Xe++]=204,lt[Xe++]=S):S<65536?(lt[Xe++]=205,lt[Xe++]=S>>8,lt[Xe++]=S&255):(lt[Xe++]=206,rn.setUint32(Xe,S),Xe+=4);else if(S>>0===S)S>=-32?lt[Xe++]=256+S:S>=-128?(lt[Xe++]=208,lt[Xe++]=S+256):S>=-32768?(lt[Xe++]=209,rn.setInt16(Xe,S),Xe+=2):(lt[Xe++]=210,rn.setInt32(Xe,S),Xe+=4);else{let E;if((E=this.useFloat32)>0&&S<4294967296&&S>=-2147483648){lt[Xe++]=202,rn.setFloat32(Xe,S);let C;if(E<4||(C=S*ZB[(lt[Xe]&127)<<1|lt[Xe+1]>>7])>>0===C){Xe+=4;return}else Xe--}lt[Xe++]=203,rn.setFloat64(Xe,S),Xe+=8}else if(A==="object")if(!S)lt[Xe++]=192;else{if(s){let C=s.get(S);if(C){if(!C.id){let D=s.idsToInsert||(s.idsToInsert=[]);C.id=D.push(C)}lt[Xe++]=214,lt[Xe++]=112,rn.setUint32(Xe,C.id),Xe+=4;return}else s.set(S,{offset:Xe-t})}let E=S.constructor;if(E===Object)_(S,!0);else if(E===Array){T=S.length,T<16?lt[Xe++]=144|T:T<65536?(lt[Xe++]=220,lt[Xe++]=T>>8,lt[Xe++]=T&255):(lt[Xe++]=221,rn.setUint32(Xe,T),Xe+=4);for(let C=0;C<T;C++)w(S[C])}else if(E===Map){T=S.size,T<16?lt[Xe++]=128|T:T<65536?(lt[Xe++]=222,lt[Xe++]=T>>8,lt[Xe++]=T&255):(lt[Xe++]=223,rn.setUint32(Xe,T),Xe+=4);for(let[C,D]of S)w(C),w(D)}else{for(let C=0,D=UA.length;C<D;C++){let I=$B[C];if(S instanceof I){let L=UA[C];if(L.write){L.type&&(lt[Xe++]=212,lt[Xe++]=L.type,lt[Xe++]=0),w(L.write.call(this,S));return}let z=lt,F=rn,Q=Xe;lt=null;let Y;try{Y=L.pack.call(this,S,O=>(lt=z,z=null,Xe+=O,Xe>sc&&M(Xe),{target:lt,targetView:rn,position:Xe-O}),w)}finally{z&&(lt=z,rn=F,Xe=Q,sc=lt.length-10)}Y&&(Y.length+Xe>sc&&M(Y.length+Xe),Xe=nbe(Y,lt,Xe,L.type));return}}_(S,!S.hasOwnProperty)}}else if(A==="boolean")lt[Xe++]=S?195:194;else if(A==="bigint"){if(S<BigInt(1)<<BigInt(63)&&S>=-(BigInt(1)<<BigInt(63)))lt[Xe++]=211,rn.setBigInt64(Xe,S);else if(S<BigInt(1)<<BigInt(64)&&S>0)lt[Xe++]=207,rn.setBigUint64(Xe,S);else if(this.largeBigIntToFloat)lt[Xe++]=203,rn.setFloat64(Xe,Number(S));else throw new RangeError(S+" was too large to fit in MessagePack 64-bit integer format, set largeBigIntToFloat to convert to float-64");Xe+=8}else if(A==="undefined")this.encodeUndefinedAsNil?lt[Xe++]=192:(lt[Xe++]=212,lt[Xe++]=0,lt[Xe++]=0);else if(A==="function")w(this.writeFunction&&this.writeFunction());else throw new Error("Unknown type: "+A)},_=this.useRecords===!1?this.variableMapSize?S=>{let A=Object.keys(S),T=A.length;T<16?lt[Xe++]=128|T:T<65536?(lt[Xe++]=222,lt[Xe++]=T>>8,lt[Xe++]=T&255):(lt[Xe++]=223,rn.setUint32(Xe,T),Xe+=4);let E;for(let C=0;C<T;C++)w(E=A[C]),w(S[E])}:(S,A)=>{lt[Xe++]=222;let T=Xe-t;Xe+=2;let E=0;for(let C in S)(A||S.hasOwnProperty(C))&&(w(C),w(S[C]),E++);lt[T+++t]=E>>8,lt[T+t]=E&255}:S=>{let A=Object.keys(S),T,E=n.transitions||(n.transitions=Object.create(null)),C=0;for(let I=0,L=A.length;I<L;I++){let z=A[I];T=E[z],T||(T=E[z]=Object.create(null),C++),E=T}let D=E[Dy];if(D)D>=96&&p?(lt[Xe++]=((D-=96)&31)+96,lt[Xe++]=D>>5):lt[Xe++]=D;else{D=n.nextId,D||(D=64),D<f&&this.shouldShareStructure&&!this.shouldShareStructure(A)?(D=n.nextOwnId,D<v||(D=f),n.nextOwnId=D+1):(D>=v&&(D=f),n.nextId=D+1);let I=A.highByte=D>=96&&p?D-96>>5:-1;E[Dy]=D,n[D-64]=A,D<f?(A.isShared=!0,n.sharedLength=D-63,r=!0,I>=0?(lt[Xe++]=(D&31)+96,lt[Xe++]=I):lt[Xe++]=D):(I>=0?(lt[Xe++]=213,lt[Xe++]=114,lt[Xe++]=(D&31)+96,lt[Xe++]=I):(lt[Xe++]=212,lt[Xe++]=114,lt[Xe++]=D),C&&(m+=x*C),g.length>=d&&(g.shift()[Dy]=0),g.push(E),w(A))}for(let I=0,L=A.length;I<L;I++)w(S[A[I]])},M=S=>{let A;if(S>16777216){if(S-t>pG)throw new Error("Packed buffer would be larger than maximum buffer size");A=Math.min(pG,Math.round(Math.max((S-t)*(S>67108864?1.25:2),4194304)/4096)*4096)}else A=(Math.max(S-t<<2,lt.length-1)>>12)+1<<12;let T=new p3(A);return rn=new DataView(T.buffer,0,A),lt.copy?lt.copy(T,0,t,S):T.set(lt.slice(t,S)),Xe-=t,t=0,sc=T.length-10,lt=T}}useBuffer(e){lt=e,rn=new DataView(lt.buffer,lt.byteOffset,lt.byteLength),Xe=0}};$B=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,uK];UA=[{pack(e,t,i){let r=e.getTime()/1e3;if((this.useTimestamp32||e.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:n,targetView:s,position:a}=t(6);n[a++]=214,n[a++]=255,s.setUint32(a,r)}else if(r>0&&r<17179869184){let{target:n,targetView:s,position:a}=t(10);n[a++]=215,n[a++]=255,s.setUint32(a,e.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),s.setUint32(a+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return t(0),i(this.onInvalidDate());let{target:n,targetView:s,position:a}=t(3);n[a++]=212,n[a++]=255,n[a++]=255}else{let{target:n,targetView:s,position:a}=t(15);n[a++]=199,n[a++]=12,n[a++]=255,s.setUint32(a,e.getMilliseconds()*1e6),s.setBigInt64(a+4,BigInt(Math.floor(r)))}}},{pack(e,t,i){let r=Array.from(e),{target:n,position:s}=t(this.structuredClone?3:0);this.structuredClone&&(n[s++]=212,n[s++]=115,n[s++]=0),i(r)}},{pack(e,t,i){let{target:r,position:n}=t(this.structuredClone?3:0);this.structuredClone&&(r[n++]=212,r[n++]=101,r[n++]=0),i([e.name,e.message])}},{pack(e,t,i){let{target:r,position:n}=t(this.structuredClone?3:0);this.structuredClone&&(r[n++]=212,r[n++]=120,r[n++]=0),i([e.source,e.flags])}},{pack(e,t){this.structuredClone?fG(e,16,t):mG(kT?Buffer.from(e):new Uint8Array(e),t)}},{pack(e,t){let i=e.constructor;i!==yK&&this.structuredClone?fG(e,gK.indexOf(i.name),t):mG(e,t)}},{pack(e,t){let{target:i,position:r}=t(1);i[r]=193}}];function fG(e,t,i,r){let n=e.byteLength;if(n+1<256){var{target:s,position:a}=i(4+n);s[a++]=199,s[a++]=n+1}else if(n+1<65536){var{target:s,position:a}=i(5+n);s[a++]=200,s[a++]=n+1>>8,s[a++]=n+1&255}else{var{target:s,position:a,targetView:o}=i(7+n);s[a++]=201,o.setUint32(a,n+1),a+=4}s[a++]=116,s[a++]=t,s.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),a)}function mG(e,t){let i=e.byteLength;var r,n;if(i<256){var{target:r,position:n}=t(i+2);r[n++]=196,r[n++]=i}else if(i<65536){var{target:r,position:n}=t(i+3);r[n++]=197,r[n++]=i>>8,r[n++]=i&255}else{var{target:r,position:n,targetView:s}=t(i+5);r[n++]=198,s.setUint32(n,i),n+=4}r.set(e,n)}function nbe(e,t,i,r){let n=e.length;switch(n){case 1:t[i++]=212;break;case 2:t[i++]=213;break;case 4:t[i++]=214;break;case 8:t[i++]=215;break;case 16:t[i++]=216;break;default:n<256?(t[i++]=199,t[i++]=n):n<65536?(t[i++]=200,t[i++]=n>>8,t[i++]=n&255):(t[i++]=201,t[i++]=n>>24,t[i++]=n>>16&255,t[i++]=n>>8&255,t[i++]=n&255)}return t[i++]=r,t.set(e,i),i+=n,i}function sbe(e,t){let i,r=t.length*6,n=e.length-r;for(t.sort((s,a)=>s.offset>a.offset?1:-1);i=t.pop();){let s=i.offset,a=i.id;e.copyWithin(s+r,s,n),r-=6;let o=s+r;e[o++]=214,e[o++]=105,e[o++]=a>>24,e[o++]=a>>16&255,e[o++]=a>>8&255,e[o++]=a&255,n=s}return e}function I0(e){if(e.Class){if(!e.pack&&!e.write)throw new Error("Extension has no pack or write function");if(e.pack&&!e.type)throw new Error("Extension has no type (numeric code to identify the extension)");$B.unshift(e.Class),UA.unshift(e)}tbe(e)}var wK=new xK({useRecords:!1});wK.pack;wK.pack;var abe=512,obe=1024,gG=new xK({structuredClone:!0});I0({Class:Gt.prototype.constructor,type:1,write(e){return{...e}},read(e){return Object.setPrototypeOf(e,Gt.prototype),e}});I0({Class:Nt.prototype.constructor,type:2,write(e){return[...e]},read(e){return Object.setPrototypeOf(e,Nt.prototype),e}});I0({Class:bs.prototype.constructor,type:3,write(e){return[...e]},read(e){return Object.setPrototypeOf(e,bs.prototype),e}});I0({Class:nG.prototype.constructor,type:4,write(e){return e.id},read(e){return new nG(e)}});I0({Class:sG.prototype.constructor,type:5,write(e){return e.data},read(e){return new sG(e)}});I0({Class:Cn.prototype.constructor,type:6,write(e){return{...e}},read(e){return Object.setPrototypeOf(e,Cn.prototype),e}});function lbe(e){var t=0;if(e.length===0)return t;for(let i=0;i<e.length;i++){let r=e[i];t=(t<<5)-t+r,t=t&t}return t}function tO(e){if(jB(e))return e;if(Array.isArray(e))return e.map(tO);if(typeof e=="object"&&e!==null){let t={};for(let i of Object.keys(e).sort())t[i]=tO(e[i]);return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),t}else return e}var iO;(e=>{function t(n){return gG.pack(n)}e.serialize=t;function i(n){return gG.unpack(n)}e.deserialize=i;function r(n){return lbe(t(tO(n))).toString()}e.checksum=r})(iO||(iO={}));var vG;(e=>{function t(r){return r.type==="Conditional"?r.condition.type==="Distance"?"Distance":"StateChange":r.type}e.toEventUIType=t;function i(r){return r==="Distance"||r==="StateChange"?"Conditional":r}e.fromEventUIType=i})(vG||(vG={}));function yG(e){return e==="MouseDown"||e==="MouseUp"||e==="KeyDown"||e==="KeyUp"||e==="Collision"||e==="Trigger"}var Bs={LookAt:[],Follow:["Create"],DragDrop:["Transition","Animation","Audio","Particles","Create","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MouseHover:["Transition","Animation","Particles","Create","Destroy","SwitchCamera","SceneTransition","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Scroll:["Transition","Animation","Create","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Start:["Transition","Animation","Audio","Particles","Video","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Conditional:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MouseDown:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MouseUp:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MousePress:["Transition","Animation","Audio","Particles","Video","Link","Create","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],KeyDown:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],KeyUp:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],KeyPress:["Transition","Animation","Audio","Particles","Video","Link","Create","SwitchCamera","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],GameControl:["Transition","Animation","Audio","Particles","Create","Conditional"],Collision:["Transition","Animation","Audio","Particles","Video","Create","Destroy","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Trigger:["Transition","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Resize:["Transition","Animation","Audio","Particles","Video","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],VariableChange:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],API:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],WEBHOOK:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"]},xG;(e=>{function t(r){return r.type==="MouseDown"||r.type==="MouseUp"||r.type==="MousePress"||r.type==="KeyDown"||r.type==="KeyUp"||r.type==="KeyPress"}e.is=t;function i(r){return r==="MouseDown"||r==="MouseUp"||r==="MousePress"?{type:r,mode:"Object",disabled:!1,actions:new Nt}:{type:r,disabled:!1,key:void 0,actions:new Nt}}e.defaultData=i})(xG||(xG={}));var FA;(e=>{function t(i){return{type:"Property",value:[i??null,"position","x"]}}e.propertyDefaultData=t,e.valueDefaultData={type:"Literal",value:0}})(FA||(FA={}));var rO;(e=>{function t(n){return{type:"Comparison",operator:"==",lOperand:FA.propertyDefaultData(n),rOperand:{...FA.valueDefaultData}}}e.comparisonDefaultData=t;function i(n){return{type:"Distance",toObject:n??null,fromObject:n??null,distance:200}}e.distanceDefaultData=i;function r(n,s){return{type:"State",object:n??null,state:s??null}}e.stateDefaultData=r})(rO||(rO={}));var wG;(e=>{function t(i){return i.find(r=>r==="ifActions"||r==="elseActions")!==void 0}e.isConditionalSubActions=t})(wG||(wG={}));var bG;(e=>{function t(r){return r.type==="Conditional"}e.is=t;function i(r){return{type:"Conditional",disabled:!1,inActions:new Nt,outActions:new Nt,condition:rO.distanceDefaultData(r)}}e.defaultData=i})(bG||(bG={}));var _G;(e=>e.defaultData={type:"DragDrop",cursor:"hand",disabled:!1,dampingFactor:1,objects:[],snapTo:"center",snapSurfaceMode:"bbox",snapSurfaceOffset:0,dropOn:"all",autoOrient:!0,dropDestinations:[],plane:"adaptive",planeMode:"locked",referenceFrame:"global",limits:[-1/0,1/0,-1/0,1/0,-1/0,1/0],drop:!1,resetOnSnapFail:!1,snapSpeed:20,resetSpeed:20,dragDropActions:{drag:new Nt,drop:new Nt}})(_G||(_G={}));var nO;(e=>e.defaultData={type:"Follow",disabled:!1,maxDelta:0,dampingFactor:1,target:"cursor",plane:"custom",resetOnPointerLeave:!0,resetAfterDistanceLimit:!0,enabledTranslation:[!0,!0,!0],limitDistanceEnabled:!1,limitDistance:1e3,snapDelay:0,resetSpeed:5,actions:new Nt})(nO||(nO={}));var sO;(e=>e.defaultData={type:"LookAt",disabled:!1,distance:1e3,dampingFactor:1,target:"cursor",tilt:"up",axis:"z",plane:"custom",resetOnPointerLeave:!0,resetAfterDistanceLimit:!0,enabledRotation:[!0,!0,!0],limitDistanceEnabled:!1,limitDistance:1e3,snapDelay:0,resetSpeed:5})(sO||(sO={}));var SG;(e=>{function t(r){return r.type==="MouseHover"}e.is=t;function i(){return{type:"MouseHover",disabled:!1,actions:new Nt}}e.defaultData=i})(SG||(SG={}));var MG;(e=>{function t(r){return r.type==="Scroll"}e.is=t;function i(){return{type:"Scroll",disabled:!1,steps:100,trigger:"load",startFrom:"enter",enterAnchor:"top",startOffset:0,endAfter:400,actions:new Nt}}e.defaultData=i})(MG||(MG={}));var EG;(e=>{function t(r){return r.type==="Start"}e.is=t;function i(){return{type:"Start",disabled:!1,actions:new Nt}}e.defaultData=i})(EG||(EG={}));var AG;(e=>{function t(r){return r.type==="Collision"}e.is=t;function i(){return{type:"Collision",disabled:!1,target:"character",actions:new Nt}}e.defaultData=i})(AG||(AG={}));var CG;(e=>{function t(r){return r.type==="Trigger"}e.is=t;function i(r,n){return{type:"Trigger",disabled:!1,target:"all",triggeringObjects:[],actions:new Nt,triggerZone:"box",position:n.toArray(),rotation:[0,0,0],size:r.toArray(),radius:r.length()/2,helperVisible:!0}}e.defaultData=i})(CG||(CG={}));var aO;(e=>{e.defaultSizes={mobile:[480,480],tablet:[768,768],desktop:[1200,1200],custom:[769,1200]};function t(a){return a.type==="Resize"}e.is=t;function i(a){return typeof a=="string"?a:"custom"}e.sizeToDevice=i;function r(a){return typeof a=="string"?[...e.defaultSizes[a]]:[...a]}e.deviceToSize=r;function n(){let a={size:"mobile",operator:"<",actions:new Nt},o={size:"tablet",operator:"<",actions:new Nt},l={size:[...e.defaultSizes.custom],operator:"<>",actions:new Nt},c=new Nt;return c.push({id:Et.generateUUID(),fi:0,data:a},{id:Et.generateUUID(),fi:1,data:o},{id:Et.generateUUID(),fi:2,data:l}),{type:"Resize",disabled:!1,orientation:"horizontal",breakpoints:c}}e.defaultData=n;function s(){return{size:[...e.defaultSizes.custom],operator:"<>",actions:new Nt}}e.defaultBreakpointData=s})(aO||(aO={}));var oO;(e=>{e.propertyPaths={Position:["position"],"Position X":["position","x"],"Position Y":["position","y"],"Position Z":["position","z"],Rotation:["rotation"],"Rotation X":["rotation","x"],"Rotation Y":["rotation","y"],"Rotation Z":["rotation","z"],Scale:["scale"],"Scale X":["scale","x"],"Scale Y":["scale","y"],"Scale Z":["scale","z"],Width:["width"],Height:["height"],Depth:["depth"],"Mouse Position X":["mouse","x"],"Mouse Position Y":["mouse","y"],"Mouse Pressed":["mouse","pressed"],"Screen Width":["mouse","width"],"Screen Height":["mouse","height"],"Hit Position X":["raycast","x"],"Hit Position Y":["raycast","y"],"Hit Position Z":["raycast","z"],"Hit Object Position X":["raycast","objX"],"Hit Object Position Y":["raycast","objY"],"Hit Object Position Z":["raycast","objZ"]};function t(r){return r.type==="VariableChange"}e.is=t;function i(){return{disabled:!1,type:"VariableChange",actions:new Nt,variableId:"",objectId:null,property:"Position X"}}e.defaultData=i})(oO||(oO={}));var TG;(e=>{function t(r){return r.type==="API"}e.is=t;function i(){return{disabled:!1,type:"API",successActions:new Nt,errorActions:new Nt,userAPIId:""}}e.defaultData=i})(TG||(TG={}));var PG;(e=>{function t(r){return r.type==="WEBHOOK"}e.is=t;function i(){return{disabled:!1,type:"WEBHOOK",actions:new Nt,userWebhookId:""}}e.defaultData=i})(PG||(PG={}));var L0="personal camera",qx="a218fcc3-276b-49b9-b485-49037fd14f5f",cbe=2960946,vo=5526619,Ku;(e=>{function t(f,v){return f[0]===v[0]&&f[1]===v[1]}e.isEqual=t;function i(f,v,g){return[f[0]+(v[0]-f[0])*g,f[1]+(v[1]-f[1])*g]}e.lerp=i;function r(f,v){return[f[0]+v[0],f[1]+v[1]]}e.add=r;function n(f,v){return[f[0]-v[0],f[1]-v[1]]}e.sub=n;function s(f,v){return[f[0]*v[0],f[1]*v[1]]}e.multiply=s;function a(f,v){return[f[0]/v[0],f[1]/v[1]]}e.divide=a;function o(f,v){return Math.pow(v[0]-f[0],2)+Math.pow(v[1]-f[1],2)}e.distanceSquared=o;function l(f,v){return Math.sqrt(o(f,v))}e.distance=l;function c(f,v){return f[0]*v[0]+f[1]*v[1]}e.dot=c;function u(f,v){return[f[0]*v,f[1]*v]}e.scalarMultiply=u;function h(f,v,g){let m=e.sub(v,f),x=e.sub(g,f),w=e.dot(m,x)/e.dot(m,m),_=e.scalarMultiply(m,w);return e.add(f,_)}e.projectionOnto=h;function d(f,v,g){return l(f,h(f,v,g))}e.projectionOntoDistance=d;function p(f,v){return[(f[0]+v[0])*.5,(f[1]+v[1])*.5]}e.center=p})(Ku||(Ku={}));var Af;(e=>{function t(l,c){return l[0]===c[0]&&l[1]===c[1]&&l[2]===c[2]}e.isEqual=t;function i(l,c){return[l[0]+c[0],l[1]+c[1],l[2]+c[2]]}e.add=i;function r(l,c){return[l[0]-c[0],l[1]-c[1],l[2]-c[2]]}e.sub=r;function n(l,c){return[l[0]/c[0],l[1]/c[1],l[2]/c[2]]}e.div=n;function s(l,c){return[l[0]*c[0],l[1]*c[1],l[2]*c[2]]}e.mul=s;function a(l,c){return Math.hypot(l[0]-c[0],l[1]-c[1],l[2]-c[2])}e.dist=a;function o(l,c,u){return[l[0]+(c[0]-l[0])*u,l[1]+(c[1]-l[1])*u,l[2]+(c[2]-l[2])*u]}e.lerp=o})(Af||(Af={}));var VA;(e=>{function t(r,n){return r[0]===n[0]&&r[1]===n[1]&&r[2]===n[2]&&r[3]===n[3]}e.isEqual=t;function i(r,n,s){return[r[0]+(n[0]-r[0])*s,r[1]+(n[1]-r[1])*s,r[2]+(n[2]-r[2])*s,r[3]+(n[3]-r[3])*s]}e.lerp=i})(VA||(VA={}));var DG;(e=>{let t=180/Math.PI,i=Math.PI/180;function r(o){return typeof o=="number"?o*t:o}function n(o){return typeof o=="number"?o*i:o}function s(o){return[r(o[0]),r(o[1]),r(o[2])]}e.radToDeg=s;function a(o){return[n(o[0]),n(o[1]),n(o[2])]}e.degToRad=a})(DG||(DG={}));var Zv;(e=>{e.identity=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function t(n,s){for(let a=0;a<16;a++)if(n[a]!==s[a])return!1;return!0}e.isEqual=t;function i(n){return n??e.identity}e.simplify=i;function r(n,s){let a=s.slice(0);for(var o=0,l=s.length;o<l;o+=3){let c=n[3]*s[o]+n[7]*s[o+1]+n[11]*s[o+2]+n[15];a[o]=(n[0]*s[o]+n[4]*s[o+1]+n[8]*s[o+2]+n[12])/c,a[o+1]=(n[1]*s[o]+n[5]*s[o+1]+n[9]*s[o+2]+n[13])/c,a[o+2]=(n[2]*s[o]+n[6]*s[o+1]+n[10]*s[o+2]+n[14])/c}return a}e.applyMatrix4=r})(Zv||(Zv={}));var ys;(e=>{function t(c){return typeof c=="object"&&typeof c.r=="number"&&typeof c.g=="number"&&typeof c.b=="number"}e.isRGB=t,e.white={r:1,g:1,b:1},e.red={r:1,g:0,b:0},e.black={r:0,g:0,b:0};function i(c){return{r:Math.round(c.r*255),g:Math.round(c.g*255),b:Math.round(c.b*255),a:1}}e.toRgb255a1=i;function r(c){return{r:c.r,g:c.g,b:c.b}}e.clone=r;function n(c){return c=Math.floor(c),{r:(c>>16&255)/255,g:(c>>8&255)/255,b:(c&255)/255}}e.fromHex=n;function s(c){return Math.round(c.r*255)*65536+Math.round(c.g*255)*256+Math.round(c.b*255)}e.toHex=s;function a(c,u){return c.r===u.r&&c.g===u.g&&c.b===u.b}e.equals=a;function o(c,u){return c.r.toFixed(2)===u.r.toFixed(2)&&c.g.toFixed(2)===u.g.toFixed(2)&&c.b.toFixed(2)===u.b.toFixed(2)}e.equalsFixed=o;function l(c,u,h){return{r:c.r+(u.r-c.r)*h,g:c.g+(u.g-c.g)*h,b:c.b+(u.b-c.b)*h}}e.lerp=l})(ys||(ys={}));var ar;(e=>{e.white={...ys.white,a:1},e.transparent={...ys.white,a:0};function t(l){return{r:l[0],g:l[1],b:l[2],a:l[3]}}e.from0to1=t;function i(l,c){return{...ys.fromHex(l),a:c}}e.fromHexAndA=i;function r(l){return{r:Math.round(l.r*255),g:Math.round(l.g*255),b:Math.round(l.b*255),a:l.a}}e.toRgb255a1=r;function n(l,c){return ys.equals(l,c)&&l.a===c.a}e.equals=n;function s(l,c){return ys.equalsFixed(l,c)&&l.a.toFixed(2)===c.a.toFixed(2)}e.equalsFixed=s;function a(l,c,u){return{r:l.r+(c.r-l.r)*u,g:l.g+(c.g-l.g)*u,b:l.b+(c.b-l.b)*u,a:l.a+(c.a-l.a)*u}}e.lerp=a;function o({r:l,g:c,b:u,a:h}=e.white){return`rgba(${l*255}, ${c*255}, ${u*255}, ${h})`}e.toStyle=o})(ar||(ar={}));var lO;(e=>e.identity={position:[0,0,0],rotation:[0,0,0],scale:[1,1,1]})(lO||(lO={}));var RG;(e=>e.defaultData={mass:1,stiffness:80,damping:10,velocity:0})(RG||(RG={}));var IG;(e=>e.defaultData={control1:[.5,0],control2:[.5,1]})(IG||(IG={}));var cd;(e=>(e.linear=[0,0,1,1],e.ease=[.25,.1,.25,1],e.easeIn=[.42,0,1,1],e.easeOut=[0,0,.58,1],e.easeInOut=[.42,0,.58,1]))(cd||(cd={}));function LG(e){return typeof e=="string"&&e.length===36?/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e):!1}var Wf;(e=>{e.all=["PerspectiveCamera","OrthographicCamera"];function t(i){return e.all.includes(i)}e.is=t})(Wf||(Wf={}));var $v;(e=>{e.DefaultUp=[0,1,0],e.DefaultTargetOffset=1e3,e.defaultData={far:1e5,type:"OrthographicCamera",perspective:{near:70,fov:45,zoom:1},orthographic:{near:-1e5,zoom:1},up:e.DefaultUp,isUpVectorFlipped:!1,targetOffset:e.DefaultTargetOffset};function t(i){var r,n;return i.type==="PerspectiveCamera"?((r=i.perspective)==null?void 0:r.zoom)??1:((n=i.orthographic)==null?void 0:n.zoom)??1}e.getZoom=t})($v||($v={}));var Sd;(e=>{function t(r,n=.1){return{disabled:!1,type:"linear",hideBase:!1,count:3,radial:{radius:Math.max(r[0],r[1])*2,start:0,end:360,alignment:!1,axis:"y",scale:[1,1,1],rotation:[0,0,0],position:[0,0,0]},toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},linear:{scale:[1,1,1],rotation:[0,0,0],position:[r[0]+r[0]*n,0,0]},grid:{count:[2,2,2],size:r.map(s=>s*(1+n)),useCenter:!0},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}}}e.defaultData=t;function i(r,n){let s={...r};if(bK.forEach(a=>{Object.assign(s,{[a]:n[a]??r[a]})}),s.radial={...r.radial},n.radial){let a=r.radial,o=n.radial;_K.forEach(l=>{Object.assign(s.radial,{[l]:o[l]??a[l]})})}if(s.linear={...r.linear},n.linear){let a=r.linear,o=n.linear;SK.forEach(l=>{Object.assign(s.linear,{[l]:o[l]??a[l]})})}if(s.grid={...r.grid},n.grid){let a=r.grid,o=n.grid;MK.forEach(l=>{Object.assign(s.grid,{[l]:o[l]??a[l]})})}if(s.toObject={...r.toObject},n.toObject){let a=r.toObject,o=n.toObject;EK.forEach(l=>{Object.assign(s.toObject,{[l]:o[l]??a[l]})})}if(s.randomnessObject={...r.randomnessObject},n.randomnessObject){let a=r.randomnessObject,o=n.randomnessObject;AK.forEach(l=>{Object.assign(s.randomnessObject,{[l]:o[l]??a[l]})})}return s}e.merge=i})(Sd||(Sd={}));var cO;(e=>{e.defaultData={radial:{},linear:{},grid:{},toObject:{},randomnessObject:{}};let t=["radial","linear","grid","toObject","randomnessObject"];function i(r,n){let s=[];r.count!==void 0&&s.push({type:0,path:n,props:{count:r.count}});for(let a of t){let o=r[a];o&&Object.keys(o).length>0&&s.push({type:0,path:[...n,a],props:o})}return s}e.toOps=i})(cO||(cO={}));var bK=["count"],_K=["radius","start","end","position","scale","rotation"],SK=["position","scale","rotation"],MK=["count","size"],EK=["count","position","scale","rotation"],AK=["strength","scale","rotation","position","movement","seed","freqScale"],uO;(e=>{e.all=["PointLight","SpotLight","DirectionalLight","HemisphereLight"];function t(i){return e.all.includes(i)}e.is=t})(uO||(uO={}));var hO;(e=>{function t(r){return i(r)}e.defaultData=t;function i(r){if(r==="PointLight")return{type:r,color:ar.white,intensity:1,distance:2e3,decay:1,shadows:!0,shadowResolution:1024,shadowRadius:1,penumbraSize:.5,depth:1e5};if(r==="SpotLight")return{type:r,color:ar.white,intensity:1,distance:2e3,decay:1,shadows:!0,penumbra:0,angle:30/180*Math.PI,depth:1e5,penumbraSize:.5,shadowResolution:1024,shadowRadius:1};if(r==="DirectionalLight")return{type:r,color:ar.white,intensity:1,shadows:!0,size:2e3,depth:1e5,penumbraSize:.5,shadowResolution:1024,shadowRadius:1};throw new Error("not implemented")}})(hO||(hO={}));var HA;(e=>(e.defaultShapeData={type:"PlaneEmitterShape",size:[100,100,100]},e.defaultCollisionData={colliderEntityId:null,collisionBounce:.75},e.defaultData={renderMaterial:{type:"particleMaterial",color:{r:1,g:.2,b:.545,a:1},color2:{r:.945,g:.714,b:.184,a:1},coloring:"gradient",ease:"linearFadeOut",easeSize:"linearFadeOut",transparent:!0,size:[40,40],texture:"pt_default_particle",spriteRotation:[0,0]},birthRatePerSec:50,gravity:1,noiseStrength:0,noiseScale:0,noiseSeed:1,noiseType:"curl",randomRotation:0,randomScale:.2,randomMass:.5,rootObjectType:"instancedMesh",life:1,direction:[0,0,0],directionMode:"axis",speed:10,shape:e.defaultShapeData,autoPlay:!0,emitTimeDelay:0,emitTimeCycle:"infinity",emitTimeDuration:1,...e.defaultCollisionData}))(HA||(HA={}));var Jv;(e=>e.defaultData={enabled:"visibility",fusedBody:!0,rigidBody:"positioned",density:1,pointMass:0,gravityScale:1,friction:.5,damping:0,restitution:.2,colliderType:"convex",enabledRotation:[!0,!0,!0],enabledTranslation:[!0,!0,!0]})(Jv||(Jv={}));var dO;(e=>{e.defaultData={castShadow:!0,receiveShadow:!0};function t(i,r){return i.castShadow===r.castShadow&&i.receiveShadow===r.receiveShadow}e.equals=t})(dO||(dO={}));var pO;(e=>{e.defaultData={flatShading:!1,wireframe:!1,side:0};function t(i,r){return i.flatShading===r.flatShading&&i.side===r.side&&i.wireframe===r.wireframe}e.equals=t})(pO||(pO={}));var fO;(e=>e.defaultData={...pO.defaultData,...dO.defaultData})(fO||(fO={}));var OG;(e=>{function t(i,r){var s,a;let n=[];if("material"in i){let o=typeof i.material=="string"?r.materials[i.material]??((s=r.lib.materials[i.material])==null?void 0:s.asset):i.material;o&&n.push(o)}else if("materials"in i)for(let o of i.materials){let l=typeof o=="string"?r.materials[o]??((a=r.lib.materials[o])==null?void 0:a.asset):o;l&&n.push(l)}return n}e.getMaterialData=t})(OG||(OG={}));var GA;(e=>(e.defaultVideo={data:"",thumb:"/_assets/_videos/catThumb.png",type:"video",name:"Cat video"},e.maxSize=3e7))(GA||(GA={}));var zG;(e=>{function t(i){return i==="texture"||i==="video"||i==="color"||i==="depth"||i==="normal"||i==="gradient"||i==="noise"||i==="fresnel"||i==="rainbow"||i==="toon"||i==="outline"||i==="particle"||i==="transmission"||i==="matcap"||i==="displace"||i==="pattern"||i==="light"}e.is=t})(zG||(zG={}));function ube(e){return e.type!=="displace"}var NG;(e=>{function t(i){return i==="phong"||i==="toon"||i==="lambert"||i==="physical"}e.is=t})(NG||(NG={}));var CK=["mode","gradientType","noiseType","displacementType","projection","cnormal","crop","axis","side"],hbe=["wrapping","image","video","name","minFilter","magFilter"],Zn;(e=>{function t(s,a){let{texture:o,...l}=a;if(Object.assign(s,l),o){let c=s.texture;c&&Object.assign(c,o)}}e.patch=t;function i(s,a){return s==="light"&&a?r(a):n(s)}e.defaultData=i;function r(s){let a={mode:0,isMask:!1,visible:!0,bumpMap:void 0,bumpMapIntensity:5,roughnessMap:void 0,alphaOverride:1};switch(s){case"phong":return{...a,category:"phong",specular:{r:.2,g:.2,b:.2},shininess:5,type:"light",visible:!0,mode:0,occlusion:!0,alpha:.6};case"toon":return{...a,category:"toon",specular:{r:.2,g:.2,b:.2},shininess:10,type:"light",alpha:1};case"lambert":return{...a,category:"lambert",emissive:{r:0,g:0,b:0},type:"light",alpha:1,visible:!0,mode:0,occlusion:!0};case"physical":return{...a,category:"physical",roughness:.2,metalness:.2,reflectivity:.2,type:"light",alpha:1,visible:!0,mode:0,occlusion:!0}}}function n(s){let a={alpha:1,mode:0,isMask:!1,visible:!0};switch(s){case"texture":return{...a,type:"texture",size:[128,128],blending:0,axis:"x",side:2,projection:0,texture:{image:"image_0",wrapping:1e3,repeat:[1,1],offset:[0,0],rotation:0,minFilter:1008,magFilter:1006},crop:!1};case"video":return{...a,type:"video",size:[128,128],blending:0,axis:"x",side:2,projection:0,texture:{video:GA.defaultVideo,wrapping:1001,repeat:[1,1],offset:[0,0],rotation:0,minFilter:1008,magFilter:1006},crop:!1};case"color":return{...a,type:"color",color:ys.fromHex(vo)};case"depth":return{...a,type:"depth",gradientType:1,smooth:!1,isVector:!0,isWorldSpace:!1,origin:[0,0,0],direction:[1,0,0],colors:[[1,1,1,1],[0,0,0,1]],steps:[0,1],near:50,far:200};case"normal":return{...a,type:"normal",cnormal:[1,1,1]};case"gradient":return{...a,type:"gradient",gradientType:0,smooth:!1,colors:[[0,0,0,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,1,1,1,1,1,1,1,1,1],num:2,angle:0,offset:[0,0],morph:[0,0]};case"noise":return{...a,type:"noise",size:[100,100,100],noiseType:0,scale:1,move:1,colorA:{...ys.fromHex(6710886),a:1},colorB:{...ys.fromHex(6710886),a:1},colorC:{...ys.fromHex(16777215),a:1},colorD:{...ys.fromHex(16777215),a:1},distortion:[1,1],fA:[1.7,9.2],fB:[8.3,2.8],voronoiStyle:0,highCut:1,lowCut:0,smoothness:.3,seed:0,quality:1};case"fresnel":return{...a,type:"fresnel",color:ar.fromHexAndA(16777215,1),bias:.1,scale:1,intensity:2,factor:1};case"rainbow":return{...a,type:"rainbow",filmThickness:30,movement:0,wavelengths:[0,0,0],noiseStrength:0,noiseScale:1,offset:[0,0,0]};case"toon":return{...a,type:"toon",positioning:2,colors:[[0,0,0,1],[.5,.5,.5,1],[.5,.5,.5,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,.475,.525,1,1,1,1,1,1,1],num:4,source:[0,1e3,0],isWorldSpace:!0,noiseStrength:0,noiseScale:1,shadowColor:ar.fromHexAndA(0,0),offset:[0,0,0]};case"outline":return{...a,type:"outline",outlineColor:ar.fromHexAndA(0,1),contourColor:ar.fromHexAndA(0,1),outlineWidth:2,contourWidth:5,outlineThreshold:.4,contourThreshold:0,outlineSmoothing:0,contourFrequency:10,contourDirection:[0,1,0],positionalLines:!1,compensation:!0};case"matcap":return{...a,type:"matcap",texture:{image:"matcap_0",wrapping:1001,repeat:[1,1],offset:[0,0],rotation:0,minFilter:1008,magFilter:1006}};case"transmission":return{...a,type:"transmission",thickness:10,ior:1.5,roughness:1};case"displace":return{visible:!0,type:"displace",displacementType:"noise",noiseType:0,scale:10,movement:1,offset:[0,0,0],intensity:8,voronoiStyle:0,smoothness:.3,seed:0,highCut:1,lowCut:0,quality:1};case"pattern":return{...a,type:"pattern",style:0,projection:0,axis:"y",blending:0,offset:[0,0],colorA:{...ys.fromHex(0),a:1},colorB:{...ys.fromHex(16777215),a:1},frequency:[10,10],size:.5,variation:0,smoothness:.5,zigzag:0,rotation:0,vertical:[0,1],horizontal:[0,1],sides:6}}}})(Zn||(Zn={}));var _s;(e=>{function t(u){return!u.layers.some(h=>h.data.type==="texture"&&h.data.projection!==0||h.data.type==="depth"&&!h.data.isWorldSpace||h.data.type==="noise"||h.data.type==="displace")}e.isMergable=t;function i(u){let h="";return u.layers.forEach(d=>{Object.entries(d.data).forEach(([p,f])=>{h+=`${p}${f}`,Array.isArray(f)?f.forEach(v=>h+=`${v}`):typeof f=="object"?Object.values(f).forEach(v=>{typeof v=="number"?h+=`${v.toFixed(4)}`:h+=`${v}`}):h+=`${f}`})}),h}e.getHash=i;function r(){return{layers:new Nt}}e.defaultEmptyData=r;function n(u="layer1",h="layer2"){return a("phong",u,h)}e.defaultData=n;function s(u,h){return{...u,name:h}}e.withName=s;function a(u,h="layer1",d="layer2"){let p=new Nt;return p.push({fi:0,data:Zn.defaultData("light",u),id:h}),p.push({fi:1,data:Zn.defaultData("color"),id:d}),{layers:p}}e.defaultTwoLayerData=a;function o(u){let h=Zn.defaultData("texture");u&&Object.assign(h.texture,{image:u});let d=new Nt;return d.push({fi:0,data:h,id:"layer1"}),d.push({fi:1,data:{...Zn.defaultData("transmission"),alpha:1},id:"layer2"}),d.push({fi:2,data:{...Zn.defaultData("light","lambert"),alpha:0},id:"layer3"}),{layers:d}}e.defaultUIObjectMaterial=o;function l(u,h="phong",d="layer1",p="layer2"){let f=Zn.defaultData("texture");Object.assign(f.texture,{image:u});let v=new Nt;return v.push({fi:0,data:f,id:d}),v.push({fi:1,data:Zn.defaultData("light",h),id:p}),{layers:v}}e.defaultTwoLayerTextureData=l;function c(u,h="phong",d="layer1",p="layer2"){let f=Zn.defaultData("video");Object.assign(f.texture,{video:u});let v=new Nt;return v.push({fi:0,data:f,id:d}),v.push({fi:1,data:Zn.defaultData("light",h),id:p}),{layers:v}}e.defaultTwoLayerVideoTextureData=c})(_s||(_s={}));var jA;(e=>{function t(){return{points:new Nt,roundness:0,shapeHoles:[],isClosed:!1}}e.defaultData=t})(jA||(jA={}));var WA;(e=>{function t(){return{points:new Nt,lastInsertionPlane:null,subdivisions:12,isClosed:!1}}e.defaultData=t})(WA||(WA={}));var TK={type:"Ellipse",width:50,height:50,spikes:16,angle:360,innerRadius:0},mO;(e=>{function t(i,r){let n={...i};return DK.forEach(s=>{Object.assign(n,{[s]:r[s]??i[s]})}),n}e.merge=t})(mO||(mO={}));var PK={shape:TK,depth:1,offset:0,bevel:50,bevelSides:6,angle:0,twist:0,startScale:1,endScale:1,capType:"flat"},DK=["depth","offset","angle","twist","startScale","endScale"],XA;(e=>{function t(r){return r==="PolygonGeometry"||r==="RectangleGeometry"||r==="StarGeometry"||r==="TriangleGeometry"||r==="EllipseGeometry"||r==="UIGeometry"}e.is2DParametricMesh=t;function i(r){return r==="PolygonGeometry"||r==="PolygonGeometry"||r==="RectangleGeometry"||r==="StarGeometry"||r==="TriangleGeometry"||r==="EllipseGeometry"||r==="PathGeometry"||r==="VectorGeometry"||r==="ConeGeometry"||r==="CubeGeometry"||r==="CylinderGeometry"||r==="DodecahedronGeometry"||r==="HelixGeometry"||r==="IcosahedronGeometry"||r==="LatheGeometry"||r==="PyramidGeometry"||r==="SphereGeometry"||r==="PlaneGeometry"||r==="BackdropGeometry"||r==="TorusGeometry"||r==="TorusKnotGeometry"||r==="BooleanGeometry"||r==="TextGeometry"||r==="InputGeometry"}e.isParametricMesh=i})(XA||(XA={}));var gO;(e=>{function t(i,r){let n={...i};return Object.assign(n,r),n.type==="PathGeometry"&&"extrusion"in r&&r.extrusion&&(n.extrusion={...i.extrusion},Object.assign(n.extrusion,mO.merge(n.extrusion,r.extrusion))),n}e.merge=t})(gO||(gO={}));var af;(e=>{function t(i){if(i==="RectangleGeometry")return{width:320,height:320,type:i,cornerRadius:[0,0,0,0],cornerType:0,depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if(i==="UIGeometry")return{type:i,frame:"",cornerRadius:[0,0,0,0],cornerType:0,width:1,height:1};if(i==="PathGeometry")return{type:i,width:1,height:1,depth:1,path:WA.defaultData(),extrusion:PK};if(i==="VectorGeometry")return{width:1,height:1,type:i,subdivisions:12,shape:jA.defaultData(),depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if(i==="BooleanGeometry")return{type:i,operation:2,width:0,height:0,depth:0,phongAngle:35};if(i==="TextGeometry")return{type:i,width:100,height:100,depth:0,horizontalAlign:1,verticalAlign:1,fontSize:16,lineHeight:1.2,letterSpacing:0,text:{textValue:""},textTransform:1,font:"Roboto_regular",editable:!1,extrudeBevelSize:0,extrudeBevelSegments:1};if(i==="InputGeometry")return{...e.defaultData("TextGeometry"),type:i,editable:!0};if(i==="SphereGeometry")return{type:"SphereGeometry",width:100,height:100,depth:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:180};throw new Error("not implemented")}e.defaultData=t})(af||(af={}));var BG=["width","height","depth"],vO;(e=>e.defaultData={enabled:!1,useBackgroundColor:!1,color:ys.white,near:.1,far:2e3})(vO||(vO={}));var qA;(e=>{let t={opacity:1,blendFunction:13,enabled:!1};e.defaultData={enabled:!1,pixelation:{...t,blendFunction:16,granularity:15},bloom:{...t,blendFunction:16,intensity:1,blurScale:1,luminanceThreshold:.25,luminanceSmoothing:.025,kernelSize:3},chromaticAberration:{...t,offset:[2,2]},vignette:{...t,darkness:1,offset:0},hueSaturation:{...t,hue:3,saturation:0},brightnessContrast:{...t,brightness:.25,contrast:0},depthOfField:{...t,focusDistance:100,focalLength:20,bokehScale:5},noise:{...t,blendFunction:16}}})(qA||(qA={}));var yO;(e=>e.defaultData={softShadowQuality:"low"})(yO||(yO={}));var xO;(e=>e.defaultData={enabled:!0,color:{r:.8274509803921568,g:.8274509803921568,b:.8274509803921568},intensity:.75})(xO||(xO={}));var wO;(e=>e.defaultData={occlusion:!1,aoFullRes:!1,radius:256,bias:.5,aoColor:{r:.19607843137254902,g:.19607843137254902,b:.19607843137254902}})(wO||(wO={}));var e0;(e=>e.defaultData={usePhysics:!1,gravity:-10})(e0||(e0={}));var bO;(e=>e.defaultData={playCamera:L0,gameControlObject:null})(bO||(bO={}));var _O;(e=>e.defaultData={backgroundColor:ar.fromHexAndA(cbe,1),postprocessing:qA.defaultData,fog:vO.defaultData,globalPhysics:e0.defaultData,ambient:xO.defaultData,ao:wO.defaultData,shadow:yO.defaultData,publish:bO.defaultData})(_O||(_O={}));var SO;(e=>e.defaultData={colliderType:"box",size:[100,100,100],colliderHelperVisible:!0,forceType:"collider",forceRange:"global",forceIntensity:.5,forceDambing:.95})(SO||(SO={}));var kG;(e=>{function t(r){return r==="Component"||r==="Instance"}e.isComponentRelated=t;function i(r){return r==="Empty"||r==="Instance"}e.isEmptyOrComponent=i})(kG||(kG={}));var t0;(e=>{e.identity={...lO.identity,hiddenMatrix:Zv.identity};function t(n){return{position:n.position,rotation:n.rotation,scale:n.scale,hiddenMatrix:n.hiddenMatrix}}e.fromObject=t;function i(n,s){return{position:(s==null?void 0:s.position)||n.position,rotation:(s==null?void 0:s.rotation)||n.rotation,scale:(s==null?void 0:s.scale)||n.scale,hiddenMatrix:(s==null?void 0:s.hiddenMatrix)||n.hiddenMatrix}}e.merge=i;function r(n,s){return XQ({position:Af.isEqual(n.position,s.position)?void 0:s.position,rotation:Af.isEqual(n.rotation,s.rotation)?void 0:s.rotation,scale:Af.isEqual(n.scale,s.scale)?null:s.scale,hiddenMatrix:Zv.isEqual(n.hiddenMatrix,s.hiddenMatrix)?void 0:s.hiddenMatrix})}e.diff=r})(t0||(t0={}));var ss;(e=>e.defaultData={states:new Nt,events:new Nt,visible:!0,raycastLock:!1,physics:Jv.defaultData,pathSnapping:{pathId:null,slide:0,offset:0,orientation:"tangential"},...t0.identity,cloner:null})(ss||(ss={}));var MO;(e=>e.defaultData={type:"Empty",...ss.defaultData})(MO||(MO={}));var UG;(e=>e.defaultData={type:"ParticleCollider",...SO.defaultData,...ss.defaultData})(UG||(UG={}));var FG;(e=>e.defaultData={type:"Component",...ss.defaultData})(FG||(FG={}));var VG;(e=>e.defaultData={type:"Particle",...ss.defaultData,...HA.defaultData})(VG||(VG={}));var of;(e=>e.defaultData={type:"Mesh",...ss.defaultData,...fO.defaultData})(of||(of={}));var G1;(e=>e.defaultData={...ss.defaultData,...t0.identity,position:[0,0,$v.DefaultTargetOffset],...$v.defaultData})(G1||(G1={}));var EO;(e=>{function t(i){return{...ss.defaultData,...hO.defaultData(i)}}e.defaultData=t,e.defaultDirectionalLightData={...e.defaultData("DirectionalLight"),position:[200,300,300],name:"Directional Light",intensity:.7}})(EO||(EO={}));var YA;(e=>{function t(r,n,s=0){for(;s<n.length;){let a=r?r[n[s]]:void 0;if(n.length===s+1)return a;if(a)r=a.descendants,s+=1;else return}}e.resolveWithDes=t;function i(r,n,s=0){let a=t(r,n,s);if(a){let o=Object.keys(a);if(o.length===1&&o[0]==="descendants")return}return a}e.resolve=i})(YA||(YA={}));var Md;(e=>{e.rootOverrideProps=["physics","events"],e.compositeNonOptionalOverrideProps=["geometry"],e.compositeEntireOverrideOverrideProps=["material"];function t(r,n){return{...ss.defaultData,...n,component:r,overrides:new Cn,physics:void 0,events:void 0,type:"Instance"}}e.ofComponent=t;function i(r){let n=t0.fromObject(r.data);return t(r.id,n)}e.fromComponentData=i})(Md||(Md={}));var i0;(e=>{e.defaultData={type:"Page",...ss.defaultData,physics:{...Jv.defaultData,fusedBody:!1},..._O.defaultData,camera:G1.defaultData};function t(i){return i.uiScene!==void 0}e.isUIPage=t})(i0||(i0={}));var AO;(e=>(e.defaultCamera={position:[0,0,1e3],scale:[1,1,1],rotation:[0,0,0],hiddenMatrix:Zv.identity,name:"Play Camera",visible:!0,raycastLock:!1,physics:Jv.defaultData,states:new Nt,events:new Nt,cloner:null,pathSnapping:{pathId:null,orientation:"tangential",slide:0,offset:0},...$v.defaultData},e.KeysByResetCategory={States:["states"],Events:["events"],Material:["material","materials"],Geometry:["geometry"],Position:["position"],Rotation:["rotation"],Scale:["scale"],Transform:["position","scale","rotation","hiddenMatrix"],Name:["name"],Visibility:["visible","raycastLock","flatShading","wireframe","side"],Shadows:["castShadow","receiveShadow"],Cloner:["cloner"],Physics:["physics"]},e.defaultMeshObject={name:"Rectangle",...ss.defaultData,...of.defaultData,geometry:af.defaultData("RectangleGeometry"),material:_s.defaultTwoLayerData("phong","layer1","layer2")},e.defaultBooleanObject={name:"Boolean",...ss.defaultData,...of.defaultData,geometry:af.defaultData("BooleanGeometry"),material:_s.defaultTwoLayerData("phong","layer1","layer2")},e.defaultTextObject={name:"Text",...ss.defaultData,...of.defaultData,geometry:af.defaultData("TextGeometry"),material:_s.defaultTwoLayerData("phong","layer1","layer2")},e.defaultInputObject={name:"Input",...ss.defaultData,...of.defaultData,geometry:af.defaultData("InputGeometry"),material:_s.defaultTwoLayerData("phong","layer1","layer2")}))(AO||(AO={}));var lf;(e=>{function t(s,a){let o={name:a};return s.type==="Mesh"?(o.geometry={},"material"in s&&(o.material={layers:new Cn}),"materials"in s&&(o.materials=s.materials.map(l=>({layers:new Cn})))):Wf.is(s.type)&&(o.perspective={},o.orthographic={}),o}e.newEmpty=t;function i(s,a){if(a===void 0)return s;let o={...s};return"material"in o&&"material"in a&&a.material&&(o.material=H1(o.material,l=>{if(typeof l!="string")for(let[c,u]of Object.entries(a.material.layers)){let h=l.layers.data(c);h&&Zn.patch(h,u)}}).data),o.materials&&a.materials&&(o.materials=H1(o.materials,l=>{var c,u;for(let h=0;h<o.materials.length;h++){let d=a.materials[h];if(typeof d!="string")for(let[p,f]of Object.entries(d.layers)){let v=(u=(c=l[h])==null?void 0:c.layers)==null?void 0:u.data(p);v&&Zn.patch(v,f)}}}).data),o}function r(s,a){let o,l=[],c={orthographic:0,perspective:0,geometry:0};function u(h,d){for(let[p,f]of Object.entries(d.layers)){let{texture:v,...g}=f;if(v!==void 0&&Object.keys(v).length>0){let m={path:[...h,"layers",p,"texture"],props:v,type:0};l.push(m)}if(Object.keys(g).length>0){let m={path:[...h,"layers",p],props:g,type:0};l.push(m)}}}for(let[h,d]of Object.entries(a))if(h!=="name")if(h==="cloner")l.push(...cO.toOps(d,["cloner"]));else if(h==="pathSnapping")l.push({path:[h],props:{slide:d.slide,offset:d.offset},type:0});else if(h==="material")u(["material"],d);else if(h==="materials")for(let[p,f]of Object.entries(d))u(["materials",p],f);else if(c[h]===0){if(h==="geometry"&&d.extrusion!==void 0){let p={path:[h,"extrusion"],props:d.extrusion,type:0};l.push(p),d={...d},delete d.extrusion}if(Object.keys(d).length>0){let p={path:[h],props:d,type:0};l.push(p)}}else o===void 0&&(o={path:[],props:{},type:0},l.push(o)),o.props[h]=d;return l}e.toOps=r;function n(s,a){var l,c,u,h,d,p;if(a===void 0)return s;let o={...s};if(Object.assign(o,t0.merge(o,a)),Object.assign(o,{pathSnapping:Object.assign({},o.pathSnapping,{slide:((l=a.pathSnapping)==null?void 0:l.slide)??((c=o.pathSnapping)==null?void 0:c.slide)??0,offset:((u=a.pathSnapping)==null?void 0:u.offset)??((h=o.pathSnapping)==null?void 0:h.offset)??0})}),Wf.is(s.type)){o.orthographic={...o.orthographic},o.perspective={...o.perspective};let f=a;((d=f.orthographic)==null?void 0:d.zoom)!==void 0&&(o.orthographic.zoom=f.orthographic.zoom),((p=f.perspective)==null?void 0:p.zoom)!==void 0&&(o.perspective.zoom=f.perspective.zoom),f.isUpVectorFlipped!==void 0&&(o.isUpVectorFlipped=f.isUpVectorFlipped),f.targetOffset!==void 0&&(o.targetOffset=f.targetOffset)}else if(s.type==="Mesh")"geometry"in a&&Object.assign(o,{geometry:gO.merge(o.geometry,a.geometry)}),(a.material||a.materials)&&(o=i(o,a)),o.cloner&&"cloner"in a&&Object.assign(o,{cloner:Sd.merge(o.cloner,a.cloner)});else if(s.type==="Empty")o.cloner&&"cloner"in a&&Object.assign(o,{cloner:Sd.merge(o.cloner,a.cloner)});else if(uO.is(s.type)){let f=a;f.intensity!==void 0&&(o.intensity=f.intensity),f.color!==void 0&&(typeof f.color=="string"?o.color=f.color:o.color=ys.clone(f.color))}return o}e.patch=n})(lf||(lf={}));var QA;(e=>e.defaultData={enablePan:!0,enableZoom:!0,enableRotate:!0,enableDamping:!0,rotationLimitsMode:0,rotationVerticalOffset:{min:Math.PI/4,max:Math.PI/4},rotationHorizontalOffset:{min:Math.PI/4,max:Math.PI/4},rotationSoftLimit:2,panLimitsMode:0,panVerticalOffset:{min:250,max:250},panHorizontalOffset:{min:250,max:250},panSoftLimit:2,zoomLimitsEnabled:!1,zoomLimits:{min:.1,max:2},autoRotate:!1,autoRotateSpeed:2,autoRotateClockwise:!0,hoverRotatePanMode:0,hoverRotatePanStrength:20,hoverRotateDamping:.125,isTouchZoom:!0,orbitTouches:2,panTouches:3,resetHoverEffectOnPointerLeave:!0})(QA||(QA={}));var Ed;(e=>e.defaultData={orbitControls:QA.defaultData,playPage:qx,withBackground:!0,preventScroll:!1,preventTouchScroll:!1,hideCursor:!1,mouseEventTarget:"canvas",joystickSizeAndXYOffset:Array(12).fill(0).map((t,i)=>{let r=0,n=0;return i<5?n=-30:i<10&&(n=30),i===0||i===10||i===5?r=30:(i===4||i===11||i===9)&&(r=-30),[120,[r,n],"show"]}),settings:{image:{format:"jpg",ratio:1},video:{format:"mp4",imageFormat:"jpg",fps:30,mbps:80,ratio:Math.max(1,typeof window<"u"?Math.floor(window.devicePixelRatio):1),stopMode:"manual",duration:5e3},web:{logo:!0,compress:!0,preset:1,preload:!0,hint:!1,imageQuality:70}},stopRaycast:!0,hdTransmission:!1})(Ed||(Ed={}));var CO;(e=>e.defaultData={id:"basic",label:"Basic",style:"None",prompt:""})(CO||(CO={}));var TO;(e=>e.defaultData={weather:0,shadows:0,lightOrigin:0,temperature:0,sun:0,camera:0,environment:0,particles:0,nature:0,floor:0})(TO||(TO={}));var cf;(e=>(e.defaultData=()=>({mode:"line-art-both",prompt:"",negativePrompt:"",style:{...CO.defaultData},isRandomSeed:!0,seed:e.generateSeed(),guessMode:!1,advanced:!1,steps:20,guidanceScale:7.5,controlNetScale:1,modifiers:TO.defaultData}),e.generateSeed=()=>Math.round(Math.random()*1e5)))(cf||(cf={}));var j1;(e=>{function t(r){return r.find(n=>n.data.type==="Page"&&n.data.globalPhysics.usePhysics)!==void 0}e.physicsEnabled=t;function i(r,n,s){r.scene.objects.traverseFrom(n,(a,o)=>{var l;if(o.type==="Instance"){let c=(l=$A.getComponentData(r,o.component))==null?void 0:l.data;c&&s(a,o,c.events)}else s(a,o,o.events)})}e.traverseModuleInstances=i})(j1||(j1={}));var uf;(e=>{e.TRASH_CAN_ID="830a2708-8ed9-49cf-a68e-085299892222",e.defaultLight={fi:-1,data:EO.defaultDirectionalLightData,id:"830a2708-8ed9-49cf-a68e-085299899103",children:[]};function t(n=!0,s=[]){let a=[],o=AO.defaultMeshObject;n&&(a.push({...e.defaultLight}),a.push({fi:1,id:"7ba78968-2a55-48f2-b14c-5191da3e075e",data:o,children:[]})),a.push(...s);let l=new bs;return l.push({fi:1,id:qx,data:{...i0.defaultData,name:"Scene 1"},children:a}),l}e.createDefaultObjectTreeWithPage=t,e.defaultData={objects:t(),publish:Ed.defaultData,styles:cf.defaultData()},e.emptyDataWithoutPage=function(){return{objects:new bs,publish:Ed.defaultData,styles:cf.defaultData()}},e.emptyDataWithPage=function(n=!0){return{objects:t(n),publish:Ed.defaultData,styles:cf.defaultData()}},e.emptyData=function(){return{objects:new bs,publish:{...Ed.defaultData},styles:cf.defaultData()}};function i(n){return{...e.defaultData,objects:nl(n,bs.prototype)}}e.withObjs=i;function r(n,s){return i([{id:n,data:s,children:[],fi:0}])}e.withObj=r})(uf||(uf={}));var Yx;(e=>e.defaultData={preset:"fullscreen",allowResponsive:!1,size:[512,512],coords:[0,0],sceneScale:1,color:{r:0,g:0,b:0,a:.5}})(Yx||(Yx={}));var PO;(e=>(e.defaultData=t=>({url:t,name:"New Webhook",parametersSchemas:new Nt}),e.defaultParameterValueByType=t=>t==="number"?0:t==="boolean"?!1:""))(PO||(PO={}));var HG;(e=>e.defaultData=(t,i="GET")=>({url:t,method:i,name:"New API",headers:new Nt,queries:new Nt,autoStart:!0}))(HG||(HG={}));var Ss;(e=>{function t(a){return a.textValue!==void 0}e.isTextValue=t;function i(a){return typeof a=="number"}e.isNumber=i;function r(a){return typeof a=="boolean"}e.isBoolean=r;function n(a){return t(a)?"string":r(a)?"boolean":"number"}e.typeOfVariable=n;function s(a){return e.isTextValue(a)?Array.isArray(a.textValue)?a.textValue.map(o=>o.toString().padStart(a.padding??2,"0")).join(a.deliminator??":")+(a.suffix!==void 0?" "+a.suffix:""):a.textValue.toString():e.isBoolean(a)?a?"True":"False":e.isNumber(a)?parseFloat(a.toFixed(3)).toString():a.toString()}e.getDisplayedValue=s})(Ss||(Ss={}));var DO;(e=>e.all=["images","videos","colors","audios","particles","fonts","materials","variables"])(DO||(DO={}));var GG;(e=>e.all=[...DO.all,"components"])(GG||(GG={}));var jG;(e=>{function t(){return{images:new Gt,videos:new Gt,colors:new Gt,audios:new Gt,particles:new Gt,fonts:new Gt,materials:new Gt,components:new Gt,variables:new Gt,userAPIs:new Gt,userWebhooks:new Gt}}e.defaultData=t})(jG||(jG={}));var ph;(e=>{function t(){return{images:new Gt,videos:new Gt,colors:new Gt,audios:new Gt,particles:new Gt,fonts:new Gt,materials:new Gt,components:new Gt,variables:new Gt,userAPIs:new Gt,userWebhooks:new Gt}}e.defaultData=t})(ph||(ph={}));var Fo;(e=>{function t(){let a={};return a["89b10010-844c-11ec-a8a3-0242ac120002"]={r:.5,g:.5,b:.5,a:1,name:"Default Color"},nl(a,Gt.prototype)}e.defaultColors=t;function i(){return nl({},Gt.prototype)}e.defaultImages=i;function r(){return{catelogs:new Gt,materials:new Gt,images:new Gt,videos:new Gt,colors:new Gt,audios:new Gt,particles:new Gt,fonts:new Gt,variables:new Nt,userAPIs:new Gt,userWebhooks:new Gt,lib:ph.defaultData()}}e.emptyData=r;function n(a){switch(a){case"number":return{value:0,name:"Number"};case"boolean":return{value:!1,name:"Boolean"};case"string":return{value:{textValue:"String value"},name:"String"};case"time":let o=[0,0,0];return{name:"Time",value:{textValue:o,deliminator:":",padding:2,suffix:"AM"},dynamicVariableType:"time",format:"HH:mm:ss",format12h24h:"12ampm",timeZone:null,hasEnd:!1,endValue:{textValue:o,deliminator:":",padding:2,suffix:"AM"},autoStart:!0,repeat:!1};case"counter":return{name:"Counter",value:0,dynamicVariableType:"counter",updateInterval:1e3,increment:1,autoStart:!0,hasEnd:!0,endValue:60,repeat:!0,randomStart:!1,range:[0,100],decimals:0};case"random":return{name:"Random",value:0,dynamicVariableType:"random",updateInterval:1e3,increment:1,autoStart:!0,isStatic:!1,hasEnd:!0,endValue:60,repeat:!0,min:0,max:100,decimals:0};default:console.error("Unknown variable type",a)}}e.defaultVariables=n;function s(a,o){if(o.format==="HH:mm:ss"){let l=Math.floor(a/3600),c=Math.floor((a-l*3600)/60),u=Math.round(a-l*3600-c*60);return{textValue:[l,c,u]}}else if(o.format==="mm:ss"){let l=Math.floor(a/60),c=Math.round(a-l*60);return{textValue:[l,c]}}else return o.format==="number"?a=Math.round(a):a=Math.round(a*1e3)/1e3,a}e.getFormattedTimerTime=s})(Fo||(Fo={}));var KA;(e=>e.list=["idle","move","jump","run"])(KA||(KA={}));var ZA;(e=>(e.defaultColliderData={type:"capsule",height:200,radius:50,position:[0,0,0],rotation:[0,0,0]},e.defaultDataThirdPerson={moveMode:"walk",forwardDirection:"+z",speedTranslate:1e3,speedRotate:100,runMultiplier:2,rotationMode:"normal",rotBy:"keys",rotByTouch:"drag",delayPos:[.3,.3],delayRot:[.3,.3],keyAssignments:[["moveNegZ","W"],["moveNegX","A"],["movePosZ","S"],["movePosX","D"],["rotPosX",""],["rotPosY",""],["rotNegX",""],["rotNegY",""],["jump","Space"],["run",""],["none","Ctrl"]],touchControl:!0,joystickPosLoc:5,joystickRotLoc:11,jumpTouchButtonLoc:9,collider:e.defaultColliderData,colliderHelperVisible:!0,collisionEnabled:!0,jumpPower:100,resetYPosition:3e3,alignToGround:!1,autoOrientMove:!0,orientWith:"camera",orientMode:"radial",delayPosCamera:.3,delayRotCamera:.3,camera:"",cameraXAxis:"Limit",cameraYAxis:"Free",cameraRotXLimits:[0,Math.PI/2],cameraRotYLimits:[-Math.PI/2,Math.PI/2],gameActions:{idle:new Nt,move:new Nt,jump:new Nt,run:new Nt},navmesh:{enabled:!1,ch:6,cs:6,walkableClimb:5,walkableHeight:1,walkableRadius:0,zones:"all",objects:[],helperVisible:!0,destinationHelperRadius:0,destinationHelperColor:ar.fromHexAndA(3728051,1)}}))(ZA||(ZA={}));function WG(e){e.layers.forEach(t=>{if(t.type==="depth"&&t.colorA!==void 0){let i=t.colorA,r=t.colorB,n=[[i.r,i.g,i.b,i.a],[r.r,r.g,r.b,r.a]],s=[0,1];for(let o=2;o<10;o++)n.push(n[1]),s.push(1);let a={...th(on(t),"type","visible","isVector","isWorldSpace","origin","alpha","mode"),near:Math.max(0,t.near),far:Math.max(0,t.far),colors:n,steps:s,num:2,direction:[1,0,0],smooth:!1,gradientType:1};Object.assign(t,a)}else if(t.type==="depth"&&t.gradientType===1&&(t.near<0||t.far<0)){let i={...on(t),near:Math.max(t.near,0),far:Math.max(t.far,0)};Object.assign(t,i)}})}function pd(e,t){Object.values(e.shared.materials).forEach(i=>t(i))}function fd(e,t){e.scene.objects.traverse((i,r)=>{"materials"in r?r.materials.forEach((n,s)=>{n===void 0&&(r.materials[s]=_s.defaultData(),n=r.materials[s]),typeof n!="string"&&t(n)}):"material"in r?typeof r.material!="string"&&(r.material===void 0&&(r.material=_s.defaultData()),t(r.material)):r.type==="Mesh"&&(r.material===void 0&&(r.material=_s.defaultData()),t(r.material)),"overrides"in r&&Object.values(r.overrides).forEach(n=>{n.material&&typeof n.material!="string"&&Object.getPrototypeOf(n.material)!==Cn.prototype&&t(n.material)})})}function dbe(e){Object.assign(e.scene.publish,{orbitControls:{...QA.defaultData,...on(e.scene.publish.orbitControls)}})}function pbe(e){Object.assign(e.scene.publish.settings,{video:{...Ed.defaultData.settings.video,...on(e.scene.publish.settings.video)}})}function fbe(e){function t(i){if(i.layers){for(let r of Object.values(i.layers))if(r){for(let[n,s]of Object.entries(r))if((CK.includes(n)||typeof s=="boolean")&&delete r[n],n==="texture")for(let[a,o]of Object.entries(s))(hbe.includes(a)||typeof o=="boolean")&&delete s[a]}}}e.scene.objects.traverse((i,r)=>{r.states.forEach(n=>{let s=n;s.material?t(s.material):s.materials&&s.materials.forEach(a=>{t(a)})})})}function mbe(e){e.scene.publish.withBackground=!0}function gbe(e){e.scene.publish.settings.web={compress:!0,preload:!0,preset:1,logo:!0,hint:!1}}function vbe(e){e.scene.objects.traverse((t,i)=>{let r=i.cloner;r&&(r.radial.scale=r.radial.scale.map(n=>n+1),r.linear.scale=r.linear.scale.map(n=>n+1))})}function ybe(e){e.scene.objects.traverse((t,i)=>{let r=i.geometry;r&&(r.type==="DodecahedronGeometry"||r.type==="IcosahedronGeometry")&&(r.detail=Math.round(r.detail))})}function xbe(e){e.scene.objects.traverse((t,i)=>{let r=e.scene.objects.unproxy().parent(t);if(r){let n=on(e.scene.objects.data(r));n&&n.type==="Mesh"&&n.geometry.type==="BooleanGeometry"&&i.type==="Mesh"&&(i.visible=on(i).booleanExclude!==!0)}})}function wbe(e){e.scene.objects.traverse((t,i)=>{if(i.type==="Mesh"){let r=i;i.geometry.type==="NonParametricGeometry"?r.material!==void 0&&delete r.material:r.materials!==void 0&&delete r.materials}})}function bbe(e){function t(r){Object.setPrototypeOf(r,Cn.prototype),r.texture&&Object.setPrototypeOf(r.texture,Cn.prototype)}function i(r){Object.setPrototypeOf(r,Cn.prototype);for(let n in r)t(r[n])}e.scene.objects.traverse((r,n)=>{n.states.forEach(s=>{let a=s;if(a.material){let o=on(a.material).layers;i(o),a.material.layers=o}if(a.materials)for(let o=0;o<a.materials.length;o++){let l=a.materials[o],c=on(l).layers;i(c),l.layers=c}})})}function XG(e){e.layers===void 0&&Object.assign(e,_s.defaultTwoLayerData("lambert"))}function f3(e){!e.layers||e.layers.forEach(t=>{if(t.type==="depth"&&t.colors.length===10){let i=[...t.colors];i.push(t.colors[9]);let r=[...t.steps];r.push(t.steps[9]);let n={...on(t),colors:i,steps:r};Object.assign(t,n)}})}function _be(e){e.scene.objects.traverse((t,i)=>{i.type==="Mesh"&&(i.geometry.type==="BooleanGeometry"||i.geometry.type==="SubdivGeometry")&&(i.geometry.phongAngle=35)})}function qG(e){e.scene.objects.traverse((t,i)=>{"materials"in i?i.materials.forEach(r=>{typeof r!="string"&&f3(r)}):"material"in i&&typeof i.material!="string"&&f3(i.material)}),Object.values(e.shared.materials).forEach(t=>f3(t))}function Sbe(e){e.scene.environment.ambientLight.softShadows=!1,e.scene.environment.ambientLight.softShadowQuality="low",e.scene.objects.traverse((t,i)=>{(i.type==="DirectionalLight"||i.type==="SpotLight")&&(i.shadowResolution=1024,i.shadowRadius=1,i.depth=1e5)}),e.shared.penumbraSize=new Array(5).fill(.5)}function Mbe(e){e.shared.audios=nl({},Gt.prototype)}function Ebe(e){e.shared.videos=nl({},Gt.prototype)}function Abe(e){let t=e.shared.materials;Object.entries(t).forEach(([i,r])=>{if(!r.layers){let n={name:"Untitled Material",layers:[{fi:0,data:{type:"light",category:"phong",alpha:.6,visible:!0,mode:0,specular:{r:.2,g:.2,b:.2},shininess:5},id:"layer1"},{fi:1,data:{type:"color",alpha:1,visible:!0,mode:0,color:{r:.2823529411764706,g:.2823529411764706,b:.30196078431372547}},id:"layer2"}]};Object.assign(t,{[i]:n})}})}function Cbe(e){Object.entries(on(e.shared.images)).filter(t=>t[1].asset===!1).map(t=>t[0]).forEach(t=>{delete e.shared.images[t]}),Object.entries(on(e.shared.audios)).filter(t=>t[1].asset===!1).map(t=>t[0]).forEach(t=>{delete e.shared.audios[t]})}function Tbe(e){e.scene.publish.settings.web.preload=!1}function YG(e){e.layers&&e.layers.forEach(t=>{t.type==="depth"&&t.num!==void 0&&(t.colors=t.colors.slice(0,t.num),t.steps=t.steps.slice(0,t.num),delete t.num)})}function QG(e){e.layers&&e.layers.forEach(t=>{ube(t)&&t.isMask===void 0&&(t.isMask=!1),(t.type==="texture"||t.type==="video")&&t.blending===void 0&&(t.blending=0),(t.type==="noise"||t.type==="displace"&&t.displacementType==="noise")&&(t.voronoiStyle===void 0&&(t.voronoiStyle=0),t.highCut===void 0&&(t.highCut=1),t.lowCut===void 0&&(t.lowCut=0),t.smoothness===void 0&&(t.smoothness=.3),t.seed===void 0&&(t.seed=0),t.quality===void 0&&(t.quality=1))})}function Pbe(e){e.shared.fonts=nl({},Gt.prototype)}function Dbe(e){return e.replace(".typeface","").replace(/optimer/gi,"open sans").replace("space_mono","space mono").replace(/alma_mono/gi,"varela round").replace(/droid_sans_mono/gi,"noto sans mono").replace(/droid_sans|gentilis|gnomon_(simple|foreground)|helvetiker/gi,"roboto").replace(/droid_serif/gi,"roboto slab").replace("_sans"," sans").replace("crimson_text","crimson text").replace("medium_medium","medium").replace("fatface_fatface","fatface").replace("100hairline","thin").replace("200thin","extralight").replace("300light","light").replace("500medium","medium").replace("600semi","semibold").replace("800heavy","extrabold").replace("900black","black").replace(/bodoni_(11|16|24|36|48|72|96)([^_])/gi,"bodoni_$1_$2").replace(/bodoni_(11|16|24|36|48|72|96)/gi,"bodoni moda").replace(/(thin|hairline)(_regular)?/gi,"100").replace(/(extra|ultra)light(_regular)?/gi,"200").replace(/light(_regular)?/gi,"300").replace(/_book|_normal|_roman/gi,"_regular").replace(/medium(_regular)?/gi,"500").replace(/(semi|demi)bold(_regular)?/gi,"600").replace(/(extra|ultra)bold(_regular)?/gi,"800").replace(/bold(_regular)?/gi,"700").replace(/(black|heavy|fatface)(_regular)?/gi,"900").replace(/([1-9]00)_italic/gi,"$1italic").replace(/regularitalic/gi,"italic").replace(/regularitalic/gi,"italic").split(" ").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")}function Rbe(e){let t=[];e.scene.objects.traverse((i,r)=>{let n=r;if(n.type==="TextFrame"){let s=_s.defaultTwoLayerData("phong"),a=typeof n.color=="string"?e.shared.colors[n.color]:n.color;s.layers[1].data.color={r:a.r,g:a.g,b:a.b},s.layers[1].data.alpha=n.alpha;let o=Dbe(n.font);e.shared.fonts[o]===void 0&&(e.shared.fonts[o]={name:o});let l={name:n.name,...ss.defaultData,...of.defaultData,flatShading:!1,wireframe:!1,geometry:{...af.defaultData("TextGeometry"),width:n.width,height:n.height,font:o,depth:0,horizontalAlign:n.horizontalAlign,verticalAlign:n.verticalAlign,fontSize:n.fontSize*1.40625,lineHeight:n.lineHeight/1.40625,letterSpacing:n.letterSpacing-1,text:n.text,textTransform:n.textTransform,extrudeBevelSize:0,extrudeBevelSegments:1},material:s,states:on(n.states),events:on(n.events),visible:n.visible,raycastLock:n.raycastLock,position:n.position,rotation:n.rotation,scale:n.scale,hiddenMatrix:n.hiddenMatrix},c=on(e.scene.objects).parent(i);e.scene.objects.insertAfter(c??null,i,[{id:i+"new",data:l,children:[]}]),t.push(i)}}),t.forEach(i=>{e.scene.objects.delete(i)})}function Ibe(e){let t={0:"MouseDown",1:"MouseUp",2:"MouseHover",5:"KeyDown",6:"KeyUp",7:"Start",9:"LookAt",10:"Follow",11:"Scroll",12:"Audio",13:"GameControl"};e.scene.objects.traverse((i,r)=>{r.events.forEach(n=>{if(t[Number(n.type)])if(Object.assign(n,{type:t[Number(n.type)]}),n.type==="Audio"&&"audioEvent"in n&&(Object.assign(n,{playAudio:n.audioEvent}),delete n.audioEvent),n.type==="GameControl")Object.assign(n,{gameActions:{idle:new Nt,move:new Nt,jump:new Nt}});else{let s=new Nt;Object.assign(n,{actions:s}),(n.type==="MouseDown"||n.type==="MouseUp"||n.type==="KeyDown"||n.type==="KeyUp")&&"url"in n&&s.push({fi:0,id:Et.generateUUID(),data:{type:"Link",url:n.url,delay:0}}),"targets"in n&&(n.targets.forEach((a,o,l)=>{let c={state:void 0,repeat:0,delay:0,delayDirection:void 0,direction:"normal",duration:0,easing:4},u={easing:a.easing,duration:a.duration};a.easing===6?Object.assign(u,th(a,"mass","stiffness","damping","velocity")):a.easing===5&&Object.assign(u,{control1:{...a.control1},control2:{...a.control2}});let h={repeat:a.repeat?-1:0,delay:a.delay,delayDirection:a.delayDirection,direction:a.cycle&&a.rewind?"pingpong-rewind":a.cycle?"pingpong":"normal"},d={state:a.state,...h,...u},p={allowSlerp:!0,type:"Transition",object:a.object,repeat:0,delay:0,delayDirection:void 0,direction:"normal",tweens:new Nt({fi:0,id:Et.generateUUID(),data:c},{fi:1,id:Et.generateUUID(),data:d})};s.push({fi:l,id:o,data:p})}),delete n.targets)}})})}function Lbe(e){e.scene.objects.traverse((t,i)=>{function r(n,s){var l;let a=new Nt,o=[];if(i.events.forEach((c,u,h)=>{if(c.type==="Audio"&&c.trigger===s){let d;o.push(u),c.interaction==="play"?d={...th(c,"interaction","audio","delay","volume","loop"),triggerAfter:"after"in c?c.after:void 0,toggle:"after"in c?c.toggle:void 0,type:"Audio"}:(c.interaction==="pause"||c.interaction==="stop")&&(d={...th(c,"interaction","delay","object","playAudio"),type:"Audio"}),d&&a.push({fi:h,id:u,data:d})}}),o.forEach(c=>i.events.delete(c)),a.length){let c=(l=i.events.find(u=>u.type===n))==null?void 0:l.data;c?"actions"in c&&c.actions.insertBefore(null,a):i.events.insertBefore(null,[{id:Et.generateUUID(),data:{type:n,actions:a}}])}}r("Start","start"),r("MouseDown","mouseDown"),r("MouseUp","mouseUp"),r("KeyDown","keyDown"),r("KeyUp","keyUp")})}function KG(e){var i;let t=(i=e.layers.find(r=>r.type==="light"))==null?void 0:i.data;if((t==null?void 0:t.category)==="basic"){let r=Zn.defaultData("light","phong"),n=t;Object.assign(n,r),n.visible=!1}}function ZG(e){pd(e,KG),fd(e,KG)}function Obe(e){e.scene.objects.traverse((t,i)=>{i.type==="Mesh"&&i.geometry.type==="SubdivGeometry"&&(i.geometry.scaleBaked||(i.geometry.scaleBaked=[1,1,1]))})}function zbe(e){e.scene.objects.traverse((t,i)=>{(i.type==="Empty"||i.type==="Mesh")&&i.cloner&&!i.cloner.randomnessObject&&!i.cloner.toObject&&!i.cloner.randomness&&(i.cloner={...i.cloner,toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}})})}function Nbe(e){e.scene.objects.traverse((t,i)=>{i.type==="Mesh"&&i.geometry.type==="NonParametricGeometry"&&!("material"in i)&&!("materials"in i)&&(i.material=_s.defaultTwoLayerData("phong"))})}function Bbe(e){e.scene.publish.orbitControls.autoZoom===void 0&&(e.scene.publish.orbitControls.autoZoom=!1),e.scene.objects.traverse((t,i)=>{(i.type==="OrthographicCamera"||i.type==="PerspectiveCamera")&&(i.orthographic.autoZoom===void 0&&(i.orthographic.autoZoom=!1),i.orthographic.autoZoomFrustumSize===void 0&&(i.orthographic.autoZoomFrustumSize=790))})}function kbe(e){e.scene.objects.traverse((t,i)=>{i.pathSnapping===void 0&&(i.pathSnapping={pathId:null,slide:0,offset:0,orientation:"tangential"}),i.pathSnapping.offset===void 0&&(i.pathSnapping.offset=0)})}function Ube(e){e.scene.publish.mouseEventTarget===void 0&&(e.scene.publish.mouseEventTarget="canvas"),e.scene.publish.settings.web.hint===void 0&&(e.scene.publish.settings.web.hint=!1)}function Fbe(e){let{video:t}=e.scene.publish.settings;t.format==="gif"&&t.fps>48&&(t.fps=15)}function Vbe(e){e.scene.objects.traverse((t,i)=>{i.events.forEach(r=>{r.type==="GameControl"&&(r.resetYPosition=Math.abs(r.resetYPosition-i.position[1]))})})}function Hbe(e){let t=e.scene.environment.usePhysics;e.scene.objects.traverse((i,r)=>{t&&r.physics===null?r.collision=!1:r.collision="visibility"})}function Gbe(e){e.scene.objects.traverse((t,i)=>{i.events.forEach(r=>{r.type==="GameControl"&&(r.navmesh=ZA.defaultDataThirdPerson.navmesh)})})}function jbe(e){e.scene.styles||(e.scene.styles=cf.defaultData())}function $G(e){e.layers.forEach(t=>{t.type==="light"&&t.category!=="toon"&&t.occlusion===void 0&&(t.occlusion=!0)})}function Wbe(e){e.scene.environment.ambientLight.occlusion===void 0&&(e.scene.environment.ambientLight.occlusion=!1),e.scene.environment.ambientLight.aoFullRes===void 0&&(e.scene.environment.ambientLight.aoFullRes=!1),e.scene.environment.ambientLight.radius===void 0&&(e.scene.environment.ambientLight.radius=256),e.scene.environment.ambientLight.bias===void 0&&(e.scene.environment.ambientLight.bias=.5),e.scene.environment.ambientLight.aoColor===void 0&&(e.scene.environment.ambientLight.aoColor={r:.19607843137254902,g:.19607843137254902,b:.19607843137254902}),fd(e,$G),pd(e,$G)}function Xbe(e){e.scene.objects.traverse((t,i)=>{i.events.forEach(r=>{r.type==="GameControl"&&Object.assign(r.gameActions,{run:new Nt})})})}function qbe(e){e.scene.objects.traverse((t,i)=>{i.events.forEach(r=>{r.type==="GameControl"&&(r.keyAssignments=[...r.keyAssignments,["run",""],["none","Ctrl"]])})})}function JG(e){e.layers&&e.layers.forEach(t=>{t.type==="light"&&t.bumpMapIntensity===void 0&&(t.bumpMapIntensity=5)})}function Ybe(e,t){if(t<1&&(fd(e,WG),pd(e,WG),e.schema=1),t<2&&(dbe(e),e.schema=2),t<3&&(fbe(e),e.schema=3),t<4&&(mbe(e),e.schema=4),t<5&&(gbe(e),e.schema=5),t<6&&(vbe(e),e.schema=6),t<7&&(ybe(e),e.schema=7),t<8&&(e.schema=8),t<9&&(qG(e),e.schema=9),t<10&&(_be(e),e.schema=10),t<11&&(Sbe(e),e.schema=11),t<12&&(qG(e),e.schema=12),t<13&&(Mbe(e),e.schema=13),t<14&&(Abe(e),e.schema=14),t<15&&(Cbe(e),e.schema=15),t<16&&(Tbe(e),e.schema=16),t<17&&(fd(e,YG),pd(e,YG),e.schema=17),t<18&&(fd(e,XG),pd(e,XG),e.schema=18),t<19&&(pbe(e),e.schema=19),t<20&&(Pbe(e),Rbe(e),e.schema=20),t<21&&(Ibe(e),Lbe(e),e.schema=21),t<22&&(ZG(e),e.schema=22),t<23&&(Obe(e),e.schema=23),t<24&&(zbe(e),e.schema=24),(t<25||e.shared.videos===void 0)&&(Ebe(e),t<25&&(e.schema=25)),t<26&&(xbe(e),e.schema=26),t<27&&(wbe(e),e.schema=27),t<28&&(ZG(e),e.schema=28),t<29&&(bbe(e),e.schema=29),t<30&&(Nbe(e),e.schema=30),t<31&&(Bbe(e),e.schema=31),t<33&&(kbe(e),e.schema=33),t<34&&(Ube(e),e.schema=34),t<35&&(Fbe(e),e.schema=35),t<36&&(Vbe(e),e.schema=36),t<37&&(Hbe(e),e.schema=37),t<38&&(fd(e,QG),pd(e,QG),e.schema=38),t<39&&(Gbe(e),e.schema=39),t<40&&(jbe(e),e.schema=40),t<41&&(Wbe(e),e.schema=41),t<42&&(Xbe(e),e.schema=42),t<43&&(qbe(e),e.schema=43),t<99){fd(e,JG),pd(e,JG),e.scene.publish.playCamera===null&&(e.scene.publish.playCamera=L0);let i=on(e.scene.objects),r=e.scene.objects;e.scene.publish.playPage=qx,r.insertBefore(null,null,[{id:qx,data:{...i0.defaultData,backgroundColor:e.scene.backgroundColor,fog:e.scene.fog,postprocessing:e.scene.postprocessing,ao:th(e.scene.environment.ambientLight,"occlusion","aoFullRes","radius","bias","aoColor"),publish:{playCamera:e.scene.publish.playCamera,gameControlObject:e.scene.publish.gameControlObject},shadow:th(e.scene.environment.ambientLight,"softShadowQuality"),globalPhysics:{...e0.defaultData,...th(e.scene.environment,"usePhysics","gravity")},camera:on(e.scene.ownerCamera)??i0.defaultData.camera,name:"Scene"},children:[]}]);for(let a of i)a.id!==uf.TRASH_CAN_ID&&r.move(qx,a.fi,a.id);let n=0,s=0;e.shared.penumbraSize&&e.scene.objects.traverse((a,o)=>{o.type==="DirectionalLight"?(o.penumbraSize=e.shared.penumbraSize[Math.min(n,2)],n+=1):o.type==="SpotLight"&&(o.penumbraSize=e.shared.penumbraSize[3+Math.min(s,1)],s+=1),(o.physics===void 0||o.physics===null)&&o.type!=="Instance"&&(o.physics={},Object.assign(o.physics,Jv.defaultData)),o.physics!==void 0&&o.physics!==null&&(o.physics.enabled=o.collision??"visibility",delete o.collision)}),e.schema=99}}function e6(e){e.layers&&e.layers.forEach(t=>{t.type==="light"&&t.alphaOverride===void 0&&(t.alphaOverride=1)})}function Qbe(e){e.scene.objects.traverse((t,i)=>{let r=i.geometry;r&&r.type==="PathGeometry"&&(r.extrusion.capType="flat",r.extrusion.bevel=50,r.extrusion.bevelSides=6,r.extrusion.shape.type==="Custom"&&(r.extrusion.shape.shapeQuality="low"))})}function Kbe(e){var t;Array.isArray(on(e.events))&&((t=e.events)==null||t.forEach(i=>{"disabled"in i||(i.disabled=!1),(i.type==="MouseDown"||i.type==="MouseUp"||i.type==="MousePress")&&(i.mode=i.mode||"Object")}))}var zg=180/Math.PI;function t6(e){e.rotation=e.rotation.slice(0,3).map(t=>t*zg)}function RK(e){var i,r;t6(e),e.type==="Page"&&t6(e.camera),(i=e.states)==null||i.forEach(n=>{n.rotation===void 0||n.rotation===null||(n.rotation=n.rotation.slice(0,3).map(s=>s*zg))});let t=e.geometry;t&&t.type==="SphereGeometry"&&(t.thetaLength=(t.thetaLength??180)*zg),t&&t.type==="TorusGeometry"&&(t.arc=t.arc*zg),t&&t.type==="PathGeometry"&&(t.extrusion.angle*=zg,t.extrusion.twist*=zg),e.type==="Mesh"&&e.geometry.type==="TextGeometry"&&(e.geometry.text={textValue:e.geometry.text}),Array.isArray(on(e.events))&&((r=e.events)==null||r.forEach(n=>{(n.type==="MouseDown"||n.type==="MouseUp"||n.type==="MousePress"||n.type==="KeyDown"||n.type==="KeyUp"||n.type==="KeyPress"||n.type==="Collision"||n.type==="Trigger")&&(n.runMode=n.toggle?"Toggle":"Repeat")}))}function Zbe(e){e.shared.variables=nl({},Gt.prototype)}function $be(e){let t=on(e.shared.variables);e.shared.variables=nl(Object.entries(t??{}).map(([i,r],n)=>({fi:n,id:i,data:r})),Nt.prototype)}var Ou=115;function IK(e,t){t(e.data);for(let i of e.children)IK(i,t)}function Jbe(e){let t=e.schema??104;t!==Ou&&t<105&&(IK(e.asset,RK),e.schema=105)}function e_e(e){e.shared.particles=nl({},Gt.prototype),e.shared.lib&&(e.shared.lib.particles=ph.defaultData().particles)}function t_e(e){e.scene.objects.traverse((t,i)=>{i.type==="Particle"&&typeof i.renderMaterial.size=="number"&&Object.assign(i.renderMaterial,{size:[i.renderMaterial.size,i.renderMaterial.size]})})}function i_e(e){e.scene.objects.traverse((t,i)=>{i.type==="Page"&&(i.postprocessing.depthOfField.focusDistance=100,i.postprocessing.depthOfField.focalLength=20,i.postprocessing.depthOfField.bokehScale=5)})}function r_e(e){e.scene.objects.traverse((t,i)=>{var r;Array.isArray(on(i.events))!==!1&&((r=i.events)==null||r.forEach(n=>{var a,o,l,c,u,h,d,p,f,v,g;let s=n.runMode;n.type==="MouseDown"||n.type==="MouseUp"||n.type==="KeyDown"||n.type==="KeyUp"||n.type==="Collision"||n.type==="Trigger"?(a=n.actions)==null||a.forEach(m=>{m.type==="Transition"&&(m.runMode=s??"Repeat"),(m.type==="Animation"||m.type==="SwitchCamera")&&(m.runMode=s==="Toggle"?"Toggle":"Normal")}):n.type==="MouseHover"||n.type==="MousePress"||n.type==="KeyPress"?(o=n.actions)==null||o.forEach(m=>{(m.type==="Transition"||m.type==="Animation"||m.type==="SwitchCamera")&&(m.runMode="Toggle")}):n.type==="GameControl"?(delete n.actions,Object.keys(n.gameActions).forEach(m=>{var x;(x=n.gameActions[m])==null||x.forEach(w=>{w.type==="Transition"&&(w.runMode="Repeat"),w.type==="Animation"&&(w.runMode="Normal")})})):n.type==="DragDrop"?(delete n.actions,(c=(l=n.dragDropActions)==null?void 0:l.drag)==null||c.forEach(m=>{(m.type==="Transition"||m.type==="Animation"||m.type==="SwitchCamera")&&(m.runMode="Toggle")}),(h=(u=n.dragDropActions)==null?void 0:u.drop)==null||h.forEach(m=>{(m.type==="Transition"||m.type==="Animation"||m.type==="SwitchCamera")&&(m.runMode="Toggle")})):n.type==="Resize"?(delete n.actions,(d=n.breakpoints)==null||d.forEach(m=>{var x;(x=m.actions)==null||x.forEach(w=>{(w.type==="Transition"||w.type==="Animation"||w.type==="SwitchCamera")&&(w.runMode="Toggle")})})):n.type==="Start"?(p=n.actions)==null||p.forEach(m=>{m.type==="Transition"&&(m.runMode="Once"),(m.type==="Animation"||m.type==="SwitchCamera")&&(m.runMode="Normal")}):n.type==="VariableChange"||n.type==="Scroll"?(f=n.actions)==null||f.forEach(m=>{m.type==="Transition"&&(m.runMode="Repeat"),(m.type==="Animation"||m.type==="SwitchCamera")&&(m.runMode="Normal")}):n.type==="Conditional"&&(delete n.actions,(v=n.inActions)==null||v.forEach(m=>{m.type==="Transition"&&(m.runMode="Repeat"),(m.type==="Animation"||m.type==="SwitchCamera")&&(m.runMode="Normal")}),(g=n.outActions)==null||g.forEach(m=>{m.type==="Transition"&&(m.runMode="Repeat"),(m.type==="Animation"||m.type==="SwitchCamera")&&(m.runMode="Normal")}))}))})}function n_e(e){e.shared.userAPIs=nl({},Gt.prototype),e.shared.userWebhooks=nl({},Gt.prototype),e.shared.lib&&(e.shared.lib.userAPIs=ph.defaultData().userAPIs,e.shared.lib.userWebhooks=ph.defaultData().userWebhooks)}function LK(e){let t=e.schema??0;if(t!==Ou){console.warn("updating from ",t,"to ",Ou),Ybe(e,t),t<100&&(e.scene.publish.joystickSizeAndXYOffset===void 0&&(e.scene.publish.joystickSizeAndXYOffset=Ed.defaultData.joystickSizeAndXYOffset),e.schema=100),t<101&&(fd(e,e6),pd(e,e6),e.schema=101),t<102&&(Qbe(e),e.schema=102),t<104&&(e.shared.catelogs=new Gt,e.shared.lib=ph.defaultData(),e.schema=104),t<105&&(Zbe(e),e.scene.objects.traverse((i,r)=>{RK(r)}),e.schema=105);for(let i of Object.values(e.shared.lib.components))Jbe(i);t<106&&($be(e),e.schema=106),t<107&&(e.shared.lib.variables=ph.defaultData().variables,e.schema=107),t<109&&(e_e(e),e.schema=109),t<110&&(t_e(e),e.schema=110),t<111&&(e.scene.objects.traverse((i,r)=>{Kbe(r)}),e.schema=111),t<112&&(i_e(e),e.schema=112),t<113&&(r_e(e),e.schema=113),t<114&&(e.scene.publish.settings.web.imageQuality===void 0&&(e.scene.publish.settings.web.imageQuality=70),e.schema=114),t<115&&(n_e(e),e.schema=115)}}var $A;(e=>{e.defaultData={schema:Ou,scene:uf.defaultData,frames:new Gt().add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",Yx.defaultData),shared:{...Fo.emptyData(),colors:Fo.defaultColors()}},e.emptyDataForImports=function(){let s=uf.emptyDataWithPage();return{schema:Ou,scene:s,frames:new Gt().add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",Yx.defaultData),shared:{...Fo.emptyData(),colors:Fo.defaultColors(),images:Fo.defaultImages()}}},e.emptyData=function(){return{schema:Ou,scene:uf.emptyDataWithPage(),frames:new Gt().add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",Yx.defaultData),shared:Fo.emptyData()}},e.clipboard2dData=function(){return{schema:Ou,scene:uf.emptyData(),frames:new Gt,shared:Fo.emptyData()}},e.collabHelper={...ZL,updateSchema(s){return(s.schema??0)<Ou?H1(s,LK):(s.schema??0)-Ou}};function t(s){let a=e.collabHelper.updateSchema(s);return typeof a=="number"?a===0?s:null:a.data}e.updateSchemaDirectly=t;function i(s){return{...s,shared:{...s.shared,lib:ph.defaultData()}}}e.withoutLib=i;function r(s,a){let o=s.scene.objects.get(a);if(o&&o.data.type==="Component")return o;{let l=s.shared.lib.components[a];if(l)return l.asset}}e.getComponentData=r;function n(s){let a=Object.values(s.shared.userAPIs);for(let o of a){let l=o.headers;for(let c of l)if(c.data.key.toLowerCase()==="authorization"&&c.data.value!=="")return!0}return!1}e.hasSensitiveData=n})($A||($A={}));var RO;(e=>e.emptyImage={data:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVQYV2NgYAAAAAMAAWgmWQ0AAAAASUVORK5CYII=",name:"empty"})(RO||(RO={}));var i6;(e=>{function t(i){return!0}e.is=t})(i6||(i6={}));var JA;(e=>{e.defaultData={position:[0,0],scale:[1,1],rotation:0,shear:[0,0]};function t(r,n){return{position:(n==null?void 0:n.position)??r.position,rotation:(n==null?void 0:n.rotation)??r.rotation,scale:(n==null?void 0:n.scale)??r.scale,shear:(n==null?void 0:n.shear)??r.shear}}e.merge=t;function i(r,n){return XQ({position:Ku.isEqual(r.position,n.position)?void 0:n.position,rotation:r.rotation===n.rotation?void 0:n.rotation,scale:Ku.isEqual(r.scale,n.scale)?void 0:n.scale,shear:r.shear&&n.shear&&Ku.isEqual(r.shear,n.shear)?void 0:n.shear})}e.diff=i})(JA||(JA={}));var IO;(e=>e.defaultData={horizontalConstraint:0,verticalConstraint:0})(IO||(IO={}));var r6;(e=>e.defaultData={direction:"row",wrap:"unwrap",align:"top-left",gap:10,rowGap:10,autoGap:!1,autoRowGap:!1,leftPadding:8,rightPadding:8,topPadding:8,bottomPadding:8})(r6||(r6={}));var eC;(e=>e.defaultData={opacity:1,fill:{color:ar.fromHexAndA(vo,1),enabled:!0},stroke:{color:ar.from0to1([0,0,0,1]),thickness:1,enabled:!1,mode:"inside"},layerBlur:{radius:2,enabled:!1},backgroundBlur:{radius:2,enabled:!1},dropShadow:{offset:[10,10],blurRadius:10,color:ar.from0to1([0,0,0,1]),enabled:!1,spread:0},innerShadow:{offset:[10,10],blurRadius:10,color:ar.from0to1([0,0,0,1]),enabled:!1,spread:0}})(eC||(eC={}));var hf;(e=>{function t(a,o){return{name:o}}e.newEmpty=t;function i(a,o){if(o===void 0)return a;let l={...a},c=["width","height","cornerRadius"];for(let u of c)u in l&&u in o&&o[u]!==void 0&&Object.assign(l,{[u]:o[u]});return l}function r(a,o){if(o===void 0)return a;let l={...a};return"fill"in l&&"fill"in o&&o.fill!==void 0&&Object.assign(l,{fill:{...l.fill,...o.fill}}),"stroke"in l&&"stroke"in o&&o.stroke!==void 0&&Object.assign(l,{stroke:{...l.stroke,...o.stroke}}),"layerBlur"in l&&"layerBlur"in o&&o.layerBlur!==void 0&&Object.assign(l,{layerBlur:{...l.layerBlur,...o.layerBlur}}),"backgroundBlur"in l&&"backgroundBlur"in o&&o.backgroundBlur!==void 0&&Object.assign(l,{backgroundBlur:{...l.backgroundBlur,...o.backgroundBlur}}),"dropShadow"in l&&"dropShadow"in o&&o.dropShadow!==void 0&&Object.assign(l,{dropShadow:{...l.dropShadow,...o.dropShadow}}),"innerShadow"in l&&"innerShadow"in o&&o.innerShadow!==void 0&&Object.assign(l,{innerShadow:{...l.innerShadow,...o.innerShadow}}),l}function n(a,o){if(o===void 0)return a;let l={...a};return Object.assign(l,JA.merge(l,o)),l=i(l,o),l=r(l,o),l}e.patch=n;function s(a,o){let l,c=[];for(let[u,h]of Object.entries(o))u!=="name"&&(l===void 0&&(l={path:[],props:{},type:0},c.push(l)),l.props[u]=h);return c}e.toOps=s})(hf||(hf={}));var W1;(e=>e.defaultData={...JA.defaultData,...IO.defaultData,states:new Nt,events:new Nt,visible:!0,raycastLock:!1})(W1||(W1={}));var r0;(e=>e.defaultData={...W1.defaultData,...eC.defaultData})(r0||(r0={}));var tC;(e=>e.defaultData={cornerRadius:[0,0,0,0]})(tC||(tC={}));var LO;(e=>e.defaultData={...r0.defaultData,type:"ellipse2d",width:100,height:100,name:"Ellipse"})(LO||(LO={}));var X1;(e=>e.defaultData={...r0.defaultData,...tC.defaultData,type:"rectangle2d",width:100,height:100,name:"Rectangle"})(X1||(X1={}));var OO;(e=>e.defaultData={...r0.defaultData,type:"text2d",width:100,height:100,fontSize:12,lineHeight:1.2,letterSpacing:0,text:{textValue:"Hello world"},horizontalAlign:1,verticalAlign:1,textTransform:1,font:"Roboto_regular",name:"Text"})(OO||(OO={}));var zO;(e=>e.defaultData={...r0.defaultData,type:"path2d",path:"",name:"Path"})(zO||(zO={}));var n6;(e=>{function t(i){return i.type==="ellipse2d"||i.type==="rectangle2d"||i.type==="text2d"||i.type==="vector2d"||i.type==="path2d"}e.is=t})(n6||(n6={}));var iC;(e=>e.defaultData={...W1.defaultData,name:"Group",type:"group2d"})(iC||(iC={}));var NO;(e=>e.defaultData=()=>({...W1.defaultData,...tC.defaultData,...eC.defaultData,name:"Frame",type:"frame2d",clipped:!0,width:200,height:200,fill:{color:ar.fromHexAndA(4737101,1),enabled:!0},stroke:{color:ar.fromHexAndA(0,1),thickness:1,enabled:!1,mode:"inside"},backgroundBlur:{radius:2,enabled:!1},layerBlur:{radius:2,enabled:!1}}))(NO||(NO={}));var Cf;(e=>{function t(a){switch(a){case"rectangle2d":return{...X1.defaultData};case"ellipse2d":return{...LO.defaultData};case"text2d":return{...OO.defaultData};case"vector2d":return{...X1.defaultData};case"path2d":return{...zO.defaultData};case"frame2d":return{...NO.defaultData()};case"group2d":return{...iC.defaultData}}}e.defaultData=t;function i(a){return"width"in a&&"height"in a?[typeof a.width=="number"?a.width*.5:0,typeof a.height=="number"?a.height*.5:0]:[0,0]}e.getPivot=i;function r(a){return a.type==="rectangle2d"||a.type==="ellipse2d"||a.type==="text2d"||a.type==="frame2d"}e.isResizeable=r;function n(a){return a.type==="frame2d"&&a.autoLayout!==void 0}e.isAutoLayoutable=n;function s(a){return a.type==="rectangle2d"||a.type==="frame2d"}e.hasCorners=s})(Cf||(Cf={}));var BO;(e=>(e.defaultData={name:"UI",type:"scene2d",objects:new bs},e.emptyData=function(){return{type:"scene2d",objects:new bs}}))(BO||(BO={}));function df(e,t=!1){let i=e[0].index!==null,r=new Set(Object.keys(e[0].attributes)),n=new Set(Object.keys(e[0].morphAttributes)),s={},a={},o=e[0].morphTargetsRelative,l=new Bt,c=0;for(let u=0;u<e.length;++u){let h=e[u],d=0;if(i!==(h.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(let p in h.attributes){if(!r.has(p))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+'. All geometries must have compatible attributes; make sure "'+p+'" attribute exists among all geometries, or in none of them.'),null;s[p]===void 0&&(s[p]=[]),s[p].push(h.attributes[p]),d++}if(d!==r.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". Make sure all geometries have the same number of attributes."),null;if(o!==h.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(let p in h.morphAttributes){if(!n.has(p))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+".  .morphAttributes must be consistent throughout all geometries."),null;a[p]===void 0&&(a[p]=[]),a[p].push(h.morphAttributes[p])}if(t){let p;if(i)p=h.index.count;else if(h.attributes.position!==void 0)p=h.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". The geometry must have either an index or a position attribute"),null;l.addGroup(c,p,u),c+=p}}if(i){let u=0,h=[];for(let d=0;d<e.length;++d){let p=e[d].index;for(let f=0;f<p.count;++f)h.push(p.getX(f)+u);u+=e[d].attributes.position.count}l.setIndex(h)}for(let u in s){let h=s6(s[u]);if(!h)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+u+" attribute."),null;l.setAttribute(u,h)}for(let u in a){let h=a[u][0].length;if(h===0)break;l.morphAttributes=l.morphAttributes||{},l.morphAttributes[u]=[];for(let d=0;d<h;++d){let p=[];for(let v=0;v<a[u].length;++v)p.push(a[u][v][d]);let f=s6(p);if(!f)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+u+" morphAttribute."),null;l.morphAttributes[u].push(f)}}return l}function s6(e){let t,i,r,n=0;for(let o=0;o<e.length;++o){let l=e[o];if(l.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(t===void 0&&(t=l.array.constructor),t!==l.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(i===void 0&&(i=l.itemSize),i!==l.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(r===void 0&&(r=l.normalized),r!==l.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;n+=l.array.length}let s=new t(n),a=0;for(let o=0;o<e.length;++o)s.set(e[o].array,a),a+=e[o].array.length;return new $t(s,i,r)}var s_e=Math.pow(2,-24),sS=class{constructor(){}};function Pc(e,t,i){return i.min.x=t[e],i.min.y=t[e+1],i.min.z=t[e+2],i.max.x=t[e+3],i.max.y=t[e+4],i.max.z=t[e+5],i}function a6(e){let t=-1,i=-1/0;for(let r=0;r<3;r++){let n=e[r+3]-e[r];n>i&&(i=n,t=r)}return t}function o6(e,t){t.set(e)}function l6(e,t,i){let r,n;for(let s=0;s<3;s++){let a=s+3;r=e[s],n=t[s],i[s]=r<n?r:n,r=e[a],n=t[a],i[a]=r>n?r:n}}function aS(e,t,i){for(let r=0;r<3;r++){let n=t[e+2*r],s=t[e+2*r+1],a=n-s,o=n+s;a<i[r]&&(i[r]=a),o>i[r+3]&&(i[r+3]=o)}}function Ry(e){let t=e[3]-e[0],i=e[4]-e[1],r=e[5]-e[2];return 2*(t*i+i*r+r*t)}function a_e(e,t){if(!e.index){let i=e.attributes.position.count,r=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,n;i>65535?n=new Uint32Array(new r(4*i)):n=new Uint16Array(new r(2*i)),e.setIndex(new $t(n,1));for(let s=0;s<i;s++)n[s]=s}}function o_e(e){if(!e.groups||!e.groups.length)return[{offset:0,count:e.index.count/3}];let t=[],i=new Set;for(let n of e.groups)i.add(n.start),i.add(n.start+n.count);let r=Array.from(i.values()).sort((n,s)=>n-s);for(let n=0;n<r.length-1;n++){let s=r[n],a=r[n+1];t.push({offset:s/3,count:(a-s)/3})}return t}function m3(e,t,i,r,n=null){let s=1/0,a=1/0,o=1/0,l=-1/0,c=-1/0,u=-1/0,h=1/0,d=1/0,p=1/0,f=-1/0,v=-1/0,g=-1/0,m=n!==null;for(let x=t*6,w=(t+i)*6;x<w;x+=6){let _=e[x+0],M=e[x+1],S=_-M,A=_+M;S<s&&(s=S),A>l&&(l=A),m&&_<h&&(h=_),m&&_>f&&(f=_);let T=e[x+2],E=e[x+3],C=T-E,D=T+E;C<a&&(a=C),D>c&&(c=D),m&&T<d&&(d=T),m&&T>v&&(v=T);let I=e[x+4],L=e[x+5],z=I-L,F=I+L;z<o&&(o=z),F>u&&(u=F),m&&I<p&&(p=I),m&&I>g&&(g=I)}r[0]=s,r[1]=a,r[2]=o,r[3]=l,r[4]=c,r[5]=u,m&&(n[0]=h,n[1]=d,n[2]=p,n[3]=f,n[4]=v,n[5]=g)}function l_e(e,t,i,r){let n=1/0,s=1/0,a=1/0,o=-1/0,l=-1/0,c=-1/0;for(let u=t*6,h=(t+i)*6;u<h;u+=6){let d=e[u+0];d<n&&(n=d),d>o&&(o=d);let p=e[u+2];p<s&&(s=p),p>l&&(l=p);let f=e[u+4];f<a&&(a=f),f>c&&(c=f)}r[0]=n,r[1]=s,r[2]=a,r[3]=o,r[4]=l,r[5]=c}function c_e(e,t,i,r,n){let s=i,a=i+r-1,o=n.pos,l=n.axis*2;for(;;){for(;s<=a&&t[s*6+l]<o;)s++;for(;s<=a&&t[a*6+l]>=o;)a--;if(s<a){for(let c=0;c<3;c++){let u=e[s*3+c];e[s*3+c]=e[a*3+c],e[a*3+c]=u;let h=t[s*6+c*2+0];t[s*6+c*2+0]=t[a*6+c*2+0],t[a*6+c*2+0]=h;let d=t[s*6+c*2+1];t[s*6+c*2+1]=t[a*6+c*2+1],t[a*6+c*2+1]=d}s++,a--}else return s}}var Au=32,u_e=(e,t)=>e.candidate-t.candidate,Vh=new Array(Au).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),oS=new Float32Array(6);function h_e(e,t,i,r,n,s){let a=-1,o=0;if(s===0)a=a6(t),a!==-1&&(o=(t[a]+t[a+3])/2);else if(s===1)a=a6(e),a!==-1&&(o=d_e(i,r,n,a));else if(s===2){let l=Ry(e),c=1.25*n,u=r*6,h=(r+n)*6;for(let d=0;d<3;d++){let p=t[d],f=(t[d+3]-p)/Au;if(n<Au/4){let v=[...Vh];v.length=n;let g=0;for(let x=u;x<h;x+=6,g++){let w=v[g];w.candidate=i[x+2*d],w.count=0;let{bounds:_,leftCacheBounds:M,rightCacheBounds:S}=w;for(let A=0;A<3;A++)S[A]=1/0,S[A+3]=-1/0,M[A]=1/0,M[A+3]=-1/0,_[A]=1/0,_[A+3]=-1/0;aS(x,i,_)}v.sort(u_e);let m=n;for(let x=0;x<m;x++){let w=v[x];for(;x+1<m&&v[x+1].candidate===w.candidate;)v.splice(x+1,1),m--}for(let x=u;x<h;x+=6){let w=i[x+2*d];for(let _=0;_<m;_++){let M=v[_];w>=M.candidate?aS(x,i,M.rightCacheBounds):(aS(x,i,M.leftCacheBounds),M.count++)}}for(let x=0;x<m;x++){let w=v[x],_=w.count,M=n-w.count,S=w.leftCacheBounds,A=w.rightCacheBounds,T=0;_!==0&&(T=Ry(S)/l);let E=0;M!==0&&(E=Ry(A)/l);let C=1+1.25*(T*_+E*M);C<c&&(a=d,c=C,o=w.candidate)}}else{for(let m=0;m<Au;m++){let x=Vh[m];x.count=0,x.candidate=p+f+m*f;let w=x.bounds;for(let _=0;_<3;_++)w[_]=1/0,w[_+3]=-1/0}for(let m=u;m<h;m+=6){let x=~~((i[m+2*d]-p)/f);x>=Au&&(x=Au-1);let w=Vh[x];w.count++,aS(m,i,w.bounds)}let v=Vh[Au-1];o6(v.bounds,v.rightCacheBounds);for(let m=Au-2;m>=0;m--){let x=Vh[m],w=Vh[m+1];l6(x.bounds,w.rightCacheBounds,x.rightCacheBounds)}let g=0;for(let m=0;m<Au-1;m++){let x=Vh[m],w=x.count,_=x.bounds,M=Vh[m+1].rightCacheBounds;w!==0&&(g===0?o6(_,oS):l6(_,oS,oS)),g+=w;let S=0,A=0;g!==0&&(S=Ry(oS)/l);let T=n-g;T!==0&&(A=Ry(M)/l);let E=1+1.25*(S*g+A*T);E<c&&(a=d,c=E,o=x.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${s} used.`);return{axis:a,pos:o}}function d_e(e,t,i,r){let n=0;for(let s=t,a=t+i;s<a;s++)n+=e[s*6+r*2];return n/i}function p_e(e,t){let i=e.attributes.position,r=e.index.array,n=r.length/3,s=new Float32Array(n*6),a=i.normalized,o=i.array,l=i.offset||0,c=3;i.isInterleavedBufferAttribute&&(c=i.data.stride);let u=["getX","getY","getZ"];for(let h=0;h<n;h++){let d=h*3,p=h*6,f,v,g;a?(f=r[d+0],v=r[d+1],g=r[d+2]):(f=r[d+0]*c+l,v=r[d+1]*c+l,g=r[d+2]*c+l);for(let m=0;m<3;m++){let x,w,_;a?(x=i[u[m]](f),w=i[u[m]](v),_=i[u[m]](g)):(x=o[f+m],w=o[v+m],_=o[g+m]);let M=x;w<M&&(M=w),_<M&&(M=_);let S=x;w>S&&(S=w),_>S&&(S=_);let A=(S-M)/2,T=m*2;s[p+T+0]=M+A,s[p+T+1]=A+(Math.abs(M)+A)*s_e,M<t[m]&&(t[m]=M),S>t[m+3]&&(t[m+3]=S)}}return s}function f_e(e,t){function i(m){d&&d(m/p)}function r(m,x,w,_=null,M=0){if(!f&&M>=l&&(f=!0,c&&(console.warn(`MeshBVH: Max depth of ${l} reached when generating BVH. Consider increasing maxDepth.`),console.warn(e))),w<=u||M>=l)return i(x+w),m.offset=x,m.count=w,m;let S=h_e(m.boundingData,_,a,x,w,h);if(S.axis===-1)return i(x+w),m.offset=x,m.count=w,m;let A=c_e(o,a,x,w,S);if(A===x||A===x+w)i(x+w),m.offset=x,m.count=w;else{m.splitAxis=S.axis;let T=new sS,E=x,C=A-x;m.left=T,T.boundingData=new Float32Array(6),m3(a,E,C,T.boundingData,s),r(T,E,C,s,M+1);let D=new sS,I=A,L=w-C;m.right=D,D.boundingData=new Float32Array(6),m3(a,I,L,D.boundingData,s),r(D,I,L,s,M+1)}return m}a_e(e,t);let n=new Float32Array(6),s=new Float32Array(6),a=p_e(e,n),o=e.index.array,l=t.maxDepth,c=t.verbose,u=t.maxLeafTris,h=t.strategy,d=t.onProgress,p=e.index.count/3,f=!1,v=[],g=o_e(e);if(g.length===1){let m=g[0],x=new sS;x.boundingData=n,l_e(a,m.offset,m.count,s),r(x,m.offset,m.count,s),v.push(x)}else for(let m of g){let x=new sS;x.boundingData=new Float32Array(6),m3(a,m.offset,m.count,x.boundingData,s),r(x,m.offset,m.count,s),v.push(x)}return v}function m_e(e,t){let i=f_e(e,t),r,n,s,a=[],o=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let u=0;u<i.length;u++){let h=i[u],d=l(h),p=new o(32*d);r=new Float32Array(p),n=new Uint32Array(p),s=new Uint16Array(p),c(0,h),a.push(p)}return a;function l(u){return u.count?1:1+l(u.left)+l(u.right)}function c(u,h){let d=u/4,p=u/2,f=!!h.count,v=h.boundingData;for(let g=0;g<6;g++)r[d+g]=v[g];if(f){let g=h.offset,m=h.count;return n[d+6]=g,s[p+14]=m,s[p+15]=65535,u+32}else{let g=h.left,m=h.right,x=h.splitAxis,w;if(w=c(u+32,g),w/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return n[d+6]=w/4,w=c(w,m),n[d+7]=x,w}}}var fh=class{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let i=1/0,r=-1/0;for(let n=0,s=e.length;n<s;n++){let a=e[n][t];i=a<i?a:i,r=a>r?a:r}this.min=i,this.max=r}setFromPoints(e,t){let i=1/0,r=-1/0;for(let n=0,s=t.length;n<s;n++){let a=t[n],o=e.dot(a);i=o<i?o:i,r=o>r?o:r}this.min=i,this.max=r}isSeparated(e){return this.min>e.max||e.min>this.max}};fh.prototype.setFromBox=function(){let e=new B;return function(t,i){let r=i.min,n=i.max,s=1/0,a=-1/0;for(let o=0;o<=1;o++)for(let l=0;l<=1;l++)for(let c=0;c<=1;c++){e.x=r.x*o+n.x*(1-o),e.y=r.y*l+n.y*(1-l),e.z=r.z*c+n.z*(1-c);let u=t.dot(e);s=Math.min(u,s),a=Math.max(u,a)}this.min=s,this.max=a}}();var g_e=function(){let e=new B,t=new B,i=new B;return function(r,n,s){let a=r.start,o=e,l=n.start,c=t;i.subVectors(a,l),e.subVectors(r.end,r.start),t.subVectors(n.end,n.start);let u=i.dot(c),h=c.dot(o),d=c.dot(c),p=i.dot(o),f=o.dot(o)*d-h*h,v,g;f!==0?v=(u*h-p*d)/f:v=0,g=(u+v*h)/d,s.x=v,s.y=g}}(),JB=function(){let e=new ve,t=new B,i=new B;return function(r,n,s,a){g_e(r,n,e);let o=e.x,l=e.y;if(o>=0&&o<=1&&l>=0&&l<=1){r.at(o,s),n.at(l,a);return}else if(o>=0&&o<=1){l<0?n.at(0,a):n.at(1,a),r.closestPointToPoint(a,!0,s);return}else if(l>=0&&l<=1){o<0?r.at(0,s):r.at(1,s),n.closestPointToPoint(s,!0,a);return}else{let c;o<0?c=r.start:c=r.end;let u;l<0?u=n.start:u=n.end;let h=t,d=i;if(r.closestPointToPoint(u,!0,t),n.closestPointToPoint(c,!0,i),h.distanceToSquared(u)<=d.distanceToSquared(c)){s.copy(h),a.copy(u);return}else{s.copy(c),a.copy(d);return}}}}(),v_e=function(){let e=new B,t=new B,i=new Ia,r=new Jo;return function(n,s){let{radius:a,center:o}=n,{a:l,b:c,c:u}=s;if(r.start=l,r.end=c,r.closestPointToPoint(o,!0,e).distanceTo(o)<=a||(r.start=l,r.end=u,r.closestPointToPoint(o,!0,e).distanceTo(o)<=a)||(r.start=c,r.end=u,r.closestPointToPoint(o,!0,e).distanceTo(o)<=a))return!0;let h=s.getPlane(i);if(Math.abs(h.distanceToPoint(o))<=a){let d=h.projectPoint(o,t);if(s.containsPoint(d))return!0}return!1}}(),y_e=1e-15;function Hm(e){return Math.abs(e)<y_e}var mh=class extends ws{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new B),this.satBounds=new Array(4).fill().map(()=>new fh),this.points=[this.a,this.b,this.c],this.sphere=new ja,this.plane=new Ia,this.needsUpdate=!0}intersectsSphere(e){return v_e(e,this)}update(){let e=this.a,t=this.b,i=this.c,r=this.points,n=this.satAxes,s=this.satBounds,a=n[0],o=s[0];this.getNormal(a),o.setFromPoints(a,r);let l=n[1],c=s[1];l.subVectors(e,t),c.setFromPoints(l,r);let u=n[2],h=s[2];u.subVectors(t,i),h.setFromPoints(u,r);let d=n[3],p=s[3];d.subVectors(i,e),p.setFromPoints(d,r),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(a,e),this.needsUpdate=!1}};mh.prototype.closestPointToSegment=function(){let e=new B,t=new B,i=new Jo;return function(r,n=null,s=null){let{start:a,end:o}=r,l=this.points,c,u=1/0;for(let h=0;h<3;h++){let d=(h+1)%3;i.start.copy(l[h]),i.end.copy(l[d]),JB(i,r,e,t),c=e.distanceToSquared(t),c<u&&(u=c,n&&n.copy(e),s&&s.copy(t))}return this.closestPointToPoint(a,e),c=a.distanceToSquared(e),c<u&&(u=c,n&&n.copy(e),s&&s.copy(a)),this.closestPointToPoint(o,e),c=o.distanceToSquared(e),c<u&&(u=c,n&&n.copy(e),s&&s.copy(o)),Math.sqrt(u)}}();mh.prototype.intersectsTriangle=function(){let e=new mh,t=new Array(3),i=new Array(3),r=new fh,n=new fh,s=new B,a=new B,o=new B,l=new B,c=new Jo,u=new Jo,h=new Jo;return function(d,p=null,f=!1){this.needsUpdate&&this.update(),d.isExtendedTriangle?d.needsUpdate&&d.update():(e.copy(d),e.update(),d=e);let v=this.plane,g=d.plane;if(Math.abs(v.normal.dot(g.normal))>1-1e-10){let m=this.satBounds,x=this.satAxes;i[0]=d.a,i[1]=d.b,i[2]=d.c;for(let M=0;M<4;M++){let S=m[M],A=x[M];if(r.setFromPoints(A,i),S.isSeparated(r))return!1}let w=d.satBounds,_=d.satAxes;t[0]=this.a,t[1]=this.b,t[2]=this.c;for(let M=0;M<4;M++){let S=w[M],A=_[M];if(r.setFromPoints(A,t),S.isSeparated(r))return!1}for(let M=0;M<4;M++){let S=x[M];for(let A=0;A<4;A++){let T=_[A];if(s.crossVectors(S,T),r.setFromPoints(s,t),n.setFromPoints(s,i),r.isSeparated(n))return!1}}return p&&(f||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),p.start.set(0,0,0),p.end.set(0,0,0)),!0}else{let m=this.points,x=!1,w=0;for(let L=0;L<3;L++){let z=m[L],F=m[(L+1)%3];c.start.copy(z),c.end.copy(F),c.delta(a);let Q=x?u.start:u.end,Y=Hm(g.distanceToPoint(z));if(Hm(g.normal.dot(a))&&Y){u.copy(c),w=2;break}if((g.intersectLine(c,Q)||Y)&&!Hm(Q.distanceTo(F))){if(w++,x)break;x=!0}}if(w===1&&d.containsPoint(u.end))return p&&(p.start.copy(u.end),p.end.copy(u.end)),!0;if(w!==2)return!1;let _=d.points,M=!1,S=0;for(let L=0;L<3;L++){let z=_[L],F=_[(L+1)%3];c.start.copy(z),c.end.copy(F),c.delta(o);let Q=M?h.start:h.end,Y=Hm(v.distanceToPoint(z));if(Hm(v.normal.dot(o))&&Y){h.copy(c),S=2;break}if((v.intersectLine(c,Q)||Y)&&!Hm(Q.distanceTo(F))){if(S++,M)break;M=!0}}if(S===1&&this.containsPoint(h.end))return p&&(p.start.copy(h.end),p.end.copy(h.end)),!0;if(S!==2)return!1;if(u.delta(a),h.delta(o),a.dot(o)<0){let L=h.start;h.start=h.end,h.end=L}let A=u.start.dot(a),T=u.end.dot(a),E=h.start.dot(a),C=h.end.dot(a),D=T<E,I=A<C;return A!==C&&E!==T&&D===I?!1:(p&&(l.subVectors(u.start,h.start),l.dot(a)>0?p.start.copy(u.start):p.start.copy(h.start),l.subVectors(u.end,h.end),l.dot(a)<0?p.end.copy(u.end):p.end.copy(h.end)),!0)}}}();mh.prototype.distanceToPoint=function(){let e=new B;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}();mh.prototype.distanceToTriangle=function(){let e=new B,t=new B,i=["a","b","c"],r=new Jo,n=new Jo;return function(s,a=null,o=null){let l=a||o?r:null;if(this.intersectsTriangle(s,l))return(a||o)&&(a&&l.getCenter(a),o&&l.getCenter(o)),0;let c=1/0;for(let u=0;u<3;u++){let h,d=i[u],p=s[d];this.closestPointToPoint(p,e),h=p.distanceToSquared(e),h<c&&(c=h,a&&a.copy(e),o&&o.copy(p));let f=this[d];s.closestPointToPoint(f,e),h=f.distanceToSquared(e),h<c&&(c=h,a&&a.copy(f),o&&o.copy(e))}for(let u=0;u<3;u++){let h=i[u],d=i[(u+1)%3];r.set(this[h],this[d]);for(let p=0;p<3;p++){let f=i[p],v=i[(p+1)%3];n.set(s[f],s[v]),JB(r,n,e,t);let g=e.distanceToSquared(t);g<c&&(c=g,a&&a.copy(e),o&&o.copy(t))}}return Math.sqrt(c)}}();var qc=class{constructor(e,t,i){this.isOrientedBox=!0,this.min=new B,this.max=new B,this.matrix=new ht,this.invMatrix=new ht,this.points=new Array(8).fill().map(()=>new B),this.satAxes=new Array(3).fill().map(()=>new B),this.satBounds=new Array(3).fill().map(()=>new fh),this.alignedSatBounds=new Array(3).fill().map(()=>new fh),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),i&&this.matrix.copy(i)}set(e,t,i){this.min.copy(e),this.max.copy(t),this.matrix.copy(i),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}};qc.prototype.update=function(){return function(){let e=this.matrix,t=this.min,i=this.max,r=this.points;for(let l=0;l<=1;l++)for(let c=0;c<=1;c++)for(let u=0;u<=1;u++){let h=1*l|2*c|4*u,d=r[h];d.x=l?i.x:t.x,d.y=c?i.y:t.y,d.z=u?i.z:t.z,d.applyMatrix4(e)}let n=this.satBounds,s=this.satAxes,a=r[0];for(let l=0;l<3;l++){let c=s[l],u=n[l],h=1<<l,d=r[h];c.subVectors(a,d),u.setFromPoints(c,r)}let o=this.alignedSatBounds;o[0].setFromPointsField(r,"x"),o[1].setFromPointsField(r,"y"),o[2].setFromPointsField(r,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}();qc.prototype.intersectsBox=function(){let e=new fh;return function(t){this.needsUpdate&&this.update();let i=t.min,r=t.max,n=this.satBounds,s=this.satAxes,a=this.alignedSatBounds;if(e.min=i.x,e.max=r.x,a[0].isSeparated(e)||(e.min=i.y,e.max=r.y,a[1].isSeparated(e))||(e.min=i.z,e.max=r.z,a[2].isSeparated(e)))return!1;for(let o=0;o<3;o++){let l=s[o],c=n[o];if(e.setFromBox(l,t),c.isSeparated(e))return!1}return!0}}();qc.prototype.intersectsTriangle=function(){let e=new mh,t=new Array(3),i=new fh,r=new fh,n=new B;return function(s){this.needsUpdate&&this.update(),s.isExtendedTriangle?s.needsUpdate&&s.update():(e.copy(s),e.update(),s=e);let a=this.satBounds,o=this.satAxes;t[0]=s.a,t[1]=s.b,t[2]=s.c;for(let h=0;h<3;h++){let d=a[h],p=o[h];if(i.setFromPoints(p,t),d.isSeparated(i))return!1}let l=s.satBounds,c=s.satAxes,u=this.points;for(let h=0;h<3;h++){let d=l[h],p=c[h];if(i.setFromPoints(p,u),d.isSeparated(i))return!1}for(let h=0;h<3;h++){let d=o[h];for(let p=0;p<4;p++){let f=c[p];if(n.crossVectors(d,f),i.setFromPoints(n,t),r.setFromPoints(n,u),i.isSeparated(r))return!1}}return!0}}();qc.prototype.closestPointToPoint=function(){return function(e,t){return this.needsUpdate&&this.update(),t.copy(e).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t}}();qc.prototype.distanceToPoint=function(){let e=new B;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}();qc.prototype.distanceToBox=function(){let e=["x","y","z"],t=new Array(12).fill().map(()=>new Jo),i=new Array(12).fill().map(()=>new Jo),r=new B,n=new B;return function(s,a=0,o=null,l=null){if(this.needsUpdate&&this.update(),this.intersectsBox(s))return(o||l)&&(s.getCenter(n),this.closestPointToPoint(n,r),s.closestPointToPoint(r,n),o&&o.copy(r),l&&l.copy(n)),0;let c=a*a,u=s.min,h=s.max,d=this.points,p=1/0;for(let v=0;v<8;v++){let g=d[v];n.copy(g).clamp(u,h);let m=g.distanceToSquared(n);if(m<p&&(p=m,o&&o.copy(g),l&&l.copy(n),m<c))return Math.sqrt(m)}let f=0;for(let v=0;v<3;v++)for(let g=0;g<=1;g++)for(let m=0;m<=1;m++){let x=(v+1)%3,w=(v+2)%3,_=g<<x|m<<w,M=1<<v|g<<x|m<<w,S=d[_],A=d[M];t[f].set(S,A);let T=e[v],E=e[x],C=e[w],D=i[f],I=D.start,L=D.end;I[T]=u[T],I[E]=g?u[E]:h[E],I[C]=m?u[C]:h[E],L[T]=h[T],L[E]=g?u[E]:h[E],L[C]=m?u[C]:h[E],f++}for(let v=0;v<=1;v++)for(let g=0;g<=1;g++)for(let m=0;m<=1;m++){n.x=v?h.x:u.x,n.y=g?h.y:u.y,n.z=m?h.z:u.z,this.closestPointToPoint(n,r);let x=n.distanceToSquared(r);if(x<p&&(p=x,o&&o.copy(r),l&&l.copy(n),x<c))return Math.sqrt(x)}for(let v=0;v<12;v++){let g=t[v];for(let m=0;m<12;m++){let x=i[m];JB(g,x,r,n);let w=r.distanceToSquared(n);if(w<p&&(p=w,o&&o.copy(r),l&&l.copy(n),w<c))return Math.sqrt(w)}}return Math.sqrt(p)}}();var Gm=new B,jm=new B,Wm=new B,lS=new ve,cS=new ve,uS=new ve,c6=new B,u6=new B,h6=new B,hS=new B;function x_e(e,t,i,r,n,s){let a;return s===ns?a=e.intersectTriangle(r,i,t,!0,n):a=e.intersectTriangle(t,i,r,s!==Ws,n),a===null?null:{distance:e.origin.distanceTo(n),point:n.clone()}}function w_e(e,t,i,r,n,s,a,o,l){Gm.fromBufferAttribute(t,s),jm.fromBufferAttribute(t,a),Wm.fromBufferAttribute(t,o);let c=x_e(e,Gm,jm,Wm,hS,l);if(c){r&&(lS.fromBufferAttribute(r,s),cS.fromBufferAttribute(r,a),uS.fromBufferAttribute(r,o),c.uv=ws.getInterpolation(hS,Gm,jm,Wm,lS,cS,uS,new ve)),n&&(lS.fromBufferAttribute(n,s),cS.fromBufferAttribute(n,a),uS.fromBufferAttribute(n,o),c.uv1=ws.getInterpolation(hS,Gm,jm,Wm,lS,cS,uS,new ve)),i&&(c6.fromBufferAttribute(i,s),u6.fromBufferAttribute(i,a),h6.fromBufferAttribute(i,o),c.normal=ws.getInterpolation(hS,Gm,jm,Wm,c6,u6,h6,new B),c.normal.dot(e.direction)>0&&c.normal.multiplyScalar(-1));let u={a:s,b:a,c:o,normal:new B,materialIndex:0};ws.getNormal(Gm,jm,Wm,u.normal),c.face=u,c.faceIndex=s}return c}function OK(e,t,i,r,n){let s=r*3,a=e.index.getX(s),o=e.index.getX(s+1),l=e.index.getX(s+2),{position:c,normal:u,uv:h,uv1:d}=e.attributes,p=w_e(i,c,u,h,d,a,o,l,t);return p?(p.faceIndex=r,n&&n.push(p),p):null}function b_e(e,t,i,r,n,s){for(let a=r,o=r+n;a<o;a++)OK(e,t,i,a,s)}function __e(e,t,i,r,n){let s=1/0,a=null;for(let o=r,l=r+n;o<l;o++){let c=OK(e,t,i,o);c&&c.distance<s&&(a=c,s=c.distance)}return a}function _c(e,t,i,r){let n=e.a,s=e.b,a=e.c,o=t,l=t+1,c=t+2;i&&(o=i.getX(t),l=i.getX(t+1),c=i.getX(t+2)),n.x=r.getX(o),n.y=r.getY(o),n.z=r.getZ(o),s.x=r.getX(l),s.y=r.getY(l),s.z=r.getZ(l),a.x=r.getX(c),a.y=r.getY(c),a.z=r.getZ(c)}function d6(e,t,i,r,n,s,a){let o=i.index,l=i.attributes.position;for(let c=e,u=t+e;c<u;c++)if(_c(a,c*3,o,l),a.needsUpdate=!0,r(a,c,n,s))return!0;return!1}var zK=class{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){let e=this._primitives;return e.length===0?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}};function md(e,t){return t[e+15]===65535}function Mv(e,t){return t[e+6]}function q1(e,t){return t[e+14]}function Y1(e){return e+8}function Q1(e,t){return t[e+6]}function S_e(e,t){return t[e+7]}var sv=new cn,rC=new B,M_e=["x","y","z"];function kO(e,t,i,r,n){let s=e*2,a=O0,o=Vd,l=Hd;if(md(s,o)){let c=Mv(e,l),u=q1(s,o);b_e(t,i,r,c,u,n)}else{let c=Y1(e);nC(c,a,r,rC)&&kO(c,t,i,r,n);let u=Q1(e,l);nC(u,a,r,rC)&&kO(u,t,i,r,n)}}function UO(e,t,i,r){let n=e*2,s=O0,a=Vd,o=Hd;if(md(n,a)){let l=Mv(e,o),c=q1(n,a);return __e(t,i,r,l,c)}else{let l=S_e(e,o),c=M_e[l],u=r.direction[c]>=0,h,d;u?(h=Y1(e),d=Q1(e,o)):(h=Q1(e,o),d=Y1(e));let p=nC(h,s,r,rC)?UO(h,t,i,r):null;if(p){let v=p.point[c];if(u?v<=s[d+l]:v>=s[d+l+3])return p}let f=nC(d,s,r,rC)?UO(d,t,i,r):null;return p&&f?p.distance<=f.distance?p:f:p||f||null}}var E_e=function(){let e,t,i=[],r=new zK(()=>new cn);return function(...s){e=r.getPrimitive(),t=r.getPrimitive(),i.push(e,t);let a=n(...s);r.releasePrimitive(e),r.releasePrimitive(t),i.pop(),i.pop();let o=i.length;return o>0&&(t=i[o-1],e=i[o-2]),a};function n(s,a,o,l,c=null,u=0,h=0){function d(x){let w=x*2,_=Vd,M=Hd;for(;!md(w,_);)x=Y1(x),w=x*2;return Mv(x,M)}function p(x){let w=x*2,_=Vd,M=Hd;for(;!md(w,_);)x=Q1(x,M),w=x*2;return Mv(x,M)+q1(w,_)}let f=s*2,v=O0,g=Vd,m=Hd;if(md(f,g)){let x=Mv(s,m),w=q1(f,g);return Pc(s,v,e),l(x,w,!1,h,u+s,e)}else{let x=Y1(s),w=Q1(s,m),_=x,M=w,S,A,T,E;if(c&&(T=e,E=t,Pc(_,v,T),Pc(M,v,E),S=c(T),A=c(E),A<S)){_=w,M=x;let Q=S;S=A,A=Q,T=E}T||(T=e,Pc(_,v,T));let C=md(_*2,g),D=o(T,C,S,h+1,u+_),I;if(D===2){let Q=d(_),Y=p(_)-Q;I=l(Q,Y,!0,h+1,u+_,T)}else I=D&&n(_,a,o,l,c,u,h+1);if(I)return!0;E=t,Pc(M,v,E);let L=md(M*2,g),z=o(E,L,A,h+1,u+M),F;if(z===2){let Q=d(M),Y=p(M)-Q;F=l(Q,Y,!0,h+1,u+M,E)}else F=z&&n(M,a,o,l,c,u,h+1);return!!F}}}(),A_e=function(){let e=new mh,t=new mh,i=new ht,r=new qc,n=new qc;return function s(a,o,l,c,u=null){let h=a*2,d=O0,p=Vd,f=Hd;if(u===null&&(l.boundingBox||l.computeBoundingBox(),r.set(l.boundingBox.min,l.boundingBox.max,c),u=r),md(h,p)){let v=o,g=v.index,m=v.attributes.position,x=l.index,w=l.attributes.position,_=Mv(a,f),M=q1(h,p);if(i.copy(c).invert(),l.boundsTree)return Pc(a,d,n),n.matrix.copy(i),n.needsUpdate=!0,l.boundsTree.shapecast({intersectsBounds:S=>n.intersectsBox(S),intersectsTriangle:S=>{S.a.applyMatrix4(c),S.b.applyMatrix4(c),S.c.applyMatrix4(c),S.needsUpdate=!0;for(let A=_*3,T=(M+_)*3;A<T;A+=3)if(_c(t,A,g,m),t.needsUpdate=!0,S.intersectsTriangle(t))return!0;return!1}});for(let S=_*3,A=M+_*3;S<A;S+=3){_c(e,S,g,m),e.a.applyMatrix4(i),e.b.applyMatrix4(i),e.c.applyMatrix4(i),e.needsUpdate=!0;for(let T=0,E=x.count;T<E;T+=3)if(_c(t,T,x,w),t.needsUpdate=!0,e.intersectsTriangle(t))return!0}}else{let v=a+8,g=f[a+6];return Pc(v,d,sv),!!(u.intersectsBox(sv)&&s(v,o,l,c,u)||(Pc(g,d,sv),u.intersectsBox(sv)&&s(g,o,l,c,u)))}}}();function nC(e,t,i,r){return Pc(e,t,sv),i.intersectBox(sv,r)}var FO=[],yE,O0,Vd,Hd;function _x(e){yE&&FO.push(yE),yE=e,O0=new Float32Array(e),Vd=new Uint16Array(e),Hd=new Uint32Array(e)}function dS(){yE=null,O0=null,Vd=null,Hd=null,FO.length&&_x(FO.pop())}var g3=Symbol("skip tree generation"),v3=new cn,y3=new cn,Xm=new ht,_p=new qc,Iy=new qc,Ly=new B,pS=new B,C_e=new B,T_e=new B,P_e=new B,p6=new cn,oc=new zK(()=>new mh),Qx=class{static serialize(e,t={}){if(t.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),Qx.serialize(arguments[0],{cloneBuffers:arguments[2]===void 0?!0:arguments[2]});t={cloneBuffers:!0,...t};let i=e.geometry,r=e._roots,n=i.getIndex(),s;return t.cloneBuffers?s={roots:r.map(a=>a.slice()),index:n.array.slice()}:s={roots:r,index:n.array},s}static deserialize(e,t,i={}){if(typeof i=="boolean")return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),Qx.deserialize(arguments[0],arguments[1],{setIndex:arguments[2]===void 0?!0:arguments[2]});i={setIndex:!0,...i};let{index:r,roots:n}=e,s=new Qx(t,{...i,[g3]:!0});if(s._roots=n,i.setIndex){let a=t.getIndex();if(a===null){let o=new $t(e.index,1,!1);t.setIndex(o)}else a.array!==r&&(a.array.set(r),a.needsUpdate=!0)}return s}constructor(e,t={}){if(e.isBufferGeometry){if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(t=Object.assign({strategy:0,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,[g3]:!1},t),t.useSharedArrayBuffer&&typeof SharedArrayBuffer>"u")throw new Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,t[g3]||(this._roots=m_e(e,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new cn))),this.geometry=e}refit(e=null){e&&Array.isArray(e)&&(e=new Set(e));let t=this.geometry,i=t.index.array,r=t.attributes.position,n,s,a,o,l=0,c=this._roots;for(let h=0,d=c.length;h<d;h++)n=c[h],s=new Uint32Array(n),a=new Uint16Array(n),o=new Float32Array(n),u(0,l),l+=n.byteLength;function u(h,d,p=!1){let f=h*2;if(a[f+15]===65535){let v=s[h+6],g=a[f+14],m=1/0,x=1/0,w=1/0,_=-1/0,M=-1/0,S=-1/0;for(let A=3*v,T=3*(v+g);A<T;A++){let E=i[A],C=r.getX(E),D=r.getY(E),I=r.getZ(E);C<m&&(m=C),C>_&&(_=C),D<x&&(x=D),D>M&&(M=D),I<w&&(w=I),I>S&&(S=I)}return o[h+0]!==m||o[h+1]!==x||o[h+2]!==w||o[h+3]!==_||o[h+4]!==M||o[h+5]!==S?(o[h+0]=m,o[h+1]=x,o[h+2]=w,o[h+3]=_,o[h+4]=M,o[h+5]=S,!0):!1}else{let v=h+8,g=s[h+6],m=v+d,x=g+d,w=p,_=!1,M=!1;e?w||(_=e.has(m),M=e.has(x),w=!_&&!M):(_=!0,M=!0);let S=w||_,A=w||M,T=!1;S&&(T=u(v,d,w));let E=!1;A&&(E=u(g,d,w));let C=T||E;if(C)for(let D=0;D<3;D++){let I=v+D,L=g+D,z=o[I],F=o[I+3],Q=o[L],Y=o[L+3];o[h+D]=z<Q?z:Q,o[h+D+3]=F>Y?F:Y}return C}}}traverse(e,t=0){let i=this._roots[t],r=new Uint32Array(i),n=new Uint16Array(i);s(0);function s(a,o=0){let l=a*2,c=n[l+15]===65535;if(c){let u=r[a+6],h=n[l+14];e(o,c,new Float32Array(i,a*4,6),u,h)}else{let u=a+8,h=r[a+6],d=r[a+7];e(o,c,new Float32Array(i,a*4,6),d)||(s(u,o+1),s(h,o+1))}}}raycast(e,t=Fl){let i=this._roots,r=this.geometry,n=[],s=t.isMaterial,a=Array.isArray(t),o=r.groups,l=s?t.side:t;for(let c=0,u=i.length;c<u;c++){let h=a?t[o[c].materialIndex].side:l,d=n.length;if(_x(i[c]),kO(0,r,h,e,n),dS(),a){let p=o[c].materialIndex;for(let f=d,v=n.length;f<v;f++)n[f].face.materialIndex=p}}return n}raycastFirst(e,t=Fl){let i=this._roots,r=this.geometry,n=t.isMaterial,s=Array.isArray(t),a=null,o=r.groups,l=n?t.side:t;for(let c=0,u=i.length;c<u;c++){let h=s?t[o[c].materialIndex].side:l;_x(i[c]);let d=UO(0,r,h,e);dS(),d!=null&&(a==null||d.distance<a.distance)&&(a=d,s&&(d.face.materialIndex=o[c].materialIndex))}return a}intersectsGeometry(e,t){let i=this.geometry,r=!1;for(let n of this._roots)if(_x(n),r=A_e(0,i,e,t),dS(),r)break;return r}shapecast(e,t,i){let r=this.geometry;if(e instanceof Function){if(t){let h=t;t=(d,p,f,v)=>{let g=p*3;return h(d,g,g+1,g+2,f,v)}}e={boundsTraverseOrder:i,intersectsBounds:e,intersectsTriangle:t,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}let n=oc.getPrimitive(),{boundsTraverseOrder:s,intersectsBounds:a,intersectsRange:o,intersectsTriangle:l}=e;if(o&&l){let h=o;o=(d,p,f,v,g)=>h(d,p,f,v,g)?!0:d6(d,p,r,l,f,v,n)}else o||(l?o=(h,d,p,f)=>d6(h,d,r,l,p,f,n):o=(h,d,p)=>p);let c=!1,u=0;for(let h of this._roots){if(_x(h),c=E_e(0,r,a,o,s,u),dS(),c)break;u+=h.byteLength}return oc.releasePrimitive(n),c}bvhcast(e,t,i){let{intersectsRanges:r,intersectsTriangles:n}=i,s=this.geometry.index,a=this.geometry.attributes.position,o=e.geometry.index,l=e.geometry.attributes.position;Xm.copy(t).invert();let c=oc.getPrimitive(),u=oc.getPrimitive();if(n){let d=function(p,f,v,g,m,x,w,_){for(let M=v,S=v+g;M<S;M++){_c(u,M*3,o,l),u.a.applyMatrix4(t),u.b.applyMatrix4(t),u.c.applyMatrix4(t),u.needsUpdate=!0;for(let A=p,T=p+f;A<T;A++)if(_c(c,A*3,s,a),c.needsUpdate=!0,n(c,u,A,M,m,x,w,_))return!0}return!1};if(r){let p=r;r=function(f,v,g,m,x,w,_,M){return p(f,v,g,m,x,w,_,M)?!0:d(f,v,g,m,x,w,_,M)}}else r=d}e.getBoundingBox(y3),y3.applyMatrix4(t);let h=this.shapecast({intersectsBounds:d=>y3.intersectsBox(d),intersectsRange:(d,p,f,v,g,m)=>(v3.copy(m),v3.applyMatrix4(Xm),e.shapecast({intersectsBounds:x=>v3.intersectsBox(x),intersectsRange:(x,w,_,M,S)=>r(d,p,x,w,v,g,M,S)}))});return oc.releasePrimitive(c),oc.releasePrimitive(u),h}intersectsBox(e,t){return _p.set(e.min,e.max,t),_p.needsUpdate=!0,this.shapecast({intersectsBounds:i=>_p.intersectsBox(i),intersectsTriangle:i=>_p.intersectsTriangle(i)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,i={},r={},n=0,s=1/0){e.boundingBox||e.computeBoundingBox(),_p.set(e.boundingBox.min,e.boundingBox.max,t),_p.needsUpdate=!0;let a=this.geometry,o=a.attributes.position,l=a.index,c=e.attributes.position,u=e.index,h=oc.getPrimitive(),d=oc.getPrimitive(),p=pS,f=C_e,v=null,g=null;r&&(v=T_e,g=P_e);let m=1/0,x=null,w=null;return Xm.copy(t).invert(),Iy.matrix.copy(Xm),this.shapecast({boundsTraverseOrder:_=>_p.distanceToBox(_),intersectsBounds:(_,M,S)=>S<m&&S<s?(M&&(Iy.min.copy(_.min),Iy.max.copy(_.max),Iy.needsUpdate=!0),!0):!1,intersectsRange:(_,M)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:S=>Iy.distanceToBox(S),intersectsBounds:(S,A,T)=>T<m&&T<s,intersectsRange:(S,A)=>{for(let T=S*3,E=(S+A)*3;T<E;T+=3){_c(d,T,u,c),d.a.applyMatrix4(t),d.b.applyMatrix4(t),d.c.applyMatrix4(t),d.needsUpdate=!0;for(let C=_*3,D=(_+M)*3;C<D;C+=3){_c(h,C,l,o),h.needsUpdate=!0;let I=h.distanceToTriangle(d,p,v);if(I<m&&(f.copy(p),g&&g.copy(v),m=I,x=C/3,w=T/3),I<n)return!0}}}});{let S=u?u.count:c.count;for(let A=0,T=S;A<T;A+=3){_c(d,A,u,c),d.a.applyMatrix4(t),d.b.applyMatrix4(t),d.c.applyMatrix4(t),d.needsUpdate=!0;for(let E=_*3,C=(_+M)*3;E<C;E+=3){_c(h,E,l,o),h.needsUpdate=!0;let D=h.distanceToTriangle(d,p,v);if(D<m&&(f.copy(p),g&&g.copy(v),m=D,x=E/3,w=A/3),D<n)return!0}}}}}),oc.releasePrimitive(h),oc.releasePrimitive(d),m===1/0?null:(i.point?i.point.copy(f):i.point=f.clone(),i.distance=m,i.faceIndex=x,r&&(r.point?r.point.copy(g):r.point=g.clone(),r.point.applyMatrix4(Xm),f.applyMatrix4(Xm),r.distance=f.sub(r.point).length(),r.faceIndex=w),i)}closestPointToPoint(e,t={},i=0,r=1/0){let n=i*i,s=r*r,a=1/0,o=null;if(this.shapecast({boundsTraverseOrder:c=>(Ly.copy(e).clamp(c.min,c.max),Ly.distanceToSquared(e)),intersectsBounds:(c,u,h)=>h<a&&h<s,intersectsTriangle:(c,u)=>{c.closestPointToPoint(e,Ly);let h=e.distanceToSquared(Ly);return h<a&&(pS.copy(Ly),a=h,o=u),h<n}}),a===1/0)return null;let l=Math.sqrt(a);return t.point?t.point.copy(pS):t.point=pS.clone(),t.distance=l,t.faceIndex=o,t}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(t=>{Pc(0,new Float32Array(t),p6),e.union(p6)}),e}},Oy=Sh(Aae()),D_e=.5*(Math.sqrt(3)-1),zy=(3-Math.sqrt(3))/6,R_e=1/3,lc=1/6,Kx=e=>Math.floor(e)|0,f6=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]),x3=new Float64Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]);function w3(e=Math.random){let t=NK(e),i=new Float64Array(t).map(n=>f6[n%12*2]),r=new Float64Array(t).map(n=>f6[n%12*2+1]);return function(n,s){let a=0,o=0,l=0,c=(n+s)*D_e,u=Kx(n+c),h=Kx(s+c),d=(u+h)*zy,p=u-d,f=h-d,v=n-p,g=s-f,m,x;v>g?(m=1,x=0):(m=0,x=1);let w=v-m+zy,_=g-x+zy,M=v-1+2*zy,S=g-1+2*zy,A=u&255,T=h&255,E=.5-v*v-g*g;if(E>=0){let I=A+t[T],L=i[I],z=r[I];E*=E,a=E*E*(L*v+z*g)}let C=.5-w*w-_*_;if(C>=0){let I=A+m+t[T+x],L=i[I],z=r[I];C*=C,o=C*C*(L*w+z*_)}let D=.5-M*M-S*S;if(D>=0){let I=A+1+t[T+1],L=i[I],z=r[I];D*=D,l=D*D*(L*M+z*S)}return 70*(a+o+l)}}function I_e(e=Math.random){let t=NK(e),i=new Float64Array(t).map(s=>x3[s%12*3]),r=new Float64Array(t).map(s=>x3[s%12*3+1]),n=new Float64Array(t).map(s=>x3[s%12*3+2]);return function(s,a,o){let l,c,u,h,d=(s+a+o)*R_e,p=Kx(s+d),f=Kx(a+d),v=Kx(o+d),g=(p+f+v)*lc,m=p-g,x=f-g,w=v-g,_=s-m,M=a-x,S=o-w,A,T,E,C,D,I;_>=M?M>=S?(A=1,T=0,E=0,C=1,D=1,I=0):_>=S?(A=1,T=0,E=0,C=1,D=0,I=1):(A=0,T=0,E=1,C=1,D=0,I=1):M<S?(A=0,T=0,E=1,C=0,D=1,I=1):_<S?(A=0,T=1,E=0,C=0,D=1,I=1):(A=0,T=1,E=0,C=1,D=1,I=0);let L=_-A+lc,z=M-T+lc,F=S-E+lc,Q=_-C+2*lc,Y=M-D+2*lc,O=S-I+2*lc,j=_-1+3*lc,V=M-1+3*lc,W=S-1+3*lc,J=p&255,ce=f&255,$=v&255,ne=.6-_*_-M*M-S*S;if(ne<0)l=0;else{let we=J+t[ce+t[$]];ne*=ne,l=ne*ne*(i[we]*_+r[we]*M+n[we]*S)}let ie=.6-L*L-z*z-F*F;if(ie<0)c=0;else{let we=J+A+t[ce+T+t[$+E]];ie*=ie,c=ie*ie*(i[we]*L+r[we]*z+n[we]*F)}let de=.6-Q*Q-Y*Y-O*O;if(de<0)u=0;else{let we=J+C+t[ce+D+t[$+I]];de*=de,u=de*de*(i[we]*Q+r[we]*Y+n[we]*O)}let be=.6-j*j-V*V-W*W;if(be<0)h=0;else{let we=J+1+t[ce+1+t[$+1]];be*=be,h=be*be*(i[we]*j+r[we]*V+n[we]*W)}return 32*(l+c+u+h)}}function NK(e){let t=new Uint8Array(512);for(let i=0;i<512/2;i++)t[i]=i;for(let i=0;i<512/2-1;i++){let r=i+~~(e()*(256-i)),n=t[i];t[i]=t[r],t[r]=n}for(let i=256;i<512;i++)t[i]=t[i-256];return t}var fl=new ws,L_e=class{constructor(e){this.weightAttribute=null;let t=e.geometry;if(!t.isBufferGeometry||t.attributes.position.itemSize!==3)throw new Error("THREE.MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");t.index&&(t=t.toNonIndexed()),this.geometry=t,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.distribution=null}build(){let e=this.positionAttribute,t=new Float32Array(e.count/3);for(let r=0;r<e.count;r+=3){let n=1;fl.a.fromBufferAttribute(e,r),fl.b.fromBufferAttribute(e,r+1),fl.c.fromBufferAttribute(e,r+2),n*=fl.getArea(),t[r/3]=n}this.distribution=new Float32Array(e.count/3);let i=0;for(let r=0;r<t.length;r++)i+=t[r],this.distribution[r]=i;return this}setRandomGenerator(e){return this.randomFunction=e,this}sample(e,t){if(this.distribution){let i=this.distribution[this.distribution.length-1],r=this.binarySearch(this.randomFunction()*i);return this.sampleFace(r,e,t)}}binarySearch(e){if(!this.distribution)return 0;let t=this.distribution,i=0,r=t.length-1,n=-1;for(;i<=r;){let s=Math.ceil((i+r)/2);if(s===0||t[s-1]<=e&&t[s]>e){n=s;break}else e<t[s]?r=s-1:i=s+1}return n}sampleFace(e,t,i){let r=this.randomFunction(),n=this.randomFunction();return r+n>1&&(r=1-r,n=1-n),fl.a.fromBufferAttribute(this.positionAttribute,e*3),fl.b.fromBufferAttribute(this.positionAttribute,e*3+1),fl.c.fromBufferAttribute(this.positionAttribute,e*3+2),t.set(0,0,0).addScaledVector(fl.a,r).addScaledVector(fl.b,n).addScaledVector(fl.c,1-(r+n)),fl.getNormal(i),this}},O_e=Sh(gY()),z_e=new ht,N_e=new ht,B_e=new ht,K1;(e=>{function t(i){return i&&i.__isSPEObject}e.is=t})(K1||(K1={}));var ek=e=>class extends e{constructor(){super(...arguments),this.previousModelViewMatrix=new ht,this.copyPreviousMatrix=!0,this.hiddenMatrix=new ht,this.matrixWorldRigid=new ht,this.shearScale=new ht,this.shearScaleInv=new ht}get __isSPEObject(){return!0}isDescendantOf(t){t instanceof ir&&(t=t.uuid);let i=this;for(;i.parent;){if(i.parent.uuid===t)return!0;i=i.parent}return!1}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent===null?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);for(let i of this.children)i.updateMatrixWorld(t)}updateWorldMatrix(t,i){let r=this.parent;if(t&&r!==null&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),i)for(let n of this.children)n.updateWorldMatrix(!1,!0)}traverseChildren(t,i=0){for(let r of this.children)K1.is(r)&&r.traverseObject(t,i+1)}traverseObject(t,i=0){if(t(this,i)!==!0)for(let r of this.children)K1.is(r)&&r.traverseObject(t,i+1)}updateMatrixWorldSVD(){let t=this.matrixWorld.elements,i=[[t[0],t[4],t[8]],[t[1],t[5],t[9]],[t[2],t[6],t[10]]],{u:r,v:n,q:s}=(0,O_e.SVD)(i),a=z_e.set(r[0][0],r[0][1],r[0][2],0,r[1][0],r[1][1],r[1][2],0,r[2][0],r[2][1],r[2][2],0,0,0,0,1),o=N_e.set(n[0][0],n[0][1],n[0][2],0,n[1][0],n[1][1],n[1][2],0,n[2][0],n[2][1],n[2][2],0,0,0,0,1),l=B_e.copy(o).transpose();this.shearScale.makeScale(s[0],s[1],s[2]).multiply(l).premultiply(o),this.shearScaleInv.copy(this.shearScale).invert(),this.matrixWorldRigid.multiplyMatrices(a,l).copyPosition(this.matrixWorld),s.every(c=>Math.abs(s[0]-c)<.01)?this.hasNonUniformScale=!1:this.hasNonUniformScale=!0}attach(t,i){this.updateWorldMatrix(!0,!1);let r=new ht().copy(this.matrixWorld).invert();return t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),r.multiply(t.parent.matrixWorld)),"hiddenMatrix"in t&&t.hiddenMatrix instanceof ht?t.hiddenMatrix.premultiply(r):t.applyMatrix4(r),t.updateWorldMatrix(!1,!1),this.add(t),i!==void 0&&(this.children.pop(),this.children.splice(i,0,t)),this}copy(t,i=!1){return super.copy(t,i),this.hasNonUniformScale=t.hasNonUniformScale,this}onAfterRender(t,i,r,n,s,a){this.copyPreviousMatrix&&this.previousModelViewMatrix.copy(this.modelViewMatrix)}},k_e=class extends ek(ir){},U_e=e=>e.type==="Mesh",Xs=class extends k_e{constructor(e){super(),this.object=e,this.matrixAutoUpdate=!1,this.hasNonUniformScale=e.hasNonUniformScale}raycast(e,t){}expand(){let e=0,t=this.object.entityChildren(e);for(;t;){let i=this.children[e];(i==null?void 0:i.object)!==t&&(i&&this.remove(i),i=new Xs(t),this.add(i),this.children.splice(e,0,this.children.pop()),i.matrixWorldNeedsUpdate=!0,i.matrixAutoUpdate=!1,i.matrix=t.matrix,i.hiddenMatrix=t.hiddenMatrix),i.expand(),e+=1,t=this.object.entityChildren(e)}for(;this.children.length>e;)this.remove(this.children[e])}get visible(){var e;return this.playModeVisible!==void 0?this.playModeVisible:this.object.visible||this.object.dataPatched.visible&&((e=this.object.dataPatched.cloner)==null?void 0:e.hideBase)===!0}set visible(e){}get castShadow(){return this.object.castShadow}set castShadow(e){}get receiveShadow(){return this.object.receiveShadow}set receiveShadow(e){}get isMesh(){return U_e(this.object)}get isLight(){return this.object.isLight}get layers(){return this.object.layers}set layers(e){}get isCamera(){return!1}get geometry(){if(this.object.geometry)return this.object.geometry}get material(){if(this.object.material)return this.object.material}},Kp=new B,Zp=new B,Ev=new ht,BK=[new B(-1,1,1),new B(-1,-1,1),new B(1,-1,1),new B(1,1,1),new B(-1,1,-1),new B(-1,-1,-1),new B(1,-1,-1),new B(1,1,-1)],F_e=[[0,3],[1,2],[5,6],[4,7],[0,1],[3,2],[7,6],[4,5],[0,4],[1,5],[2,6],[3,7]],V_e=[[0,2],[7,5],[4,1],[3,6],[4,3],[1,6]],m6=(e,t,i)=>{e.updateEntityBoxSize(Kp,Zp),Ev.copy(t).multiply(e.matrixWorld),Zp.x===0&&Zp.y===0&&Zp.z===0?i.push(new B(Kp.x,Kp.y,Kp.z).applyMatrix4(Ev)):BK.forEach(r=>{i.push(r.clone().multiply(Zp).add(Kp).applyMatrix4(Ev))})},g6=class extends cn{constructor(){super(...arguments),this.matrix=new ht,this.vertices=[],this.faces=[],this.edges=[],this.centerEdges=[]}copy(e){return super.copy(e),this.matrix.copy(e.matrix),this.vertices=e.vertices.map(t=>t.clone()),this.faces=e.faces.map(t=>t.clone()),this.edges=e.edges.map(t=>t.clone()),this.centerEdges=e.centerEdges.map(t=>t.clone()),this}setFromObjectSize(e,t=!1){e.updateWorldMatrix(!1,t),this.makeEmpty(),this.matrix.copy(e.matrixWorld);let i=new ht().copy(e.matrixWorld).invert();return this.expandByObjectSize(e,i,t)}expandByObjectSize(e,t,i=!1){let r=[];return i===!0?e.traverseEntity(n=>{if(n.visible||n.cloner&&n.data.visible){if(!("geometry"in n)){r.push(new B);return}m6(n,t,r)}}):m6(e,t,r),this.setFromPoints(r)}getCenter(e){return e=super.getCenter(e),e.applyMatrix4(this.matrix),e}getPositionToCenter(e){return e=super.getCenter(e),e.applyMatrix4(Ev.copy(this.matrix).setPosition(0,0,0)),e}computeVertices(){this.getSize(Zp).multiplyScalar(.5),this.getCenter(Kp),Ev.copy(this.matrix).setPosition(Kp),this.vertices=BK.map(e=>e.clone().multiply(Zp).applyMatrix4(Ev))}computeEdges(){this.vertices.length>0&&this.computeVertices(),this.edges=F_e.map(([e,t])=>new Jo(this.vertices[e],this.vertices[t])),this.centerEdges=this.edges.map(e=>e.getCenter(new B))}computeFaces(){this.vertices.length>0&&this.computeVertices(),this.faces=V_e.map(([e,t])=>this.vertices[e].clone().add(this.vertices[t]).multiplyScalar(.5))}},Ad={Cloner:()=>{},changeEntityProptotype:()=>{},createEntity:()=>{}},H_e=class extends WY{constructor(){super()}getPoints(e=12){let t=[],i,r=this.getCurveLengths(),n=r[r.length-1]/r.length;for(let s=0,a=this.curves;s<a.length;s++){let o=a[s],l=s===0?r[s]:r[s]-r[s-1],c=Math.ceil(e*l/n),u=o.getPoints(c);for(let h=0;h<u.length;h++){let d=u[h];i&&i.equals(d)||(t.push(d),i=d)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}},VO=.001;function HO(e,t,i){return t.clone().sub(e).cross(t.clone().sub(i)).length()<=VO}function b3(e,t){let i=new B(...e.position),r=new B(...e.controlNext.position),n=new B(...t.controlPrevious.position),s=new B(...t.position);return HO(i,r,s)&&HO(i,n,s)}function kK(e){let t=e.points.map(u=>new B(...u.data.position)),i=[e.points[0]],r=new B(...i[0].data.position);for(let u=0;u<e.points.length-1;u++)HO(r,t[u],t[u+1])||(i.push(e.points[u]),r=t[u]);i.push(e.points[e.points.length-1]);let n=e.isClosed,s=i.length-(n?0:1),a=i.length,o=[];for(let u=0;u<a;u++){let h=i[u].data,d=new B(...h.position),p=new B(...h.controlPrevious.position),f=new B(...h.controlNext.position),v={position:d,baseRoundness:h.roundness,controlPrevious:p,controlNext:f};if(h.roundness===0||!e.isClosed&&(u===0||u===a-1)){o[u]={...v,removedLength:0};continue}let g=n&&u==0?a-1:u-1,m=n&&u==a-1?0:u+1,x=i[g].data,w=i[m].data,_=new B(...x.position),M=new B(...w.position),S=_.clone().sub(d).normalize(),A=M.clone().sub(d).normalize();Object.assign(v,{prevDir:S,nextDir:A});let T=b3(x,h),E=b3(h,w);if(!T||!E)o[u]={...v,removedLength:0};else{let C=S.clone().add(A).normalize(),D=C.clone().cross(S).length()/S.dot(C);o[u]={...v,tan:D,removedLength:h.roundness/D}}}for(let u=0;u<s;u++){let h=u,d=n&&u===a-1?0:u+1,p=o[h],f=o[d];if(p.removedLength!==0||f.removedLength!==0){let v=p.position.distanceTo(f.position);p.removedLength=Math.min(p.removedLength,v/2),f.removedLength=Math.min(f.removedLength,v/2)}}let l=[];for(let u=0;u<s;u++){let h=u,d=n&&u===a-1?0:u+1,p=o[h],f=o[d],v=null;if(!b3(i[h].data,i[d].data))p.position.distanceTo(f.position)>VO&&(v=new pE(p.position,p.controlNext,f.controlPrevious,f.position));else{let g=p.position.clone(),m=f.position.clone();(p.removedLength!==0||f.removedLength!==0)&&(p.nextDir&&g.add(p.nextDir.clone().setLength(p.removedLength)),f.prevDir&&m.add(f.prevDir.clone().setLength(f.removedLength))),g.distanceTo(m)>VO&&(v=new pE(g,g.clone().lerp(m,.3),m.clone().lerp(g,.3),m))}l[2*u+1]=v}for(let u=0;u<a;u++){let h=o[u];if(h.removedLength===0){l[2*u]=null;continue}let d=h.position,p=h.prevDir.clone().multiplyScalar(h.removedLength).add(d),f=h.nextDir.clone().multiplyScalar(h.removedLength).add(d),v=h.tan*h.removedLength,g=h.prevDir.clone().add(h.nextDir).normalize(),m=p.clone().lerp(f,.5),x=p.distanceTo(f)/2,w=g.clone().multiplyScalar(Math.sqrt(Math.pow(v,2)-Math.pow(x,2))).add(m),_=g.clone().multiplyScalar(-v).add(w),M=d.distanceTo(_)/d.distanceTo(m),S=h.prevDir.clone().multiplyScalar(M*d.distanceTo(p)).add(d),A=S.clone().lerp(_,2),T=p.clone().lerp(S,4/3),E=f.clone().lerp(A,4/3);l[2*u]=new pE(p,T,E,f)}let c=new H_e;return l.forEach(u=>{u&&c.add(u)}),c}var Pi;(e=>{function t(i){return i&&i.__isEntity}e.is=t})(Pi||(Pi={}));var zu=e=>Pi.is(e),G_e={type:"completeState",isfromEntity:!0},j_e=["x","y","z"],_3=new B,W_e=new B().set(0,1,0),tk=e=>class extends ek(e){constructor(){super(...arguments),this.raycastLock=!1,this.scaleLock=!1,this.disposed=!1,this.stateSelection=null,this.destroyedInAction=!1,this.instances=[],this.prevState=null,this.currentState=null,this.reversibleToState=null,this.currentTransitionEvent=null,this.previousAction=null,this._singleBBox=new g6,this._recursiveBBox=new g6,this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0,this._needApplyPathSnapping=!0,this.attachedPaths=new Set}get __isEntity(){return!0}entityChildren(t){let i=this.children[t];if(Pi.is(i))return i}entityChildrenCount(){let t=this.children.length;for(;t--;)if(Pi.is(this.children[t]))return t+1;return 0}get isConcreteEntity(){return typeof this.identity=="string"}get isVirtualEntity(){return typeof this.identity!="string"}get isInstanceRoot(){return this.isConcreteEntity&&this.data.type==="Instance"}nearestInstanceSelfOrParent(){let t=this;for(;t.data.type!=="Instance";){let i=t.parent;if(Pi.is(i))t=i;else return}return t}forInstancesRec(t){this.instances.forEach(i=>{i.disposed||t(i),i.forInstancesRec(t)})}super_Entity(t,i){typeof t=="string"&&(this.uuid=t),this.identity=t,this.data=i,this.matrixAutoUpdate=!1,this.dataPatched=this.data}changeSelectedState(t,i,r=!1){if(!(this.data.states.length===0&&!r)){for(let n of this.data.states)lf.toOps(this.data,n.data).forEach(s=>{let a=BA.replaceProps(s,this.data);this.dataPatched=this.data,this.updateByPatchedOp(a,this.data,i)});if(t!==null){let n=this.data.states.data(t);n&&(this.dataPatched=lf.patch(this.data,n),lf.toOps(this.data,n).forEach(s=>{this.updateByPatchedOp(s,this.dataPatched,i)}))}r&&this.updateTransformState(this.dataPatched,i),this.stateSelection=t,this.updatePathSnapping(this.dataPatched.pathSnapping)}}get singleBBox(){return this.singleBBoxNeedsUpdate&&(this.singleBBoxNeedsUpdate=!1,this._singleBBox.setFromObjectSize(this,!1),this._singleBBox.computeVertices(),this._singleBBox.computeEdges(),this._singleBBox.computeFaces()),this._singleBBox}get recursiveBBox(){return this.recursiveBBoxNeedsUpdate&&(this.recursiveBBoxNeedsUpdate=!1,this._recursiveBBox.setFromObjectSize(this,!0),this._recursiveBBox.computeVertices(),this._recursiveBBox.computeEdges(),this._recursiveBBox.computeFaces()),this._recursiveBBox}updateEntityBoxSize(t,i){t.setScalar(0),i.setScalar(0)}resetBBoxNeedsUpdateSelf(){this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}resetBBoxNeedsUpdate(){this.resetBBoxNeedsUpdateSelf(),this.traverseAncestors(t=>{zu(t)&&t.resetBBoxNeedsUpdateSelf()}),this.traverseEntity(t=>{t.resetBBoxNeedsUpdateSelf()})}find(t){let i;return this.traverseEntity(r=>{r.uuid===t&&(i=r)}),i}traverseSortNextHelper(){let t=this.parent;if(t){let i=t.children,r=i.indexOf(this)+1;if(Pi.is(i[r]))return i[r];if(Pi.is(t))return t.traverseSortNextHelper()}}sortNext(){let t=this.children;return this.children.length>0&&Pi.is(this.children[0])?t[0]:this.traverseSortNextHelper()}goUp(t){let i=this;for(;t>0&&i!==null;)i=i.parent,t-=1;return i}hasAnccestorOrSelf(t){return this===t||this.hasAnccestor(t)}hasAnccestor(t){let i=this.parent;for(;i;){if(t===i)return!0;i=i.parent}return!1}countToAccestor(t){let i=0,r=this;for(;r!==t;){if(r===null)return-1;r=r.parent,i+=1}return i}forEachEntity(t){for(let i of this.children)zu(i)&&t(i)}traverseEntityAncestors(t){this.traverseAncestors(i=>{Pi.is(i)&&t(i)})}traverseConcreteEntity(t,i=0){if(t(this,i)!==!0)for(let r of this.children)zu(r)&&r.isConcreteEntity&&r.traverseEntity(t,i+1)}traverseEntity(t,i=0){if(t(this,i)!==!0)for(let r of this.children)zu(r)&&r.traverseEntity(t,i+1)}traverseVisibleEntity(t){t(this);for(let i of this.children)zu(i)&&i.visible&&i.traverseVisibleEntity(t)}updateMatrix(){super.updateMatrix(),this.cloner&&this.cloner.onObjUpdateMatrix(),this.dispatchEvent({type:"updateMatrix"})}updateMatrixWorld(t){super.updateMatrixWorld(t),this.dispatchEvent({type:"updateMatrixWorld"})}copy(t,i=!1){return super.copy(t,i),this.dataPatched=t.dataPatched,this.raycastLock=t.raycastLock,this.scaleLock=t.scaleLock,this.hiddenMatrix.copy(t.hiddenMatrix),this}hasEntityChild(){return this.children.some(t=>zu(t))}isAncestorOf(t){if(this.uuid===t)return!1;let i=!1;return this.traverseEntity(r=>{r.uuid===t&&(i=!0)}),i}toObjectTransformState(t=[]){this.updateWorldMatrix(!0,!1);let i={position:this.position.toArray(),rotation:[this.rotation.x*Et.RAD2DEG,this.rotation.y*Et.RAD2DEG,this.rotation.z*Et.RAD2DEG],scale:this.scale.toArray(),hiddenMatrix:this.hiddenMatrix.toArray()};return KL(i,t)}getTransformValues(t,i,r){return i[t].map((n,s)=>(r==null?void 0:r.shared.getVariable(n,[this.uuid,t,j_e[s]]))??n)}updateTransformState(t,i){let r=!1;return t.position&&(this.position.fromArray(this.getTransformValues("position",t,i)),r=!0),t.rotation&&(_3.fromArray(this.getTransformValues("rotation",t,i)).multiplyScalar(Et.DEG2RAD),this.rotation.setFromVector3(_3),r=!0),t.scale&&(this.scale.fromArray(this.getTransformValues("scale",t,i)),r=!0),t.hiddenMatrix!==void 0&&(r=!0,this.hiddenMatrix.fromArray(t.hiddenMatrix??Zv.identity)),r&&(this.updateMatrix(),this.resetBBoxNeedsUpdate(),this.invalidateClonerTransform(this),this.traverseEntityAncestors(n=>{n.invalidateClonerTransform(this)})),t.position&&t.rotation&&t.scale&&t.hiddenMatrix!==void 0&&this.updateWorldMatrix(!1,!0),r}onVariableUpdate(t=!1){if(t){this.resetBBoxNeedsUpdate();return}this.updateMatrix(),this.resetBBoxNeedsUpdate(),this.invalidateClonerTransform(this),this.traverseEntityAncestors(i=>{i.invalidateClonerTransform(this)})}dispose(){this.disposed=!0,this.cloner&&(this.cloner.removeFromParent(),this.cloner=void 0)}disposeChildrenRecursively(){for(let t of this.children)Pi.is(t)&&t.disposeRecursively()}disposeRecursively(){this.dispose(),this.children.forEach(t=>{Pi.is(t)&&t.disposeRecursively()})}toState(t=[]){let i={name:this.name,visible:this.visible,raycastLock:this.raycastLock,...this.toObjectTransformState(t)};return KL(i,t)}updateByObjUpdateOp(t,i){t!==void 0&&this.updateByOp({type:0,props:t,path:[]},{...this.data,...t},i,!1)}updateByOp(t,i,r,n){let s=this.data;this.data=i;let a=t,o=hr(t.path,["states","*"]);if(o!==null){if(t.type===0){let[l]=o;if((this==null?void 0:this.stateSelection)===l){let c={...t.props};if(delete c.name,Object.values(t.props).some(u=>u===void 0)){let u=this.data;if(u!==void 0){let h=Bn.zoom(u,t.path.slice(2));if(h)for(let d in t.props)t.props[d]===void 0&&d in h&&(c[d]=h[d])}}a={...t,props:c,path:t.path.slice(2)}}}}else if(t.type===0){let l=this.stateSelection?this.data.states.data(this.stateSelection):void 0;if(l!==void 0){if(t.props.name!==void 0&&l.name){let{name:u,...h}=l;l=h}if(t.props.material!==void 0&&"material"in l){let{material:u,...h}=l;l=h}let c=Bn.removeOverridden(t.path,t.props,l);a={...t,props:c}}}if(this.updateByPatchedOpBase(a,lf.patch(this.data,this.stateSelection?this.data.states.data(this.stateSelection):void 0),r),hr(t.path,["overrides"])){let l=[],c=[...t.path];for(l.push(c[1]),c.splice(0,2);c.length>0&&c[0]==="descendants";)l.push(c[1]),c.splice(0,2);if(l[l.length-1]===void 0){if(t.type===0)for(let u of Object.keys(t.props)){l[l.length-1]=u;let h=r.scene.findInstance([this.uuid,...l]);h&&(h.overrideData=t.props[u],h.updateState(Ud.apply(h.component.data,h.overrideData),r))}}else{let u=r.scene.findInstance([this.uuid,...l]);if(u){let h=Bn.zoom(u.component.data,c);if(t={...t,path:c},t.type===0){let d=t.props;if(h)for(let[p,f]of Object.entries(t.props))f===void 0&&(d===t.props&&(d={...t.props}),d[p]=h[p]);t={...t,props:d}}u.overrideData=YA.resolve(i.overrides,l),u.updateByOp(t,rs.applySimple(u.data,t),r,!1)}}}else if(this.instances.length>0){let l;if(t.path.length===0&&t.type===0){let c;for(let u of Md.rootOverrideProps)u in t.props&&(c===void 0&&(c={}),c[u]=t.props[u]);c&&(l={...t,props:c})}else for(let c of Md.rootOverrideProps)if(hr(t.path,[c])){l=t;break}l!==void 0&&this.instances.forEach(c=>{if(c.isInstanceRoot){let u=Ud.filterOp(c.overrideData,l);u&&c.updateByOp(u,rs.applySimple(c.data,u),r,!0)}}),this.instances.forEach(c=>{if(!c.isInstanceRoot){let u=Ud.filterOp(c.overrideData,t);if(u){let h;s===c.data&&t===u?h=i:h=rs.applySimple(c.data,u),c.updateByOp(u,h,r,!0)}}})}}updateByPatchedOpBase(t,i,r){if(this.dataPatched=i,t.path.length===0&&t.type===0)t.props.type!==void 0&&!Wf.is(t.props.type)&&Ad.changeEntityProptotype(this,i,r);else if(t.path.length===1&&t.path[0]==="geometry"&&t.type===0&&"type"in t.props){Ad.changeEntityProptotype(this,i,r);for(let n of this.children)Pi.is(n)&&n.updateVisible(r.scene)}this.updateByPatchedOp(t,i,r)}updateByPatchedOp(t,i,r){if(t.path.length===0&&t.type===0&&this.updateState(t.props,r),hr(t.path,["pathSnapping"])!==null&&this.updatePathSnapping(i.pathSnapping),hr(t.path,["cloner"])!==null){let n=rs.drop(t,1);n.path.length===0&&n.type===0&&n.props.disabled===!0?this.setFromClonerState(null,r):this.cloner?this.cloner.updateState(i.cloner,r.scene):(this.setFromClonerState(i.cloner,r),this.expandCloner(r.scene)),this.updateVisible(r.scene)}}updatePathSnapping(t=this.dataPatched.pathSnapping){this._updatedPathSnapping=t,this._needApplyPathSnapping=!0}get updatedPathSnapping(){return this._updatedPathSnapping}applyPathSnapping(t){var f,v,g,m,x;let i=((f=this._updatedPathSnapping)==null?void 0:f.pathId)??this.dataPatched.pathSnapping.pathId,r=((v=this._updatedPathSnapping)==null?void 0:v.slide)??this.dataPatched.pathSnapping.slide??0,n=((g=this._updatedPathSnapping)==null?void 0:g.offset)??this.dataPatched.pathSnapping.offset??0,s=((m=this._updatedPathSnapping)==null?void 0:m.orientation)??this.dataPatched.pathSnapping.orientation;if(i===null)return;let a=t.find(i);if(!a||this._needApplyPathSnapping===!1)return;this._needApplyPathSnapping=!1;let o=a.data;if(o.geometry.path.points.length<=1)return;let l=kK(o.geometry.path),c=(r+n)%1;r+n===1&&c===0&&(c=1);let u=l.curves.length?l.getPointAt(c):null;if(u===null)return;let h=this.parent?(x=this.parent)==null?void 0:x.matrixWorld:new ht;a.updateMatrixWorld();let d=new ht().multiplyMatrices(h.clone().invert(),a.matrixWorld);u.applyMatrix4(d);let p={position:u.toArray(),rotation:o.rotation};if(s==="tangential"){let w=new ht().extractRotation(a.matrixWorld),_=l.getTangentAt(c).applyMatrix4(w).add(u),M=new ht().lookAt(u,_,W_e),S=_3.setFromEuler(new Nn().setFromRotationMatrix(M)).multiplyScalar(Et.RAD2DEG);p={...p,rotation:S.toArray()}}this.updateTransformState(p),this.traverseEntity(w=>{w._cameraType&&w.dispatchEvent(G_e)})}updateVisible(t){var r;if(this.visible=this.dataPatched.visible&&(!this.dataPatched.cloner||(this.dataPatched.cloner.disabled??!1)||((r=this.dataPatched.cloner)==null?void 0:r.hideBase)!==!0),!t)return;let i=!1;this.traverseEntity(n=>{if(n.data.type==="Splat")return i=!0,!0}),i&&t.reloadSplats()}updateState_Entity(t,i){t.name!==void 0&&(this.name=t.name),t.raycastLock!==void 0&&(this.raycastLock=t.raycastLock),t.visible!==void 0&&(this.updateVisible(i==null?void 0:i.scene),this.resetBBoxNeedsUpdate()),i&&"cloner"in t&&t.cloner!==void 0&&(this.setFromClonerState(t.cloner,i),this.updateVisible(i.scene)),this.updateTransformState(t,i)}get attachedSurfaceCloners(){return this.children.filter(t=>t instanceof Ad.Cloner&&t.parameters.type==="toObject")}setFromClonerState(t,i){this.disposed||(t===null||t.disabled?(this.cloner&&this.cloner.removeFromParent(),this.cloner=void 0):this.cloner===void 0?(this.cloner=new Ad.Cloner(this,t),i.scene.addPendingExpandCloner(this)):this.cloner.updateState(t,i.scene))}expandCloner(t){!this.disposed&&this.cloner&&this.cloner.expandClones(t)}invalidateClonerTransform(t){this.cloner&&this.cloner.invalidateTransform(t)}requestRender(){this.dispatchEvent({type:"requestRender"})}},UK=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,radialSegments:64,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadius:8,cornerSegments:8,hollow:0},e.parameters);i.thetaLength=Et.clamp(i.thetaLength,0,360);let r=i.width/2,n=i.radiusTop??r,s=i.radiusBottom??r;return n===s?(n=r,s=r):n>s?(n=r,s=s*r/n):(n=n*r/s,s=r),{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width),radiusTop:n,radiusBottom:s})}}static build(e){let{width:t,depth:i,height:r,radialSegments:n,heightSegments:s,openEnded:a,thetaStart:o,thetaLength:l,radiusTop:c,radiusBottom:u,cornerRadius:h,cornerSegments:d,hollow:p}=e.parameters,f;return l===0?(f=new Bt,f.setAttribute("position",new St([],3))):h||p?f=new FK(c,u,r,n,s,a,o,l*Math.PI/180,h,h,d,p):f=new xB(c,u,r,n,s,a,o,l*Math.PI/180),f.scale(1,1,i/t),Object.assign(f,{userData:{...e,type:"CylinderGeometry"}})}};function Hh(e,t,i){i.x=e.x*t.x,i.y=e.y,i.z=e.x*t.y}function v6(e){return new ve(e.y,-e.x)}var FK=class extends Bt{constructor(e,t,i,r,n,s,a,o,l,c,u,h,d=!1){super(),this.type="RoundedCylinderBufferGeometry",e=e!==void 0?e:1,t=t!==void 0?t:1,i=i||1,r=Math.floor(r)||8,n=Math.floor(n)||1,s=s!==void 0?s:!1,a=a!==void 0?a:0,o=o!==void 0?o:Math.PI*2,s&&(l=0,c=0);let p=[],f=[],v=[],g=[],m=0,x=i/2,w=new B,_=new B;d&&e==0&&(e=l),d&&t==0&&(t=c);let M=new ve(e,x),S=new ve(t,-x),A=null,T=null,E=null,C=null,D=M.clone().sub(S),I=0,L=0,z=0;h>0&&(I=Math.min(e,t)*(1-h),L=e-I,z=t-I);let F=M.clone();F.x-=I;let Q=Math.PI-D.angle(),Y=D.angle(),O=Math.tan(Y/2),j=Math.tan(Q/2),V=O+j,W=h?V:j,J=h?V:O;if(l=Math.min(l,(e-L)/W,D.length()/V),c=Math.min(c,(t-z)/J,D.length()/V),l>0){let be=l/O;A=M.clone().sub(new ve(be,l)),h&&(E=A.clone(),E.x-=I-V*l),M.sub(D.clone().setLength(be))}if(c>0){let be=c/j;T=S.clone().sub(new ve(be,-c)),S.add(D.clone().setLength(be)),h&&(C=T.clone(),C.x-=I-V*c,F.sub(D.clone().setLength(be)))}D=M.clone().sub(S);let ce=D.length()<.5,$=[];for(let be=0;be<=r;be++){let we=[],_e=be/r,Me=_e*o+a,X=new ve(Math.sin(Me),Math.cos(Me));C&&T?(ne(we,_e,X,Q,c,C,-1,!0),ne(we,_e,X,Y,c,T,-1,!1)):T?(ie(we,X,T.x,0,-1),ne(we,_e,X,Y,c,T,-1,!1)):s||ie(we,X,t,z,-1);let ge=v6(D).normalize();if(Hh(ge,X,w),!ce)for(let Oe=0;Oe<=n;Oe++){let Ie=Oe/n,Pe=D.clone().multiplyScalar(Ie).add(S);Hh(Pe,X,_),f.push(_.x,_.y,_.z),v.push(w.x,w.y,w.z),g.push(_e,.5+_.y/i),we.push(m++)}if(E&&A?(ne(we,_e,X,Q,l,A,1,!1),ne(we,_e,X,Y,l,E,1,!0)):A?(ne(we,_e,X,Q,l,A,1,!1),ie(we,X,A.x,0,1)):s||ie(we,X,e,L,1),h&&!ce){let Oe=v6(D).multiplyScalar(-1).normalize();Hh(Oe,X,w);for(let Ie=0;Ie<=n;Ie++){let Pe=Ie/n,Ye=D.clone().multiplyScalar(-Pe).add(F);Hh(Ye,X,_),f.push(_.x,_.y,_.z),v.push(w.x,w.y,w.z),g.push(_e,.5+_.y/i),we.push(m++)}}h&&!s&&we.push(we[0]),$.push(we)}for(let be=0;be<$.length-1;be++)for(let we=0;we<$[0].length-1;we++){if(s&&h&&we==n)continue;let _e=$[be][we],Me=$[be+1][we],X=$[be+1][we+1],ge=$[be][we+1],Oe=f[X*3+0],Ie=f[X*3+2];p.push(_e,Me,ge),(Oe!=0||Ie!=0)&&p.push(Me,X,ge)}o<Math.PI*2&&(de(-1,$[0],a),de(1,$[$.length-1],a+o)),this.setIndex(p),this.setAttribute("position",new St(f,3)),this.setAttribute("normal",new St(v,3)),this.setAttribute("uv",new St(g,2));function ne(be,we,_e,Me,X,ge,Oe,Ie){for(let Pe=0;Pe<u+1;Pe++){let Ye=Pe/u,ke=Oe<0?Ye:1-Ye;Ie&&(ke-=1),ke*=Me;let Fe=new ve(Math.sin(ke),Math.cos(ke)*Oe),se=Fe.clone().multiplyScalar(X).add(ge);Hh(se,_e,_),f.push(_.x,_.y,_.z),Hh(Fe,_e,w),v.push(w.x,w.y,w.z),g.push(we,.5+_.y/i),be.push(m++)}}function ie(be,we,_e,Me,X){let ge=new B,Oe=new ve,Ie=[_e,Me];X<0&&Ie.reverse();for(let Pe of Ie)Oe.set(Pe,x*X),Hh(Oe,we,ge),f.push(ge.x,ge.y,ge.z),v.push(0,X,0),g.push(.5,.5),be.push(m++)}function de(be,we,_e){let Me=new ve(Math.sin(_e),Math.cos(_e)),X=new ve(-Math.cos(_e),Math.sin(_e)),ge=new B,Oe=be<0?(Ye,ke,Fe)=>p.push(Ye,ke,Fe):(Ye,ke,Fe)=>p.push(Ye,Fe,ke),Ie=new ve((e+t+L+z)/4,0);Hh(Ie,Me,ge),f.push(ge.x,ge.y,ge.z),v.push(X.x,0,X.y),g.push(.5,.5);let Pe=m++;for(let Ye of we){let ke=f.slice(Ye*3,Ye*3+3);f.push(...ke),v.push(X.x,0,X.y);let Fe=g.slice(Ye*2,Ye*2+2);g.push(...Fe),m++}for(let Ye=Pe+1;Ye<m-1;Ye++)Oe(Pe,Ye,Ye+1);Oe(Pe,m-1,Pe+1)}}},X_e=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,radialSegments:32,heightSegments:8,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadiusTop:8,cornerRadiusBottom:8,cornerSegments:8},e.parameters);return i.thetaLength=Et.clamp(i.thetaLength,0,360),{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,depth:i,height:r,radialSegments:n,heightSegments:s,openEnded:a,thetaStart:o,thetaLength:l,cornerRadiusTop:c,cornerRadiusBottom:u,cornerSegments:h}=e.parameters,d;return l===0?(d=new Bt,d.setAttribute("position",new St([],3))):c>0||u>0||l<360?d=new FK(0,t/2,r,n,s,a,o,l*Math.PI/180,c,u,h,0,!0):d=new wB(t/2,r,n,s,a),d.scale(1,1,i/t),Object.assign(d,{userData:{...e,type:"ConeGeometry"}})}},q_e=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,widthSegments:1,heightSegments:1,depthSegments:1,cornerRadius:8,cornerSegments:8},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:r,widthSegments:n,heightSegments:s,depthSegments:a,cornerRadius:o,cornerSegments:l}=e.parameters,c;return o===0?c=new Hl(t,i,r,n,s,a):c=new Y_e(t,i,r,n,s,a,o,l),Object.assign(c,{userData:{...e,type:"CubeGeometry"}})}},S3=Math.PI/2,Y_e=class extends Bt{constructor(e=1,t=1,i=1,r=1,n=1,s=1,a=0,o=4){super(),this.type="BoxGeometry",r=Math.floor(r),n=Math.floor(n),s=Math.floor(s),o=Math.floor(o),a=Math.min(a,e/2,t/2,i/2);let l=[],c=[],u=[],h=[],d=0;p("z","y","x",-1,-1,i,t,e,s,n),p("z","y","x",1,-1,i,t,-e,s,n),p("x","z","y",1,1,e,i,t,r,s),p("x","z","y",1,-1,e,i,-t,r,s),p("x","y","z",1,-1,e,t,i,r,n),p("x","y","z",-1,-1,e,t,-i,r,n),a>0&&(f("z","y","x",-1,-1,1,i,t,e,s),f("z","y","x",1,-1,-1,i,t,e,s),f("z","y","x",-1,1,-1,i,t,e,s),f("z","y","x",1,1,1,i,t,e,s),f("x","y","z",-1,-1,-1,e,t,i,r),f("x","y","z",1,-1,1,e,t,i,r),f("x","y","z",-1,1,1,e,t,i,r),f("x","y","z",1,1,-1,e,t,i,r),f("y","x","z",-1,-1,1,t,e,i,n),f("y","x","z",1,-1,-1,t,e,i,n),f("y","x","z",1,1,1,t,e,i,n),f("y","x","z",-1,1,-1,t,e,i,n),v(1,1,1),v(-1,1,1),v(1,-1,1),v(-1,-1,1),v(1,1,-1),v(-1,1,-1),v(1,-1,-1),v(-1,-1,-1)),this.setIndex(l),this.setAttribute("position",new St(c,3)),this.setAttribute("normal",new St(u,3)),this.setAttribute("uv",new St(h,2));function p(g,m,x,w,_,M,S,A,T,E){let C=(M-2*a)/T,D=(S-2*a)/E,I=M/2-a,L=S/2-a,z=A/2,F=T+1,Q=E+1,Y=0,O=new B;for(let j=0;j<Q;j++){let V=j*D-L;for(let W=0;W<F;W++){let J=W*C-I;O[g]=J*w,O[m]=V*_,O[x]=z,c.push(O.x,O.y,O.z),O[g]=0,O[m]=0,O[x]=A>0?1:-1,u.push(O.x,O.y,O.z),h.push(W/T),h.push(1-j/E),Y+=1}}for(let j=0;j<E;j++)for(let V=0;V<T;V++){let W=d+V+F*j,J=d+V+F*(j+1),ce=d+(V+1)+F*(j+1),$=d+(V+1)+F*j;l.push(W,J,$),l.push(J,ce,$)}d+=Y}function f(g,m,x,w,_,M,S,A,T,E){let C=(S-2*a)/E,D=S/2-a,I=A/2-a,L=T/2,z=E+1,F=0,Q=new B,Y=new B;for(let O=0;O<o+1;O++){let j=O/o*S3,V=Math.sin(j)*a,W=(1-Math.cos(j))*a,J=Math.sin(j),ce=Math.cos(j);Q[m]=(I+V)*_,Q[x]=(L-W)*M,Y[g]=0,Y[m]=J*Math.sign(Q[m]),Y[x]=ce*Math.sign(Q[x]);for(let $=0;$<z;$++){let ne=$*C-D;Q[g]=ne*w,c.push(Q.x,Q.y,Q.z),u.push(Y.x,Y.y,Y.z),h.push($/E),h.push(0),F+=1}}for(let O=0;O<o;O++)for(let j=0;j<E;j++){let V=d+j+z*O,W=d+j+z*(O+1),J=d+(j+1)+z*(O+1),ce=d+(j+1)+z*O;l.push(V,W,ce),l.push(W,J,ce)}d+=F}function v(g,m,x){let w=new B,_=new B(e/2,t/2,i/2);_.subScalar(a);let M=[],S=g*m*x>0?(T,E,C)=>l.push(T,E,C):(T,E,C)=>l.push(T,C,E);for(let T=0;T<=o;T++){let E=[],C=S3*(1-T/o),D=Math.cos(C),I=Math.sin(C),L=0;for(let z=0;z<=T;z++){let F=Math.cos(L),Q=Math.sin(L);w.x=D*F,w.y=I,w.z=D*Q;let Y=_.clone().addScaledVector(w,a);c.push(g*Y.x,m*Y.y,x*Y.z),u.push(g*w.x,m*w.y,x*w.z),h.push(0,0),E.push(d++),L+=S3/T}M.push(E)}let A=M.length-1;for(let T=0;T<A;T++){let E=M[T],C=M[T+1],D=E.length-1;S(E[0],C[1],C[0]);for(let I=1;I<=D;I++)S(E[I-1],E[I],C[I]),S(E[I],C[I+1],C[I])}}}},ik=class extends Bt{constructor(e=[],t=[],i="",r=1,n=.2,s=4){super(),this.type="PolyhedronGeometryRound";let a=[],o=[],l=[];c(),u(),this.setAttribute("position",new St(a,3)),this.setAttribute("normal",new St(l,3)),this.setAttribute("uv",new St(o,2));return;function c(){var Y;n=Math.min(1-1e-5,n),n==0&&(s=0);let h={IcosahedronGeometry:5,DodecahedronGeometry:3,HexahedronGeometry:3,OctahedronGeometry:4,TetrahedronGeometry:3}[i],d=new B,p=d.clone(),f=new ws,v=n*r,g=r-v,m=s+1,x=new B,w=(O,j)=>x.subVectors(O,j).normalize(),_=(O,j)=>Array(O).fill(void 0).map(j),M=_(e.length/3,(O,j)=>new B().fromArray(e,j*3).setLength(r)),S=[],A=1e6;for(let O=0;O<M.length;O++){let j=M[O],V=[],W,J,ce,$=1e10,ne=-1;for(;(ne=t.indexOf(O,ne+1))!=-1;){let we=ne-ne%3;W=t[we+(ne+1)%3],J=t[we+(ne+2)%3],ce=j.distanceToSquared(M[W]),$=Math.min($,ce),V.push([W,J,ce])}$+=1e-6;let ie=[],de=0,be=V.length;for(let we=0;we<be;we++){[W,J,ce]=V[de];let _e=((Y=S[W])==null?void 0:Y.includes(O))==!0;ce<=$&&ie.push(W+ +_e*A),de=V.findIndex(Me=>Me[0]==J)}S.push(ie)}let T=[];{let O=0,j=0,V,W,J=h==3;for(let ce=0;ce<=s;ce++){V=ce*(ce+1)/2,W=(ce+1)*(ce+2)/2;for(let $=0;$<s-ce;$++)[O,j]=[V+$+ce+2,W+$+ce+3],T.push(V,W,...J?[j,V]:[O,W],j,O),[V,W]=[O,j];T.push(V,W,V+s+2)}}let E=d.clone(),C=d.clone(),D=d.clone(),I=d.clone(),L=d.clone(),z=[],F=_(M.length,()=>_(h,()=>d.clone()));for(let O=0;O<M.length;O++){d.copy(M[O]).normalize(),E.copy(d).multiplyScalar(g);let j=S[O];for(let ie=0;ie<j.length;ie++){let de=j[ie],be=j[(ie+1)%h];f.setFromPointsAndIndices(M,O,de%A,be%A),f.b.sub(f.a).setLength(1e10).add(f.a),f.c.sub(f.a).setLength(1e10).add(f.a),f.closestPointToPoint(E,F[O][ie])}let V=[],W=[],J=[],ce=new B;s==0&&[...F[O]].reduce((ie,de)=>ie.add(de),ce).multiplyScalar(1/h);for(let ie=0;ie<h;ie++){let de=[],be=(ie-1+h)%h,we=F[O][be],_e=F[O][ie];d.copy(we).sub(E),p.copy(_e).sub(E);let Me=E.angleTo(d),X=d.angleTo(p),ge=Math.cos(Me)*v;s==0?C.copy(ce):C.copy(E).setLength(g+ge),W.push(ge);let Oe=[C,we,_e];for(let Ie=0;Ie<2;Ie++){let Pe=Oe[Ie],Ye=Oe[Ie+1];I.subVectors(Pe,E),L.subVectors(Ye,E),D.crossVectors(I,L).normalize();for(let ke=0;ke<m;ke++){let Fe=[Me,X][Ie]*ke/m;d.copy(I).applyAxisAngle(D,Fe).add(E),V.push(d.clone()),Ie&&(w(d,E),de.push([ke==0?Pe:d.clone(),x.clone()]))}Ie&&(w(Ye,E),de.push([Ye,x.clone()]))}J.push(de)}z.push(J);let $=2*m,ne=2;for(let ie=0;ie<h;ie++){let de=$*ie,be=$*((ie+1)%h),we=[V[de]];for(let Me=1;Me<m;Me++){I=V[de+Me],L=V[be+Me],we.push(I);for(let X=1,ge=Me-ne+1;X<=ge;X++)d.lerpVectors(I,L,X/(ge+1)),d.sub(E).setLength(W[ie]).add(E),we.push(d.clone());we.push(L)}for(let Me=0;Me<m;Me++)we.push(V[Me+m+de]);we.push(V[be+m]);let _e=T.map(Me=>we[Me]);a.push(..._e.map(Me=>[Me.x,Me.y,Me.z]).flat()),l.push(..._e.map(Me=>(w(Me,E),[x.x,x.y,x.z])).flat())}}let Q=[];for(let O=0;O<S.length;O++)for(let j=0;j<h;j++){let V=S[O][j];if(V<A){let W=S[V].findIndex($=>$%A==O),J=z[O][j],ce=z[V][W];for(let $=0;$<m;$++){let ne=J[$],ie=ce[m-$],de=J[$+1],be=ce[m-($+1)];[ne,ie,de,de,ie,be].forEach(we=>{a.push(we[0].x,we[0].y,we[0].z),l.push(we[1].x,we[1].y,we[1].z)})}Q.push(J[0][0],ce[m][0],J[m][0],ce[0][0])}}for(;Q.length;){let O,j,V,W;[O,j]=Q.splice(0,2);let J=[O];for(;O!=j;)J.push(j),V=Q.indexOf(j),W=V%2,j=Q.splice(V-W,2)[1-W];x.subVectors(J[0],J[1]).cross(d.subVectors(J[0],J[2])).normalize();let ce=x.dot(J[0])<0;ce&&x.negate();for(let $=1;$<=J.length-2;$++)[J[$+ +ce],J[$+1-+ce],J[0]].forEach(ne=>{a.push(ne.x,ne.y,ne.z),l.push(x.x,x.y,x.z)})}}function u(){let h=new B;for(let S=0;S<a.length;S+=3){h.x=a[S+0],h.y=a[S+1],h.z=a[S+2];let A=_(h)/2/Math.PI+.5,T=M(h)/Math.PI+.5;o.push(A,1-T)}let d=new B,p=new B,f=new B,v=new B,g=new ve,m=new ve,x=new ve,w=(S,A,T,E)=>{E<0&&S.x===1&&(o[A]=S.x-1),T.x===0&&T.z===0&&(o[A]=E/2/Math.PI+.5)};for(let S=0,A=0;S<a.length;S+=9,A+=6){d.set(a[S+0],a[S+1],a[S+2]),p.set(a[S+3],a[S+4],a[S+5]),f.set(a[S+6],a[S+7],a[S+8]),g.set(o[A+0],o[A+1]),m.set(o[A+2],o[A+3]),x.set(o[A+4],o[A+5]),v.copy(d).add(p).add(f).divideScalar(3);let T=_(v);w(g,A+0,d,T),w(m,A+2,p,T),w(x,A+4,f,T)}for(let S=0;S<o.length;S+=6){let A=o[S+0],T=o[S+2],E=o[S+4],C=Math.max(A,T,E),D=Math.min(A,T,E);C>.9&&D<.1&&(A<.2&&(o[S+0]+=1),T<.2&&(o[S+2]+=1),E<.2&&(o[S+4]+=1))}function _(S){return Math.atan2(S.z,-S.x)}function M(S){return Math.atan2(-S.y,Math.sqrt(S.x*S.x+S.z*S.z))}}}static fromJSON(e){return new ik(e.vertices,e.indices,e.radius,e.corner,e.cornerSides)}},Q_e=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,detail:0,corner:0,cornerSides:4},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:r,detail:n,corner:s,cornerSides:a}=e.parameters,o=n===0&&s!==0?new VK(t*.5,s,a):new qY(t*.5,n);return o.scale(1,i/t,r/t),Object.assign(o,{userData:{...e,type:"DodecahedronGeometry"}})}},VK=class extends ik{constructor(e=1,t=.2,i=4){let r=(1+Math.sqrt(5))/2,n=1/r,s=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-r,0,-n,r,0,n,-r,0,n,r,-n,-r,0,-n,r,0,n,-r,0,n,r,0,-r,0,-n,r,0,-n,-r,0,n,r,0,n],a=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],o="DodecahedronGeometry";super(s,a,o,e,t,i),this.type=o}static fromJSON(e){return new VK(e.radius,e.corner,e.cornerSides)}},Ny=1e-12,rk=class{constructor(e){this.position=new ve,this.startPosition=new ve,this.uuid=Et.generateUUID(),this.position=e.clone()}start(){this.reset()}reset(){this.startPosition.copy(this.position)}applyOffset(e){this.position.copy(this.startPosition).add(e)}copy(e){return this.position.copy(e.position),this.startPosition.copy(e.startPosition),this}clone(){return new rk(this.position).copy(this)}toJSON(){return[this.position.x,this.position.y]}},GO=class extends rk{constructor(e){super(e.position),this.parent=e}copy(e){return super.copy(e),this}clone(){return new GO(this.parent).copy(this)}},Av=class extends rk{constructor(e,t){super(t),this.controls=[],this.roundness=0,this.areControlsDirectionsMirrored=!0,this.uuid=e,this.controls.push(new GO(this),new GO(this))}static create(e,t){let i=new Av(e,new ve(...t.position));return i.controls[0].position.set(...t.controlPrevious.position),i.controls[1].position.set(...t.controlNext.position),i.roundness=t.roundness,i.areControlsDirectionsMirrored=t.areControlsDirectionsMirrored,i}getOppositeControl(e){let t=this.controls.indexOf(e);return t===0?this.controls[1]:t===1?this.controls[0]:null}applyOffsetToControls(e,t=1){for(let i=0,r=this.controls.length;i<r;i++){let n=this.controls[i];this.position.distanceTo(n.position)<=t?n.position.copy(this.position):n.applyOffset(e)}}controlsMoved(){return!(this.position.equals(this.controls[0].position)&&this.position.equals(this.controls[1].position))}copy(e){return super.copy(e),this.controls[0].copy(e.controls[0]),this.controls[1].copy(e.controls[1]),this.roundness=e.roundness,this.uuid=e.uuid,this}clone(){return new Av(this.uuid,this.position).copy(this)}toJSON(){return super.toJSON().concat(this.controls[0].toJSON(),this.controls[1].toJSON(),[this.roundness])}computeTangents(){var i,r;let e=(i=this.curveBefore)==null?void 0:i.getTangentAt(1),t=(r=this.curveAfter)==null?void 0:r.getTangentAt(0);return[e,t]}computeNormals(e=new ve,t=new ve){let[i,r]=this.computeTangents();return i&&r&&(y6(i,e),y6(r,t)),[e,t]}computeTangent(e=new ve){let[t,i]=this.computeTangents();return t&&i&&e.copy(t).add(i).normalize(),e}computeNormal(e=new ve){let[t,i]=this.computeNormals();return e.copy(t).add(i).normalize(),e}};function y6(e,t=new ve){let i=e.length();return t.set(-e.y/i,e.x/i)}var nk=e=>e,z0=new ve,UT=new ve,K_e=new ve,Z_e=new ve,$_e=new ve,J_e=new ve,HK=new B,GK=new B;function eSe(e){let t=new ve;t.addVectors(e.v0,z0.subVectors(e.v1,e.v0).multiplyScalar(2/3));let i=new ve;return i.addVectors(e.v2,UT.subVectors(e.v1,e.v2).multiplyScalar(2/3)),new Rl(e.v0,t,i,e.v2)}function Sx(e,t,i=Number.EPSILON){return Math.abs(e-t)<i}function tSe(e,t,i=Number.EPSILON){return e.distanceTo(t)<i}function iSe(e,t,i=Number.EPSILON){return e.distanceTo(t)<i}function jK(e,t,i){let r=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),n=Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)),s=Math.sqrt(Math.pow(i.x-e.x,2)+Math.pow(i.y-e.y,2));return Math.acos((n*n+r*r-s*s)/(2*n*r))}function rSe(e,t,i){return w6(e,t)&&w6(t,i)&&jO(e.position,t.position,i.position)}function jO(e,t,i){return z0.copy(t).sub(e).cross(UT.copy(i).sub(e))===0}function nSe(e,t,i,r,n){let s=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),a=(e.y+t.y)/2,o=(e.x+t.x)/2,l=Math.sqrt(Math.pow(i,2)-Math.pow(s/2,2))*(e.y-t.y)/s,c=Math.sqrt(Math.pow(i,2)-Math.pow(s/2,2))*(t.x-e.x)/s;return r.set(o+l,a+c),n.set(o-l,a-c),[r,n]}function sSe(e,t,i){let r=e.distanceTo(i),n=t.distanceTo(i);return r<n?t:e}function aSe(e,t,i,r,n,s){let a=t.x-e.x,o=t.y-e.y,l=i.x-e.x,c=i.y-e.y,u=Math.sqrt((a+l)*(a+l)+(o+c)*(o+c)),h;return jK(t,e,i)>Math.PI&&(u*=-1),Sx(c,o)?h=(o+c)*(r/u-.5)*8/3/(a-l):h=(a+l)*(r/u-.5)*8/3/(c-o),n.set(t.x-h*o,t.y+h*a),s.set(i.x+h*c,i.y-h*l),[n,s]}function x6(e,t){return e.position.equals(e.controls[1].position)&&t.position.equals(t.controls[0].position)}function w6(e,t){return jO(e.position,e.controls[1].position,t.position)&&jO(e.position,t.controls[0].position,t.position)}function oSe(e,t,i,r,n=.5){let s=z0.subVectors(t,e).multiplyScalar(n).add(e),a=UT.subVectors(i,t).multiplyScalar(n).add(t),o=K_e.subVectors(r,i).multiplyScalar(n).add(i),l=s,c=Z_e.subVectors(a,s).multiplyScalar(n).add(s),u=$_e.subVectors(o,a).multiplyScalar(n).add(a),h=o,d=J_e.subVectors(u,c).multiplyScalar(n).add(c);return[e.x,e.y,l.x,l.y,c.x,c.y,d.x,d.y,u.x,u.y,h.x,h.y,r.x,r.y]}function lSe(e,t,i=12,r=!0){let n=GK.set(0,0,0),s,a=0;for(let o=0;o<t.length;o++){let l=nk(t[o]),c=z0,u=Tf(l,i);for(let h=0;h<=u;h++)if(l instanceof Rl||l instanceof Xd||l instanceof Bl){if(l.getPoint(h/u,c),n.set(c.x,c.y,0),s!==void 0&&iSe(s,n))continue;s===void 0&&(s=HK),s.copy(n),e.setXYZ(a,n.x,n.y,n.z),a++}}return r&&a>1&&!(e.getX(a-1)===e.getX(0)&&e.getY(a-1)===e.getY(0)&&e.getZ(a-1)===e.getZ(0))&&(e.setXYZ(a,e.getX(0),e.getY(0),e.getZ(0)),a++),e}function cSe(e,t,i,r=12,n=!0){let s=GK.set(0,0,0),a=0,o=[];for(let l=0;l<t.length;l++){if(i[l]===!1)continue;let c,u=nk(t[l]),h=z0,d=Tf(u,r);o.push(d);for(let p=0;p<=d;p++)if(u instanceof Rl||u instanceof Xd||u instanceof Bl){if(u.getPoint(p/d,h),s.set(h.x,h.y,0),c==null?void 0:c.equals(s))continue;c===void 0?c=HK:(e.setXYZ(a,c.x,c.y,c.z),a++,e.setXYZ(a,s.x,s.y,s.z),a++),c.copy(s)}}return n&&a>1&&!(e.getX(a-1)===e.getX(0)&&e.getY(a-1)===e.getY(0)&&e.getZ(a-1)===e.getZ(0))&&(e.setXYZ(a,e.getX(0),e.getY(0),e.getZ(0)),a++),o}function b6(e,t=12,i=!1){let r=[];for(let n=0,s=e.length;n<s;n++){let a=e[n],o=0;if(i&&a.roundedCurveCorner!==void 0){let l=Tf(a.roundedCurveCorner,t)*.5;n>0&&(r[n-1]+=l),o+=l}a.curveAfter!==void 0&&(o+=Tf(a.curveAfter,t)),r.push(o)}return e.length>0&&i&&e[0].roundedCurveCorner!==void 0&&(r[e.length-1]+=Tf(e[0].roundedCurveCorner,t)*.5),r}function Tf(e,t=12){return e&&e instanceof MT?t*2:e&&(e instanceof Bl||e instanceof jY)?1:e&&e instanceof yB?t*e.points.length:t}function uSe(e,t,i=12,r=!0){let n,s=0;for(let a=0;a<t.length;a++){let o=nk(t[a]),l=Tf(o,i),c=z0;for(let u=0;u<=l;u++)if(o instanceof Rl||o instanceof Xd||o instanceof Bl){if(o.getPoint(u/l,c),n!==void 0&&tSe(n,c,Ny))continue;n===void 0&&(n=UT),n.copy(c),e.push(c.x,c.y),s++}}return Sx(e[0],e[e.length-2],Ny)&&Sx(e[1],e[e.length-1],Ny)&&(e.pop(),e.pop()),r&&s>1&&!(Sx(e[s-1],e[1],Ny)&&Sx(e[s-2],e[0],Ny))&&(e.push(e[0],e[1]),s++),e}var M3=new ve,hSe=new ve,dSe=new ve,pSe=new ve,fSe=new ve,mSe=new ve,Zr=class extends _A{constructor(e=100,t=100){super(),this.points=[],this.shapeHoles=[],this.plane=new Ia(new B(0,0,-1)),this.subdivision=0,this.controlSnapDistance=4,this.pointIDs=0,this.isMesh2D=!1,this.isText=!1,this._roundness=0,this.isClosed=!1,this.useCubicForRoundedCorners=!0,this.uuid=Et.generateUUID(),this.needsUpdate=!1,this.roundedCurves=[],this._width=e,this._height=t}static createFromState(e,t,i){let r=new Zr;return r.isClosed=e.isClosed,r.points=e.points.map(n=>Av.create(n.id,n.data)),typeof e.roundness=="number"&&(r.roundness=e.roundness),r.shapeHoles=e.shapeHoles.map(n=>Zr.createFromState(n)),t!==void 0&&i!==void 0&&r.applySize(t,i),r.update(),r}get width(){return this._width}get height(){return this._height}get roundness(){return this._roundness}set roundness(e){if(this._roundness!==e){this._roundness=e;for(let t=0,i=this.points.length;t<i;t++)this.points[t].roundness=e;this.needsUpdate=!0}}getPointsIndexesByIds(e){return e.map(t=>this.getPointIndexById(t)).filter(t=>t>=0)}getPointIndexById(e){let t=this.points.length,i=this.points.findIndex(r=>r.uuid===e);if(i<0){let r=t;for(let n=0,s=this.shapeHoles.length;n<s;n++){let a=this.shapeHoles[n],o=a.points.length,l=a.getPointIndexById(e);if(l<0)r+=o;else return l+r}}return i}getLineIndexById(e){return this.getPointIndexById(e)}getBezierPoint(e){if(e<=this.points.length-1)return this.points[e];if(this.shapeHoles.length>0){let t=this.points.length;for(let i=0,r=this.shapeHoles.length;i<r;i++){let n=this.shapeHoles[i],s=e-t;if(s<=n.points.length-1)return n.points[s];t+=n.points.length}}throw new Error("This shape does not have a point for this index: "+e)}getBezierPointIndex(e){let t=this.points.indexOf(e);if(t>=0)return t;if(t=this.points.length,this.shapeHoles.length>0)for(let i=0,r=this.shapeHoles.length;i<r;i++){let n=this.shapeHoles[i],s=n.points.indexOf(e);if(s>=0)return t+s;t+=n.points.length}return-1}getAllPoints(){let e=[].concat(...this.shapeHoles.map(t=>t.points));return[...this.points,...e]}applySize(e,t){e===0&&(e=.001),t===0&&(t=.001),this._width=e,this._height=t}applyScale(e,t){let i=M3.set(e,t);for(let r=0,n=this.points.length;r<n;r++){let s=this.points[r];s.position.multiply(i),s.controls[0].position.multiply(i),s.controls[1].position.multiply(i)}for(let r=0,n=this.shapeHoles.length;r<n;r++)this.shapeHoles[r].applyScale(e,t);this._update()}createPoint(e,t=0,i=Et.generateUUID()){let r;e instanceof ve?r=e:r=new ve(e,t);let n=new Av(i,r);return n.roundness=this.roundness,n}addPoint(e){this.points.push(e),this.needsUpdate=!0}addPointAt(e,t){this.points.splice(t,0,e),this.needsUpdate=!0}getPointByUuid(e){for(let t=0,i=this.points.length;t<i;t++){let r=this.points[t];if(r.uuid===e)return r}for(let t=0,i=this.shapeHoles.length;t<i;t++){let r=this.shapeHoles[t].getPointByUuid(e);if(r)return r}}getFirstPoint(){return this.points[0]}getLastPoint(){return this.points[this.points.length-1]}removePoint(e){let t=this.points.indexOf(e);t>=0&&this.points.splice(t,1),this.needsUpdate=!0}removePointById(e){let t=this.points.find(i=>i.uuid===e);t&&this.removePoint(t)}update(){for(let e=0,t=this.shapeHoles.length;e<t;e++)this.shapeHoles[e].update();this._update()}extractShapePointsToBuffer(e,t=12,i=!1){this.subdivision=t,this.curveDivisions===void 0&&this.computeCurveDivisions(t);let r=i?this.roundedCurveDivisions:this.curveDivisions;return lSe(e,i?this.roundedCurves:this.curves,t,this.autoClose),r.reduce((n,s)=>n+s,0)+1}computeCurveDivisions(e=12){return this.curveDivisions=b6(this.points,e,!1),this.roundedCurveDivisions=b6(this.points,e,!0),this.curveDivisions}extractFilteredShapePointsToBuffer(e,t,i=12){return cSe(e,this.curves,t,i,this.autoClose).reduce((r,n)=>r+n,0)*2}extractShapePointsToFlatArray(e,t=12){return this.subdivision=t,this.curveDivisions===void 0&&this.computeCurveDivisions(t),uSe(e,this.roundedCurves,t,this.autoClose)}getCurveIndexFromVertexId(e,t=!1){let i=0;this.curveDivisions===void 0&&this.computeCurveDivisions(this.subdivision);let r=t?this.roundedCurveDivisions:this.curveDivisions,n=0;t&&this.points[0].roundedCurveCorner!==void 0&&(n=Tf(this.points[0].roundedCurveCorner,this.subdivision)*.5);let s=e-n;s<0&&(s+=r.reduce((a,o)=>a+o,0));for(let a=0,o=r.length;a<o;a++){let l=r[a];if(s<i+l)return[a,(s-i+1)/l];i+=l}return[0,1]}getCurveT(e,t,i){let r=this.points[e],n=this.points[e>=this.points.length-1?0:e+1],s=this.curveDivisions,a=s[e];if(x6(r,n)){let l=r.position.distanceTo(n.position);return r.position.distanceTo(M3.set(i.x,i.y))/l}let o=0;for(let l=0;l<e;l++)o+=s[l];return(t-o)/a}dispose(){}_applyCurveForPoint(e,t){x6(t,e)?this.lineTo(e.position.x,e.position.y):this.bezierCurveTo(t.controls[1].position.x,t.controls[1].position.y,e.controls[0].position.x,e.controls[0].position.y,e.position.x,e.position.y);let i=this.curves[this.curves.length-1];e.curveBefore=i,t.curveAfter=i;let r=i.clone();e.roundedCurveBefore=r,t.roundedCurveAfter=r,e.roundedCurveCorner=void 0,this.roundedCurves.push(r)}_update(){if(this.curves=[],this.roundedCurves=[],!this.points.length)return;for(let t=0,i=this.points.length;t<i;t++){let r=this.points[t];if(t===0)this.moveTo(r.position.x,r.position.y);else{let n=this.points[t-1];this._applyCurveForPoint(r,n)}}let e=this.getLastPoint();if(e!=null&&e.curveAfter&&(e.curveAfter=void 0),this.isClosed){let t=this.points[0],i=this.points[this.points.length-1];this._applyCurveForPoint(t,i)}if(this.points.length>2){let t=0;for(let i=0,r=this.points.length;i<r;i++){let n=this.points[i],s=this.points[i-1]??this.points[this.points.length-1],a=this.points[i+1]??this.points[0],o=n.roundness,l=s&&a&&rSe(s,n,a);if(!n.controlsMoved()&&o>0&&!l){let c=n.curveBefore,u=n.curveAfter;if(c===void 0||u===void 0)continue;let h=n.roundedCurveBefore,d=n.roundedCurveAfter,p=c.getLength(),f=u.getLength(),v=Math.min(o,p*.499),g=Math.min(o,f*.499),m=Math.min(v,g),x=1-m/p,w=m/f,_=c.getPointAt(x,M3),M=u.getPointAt(w,hSe);this._subSplitCurve(c,h,x,_,void 0),this._subSplitCurve(u,d,w,void 0,M);let S;if(this.useCubicForRoundedCorners){let A=jK(_,n.position,M)/2,T=Math.tan(A)*_.distanceTo(n.position),[E,C]=nSe(_,M,T,dSe,pSe),D=sSe(E,C,n.position),[I,L]=aSe(D,_,M,T,fSe,mSe);S=new Rl(_.clone(),I.clone(),L.clone(),M.clone())}else S=new Xd(_.clone(),n.position.clone(),M.clone());n.roundedCurveCorner=S,this.roundedCurves.splice(i+t,0,S),t++}}}}_subSplitCurve(e,t,i,r,n){if(e instanceof Bl)r!==void 0&&t.v2.copy(r),n!==void 0&&t.v1.copy(n);else{let s=e,a=t,o=s.getUtoTmapping(i,0),l=oSe(s.v0,s.v1,s.v2,s.v3,o);return r!==void 0&&(a.v0.set(l[0],l[1]),a.v1.set(l[2],l[3]),a.v2.set(l[4],l[5]),a.v3.set(l[6],l[7])),n!==void 0&&(a.v0.set(l[6],l[7]),a.v1.set(l[8],l[9]),a.v2.set(l[10],l[11]),a.v3.set(l[12],l[13])),a}return t}clone(){let e=new Zr(this._width,this._height);return e.points=this.points.map(t=>t.clone()),e.isClosed=this.isClosed,e.roundness=this.roundness,e.isMesh2D=this.isMesh2D,e.shapeHoles=this.shapeHoles.map(t=>t.clone()),e}toJSON(){return{points:this.points.reduce((e,t)=>e.concat(t.toJSON()),[]),shapeHoles:this.shapeHoles.map(e=>e.toJSON()),isClosed:this.isClosed,roundness:this.roundness}}fromJSON(e){var i;this.points=[],this.pointIDs=0;let t=e.points.length/7;for(let r=0;r<t;r++){let n=r*7,s=e.points[n+0],a=e.points[n+1],o=e.points[n+2],l=e.points[n+3],c=e.points[n+4],u=e.points[n+5],h=e.points[n+6],d=new Av(Et.generateUUID(),new ve(s,a));d.controls[0].position.set(o,l),d.controls[1].position.set(c,u),d.roundness=h,this.points.push(d)}return this.shapeHoles=(i=e.shapeHoles)!=null&&i.length?e.shapeHoles.map(r=>{let n=new Zr;return n.fromJSON(r),n}):[],this.isClosed=e.isClosed,this._roundness=e.roundness,this._update(),this}fromShape(e,t=!1){this.isText=t;let i=(n,s)=>{s instanceof Rl&&s.v3.equals(n.position)&&n.controls[0].position.copy(s.v2)},r=n=>{let s=[],a,o;for(a=0,o=n.length;a<o;a++)n[a]instanceof Xd&&(n[a]=eSe(n[a]));for(a=0,o=n.length;a<o;a++){let u=n[a],h=a>0?n[a-1]:null,d;u instanceof Rl?(d=this.createPoint(u.v0),d.controls[1].position.copy(u.v1)):u instanceof Bl&&(d=this.createPoint(u.v1)),d!==void 0&&(h!==null&&i(d,h),s.push(d))}let l=n[n.length-1],c=!1;return l instanceof Rl?l.v3.equals(s[0].position)&&(s[0].controls[0].position.copy(l.v2),c=!0):l instanceof Bl&&l.v2.equals(s[0].position)&&(c=!0),this.isClosed=c,s};return this.points=r(e.curves),e instanceof _A&&(this.shapeHoles=e.holes.map(n=>{let s=new Zr;return s.fromShape(n),s})),this.update(),this}updatePoint(e,t){let i=this.getPointByUuid(e);i&&(t.position!==void 0&&i.position.fromArray(t.position),t.roundness!==void 0&&(i.roundness=t.roundness),t.areControlsDirectionsMirrored!==void 0&&(i.areControlsDirectionsMirrored=t.areControlsDirectionsMirrored),this.needsUpdate=!0)}updatePreviousControl(e,t){var r;let i=(r=this.getPointByUuid(e))==null?void 0:r.controls[0];i&&(t.position&&i.position.fromArray(t.position),this.needsUpdate=!0)}updateNextControl(e,t){var r;let i=(r=this.getPointByUuid(e))==null?void 0:r.controls[1];i&&(t.position&&i.position.fromArray(t.position),this.needsUpdate=!0)}},WO=Math.PI*2;function E3({x:e,y:t},i,r,n,s){return{x:e*i+n,y:t*r+s}}function gSe(e,t){let i=t===1.5707963267948966?.551915024494:t===-1.5707963267948966?-.551915024494:1.3333333333333333*Math.tan(t/4),r=Math.cos(e),n=Math.sin(e),s=Math.cos(e+t),a=Math.sin(e+t);return[{x:r-n*i,y:n+r*i},{x:s+a*i,y:a-s*i},{x:s,y:a}]}function _6(e,t,i,r){let n=e*r-t*i<0?-1:1,s=Math.min(1,Math.max(-1,e*i+t*r));return n*Math.acos(s)}function vSe(e,t,i,r,n,s,a,o,l,c){let u=Math.pow(n,2),h=Math.pow(s,2),d=Math.pow(a,2),p=Math.pow(o,2),f=u*h-u*p-h*d;f<0&&(f=0),f/=u*p+h*d,f=Math.sqrt(f)*(l===c?-1:1);let v=f*n/s*o,g=f*-s/n*a,m=v+(e+i)/2,x=g+(t+r)/2,w=(a-v)/n,_=(o-g)/s,M=(-a-v)/n,S=(-o-g)/s,A=_6(1,0,w,_),T=_6(w,_,M,S);return!c&&T>0&&(T-=WO),c&&T<0&&(T+=WO),{centerx:m,centery:x,ang1:A,ang2:T}}function ySe({px:e,py:t,cx:i,cy:r,rx:n,ry:s,largeArcFlag:a,sweepFlag:o}){let l=[];if(n===0||s===0)return[];let c=(e-i)/2,u=(t-r)/2;if(c===0&&u===0)return[];n=Math.abs(n),s=Math.abs(s);let h=Math.pow(c,2)/Math.pow(n,2)+Math.pow(u,2)/Math.pow(s,2);h>1&&(n*=Math.sqrt(h),s*=Math.sqrt(h));let d=vSe(e,t,i,r,n,s,c,u,a,o),{ang1:p,ang2:f}=d,{centerx:v,centery:g}=d,m=Math.abs(f)/(WO/4);Math.abs(1-m)<1e-7&&(m=1);let x=Math.max(Math.ceil(m),1);f/=x;for(let w=0;w<x;w++)l.push(gSe(p,f)),p+=f;return l.map(w=>{let{x:_,y:M}=E3(w[0],n,s,v,g),{x:S,y:A}=E3(w[1],n,s,v,g),{x:T,y:E}=E3(w[2],n,s,v,g);return{x1:_,y1:M,x2:S,y2:A,x:T,y:E}})}var sr;(function(e){e[e.ODD=0]="ODD",e[e.NONZERO=1]="NONZERO",e[e.POSITIVE=2]="POSITIVE",e[e.NEGATIVE=3]="NEGATIVE",e[e.ABS_GEQ_TWO=4]="ABS_GEQ_TWO"})(sr||(sr={}));var bn;(function(e){e[e.POLYGONS=0]="POLYGONS",e[e.CONNECTED_POLYGONS=1]="CONNECTED_POLYGONS",e[e.BOUNDARY_CONTOURS=2]="BOUNDARY_CONTOURS"})(bn||(bn={}));function Kt(e,t){if(!e)throw t||"Assertion Failed!"}var Ht=function(){function e(){}return e.vertEq=function(t,i){return t.s===i.s&&t.t===i.t},e.vertLeq=function(t,i){return t.s<i.s||t.s===i.s&&t.t<=i.t},e.transLeq=function(t,i){return t.t<i.t||t.t===i.t&&t.s<=i.s},e.edgeGoesLeft=function(t){return e.vertLeq(t.Dst,t.Org)},e.edgeGoesRight=function(t){return e.vertLeq(t.Org,t.Dst)},e.vertL1dist=function(t,i){return Math.abs(t.s-i.s)+Math.abs(t.t-i.t)},e.edgeEval=function(t,i,r){Kt(e.vertLeq(t,i)&&e.vertLeq(i,r));var n=i.s-t.s,s=r.s-i.s;return n+s>0?n<s?i.t-t.t+(t.t-r.t)*(n/(n+s)):i.t-r.t+(r.t-t.t)*(s/(n+s)):0},e.edgeSign=function(t,i,r){Kt(e.vertLeq(t,i)&&e.vertLeq(i,r));var n=i.s-t.s,s=r.s-i.s;return n+s>0?(i.t-r.t)*n+(i.t-t.t)*s:0},e.transEval=function(t,i,r){Kt(e.transLeq(t,i)&&e.transLeq(i,r));var n=i.t-t.t,s=r.t-i.t;return n+s>0?n<s?i.s-t.s+(t.s-r.s)*(n/(n+s)):i.s-r.s+(r.s-t.s)*(s/(n+s)):0},e.transSign=function(t,i,r){Kt(e.transLeq(t,i)&&e.transLeq(i,r));var n=i.t-t.t,s=r.t-i.t;return n+s>0?(i.s-r.s)*n+(i.s-t.s)*s:0},e.vertCCW=function(t,i,r){return t.s*(i.t-r.t)+i.s*(r.t-t.t)+r.s*(t.t-i.t)>=0},e.interpolate=function(t,i,r,n){return t=t<0?0:t,r=r<0?0:r,t<=r?r===0?(i+n)/2:i+(n-i)*(t/(t+r)):n+(i-n)*(r/(t+r))},e.intersect=function(t,i,r,n,s){var a,o,l;e.vertLeq(t,i)||(l=t,t=i,i=l),e.vertLeq(r,n)||(l=r,r=n,n=l),e.vertLeq(t,r)||(l=t,t=r,r=l,l=i,i=n,n=l),e.vertLeq(r,i)?e.vertLeq(i,n)?(a=e.edgeEval(t,r,i),o=e.edgeEval(r,i,n),a+o<0&&(a=-a,o=-o),s.s=e.interpolate(a,r.s,o,i.s)):(a=e.edgeSign(t,r,i),o=-e.edgeSign(t,n,i),a+o<0&&(a=-a,o=-o),s.s=e.interpolate(a,r.s,o,n.s)):s.s=(r.s+i.s)/2,e.transLeq(t,i)||(l=t,t=i,i=l),e.transLeq(r,n)||(l=r,r=n,n=l),e.transLeq(t,r)||(l=t,t=r,r=l,l=i,i=n,n=l),e.transLeq(r,i)?e.transLeq(i,n)?(a=e.transEval(t,r,i),o=e.transEval(r,i,n),a+o<0&&(a=-a,o=-o),s.t=e.interpolate(a,r.t,o,i.t)):(a=e.transSign(t,r,i),o=-e.transSign(t,n,i),a+o<0&&(a=-a,o=-o),s.t=e.interpolate(a,r.t,o,n.t)):s.t=(r.t+i.t)/2},e}(),By=function(){function e(){this.next=null,this.prev=null,this.anEdge=null,this.trail=null,this.n=0,this.marked=!1,this.inside=!1}return e}(),fS=function(){function e(t){this.side=t,this.next=null,this.Org=null,this.Sym=null,this.Onext=null,this.Lnext=null,this.Lface=null,this.activeRegion=null,this.winding=0}return Object.defineProperty(e.prototype,"Rface",{get:function(){return this.Sym.Lface},set:function(t){this.Sym.Lface=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dst",{get:function(){return this.Sym.Org},set:function(t){this.Sym.Org=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Oprev",{get:function(){return this.Sym.Lnext},set:function(t){this.Sym.Lnext=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Lprev",{get:function(){return this.Onext.Sym},set:function(t){this.Onext.Sym=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dprev",{get:function(){return this.Lnext.Sym},set:function(t){this.Lnext.Sym=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Rprev",{get:function(){return this.Sym.Onext},set:function(t){this.Sym.Onext=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dnext",{get:function(){return this.Sym.Onext.Sym},set:function(t){this.Sym.Onext.Sym=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Rnext",{get:function(){return this.Sym.Lnext.Sym},set:function(t){this.Sym.Lnext.Sym=t},enumerable:!0,configurable:!0}),e}(),Ng=function(){function e(){this.next=null,this.prev=null,this.anEdge=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=0,this.n=0,this.idx=0}return e}(),S6=function(){function e(){var t=new Ng,i=new By,r=new fS(0),n=new fS(1);t.next=t.prev=t,t.anEdge=null,i.next=i.prev=i,r.next=r,r.Sym=n,n.next=n,n.Sym=r,this.vHead=t,this.fHead=i,this.eHead=r,this.eHeadSym=n}return e.prototype.makeEdge_=function(t){var i=new fS(0),r=new fS(1);t.Sym.side<t.side&&(t=t.Sym);var n=t.Sym.next;return r.next=n,n.Sym.next=i,i.next=t,t.Sym.next=r,i.Sym=r,i.Onext=i,i.Lnext=r,i.Org=null,i.Lface=null,i.winding=0,i.activeRegion=null,r.Sym=i,r.Onext=r,r.Lnext=i,r.Org=null,r.Lface=null,r.winding=0,r.activeRegion=null,i},e.prototype.splice_=function(t,i){var r=t.Onext,n=i.Onext;r.Sym.Lnext=i,n.Sym.Lnext=t,t.Onext=n,i.Onext=r},e.prototype.makeVertex_=function(t,i,r){var n=t;Kt(n,"Vertex can't be null!");var s=r.prev;n.prev=s,s.next=n,n.next=r,r.prev=n,n.anEdge=i;var a=i;do a.Org=n,a=a.Onext;while(a!==i)},e.prototype.makeFace_=function(t,i,r){var n=t;Kt(n,"Face can't be null");var s=r.prev;n.prev=s,s.next=n,n.next=r,r.prev=n,n.anEdge=i,n.trail=null,n.marked=!1,n.inside=r.inside;var a=i;do a.Lface=n,a=a.Lnext;while(a!==i)},e.prototype.killEdge_=function(t){t.Sym.side<t.side&&(t=t.Sym);var i=t.next,r=t.Sym.next;i.Sym.next=r,r.Sym.next=i},e.prototype.killVertex_=function(t,i){var r=t.anEdge,n=r;do n.Org=i,n=n.Onext;while(n!==r);var s=t.prev,a=t.next;a.prev=s,s.next=a},e.prototype.killFace_=function(t,i){var r=t.anEdge,n=r;do n.Lface=i,n=n.Lnext;while(n!==r);var s=t.prev,a=t.next;a.prev=s,s.next=a},e.prototype.makeEdge=function(){var t=new Ng,i=new Ng,r=new By,n=this.makeEdge_(this.eHead);return this.makeVertex_(t,n,this.vHead),this.makeVertex_(i,n.Sym,this.vHead),this.makeFace_(r,n,this.fHead),n},e.prototype.splice=function(t,i){var r=!1,n=!1;if(t!==i){if(i.Org!==t.Org&&(n=!0,this.killVertex_(i.Org,t.Org)),i.Lface!==t.Lface&&(r=!0,this.killFace_(i.Lface,t.Lface)),this.splice_(i,t),!n){var s=new Ng;this.makeVertex_(s,i,t.Org),t.Org.anEdge=t}if(!r){var a=new By;this.makeFace_(a,i,t.Lface),t.Lface.anEdge=t}}},e.prototype.delete=function(t){var i=t.Sym,r=!1;if(t.Lface!==t.Rface&&(r=!0,this.killFace_(t.Lface,t.Rface)),t.Onext===t)this.killVertex_(t.Org,null);else if(t.Rface.anEdge=t.Oprev,t.Org.anEdge=t.Onext,this.splice_(t,t.Oprev),!r){var n=new By;this.makeFace_(n,t,t.Lface)}i.Onext===i?(this.killVertex_(i.Org,null),this.killFace_(i.Lface,null)):(t.Lface.anEdge=i.Oprev,i.Org.anEdge=i.Onext,this.splice_(i,i.Oprev)),this.killEdge_(t)},e.prototype.addEdgeVertex=function(t){var i=this.makeEdge_(t),r=i.Sym;this.splice_(i,t.Lnext),i.Org=t.Dst;var n=new Ng;return this.makeVertex_(n,r,i.Org),i.Lface=r.Lface=t.Lface,i},e.prototype.splitEdge=function(t){var i=this.addEdgeVertex(t),r=i.Sym;return this.splice_(t.Sym,t.Sym.Oprev),this.splice_(t.Sym,r),t.Dst=r.Org,r.Dst.anEdge=r.Sym,r.Rface=t.Rface,r.winding=t.winding,r.Sym.winding=t.Sym.winding,r.idx=t.idx,r.Sym.idx=t.Sym.idx,r},e.prototype.connect=function(t,i){var r=!1,n=this.makeEdge_(t),s=n.Sym;if(i.Lface!==t.Lface&&(r=!0,this.killFace_(i.Lface,t.Lface)),this.splice_(n,t.Lnext),this.splice_(s,i),n.Org=t.Dst,s.Org=i.Org,n.Lface=s.Lface=t.Lface,t.Lface.anEdge=s,!r){var a=new By;this.makeFace_(a,n,t.Lface)}return n},e.prototype.zapFace=function(t){var i=t.anEdge,r,n,s,a,o;n=i.Lnext;do r=n,n=r.Lnext,r.Lface=null,r.Rface===null&&(r.Onext===r?this.killVertex_(r.Org,null):(r.Org.anEdge=r.Onext,this.splice_(r,r.Oprev)),s=r.Sym,s.Onext===s?this.killVertex_(s.Org,null):(s.Org.anEdge=s.Onext,this.splice_(s,s.Oprev)),this.killEdge_(r));while(r!=i);a=t.prev,o=t.next,o.prev=a,a.next=o},e.prototype.countFaceVerts_=function(t){var i=t.anEdge,r=0;do r++,i=i.Lnext;while(i!==t.anEdge);return r},e.prototype.mergeConvexFaces=function(t){var i,r,n,s,a,o,l;for(i=this.fHead.next;i!==this.fHead;i=i.next)if(i.inside)for(r=i.anEdge,a=r.Org;n=r.Lnext,s=r.Sym,s&&s.Lface&&s.Lface.inside&&(o=this.countFaceVerts_(i),l=this.countFaceVerts_(s.Lface),o+l-2<=t&&Ht.vertCCW(r.Lprev.Org,r.Org,s.Lnext.Lnext.Org)&&Ht.vertCCW(s.Lprev.Org,s.Org,r.Lnext.Lnext.Org)&&(n=s.Lnext,this.delete(s),r=null,s=null)),!(r&&r.Lnext.Org===a);)r=n;return!0},e.prototype.check=function(){var t=this.fHead,i=this.vHead,r=this.eHead,n,s,a,o,l,c;for(s=t,s=t;(n=s.next)!==t;s=n){Kt(n.prev===s),l=n.anEdge;do Kt(l.Sym!==l),Kt(l.Sym.Sym===l),Kt(l.Lnext.Onext.Sym===l),Kt(l.Onext.Sym.Lnext===l),Kt(l.Lface===n),l=l.Lnext;while(l!==n.anEdge)}for(Kt(n.prev===s&&n.anEdge===null),o=i,o=i;(a=o.next)!==i;o=a){Kt(a.prev===o),l=a.anEdge;do Kt(l.Sym!==l),Kt(l.Sym.Sym===l),Kt(l.Lnext.Onext.Sym===l),Kt(l.Onext.Sym.Lnext===l),Kt(l.Org===a),l=l.Onext;while(l!==a.anEdge)}for(Kt(a.prev===o&&a.anEdge===null),c=r,c=r;(l=c.next)!==r;c=l)Kt(l.Sym.next===c.Sym),Kt(l.Sym!==l),Kt(l.Sym.Sym===l),Kt(l.Org!==null),Kt(l.Dst!==null),Kt(l.Lnext.Onext.Sym===l),Kt(l.Onext.Sym.Lnext===l);Kt(l.Sym.next===c.Sym&&l.Sym===this.eHeadSym&&l.Sym.Sym===l&&l.Org===null&&l.Dst===null&&l.Lface===null&&l.Rface===null)},e}(),M6=function(){function e(){this.handle=null}return e}(),E6=function(){function e(){this.key=null,this.node=0}return e}(),xSe=function(){function e(t,i){this.leq=i,this.max=0,this.nodes=[],this.handles=[],this.initialized=!1,this.freeList=0,this.size=0,this.max=t,this.nodes=[],this.handles=[];for(var r=0;r<t+1;r++)this.nodes[r]=new M6,this.handles[r]=new E6;this.initialized=!1,this.nodes[1].handle=1,this.handles[1].key=null}return e.prototype.floatDown_=function(t){var i=this.nodes,r=this.handles,n,s,a;for(n=i[t].handle;;){if(a=t<<1,a<this.size&&this.leq(r[i[a+1].handle].key,r[i[a].handle].key)&&++a,Kt(a<=this.max),s=i[a].handle,a>this.size||this.leq(r[n].key,r[s].key)){i[t].handle=n,r[n].node=t;break}i[t].handle=s,r[s].node=t,t=a}},e.prototype.floatUp_=function(t){var i=this.nodes,r=this.handles,n,s,a;for(n=i[t].handle;;){if(a=t>>1,s=i[a].handle,a===0||this.leq(r[s].key,r[n].key)){i[t].handle=n,r[n].node=t;break}i[t].handle=s,r[s].node=t,t=a}},e.prototype.init=function(){for(var t=this.size;t>=1;--t)this.floatDown_(t);this.initialized=!0},e.prototype.min=function(){return this.handles[this.nodes[1].handle].key},e.prototype.insert=function(t){var i,r;if(i=++this.size,i*2>this.max){this.max*=2;var n,s;for(s=this.nodes.length,this.nodes.length=this.max+1,n=s;n<this.nodes.length;n++)this.nodes[n]=new M6;for(s=this.handles.length,this.handles.length=this.max+1,n=s;n<this.handles.length;n++)this.handles[n]=new E6}return this.freeList===0?r=i:(r=this.freeList,this.freeList=this.handles[r].node),this.nodes[i].handle=r,this.handles[r].node=i,this.handles[r].key=t,this.initialized&&this.floatUp_(i),r},e.prototype.extractMin=function(){var t=this.nodes,i=this.handles,r=t[1].handle,n=i[r].key;return this.size>0&&(t[1].handle=t[this.size].handle,i[t[1].handle].node=1,i[r].key=null,i[r].node=this.freeList,this.freeList=r,--this.size,this.size>0&&this.floatDown_(1)),n},e.prototype.delete=function(t){var i=this.nodes,r=this.handles,n;Kt(t>=1&&t<=this.max&&r[t].key!==null),n=r[t].node,i[n].handle=i[this.size].handle,r[i[n].handle].node=n,--this.size,n<=this.size&&(n<=1||this.leq(r[i[n>>1].handle].key,r[i[n].handle].key)?this.floatDown_(n):this.floatUp_(n)),r[t].key=null,r[t].node=this.freeList,this.freeList=t},e}(),A3=function(){function e(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1}return e}(),A6=function(){function e(){this.key=null,this.next=null,this.prev=null}return e}(),wSe=function(){function e(t,i){this.frame=t,this.leq=i,this.head=new A6,this.head.next=this.head,this.head.prev=this.head}return e.prototype.min=function(){return this.head.next},e.prototype.max=function(){return this.head.prev},e.prototype.insert=function(t){return this.insertBefore(this.head,t)},e.prototype.search=function(t){var i=this.head;do i=i.next;while(i.key!==null&&!this.leq(this.frame,t,i.key));return i},e.prototype.insertBefore=function(t,i){do t=t.prev;while(t.key!==null&&!this.leq(this.frame,t.key,i));var r=new A6;return r.key=i,r.next=t.next,t.next.prev=r,r.prev=t,t.next=r,r},e.prototype.delete=function(t){t.next.prev=t.prev,t.prev.next=t.next},e}(),bSe=function(){function e(){}return e.regionBelow=function(t){return t.nodeUp.prev.key},e.regionAbove=function(t){return t.nodeUp.next.key},e.debugEvent=function(t){},e.addWinding=function(t,i){t.winding+=i.winding,t.Sym.winding+=i.Sym.winding},e.edgeLeq=function(t,i,r){var n=t.event,s=i.eUp,a=r.eUp;if(s.Dst===n)return a.Dst===n?Ht.vertLeq(s.Org,a.Org)?Ht.edgeSign(a.Dst,s.Org,a.Org)<=0:Ht.edgeSign(s.Dst,a.Org,s.Org)>=0:Ht.edgeSign(a.Dst,n,a.Org)<=0;if(a.Dst===n)return Ht.edgeSign(s.Dst,n,s.Org)>=0;var o=Ht.edgeEval(s.Dst,n,s.Org),l=Ht.edgeEval(a.Dst,n,a.Org);return o>=l},e.deleteRegion=function(t,i){i.fixUpperEdge&&Kt(i.eUp.winding===0),i.eUp.activeRegion=null,t.dict.delete(i.nodeUp)},e.fixUpperEdge=function(t,i,r){Kt(i.fixUpperEdge),t.mesh.delete(i.eUp),i.fixUpperEdge=!1,i.eUp=r,r.activeRegion=i},e.topLeftRegion=function(t,i){var r=i.eUp.Org,n;do i=e.regionAbove(i);while(i.eUp.Org===r);if(i.fixUpperEdge){if(n=t.mesh.connect(e.regionBelow(i).eUp.Sym,i.eUp.Lnext),n===null)return null;e.fixUpperEdge(t,i,n),i=e.regionAbove(i)}return i},e.topRightRegion=function(t){var i=t.eUp.Dst;do t=e.regionAbove(t);while(t.eUp.Dst===i);return t},e.addRegionBelow=function(t,i,r){var n=new A3;return n.eUp=r,n.nodeUp=t.dict.insertBefore(i.nodeUp,n),n.fixUpperEdge=!1,n.sentinel=!1,n.dirty=!1,r.activeRegion=n,n},e.isWindingInside=function(t,i){switch(t.windingRule){case sr.ODD:return(i&1)!==0;case sr.NONZERO:return i!==0;case sr.POSITIVE:return i>0;case sr.NEGATIVE:return i<0;case sr.ABS_GEQ_TWO:return i>=2||i<=-2}throw new Error("Invalid winding rulle")},e.computeWinding=function(t,i){i.windingNumber=e.regionAbove(i).windingNumber+i.eUp.winding,i.inside=e.isWindingInside(t,i.windingNumber)},e.finishRegion=function(t,i){var r=i.eUp,n=r.Lface;n.inside=i.inside,n.anEdge=r,e.deleteRegion(t,i)},e.finishLeftRegions=function(t,i,r){for(var n,s=null,a=i,o=i.eUp;a!==r;){if(a.fixUpperEdge=!1,s=e.regionBelow(a),n=s.eUp,n.Org!=o.Org){if(!s.fixUpperEdge){e.finishRegion(t,a);break}n=t.mesh.connect(o.Lprev,n.Sym),e.fixUpperEdge(t,s,n)}o.Onext!==n&&(t.mesh.splice(n.Oprev,n),t.mesh.splice(o,n)),e.finishRegion(t,a),o=s.eUp,a=s}return o},e.addRightEdges=function(t,i,r,n,s,a){var o,l,c,u,h=!0;c=r;do Kt(Ht.vertLeq(c.Org,c.Dst)),e.addRegionBelow(t,i,c.Sym),c=c.Onext;while(c!==n);for(s===null&&(s=e.regionBelow(i).eUp.Rprev),l=i,u=s;o=e.regionBelow(l),c=o.eUp.Sym,c.Org===u.Org;)c.Onext!==u&&(t.mesh.splice(c.Oprev,c),t.mesh.splice(u.Oprev,c)),o.windingNumber=l.windingNumber-c.winding,o.inside=e.isWindingInside(t,o.windingNumber),l.dirty=!0,!h&&e.checkForRightSplice(t,l)&&(e.addWinding(c,u),e.deleteRegion(t,l),t.mesh.delete(u)),h=!1,l=o,u=c;l.dirty=!0,Kt(l.windingNumber-c.winding===o.windingNumber),a&&e.walkDirtyRegions(t,l)},e.spliceMergeVertices=function(t,i,r){t.mesh.splice(i,r)},e.vertexWeights=function(t,i,r){var n=Ht.vertL1dist(i,t),s=Ht.vertL1dist(r,t),a=.5*s/(n+s),o=.5*n/(n+s);t.coords[0]+=a*i.coords[0]+o*r.coords[0],t.coords[1]+=a*i.coords[1]+o*r.coords[1],t.coords[2]+=a*i.coords[2]+o*r.coords[2]},e.getIntersectData=function(t,i,r,n,s,a){i.coords[0]=i.coords[1]=i.coords[2]=0,i.idx=-1,e.vertexWeights(i,r,n),e.vertexWeights(i,s,a)},e.checkForRightSplice=function(t,i){var r=e.regionBelow(i),n=i.eUp,s=r.eUp;if(Ht.vertLeq(n.Org,s.Org)){if(Ht.edgeSign(s.Dst,n.Org,s.Org)>0)return!1;Ht.vertEq(n.Org,s.Org)?n.Org!==s.Org&&(t.pq.delete(n.Org.pqHandle),e.spliceMergeVertices(t,s.Oprev,n)):(t.mesh.splitEdge(s.Sym),t.mesh.splice(n,s.Oprev),i.dirty=r.dirty=!0)}else{if(Ht.edgeSign(n.Dst,s.Org,n.Org)<0)return!1;e.regionAbove(i).dirty=i.dirty=!0,t.mesh.splitEdge(n.Sym),t.mesh.splice(s.Oprev,n)}return!0},e.checkForLeftSplice=function(t,i){var r=e.regionBelow(i),n=i.eUp,s=r.eUp,a;if(Kt(!Ht.vertEq(n.Dst,s.Dst)),Ht.vertLeq(n.Dst,s.Dst)){if(Ht.edgeSign(n.Dst,s.Dst,n.Org)<0)return!1;e.regionAbove(i).dirty=i.dirty=!0,a=t.mesh.splitEdge(n),t.mesh.splice(s.Sym,a),a.Lface.inside=i.inside}else{if(Ht.edgeSign(s.Dst,n.Dst,s.Org)>0)return!1;i.dirty=r.dirty=!0,a=t.mesh.splitEdge(s),t.mesh.splice(n.Lnext,s.Sym),a.Rface.inside=i.inside}return!0},e.checkForIntersect=function(t,i){var r=e.regionBelow(i),n=i.eUp,s=r.eUp,a=n.Org,o=s.Org,l=n.Dst,c=s.Dst,u,h,d=new Ng,p,f;if(Kt(!Ht.vertEq(c,l)),Kt(Ht.edgeSign(l,t.event,a)<=0),Kt(Ht.edgeSign(c,t.event,o)>=0),Kt(a!==t.event&&o!==t.event),Kt(!i.fixUpperEdge&&!r.fixUpperEdge),a===o||(u=Math.min(a.t,l.t),h=Math.max(o.t,c.t),u>h))return!1;if(Ht.vertLeq(a,o)){if(Ht.edgeSign(c,a,o)>0)return!1}else if(Ht.edgeSign(l,o,a)<0)return!1;return e.debugEvent(t),Ht.intersect(l,a,c,o,d),Kt(Math.min(a.t,l.t)<=d.t),Kt(d.t<=Math.max(o.t,c.t)),Kt(Math.min(c.s,l.s)<=d.s),Kt(d.s<=Math.max(o.s,a.s)),Ht.vertLeq(d,t.event)&&(d.s=t.event.s,d.t=t.event.t),p=Ht.vertLeq(a,o)?a:o,Ht.vertLeq(p,d)&&(d.s=p.s,d.t=p.t),Ht.vertEq(d,a)||Ht.vertEq(d,o)?(e.checkForRightSplice(t,i),!1):!Ht.vertEq(l,t.event)&&Ht.edgeSign(l,t.event,d)>=0||!Ht.vertEq(c,t.event)&&Ht.edgeSign(c,t.event,d)<=0?c===t.event?(t.mesh.splitEdge(n.Sym),t.mesh.splice(s.Sym,n),i=e.topLeftRegion(t,i),n=e.regionBelow(i).eUp,e.finishLeftRegions(t,e.regionBelow(i),r),e.addRightEdges(t,i,n.Oprev,n,n,!0),!0):l===t.event?(t.mesh.splitEdge(s.Sym),t.mesh.splice(n.Lnext,s.Oprev),r=i,i=e.topRightRegion(i),f=e.regionBelow(i).eUp.Rprev,r.eUp=s.Oprev,s=e.finishLeftRegions(t,r,null),e.addRightEdges(t,i,s.Onext,n.Rprev,f,!0),!0):(Ht.edgeSign(l,t.event,d)>=0&&(e.regionAbove(i).dirty=i.dirty=!0,t.mesh.splitEdge(n.Sym),n.Org.s=t.event.s,n.Org.t=t.event.t),Ht.edgeSign(c,t.event,d)<=0&&(i.dirty=r.dirty=!0,t.mesh.splitEdge(s.Sym),s.Org.s=t.event.s,s.Org.t=t.event.t),!1):(t.mesh.splitEdge(n.Sym),t.mesh.splitEdge(s.Sym),t.mesh.splice(s.Oprev,n),n.Org.s=d.s,n.Org.t=d.t,n.Org.pqHandle=t.pq.insert(n.Org),e.getIntersectData(t,n.Org,a,l,o,c),e.regionAbove(i).dirty=i.dirty=r.dirty=!0,!1)},e.walkDirtyRegions=function(t,i){for(var r=e.regionBelow(i),n,s;;){for(;r.dirty;)i=r,r=e.regionBelow(r);if(!i.dirty&&(r=i,i=e.regionAbove(i),i===null||!i.dirty))return;if(i.dirty=!1,n=i.eUp,s=r.eUp,n.Dst!==s.Dst&&e.checkForLeftSplice(t,i)&&(r.fixUpperEdge?(e.deleteRegion(t,r),t.mesh.delete(s),r=e.regionBelow(i),s=r.eUp):i.fixUpperEdge&&(e.deleteRegion(t,i),t.mesh.delete(n),i=e.regionAbove(r),n=i.eUp)),n.Org!==s.Org)if(n.Dst!==s.Dst&&!i.fixUpperEdge&&!r.fixUpperEdge&&(n.Dst===t.event||s.Dst===t.event)){if(e.checkForIntersect(t,i))return}else e.checkForRightSplice(t,i);n.Org===s.Org&&n.Dst===s.Dst&&(e.addWinding(s,n),e.deleteRegion(t,i),t.mesh.delete(n),i=e.regionAbove(r))}},e.connectRightVertex=function(t,i,r){var n,s=r.Onext,a=e.regionBelow(i),o=i.eUp,l=a.eUp,c=!1;if(o.Dst!==l.Dst&&e.checkForIntersect(t,i),Ht.vertEq(o.Org,t.event)&&(t.mesh.splice(s.Oprev,o),i=e.topLeftRegion(t,i),s=e.regionBelow(i).eUp,e.finishLeftRegions(t,e.regionBelow(i),a),c=!0),Ht.vertEq(l.Org,t.event)&&(t.mesh.splice(r,l.Oprev),r=e.finishLeftRegions(t,a,null),c=!0),c){e.addRightEdges(t,i,r.Onext,s,s,!0);return}Ht.vertLeq(l.Org,o.Org)?n=l.Oprev:n=o,n=t.mesh.connect(r.Lprev,n),e.addRightEdges(t,i,n,n.Onext,n.Onext,!1),n.Sym.activeRegion.fixUpperEdge=!0,e.walkDirtyRegions(t,i)},e.connectLeftDegenerate=function(t,i,r){var n,s,a,o,l;if(n=i.eUp,Ht.vertEq(n.Org,r)){Kt(!1),e.spliceMergeVertices(t,n,r.anEdge);return}if(!Ht.vertEq(n.Dst,r)){t.mesh.splitEdge(n.Sym),i.fixUpperEdge&&(t.mesh.delete(n.Onext),i.fixUpperEdge=!1),t.mesh.splice(r.anEdge,n),e.sweepEvent(t,r);return}Kt(!1),i=e.topRightRegion(i),l=e.regionBelow(i),a=l.eUp.Sym,s=o=a.Onext,l.fixUpperEdge&&(Kt(s!==a),e.deleteRegion(t,l),t.mesh.delete(a),a=s.Oprev),t.mesh.splice(r.anEdge,a),Ht.edgeGoesLeft(s)||(s=null),e.addRightEdges(t,i,a.Onext,o,s,!0)},e.connectLeftVertex=function(t,i){var r,n,s,a,o,l,c=new A3;if(c.eUp=i.anEdge.Sym,r=t.dict.search(c).key,n=e.regionBelow(r),!!n){if(a=r.eUp,o=n.eUp,Ht.edgeSign(a.Dst,i,a.Org)===0){e.connectLeftDegenerate(t,r,i);return}if(s=Ht.vertLeq(o.Dst,a.Dst)?r:n,r.inside||s.fixUpperEdge){if(s===r)l=t.mesh.connect(i.anEdge.Sym,a.Lnext);else{var u=t.mesh.connect(o.Dnext,i.anEdge);l=u.Sym}s.fixUpperEdge?e.fixUpperEdge(t,s,l):e.computeWinding(t,e.addRegionBelow(t,r,l)),e.sweepEvent(t,i)}else e.addRightEdges(t,r,i.anEdge,i.anEdge,null,!0)}},e.sweepEvent=function(t,i){t.event=i,e.debugEvent(t);for(var r=i.anEdge;r.activeRegion===null;)if(r=r.Onext,r===i.anEdge){e.connectLeftVertex(t,i);return}var n=e.topLeftRegion(t,r.activeRegion);Kt(n!==null);var s=e.regionBelow(n),a=s.eUp,o=e.finishLeftRegions(t,s,null);o.Onext===a?e.connectRightVertex(t,n,o):e.addRightEdges(t,n,o.Onext,a,a,!0)},e.addSentinel=function(t,i,r,n){var s=new A3,a=t.mesh.makeEdge();a.Org.s=r,a.Org.t=n,a.Dst.s=i,a.Dst.t=n,t.event=a.Dst,s.eUp=a,s.windingNumber=0,s.inside=!1,s.fixUpperEdge=!1,s.sentinel=!0,s.dirty=!1,s.nodeUp=t.dict.insert(s)},e.initEdgeDict=function(t){t.dict=new wSe(t,e.edgeLeq);var i=t.bmax[0]-t.bmin[0],r=t.bmax[1]-t.bmin[1],n=t.bmin[0]-i,s=t.bmax[0]+i,a=t.bmin[1]-r,o=t.bmax[1]+r;e.addSentinel(t,n,s,a),e.addSentinel(t,n,s,o)},e.doneEdgeDict=function(t){for(var i,r=0;(i=t.dict.min().key)!==null;)i.sentinel||(Kt(i.fixUpperEdge),Kt(++r===1)),Kt(i.windingNumber===0),e.deleteRegion(t,i)},e.removeDegenerateEdges=function(t){var i,r,n,s=t.mesh.eHead;for(i=s.next;i!==s;i=r)r=i.next,n=i.Lnext,Ht.vertEq(i.Org,i.Dst)&&i.Lnext.Lnext!==i&&(e.spliceMergeVertices(t,n,i),t.mesh.delete(i),i=n,n=i.Lnext),n.Lnext===i&&(n!==i&&((n===r||n===r.Sym)&&(r=r.next),t.mesh.delete(n)),(i===r||i===r.Sym)&&(r=r.next),t.mesh.delete(i))},e.initPriorityQ=function(t){var i,r,n,s=0;for(n=t.mesh.vHead,r=n.next;r!==n;r=r.next)s++;for(s+=8,i=t.pq=new xSe(s,Ht.vertLeq),n=t.mesh.vHead,r=n.next;r!==n;r=r.next)r.pqHandle=i.insert(r);return r!==n?!1:(i.init(),!0)},e.donePriorityQ=function(t){t.pq=null},e.removeDegenerateFaces=function(t,i){var r,n,s;for(r=i.fHead.next;r!==i.fHead;r=n)n=r.next,s=r.anEdge,Kt(s.Lnext!==s),s.Lnext.Lnext===s&&(e.addWinding(s.Onext,s),t.mesh.delete(s));return!0},e.computeInterior=function(t,i){i===void 0&&(i=!0);var r,n;if(e.removeDegenerateEdges(t),!e.initPriorityQ(t))return!1;for(e.initEdgeDict(t);(r=t.pq.extractMin())!==null;){for(;n=t.pq.min(),!(n===null||!Ht.vertEq(n,r));)n=t.pq.extractMin(),e.spliceMergeVertices(t,r.anEdge,n.anEdge);e.sweepEvent(t,r)}return t.event=t.dict.min().key.eUp.Org,e.debugEvent(t),e.doneEdgeDict(t),e.donePriorityQ(t),e.removeDegenerateFaces(t,t.mesh)?(i&&t.mesh.check(),!0):!1},e}(),_Se=function(){function e(){this.mesh=new S6,this.normal=[0,0,0],this.sUnit=[0,0,0],this.tUnit=[0,0,0],this.bmin=[0,0],this.bmax=[0,0],this.windingRule=sr.ODD,this.dict=null,this.pq=null,this.event=null,this.vertexIndexCounter=0,this.vertices=[],this.vertexIndices=[],this.vertexCount=0,this.elements=[],this.elementCount=0}return e.prototype.dot_=function(t,i){return t[0]*i[0]+t[1]*i[1]+t[2]*i[2]},e.prototype.normalize_=function(t){var i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(!i)throw"Zero-size vector!";i=Math.sqrt(i),t[0]/=i,t[1]/=i,t[2]/=i},e.prototype.longAxis_=function(t){var i=0;return Math.abs(t[1])>Math.abs(t[0])&&(i=1),Math.abs(t[2])>Math.abs(t[i])&&(i=2),i},e.prototype.computeNormal_=function(t){var i,r,n,s,a,o,l=[0,0,0],c=[0,0,0],u=[0,0,0],h=[0,0,0],d=[0,0,0],p=[null,null,null],f=[null,null,null],v=this.mesh.vHead;i=v.next;for(var g=0;g<3;++g)s=i.coords[g],c[g]=s,f[g]=i,l[g]=s,p[g]=i;for(i=v.next;i!==v;i=i.next)for(var m=0;m<3;++m)s=i.coords[m],s<c[m]&&(c[m]=s,f[m]=i),s>l[m]&&(l[m]=s,p[m]=i);var x=0;if(l[1]-c[1]>l[0]-c[0]&&(x=1),l[2]-c[2]>l[x]-c[x]&&(x=2),c[x]>=l[x]){t[0]=0,t[1]=0,t[2]=1;return}for(o=0,r=f[x],n=p[x],u[0]=r.coords[0]-n.coords[0],u[1]=r.coords[1]-n.coords[1],u[2]=r.coords[2]-n.coords[2],i=v.next;i!==v;i=i.next)h[0]=i.coords[0]-n.coords[0],h[1]=i.coords[1]-n.coords[1],h[2]=i.coords[2]-n.coords[2],d[0]=u[1]*h[2]-u[2]*h[1],d[1]=u[2]*h[0]-u[0]*h[2],d[2]=u[0]*h[1]-u[1]*h[0],a=d[0]*d[0]+d[1]*d[1]+d[2]*d[2],a>o&&(o=a,t[0]=d[0],t[1]=d[1],t[2]=d[2]);o<=0&&(t[0]=t[1]=t[2]=0,t[this.longAxis_(u)]=1)},e.prototype.checkOrientation_=function(){for(var t=this.mesh.fHead,i,r=this.mesh.vHead,n,s=0,a=t.next;a!==t;a=a.next)if(n=a.anEdge,!(n.winding<=0))do s+=(n.Org.s-n.Dst.s)*(n.Org.t+n.Dst.t),n=n.Lnext;while(n!==a.anEdge);if(s<0){for(i=r.next;i!==r;i=i.next)i.t=-i.t;this.tUnit[0]=-this.tUnit[0],this.tUnit[1]=-this.tUnit[1],this.tUnit[2]=-this.tUnit[2]}},e.prototype.projectPolygon_=function(){var t=this.mesh.vHead,i=[0,0,0],r,n,s=!1;i[0]=this.normal[0],i[1]=this.normal[1],i[2]=this.normal[2],!i[0]&&!i[1]&&!i[2]&&(this.computeNormal_(i),s=!0),r=this.sUnit,n=this.tUnit;var a=this.longAxis_(i);r[a]=0,r[(a+1)%3]=1,r[(a+2)%3]=0,n[a]=0,n[(a+1)%3]=0,n[(a+2)%3]=i[a]>0?1:-1;for(var o=t.next;o!==t;o=o.next)o.s=this.dot_(o.coords,r),o.t=this.dot_(o.coords,n);s&&this.checkOrientation_();for(var l=!0,c=t.next;c!==t;c=c.next)l?(this.bmin[0]=this.bmax[0]=c.s,this.bmin[1]=this.bmax[1]=c.t,l=!1):(c.s<this.bmin[0]&&(this.bmin[0]=c.s),c.s>this.bmax[0]&&(this.bmax[0]=c.s),c.t<this.bmin[1]&&(this.bmin[1]=c.t),c.t>this.bmax[1]&&(this.bmax[1]=c.t))},e.prototype.addWinding_=function(t,i){t.winding+=i.winding,t.Sym.winding+=i.Sym.winding},e.prototype.tessellateMonoRegion_=function(t,i){var r,n;if(r=i.anEdge,!(r.Lnext!==r&&r.Lnext.Lnext!==r))throw"Mono region invalid";for(;Ht.vertLeq(r.Dst,r.Org);r=r.Lprev);for(;Ht.vertLeq(r.Org,r.Dst);r=r.Lnext);n=r.Lprev;for(var s=void 0;r.Lnext!==n;)if(Ht.vertLeq(r.Dst,n.Org)){for(;n.Lnext!==r&&(Ht.edgeGoesLeft(n.Lnext)||Ht.edgeSign(n.Org,n.Dst,n.Lnext.Dst)<=0);)s=t.connect(n.Lnext,n),n=s.Sym;n=n.Lprev}else{for(;n.Lnext!==r&&(Ht.edgeGoesRight(r.Lprev)||Ht.edgeSign(r.Dst,r.Org,r.Lprev.Org)>=0);)s=t.connect(r,r.Lprev),r=s.Sym;r=r.Lnext}if(n.Lnext===r)throw"Mono region invalid";for(;n.Lnext.Lnext!==r;)s=t.connect(n.Lnext,n),n=s.Sym;return!0},e.prototype.tessellateInterior_=function(t){for(var i,r=t.fHead.next;r!==t.fHead;r=i)if(i=r.next,r.inside&&!this.tessellateMonoRegion_(t,r))return!1;return!0},e.prototype.discardExterior_=function(t){for(var i,r=t.fHead.next;r!==t.fHead;r=i)i=r.next,r.inside||t.zapFace(r)},e.prototype.setWindingNumber_=function(t,i,r){for(var n,s=t.eHead.next;s!==t.eHead;s=n)n=s.next,s.Rface.inside!==s.Lface.inside?s.winding=s.Lface.inside?i:-i:r?t.delete(s):s.winding=0},e.prototype.getNeighbourFace_=function(t){return!t.Rface||!t.Rface.inside?-1:t.Rface.n},e.prototype.outputPolymesh_=function(t,i,r,n){var s,a=0,o=0,l;r>3&&t.mergeConvexFaces(r);for(var c=t.vHead.next;c!==t.vHead;c=c.next)c.n=-1;for(var u=t.fHead.next;u!==t.fHead;u=u.next)if(u.n=-1,!!u.inside){s=u.anEdge,l=0;do{var c=s.Org;c.n===-1&&(c.n=o,o++),l++,s=s.Lnext}while(s!==u.anEdge);if(l>r)throw"Face vertex greater that support polygon";u.n=a,++a}this.elementCount=a,i===bn.CONNECTED_POLYGONS&&(a*=2),this.elements=[],this.elements.length=a*r,this.vertexCount=o,this.vertices=[],this.vertices.length=o*n,this.vertexIndices=[],this.vertexIndices.length=o;for(var c=t.vHead.next;c!==t.vHead;c=c.next)if(c.n!==-1){var h=c.n*n;this.vertices[h+0]=c.coords[0],this.vertices[h+1]=c.coords[1],n>2&&(this.vertices[h+2]=c.coords[2]),this.vertexIndices[c.n]=c.idx}for(var d=0,u=t.fHead.next;u!==t.fHead;u=u.next)if(u.inside){s=u.anEdge,l=0;do{var c=s.Org;this.elements[d++]=c.n,l++,s=s.Lnext}while(s!==u.anEdge);for(var p=l;p<r;++p)this.elements[d++]=-1;if(i===bn.CONNECTED_POLYGONS){s=u.anEdge;do this.elements[d++]=this.getNeighbourFace_(s),s=s.Lnext;while(s!==u.anEdge);for(var f=l;f<r;++f)this.elements[d++]=-1}}},e.prototype.outputContours_=function(t,i){var r,n,s=0,a=0;this.vertexCount=0,this.elementCount=0;for(var o=t.fHead.next;o!==t.fHead;o=o.next)if(o.inside){n=r=o.anEdge;do this.vertexCount++,r=r.Lnext;while(r!==n);this.elementCount++}this.elements=[],this.elements.length=this.elementCount*2,this.vertices=[],this.vertices.length=this.vertexCount*i,this.vertexIndices=[],this.vertexIndices.length=this.vertexCount;var l=0,c=0,u=0;s=0;for(var o=t.fHead.next;o!==t.fHead;o=o.next)if(o.inside){a=0,n=r=o.anEdge;do this.vertices[l++]=r.Org.coords[0],this.vertices[l++]=r.Org.coords[1],i>2&&(this.vertices[l++]=r.Org.coords[2]),this.vertexIndices[c++]=this.vertexIdCallback?this.vertexIdCallback(r):r.Org.idx,a++,r=r.Lnext;while(r!==n);this.elements[u++]=s,this.elements[u++]=a,s+=a}},e.prototype.addContour=function(t,i){this.mesh===null&&(this.mesh=new S6),t<2&&(t=2),t>3&&(t=3);for(var r=null,n=0;n<i.length;n+=t)r===null?(r=this.mesh.makeEdge(),this.mesh.splice(r,r.Sym)):(this.mesh.splitEdge(r),r=r.Lnext),r.Org.coords[0]=i[n+0],r.Org.coords[1]=i[n+1],t>2?r.Org.coords[2]=i[n+2]:r.Org.coords[2]=0,r.Org.idx=this.vertexIndexCounter++,this.edgeCreateCallback&&this.edgeCreateCallback(r),r.winding=1,r.Sym.winding=-1},e.prototype.tesselate=function(t,i,r,n,s,a){if(t===void 0&&(t=sr.ODD),i===void 0&&(i=bn.POLYGONS),a===void 0&&(a=!0),this.vertices=[],this.elements=[],this.vertexIndices=[],this.vertexIndexCounter=0,s&&(this.normal[0]=s[0],this.normal[1]=s[1],this.normal[2]=s[2]),this.windingRule=t,n<2&&(n=2),n>3&&(n=3),!this.mesh)return!1;this.projectPolygon_(),bSe.computeInterior(this,a);var o=this.mesh;return i===bn.BOUNDARY_CONTOURS?this.setWindingNumber_(o,1,!0):this.tessellateInterior_(o),a&&o.check(),i===bn.BOUNDARY_CONTOURS?this.outputContours_(o,n):this.outputPolymesh_(o,i,r,n),!0},e}();function Cd(e){var t=e.windingRule,i=t===void 0?sr.ODD:t,r=e.elementType,n=r===void 0?bn.POLYGONS:r,s=e.polySize,a=s===void 0?3:s,o=e.vertexSize,l=o===void 0?2:o,c=e.normal,u=c===void 0?[0,0,1]:c,h=e.contours,d=h===void 0?[]:h,p=e.strict,f=p===void 0?!0:p,v=e.debug,g=v===void 0?!1:v;if(!d&&f)throw new Error("Contours can't be empty");if(d){var m=new _Se;e.edgeCreateCallback&&(m.edgeCreateCallback=e.edgeCreateCallback),e.vertexIdCallback&&(m.vertexIdCallback=e.vertexIdCallback);for(var x=0;x<d.length;x++)m.addContour(l||2,d[x]);return m.tesselate(i,n,a,l,u,f),{vertices:m.vertices,vertexIndices:m.vertexIndices,vertexCount:m.vertexCount,elements:m.elements,elementCount:m.elementCount,mesh:g?m.mesh:void 0}}}sr.ODD;sr.NONZERO;sr.POSITIVE;sr.NEGATIVE;sr.ABS_GEQ_TWO;bn.POLYGONS;bn.CONNECTED_POLYGONS;bn.BOUNDARY_CONTOURS;var XO=class{constructor(e=256,t=!1){this.capacity=e,this.size=0,this.debug=t,this.debug&&console.log(`allocating with cap ${e}`);let i=e*XO.eSize;this.buffer=new ArrayBuffer(i);let r=Float32Array.BYTES_PER_ELEMENT,n=0;this.positions=new Float32Array(this.buffer,n*r,3*e),n+=3*e,this.normals=new Float32Array(this.buffer,n*r,3*e),n+=3*e,this.uvs=new Float32Array(this.buffer,n*r,2*e)}realloc(e,t=!1){if(e<this.size)throw Error("cannot shrink buffer");if(e<=this.capacity&&!t)return;this.debug&&console.log(`resizing from ${this.capacity}  ${e}`);let i=e*XO.eSize,r=new ArrayBuffer(i),n=Float32Array.BYTES_PER_ELEMENT,s=0,a=new Float32Array(r,s*n,3*e);s+=3*e;let o=new Float32Array(r,s*n,3*e);s+=3*e;let l=new Float32Array(r,s*n,2*e);t?(a.set(this.positions.subarray(0,this.size*3)),o.set(this.normals.subarray(0,this.size*3)),l.set(this.uvs.subarray(0,this.size*2))):(a.set(this.positions),o.set(this.normals),l.set(this.uvs)),this.buffer=r,this.positions=a,this.normals=o,this.uvs=l,this.capacity=e}get(e=1){let t=this.size+e;if(t>this.capacity){let r=this.capacity;for(;t>r;)r*=2;this.realloc(r)}let i=this.size;return this.size=t,i}reserve(e){let t=this.size+e;t>this.capacity&&this.realloc(t)}shrink(){this.debug&&console.log(`shrinking ${this.capacity}  ${this.size}`),this.realloc(this.size,!0)}},WK=XO;WK.eSize=8*Float32Array.BYTES_PER_ELEMENT;var SSe=Sh(Tae()),sk={vertices:[160,160,-160,160,-160,-160,160,-160],vertexIndices:[1,0,3,2],vertexCount:4,elements:[0,4],elementCount:1,mesh:void 0},XK={vertices:[],vertexIndices:[],vertexCount:0,elements:[],elementCount:0,mesh:void 0},qK={vertices:[-160,160,160,-160,160,160,-160,-160],vertexIndices:[1,3,0,2],vertexCount:4,elements:[0,1,2,1,0,3],elementCount:2,mesh:void 0},C3=(e,t)=>([i,r])=>(r<i&&(r+=t),(e>=i?e:e+t)<=r),ak=class extends Bt{constructor(e,t,i=0,r=12,n=3,s=sr.ODD,a=!1){super(),this.forPathBevel=a,this.type="ShapeGeometry",this.vertexCache={},this._shape=e,this._depth=t,this._curveSegments=r,this._bevelSegmentsInput=n;let o=this._shape.extractShapePointsToFlatArray([],r),l=this._shape.shapeHoles.map(E=>{let C=E.extractShapePointsToFlatArray([],r),D=[];for(let I=C.length-1;I>=1;I-=2){let L=C[I-1],z=C[I-0];D.push(L,z)}return D}),c=[],u=[];for(let E=0;E<o.length;E+=2)u.push([o[E],o[E+1]]);c.push(u);for(let E=0;E<l.length;E++){let C=l[E],D=[];for(let I=0;I<C.length;I+=2)D.push([C[I],C[I+1]]);c.push(D)}let h;e.isText?h=new cQ().setFromPoints(e.points.map(E=>E.position)).getSize(new ve).length()*.1:c[0].length===0?h=i:h=(0,SSe.default)(c).distance,i<=0?(this._bevel=0,this._bevelSegments=0):(this._bevel=Math.min(i,h,t/2),this._bevelSegments=Math.floor(n));let d;try{d=Cd({windingRule:s,elementType:bn.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[o]})}catch{d=sk}let p;try{p=Cd({windingRule:sr.ODD,elementType:bn.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...l]})}catch{p=XK}if(!d)throw new Error("error generating geometry");let f=d.elementCount;if(p){d.elementCount+=p.elementCount;for(let E=0;E<p.elements.length;E++){let C=p.elements[E],D=E%2===0?d.vertexCount:0;d.elements.push(C+D)}for(let E=0;E<p.vertexIndices.length;E++){let C=p.vertexIndices[E],D=d.vertexCount;d.vertexIndices.push(C+D)}for(let E=0;E<p.vertices.length;E++){let C=p.vertices[E];d.vertices.push(C)}}let v=1/0,g=-1/0,m=1/0,x=-1/0;for(let E=0,C=d.vertexCount;E<C;E++){let D=E*2,I=d.vertices[D+0],L=d.vertices[D+1];I<v&&(v=I),I>g&&(g=I),L<m&&(m=L),L>x&&(x=L)}this._minX=v,this._minY=m,this._width=g-v,this._height=x-m,this._buffer=new WK(this._computeBufferEstimatedSize(d));let w=[],_=[];for(let E=d.elementCount-1;E>=0;E--){let C=E>=f,D=E*2,I=d.elements[D+0],L=d.elements[D+1],z=I+L,F={start:I,count:L,normals:[],continuous:[],concave:[]},Q=I,Y=z-1,O=I+1,j=this._shape.roundedCurves.length;do{let $=Q-I,ne=d.vertices[Y*2+0],ie=d.vertices[Y*2+1],de=d.vertices[Q*2+0],be=d.vertices[Q*2+1],we=d.vertices[O*2+0],_e=d.vertices[O*2+1],Me=de-ne,X=be-ie,ge=Math.sqrt(Me*Me+X*X);Me/=ge,X/=ge;let Oe=de-we,Ie=be-_e,Pe=Math.sqrt(Oe*Oe+Ie*Ie);Oe/=Pe,Ie/=Pe,F.normals[$*2+0]=-Ie,F.normals[$*2+1]=Oe,F.concave[$]=Me*Ie-X*Oe>0;let Ye=d.vertexIndices[Q];if(Array.isArray(Ye))F.continuous[$]=!1;else{let[ke,Fe]=this._shape.getCurveIndexFromVertexId(Ye-1,!0);if(Fe>0&&Fe<1)F.continuous[$]=!0;else{let se=Fe===1?ke+1:ke-1;se=(se+j)%j;let Z=Fe===1?0:1,K=this._shape.roundedCurves[ke].getTangent(Fe),k=this._shape.roundedCurves[se].getTangent(Z);F.continuous[$]=K.dot(k)>.95}}C&&(F.normals[$*2+0]*=-1,F.normals[$*2+1]*=-1),[Y,Q,O]=[Q,O,O+1],O>=z&&(O-=L)}while(O!==I+1);let V=[];V.push({bevelI:0,angle:0,size:0,boundary:{vertices:d.vertices.slice(I*2,z*2),vertexCount:L,vertexIndices:new Array(L).fill(!0).map(($,ne)=>[ne,ne]),elements:[0,L],elementCount:1,mesh:null},reverseMap:[],insetPoints:d.vertices.slice(I*2,z*2)});let W=0;for(let $=1;$<=this._bevelSegments;$++){let ne=$/this._bevelSegments*Math.PI/2,ie=(1-Math.cos(ne))*this._bevel,de=[],be=[],we=0;for(let Me=0;Me<L;Me++){let X=Me*2,ge=(Me-1+L)%L*2,Oe=d.vertices[F.start*2+X+0],Ie=d.vertices[F.start*2+X+1],Pe=-F.normals[ge+0]*ie,Ye=-F.normals[ge+1]*ie,ke=-F.normals[X+0]*ie,Fe=-F.normals[X+1]*ie;if(F.concave[Me]||!F.concave[Me]&&C){let se=Math.atan2(Ye,Pe),Z=Math.atan2(Fe,ke);Z>se&&(Z-=Math.PI*2);let K=Z-se;if(F.continuous[Me]||C){let k=se+K/2,re=Math.cos(k)*ie,he=Math.sin(k)*ie;de[2*we+0]=Oe+re*(C?-1:1),de[2*we+1]=Ie+he*(C?-1:1),be[we]=Me,we++}else{let k=Math.max(1,Math.floor(r/4*Math.abs(K)/Math.PI));for(let re=0;re<=k;re++){let he=se+K*(re/k),G=Math.cos(he)*ie,Te=Math.sin(he)*ie;de[2*we+0]=Oe+G,de[2*we+1]=Ie+Te,be[we]=Me,we++}}}else de[2*we+0]=Oe+Pe,de[2*we+1]=Ie+Ye,be[we]=Me,we++,de[2*we+0]=Oe,de[2*we+1]=Ie,be[we]=Me,we++,de[2*we+0]=Oe+ke,de[2*we+1]=Ie+Fe,be[we]=Me,we++}let _e=Cd({windingRule:sr.POSITIVE,elementType:bn.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[de],edgeCreateCallback:Me=>{let X=Me.Org.idx,ge=be[X],Oe=be[(X+1)%be.length];Me.idx=[ge,Oe],Me.Sym.idx=[Oe,ge]},vertexIdCallback:Me=>{let X=Me.Lprev.idx;return[X?X[1]:0,Me.idx?Me.idx[0]:0]}});if(!_e)throw console.log("Error"),new Error(`error generating bevel geometry for ${$}'th loop`);if(!_e.vertexCount){let Me=($-1)/this._bevelSegments*Math.PI/2;W=(1-Math.sin(Me))*this._bevel;break}for(let Me=0;Me<_e.vertexIndices.length;Me++){let[X,ge]=_e.vertexIndices[Me];if(X===ge)continue;let Oe=ge;ge<X&&(Oe+=L);for(let Ie=X;Ie<Oe;Ie++){let Pe=Ie%L,Ye=(Ie+1)%L;if(!F.continuous[Pe]||!F.continuous[Ye]){_e.vertexIndices[Me]=[X,Pe],_e.vertexIndices.splice(Me+1,0,[Ye,ge]),_e.vertices.splice((Me+1)*2,0,_e.vertices[Me*2],_e.vertices[Me*2+1]);break}}}V.push({bevelI:$,angle:ne,size:ie,boundary:_e,reverseMap:be,insetPoints:de})}let J=($,ne,ie)=>{let de=0,be=$.boundary.vertexIndices.length;for(;de<be&&ie($.boundary.vertexIndices[ne]);)ne=(ne+1)%be,de++;return de},ce=w.length;for(let $=1;$<V.length;$++){let ne=V[$-1],ie=V[$],de=ne.boundary.vertexIndices.length,be=ie.boundary.vertexIndices.length;if(!de||!be)break;let we=F.concave.length,_e=0,Me=C3(_e,L);for(;!ne.boundary.vertexIndices.filter(Me).length||!ie.boundary.vertexIndices.filter(Me).length;)_e++,Me=C3(_e,L);let X=ne.boundary.vertexIndices.findIndex(Me),ge=ie.boundary.vertexIndices.findIndex(Me);do X=(X+1)%de;while(Me(ne.boundary.vertexIndices[X]));do ge=(ge+1)%be;while(Me(ie.boundary.vertexIndices[ge]));_e=(_e+1)%L;let Oe=_e,Ie=0,Pe=this._buildBevelVert(F,ne,(X-1+de)%de,void 0,Ie),Ye=this._buildBevelVert(F,ie,(ge-1+be)%be,void 0,Ie),ke=Pe,Fe=Ye,se,Z,K=!1;do{Ie=(_e||we)/we,Me=C3(_e,L);let k=J(ne,X,Me),re=J(ie,ge,Me),he=K;if(K=!1,k&&!re){for(let G=0;G<k;G++)se=this._buildBevelVert(F,ne,(X+G)%de,G/(k-1),Ie),w.push(ke.topN,se.topP,Fe.topN),a===!1&&w.push(se.bottomP,ke.bottomN,Fe.bottomN),ke=se;K=!0}else if(!k&&re)for(let G=0;G<re;G++)Z=this._buildBevelVert(F,ie,(ge+G)%be,G/(re-1),Ie),w.push(Fe.topN,ke.topP,Z.topP),a===!1&&w.push(ke.bottomP,Fe.bottomN,Z.bottomP),Fe=Z;else if(k&&re)if(se=this._buildBevelVert(F,ne,X,0,Ie),Z=this._buildBevelVert(F,ie,ge,0,Ie),he?(w.push(ke.topN,Z.topP,Fe.topN),w.push(ke.topN,se.topP,Z.topP),a===!1&&(w.push(Z.bottomP,ke.bottomN,Fe.bottomN),w.push(Z.bottomP,se.bottomP,ke.bottomN))):(w.push(Fe.topN,ke.topN,se.topP),w.push(Fe.topN,se.topP,Z.topP),a===!1&&(w.push(se.bottomP,ke.bottomN,Fe.bottomN),w.push(se.bottomP,Fe.bottomN,Z.bottomP))),ke=se,Fe=Z,k===re)for(let G=1;G<k;G++)se=this._buildBevelVert(F,ne,(X+G)%de,G/(k-1),Ie),Z=this._buildBevelVert(F,ie,(ge+G)%be,G/(re-1),Ie),w.push(ke.topN,se.topP,Fe.topN),w.push(Fe.topN,se.topP,Z.topP),a===!1&&(w.push(se.bottomP,ke.bottomN,Fe.bottomN),w.push(se.bottomP,Fe.bottomN,Z.bottomP)),ke=se,Fe=Z;else if(k>re){let G=k/re,Te=0;for(let ze=1;ze<k;ze++)se=this._buildBevelVert(F,ne,(X+ze)%de,ze/(k-1),Ie),w.push(ke.topN,se.topP,Fe.topN),a===!1&&w.push(se.bottomP,ke.bottomN,Fe.bottomN),ke=se,ze>(Te+1)*G&&(Te++,Z=this._buildBevelVert(F,ie,(ge+Te)%be,Te/(re-1),Ie),w.push(Fe.topN,se.topP,Z.topP),a===!1&&w.push(se.bottomP,Fe.bottomN,Z.bottomP),Fe=Z)}else{let G=re/k,Te=0;for(let ze=1;ze<re;ze++)Z=this._buildBevelVert(F,ie,(ge+ze)%be,ze/(re-1),Ie),w.push(Fe.topN,se.topP,Z.topP),a===!1&&w.push(se.bottomP,Fe.bottomN,Z.bottomP),Fe=Z,ze>(Te+1)*G&&(Te++,se=this._buildBevelVert(F,ne,(X+Te)%de,Te/(k-1),Ie),w.push(ke.topN,se.topP,Fe.topN),a===!1&&w.push(se.bottomP,ke.bottomN,Fe.bottomN),ke=se)}X=(X+k)%de,ge=(ge+re)%be,_e=(_e+1)%we}while(_e!==Oe)}if(a===!1&&this._depth>this._bevel*2&&this._buildWall(V,F,w),C){let $=[];for(let ne=w.length-1;ne>=ce+2;ne-=3){let ie=w[ne-2],de=w[ne-1],be=w[ne-0];$.push(be,de,ie)}w.splice(ce,w.length-ce,...$)}if(C){let $=[];for(let ne=V[V.length-1].boundary.vertices.length-1;ne>=1;ne-=2){let ie=V[V.length-1].boundary.vertices[ne-1],de=V[V.length-1].boundary.vertices[ne-0];$.push(ie,de)}_.push($)}if(!C){let $=V[V.length-1],ne;try{ne=Cd({windingRule:V.length>1?sr.POSITIVE:sr.ODD,elementType:bn.POLYGONS,vertexSize:2,strict:!0,contours:[$.insetPoints,..._]})}catch{ne=qK}if(!ne)throw new Error("Error generating geometry for surface");l.length===0&&this._bevel<h&&Object.assign(this,{useNgonForTopBottomFaceDuringBake:!0});for(let ie=0;ie<ne.elementCount*3;ie+=3){let de=this._buildSurfaceVert(ne,ne.elements[ie+0],W),be=this._buildSurfaceVert(ne,ne.elements[ie+1],W),we=this._buildSurfaceVert(ne,ne.elements[ie+2],W);w.push(de.top,be.top,we.top),a===!1&&w.push(we.bottom,be.bottom,de.bottom)}}this.vertexCache={}}this._buffer.shrink();let M=new $t(Uint32Array.from(w),1),S=new $t(this._buffer.positions,3),A=new $t(this._buffer.normals,3),T=new $t(this._buffer.uvs,2);S.needsUpdate=!0,A.needsUpdate=!0,T.needsUpdate=!0,M.needsUpdate=!0,this.setAttribute("position",S),this.setAttribute("normal",A),this.setAttribute("uv",T),this.setIndex(M)}_computeBufferEstimatedSize(e){return e.vertexCount*2*(2+this._bevelSegments)}_buildWall(e,t,i){let r=e[0];for(let n=0,s=r.boundary.vertexCount;n<s;n++){let a=this._buildBevelVert(t,r,n),o=this._buildBevelVert(t,r,(n+1)%s);i.push(o.topP,a.topN,a.bottomN),i.push(o.topP,a.bottomN,o.bottomP)}}_buildSurfaceVert(e,t,i){let r=t.toString();if(r in this.vertexCache)return this.vertexCache[r];let n=e.vertices[t*2+0],s=e.vertices[t*2+1],a=(n-this._minX)/this._width,o=(s-this._minY)/this._height;this.forPathBevel&&(o=1);let l=this._buffer.get(this.forPathBevel?1:2),c=l*3,u=l*2,h={top:l+0,bottom:l+1};return this._buffer.positions[c+0]=n,this._buffer.positions[c+1]=s,this._buffer.positions[c+2]=this.forPathBevel?this._bevel:this._depth-i,this._buffer.normals[c+0]=0,this._buffer.normals[c+1]=0,this._buffer.normals[c+2]=1,this._buffer.uvs[u+0]=a,this._buffer.uvs[u+1]=o,this.forPathBevel===!1&&(this._buffer.positions[c+3]=n,this._buffer.positions[c+4]=s,this._buffer.positions[c+5]=i,this._buffer.normals[c+3]=0,this._buffer.normals[c+4]=0,this._buffer.normals[c+5]=-1,this._buffer.uvs[u+2]=a,this._buffer.uvs[u+3]=o),this.vertexCache[r]=h,h}_buildBevelVert(e,t,i,r=1,n){let s=`${t.bevelI}:${i}`;if(s in this.vertexCache&&n!==0&&n!==1&&(!n||n===this.vertexCache[s].pathBevelUCoord))return this.vertexCache[s];let[a,o]=t.boundary.vertexIndices[i],l,c,u,h;a!==o?(c=a,l=o,h=!1,u=e.continuous[c]&&e.continuous[l]):(l=a,c=(l-1+e.count)%e.count,h=e.concave[l]&&t.bevelI>0,u=e.continuous[l]||h);let d=Math.cos(t.angle),p=Math.sin(t.angle),f=i*2,v=l*2,g=c*2,m=t.boundary.vertices[f+0],x=t.boundary.vertices[f+1],w=(1-p)*this._bevel,_=(m-this._minX)/this._width,M=(x-this._minY)/this._height;this.forPathBevel&&(n!==void 0&&(_=n),M=1);let S=e.normals[v+0],A=e.normals[v+1],T=e.normals[g+0],E=e.normals[g+1];if(h){let z=T-S,F=E-A;S=S+z*(1-r),A=A+F*(1-r);let Q=Math.sqrt(S*S+A*A);S/=Q,A/=Q}let C=this.forPathBevel?this._buffer.get(u?1:2):this._buffer.get(u?2:4),D=C*3,I=C*2,L={i,fi:l,topP:C+0,topN:C+0,bottomP:C+1,bottomN:C+1,pathBevelUCoord:n};return this._buffer.positions[D+0]=m,this._buffer.positions[D+1]=x,this._buffer.positions[D+2]=(this.forPathBevel?this._bevel:this._depth)-w,this._buffer.normals[D+0]=S*d,this._buffer.normals[D+1]=A*d,this._buffer.normals[D+2]=p,this._buffer.uvs[I+0]=_,this._buffer.uvs[I+1]=M,this.forPathBevel===!1&&(this._buffer.positions[D+3]=m,this._buffer.positions[D+4]=x,this._buffer.positions[D+5]=w,this._buffer.normals[D+3]=S*d,this._buffer.normals[D+4]=A*d,this._buffer.normals[D+5]=-p,this._buffer.uvs[I+2]=M,this._buffer.uvs[I+3]=_),u||(this.forPathBevel?(C+=1,D+=3,I+=2):(C+=2,D+=6,I+=4),L.topP=C+0,L.bottomP=C+1,this._buffer.positions[D+0]=m,this._buffer.positions[D+1]=x,this._buffer.positions[D+2]=(this.forPathBevel?this._bevel:this._depth)-w,this._buffer.normals[D+0]=T*d,this._buffer.normals[D+1]=E*d,this._buffer.normals[D+2]=p,this._buffer.uvs[I+0]=_,this._buffer.uvs[I+1]=M,this.forPathBevel===!1&&(this._buffer.positions[D+3]=m,this._buffer.positions[D+4]=x,this._buffer.positions[D+5]=w,this._buffer.normals[D+3]=T*d,this._buffer.normals[D+4]=E*d,this._buffer.normals[D+5]=-p,this._buffer.uvs[I+2]=M,this._buffer.uvs[I+3]=_)),this.vertexCache[s]=L,L}clone(){let e=new ak(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return e.userData=IT(this.userData),e}},YK=class extends Bt{constructor(e,t=12,i={}){super(),this.type="ShapeGeometry",this.windingRule=sr.ODD,this.elementType=bn.POLYGONS,this.polySize=3,this.vertexSize=2,this.strict=!0,this._shape=e,this._curveSegments=t,this._triangulationOptions=Object.assign({windingRule:sr.ODD,elementType:bn.POLYGONS,polySize:3,vertexSize:2,strict:!0},i);let r=this._shape.extractShapePointsToFlatArray([],this._curveSegments),n=this._shape.shapeHoles.map(d=>d.extractShapePointsToFlatArray([],this._curveSegments)),s,a=!0,o=!0,l,c;for(let d=0,p=r.length/2;d<p;d++){let f=d*2,v=r[f+0],g=r[f+1];if(l!==void 0&&v!==l&&(a=!1),c!==void 0&&g!==c&&(o=!1),l=v,c=g,!a&&!o)break}if(!a&&!o)try{s=Cd({contours:[r,...n],windingRule:this._triangulationOptions.windingRule,elementType:this._triangulationOptions.elementType,polySize:this._triangulationOptions.polySize,vertexSize:this._triangulationOptions.vertexSize,strict:this._triangulationOptions.strict})}catch{s=sk}let u=(s==null?void 0:s.vertexCount)??1,h=(s==null?void 0:s.elementCount)??1;if(this._positionAttribute=new $t(new Float32Array(u*3),3),this._normalAttribute=new $t(new Float32Array(u*3),3),this._uvAttribute=new $t(new Float32Array(u*2),2),this._indexAttribute=new $t(new Uint32Array(h*3),1),s){let d=1/0,p=-1/0,f=1/0,v=-1/0;for(let x=0,w=u;x<w;x++){let _=x*2,M=s.vertices[_+0],S=s.vertices[_+1];M<d&&(d=M),M>p&&(p=M),S<f&&(f=S),S>v&&(v=S)}let g=p-d,m=v-f;for(let x=0,w=u;x<w;x++){let _=x*2,M=s.vertices[_+0],S=s.vertices[_+1],A=(M-d)/g,T=(S-f)/m;this._positionAttribute.setXYZ(x,M,S,0),this._normalAttribute.setXYZ(x,0,0,1),this._uvAttribute.setXY(x,A,T)}for(let x=0,w=h;x<w;x++){let _=x*3,M=s.elements[_+0],S=s.elements[_+1],A=s.elements[_+2];this._indexAttribute.setX(_+0,M),this._indexAttribute.setX(_+1,S),this._indexAttribute.setX(_+2,A)}}this.setAttribute("position",this._positionAttribute),this.setAttribute("normal",this._normalAttribute),this.setAttribute("uv",this._uvAttribute),this.setIndex(this._indexAttribute),this.setDrawRange(0,((s==null?void 0:s.elementCount)??1)*3)}clone(){let e=new YK(this._shape,this._curveSegments);return e.userData=IT(this.userData),e}},QK=class extends ak{constructor(e,t,i=0,r=12,n=3,s=sr.ODD){super(e,t,i,r,n,s),this.type="ShapeGeometry"}_computeBufferEstimatedSize(e){return e.vertexCount*2*(2+this._bevelSegments)}_buildWall(e,t,i){let r=e[0];for(let n=0,s=r.boundary.vertexCount;n<s;n++){let a=this._buildBevelVert(t,r,n),o=this._buildBevelVert(t,r,(n+1)%s);i.push(o.topP,a.topN,a.bottomN),i.push(o.topP,a.bottomN,o.bottomP)}}clone(){let e=new QK(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return e.userData=IT(this.userData),e}},sm=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var c,u;let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,subdivisions:40,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3,windingRule:sr.ODD},e.parameters),r=Math.abs(i.width),n=Math.abs(i.height??i.width),s=Math.abs(i.depth??0),a=e.shape??(t==null?void 0:t.shape),o=(a==null?void 0:a.roundness)??i.roundness;a!==void 0&&(a instanceof Zr?(a.width!==r||a.height!==n)&&a.applySize(r,n):a=new Zr(r,n).fromJSON(a),((c=e.parameters)==null?void 0:c.roundness)!==void 0&&((u=e.parameters)==null?void 0:u.roundness)>0&&a.update());let l=a??new Zr(r,n);return{parameters:Object.assign(i,{width:r,height:n,depth:s,roundness:o}),shape:l}}static build(e){let{depth:t,extrudeBevelSize:i,extrudeBevelSegments:r,subdivisions:n,roundness:s,windingRule:a}=e.parameters;e.shape.roundness=s;let o;return t<=0?o=new YK(e.shape,n,{windingRule:a}):o=new QK(e.shape,t,i,n,r,a),Object.assign(o,{userData:{...e,type:"VectorGeometry"}})}},KK=Math.PI*2,ok=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,spikes:64,angle:360,innerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters);return i.angle=Et.clamp(i.angle,0,360),{shape:e.shape&&e.shape instanceof Zr?e.shape:new Zr,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t,height:i,spikes:r,angle:n,innerRadius:s,depth:a,extrudeBevelSize:o,extrudeBevelSegments:l}=e.parameters,c=e.shape,u=t*.5,h=i*.5,d=MSe(c,u,h,n*Math.PI/180,r,s);c.isClosed=!0,c.update();let p;return n===0?(p=new Bt,p.setAttribute("position",new St([],3))):p=sm.create({shape:c,parameters:{subdivisions:d,depth:a,extrudeBevelSize:o,extrudeBevelSegments:l}}),Object.assign(p,{userData:{...e,type:"EllipseGeometry"}})}};function MSe(e,t,i,r,n,s){if(r>=KK)return n>30||n%4===0?(ASe(e,t,i,s),Math.round(n/4)):C6(e,r,n,t,i,s);r=Math.max(r,.001);let a={x:0,y:i},o=r+Math.PI*.5,l={x:Math.cos(o)*t,y:Math.sin(o)*i},c=ySe({px:a.x,py:a.y,cx:l.x,cy:l.y,rx:t,ry:i,largeArcFlag:r>Math.PI,sweepFlag:!0});return n>30||n%c.length===0?ESe(e,a.x,a.y,c,n,t,i,s):C6(e,r,n,t,i,s)}function ESe(e,t,i,r,n,s,a,o){let l=Math.round(n/r.length);e.addPoint(Cv(t,i));for(let c=0,u=r.length;c<u;c++){let h=r[c],d=e.points[c],p=Cv(h.x,h.y);d.controls[1].position.set(h.x1,h.y1),p.controls[0].position.set(h.x2,h.y2),e.addPoint(p)}return o>0?ZK(e,s,a,o):e.addPoint(Cv(0,0)),l}function C6(e,t,i,r,n,s){let a=-t/i;for(let o=0;o<=i;o++){let l=a*o,c=Math.sin(l)*r,u=Math.cos(l)*n;e.addPoint(Cv(c,u))}return t<KK?s>0?ZK(e,r,n,s):e.addPoint(Cv(0,0)):(e.removePoint(e.points[e.points.length-1]),s>0&&$K(e,r,n,s)),1}function ASe(e,t,i,r=0,n=0,s=0){let a=.5522847498,o=t*a,l=i*a;e.addPoint(mS(n-t,s,n-t,s-l,n-t,s+l)),e.addPoint(mS(n,s+i,n-o,s+i,n+o,s+i)),e.addPoint(mS(n+t,s,n+t,s+l,n+t,s-l)),e.addPoint(mS(n,s-i,n+o,s-i,n-o,s-i)),r>0&&$K(e,t,i,r)}function Cv(e,t){return new Av(Et.generateUUID(),new ve(e,t))}function mS(e,t,i,r,n,s){let a=Cv(e,t);return a.controls[0].position.set(i,r),a.controls[1].position.set(n,s),a}function ZK(e,t,i,r){JK(e,t,i,r).forEach(n=>e.addPoint(n))}function $K(e,t,i,r){let n=JK(e,t,i,r),s=new Zr;n.forEach(a=>s.addPoint(a)),s.isClosed=!0,e.shapeHoles.push(s)}function JK(e,t,i,r){let n=r*t/100,s=n*(Math.abs(i)/Math.abs(t)),a=new ve(n/t,s/i),o=e.points.map(l=>{let c=l.clone();return c.uuid=Et.generateUUID(),c}).reverse();return o.forEach(l=>{l.position.multiply(a);let c=l.controls[0].position.clone().multiply(a),u=l.controls[1].position.clone().multiply(a);l.controls[0].position.copy(u),l.controls[1].position.copy(c)}),o}var CSe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,revolutions:2,segments:40,pathRadius:10,pathType:0,pathSegments:30,cornerRadius:30,cornerSegments:4},e.parameters),r=Math.abs(i.width),n=Math.abs(i.height??r),s=Math.abs(i.depth??r),a=Math.abs(Math.min(r,s))/2;return{parameters:Object.assign(i,{width:r,height:n,depth:s,radius:a,segments:Math.round(i.segments),pathSegments:Math.round(i.pathSegments),cornerSegments:Math.round(i.cornerSegments)})}}static build(e){let{width:t,height:i,depth:r,radius:n,revolutions:s,segments:a,pathRadius:o,pathType:l,pathSegments:c,cornerRadius:u,cornerSegments:h}=e.parameters,d=new eZ(!1,t,i,r,n,s,a,o,l,c,u,h);return Object.assign(d,{userData:{...e,type:"HelixGeometry"}})}},T3=new bv([0,0,0],1),eZ=class extends Bt{constructor(e=!0,t=1,i=1,r=1,n=1,s=1,a=1,o=1,l=1,c=1,u=1,h=1){if(super(),s===0)return;let d=e&&s===1;d&&(h=0),u>100&&(u=100),u===0&&(h=0);let p=()=>new B,f=new B,v=p(),g=p(),m=p(),x,w,_,M,S,A,T,E,C=p(),D=p(),I=p(),L=p(),z=p(),F=p(),Q=p(),Y=p(),O=i-2*o+.001,j=O/s,V=Math.ceil(a*s),W=V+1,J=O/V,ce=-O/2,$=c+1,ne=2*Math.PI/c,ie=Math.PI/2/h,de=.01,be=Math.min((1-u/100)*o,o-de),we=o-be,_e=0,Me=2,X=h*Me+Me,ge=$*X/Me,Oe=ge+$*W,Ie=Math.max(0,$*(W+X)),[Pe,Ye,ke]=[3,3,2].map(ye=>Array(Ie*ye).fill(0)),Fe=[],se=n-o;function Z(ye,je){let nt=Math.PI/2;A=je*J,E=2*Math.PI*(A%j)/j+nt,A+=ce,T=Math.sin(E)*se,S=Math.cos(E)*se,e?ye.set(S,T,A):ye.set(S,A,T)}Z(f,-1e-10),Z(v,0),C.copy(f),Z(f,1);let K=f.distanceTo(v),k=d?0:we+be,re=K*V+2*k,he=be,G=re-k;for(let ye=0;ye<=V;ye++){Z(g,ye),Y.subVectors(g,C).normalize(),C.copy(g),F.copy(g).setComponent(+e+1,0).normalize(),Q.crossVectors(Y,F).normalize();let je=ye===0,nt=ye===V,ct=je?3*Math.PI/2:ie,tt=je?he:G,ue=je?$:Oe,Ue=je?0:Ie-$,dt=Y.clone().multiplyScalar(je?-we:we).add(g),xe=Y.clone().multiplyScalar(je?-1:1).normalize();for(let ae=0;ae<$;ae++){let fe=ae*ne;if(D.addVectors(f.copy(F).multiplyScalar(o*Math.cos(fe)),v.copy(Q).multiplyScalar(o*Math.sin(fe))),I.copy(D).normalize(),je||nt){d||(_e=Ue+ae,[0,1,2].forEach(Se=>{Pe[_e*3+Se]=dt.getComponent(Se),Ye[_e*3+Se]=xe.getComponent(Se)}),ke[_e*2]=+nt,ke[_e*2+1]=ae/c),v.copy(I).multiplyScalar(be),m.addVectors(g,v);for(let Se=0;Se<h;Se++){let Ne=Se*ie+ct;L.addVectors(f.copy(Y).multiplyScalar(we*Math.sin(Ne)),v.copy(I).multiplyScalar(we*Math.cos(Ne))),z.copy(L).normalize(),v.addVectors(m,L),L.normalize(),_e=ue+Se*$+ae,[0,1,2].forEach(vt=>{Pe[_e*3+vt]=v.getComponent(vt),Ye[_e*3+vt]=z.getComponent(vt)});let st=+je+Math.sin(Ne);ke[_e*2]=(tt+we*st)/re,ke[_e*2+1]=ae/c}}v.addVectors(g,D),_e=ge+ye*$+ae,[0,1,2].forEach(Se=>{Pe[_e*3+Se]=v.getComponent(Se),Ye[_e*3+Se]=I.getComponent(Se)}),ke[_e*2]=(k+ye*K)/re,ke[_e*2+1]=ae/c}}let Te=W+2*h+Me,[ze,Qe]=[+d,Te-1];for(let ye=ze;ye<=Qe-1;ye++){let je=d&&ye===Qe-1;for(let nt=0;nt<$-1;nt++)x=ye*$+nt,w=x+1,_=(je?nt:x)+$,M=(je?nt+1:w)+$,ye===0?Fe.push(w,M,_):ye===Te-2?Fe.push(x,w,_):Fe.push(x,w,_,w,M,_)}this.setIndex(Fe),this.setAttribute("position",new St(Pe,3)),this.setAttribute("normal",new St(Ye,3)),this.setAttribute("uv",new St(ke,2))}getClosedTorusIndicesForBooleanOrSubdiv(){let e=this.userData.parameters,t=Math.ceil(e.tubularSegments),i=e.radialSegments+1,r=Array.from(this.getIndex().array),n,s,a,o,l=6*(t-1)*e.radialSegments,c=t,u=c===t;for(let h=0;h<e.radialSegments;h++)n=c*i+h,s=n+1,a=(u?h:n)+i,o=(u?h+1:s)+i,r[l++]=n,r[l++]=s,r[l++]=a,r[l++]=s,r[l++]=o,r[l++]=a;return r.length=l,T3.array=r,T3.count=r.length,T3}},TSe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,detail:0,corner:0,cornerSides:4},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:r,detail:n,corner:s,cornerSides:a}=e.parameters,o=n===0&&s!==0?new tZ(t*.5,s,a):new $Y(t*.5,n);return o.scale(1,i/t,r/t),Object.assign(o,{userData:{...e,type:"IcosahedronGeometry"}})}},tZ=class extends ik{constructor(e=1,t=.2,i=4){let r=(1+Math.sqrt(5))/2,n=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],a="IcosahedronGeometry";super(n,s,a,e,t,i),this.type=a}static fromJSON(e){return new tZ(e.radius,e.corner,e.cornerSides)}},PSe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var r;(((r=e.parameters)==null?void 0:r.points)??[]).forEach(n=>{Array.isArray(n)&&(n.x=n[0],n.y=n[1])});let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,segments:64,verticalSegments:64,points:[{x:0,y:-50,id:0},{x:50,y:-50,id:1},{x:50,y:50,id:2},{x:0,y:50,id:3}]},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{points:t,segments:i,verticalSegments:r}=e.parameters,n=new _A;n.moveTo(t[0].x,t[0].y),n.bezierCurveTo(t[1].x,t[1].y,t[2].x,t[2].y,t[3].x,t[3].y);let s=new XY(n.extractPoints(r).shape,i);return s.rotateZ(Math.PI),Object.assign(s,{userData:{...e,type:"LatheGeometry"}})}},cc=new ht,P3=new ir,gS=new B,sC=class extends Cs{constructor(){super(),this.uuid=Et.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}applyMatrix4(e){let t=new Mn().getNormalMatrix(e);for(let i=0,r=this.vertices.length;i<r;i++)this.vertices[i].applyMatrix4(e);for(let i=0,r=this.faces.length;i<r;i++){let n=this.faces[i];n.normal.applyMatrix3(t).normalize();for(let s=0,a=n.vertexNormals.length;s<a;s++)n.vertexNormals[s].applyMatrix3(t).normalize()}return this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this}rotateX(e){return cc.makeRotationX(e),this.applyMatrix4(cc),this}rotateY(e){return cc.makeRotationY(e),this.applyMatrix4(cc),this}rotateZ(e){return cc.makeRotationZ(e),this.applyMatrix4(cc),this}translate(e,t,i){return cc.makeTranslation(e,t,i),this.applyMatrix4(cc),this}scale(e,t,i){return cc.makeScale(e,t,i),this.applyMatrix4(cc),this}lookAt(e){return P3.lookAt(e),P3.updateMatrix(),this.applyMatrix4(P3.matrix),this}fromBufferGeometry(e){let t=this,i=e.index!==null?e.index:void 0,r=e.attributes;if(r.position===void 0)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;let n=r.position,s=r.normal,a=r.color,o=r.uv,l=r.uv2;l!==void 0&&(this.faceVertexUvs[1]=[]);for(let h=0;h<n.count;h++)t.vertices.push(new B().fromBufferAttribute(n,h)),a!==void 0&&t.colors.push(new jt().fromBufferAttribute(a,h));function c(h,d,p,f){let v=a===void 0?[]:[t.colors[h].clone(),t.colors[d].clone(),t.colors[p].clone()],g=s===void 0?[]:[new B().fromBufferAttribute(s,h),new B().fromBufferAttribute(s,d),new B().fromBufferAttribute(s,p)],m=new qO(h,d,p,g,v,f);t.faces.push(m),o!==void 0&&t.faceVertexUvs[0].push([new ve().fromBufferAttribute(o,h),new ve().fromBufferAttribute(o,d),new ve().fromBufferAttribute(o,p)]),l!==void 0&&t.faceVertexUvs[1].push([new ve().fromBufferAttribute(l,h),new ve().fromBufferAttribute(l,d),new ve().fromBufferAttribute(l,p)])}let u=e.groups;if(u.length>0)for(let h=0;h<u.length;h++){let d=u[h],p=d.start,f=d.count;for(let v=p,g=p+f;v<g;v+=3)i!==void 0?c(i.getX(v),i.getX(v+1),i.getX(v+2),d.materialIndex):c(v,v+1,v+2,d.materialIndex)}else if(i!==void 0)for(let h=0;h<i.count;h+=3)c(i.getX(h),i.getX(h+1),i.getX(h+2));else for(let h=0;h<n.count;h+=3)c(h,h+1,h+2);return this.computeFaceNormals(),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(gS).negate(),this.translate(gS.x,gS.y,gS.z),this}normalize(){this.computeBoundingSphere();let e=this.boundingSphere.center,t=this.boundingSphere.radius,i=t===0?1:1/t,r=new ht;return r.set(i,0,0,-i*e.x,0,i,0,-i*e.y,0,0,i,-i*e.z,0,0,0,1),this.applyMatrix4(r),this}computeFaceNormals(){let e=new B,t=new B;for(let i=0,r=this.faces.length;i<r;i++){let n=this.faces[i],s=this.vertices[n.a],a=this.vertices[n.b],o=this.vertices[n.c];e.subVectors(o,a),t.subVectors(s,a),e.cross(t),e.normalize(),n.normal.copy(e)}}computeVertexNormals(e=!0){let t=new Array(this.vertices.length);for(let i=0,r=this.vertices.length;i<r;i++)t[i]=new B;if(e){let i=new B,r=new B;for(let n=0,s=this.faces.length;n<s;n++){let a=this.faces[n],o=this.vertices[a.a],l=this.vertices[a.b],c=this.vertices[a.c];i.subVectors(c,l),r.subVectors(o,l),i.cross(r),t[a.a].add(i),t[a.b].add(i),t[a.c].add(i)}}else{this.computeFaceNormals();for(let i=0,r=this.faces.length;i<r;i++){let n=this.faces[i];t[n.a].add(n.normal),t[n.b].add(n.normal),t[n.c].add(n.normal)}}for(let i=0,r=this.vertices.length;i<r;i++)t[i].normalize();for(let i=0,r=this.faces.length;i<r;i++){let n=this.faces[i],s=n.vertexNormals;s.length===3?(s[0].copy(t[n.a]),s[1].copy(t[n.b]),s[2].copy(t[n.c])):(s[0]=t[n.a].clone(),s[1]=t[n.b].clone(),s[2]=t[n.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeFlatVertexNormals(){this.computeFaceNormals();for(let e=0,t=this.faces.length;e<t;e++){let i=this.faces[e],r=i.vertexNormals;r.length===3?(r[0].copy(i.normal),r[1].copy(i.normal),r[2].copy(i.normal)):(r[0]=i.normal.clone(),r[1]=i.normal.clone(),r[2]=i.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeMorphNormals(){for(let t=0,i=this.faces.length;t<i;t++){let r=this.faces[t];r.__originalFaceNormal?r.__originalFaceNormal.copy(r.normal):r.__originalFaceNormal=r.normal.clone(),r.__originalVertexNormals||(r.__originalVertexNormals=[]);for(let n=0,s=r.vertexNormals.length;n<s;n++)r.__originalVertexNormals[n]?r.__originalVertexNormals[n].copy(r.vertexNormals[n]):r.__originalVertexNormals[n]=r.vertexNormals[n].clone()}let e=new sC;e.faces=this.faces;for(let t=0,i=this.morphTargets.length;t<i;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];let n=this.morphNormals[t].faceNormals,s=this.morphNormals[t].vertexNormals;for(let a=0,o=this.faces.length;a<o;a++){let l=new B,c={a:new B,b:new B,c:new B};n.push(l),s.push(c)}}let r=this.morphNormals[t];e.vertices=this.morphTargets[t].vertices,e.computeFaceNormals(),e.computeVertexNormals();for(let n=0,s=this.faces.length;n<s;n++){let a=this.faces[n],o=r.faceNormals[n],l=r.vertexNormals[n];o.copy(a.normal),l.a.copy(a.vertexNormals[0]),l.b.copy(a.vertexNormals[1]),l.c.copy(a.vertexNormals[2])}}for(let t=0,i=this.faces.length;t<i;t++){let r=this.faces[t];r.normal=r.__originalFaceNormal,r.vertexNormals=r.__originalVertexNormals}}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new cn),this.boundingBox.setFromPoints(this.vertices)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new ja),this.boundingSphere.setFromPoints(this.vertices)}merge(e,t,i=0){if(!(e&&e.isGeometry)){console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);return}let r,n=this.vertices.length,s=this.vertices,a=e.vertices,o=this.faces,l=e.faces,c=this.colors,u=e.colors;t!==void 0&&(r=new Mn().getNormalMatrix(t));for(let h=0,d=a.length;h<d;h++){let p=a[h].clone();t!==void 0&&p.applyMatrix4(t),s.push(p)}for(let h=0,d=u.length;h<d;h++)c.push(u[h].clone());for(let h=0,d=l.length;h<d;h++){let p=l[h],f,v,g=p.vertexNormals,m=p.vertexColors,x=new qO(p.a+n,p.b+n,p.c+n);x.normal.copy(p.normal),r!==void 0&&x.normal.applyMatrix3(r).normalize();for(let w=0,_=g.length;w<_;w++)f=g[w].clone(),r!==void 0&&f.applyMatrix3(r).normalize(),x.vertexNormals.push(f);x.color.copy(p.color);for(let w=0,_=m.length;w<_;w++)v=m[w],x.vertexColors.push(v.clone());x.materialIndex=p.materialIndex+i,o.push(x)}for(let h=0,d=e.faceVertexUvs.length;h<d;h++){let p=e.faceVertexUvs[h];this.faceVertexUvs[h]===void 0&&(this.faceVertexUvs[h]=[]);for(let f=0,v=p.length;f<v;f++){let g=p[f],m=[];for(let x=0,w=g.length;x<w;x++)m.push(g[x].clone());this.faceVertexUvs[h].push(m)}}}mergeMesh(e){if(!(e&&e.isMesh)){console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e);return}e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)}mergeVertices(e=4){let t={},i=[],r=[],n=Math.pow(10,e);for(let o=0,l=this.vertices.length;o<l;o++){let c=this.vertices[o],u=Math.round(c.x*n)+"_"+Math.round(c.y*n)+"_"+Math.round(c.z*n);t[u]===void 0?(t[u]=o,i.push(this.vertices[o]),r[o]=i.length-1):r[o]=r[t[u]]}let s=[];for(let o=0,l=this.faces.length;o<l;o++){let c=this.faces[o];c.a=r[c.a],c.b=r[c.b],c.c=r[c.c];let u=[c.a,c.b,c.c];for(let h=0;h<3;h++)if(u[h]===u[(h+1)%3]){s.push(o);break}}for(let o=s.length-1;o>=0;o--){let l=s[o];this.faces.splice(l,1);for(let c=0,u=this.faceVertexUvs.length;c<u;c++)this.faceVertexUvs[c].splice(l,1)}let a=this.vertices.length-i.length;return this.vertices=i,a}setFromPoints(e){this.vertices=[];for(let t=0,i=e.length;t<i;t++){let r=e[t];this.vertices.push(new B(r.x,r.y,r.z||0))}return this}sortFacesByMaterialIndex(){let e=this.faces,t=e.length;for(let o=0;o<t;o++)e[o]._id=o;function i(o,l){return o.materialIndex-l.materialIndex}e.sort(i);let r=this.faceVertexUvs[0],n=this.faceVertexUvs[1],s,a;r&&r.length===t&&(s=[]),n&&n.length===t&&(a=[]);for(let o=0;o<t;o++){let l=e[o]._id;s&&s.push(r[l]),a&&a.push(n[l])}s&&(this.faceVertexUvs[0]=s),a&&(this.faceVertexUvs[1]=a)}toJSON(){let e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),this.parameters!==void 0){let p=this.parameters;for(let f in p)p[f]!==void 0&&(e[f]=p[f]);return e}let t=[];for(let p=0;p<this.vertices.length;p++){let f=this.vertices[p];t.push(f.x,f.y,f.z)}let i=[],r=[],n={},s=[],a={},o=[],l={};for(let p=0;p<this.faces.length;p++){let f=this.faces[p],v=!0,g=!1,m=this.faceVertexUvs[0][p]!==void 0,x=f.normal.length()>0,w=f.vertexNormals.length>0,_=f.color.r!==1||f.color.g!==1||f.color.b!==1,M=f.vertexColors.length>0,S=0;if(S=c(S,0,0),S=c(S,1,v),S=c(S,2,g),S=c(S,3,m),S=c(S,4,x),S=c(S,5,w),S=c(S,6,_),S=c(S,7,M),i.push(S),i.push(f.a,f.b,f.c),i.push(f.materialIndex),m){let A=this.faceVertexUvs[0][p];i.push(d(A[0]),d(A[1]),d(A[2]))}if(x&&i.push(u(f.normal)),w){let A=f.vertexNormals;i.push(u(A[0]),u(A[1]),u(A[2]))}if(_&&i.push(h(f.color)),M){let A=f.vertexColors;i.push(h(A[0]),h(A[1]),h(A[2]))}}function c(p,f,v){return v?p|1<<f:p&~(1<<f)}function u(p){let f=p.x.toString()+p.y.toString()+p.z.toString();return n[f]!==void 0||(n[f]=r.length/3,r.push(p.x,p.y,p.z)),n[f]}function h(p){let f=p.r.toString()+p.g.toString()+p.b.toString();return a[f]!==void 0||(a[f]=s.length,s.push(p.getHex())),a[f]}function d(p){let f=p.x.toString()+p.y.toString();return l[f]!==void 0||(l[f]=o.length/2,o.push(p.x,p.y)),l[f]}return e.data={},e.data.vertices=t,e.data.normals=r,s.length>0&&(e.data.colors=s),o.length>0&&(e.data.uvs=[o]),e.data.faces=i,e}clone(){return new sC().copy(this)}copy(e){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;let t=e.vertices;for(let h=0,d=t.length;h<d;h++)this.vertices.push(t[h].clone());let i=e.colors;for(let h=0,d=i.length;h<d;h++)this.colors.push(i[h].clone());let r=e.faces;for(let h=0,d=r.length;h<d;h++)this.faces.push(r[h].clone());for(let h=0,d=e.faceVertexUvs.length;h<d;h++){let p=e.faceVertexUvs[h];this.faceVertexUvs[h]===void 0&&(this.faceVertexUvs[h]=[]);for(let f=0,v=p.length;f<v;f++){let g=p[f],m=[];for(let x=0,w=g.length;x<w;x++){let _=g[x];m.push(_.clone())}this.faceVertexUvs[h].push(m)}}let n=e.morphTargets;for(let h=0,d=n.length;h<d;h++){let p={};if(p.name=n[h].name,n[h].vertices!==void 0){p.vertices=[];for(let f=0,v=n[h].vertices.length;f<v;f++)p.vertices.push(n[h].vertices[f].clone())}if(n[h].normals!==void 0){p.normals=[];for(let f=0,v=n[h].normals.length;f<v;f++)p.normals.push(n[h].normals[f].clone())}this.morphTargets.push(p)}let s=e.morphNormals;for(let h=0,d=s.length;h<d;h++){let p={};if(s[h].vertexNormals!==void 0){p.vertexNormals=[];for(let f=0,v=s[h].vertexNormals.length;f<v;f++){let g=s[h].vertexNormals[f],m={};m.a=g.a.clone(),m.b=g.b.clone(),m.c=g.c.clone(),p.vertexNormals.push(m)}}if(s[h].faceNormals!==void 0){p.faceNormals=[];for(let f=0,v=s[h].faceNormals.length;f<v;f++)p.faceNormals.push(s[h].faceNormals[f].clone())}this.morphNormals.push(p)}let a=e.skinWeights;for(let h=0,d=a.length;h<d;h++)this.skinWeights.push(a[h].clone());let o=e.skinIndices;for(let h=0,d=o.length;h<d;h++)this.skinIndices.push(o[h].clone());let l=e.lineDistances;for(let h=0,d=l.length;h<d;h++)this.lineDistances.push(l[h]);let c=e.boundingBox;c!==null&&(this.boundingBox=c.clone());let u=e.boundingSphere;return u!==null&&(this.boundingSphere=u.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this}toBufferGeometry(){let e=new DSe().fromGeometry(this),t=new Bt,i=new Float32Array(e.vertices.length*3);if(t.setAttribute("position",vS.call(new $t(i,3),e.vertices)),e.normals.length>0){let r=new Float32Array(e.normals.length*3);t.setAttribute("normal",vS.call(new $t(r,3),e.normals))}if(e.colors.length>0){let r=new Float32Array(e.colors.length*3);t.setAttribute("color",T6.call(new $t(r,3),e.colors))}if(e.uvs.length>0){let r=new Float32Array(e.uvs.length*2);t.setAttribute("uv",P6.call(new $t(r,2),e.uvs))}if(e.uvs2.length>0){let r=new Float32Array(e.uvs2.length*2);t.setAttribute("uv2",P6.call(new $t(r,2),e.uvs2))}t.groups=e.groups;for(let r in e.morphTargets){let n=[],s=e.morphTargets[r];for(let a=0,o=s.length;a<o;a++){let l=s[a],c=new St(l.data.length*3,3);c.name=l.name,n.push(vS.call(c,l.data))}t.morphAttributes[r]=n}if(e.skinIndices.length>0){let r=new St(e.skinIndices.length*4,4);t.setAttribute("skinIndex",D6.call(r,e.skinIndices))}if(e.skinWeights.length>0){let r=new St(e.skinWeights.length*4,4);t.setAttribute("skinWeight",D6.call(r,e.skinWeights))}return e.boundingSphere!==null&&(t.boundingSphere=e.boundingSphere.clone()),e.boundingBox!==null&&(t.boundingBox=e.boundingBox.clone()),t}computeTangents(){console.error("THREE.Geometry: .computeTangents() has been removed.")}computeLineDistances(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}applyMatrix(e){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}dispose(){this.dispatchEvent({type:"dispose"})}static createBufferGeometryFromObject(e){let t=new Bt,i=e.geometry;if(e.isPoints||e.isLine){let r=new St(i.vertices.length*3,3),n=new St(i.colors.length*3,3);if(t.setAttribute("position",vS.call(r,i.vertices)),t.setAttribute("color",T6.call(n,i.colors)),i.lineDistances&&i.lineDistances.length===i.vertices.length){let s=new St(i.lineDistances.length,1);t.setAttribute("lineDistance",RSe.call(s,i.lineDistances))}i.boundingSphere!==null&&(t.boundingSphere=i.boundingSphere.clone()),i.boundingBox!==null&&(t.boundingBox=i.boundingBox.clone())}else e.isMesh&&(t=i.toBufferGeometry());return t}};sC.prototype.isGeometry=!0;var DSe=class{constructor(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}computeGroups(e){let t=[],i,r,n,s=e.faces;for(r=0;r<s.length;r++){let a=s[r];a.materialIndex!==n&&(n=a.materialIndex,i!==void 0&&(i.count=r*3-i.start,t.push(i)),i={start:r*3,materialIndex:n})}i!==void 0&&(i.count=r*3-i.start,t.push(i)),this.groups=t}fromGeometry(e){let t=e.faces,i=e.vertices,r=e.faceVertexUvs,n=r[0]&&r[0].length>0,s=r[1]&&r[1].length>0,a=e.morphTargets,o=a.length,l;if(o>0){l=[];for(let g=0;g<o;g++)l[g]={name:a[g].name,data:[]};this.morphTargets.position=l}let c=e.morphNormals,u=c.length,h;if(u>0){h=[];for(let g=0;g<u;g++)h[g]={name:c[g].name,data:[]};this.morphTargets.normal=h}let d=e.skinIndices,p=e.skinWeights,f=d.length===i.length,v=p.length===i.length;i.length>0&&t.length===0&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(let g=0;g<t.length;g++){let m=t[g];this.vertices.push(i[m.a],i[m.b],i[m.c]);let x=m.vertexNormals;if(x.length===3)this.normals.push(x[0],x[1],x[2]);else{let _=m.normal;this.normals.push(_,_,_)}let w=m.vertexColors;if(w.length===3)this.colors.push(w[0],w[1],w[2]);else{let _=m.color;this.colors.push(_,_,_)}if(n===!0){let _=r[0][g];_!==void 0?this.uvs.push(_[0],_[1],_[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",g),this.uvs.push(new ve,new ve,new ve))}if(s===!0){let _=r[1][g];_!==void 0?this.uvs2.push(_[0],_[1],_[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",g),this.uvs2.push(new ve,new ve,new ve))}for(let _=0;_<o;_++){let M=a[_].vertices;l[_].data.push(M[m.a],M[m.b],M[m.c])}for(let _=0;_<u;_++){let M=c[_].vertexNormals[g];h[_].data.push(M.a,M.b,M.c)}f&&this.skinIndices.push(d[m.a],d[m.b],d[m.c]),v&&this.skinWeights.push(p[m.a],p[m.b],p[m.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),this}},qO=class{constructor(e,t,i,r,n,s=0){this.a=e,this.b=t,this.c=i,this.normal=r&&r.isVector3?r:new B,this.vertexNormals=Array.isArray(r)?r:[],this.color=n&&n.isColor?n:new jt,this.vertexColors=Array.isArray(n)?n:[],this.materialIndex=s}clone(){return new this.constructor().copy(this)}copy(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(let t=0,i=e.vertexNormals.length;t<i;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(let t=0,i=e.vertexColors.length;t<i;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}};function RSe(e){return this.array.set(e),this}function T6(e){let t=this.array,i=0;for(let r=0,n=e.length;r<n;r++){let s=e[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),s=new jt),t[i++]=s.r,t[i++]=s.g,t[i++]=s.b}return this}function P6(e){let t=this.array,i=0;for(let r=0,n=e.length;r<n;r++){let s=e[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),s=new ve),t[i++]=s.x,t[i++]=s.y}return this}function vS(e){let t=this.array,i=0;for(let r=0,n=e.length;r<n;r++){let s=e[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),s=new B),t[i++]=s.x,t[i++]=s.y,t[i++]=s.z}return this}function D6(e){let t=this.array,i=0;for(let r=0,n=e.length;r<n;r++){let s=e[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),s=new ti),t[i++]=s.x,t[i++]=s.y,t[i++]=s.z,t[i++]=s.w}return this}var ISe=["a","b","c"];function LSe(e,t){switch(t){case"c":return e.c;case"b":return e.b;case"a":default:return e.a}}function D3(e,t,i){let r=Math.min(e,t),n=Math.max(e,t),s=r+"_"+n;return i.get(s)}function R3(e,t,i,r,n,s){let a=Math.min(e,t),o=Math.max(e,t),l=a+"_"+o,c;if(r.has(l))c=r.get(l);else{let u=i[a],h=i[o];c={a:u,b:h,newEdge:null,faces:[]},r.set(l,c)}c.faces.push(n),s[e].edges.push(c),s[t].edges.push(c)}function OSe(e,t,i,r){let n,s,a;for(n=0,s=e.length;n<s;n++)i[n]={edges:[]};for(n=0,s=t.length;n<s;n++)a=t[n],R3(a.a,a.b,e,r,a,i),R3(a.b,a.c,e,r,a,i),R3(a.c,a.a,e,r,a,i)}function yS(e,t,i,r,n){e.push(new qO(t,i,r,void 0,void 0,n))}function qm(e,t){return Math.abs(t-e)/2+Math.min(e,t)}function xS(e,t,i,r){e.push([t.clone(),i.clone(),r.clone()])}var zSe=class{constructor(e=1){this.subdivisions=e}modify(e){e instanceof Bt?e=new sC().fromBufferGeometry(e):e=e.clone(),e.mergeVertices();let t=this.subdivisions;for(;t-- >0;)this._smooth(e);return e.computeFaceNormals(),e.computeVertexNormals(),e}_smooth(e){let t=new B,i,r,n,s,a,o=e.vertices,l=e.faces,c=e.faceVertexUvs[0],u=c!==void 0&&c.length>0,h=[],d=new Map;OSe(o,l,h,d);let p=[],f,v,g,m,x,w,_;for(let de of Array.from(d.keys())){for(v=d.get(de),g=new B,x=3/8,w=1/8,_=v.faces.length,_!=2&&(x=.5,w=0,_!=1),g.addVectors(v.a,v.b).multiplyScalar(x),t.set(0,0,0),s=0;s<_;s++){for(m=v.faces[s],a=0;a<3&&(f=o[LSe(m,ISe[a])],!(f!==v.a&&f!==v.b));a++);f&&t.add(f)}t.multiplyScalar(w),g.add(t),v.newEdge=p.length,p.push(g)}let M,S,A,T,E,C,D,I=[];for(r=0,n=o.length;r<n;r++){for(C=o[r],E=h[r].edges,i=E.length,i==3?M=3/16:i>3&&(M=3/(8*i)),S=1-i*Number(M),A=M,i<=2&&(i==2?(S=3/4,A=1/8):i==1||i==0),D=C.clone().multiplyScalar(S),t.set(0,0,0),s=0;s<i;s++)T=E[s],f=T.a!==C?T.a:T.b,t.add(f);t.multiplyScalar(Number(A)),D.add(t),I.push(D)}let L=I.concat(p),z=I.length,F,Q,Y,O=[],j=[],V,W,J,ce,$=new ve,ne=new ve,ie=new ve;for(r=0,n=l.length;r<n;r++)m=l[r],F=Number(D3(m.a,m.b,d).newEdge)+z,Q=Number(D3(m.b,m.c,d).newEdge)+z,Y=Number(D3(m.c,m.a,d).newEdge)+z,yS(O,F,Q,Y,m.materialIndex),yS(O,m.a,F,Y,m.materialIndex),yS(O,m.b,Q,F,m.materialIndex),yS(O,m.c,Y,Q,m.materialIndex),u&&(V=c[r],W=V[0],J=V[1],ce=V[2],$.set(qm(W.x,J.x),qm(W.y,J.y)),ne.set(qm(J.x,ce.x),qm(J.y,ce.y)),ie.set(qm(W.x,ce.x),qm(W.y,ce.y)),xS(j,$,ne,ie),xS(j,W,$,ie),xS(j,J,ne,$),xS(j,ce,ie,ne));e.vertices=L,e.faces=O,u&&(e.faceVertexUvs[0]=j)}},Rn=new B,NSe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=e.geometry??(t==null?void 0:t.geometry)??new Bt().copy(new Hl(100,100,100)),r;t===void 0?(i.computeBoundingBox(),i.boundingBox.getSize(Rn),r={width:Rn.x,height:Rn.y,depth:Rn.z,subdivisions:0}):r=t.parameters;let n={...r,...e.parameters};return{parameters:{width:Math.abs(n.width),height:Math.abs(n.height),depth:Math.abs(n.depth),subdivisions:Math.abs(n.subdivisions)},geometry:i}}static build(e){let{width:t,height:i,depth:r,subdivisions:n}=e.parameters,s=e.geometry??new Bt().copy(new Hl(100,100,100)),a=s.userData.parameters;a===void 0?(s.computeBoundingBox(),s.boundingBox.getSize(Rn)):Rn.set(a.width,a.height,a.depth),(t!==Rn.x||i!==Rn.y||r!==Rn.z)&&s.scale(Rn.x===0?1:t/Rn.x,Rn.y===0?1:i/Rn.y,Rn.z===0?1:r/Rn.z);let o=s.originalGeometry;try{n>0?(o===void 0||(a==null?void 0:a.subdivisions)!==n)&&(o===void 0&&(o=s),s=new zSe(n).modify(o).toBufferGeometry()):(o!==void 0&&(s=o),o=void 0,s.getAttribute("normal")===void 0&&s.computeVertexNormals())}catch{o!==void 0&&(s=o),o=void 0,s.getAttribute("normal")===void 0&&s.computeVertexNormals()}return o!==void 0&&Object.assign(s,{originalGeometry:o}),delete e.geometry,Object.assign(s,{userData:{...e,type:"NonParametricGeometry"}})}static loadFromUrl(e,t,i){new oQ(i).load(e,r=>{let n=this.normalizeInputs({geometry:r});r.boundingBox.getSize(Rn);let s=100/Rn.x;Object.assign(n.parameters,{width:100,height:Rn.y*s,depth:Rn.z*s}),t(this.build(n))})}},iZ=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:3},e.parameters);return{shape:e.shape&&e.shape instanceof Zr?e.shape:new Zr,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t,height:i,spikes:r,cornerRadius:n,depth:s,extrudeBevelSize:a,extrudeBevelSegments:o}=e.parameters,l=e.shape,c=t*.5,u=i*.5,h=0,d=0,p=2*Math.PI/r;for(let v=0;v<r;v++){let g=p*v,m=h+Math.sin(g)*c,x=d+Math.cos(g)*u;l.addPoint(l.createPoint(m,x))}l.isClosed=!0;for(let v=0,g=l.points.length;v<g;v++)l.points[v].roundness=n;l.roundness=n,l.update();let f=sm.create({shape:l,parameters:{roundness:n,depth:s,extrudeBevelSize:a,extrudeBevelSegments:o}});return Object.assign(f,{userData:{...e,type:"PolygonGeometry"}})}},BSe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,radialSegments:4,heightSegments:1,cornerRadius:0,cornerSegments:8,openEnded:!1},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:r,radialSegments:n,heightSegments:s,openEnded:a,cornerRadius:o,cornerSegments:l}=e.parameters,c=new USe(t*.5,i,n,s,a,o,l);return c.scale(1,1,r/t),Object.assign(c,{userData:{...e,type:"PyramidGeometry"}})}};function ky(e,t,i){i.x=e.x*t.x,i.y=e.y,i.z=e.x*t.y}function I3(e,t,i,r,n,s){let a=t.clone().sub(e),o=i.clone().sub(e),l=a.angleTo(o);if(a.normalize(),o.normalize(),r===n){let c=a.add(o).normalize();s.copy(e).addScaledVector(c,r/Math.sin(l/2))}else{let c=a.angleTo(o);s.copy(e),s.addScaledVector(a,n/Math.sin(c)),s.addScaledVector(o,r/Math.sin(c))}}function kSe(e,t,i){let r=e.clone().sub(t),n=i.clone().sub(t);return r.projectOnVector(n),r.add(t)}var USe=class extends Bt{constructor(e=.5,t=1,i=4,r=1,n=!1,s=0,a=4){super(),i=Math.floor(Math.max(3,i)),r=Math.floor(r),a=Math.floor(a);let o=[],l=[],c=[],u=[],h=0,d=t/2,p=Math.PI/i,f=e*Math.cos(Math.PI/i),v=2*Math.PI/i,g=(i-2)*Math.PI/i,m=Math.PI-g,x=new B(0,-d,0),w=new B(0,d,0),_=new ve(e,-d),M=new ve(f,-d),S=new ve(0,w.y).sub(M),A=new ve(0,w.y).sub(_),T=new ve(S.y,-S.x).normalize(),E=new ve(A.y,-A.x).normalize(),C=e*Math.cos(Math.PI/i)*Math.tan((Math.PI-S.angle())/2)-1e-8;s=Math.min(s,C);let D;{let Y=new B(T.x,T.y,0),O=new B(Math.cos(v)*Y.x,Y.y,Math.sin(v)*Y.x);D=Y.angleTo(O)}let I=s/Math.tan((Math.PI-S.angle())/2),L=s/Math.tan((Math.PI-D)/2),z=new B;if(!n){l.push(x.x,x.y,x.z),c.push(0,-1,0),u.push(0,0);let Y=h++,O=[],j=_.clone(),V=I/Math.cos(Math.PI/i);j.x-=V;for(let W=0;W<i;W++){let J=W/i*Math.PI*2+p,ce=new ve(Math.sin(J),Math.cos(J));ky(j,ce,z),l.push(z.x,z.y,z.z),c.push(0,-1,0),u.push(0,0),O.push(h++)}for(let W=0;W<O.length;W++)o.push(O[W],Y,O[(W+1)%O.length])}{let Y=new B,O=new B,j=new B,V=new B,W=new B,J=new B;for(let ce=0;ce<i;ce++){let $=ce/i*Math.PI*2+p,ne=(ce+.5)/i*Math.PI*2+p,ie=(ce+1)/i*Math.PI*2+p,de=new ve(Math.sin($),Math.cos($)),be=new ve(Math.sin(ne),Math.cos(ne)),we=new ve(Math.sin(ie),Math.cos(ie));ky(_,de,O),ky(_,we,j),ky(T,be,Y),I3(w,O,j,L,L,V),l.push(V.x,V.y,V.z),I3(O,w,j,L,I,W),l.push(W.x,W.y,W.z),I3(j,O,w,I,L,J),l.push(J.x,J.y,J.z),c.push(Y.x,Y.y,Y.z),c.push(Y.x,Y.y,Y.z),c.push(Y.x,Y.y,Y.z),u.push(0,0),u.push(0,0),u.push(0,0);let _e=h++,Me=h++,X=h++;if(o.push(_e,Me,X),s>0){{let Ie=O.clone().add(j).multiplyScalar(.5),Pe=w.clone().sub(Ie).normalize(),Ye=x.clone().sub(Ie).normalize().add(Pe).normalize().multiplyScalar(-1),ke=J.clone().sub(W);F(Ie,ke,Ye,S.angle())}let ge,Oe;{let Ie=new B;ky(E,we,Ie);let Pe=J.clone().add(V).multiplyScalar(.5);Pe=kSe(Pe,j,w);let Ye=J.clone().sub(V);[ge,Oe]=F(Pe,Ye,Ie,D,V.y)}{let Ie=ge,Pe=Ie.clone().setY(0).normalize(),Ye=new B(0,-1,0),ke=Pe.clone().cross(Ye);Q(Ie,Pe,Ye,ke)}{let Ie=S.angle(),Pe=Math.PI-Ie,Ye=w.clone();Ye.y-=s/Math.sin(Ie-Math.PI/2);let ke=new B,Fe=[];for(let Z=0;Z<a;Z++){let K=[],k=Math.PI/2-Pe*Z/a,re=Math.cos(k),he=Math.sin(k),G=ne;for(let Te=0;Te<=Z;Te++){let ze=Math.cos(G),Qe=Math.sin(G);Y.x=re*Qe,Y.y=he,Y.z=re*ze,ke.copy(Ye).addScaledVector(Y,s),l.push(ke.x,ke.y,ke.z),c.push(Y.x,Y.y,Y.z),u.push(0,0),K.push(h++),G+=Math.PI*2/Z/i}Fe.push(K)}Oe.reverse(),Fe.push(Oe);let se=Fe.length-1;for(let Z=0;Z<se;Z++){let K=Fe[Z],k=Fe[Z+1],re=K.length-1;o.push(k[1],K[0],k[0]);for(let he=1;he<=re;he++)o.push(K[he],K[he-1],k[he]),o.push(k[he+1],K[he],k[he])}}}}}this.setIndex(o),this.setAttribute("position",new St(l,3)),this.setAttribute("normal",new St(c,3)),this.setAttribute("uv",new St(u,2));function F(Y,O,j,V,W){let J=-V/2,ce=(Math.PI-V)/2,$=O.clone().normalize().cross(j);Y.addScaledVector(j,-s/Math.sin(ce));let ne=new B,ie=new B,de=1,be=h,we=[];for(let _e=0;_e<=a;_e++){let Me=J+_e/a*V;ie.set(0,0,0),ie.addScaledVector($,Math.sin(Me)),ie.addScaledVector(j,Math.cos(Me));for(let X=0;X<=de;X++){let ge=X/de-.5;if(ne.copy(Y),ne.addScaledVector(O,ge),ne.addScaledVector(ie,s),W!=null){let Oe=Math.max(0,ne.y-W);ne.addScaledVector(O,-Oe/O.y)}l.push(ne.x,ne.y,ne.z),c.push(ie.x,ie.y,ie.z),u.push(0,0),X===0&&we.push(h),h++}}for(let _e=0;_e<a;_e++)for(let Me=0;Me<de;Me++){let X=be+Me+(de+1)*_e,ge=X+(de+1),Oe=ge+1,Ie=X+1;o.push(X,ge,Ie),o.push(ge,Oe,Ie)}return[Y.clone().addScaledVector(O,.5),we]}function Q(Y,O,j,V){let W=Math.PI/2,J=A.angle()-W,ce=[],$=new B,ne=new B;for(let de=0;de<=a;de++){let be=[],we=de/a;for(let _e=0;_e<=de;_e++){let Me=((de?_e/de:0)-.5)*m,X=Math.cos(Me),ge=Math.sin(Me),Oe=Math.atan(Math.tan(J)*X),Ie=(W+Oe)*we,Pe=Math.cos(Ie),Ye=Math.sin(Ie);$.set(0,0,0),$.addScaledVector(O,Ye*X),$.addScaledVector(j,Pe),$.addScaledVector(V,Ye*ge),ne.copy(Y).addScaledVector($,s),l.push(ne.x,ne.y,ne.z),c.push($.x,$.y,$.z),u.push(0,0),be.push(h++)}ce.push(be)}let ie=ce.length-1;for(let de=0;de<ie;de++){let be=ce[de],we=ce[de+1],_e=be.length-1;o.push(be[0],we[1],we[0]);for(let Me=1;Me<=_e;Me++)o.push(be[Me-1],be[Me],we[Me]),o.push(be[Me],we[Me+1],we[Me])}}}},lk=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,cornerRadius:[0,0,0,0],cornerType:1,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters),r=Object.assign((t==null?void 0:t.ui)??{enabledIndieCorners:!1},e.ui);return{shape:e.shape&&e.shape instanceof Zr?e.shape:new Zr,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)}),ui:r}}static build(e){let t=e.shape,{width:i,height:r,cornerRadius:n,cornerType:s,depth:a,extrudeBevelSize:o,extrudeBevelSegments:l}=e.parameters,c={x:i*.5,y:r*.5},u={x:-c.x,y:-c.y},h={x:c.x,y:c.y};function d(_,M,S){return M>i&&S>r?Math.min(_*i/M,_*r/S):M>i?_*i/M:S>r?_*r/S:_}let p=[];p[0]=n[0]===0?0:d(n[0],n[0]+n[3],n[0]+n[1]),p[1]=n[1]===0?0:d(n[1],n[1]+n[2],n[1]+n[0]),p[2]=n[2]===0?0:d(n[2],n[2]+n[1],n[2]+n[3]),p[3]=n[3]===0?0:d(n[3],n[3]+n[0],n[3]+n[2]);let f=u.x,v=h.x,g=h.y,m=u.y;t.addPoint(t.createPoint(f,g)),t.addPoint(t.createPoint(v,g)),t.addPoint(t.createPoint(v,m)),t.addPoint(t.createPoint(f,m)),t.isClosed=!0;let x=!0;for(let _=0,M=t.points.length;_<M;_++)t.points[_].roundness=p[_],_>0&&p[_]!==p[_-1]&&(x=!1);x&&(t.roundness=p[0]),t.useCubicForRoundedCorners=s!==1,t.update();let w=sm.create({shape:t,parameters:{depth:a,extrudeBevelSize:o,extrudeBevelSegments:l}});return Object.assign(w,{userData:{...e,type:"RectangleGeometry"}})}},FSe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:180},e.parameters);return i.thetaLength=Et.clamp(i.thetaLength,0,180),{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t=100,height:i=t,depth:r=t,widthSegments:n=64,heightSegments:s=64,phiStart:a,phiLength:o,thetaStart:l,thetaLength:c}=e.parameters,u;return c===0?(u=new Bt,u.setAttribute("position",new St([],3))):u=new _v(.5*t,n,s,a,o,l,c*Et.DEG2RAD),u.scale(1,i/t,r/t),Object.assign(u,{userData:{...e,type:"SphereGeometry"}})}},VSe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,widthSegments:8,heightSegments:8},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:0})}}static build(e){let{width:t=100,height:i=t,widthSegments:r=8,heightSegments:n=8}=e.parameters,s=new hh(t,i,r,n);return s.scale(1,1,1),Object.assign(s,{userData:{...e,type:"PlaneGeometry"}})}},HSe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,angle:90,cornerRadius:24,cornerSegments:8},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:r,angle:n,cornerRadius:s,cornerSegments:a}=e.parameters,o=new GSe(t,i,r,n,s,a);return Object.assign(o,{userData:{...e,type:"BackdropGeometry"}})}},GSe=class extends Bt{constructor(e=1,t=1,i=1,r=90,n=10,s=24){super(),this.type="BackdropGeometry";let a=[],o=[],l=[],c=.001;n==0&&(s=1),s=Math.max(1,Math.floor(s)),n=Math.min(n,100),r=Math.min(180-c,r),r*=Math.PI/180;let u=[],h=Math.PI/2,d=(de=0,be=0,we=0)=>new B(de,be,we),p=d(),f=d(),[v,g,m]=[t/2,e/2,i/2],x=-g,w=+g,[_,M,S]=[d(x,-v,+m),d(x,-v,-m),d(x,+v,-m)],A=(de,be=!1)=>Math.sin(de-Math.PI/(1+ +be)),T=(de,be=!1)=>Math.cos(de-Math.PI/(1+ +be));S.y=Math.sin(r)*t-v;let E=Math.cos(r)*t-m,C=_.z-c;r<=h?(S.z=Math.min(E,C),S.z==C&&(S.y-=(E-C)/Math.tan(h-r))):M.z=Math.min(M.z-E-m,_.z-c),p.subVectors(_,M),f.subVectors(S,M);let D=Math.min(p.length(),f.length())*n/100,I=D*Math.tan(r/2),L=D/Math.cos(r/2),z=p.clone().normalize().add(f.normalize()).setLength(L).add(M);p.set(0,A(r,!0),T(r,!0)),u.push([S,p.clone()]);let F=(Math.PI-r)/s;for(let de=0;de<=s;de++){let be=h+r+de*F;p.set(0,Math.sin(be)*I,Math.cos(be)*I),p.add(z),f.set(0,A(be),T(be)),u.push([p.clone(),f.clone()])}u.push([_,d(0,1,0)]);let Q=Math.sin(F/2)*I*2,Y=u.length-1,O=u[0][0].distanceTo(u[1][0]),j=u[Y-1][0].distanceTo(u[Y][0]),V=O+Q*s+j;u[0].push(1);for(let de=0;de<=s;de++)u[de+1].push(1-(O+de*Q)/V);u[Y].push(0);let[W,J,ce]=u[0],$,ne,ie;for(let de=1;de<u.length;de++)[$,ne,ie]=u[de],a.push(x,W.y,W.z,x,$.y,$.z,w,W.y,W.z,w,W.y,W.z,x,$.y,$.z,w,$.y,$.z),o.push(0,J.y,J.z,0,ne.y,ne.z,0,J.y,J.z,0,J.y,J.z,0,ne.y,ne.z,0,ne.y,ne.z),l.push(0,ce,0,ie,1,ce,1,ce,0,ie,1,ie),[W,J,ce]=[$,ne,ie];this.setAttribute("position",new St(a,3)),this.setAttribute("normal",new St(o,3)),this.setAttribute("uv",new St(l,2))}},rZ=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,innerRadiusPercent:38.19,spikes:5,cornerRadius:0,angle:360,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters);return{shape:e.shape&&e.shape instanceof Zr?e.shape:new Zr,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t,height:i,innerRadiusPercent:r,spikes:n,cornerRadius:s,angle:a,depth:o,extrudeBevelSize:l,extrudeBevelSegments:c}=e.parameters,u=e.shape,h=t*.5,d=i*.5,p=0,f=0,v=a*Math.PI/360/n,g=Math.PI/2*3*-1,m=h*r/100,x=d*r/100;if(n===3&&r===50){v=2*Math.PI/n;for(let _=0;_<n;_++){let M=v*_,S=p+Math.sin(M)*h,A=f+Math.cos(M)*d;u.addPoint(u.createPoint(S,A))}}else for(let _=0;_<n;_++){let M=p+Math.cos(g)*h,S=f+Math.sin(g)*d;u.addPoint(u.createPoint(M,S)),g+=v,M=p+Math.cos(g)*m,S=f+Math.sin(g)*x,u.addPoint(u.createPoint(M,S)),g+=v}u.isClosed=!0;for(let _=0,M=u.points.length;_<M;_++)u.points[_].roundness=s;u.roundness=s,u.update();let w=sm.create({shape:u,parameters:{roundness:s,depth:o,extrudeBevelSize:l,extrudeBevelSegments:c}});return Object.assign(w,{userData:{...e,type:"StarGeometry"}})}},jSe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t,height:i}=e.parameters,r=new hh(t,i);return Object.assign(r,{userData:{...e,type:"TextFrameGeometry"}})}},WSe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,radialSegments:32,tubularSegments:64,arc:360,cornerRadius:30,cornerSegments:8},e.parameters),r=Math.abs(i.width),n=Math.abs(i.height??i.width),s=Math.round(Math.abs(i.depth??i.width*.25));return{parameters:Object.assign(i,{width:r,height:n,depth:s})}}static build(e){let{width:t,height:i,depth:r,radialSegments:n,tubularSegments:s,arc:a,cornerRadius:o,cornerSegments:l}=e.parameters,c=XSe(t,i,r,t*.5,a,s,0,0,n,o,l);return c.scale(1,i/t,1),Object.assign(c,{userData:{...e,type:"TorusGeometry"}})}};function XSe(e,t,i,r,n,s,a,o,l,c,u){[t,i]=[i,t],a=t/2;let h=Et.clamp(n/360,0,1);if(h===0){let d=new Bt;return d.setAttribute("position",new St([],3)),d}return h===1&&(c=0),new eZ(!0,e,t,i,r,h,s,a,o,l,c,u)}var qSe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,tubularSegments:64,radialSegments:32,p:2,q:3},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width),tube:i.tube??i.width*.125})}}static build(e){let{width:t,tube:i,tubularSegments:r,radialSegments:n,p:s,q:a}=e.parameters,o=t*.5;o!==i&&(o-=i);let l=new eQ(o,i,r,n,s,a);return Object.assign(l,{userData:{...e,type:"TorusKnotGeometry"}})}},YSe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1,isRect:!1},e.parameters);return{shape:e.shape&&e.shape instanceof Zr?e.shape:new Zr,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width*(i.isRect?1:Math.sqrt(3)/2)),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t=100,height:i,cornerRadius:r,depth:n,extrudeBevelSize:s,extrudeBevelSegments:a,isRect:o}=e.parameters,l=e.shape,c=t*.5,u=i*.5;o?(l.addPoint(l.createPoint(-c,u)),l.addPoint(l.createPoint(c,-u)),l.addPoint(l.createPoint(-c,-u))):(l.addPoint(l.createPoint(0,u)),l.addPoint(l.createPoint(c,-u)),l.addPoint(l.createPoint(-c,-u))),l.isClosed=!0;for(let d=0,p=l.points.length;d<p;d++)l.points[d].roundness=r;l.roundness=r,l.update();let h=sm.create({shape:l,parameters:{roundness:r,depth:n,extrudeBevelSize:s,extrudeBevelSegments:a}});return Object.assign(h,{userData:{...e,type:"TriangleGeometry"}})}};function QSe(e,t){let i=2*Math.PI;return(e%i+i)%i===(t%i+i)%i}var KSe=class{add(e,t,i){if(typeof arguments[0]!="string")for(let r in arguments[0])this.add(r,arguments[0][r],arguments[1]);else(Array.isArray(e)?e:[e]).forEach(function(r){this[r]=this[r]||[],t&&this[r][i?"unshift":"push"](t)},this)}run(e,t){this[e]=this[e]||[],this[e].forEach(function(i){i.call(t&&t.context?t.context:t,t)})}},ZSe=class{constructor(e){this.jsep=e,this.registered={}}register(...e){e.forEach(t=>{if(typeof t!="object"||!t.name||!t.init)throw new Error("Invalid JSEP plugin format");this.registered[t.name]||(t.init(this.jsep),this.registered[t.name]=t)})}},Ze=class{static get version(){return"1.3.8"}static toString(){return"JavaScript Expression Parser (JSEP) v"+Ze.version}static addUnaryOp(t){return Ze.max_unop_len=Math.max(t.length,Ze.max_unop_len),Ze.unary_ops[t]=1,Ze}static addBinaryOp(t,i,r){return Ze.max_binop_len=Math.max(t.length,Ze.max_binop_len),Ze.binary_ops[t]=i,r?Ze.right_associative.add(t):Ze.right_associative.delete(t),Ze}static addIdentifierChar(t){return Ze.additional_identifier_chars.add(t),Ze}static addLiteral(t,i){return Ze.literals[t]=i,Ze}static removeUnaryOp(t){return delete Ze.unary_ops[t],t.length===Ze.max_unop_len&&(Ze.max_unop_len=Ze.getMaxKeyLen(Ze.unary_ops)),Ze}static removeAllUnaryOps(){return Ze.unary_ops={},Ze.max_unop_len=0,Ze}static removeIdentifierChar(t){return Ze.additional_identifier_chars.delete(t),Ze}static removeBinaryOp(t){return delete Ze.binary_ops[t],t.length===Ze.max_binop_len&&(Ze.max_binop_len=Ze.getMaxKeyLen(Ze.binary_ops)),Ze.right_associative.delete(t),Ze}static removeAllBinaryOps(){return Ze.binary_ops={},Ze.max_binop_len=0,Ze}static removeLiteral(t){return delete Ze.literals[t],Ze}static removeAllLiterals(){return Ze.literals={},Ze}get char(){return this.expr.charAt(this.index)}get code(){return this.expr.charCodeAt(this.index)}constructor(t){this.expr=t,this.index=0}static parse(t){return new Ze(t).parse()}static getMaxKeyLen(t){return Math.max(0,...Object.keys(t).map(i=>i.length))}static isDecimalDigit(t){return t>=48&&t<=57}static binaryPrecedence(t){return Ze.binary_ops[t]||0}static isIdentifierStart(t){return t>=65&&t<=90||t>=97&&t<=122||t>=128&&!Ze.binary_ops[String.fromCharCode(t)]||Ze.additional_identifier_chars.has(String.fromCharCode(t))}static isIdentifierPart(t){return Ze.isIdentifierStart(t)||Ze.isDecimalDigit(t)}throwError(t){let i=new Error(t+" at character "+this.index);throw i.index=this.index,i.description=t,i}runHook(t,i){if(Ze.hooks[t]){let r={context:this,node:i};return Ze.hooks.run(t,r),r.node}return i}searchHook(t){if(Ze.hooks[t]){let i={context:this};return Ze.hooks[t].find(function(r){return r.call(i.context,i),i.node}),i.node}}gobbleSpaces(){let t=this.code;for(;t===Ze.SPACE_CODE||t===Ze.TAB_CODE||t===Ze.LF_CODE||t===Ze.CR_CODE;)t=this.expr.charCodeAt(++this.index);this.runHook("gobble-spaces")}parse(){this.runHook("before-all");let t=this.gobbleExpressions(),i=t.length===1?t[0]:{type:Ze.COMPOUND,body:t};return this.runHook("after-all",i)}gobbleExpressions(t){let i=[],r,n;for(;this.index<this.expr.length;)if(r=this.code,r===Ze.SEMCOL_CODE||r===Ze.COMMA_CODE)this.index++;else if(n=this.gobbleExpression())i.push(n);else if(this.index<this.expr.length){if(r===t)break;this.throwError('Unexpected "'+this.char+'"')}return i}gobbleExpression(){let t=this.searchHook("gobble-expression")||this.gobbleBinaryExpression();return this.gobbleSpaces(),this.runHook("after-expression",t)}gobbleBinaryOp(){this.gobbleSpaces();let t=this.expr.substr(this.index,Ze.max_binop_len),i=t.length;for(;i>0;){if(Ze.binary_ops.hasOwnProperty(t)&&(!Ze.isIdentifierStart(this.code)||this.index+t.length<this.expr.length&&!Ze.isIdentifierPart(this.expr.charCodeAt(this.index+t.length))))return this.index+=i,t;t=t.substr(0,--i)}return!1}gobbleBinaryExpression(){let t,i,r,n,s,a,o,l,c;if(a=this.gobbleToken(),!a||(i=this.gobbleBinaryOp(),!i))return a;for(s={value:i,prec:Ze.binaryPrecedence(i),right_a:Ze.right_associative.has(i)},o=this.gobbleToken(),o||this.throwError("Expected expression after "+i),n=[a,s,o];i=this.gobbleBinaryOp();){if(r=Ze.binaryPrecedence(i),r===0){this.index-=i.length;break}s={value:i,prec:r,right_a:Ze.right_associative.has(i)},c=i;let u=h=>s.right_a&&h.right_a?r>h.prec:r<=h.prec;for(;n.length>2&&u(n[n.length-2]);)o=n.pop(),i=n.pop().value,a=n.pop(),t={type:Ze.BINARY_EXP,operator:i,left:a,right:o},n.push(t);t=this.gobbleToken(),t||this.throwError("Expected expression after "+c),n.push(s,t)}for(l=n.length-1,t=n[l];l>1;)t={type:Ze.BINARY_EXP,operator:n[l-1].value,left:n[l-2],right:t},l-=2;return t}gobbleToken(){let t,i,r,n;if(this.gobbleSpaces(),n=this.searchHook("gobble-token"),n)return this.runHook("after-token",n);if(t=this.code,Ze.isDecimalDigit(t)||t===Ze.PERIOD_CODE)return this.gobbleNumericLiteral();if(t===Ze.SQUOTE_CODE||t===Ze.DQUOTE_CODE)n=this.gobbleStringLiteral();else if(t===Ze.OBRACK_CODE)n=this.gobbleArray();else{for(i=this.expr.substr(this.index,Ze.max_unop_len),r=i.length;r>0;){if(Ze.unary_ops.hasOwnProperty(i)&&(!Ze.isIdentifierStart(this.code)||this.index+i.length<this.expr.length&&!Ze.isIdentifierPart(this.expr.charCodeAt(this.index+i.length)))){this.index+=r;let s=this.gobbleToken();return s||this.throwError("missing unaryOp argument"),this.runHook("after-token",{type:Ze.UNARY_EXP,operator:i,argument:s,prefix:!0})}i=i.substr(0,--r)}Ze.isIdentifierStart(t)?(n=this.gobbleIdentifier(),Ze.literals.hasOwnProperty(n.name)?n={type:Ze.LITERAL,value:Ze.literals[n.name],raw:n.name}:n.name===Ze.this_str&&(n={type:Ze.THIS_EXP})):t===Ze.OPAREN_CODE&&(n=this.gobbleGroup())}return n?(n=this.gobbleTokenProperty(n),this.runHook("after-token",n)):this.runHook("after-token",!1)}gobbleTokenProperty(t){this.gobbleSpaces();let i=this.code;for(;i===Ze.PERIOD_CODE||i===Ze.OBRACK_CODE||i===Ze.OPAREN_CODE||i===Ze.QUMARK_CODE;){let r;if(i===Ze.QUMARK_CODE){if(this.expr.charCodeAt(this.index+1)!==Ze.PERIOD_CODE)break;r=!0,this.index+=2,this.gobbleSpaces(),i=this.code}this.index++,i===Ze.OBRACK_CODE?(t={type:Ze.MEMBER_EXP,computed:!0,object:t,property:this.gobbleExpression()},this.gobbleSpaces(),i=this.code,i!==Ze.CBRACK_CODE&&this.throwError("Unclosed ["),this.index++):i===Ze.OPAREN_CODE?t={type:Ze.CALL_EXP,arguments:this.gobbleArguments(Ze.CPAREN_CODE),callee:t}:(i===Ze.PERIOD_CODE||r)&&(r&&this.index--,this.gobbleSpaces(),t={type:Ze.MEMBER_EXP,computed:!1,object:t,property:this.gobbleIdentifier()}),r&&(t.optional=!0),this.gobbleSpaces(),i=this.code}return t}gobbleNumericLiteral(){let t="",i,r;for(;Ze.isDecimalDigit(this.code);)t+=this.expr.charAt(this.index++);if(this.code===Ze.PERIOD_CODE)for(t+=this.expr.charAt(this.index++);Ze.isDecimalDigit(this.code);)t+=this.expr.charAt(this.index++);if(i=this.char,i==="e"||i==="E"){for(t+=this.expr.charAt(this.index++),i=this.char,(i==="+"||i==="-")&&(t+=this.expr.charAt(this.index++));Ze.isDecimalDigit(this.code);)t+=this.expr.charAt(this.index++);Ze.isDecimalDigit(this.expr.charCodeAt(this.index-1))||this.throwError("Expected exponent ("+t+this.char+")")}return r=this.code,Ze.isIdentifierStart(r)?this.throwError("Variable names cannot start with a number ("+t+this.char+")"):(r===Ze.PERIOD_CODE||t.length===1&&t.charCodeAt(0)===Ze.PERIOD_CODE)&&this.throwError("Unexpected period"),{type:Ze.LITERAL,value:parseFloat(t),raw:t}}gobbleStringLiteral(){let t="",i=this.index,r=this.expr.charAt(this.index++),n=!1;for(;this.index<this.expr.length;){let s=this.expr.charAt(this.index++);if(s===r){n=!0;break}else if(s==="\\")switch(s=this.expr.charAt(this.index++),s){case"n":t+=`
`;break;case"r":t+="\r";break;case"t":t+="	";break;case"b":t+="\b";break;case"f":t+="\f";break;case"v":t+="\v";break;default:t+=s}else t+=s}return n||this.throwError('Unclosed quote after "'+t+'"'),{type:Ze.LITERAL,value:t,raw:this.expr.substring(i,this.index)}}gobbleIdentifier(){let t=this.code,i=this.index;for(Ze.isIdentifierStart(t)?this.index++:this.throwError("Unexpected "+this.char);this.index<this.expr.length&&(t=this.code,Ze.isIdentifierPart(t));)this.index++;return{type:Ze.IDENTIFIER,name:this.expr.slice(i,this.index)}}gobbleArguments(t){let i=[],r=!1,n=0;for(;this.index<this.expr.length;){this.gobbleSpaces();let s=this.code;if(s===t){r=!0,this.index++,t===Ze.CPAREN_CODE&&n&&n>=i.length&&this.throwError("Unexpected token "+String.fromCharCode(t));break}else if(s===Ze.COMMA_CODE){if(this.index++,n++,n!==i.length){if(t===Ze.CPAREN_CODE)this.throwError("Unexpected token ,");else if(t===Ze.CBRACK_CODE)for(let a=i.length;a<n;a++)i.push(null)}}else if(i.length!==n&&n!==0)this.throwError("Expected comma");else{let a=this.gobbleExpression();(!a||a.type===Ze.COMPOUND)&&this.throwError("Expected comma"),i.push(a)}}return r||this.throwError("Expected "+String.fromCharCode(t)),i}gobbleGroup(){this.index++;let t=this.gobbleExpressions(Ze.CPAREN_CODE);if(this.code===Ze.CPAREN_CODE)return this.index++,t.length===1?t[0]:t.length?{type:Ze.SEQUENCE_EXP,expressions:t}:!1;this.throwError("Unclosed (")}gobbleArray(){return this.index++,{type:Ze.ARRAY_EXP,elements:this.gobbleArguments(Ze.CBRACK_CODE)}}},$Se=new KSe;Object.assign(Ze,{hooks:$Se,plugins:new ZSe(Ze),COMPOUND:"Compound",SEQUENCE_EXP:"SequenceExpression",IDENTIFIER:"Identifier",MEMBER_EXP:"MemberExpression",LITERAL:"Literal",THIS_EXP:"ThisExpression",CALL_EXP:"CallExpression",UNARY_EXP:"UnaryExpression",BINARY_EXP:"BinaryExpression",ARRAY_EXP:"ArrayExpression",TAB_CODE:9,LF_CODE:10,CR_CODE:13,SPACE_CODE:32,PERIOD_CODE:46,COMMA_CODE:44,SQUOTE_CODE:39,DQUOTE_CODE:34,OPAREN_CODE:40,CPAREN_CODE:41,OBRACK_CODE:91,CBRACK_CODE:93,QUMARK_CODE:63,SEMCOL_CODE:59,COLON_CODE:58,unary_ops:{"-":1,"!":1,"~":1,"+":1},binary_ops:{"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},right_associative:new Set,additional_identifier_chars:new Set(["$","_"]),literals:{true:!0,false:!1,null:null},this_str:"this"});Ze.max_unop_len=Ze.getMaxKeyLen(Ze.unary_ops);Ze.max_binop_len=Ze.getMaxKeyLen(Ze.binary_ops);var n0=e=>new Ze(e).parse(),JSe=Object.getOwnPropertyNames(Ze);JSe.forEach(e=>{n0[e]===void 0&&e!=="prototype"&&(n0[e]=Ze[e])});n0.Jsep=Ze;var eMe="ConditionalExpression",tMe={name:"ternary",init(e){e.hooks.add("after-expression",function(t){if(t.node&&this.code===e.QUMARK_CODE){this.index++;let i=t.node,r=this.gobbleExpression();if(r||this.throwError("Expected expression"),this.gobbleSpaces(),this.code===e.COLON_CODE){this.index++;let n=this.gobbleExpression();if(n||this.throwError("Expected expression"),t.node={type:eMe,test:i,consequent:r,alternate:n},i.operator&&e.binary_ops[i.operator]<=.9){let s=i;for(;s.right.operator&&e.binary_ops[s.right.operator]<=.9;)s=s.right;t.node.test=s.right,s.right=t.node,t.node=i}}else this.throwError("Expected :")}})}};n0.plugins.register(tMe);var iMe=["+","-","*","/","(",")","==","!=",">","<",">=","<=","and","or","!","%","^",","],rMe=["0","1","2","3","4","5","6","7","8","9","."],nMe=["sin","cos","tan","asin","acos","atan","atan2","sqrt","abs","log","exp","floor","ceil","round","min","max","random"];function sMe(e){return typeof e!="string"?!1:!isNaN(e)&&!isNaN(parseFloat(e))}n0.addBinaryOp("^",11,!0);function nZ(e,t,i="number"){let r="";for(let a=0;a<e.length;a++){let o=e[a];if("objType"in o&&o.objType==="api"){let l=JSON.parse(o.id),c=l[0],u=t.getUserAPI(c);if(u!==void 0){let h=u.retrieveValue(l.slice(1));h!==void 0&&(r+=h)}continue}if("objType"in o&&o.objType==="webhook"){let l=JSON.parse(o.id),[c,u]=l,h=t.getUserWebhook(c);if(h!==void 0){let d=h.getParameterValue(u);d!==void 0&&(r+=d)}continue}if("id"in o){let l=e[a-1];if(a>0&&"id"in l){console.error("Two variables in a row",e);return}let c=t.getVariable(o.id),u=Ss.getDisplayedValue(c);i==="number"&&Ss.isTextValue(c)&&Array.isArray(c.textValue)&&c.textValue.length===1?u=parseFloat(u).toString():i==="boolean"&&Ss.isBoolean(c)?u=c?"true":"false":i==="boolean"&&Ss.isTextValue(c)&&!Array.isArray(c.textValue)&&(u='"'+u+'"'),r+=u;continue}else if(i==="string"){o.name!=='"'&&(o.name!=="+"||o.escaped)&&(r+=o.name),o.name==="+"&&!o.escaped&&r[r.length-1]==="\\"&&(r=r.slice(0,-1)+o.name);continue}if(o.name==="and"){r+="&&";continue}if(o.name==="or"){r+="||";continue}if(o.name==="True"){r+="true";continue}if(o.name==="False"){r+="false";continue}if(i==="boolean"&&!sMe(o.name)&&!rMe.includes(o.name)&&!iMe.includes(o.name)&&!nMe.includes(o.name.replace(/\($/g,""))){r+='"'+o.name+'"';continue}r+=o.name}if(i==="string")return r;if(e.length===0){if(i==="number")return 0;if(i==="boolean")return!1}let n;try{n=n0(r)}catch(a){console.error(r,a);return}let s;try{s=Li(n)}catch(a){console.error(r,n,a)}return s}function Li(e){switch(e.type){case"BinaryExpression":switch(e.operator){case"==":return+(Li(e.left)===Li(e.right));case"!=":return+(Li(e.left)!==Li(e.right));case">":return+(Li(e.left)>Li(e.right));case">=":return+(Li(e.left)>=Li(e.right));case"<":return+(Li(e.left)<Li(e.right));case"<=":return+(Li(e.left)<=Li(e.right));case"+":return Li(e.left)+Li(e.right);case"-":return Li(e.left)-Li(e.right);case"*":return Li(e.left)*Li(e.right);case"/":return Li(e.left)/Li(e.right);case"%":return Li(e.left)%Li(e.right);case"&&":return Li(e.left)&&Li(e.right);case"||":return Li(e.left)||Li(e.right);case"^":return Math.pow(Li(e.left),Li(e.right));default:throw new Error("Unknown operator: "+e.operator)}case"UnaryExpression":switch(e.operator){case"-":return-Li(e.argument);case"!":return+!Li(e.argument);default:throw new Error("Unknown operator: "+e.operator)}case"Identifier":throw new Error("Unknown identifier: "+e.name);case"Literal":return e.value;case"CallExpression":if(e.callee.type==="Identifier"){if(e.callee.name==="random"){let t=0,i=1;if(e.arguments.length>=1)try{t=Li(e.arguments[0])}catch(r){console.warn(r)}if(e.arguments.length>=2)try{i=Li(e.arguments[1])}catch(r){console.warn(r)}return t=Math.min(i,t),i=Math.max(i,t),t+Math.random()*(i-t)}return Math[e.callee.name].apply(null,e.arguments.map(Li))}else throw new Error("Unknown node");default:throw new Error("Unknown node type: "+e.type)}}var aMe=new ht,oMe=new ht;function lMe(e,t,i){let r=[new B,new B,new B],n=[new B,new B,new B];return e.extractBasis(r[0],r[1],r[2]),t.extractBasis(n[0],n[1],n[2]),r.forEach((s,a)=>{let o=n[a],l=Et.lerp(s.length(),o.length(),i);s.lerp(o,i).setLength(l)}),new ht().makeBasis(r[0],r[1],r[2])}var cMe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,height:100,depth:1,subdivisions:12,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3},e.parameters),r=Math.abs(i.width),n=Math.abs(i.height??i.width),s=Math.abs(i.depth??0),a=(t==null?void 0:t.shapeData)??ok.create({parameters:TK}).userData.shape;return{path:e.path??WA.defaultData(),parameters:Object.assign(i,{width:r,height:n,depth:s,extrusion:{...PK,...i.extrusion}}),shapeData:a}}static build(e){if(e.path.points.length>=2){let t=new uMe(e);return Object.assign(t,{userData:{...e,type:"PathGeometry"}})}else return Object.assign(new Bt,{userData:{...e,type:"PathGeometry"}})}},uMe=class extends Bt{constructor(e){super(),this.type="PathExtrusionGeometry",this.inputs=e,this.build()}_isGeometryClosed(){return this.inputs.path.isClosed&&this.inputs.parameters.extrusion.depth===1}_isOpenEnded(){let e=this.inputs.parameters.extrusion;return!(this.inputs.path.isClosed&&e.depth===1)||!QSe(e.twist,0)||e.startScale!==e.endScale}build(){let e=this._extractPathPoints();if(e.length<2)return;let t=this._computeBasisMatrices(e),{depth:i,offset:r}=this.inputs.parameters.extrusion;i=Math.max(0,Math.min(i,1)),r=Math.max(0,Math.min(r,1));let n=this.inputs.path.isClosed?e.length:e.length-1,s=Math.floor(r*n),a=this.inputs.path.isClosed?Math.ceil((i+r)*n):Math.ceil(Math.min(1,i+r)*n),o=Math.min(Math.max(2,a-s+1),n+2),l=[],c=[];for(let Y=0;Y<o;Y++){let O=this.inputs.path.isClosed?(Y+s)%e.length:Math.min(Y+s,e.length-1);l.push(e[O].clone()),c.push(t[O].clone())}let u=(Y,O,j)=>{l[Y]=l[Y].clone().lerp(l[O],j),c[Y]=lMe(c[Y],c[O],j)},h=0,d=r*n%1;(!this.inputs.path.isClosed||i<=1)&&(d||r===0)&&(h=d,u(0,1,h));let p=0,f=(r+i)*n%1;if((this.inputs.path.isClosed&&i<=1||!this.inputs.path.isClosed&&r+i<1)&&f&&(p=f,u(l.length-1,l.length-2,1-p)),i===0){let Y=l.length-1;l[Y].copy(l[0]),c[Y].copy(c[0])}this._applyPathModifiers(c,h,p);let{bevel:v,bevelSides:g}=this.inputs.parameters.extrusion,m=v>0?this.inputs.parameters.extrusion.capType:"flat",x=5;this.inputs.parameters.extrusion.shape.type==="Custom"&&(x=this.inputs.parameters.extrusion.shape.shapeQuality==="low"?5:12);let{regions:w,infos:_,vertices:M}=this._computeShapePoints(x),S=0,A;m==="round"&&(A=new ak(this.inputs.shapeData,2*v,v,x,g,void 0,!0),S=A.getAttribute("position").count);let T=0,E=0;_.sort((Y,O)=>Y.start-O.start),_.forEach(Y=>{Y.verticesStart=T,Y.verticesCount=Y.continuous.reduce((O,j,V)=>O+(V===0||!j?2:1),0),E+=Y.verticesCount,T=E});let C=E*o,D,I=0;if(this._isOpenEnded()&&m==="flat"){try{D=Cd({windingRule:sr.ODD,elementType:bn.POLYGONS,polySize:3,vertexSize:2,strict:!0,contours:w})}catch{D=qK}I=D.vertexCount}let L=C+2*I+S*2,z=C+2*I,F={positions:new Float32Array(L*3),normals:new Float32Array(L*3),uvs:new Float32Array(L*2)},Q=[];if(_.forEach(Y=>{this._extrudeRegion(Y,M,c,l,F,Q,this._isGeometryClosed()&&!this._isOpenEnded())}),D&&(this._closeEnd(D,C,Q,F,c[0],l[0],!1),this._closeEnd(D,C+I,Q,F,c[c.length-1],l[l.length-1],!0)),A){F.positions.set(A.getAttribute("position").array,z*3),F.normals.set(A.getAttribute("normal").array,z*3),F.uvs.set(A.getAttribute("uv").array,z*2);for(let V=z;V<z+S;V++)F.uvs[V*2+1]=1e-4;let Y=Q.length;Q.push(...A.getIndex().array.map(V=>V+z)),z+=S,F.positions.set(A.getAttribute("position").array,z*3),F.normals.set(A.getAttribute("normal").array,z*3),F.uvs.set(A.getAttribute("uv").array,z*2);let O=Q.length;Q.push(...A.getIndex().array.map(V=>V+z)),this.setAttribute("position",new $t(F.positions,3)),this.setAttribute("normal",new $t(F.normals,3)),this.setAttribute("uv",new $t(F.uvs,2)),this.setIndex(Q);let j=aMe;j.copy(c[c.length-1]).setPosition(l[l.length-1]),this.applyMatrix4OnRange(j,z,L),j.copy(c[0]).setPosition(l[0]).multiply(oMe.makeScale(1,1,-1)),this.applyMatrix4OnRange(j,z-S,z),this.reverseIndicesOnRange(Y,O)}else this.setAttribute("position",new $t(F.positions,3)),this.setAttribute("normal",new $t(F.normals,3)),this.setAttribute("uv",new $t(F.uvs,2)),this.setIndex(Q)}_extractPathPoints(){let e=kK(this.inputs.path).getPoints(this.inputs.path.subdivisions);if(e.length<2)return[];let t=[e[0]];return e.forEach(i=>{t[t.length-1].distanceToSquared(i)>.001&&t.push(i)}),this.inputs.path.isClosed&&t[t.length-1].distanceTo(t[0])<.001&&t.pop(),t}_computeBasisMatrices(e){let t=[],i=e.length,r=this.inputs.path.isClosed,n=new B,s=new B,a=new B,o=new B,l=new B(0,1,0);for(let f=0;f<i;f++){let v=e[f],g;f===0?g=r?e[e.length-2]:v.clone().multiplyScalar(2).sub(e[1]):g=e[f-1];let m;f===i-1?m=r?e[1]:v.clone().multiplyScalar(2).sub(e[f-1]):m=e[f+1];let x=v.clone().sub(g).normalize(),w=m.clone().sub(v).normalize(),_=x.clone().add(w).normalize();a.copy(_),f===0&&(_.equals(l)||_.clone().negate().equals(l))&&l.set(0,0,1);let M=l.clone().cross(_).normalize(),S=_.clone().cross(M).normalize();l.copy(S),o.copy(M),f===0&&(n.copy(S),s.copy(_));let A=new ht().makeBasis(M,S,_);t.push(A)}let c=r?s:a,u=r?n:new B(0,1,0),h=c.clone().cross(o).normalize(),d=Math.acos(u.dot(h));if(isNaN(d))return t;let p=u.clone().cross(h);c.dot(p)>0&&(d*=-1);for(let f=1;f<t.length;f++){let v=new ht().makeRotationZ(d*f/t.length);t[f].multiply(v)}return t}_applyPathModifiers(e,t,i){let r=e.length,{angle:n,twist:s,startScale:a,endScale:o}=this.inputs.parameters.extrusion,l=new ht,c=new ht;return e.forEach((u,h)=>{let d=h===0?0:h===r-1?1:(h-t)/(r-(i===0?0:1)-(t+(1-i)));l.makeRotationZ(Et.lerp(n,n+s,d)*Et.DEG2RAD);let p=Et.lerp(a,o,d);c.makeScale(p,p,p),u.multiply(l).multiply(c)}),e}_computeShapePoints(e=12,t=sr.ODD){let i=this.inputs.shapeData,r=i.extractShapePointsToFlatArray([],e),n=i.shapeHoles.map(c=>{let u=c.extractShapePointsToFlatArray([],e),h=[];for(let d=u.length-1;d>=1;d-=2){let p=u[d-1],f=u[d-0];h.push(p,f)}return h}),s;try{s=Cd({windingRule:t,elementType:bn.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[r]})}catch{s=sk}let a;try{a=Cd({windingRule:sr.ODD,elementType:bn.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...n]})}catch{a=XK}if(!s)throw new Error("error generating geometry");let o=s.elementCount;if(a){s.elementCount+=a.elementCount;for(let c=0;c<a.elements.length;c++){let u=a.elements[c],h=c%2===0?s.vertexCount:0;s.elements.push(u+h)}for(let c=0;c<a.vertexIndices.length;c++){let u=a.vertexIndices[c],h=s.vertexCount;s.vertexIndices.push(u+h)}for(let c=0;c<a.vertices.length;c++){let u=a.vertices[c];s.vertices.push(u)}}for(let c=0,u=s.vertexCount;c<u;c++){let h=c*2;s.vertices[h+0],s.vertices[h+1]}let l=[];for(let c=s.elementCount-1;c>=0;c--){let u=c>=o,h=c*2,d=s.elements[h+0],p=s.elements[h+1],f=d+p,v={start:d,count:p,normals:[],isHole:u,continuous:[],verticesStart:0,verticesCount:0};l.push(v);let g=d,m=f-1,x=d+1,w=i.roundedCurves.length;do{let _=g-d;s.vertices[m*2+0],s.vertices[m*2+1];let M=s.vertices[g*2+0],S=s.vertices[g*2+1],A=s.vertices[x*2+0],T=s.vertices[x*2+1],E=M-A,C=S-T,D=Math.sqrt(E*E+C*C);E/=D,C/=D,v.normals[_*2+0]=-C,v.normals[_*2+1]=E;let I=s.vertexIndices[g];if(Array.isArray(I))v.continuous[_]=!1;else{let[L,z]=i.getCurveIndexFromVertexId(I-1,!0);if(z>0&&z<1)v.continuous[_]=!0;else{let F=z===1?L+1:L-1;F=(F+w)%w;let Q=z===1?0:1,Y=i.roundedCurves[L].getTangent(z),O=i.roundedCurves[F].getTangent(Q);v.continuous[_]=Y.dot(O)>.95}}u&&(v.normals[_*2+0]*=-1,v.normals[_*2+1]*=-1),[m,g,x]=[g,x,x+1],x>=f&&(x-=p)}while(x!==d+1)}return{regions:[r,...n],infos:l,vertices:s.vertices}}_insertVertex(e,t,i,r,n){let s=t*2,a=t*3;e.positions[a+0]=i.x,e.positions[a+1]=i.y,e.positions[a+2]=i.z,e.normals[a+0]=r.x,e.normals[a+1]=r.y,e.normals[a+2]=r.z,e.uvs[s+0]=n.x,e.uvs[s+1]=n.y}_extrudeRegion(e,t,i,r,n,s,a){let o=new B,l=new B,c=new B,u=new B,h=new ve;i.forEach((p,f)=>{let v=r[f],g=e.verticesStart*i.length+e.verticesCount*f;for(let m=0;m<e.count;m++){let x=(e.start+m)*2;if(o.set(t[x+0],t[x+1],0),c.copy(o).applyMatrix4(p).add(v),e.continuous[m])u.set(e.normals[m*2+0],e.normals[m*2+1],0);else{let w=m===0?(e.start+e.count-1)*2:x-2;l.set(t[w+0],t[w+1],0),u.copy(o).sub(l),u.set(-u.y,u.x,0),e.isHole||u.negate()}if(u.applyMatrix4(p).normalize(),h.set(m===0?1:m/e.count,f/(i.length-1)),this._insertVertex(n,g,c,u,h),g++,!e.continuous[m]||m===0){if(m===0)u.set(e.normals[m*2+0],e.normals[m*2+1],0),h.set(0,f/(i.length-1));else{let w=m===e.count-1?e.start*2:x+2;l.set(t[w+0],t[w+1],0),u.copy(l).sub(o),u.set(-u.y,u.x,0),e.isHole||u.negate()}u.applyMatrix4(p).normalize(),this._insertVertex(n,g,c,u,h),g++}}});let d=i.length-1;for(let p=0;p<d;p++){let f=e.verticesStart*i.length+e.verticesCount*p,v=e.verticesStart*i.length+e.verticesCount*(p+1),g=0;for(let m=0;m<e.count;m++){(!e.continuous[m]||m===0)&&g++;let x=m===e.count-1?0:g+1,w=f+g,_=f+x,M=v+x,S=v+g;e.isHole?s.push(w,M,_,w,S,M):s.push(w,_,M,w,M,S),g++}}}_closeEnd(e,t,i,r,n,s,a){let o=e.vertexCount,l=new B(0,0,a?-1:1).applyMatrix4(n),c=new B,u=new ve;for(let d=0;d<o;d++){let p=2*d;c.set(e.vertices[p+0],e.vertices[p+1],0).applyMatrix4(n).add(s),this._insertVertex(r,t+d,c,l,u)}let h=e.elements;for(let d=0;d<e.elementCount;d++){let p=3*d,f=h[p+0]+t,v=h[p+(a?1:2)]+t,g=h[p+(a?2:1)]+t;i.push(f,v,g)}}applyMatrix4OnRange(e,t,i){let r=e.elements,n=new Mn().getNormalMatrix(e).elements,s,a,o,l,c=this.attributes.position,u=this.attributes.normal;if(!c||!u)return;let h=c.array,d=u.array,p=c.itemSize;for(let f=t*p,v=i*p;f<v;f+=p){if(f===t)debugger;s=h[f+0],a=h[f+1],o=h[f+2],l=1/(r[3]*s+r[7]*a+r[11]*o+r[15]),h[f+0]=(r[0]*s+r[4]*a+r[8]*o+r[12])*l,h[f+1]=(r[1]*s+r[5]*a+r[9]*o+r[13])*l,h[f+2]=(r[2]*s+r[6]*a+r[10]*o+r[14])*l,s=d[f+0],a=d[f+1],o=d[f+2],d[f+0]=n[0]*s+n[3]*a+n[6]*o,d[f+1]=n[1]*s+n[4]*a+n[7]*o,d[f+2]=n[2]*s+n[5]*a+n[8]*o}c.needsUpdate=!0,u.needsUpdate=!0}reverseIndicesOnRange(e,t){let i=this.index;if(i){for(let r=e;r<t;r+=3){let n=i.getX(r),s=i.getX(r+1),a=i.getX(r+2);i.setXYZ(r,a,s,n)}i.needsUpdate=!0}}};function sZ(){let e=new Bt;return e.setAttribute("position",new $t(new Float32Array([]),3)),e.setIndex(new $t(new Uint16Array([]),1)),e}var hMe=sZ().attributes,dMe=12,pMe=1,YO=class extends Bt{constructor(e,t){super(),this.charWidths=[],this.charCoords=[],this.wrappedText=[],this.isLowResolution=!1,this.vectorShapes=[],Object.assign(this.attributes,hMe),this.userData={parameters:e,type:"TextGeometry"};let i=t.getFont(e.font);i!=null&&i.isLoaded?(this.font=i,this.update(e)):this.updateFont(e.font,t).then(()=>{this.update(e),t==null||t.requestRender()})}async updateFont(e,t){let i=t.getFont(e);i&&(this.font=i,await i.loadingPromise)}update(e){let t=this.font;if(this.userData={parameters:e,type:"TextGeometry"},!(t!=null&&t.isLoaded)){console.warn("Cannot update text because its font is not loaded");return}let{width:i,height:r,depth:n,extrudeBevelSize:s,extrudeBevelSegments:a,text:o,textTransform:l}=e,c=Ss.getDisplayedValue(o),u=l===2?c.toUpperCase():l===3?c.toLowerCase():c,h=fMe(e,t,u),{shapes:d,charWidths:p,charCoords:f}=t.generateShapes(h,e),v=(typeof i=="number"?i:1)*.5,g=(typeof r=="number"?r:1)*.5,m=d.map(_=>new Zr().fromShape(_,!0));this.vectorShapes=m;let x=m.map(_=>sm.create({shape:_,parameters:{depth:n,extrudeBevelSegments:a,extrudeBevelSize:s,windingRule:n<=0?sr.NONZERO:sr.ODD,subdivisions:this.isLowResolution&&n>0?pMe:dMe}})),w=x.length?df(x):sZ();w.translate(-v,g,0),this.dispose(),this.wrappedText=h,this.charCoords=f,this.charWidths=p,this.deleteAttribute("extrudeNormal"),Object.entries(w.attributes).forEach(([_,M])=>{this.setAttribute(_,M)}),this.setIndex(w.index),this.computeBoundingSphere()}clone(){let e=nl(new Bt,YO.prototype);return e.copy(this),console.log("CloneGeometry",this,e),e}copy(e){return Object.entries(e.attributes).forEach(([t,i])=>{this.setAttribute(t,i)}),this.setIndex(e.index),this.userData={parameters:{...e.userData.parameters},type:"TextGeometry"},this}async setText(e){this.font&&await this.font.loadingPromise,await this.update({...this.userData.parameters,text:{textValue:e}})}get text(){return this.userData.parameters.text??""}};function fMe(e,t,i){let r=[""],n="";for(let s of i)n+=s,s===" "||s===`
`?(r[r.length-1]+=n,n="",s===`
`&&r.push("")):t.getTextWidth(r[r.length-1]+n,e)>e.width&&(r[r.length-1].length&&r.push(""),t.getTextWidth(r[r.length-1]+n,e)>e.width&&(n.length===1?(r[r.length-1]+=n,n=""):(r[r.length-1]+=n.slice(0,-1),n=n[n.length-1],r.push(""))));return r[r.length-1]+=n,r}var aZ,oZ=new Promise(e=>{aZ=e}),R6=!1,wS;function mMe(){if(R6)return;if(wS)return wS;async function e(){let t="https://unpkg.com/@splinetool/modelling-wasm@1.9.25/build",i=ip(()=>import("./process-B9H0U9ag.js"),[]),[r,n]=await Promise.all([i,fetch(`${t}/process.wasm`).then(o=>o.arrayBuffer())]),s=r.default,a=await s({wasmBinary:n});aZ(a),R6=!0}return wS=e(),wS}var gMe=["font"];function Z1(e,t,i,r){var c,u;let n,s,a;e.type==="PathGeometry"?(s=JSON.parse(JSON.stringify(e)),a=[[],["extrusion"]]):(s={...e},a=[[]]);for(let h of a){let d=s;for(let p of h)d=d[p];for(n in d){let p=d[n];LG(p)&&!gMe.includes(n)&&(d[n]=t.getVariable(p,[r.uuid,"geometry",...h,n]),LG(d[n])&&(d[n]=1))}}let o={parameters:s,type:s.type};if(s.type==="PathGeometry")o.path=s.path;else if(s.type==="VectorGeometry"){let h=Zr.createFromState(s.shape,s.width,s.height);o.shape=h}else if(s.type==="NonParametricGeometry"){if(s.data.groups&&((c=s.data.groups)==null||c.forEach(h=>h.materialIndex=Math.max(h.materialIndex??0,0))),o.geometry=new oQ().parse(s),o.geometry.groups.length===0){let h=o.geometry;h.addGroup(0,Math.max(((u=h.getIndex())==null?void 0:u.count)??0,h.getAttribute("position").count),0)}}else if(s.type==="SubdivGeometry"){let h=new ha(s,i);return h.data=e,h}else{if(s.type==="TextGeometry")return new YO(s,t);if(s.type==="InputGeometry")return new YO(s,t);if(s.type==="UIGeometry")return lk.create({parameters:{width:s.width,height:s.height,cornerRadius:s.cornerRadius,cornerType:s.cornerType}})}let l;try{l=N6(o)}catch(h){console.error(h)}if(!l){let h=Zr.createFromState(jA.defaultData(),100,100);o.shape=h,l=N6(o)}return l}var vMe=new ht;function QO(e,t,i,r){let n=e.position.array,s=e.normal.array,a=vMe.makeScale(t,i,r).invert().elements,o,l,c;for(var u=0,h=n.length;u<h;u+=3)n[u]*=t,n[u+1]*=i,n[u+2]*=r,o=s[u],l=s[u+1],c=s[u+2],s[u]=a[0]*o+a[4]*l+a[8]*c,s[u+1]=a[1]*o+a[5]*l+a[9]*c,s[u+2]=a[2]*o+a[6]*l+a[10]*c;e.position.needsUpdate=!0,e.normal.needsUpdate=!0}var bS=new cn,Ym=new B,Xt;oZ.then(e=>{Xt=e});var I6=new Float32Array([10,10,0,-10,10,0,-10,-10,0,10,-10,0]),L6=new Uint32Array([0,1,2,3]),O6=new Uint8Array([4]),ha=class extends Bt{constructor(e,t){super(),this.data=e,this.flatShading=t,this.subdivPointer=0,this.rebuild(),this.freeSubdivPointer()}mutateDirectlyScaleBaked(e,t){this.freeSubdivPointer();let i=this.data.scaleBaked,r=Af.div(t,i);this.subdividedGeometry&&QO(this.subdividedGeometry.attributes,...r),this.originalGeometry&&QO(this.originalGeometry.attributes,...r),this.data=e;let n=this.userData.parameters;this.userData.parameters={width:n.width*r[0],height:n.height*r[1],depth:n.depth*r[2]},this.originalGeometry.boundingSphere.center.multiply(Ym.fromArray(r));let s=Ym.set(n.width,n.height,n.depth).length();this.originalGeometry.boundingSphere.radius=s/2}ensureSubdivPointer(){return this.subdivPointer===0&&this.rebuild(),this.subdivPointer}rebuild(){let e,t,i;try{({originalGeometry:e,subdividedGeometry:t,subdivPointer:i}=ha.build(this.data,void 0,!this.flatShading,void 0))}catch{e=new Hl(100,100,100),i=0}this.subdivPointer=i,this.originalGeometry=e,this.subdividedGeometry=t??void 0;let r=this.subdividedGeometry??this.originalGeometry;Object.assign(this,r),this.calcBoundingBox()}freeSubdivPointer(){this.subdivPointer&&(ha.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0)}dispose(){super.dispose(),this.freeSubdivPointer()}calcBoundingBox(){let e=this.originalGeometry;e.boundingSphere===null&&(e.boundingSphere=new ja,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=e.boundingSphere));let t=e.attributes.position,i=e.boundingSphere.center;bS.setFromBufferAttribute(t),bS.getCenter(i),e.boundingSphere.radius=i.distanceTo(bS.max),isNaN(e.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),bS.getSize(Ym);let r={width:Ym.x,height:Ym.y,depth:Ym.z};return this.userData.parameters=r,r}static build(e,t,i,r){let n,s,a,o=(e==null?void 0:e.phongAngle)??35;i===!1&&(o=-1),t&&(Xt.free_bvh(t),Xt.free_subdivision_surface(t));try{n=ha.allocate(e,r)}catch(l){console.error(l,e),n=ha.allocate({positionWASM:I6,indexWASM:L6,verticesPerFaceWASM:O6},r)}if(Xt.set_destination_refinement_level(n,0),s=ha.buildLevel(n,!0,o),e.subdivisions>0)try{Xt.set_destination_refinement_level(n,e.subdivisions),a=ha.buildLevel(n,!1,o)}catch{try{Xt.set_destination_refinement_level(n,e.subdivisions-1),a=ha.buildLevel(n,!1,o)}catch{a=null}}else a=null;return{subdivPointer:n,originalGeometry:s,subdividedGeometry:a}}static primitiveToQuads(e,t,i){e.widthSegments>16&&(e.widthSegments=16),e.heightSegments>16&&(e.heightSegments=16),e.depthSegments>16&&(e.depthSegments=16),e.radialSegments>16&&(e.radialSegments=16),e.type==="DodecahedronGeometry"&&(e.detail=0);let r=e.shape!==void 0||e.path!==void 0?t.geometry:Z1(e,i,!1),n;e.type==="TorusGeometry"&&e.arc===Math.PI*2?n=r.getClosedTorusIndicesForBooleanOrSubdiv():n=r.getIndex();let s,a,o,l;({positions:s,triIndices:l}=FT(r.getAttribute("position"),n));let c;if(e.type==="CylinderGeometry"&&e.cornerRadius===0&&e.hollow===0&&e.openEnded===!1){let u=e.radialSegments*e.heightSegments*3*2,h=u+e.radialSegments*3;c=[u,h]}return{indices:a,verticesPerFace:o}=lZ(s,l,r,c),{positions:s,indices:a,verticesPerFace:o}}static allocate(e,t){var w;let i,r,n,s=[],a=[];e.positionWASM&&e.positionWASM.length>0?(i=e.positionWASM,r=e.indexWASM,n=e.verticesPerFaceWASM):(i=I6,r=L6,n=O6);let o=i.length,l=r.length,c=n.length,u=i.length+s.length+a.length,h=r.length+n.length,d=u*Float32Array.BYTES_PER_ELEMENT+h*Uint32Array.BYTES_PER_ELEMENT,p=u*Float32Array.BYTES_PER_ELEMENT,f=Xt._malloc(d),v=new Float32Array(Xt.HEAPF32.buffer,f,u),g=new Uint32Array(Xt.HEAPU32.buffer,f+p,h);v.set(i,0),v.set(s,i.length),v.set(a,i.length+s.length),g.set(r,0),g.set(n,r.length);let m;(w=e==null?void 0:e.scaleBaked)!=null&&w.some(_=>_!==1)&&(m=new ht().makeScale(...e.scaleBaked)),t&&(m?m.premultiply(t):m=t);let x=m?Xt.alloc_subdivision_surface2(f,o,f+p,l,f+p+r.length*Uint32Array.BYTES_PER_ELEMENT,c,m.elements):Xt.alloc_subdivision_surface(f,o,f+p,l,f+p+r.length*Uint32Array.BYTES_PER_ELEMENT,c);return Xt._free(f),x}static buildLevel(e,t,i,r,n){let s=n?Xt.get_mesh_data2(e,t?Xt.Level.CONTROL:Xt.Level.REFINED,i,n.elements):Xt.get_mesh_data(e,t?Xt.Level.CONTROL:Xt.Level.REFINED,i),a=8,o=Xt.HEAPU32.subarray(s>>2,(s>>2)+a),l=o.subarray(4,8),c=0,u=Xt.HEAPU32[o[c]>>2],h=Xt.HEAPF32.subarray(u>>2,(u>>2)+l[c]);c++;let d=Xt.HEAPU32[o[c]>>2],p=Xt.HEAPF32.subarray(d>>2,(d>>2)+l[c]);c++;let f=Xt.HEAPU32[o[c]>>2],v=Xt.HEAPU32.subarray(f>>2,(f>>2)+l[c]);c++;let g=Xt.HEAPU32[o[c]>>2],m=Xt.HEAPU32.subarray(g>>2,(g>>2)+l[c]);if(c++,r===void 0){let x=new Bt;if(x.setIndex(new bv(m,1)),x.setAttribute("position",new St(h,3)),x.setAttribute("normal",new St(p,3)),t){x.setAttribute("faceMap",new bv(v,1));let w=new Float32Array(p.length/3*4).fill(0);x.setAttribute("color",new $t(w,4))}return Xt.free_mesh_data(s),x.userData.type="SubdivGeometry",x}r.getAttribute("position").copyArray(h),r.getAttribute("normal").copyArray(p),r.attributes.position.needsUpdate=!0,r.attributes.normal.needsUpdate=!0,Xt.free_mesh_data(s)}static freeSubdivPointer(e){Xt.free_bvh(e),Xt.free_subdivision_surface(e)}static buildControlCageWireframe(e,t,i){let r=Xt.get_wireframe_data_for_base_level(e),n=4,s=Xt.HEAPU32.subarray(r>>2,(r>>2)+n),a=s.subarray(2,4),o=0,l=Xt.HEAPU32[s[o]>>2],c=Xt.HEAPF32.subarray(l>>2,(l>>2)+a[o]);o++;let u=Xt.HEAPU32[s[o]>>2],h=Xt.HEAPU32.subarray(u>>2,(u>>2)+a[o]);if(t===void 0){let d=new Bt;d.setAttribute("position",new St(c,3));let p=new Float32Array(c.length);for(let f=0,v=c.length;f<v;)p[f++]=i.r,p[f++]=i.g,p[f++]=i.b;return d.setAttribute("color",new $t(p,3)),d.setIndex(new bv(h,1)),Xt.free_wireframe_data_for_base_level(r),d}t.getAttribute("position").copyArray(c),t.attributes.position.needsUpdate=!0,Xt.free_wireframe_data_for_base_level(r)}static updateCollabMesh(e,t,i){let r=t===0;r||Xt.set_destination_refinement_level(e,t);let n=i?Xt.get_topological_data2(e,r?Xt.Level.CONTROL:Xt.Level.REFINED,i.elements):Xt.get_topological_data(e,r?Xt.Level.CONTROL:Xt.Level.REFINED),s=6,a=Xt.HEAPU32.subarray(n>>2,(n>>2)+s),o=a.subarray(3,6),l=0,c=Xt.HEAPU32[a[l]>>2],u=new Float32Array(Xt.HEAPF32.subarray(c>>2,(c>>2)+o[l]));l++;let h=Xt.HEAPU32[a[l]>>2],d=new Uint32Array(Xt.HEAPU32.subarray(h>>2,(h>>2)+o[l]));l++;let p=Xt.HEAPU32[a[l]>>2],f=new Uint8Array(Xt.HEAPU32.subarray(p>>2,(p>>2)+o[l]));return Xt.free_topological_data(n),{positions:u,indices:d,verticesPerFace:f}}},z6=["getX","getY","getZ"];function FT(e,t){let i={},r=t?t.count:e.count,n=0,s=[],a=[],o=1e4;for(let c=0;c<r;c++){let u=t?t.getX(c):c,h="";for(let d=0;d<3;d++)h+=`${~~(e[z6[d]](u)*o)},`;if(h in i)s.push(i[h]);else{for(let d=0;d<3;d++)a.push(e[z6[d]](u));i[h]=n,s.push(n),n++}}let l=[];for(let c=0;c<s.length;c+=3)s[c]===s[c+1]||s[c]===s[c+2]||s[c+1]===s[c+2]||l.push(s[c],s[c+1],s[c+2]);return{positions:a,triIndices:l}}var _S=new B,L3=new B,O3=new B,z3=new B;function lZ(e,t,i,r){let n=[],s=[];if(i.userData.shape!==void 0&&i.userData.parameters.depth===0&&i.userData.shape.shapeHoles.length===0){let l=i.userData.shape.extractShapePointsToFlatArray([]),c=i.userData.parameters.spikes;if(i.userData.type==="EllipseGeometry"&&c<=24&&c%4===0&&i.userData.parameters.angle>=360){let d=l.length/2/c;l=l.filter((p,f)=>Math.floor(f/2)%d===0)}let u=0;for(let d=0;d<l.length;d+=2)u+=(l[d]-l[(d===0?l.length:d)-2])*(l[d+1]+l[(d===0?l.length:d)-1]);e.length=0;let h=0;if(u<0)for(let d=0;d<l.length;d+=2)e.push(l[d],l[d+1],0),n.push(h++);else for(let d=l.length-2;d>=0;d-=2)e.push(l[d],l[d+1],0),n.push(h++);return s.push(h),{indices:n,verticesPerFace:s}}let a=new Float32Array([i.userData.parameters.depth])[0],o=0;for(;o<t.length;){if(i.useNgonForTopBottomFaceDuringBake){let l=0;if((e[t[o]*3+2]===a||e[t[o]*3+2]===0)&&l++,(e[t[o+1]*3+2]===a||e[t[o+1]*3+2]===0)&&l++,(e[t[o+2]*3+2]===a||e[t[o+2]*3+2]===0)&&l++,l===3)break}if(t[o+1]===t[o+3]&&t[o+2]===t[o+5]||t[o+0]===t[o+3]&&t[o+2]===t[o+4]){_S.set(e[t[o]*3],e[t[o]*3+1],e[t[o]*3+2]),L3.set(e[t[o+1]*3],e[t[o+1]*3+1],e[t[o+1]*3+2]),O3.set(e[t[o+4]*3],e[t[o+4]*3+1],e[t[o+4]*3+2]),z3.set(e[t[o+5]*3],e[t[o+5]*3+1],e[t[o+5]*3+2]),L3.sub(_S).normalize(),O3.sub(_S).normalize(),z3.sub(_S).normalize();let l=L3.cross(O3).dot(z3);Math.abs(l)>.005||r&&r.some((c,u)=>u%2===1?!1:o>=r[u]&&o<r[u+1])?(n.push(t[o],t[o+1],t[o+2]),s.push(3),o+=3):(n.push(t[o],t[o+1],t[o+4],t[o+5]),s.push(4),o+=6)}else n.push(t[o],t[o+1],t[o+2]),s.push(3),o+=3}if(i.useNgonForTopBottomFaceDuringBake){let l=[],c=[],u=0;for(let h=0,d=0;h<e.length;h+=3,d++)e[h+2]===0&&(l.push(d),u++),e[h+2]===a&&c.push(d);if(i.userData.parameters.extrudeBevelSize===0){let h=c[0];c[0]=c[1],c[1]=h}l.reverse(),n.push(...l,...c),s.push(u,u)}return{indices:n,verticesPerFace:s}}var Du={};Mae(Du,{calcBoolean:()=>_Me,calcBooleanTopological:()=>bMe,freeMeshSet:()=>AMe,getMeshSet:()=>SMe,hasOpenEdges:()=>MMe,transformMeshSet:()=>EMe});var cZ,yMe=new Promise(e=>{cZ=e}),SS;function xMe(){if(SS)return SS;async function e(){let t="https://unpkg.com/@splinetool/boolean-wasm@1.9.25/build",i=ip(()=>import("./boolean-BpCokwB2.js"),[]),[r,n]=await Promise.all([i,fetch(`${t}/boolean.wasm`).then(o=>o.arrayBuffer())]),s=r.default,a=await s({wasmBinary:n});cZ(a)}return SS=e(),SS}var Si,Tv;yMe.then(e=>Si=e);function wMe(e,t,i){let r,n;e.userData.parameters.type==="TorusGeometry"&&e.userData.parameters.arc===Math.PI*2?n=e.getClosedTorusIndicesForBooleanOrSubdiv():n=e.getIndex();let{positions:s,triIndices:a}=FT(e.getAttribute("position"),n),o;if(t&&i){let{indices:l,verticesPerFace:c}=lZ(s,a,e);o=c.length,r=[];for(let u=0,h=0;u<o;u++){r.push(c[u]);for(let d=0;d<c[u];d++)r.push(l[h++])}}else{let l=a.length;r=Array(l+l/3),o=0;for(let c=0,u=0;u<r.length;)r[u++]=3,o++,r[u++]=a[c++],r[u++]=a[c++],r[u++]=a[c++]}return{positions:s,faceIndices:r,nFaces:o}}function uZ(e){let t=e.length,i=t*Uint32Array.BYTES_PER_ELEMENT,r=t*Float32Array.BYTES_PER_ELEMENT,n=Number.isInteger(e[0])?i:r,s=Si._malloc(n);return(Number.isInteger(e[0])?new Uint32Array(Si.HEAPU32.buffer,s,t):new Float32Array(Si.HEAPF32.buffer,s,t)).set(e,0),s}function hZ(e){switch(e){case 0:return Si.OP.UNION;case 1:return Si.OP.INTERSECTION;case 2:return Si.OP.A_MINUS_B;case 3:return Si.OP.B_MINUS_A;case 4:return Si.OP.SYMMETRIC_DIFFERENCE;case 5:return Si.OP.ALL;default:throw new Error("Unknown boolean operation "+e)}}function bMe(e,t){Tv===void 0&&(Tv=Si.init_csg());let i=uZ(e),r=Si.csg_calc_topological(Tv,i,e.length,hZ(t));Si._free(i);let n=6,s=Si.HEAPU32.subarray(r>>2,(r>>2)+n),a=s.subarray(3,6),o=0,l=Si.HEAPU32[s[o]>>2],c=new Float32Array(Si.HEAPF32.subarray(l>>2,(l>>2)+a[o]));o++;let u=Si.HEAPU32[s[o]>>2],h=new Uint32Array(Si.HEAPU32.subarray(u>>2,(u>>2)+a[o]));o++;let d=Si.HEAPU32[s[o]>>2],p=new Uint8Array(Si.HEAPU32.subarray(d>>2,(d>>2)+a[o]));return Si.free_mesh_data(r),{positions:c,indices:h,verticesPerFace:p}}function _Me(e,t,i,r){Tv===void 0&&(Tv=Si.init_csg());let n=uZ(e),s=Si.csg_calc(Tv,n,e.length,r,hZ(t));Si._free(n);let a=5,o=Si.HEAPU32.subarray(s>>2,(s>>2)+a),l=o.subarray(2,5),c=0,u=Si.HEAPU32[o[c]>>2],h=Si.HEAPF32.subarray(u>>2,(u>>2)+l[c]);c++;let d=Si.HEAPU32[o[c]>>2],p=Si.HEAPF32.subarray(d>>2,(d>>2)+l[c]);c++;let f=l[c];i.setAttribute("position",new St(h,3)),i.setAttribute("normal",new St(p,3));let v=Si.HEAPF32.subarray((s>>2)+5,(s>>2)+5+6);return i.boundingSphere===null&&(i.boundingSphere=new ja),i.boundingSphere.center.set(v[0],v[1],v[2]),i.boundingSphere.radius=(v[3]**2+v[4]**2+v[5]**2)**.5,i.userData.parameters={width:v[3]*2,height:v[4]*2,depth:v[5]*2},Si.free_mesh_data(s),f}function SMe(e,t,i){if(Si===void 0)return-1;let r,n,s;if(t&&e.userData.positions!==void 0){let g=e.userData;s=g.verticesPerFace.length,r=g.positions,n=Array(g.verticesPerFace.reduce((m,x)=>m+x,0)+s);for(let m=0,x=0,w=0;m<g.verticesPerFace.length;m++){n[w++]=g.verticesPerFace[m];for(let _=0;_<g.verticesPerFace[m];_++)n[w++]=g.indices[x++]}}else({positions:r,faceIndices:n,nFaces:s}=wMe(e,t,i));let a=r.length,o=n.length,l=r.length,c=n.length,u=l*Float32Array.BYTES_PER_ELEMENT+c*Uint32Array.BYTES_PER_ELEMENT,h=l*Float32Array.BYTES_PER_ELEMENT,d=Si._malloc(u),p=new Float32Array(Si.HEAPF32.buffer,d,l),f=new Uint32Array(Si.HEAPU32.buffer,d+h,c);p.set(r,0),f.set(n,0);let v=Si.get_csg_mesh(d,a,d+h,o,s);return Si._free(d),v}function MMe(e){return Si.has_open_edges(e)}function EMe(e,t){Si.transform_csg_mesh(e,t.elements)}function AMe(e){Si.free_csg_mesh(e)}var CMe={ConeGeometry:X_e,CubeGeometry:q_e,CylinderGeometry:UK,DodecahedronGeometry:Q_e,EllipseGeometry:ok,HelixGeometry:CSe,IcosahedronGeometry:TSe,LatheGeometry:PSe,NonParametricGeometry:NSe,PolygonGeometry:iZ,PyramidGeometry:BSe,RectangleGeometry:lk,SphereGeometry:FSe,PlaneGeometry:VSe,BackdropGeometry:HSe,StarGeometry:rZ,TextFrameGeometry:jSe,TorusGeometry:WSe,TorusKnotGeometry:qSe,TriangleGeometry:YSe,PathGeometry:cMe,VectorGeometry:sm},N6=e=>CMe[e.type].create(e);function Qm(e){return e!==null&&"booleanOp"in e}var dZ=class extends tk(zr){constructor(){super(...arguments),this.booleanMeshSetAddress=-1,this.booleanWasTransformed=!1,this.booleanMatrixInvOld=new ht}updateVisible(e){super.updateVisible(e),this.visible=!Qm(this.parent)&&this.visible,Qm(this.parent)&&this.parent.invalidateDownstreamBooleanData()}freeBooleanPointer(){this.booleanMeshSetAddress!==-1&&(Du.freeMeshSet(this.booleanMeshSetAddress),this.booleanMeshSetAddress=-1)}invalidateDownstreamBooleanData(e=!1){return e?this.booleanWasTransformed=!0:this.freeBooleanPointer(),Qm(this.parent)?this.parent.invalidateDownstreamBooleanData():this}invalidateUpstreamBooleanData(){this.freeBooleanPointer();for(let e of this.children)e instanceof dZ&&(e.freeBooleanPointer(),Qm(e)&&e.invalidateUpstreamBooleanData())}updateTransformState(e,t){let i=super.updateTransformState(e,t);return i&&Qm(this.parent)&&this.invalidateDownstreamBooleanData(!0),i}onVariableUpdate(e=!1){super.onVariableUpdate(e),Qm(this.parent)&&this.invalidateDownstreamBooleanData(!0)}},MS=new cn;function ck(e,t=0,i=e.count,r,n){let s=1/0,a=1/0,o=1/0,l=-1/0,c=-1/0,u=-1/0;for(let h=t;h<i;h++){let d=e.getX(h),p=e.getY(h),f=e.getZ(h);d<s&&(s=d),p<a&&(a=p),f<o&&(o=f),d>l&&(l=d),p>c&&(c=p),f>u&&(u=f)}MS.min.set(s,a,o),MS.max.set(l,c,u),MS.getCenter(r),MS.getSize(n).multiplyScalar(.5)}var TMe=new Bt,PMe=new uh,wa=class extends dZ{constructor(e,t){super(TMe,PMe),this.super_Entity(e,t)}updateState(e,t){this.updateState_Entity(e,t)}updateEntityBoxSize(e,t){let i=this.geometry.getAttribute("position");i!==void 0?ck(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,e,t):super.updateEntityBoxSize(e,t)}},ud=class{constructor(e){if(this.hashProperties=void 0,this.isNode=!0,this.shortcuts={},ud.uuidContext===null)throw new Error("plz startContext");ud.uuidContext===ud.globalContext?this.uuid="_gid"+ud.uuidContext.nodeContextUuid++:this.uuid="_uid"+ud.uuidContext.nodeContextUuid++,this.type=e,this.name=""}static startContext(e){this.uuidContext===null||this.uuidContext===ud.globalContext?this.uuidContext=e:console.error("Can't start context twice")}static endContext(e){this.uuidContext!==e&&console.error("Can't end context twice"),this.uuidContext=null}analyze(e,t){t=t??{},e.analyzing=!0,this.build(e.addFlow(t.slot,t.cache,t.context),"v4"),e.clearVertexNodeCode(),e.clearFragmentNodeCode(),e.removeFlow(),e.analyzing=!1}analyzeAndFlow(e,t,i){return i=i??{},this.analyze(e,i),this.flow(e,t,i)}flow(e,t,i){i=i??{},e.addFlow(i.slot,i.cache,i.context);let r={result:this.build(e,t),code:e.clearNodeCode(),extra:e.context.extra};return e.removeFlow(),r}build(e,t,i){t=t??this.getType(e,t);let r=e.getNodeData(i??this);return e.analyzing&&this.appendDepsNode(e,r,t),e.nodes.indexOf(this)===-1&&e.nodes.push(this),this.updateFrame!==void 0&&e.updaters.indexOf(this)===-1&&e.updaters.push(this),this.generate(e,t,i)}updateFrame(e){}generateReadonly(e,t,i,r,n,s){return""}generate(e,t,i,r,n){return""}parse(e,t,i,r){}appendDepsNode(e,t,i){t.deps=(t.deps||0)+1;let r=e.getTypeLength(i);(r>(t.outputMax||0)||this.getType(e,i))&&(t.outputMax=r,t.output=i)}setName(e){this.name=e}getName(){return this.name}getType(e,t){return t==="sampler2D"||t==="samplerCube"?t:this.type}},zn=ud;zn.globalContext={nodeContextUuid:0},zn.uuidContext=ud.globalContext;var B6=class{constructor(e){e=e??{},this.name=e.name,this.type=e.type,this.node=e.node,this.size=e.size,this.needsUpdate=e.needsUpdate}get value(){return this.node.value}set value(e){this.node.value=e}},DMe=class{constructor(){this.nodes={},this.keywords={}}add(e){this.nodes[e.name]=e}addKeyword(e,t,i){i=i!==void 0?i:!0,this.keywords[e]={callback:t,cache:i}}remove(e){delete this.nodes[e.name]}removeKeyword(e){delete this.keywords[e]}get(e){return this.nodes[e]}getKeyword(e,t){return this.keywords[e].callback(t)}getKeywordData(e){return this.keywords[e]}contains(e){return this.nodes[e]!==void 0}containsKeyword(e){return this.keywords[e]!==void 0}},za=new DMe,lr=class extends zn{constructor(e,t){super(e),this.scope="",t=t??{},this.shared=t.shared!==void 0?t.shared:!0,this.unique=t.unique!==void 0?t.unique:!1}build(e,t,i,r){if(t=t??this.getType(e),this.getShared(e,t)){let n=this.getUnique(e,t);n&&this.uuid===void 0&&(this.uuid=Et.generateUUID()),i=e.getUUID(i??this.getUUID(),!n);let s=e.getNodeData(i),a=s.output||this.getType(e);if(e.analyzing)return(s.deps||0)>0||this.getLabel()?(this.appendDepsNode(e,s,t),this.generate(e,t,i)):super.build(e,t,i);if(n)return s.name=s.name||super.build(e,t,i),s.name;if(!this.getLabel()&&(!this.getShared(e,a)||e.context.ignoreCache||s.deps===1))return super.build(e,t,i);i=this.getUUID(!1);let o=this.getTemp(e,i);if(o)return e.format(o,a,t);{o=super.generate(e,t,i,s.output,r);let l=this.generate(e,a,i);return e.addNodeCode(o+" = "+l+";"),e.format(o,a,t)}}return super.build(e,t,i)}getShared(e,t){return t!=="sampler2D"&&t!=="samplerCube"&&this.shared}getUnique(e,t){return this.unique}setLabel(e){return this.label=e,this}getLabel(){return this.label}getUUID(e){let t=this.uuid;return typeof this.scope=="string"&&(t=this.scope+"-"+t),t}getTemp(e,t){t=t||this.uuid;let i=e.getVars()[t];return i?i.name:void 0}generate(e,t,i,r,n){return this.getShared(e,t)||console.error("TempNode is not shared"),i=i??this.uuid,e.getTempVar(i,r??this.getType(e),n,this.getLabel()).name}},Xa=class extends lr{constructor(e,t){t=t??{},t.shared=t.shared!==void 0?t.shared:!1,super(e,t),this.readonly=!1}setReadonly(e){return this.readonly=e,this.hashProperties=this.readonly?["value"]:void 0,this}getReadonly(){return this.readonly}generate(e,t,i,r,n,s){i=e.getUUID(i??this.getUUID()),r=r??this.getType(e);let a=e.getNodeData(i);return this.getReadonly()&&this.generateReadonly!==void 0?this.generateReadonly(e,t,i,r,n,s):e.isShader("vertex")?(a.vertex||(a.vertex=e.createVertexUniform(r,this,n,s,this.getLabel())),e.format(a.vertex.name,r,t)):(a.fragment||(a.fragment=e.createFragmentUniform(r,this,n,s,this.getLabel())),e.format(a.fragment.name,r,t))}},gs=class extends Xa{constructor(e=0,t){super("v2"),this.nodeType="Vector2",this.value=e instanceof ve?e:new ve(e,t)}get x(){return this.value.x}set x(e){this.value.x=e}get y(){return this.value.y}set y(e){this.value.y=e}generateReadonly(e,t,i,r,n,s){return e.format("vec2("+this.value.x+", "+this.value.y+")",r,t)}},Bo=class extends Xa{constructor(e=0,t,i){super("v3"),this.nodeType="Vector3",this.value=e instanceof B?e:new B(e,t,i)}get x(){return this.value.x}set x(e){this.value.x=e}get y(){return this.value.y}set y(e){this.value.y=e}get z(){return this.value.z}set z(e){this.value.z=e}generateReadonly(e,t,i,r,n,s){return e.format("vec3("+this.value.x+", "+this.value.y+", "+this.value.z+")",r,t)}},Es=class extends jt{constructor(e,t,i,r){super(e,t,i),this.isColorA=!0,this.a=r}setRGBA(e,t,i,r){super.setRGB(e,t,i),this.a=r}copy(e){return super.copy(e),this.a="a"in e?e.a:1,this}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}equals(e){return super.equals(e)&&this.a===e.a}setStyle(e,t="srgb"){let i;if(e==="transparent")return this.setRGBA(0,0,0,0),this;if(i=/^((?:rgb|hsl)a?)\(([^)]*)\)/.exec(e)){let r,n=i[1],s=i[2];switch(n){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.a=n==="rgba"?parseFloat(r[4]):1,super.setStyle(e,t);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)%\s*,\s*(\d*\.?\d+)%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.a=n==="hsla"?parseFloat(r[4]):1,super.setStyle(e,t);break}}return super.setStyle(e,t)}get x(){return this.r}get y(){return this.g}get z(){return this.b}get w(){return this.a}set x(e){this.r=e}set y(e){this.g=e}set z(e){this.b=e}set w(e){this.a=e}},Ru=class extends Xa{constructor(e){super("v4"),this.nodeType="Vector4",this.value=e instanceof Es?e:new Es(e.r,e.g,e.b,e.a)}generateReadonly(e,t,i,r,n,s){return e.format("vec4("+this.value.r+", "+this.value.g+", "+this.value.b+", "+this.value.a+")",r,t)}},RMe=/^\s*([a-z_0-9]+)\s([a-z_0-9]+)\s*\((.*?)\)/i,k6=/[a-z_0-9]+/gi,_t=class extends lr{constructor(t,i,r,n,s){super(s),this.src="",this.nodeType="Function",this.useKeywords=!0,this.includes=[],this.extensions={},this.keywords={},this.isMethod=s===void 0,this.isInterface=!1,this.parse(t,i,r,n)}getShared(t,i){return!this.isMethod}getType(t){return t.getTypeByFormat(this.type)}getInputByName(t){if(this.inputs){let i=this.inputs.length;for(;i--;)if(this.inputs[i].name===t)return this.inputs[i]}}getIncludeByName(t){if(this.includes){let i=this.includes.length;for(;i--;)if(this.includes[i].name===t)return this.includes[i]}}generate(t,i,r,n,s){let a,o=0,l=this.src;if(this.includes)for(let u=0;u<this.includes.length;u++)t.include(this.includes[u],this);for(let u in this.extensions)t.extensions[u]=!0;let c=[];for(;a=k6.exec(this.src);)c.push(a);for(let u=0;u<c.length;u++){let h=c[u],d=h[0],p=this.isMethod?!this.getInputByName(d):!0,f=d;if(this.keywords[d]||this.useKeywords&&p&&za.containsKeyword(d)){let v=this.keywords[d];if(!v){let g=za.getKeywordData(d);g.cache&&(v=t.keywords[d]),v=v||za.getKeyword(d,t),g.cache&&(t.keywords[d]=v)}f=v.build(t)}d!==f&&l[h.index+o-1]!=="."&&(l=l.substring(0,h.index+o)+f+l.substring(h.index+d.length+o),o+=f.length-d.length),this.getIncludeByName(f)===void 0&&za.contains(f)&&t.include(za.get(f))}return i==="source"?l:this.isMethod?(this.isInterface||t.include(this,void 0,l),this.name):t.format("( "+l+" )",this.getType(t),i)}parse(t,i,r,n){if(this.src=t||"",this.includes=i??[],this.extensions=r??{},this.keywords=n??{},this.isMethod){let s=RMe.exec(this.src);if(this.inputs=[],s&&s.length==4){this.type=s[1],this.name=s[2];let a=s[3].match(k6);if(a){let o=0;for(;o<a.length;){let l=a[o++],c;l==="in"||l==="out"||l==="inout"?c=a[o++]:(c=l,l="");let u=a[o++];this.inputs.push({name:u,type:c,qualifier:l})}}this.isInterface=this.src.indexOf("{")===-1}else this.type="",this.name=""}}},IMe=/^([a-z_0-9]+)\s([a-z_0-9]+)\s?\=?\s?(.*?)(\;|$)/i,pZ=class extends lr{constructor(e="",t){super(),this.src="",this.useDefine=!1,this.nodeType="Const",this.parse(e||pZ.PI,void 0,void 0,void 0,t)}getType(e){return e.getTypeByFormat(this.type)}parse(e,t,i,r,n){this.src=e||"";let s,a,o="",l=IMe.exec(e);this.useDefine=n??this.src.charAt(0)==="#",l&&l.length>1?(a=l[1],s=l[2],o=l[3]):(s=this.src,a="f"),this.name=s,this.type=a,this.value=o}build(e,t){if(t==="source"){if(this.value)return this.useDefine?"#define "+this.name+" "+this.value:"const "+this.type+" "+this.name+" = "+this.value+";";if(this.useDefine)return this.src}return e.include(this),e.format(this.name,this.getType(e),t)}generate(e,t,i,r,n){return e.format(this.name,this.getType(e),t)}},nr=pZ;nr.PI="PI",nr.PI2="PI2",nr.RECIPROCAL_PI="RECIPROCAL_PI",nr.RECIPROCAL_PI2="RECIPROCAL_PI2",nr.LOG2="LOG2",nr.EPSILON="EPSILON";var LMe=new RegExp(`^structs*([a-z_0-9]+)s*{s*((.|
)*?)}`,"gim"),OMe=new RegExp("s*(w*?)s*(w*?)(=|;)","gim"),fZ=class extends lr{constructor(e=""){super(),this.inputs=[],this.src="",this.nodeType="Struct",this.parse(e)}getType(e){return e.getTypeByFormat(this.name)}getInputByName(e){let t=this.inputs.length;for(;t--;)if(this.inputs[t].name===e)return this.inputs[t]}generate(e,t,i,r,n){return t==="source"?this.src+";":e.format("( "+this.src+" )",this.getType(e),t)}parse(e=""){this.src=e,this.inputs=[];let t=LMe.exec(e);if(t){let i=t[2],r;for(;r=OMe.exec(i);)this.inputs.push({type:r[1],name:r[2]});this.name=t[1]}else this.name="";this.type=this.name}},uk=class extends lr{constructor(e){super("v2",{shared:!1}),this.nodeType="UV",this.index=e??0}generate(e,t){e.requires.uv[this.index]=!0;let i=this.index>0?this.index+1:"",r=e.isShader("vertex")?"uv"+i:"vUv"+i;return e.format(r,this.getType(e),t)}};za.addKeyword("uv",function(){return new uk});za.addKeyword("uv2",function(){return new uk(1)});var Bg=class extends lr{constructor(e,t){super("v4"),this.nodeType="ColorSpace",this.input=e,this.method=t??Bg.LINEAR_TO_LINEAR,this.hashProperties=["method"]}static getEncodingComponents(e){switch(e){case Vl:return["Linear"];case hi:return["sRGB"];default:return[]}}generate(e,t){var a;let i=this.input.build(e,"v4"),r=this.getType(e),n=Bg.Nodes[this.method],s=e.include(n);if(s===Bg.LINEAR_TO_LINEAR)return e.format(i,r,t);if(((a=n.inputs)==null?void 0:a.length)===2){let o=this.factor.build(e,"f");return e.format(s+"( "+i+", "+o+" )",r,t)}else return e.format(s+"( "+i+" )",r,t)}fromEncoding(e){let t=Bg.getEncodingComponents(e);this.method="LinearTo"+t[0],this.factor=t[1]}fromDecoding(e){let t=Bg.getEncodingComponents(e);this.method=t[0]+"ToLinear",this.factor=t[1]}},Rc=Bg;Rc.Nodes={LinearToLinear:new _t(["vec4 LinearToLinear( in vec4 value ) {","	return value;","}"].join(`
`)),sRGBToLinear:new _t(["vec4 sRGBToLinear( in vec4 value ) {","	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );","}"].join(`
`)),LinearTosRGB:new _t(["vec4 LinearTosRGB( in vec4 value ) {","	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );","}"].join(`
`))},Rc.LINEAR_TO_LINEAR="LinearToLinear",Rc.SRGB_TO_LINEAR="sRGBToLinear",Rc.LINEAR_TO_SRGB="LinearTosRGB";var xr=class extends _t{constructor(e="",t,i,r,n){super(e,n,r,i,t),this.nodeType="Expression"}},Fu=class extends Xa{constructor(e=new Br,t,i,r){super("v4",{shared:!0}),this.nodeType="Texture",this.value=e,this.uv=t??new uk,this.bias=i,this.project=r!==void 0?r:!1}getTexture(e,t){return super.generate(e,t,this.value.uuid,"t")}generate(e,t){if(t==="sampler2D")return this.getTexture(e,t);let i=this.getTexture(e,t),r=this.uv.build(e,this.project?"v4":"v2"),n=this.bias?this.bias.build(e,"f"):void 0;n===void 0&&e.context.bias&&(n=e.context.bias.setTexture(this).build(e,"f"));let s,a;this.project?s="texture2DProj":s=n?"tex2DBias":"tex2D",n?a=s+"( "+i+", "+r+", "+n+" )":a=s+"( "+i+", "+r+" )";let o={include:e.isShader("vertex"),ignoreCache:!0},l=this.getType(e);return e.addContext(o),this.colorSpace=this.colorSpace??new Rc(new xr("",l)),this.colorSpace.fromDecoding(e.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(a),a=this.colorSpace.build(e,l),e.removeContext(),e.format(a,l,t)}},Tt=class extends Xa{constructor(t){super("f"),this.nodeType="Float",this.value=t??0}generateReadonly(t,i,r,n,s,a){return t.format(this.value+(this.value%1?"":".0"),n,i)}},U6=class extends lr{constructor(e,t){super(),this.inputs=[],this.nodeType="FunctionCall",this.value=e,this.inputs=t??[]}getFunction(){return this.value}getType(e){return this.value.getType(e)}generate(e,t,i,r,n){r=this.getType(e);let s=this.value,a=s.build(e,t)+"( ",o=[];if(s.inputs){for(let l=0;l<s.inputs.length;l++){let c=s.inputs[l],u=this.inputs[l]||this.inputs[c.name];o.push(u.build(e,e.getTypeByFormat(c.type)))}a+=o.join(", ")+" )"}return e.format(a,r,t)}},mZ=class extends lr{constructor(e,t,i=mZ.ADD){super(),this.nodeType="Operator",this.type=e.type,this.a=e,this.b=t,this.op=i}getType(e){let t=this.a.getType(e),i=this.b.getType(e);return e.isTypeMatrix(t)?"v4":e.getTypeLength(i)>e.getTypeLength(t)?i:t}generate(e,t){let i=this.getType(e);this.type=i;let r=this.a.build(e,i),n=this.b.build(e,i);return e.format("( "+r+" "+this.op+" "+n+" )",i,t)}},Da=mZ;Da.ADD="+",Da.SUB="-",Da.MUL="*",Da.DIV="/";var rr=class extends lr{constructor(e,t=rr.ABS,i,r){super(),this.nodeType="Math",this.a=e,typeof t!="string"?this.b=t:r=t,typeof i!="string"?this.c=i:r=i,this.method=r,this.hashProperties=["method"]}getNumInputs(e){switch(this.method){case rr.MIX:case rr.CLAMP:case rr.REFRACT:case rr.SMOOTHSTEP:case rr.FACEFORWARD:return 3;case rr.MIN:case rr.MAX:case rr.MOD:case rr.STEP:case rr.REFLECT:case rr.DISTANCE:case rr.DOT:case rr.CROSS:case rr.POW:return 2;default:return 1}}getInputType(e){let t=e.getTypeLength(this.a.getType(e)),i=this.b?e.getTypeLength(this.b.getType(e)):0,r=this.c?e.getTypeLength(this.c.getType(e)):0;return t>i&&t>r?this.a.getType(e):i>r?this.b.getType(e):this.c.getType(e)}getType(e){switch(this.method){case rr.LENGTH:case rr.DISTANCE:case rr.DOT:return"f";case rr.CROSS:return"v3"}return this.getInputType(e)}generate(e,t){let i,r,n,s=this.a?e.getTypeLength(this.a.getType(e)):0,a=this.b?e.getTypeLength(this.b.getType(e)):0,o=this.c?e.getTypeLength(this.c.getType(e)):0,l=this.getInputType(e),c=this.getType(e);switch(this.type=c,this.method){case rr.NEGATE:return e.format("( -"+this.a.build(e,l)+" )",l,t);case rr.INVERT:return e.format("( 1.0 - "+this.a.build(e,l)+" )",l,t);case rr.CROSS:i=this.a.build(e,"v3"),r=this.b.build(e,"v3");break;case rr.STEP:i=this.a.build(e,s===1?"f":l),r=this.b.build(e,l);break;case rr.MIN:case rr.MAX:case rr.MOD:i=this.a.build(e,l),r=this.b.build(e,a===1?"f":l);break;case rr.REFRACT:i=this.a.build(e,l),r=this.b.build(e,l),n=this.c.build(e,"f");break;case rr.MIX:i=this.a.build(e,l),r=this.b.build(e,l),n=this.c.build(e,o===1?"f":l);break;default:i=this.a.build(e,l),this.b&&(r=this.b.build(e,l)),this.c&&(n=this.c.build(e,l));break}let u=[];u.push(i),r&&u.push(r),n&&u.push(n);let h=this.getNumInputs(e);if(u.length!==h)throw Error(`Arguments not match used in "${this.method}". Require ${h}, currently ${u.length}.`);return e.format(this.method+"( "+u.join(", ")+" )",c,t)}},li=rr;li.RAD="radians",li.DEG="degrees",li.EXP="exp",li.EXP2="exp2",li.LOG="log",li.LOG2="log2",li.SQRT="sqrt",li.INV_SQRT="inversesqrt",li.FLOOR="floor",li.CEIL="ceil",li.NORMALIZE="normalize",li.FRACT="fract",li.SATURATE="saturate",li.SIN="sin",li.COS="cos",li.TAN="tan",li.ASIN="asin",li.ACOS="acos",li.ARCTAN="atan",li.ABS="abs",li.SIGN="sign",li.LENGTH="length",li.NEGATE="negate",li.INVERT="invert",li.MIN="min",li.MAX="max",li.MOD="mod",li.STEP="step",li.REFLECT="reflect",li.DISTANCE="distance",li.DOT="dot",li.CROSS="cross",li.POW="pow",li.MIX="mix",li.CLAMP="clamp",li.REFRACT="refract",li.SMOOTHSTEP="smoothstep",li.FACEFORWARD="faceforward";var Mx=class extends lr{constructor(e,t,i){super("v4"),this.nodeType="TextureCubeUV",this.value=e,this.uv=t,this.bias=i}bilinearCubeUV(e,t,i,r){let n=new U6(Mx.Nodes.bilinearCubeUV,[t,i,r]);this.colorSpaceTL=this.colorSpaceTL??new Rc(new xr("","v4")),this.colorSpaceTL.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTL.input.parse(n.build(e)+".tl"),this.colorSpaceTR=this.colorSpaceTR??new Rc(new xr("","v4")),this.colorSpaceTR.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTR.input.parse(n.build(e)+".tr"),this.colorSpaceBL=this.colorSpaceBL??new Rc(new xr("","v4")),this.colorSpaceBL.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBL.input.parse(n.build(e)+".bl"),this.colorSpaceBR=this.colorSpaceBR??new Rc(new xr("","v4")),this.colorSpaceBR.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBR.input.parse(n.build(e)+".br");let s={include:e.isShader("vertex"),ignoreCache:!0};e.addContext(s),this.colorSpaceTLExp=new xr(this.colorSpaceTL.build(e,"v4"),"v4"),this.colorSpaceTRExp=new xr(this.colorSpaceTR.build(e,"v4"),"v4"),this.colorSpaceBLExp=new xr(this.colorSpaceBL.build(e,"v4"),"v4"),this.colorSpaceBRExp=new xr(this.colorSpaceBR.build(e,"v4"),"v4"),e.removeContext();let a=new xr("mix( mix( cubeUV_TL, cubeUV_TR, cubeUV.f.x ), mix( cubeUV_BL, cubeUV_BR, cubeUV.f.x ), cubeUV.f.y )","v4");return a.keywords.cubeUV_TL=this.colorSpaceTLExp,a.keywords.cubeUV_TR=this.colorSpaceTRExp,a.keywords.cubeUV_BL=this.colorSpaceBLExp,a.keywords.cubeUV_BR=this.colorSpaceBRExp,a.keywords.cubeUV=n,a}generate(e,t){if(e.isShader("fragment")){let i=this.uv,r=this.bias||e.context.roughness,n=new U6(Mx.Nodes.roughnessToMip,[r]),s=new li(n,Mx.Nodes.m0,Mx.Nodes.cubeUV_maxMipLevel,li.CLAMP),a=new li(s,li.FLOOR),o=new li(s,li.FRACT),l=this.bilinearCubeUV(e,this.value,i,a),c=this.bilinearCubeUV(e,this.value,i,new Da(a,new Tt(1).setReadonly(!0),Da.ADD)),u=new li(l,c,o,li.MIX);return e.format(u.build(e),"v4",t)}else return console.warn("TextureCubeUVNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),t)}},KO=Mx;KO.Nodes=function(){let e=new fZ(`struct TextureCubeUVData {
			vec4 tl;
			vec4 tr;
			vec4 br;
			vec4 bl;
			vec2 f;
		}`),t=new nr("float cubeUV_maxMipLevel 8.0",!0),i=new nr("float cubeUV_minMipLevel 4.0",!0),r=new nr("float cubeUV_maxTileSize 256.0",!0),n=new nr("float cubeUV_minTileSize 16.0",!0),s=new _t(`float getFace(vec3 direction) {
				vec3 absDirection = abs(direction);
				float face = -1.0;
				if (absDirection.x > absDirection.z) {
					if (absDirection.x > absDirection.y)
						face = direction.x > 0.0 ? 0.0 : 3.0;
					else
						face = direction.y > 0.0 ? 1.0 : 4.0;
				} else {
					if (absDirection.z > absDirection.y)
						face = direction.z > 0.0 ? 2.0 : 5.0;
					else
						face = direction.y > 0.0 ? 1.0 : 4.0;
				}
				return face;
		}`);s.useKeywords=!1;let a=new _t(`vec2 getUV(vec3 direction, float face) {
				vec2 uv;
				if (face == 0.0) {
					uv = vec2(direction.z, direction.y) / abs(direction.x); // pos x
				} else if (face == 1.0) {
					uv = vec2(-direction.x, -direction.z) / abs(direction.y); // pos y
				} else if (face == 2.0) {
					uv = vec2(-direction.x, direction.y) / abs(direction.z); // pos z
				} else if (face == 3.0) {
					uv = vec2(-direction.z, direction.y) / abs(direction.x); // neg x
				} else if (face == 4.0) {
					uv = vec2(-direction.x, direction.z) / abs(direction.y); // neg y
				} else {
					uv = vec2(direction.x, direction.y) / abs(direction.z); // neg z
				}
				return 0.5 * (uv + 1.0);
		}`);a.useKeywords=!1;let o=new _t(`TextureCubeUVData bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {
			float face = getFace(direction);
			float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);
			mipInt = max(mipInt, cubeUV_minMipLevel);
			float faceSize = exp2(mipInt);
			float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);
			vec2 uv = getUV(direction, face) * (faceSize - 1.0);
			vec2 f = fract(uv);
			uv += 0.5 - f;
			if (face > 2.0) {
				uv.y += faceSize;
				face -= 3.0;
			}
			uv.x += face * faceSize;
			if(mipInt < cubeUV_maxMipLevel){
				uv.y += 2.0 * cubeUV_maxTileSize;
			}
			uv.y += filterInt * 2.0 * cubeUV_minTileSize;
			uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);
			uv *= texelSize;
			vec4 tl = texture2D(envMap, uv);
			uv.x += texelSize;
			vec4 tr = texture2D(envMap, uv);
			uv.y += texelSize;
			vec4 br = texture2D(envMap, uv);
			uv.x -= texelSize;
			vec4 bl = texture2D(envMap, uv);
			return TextureCubeUVData( tl, tr, br, bl, f );
		}`,[e,s,a,t,i,r,n]);o.useKeywords=!1;let l=new nr("float r0 1.0",!0),c=new nr("float v0 0.339",!0),u=new nr("float m0 -2.0",!0),h=new nr("float r1 0.8",!0),d=new nr("float v1 0.276",!0),p=new nr("float m1 -1.0",!0),f=new nr("float r4 0.4",!0),v=new nr("float v4 0.046",!0),g=new nr("float m4 2.0",!0),m=new nr("float r5 0.305",!0),x=new nr("float v5 0.016",!0),w=new nr("float m5 3.0",!0),_=new nr("float r6 0.21",!0),M=new nr("float v6 0.0038",!0),S=new nr("float m6 4.0",!0),A=[l,c,u,h,d,p,f,v,g,m,x,w,_,M,S],T=new _t(`float roughnessToMip(float roughness) {
			float mip = 0.0;
			if (roughness >= r1) {
				mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;
			} else if (roughness >= r4) {
				mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;
			} else if (roughness >= r5) {
				mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;
			} else if (roughness >= r6) {
				mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;
			} else {
				mip = -2.0 * log2(1.16 * roughness);// 1.16 = 1.79^0.25
			}
			return mip;
		}`,A);return{bilinearCubeUV:o,roughnessToMip:T,m0:u,cubeUV_maxMipLevel:t}}();var kg=class extends lr{constructor(e){super("v3"),this.nodeType="Normal",this.scope=e??kg.VIEW}getShared(){return this.scope===kg.WORLD}build(e,t,i,r){let n=e.context[this.scope+"Normal"];return n?n.build(e,t,i,r):super.build(e,t,i)}generate(e,t,i,r,n){let s;switch(this.scope){case kg.VIEW:e.isShader("vertex")?s="transformedNormal":s="geometryNormal";break;case kg.LOCAL:e.isShader("vertex")?s="objectNormal":(e.requires.normal=!0,s="vObjectNormal");break;case kg.WORLD:e.isShader("vertex")?s="inverseTransformDirection( transformedNormal, viewMatrix ).xyz":(e.requires.worldNormal=!0,s="vWNormal");break}return e.format(s,this.getType(e),t)}},Ba=kg;Ba.LOCAL="local",Ba.WORLD="world",Ba.VIEW="view",Ba.NORMAL="normal";za.addKeyword("viewNormal",function(){return new Ba(Ba.VIEW)});za.addKeyword("localNormal",function(){return new Ba(Ba.NORMAL)});za.addKeyword("worldNormal",function(){return new Ba(Ba.WORLD)});var Cu=class extends lr{constructor(e){super("v3"),this.nodeType="Position",this.scope=e??Cu.LOCAL}getType(){switch(this.scope){case Cu.PROJECTION:return"v4"}return this.type}getShader(){switch(this.scope){case Cu.LOCAL:case Cu.WORLD:return!1}return!0}generate(e,t,i,r,n){let s;switch(this.scope){case Cu.LOCAL:e.isShader("vertex")?s="transformed":(e.requires.position=!0,s="vPosition");break;case Cu.WORLD:if(e.isShader("vertex"))return"( modelMatrix * vec4( transformed, 1.0 ) ).xyz";e.requires.worldPosition=!0,s="vWPosition";break;case Cu.VIEW:s=e.isShader("vertex")?"-mvPosition.xyz":"vViewPosition";break;case Cu.PROJECTION:s=e.isShader("vertex")?"( projectionMatrix * modelViewMatrix * vec4( position, 1.0 ) )":"vec4( 0.0 )";break}return e.format(s,this.getType(),t)}},Il=Cu;Il.LOCAL="local",Il.WORLD="world",Il.VIEW="view",Il.PROJECTION="projection";za.addKeyword("position",function(){return new Il});za.addKeyword("worldPosition",function(){return new Il(Il.WORLD)});za.addKeyword("viewPosition",function(){return new Il(Il.VIEW)});var vc=class extends lr{constructor(e){super("v3"),this.nodeType="Reflect",this.scope=e??vc.CUBE}getUnique(e){return!e.context.viewNormal}getType(){switch(this.scope){case vc.SPHERE:return"v2"}return this.type}generate(e,t){let i=this.getUnique(e);if(e.isShader("fragment")){let r;switch(this.scope){case vc.VECTOR:{let n=new Ba(Ba.VIEW),s=e.context.roughness,a=n.build(e,"v3"),o=new Il(Il.VIEW).build(e,"v3"),l=s?s.build(e,"f"):void 0,c=`reflect( -normalize( ${o} ), ${a} )`;l&&(c=`normalize( mix( ${c}, ${a}, ${l} * ${l} ) )`);let u=`inverseTransformDirection( ${c}, viewMatrix )`;i?(e.addNodeCode(`vec3 reflectVec = ${u};`),r="reflectVec"):r=u;break}case vc.CUBE:{let n=new vc(vc.VECTOR).build(e,"v3"),s="vec3( -"+n+".x, "+n+".yz )";i?(e.addNodeCode(`vec3 reflectCubeVec = ${s};`),r="reflectCubeVec"):r=s;break}case vc.SPHERE:{let n="normalize( ( viewMatrix * vec4( "+new vc(vc.VECTOR).build(e,"v3")+", 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) ).xy * 0.5 + 0.5";i?(e.addNodeCode(`vec2 reflectSphereVec = ${n};`),r="reflectSphereVec"):r=n;break}}return e.format(r,this.getType(),t)}else return console.warn("ReflectNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.type,t)}},Pv=vc;Pv.CUBE="cube",Pv.SPHERE="sphere",Pv.VECTOR="vector";var zMe=class extends lr{constructor(e=new Fu,t,i){super("v4"),this.nodeType="TextureCube",this.value=e,this.radianceNode=new KO(this.value,t??new Pv(Pv.VECTOR),i),this.irradianceNode=new KO(this.value,new Ba(Ba.WORLD),new Tt(1).setReadonly(!0))}generate(e,t){return e.isShader("fragment")?(e.require("irradiance"),e.context.bias&&e.context.bias.setTexture(this.value),(e.slot==="irradiance"?this.irradianceNode:this.radianceNode).build(e,t)):(console.warn("TextureCubeNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),t))}},NMe=class extends Xa{constructor(e=new pB,t,i){super("v4",{shared:!0}),this.nodeType="CubeTexture",this.value=e,this.uv=t??new Pv,this.bias=i}getTexture(e,t){return super.generate(e,t,this.value.uuid,"tc")}generate(e,t){var l;if(t==="samplerCube")return this.getTexture(e,t);let i=this.getTexture(e,t),r=(l=this.uv)==null?void 0:l.build(e,"v3"),n=this.bias?this.bias.build(e,"f"):void 0;n===void 0&&e.context.bias&&(n=e.context.bias.setTexture(this).build(e,"f"));let s;n?s="texCubeBias( "+i+", "+r+", "+n+" )":s="texCube( "+i+", "+r+" )";let a={include:e.isShader("vertex"),ignoreCache:!0},o=this.getType(e);return e.addContext(a),this.colorSpace=this.colorSpace??new Rc(new xr("",o)),this.colorSpace.fromDecoding(e.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(s),s=this.colorSpace.build(e,o),e.removeContext(),e.format(s,o,t)}},BMe=`
uniform int frameIndex;
uniform vec2 resolution;
uniform mat4 previousModelViewMatrix;
uniform mat4 previousProjectionMatrix;

varying vec4 vCurrentPosition;
varying vec4 vPreviousPosition;
`,kMe=`
layout(location = 1) out vec4 gVelocity;

uniform int frameIndex;
uniform vec2 resolution;

varying vec4 vCurrentPosition;
varying vec4 vPreviousPosition;

const vec2 haltonSequence[16] = vec2[16](
vec2( 0.000000,-0.333334),
vec2(-0.500000, 0.333334),
vec2( 0.500000,-0.777778),
vec2(-0.750000,-0.111112),
vec2( 0.250000, 0.555556),
vec2(-0.250000,-0.555556),
vec2( 0.750000, 0.111112),
vec2(-0.875000, 0.777778),
vec2(0.125000, -0.925926),
vec2(-0.375000, -0.259260),
vec2(0.625000, 0.407408),
vec2(-0.625000, -0.703704),
vec2(0.375000, -0.037038),
vec2(-0.125000, 0.629630),
vec2(0.875000, -0.481482),
vec2(-0.937500, 0.185186));

vec2 vogelDiskSample(int sampleIndex, int sampleCount, float angle) {
  const float goldenAngle = 2.399963f; // radians
  float r = sqrt(float(sampleIndex) + 0.5f) / sqrt(float(sampleCount));
  float theta = float(sampleIndex) * goldenAngle + angle;
  float sine = sin(theta);
  float cosine = cos(theta);
  return vec2(cosine, sine) * r;
}

// Derived from the interleaved gradient function from Jimenez 2014 http:goo.gl/eomGso
float getNoiseInterleavedGradient(vec2 screenPos) {
    vec3 magic = vec3(0.06711056f, 0.00583715f, 52.9829189f);
    return fract(magic.z * fract(dot(screenPos, magic.xy)));
}

`,UMe=`
// TODO: This could be generated CPU side and passed to the shader every frame
const vec2 haltonSequence[16] = vec2[16](
vec2( 0.000000,-0.333334),
vec2(-0.500000, 0.333334),
vec2( 0.500000,-0.777778),
vec2(-0.750000,-0.111112),
vec2( 0.250000, 0.555556),
vec2(-0.250000,-0.555556),
vec2( 0.750000, 0.111112),
vec2(-0.875000, 0.777778),
vec2(0.125000, -0.925926),
vec2(-0.375000, -0.259260),
vec2(0.625000, 0.407408),
vec2(-0.625000, -0.703704),
vec2(0.375000, -0.037038),
vec2(-0.125000, 0.629630),
vec2(0.875000, -0.481482),
vec2(-0.937500, 0.185186));

// TODO: Pass correct view size
vec2 offset = haltonSequence[frameIndex];
offset.x /= resolution.x;
offset.y /= resolution.y;

vec4 currentPosition = gl_Position;
vec4 currentPositionJittered = currentPosition + (vec4(offset.x, offset.y, 0.0, 0.0) * currentPosition.w);

// We want to calculate the velocity with unjittered positions
// so that things that are not moving get a velocity = 0
vCurrentPosition = currentPosition;
vPreviousPosition = previousProjectionMatrix * previousModelViewMatrix * vec4(transformed, 1.0);
#ifdef OUTLINE_COMPENSATION
vPreviousPosition.xy += OUTLINE_COMPENSATION;
#endif
gl_Position = currentPositionJittered;

`,FMe=`
vec2 oldPos = vPreviousPosition.xy;
    oldPos /= vPreviousPosition.w;
    oldPos.xy = (oldPos.xy+1.)/2.0;

vec2 newPos = vCurrentPosition.xy;
    newPos /= vCurrentPosition.w;
    newPos.xy = (newPos.xy+1.)/2.0;

vec2 velocity = (newPos - oldPos);

// Discard fully transparent pixels 
if (gl_FragColor.a <= 0.0) discard;

gVelocity = vec4(velocity, 0.0, 1.0);
`,VMe=`
layout(location = 1) out vec4 gVelocity;
`,HMe=`
    // Discard fully transparent pixels 
    if (gl_FragColor.a <= 0.0) discard;

    gVelocity = vec4(0.0, 0.0, 0.0, 1.0);
`,F6=["x","y","z","w"],GMe=["float","vec2","vec3","vec4"],jMe={float:"f",vec2:"v2",vec3:"v3",vec4:"v4",mat4:"v4",int:"i",bool:"b","float[]":"f[]","vec4[]":"v4[]"},WMe={t:"sampler2D",tc:"samplerCube",b:"bool",i:"int",f:"float",c:"vec3",v2:"vec2",v3:"vec3",v4:"vec4",m3:"mat3",m4:"mat4","f[]":"float[]","v4[]":"vec4[]"},gZ=class{constructor(){this.includes={consts:{},functions:{},structs:{}},this.cache="",this.slot="",this.shader="",this.context={},this.needsJitter=!0,this.getIncludesCode=function(){function e(t,i){return t.deps.length-i.deps.length}return function(t,i){let r=this.getIncludes(t,i);if(!r)return"";let n="";r=r.sort(e);for(let s=0;s<r.length;s++)r[s].src&&(n+=r[s].src+`
`);return n}}(),this.slots=[],this.caches=[],this.contexts=[],this.keywords={},this.nodeData={},this.fragmentVariables={},this.fragmentParsVariables={},this.vertexParsVariables={},this.requires={uv:[],color:[],transparent:!1,irradiance:!1,position:!1,worldPosition:!1,normal:!1,worldNormal:!1,vWorldViewDir:!1,modelMatrix:!1,viewMatrix:!1,projectionMatrix:!1},this.includes={consts:[],functions:[],structs:[]},this.attributes={},this.prefixCode=["#ifdef TEXTURE_LOD_EXT","	#define texCube(a, b) textureCube(a, b)","	#define texCubeBias(a, b, c) textureCubeLodEXT(a, b, c)","	#define tex2D(a, b) texture2D(a, b)","	#define tex2DBias(a, b, c) texture2DLodEXT(a, b, c)","#else","	#define texCube(a, b) textureCube(a, b)","	#define texCubeBias(a, b, c) textureCube(a, b, c)","	#define tex2D(a, b) texture2D(a, b)","	#define tex2DBias(a, b, c) texture2D(a, b, c)","#endif",`
			// NOTE: Include Spline's blending modes. This could be part of BlendNode
			#define SPE_BLENDING_NORMAL 0
			#define SPE_BLENDING_MULTIPLY 1
			#define SPE_BLENDING_SCREEN 2
			#define SPE_BLENDING_OVERLAY 3

			vec3 spe_normalBlend( vec3 a, vec3 b, float alpha ) {
				return mix( a, b, alpha );
			}

			vec3 spe_multiplyBlend( vec3 a, vec3 b, float alpha ) {
				return mix( a, a * b, alpha );
			}

			vec3 spe_screenBlend( vec3 a, vec3 b, float alpha ) {
				vec3 tmp = 1.0 - ( 1.0 - a ) * ( 1.0 - b );
				return mix( a, tmp, alpha );
			}

			vec3 spe_overlayBlend( vec3 a, vec3 b, float alpha ) {
				vec3 tmp = mix( 1. - 2. * (1. - a) * (1. - b), 2. * a * b, step( a, vec3(.5) ) );
				return clamp( mix( a, tmp, alpha ), 0.0, 1.0 );
			}

			vec3 spe_blend( vec3 a, vec3 b, float alpha, int mode ) {
				if ( mode == SPE_BLENDING_NORMAL ) return spe_normalBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_MULTIPLY ) return spe_multiplyBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_SCREEN ) return spe_screenBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_OVERLAY ) return spe_overlayBlend( a, b, alpha );
				return vec3( 1.0 );
			}
			`,"#include <packing>","#include <common>"].join(`
`),this.parsCode={vertex:["float neighbor_offset = 0.0001;",""].join(`
`),fragment:["float accumAlpha = 0.0;",`void accumulateAlpha(float alpha) {
					accumAlpha += (1.0 - accumAlpha) * alpha;
				}`,""].join(`
`)},this.code={vertex:"",fragment:""},this.nodeCode={vertex:"",fragment:""},this.resultCode={vertex:"",fragment:""},this.finalCode={vertex:"",fragment:""},this.inputs={uniforms:{list:[],vertex:[],fragment:[]},arrayUniforms:{list:[],vertex:[],fragment:[]},vars:{varying:[],vertex:[],fragment:[]}},this.defines={},this.uniforms={},this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.updaters=[],this.nodes=[],this.analyzing=!1}build(e,t){this.addVertexParsCode(BMe),this.addFragmentParsCode(kMe),this.buildShader("vertex",e),this.buildShader("fragment",t);for(let i=0;i<this.requires.uv.length;i++)if(this.requires.uv[i]){let r=i>0?i+1:"";this.addVaryCode("varying vec2 vUv"+r+";"),i>0&&this.addVertexParsCode("attribute vec2 uv"+r+";"),this.addVertexFinalCode("vUv"+r+" = uv"+r+";")}return this.requires.color[0]&&(this.addVaryCode("varying vec4 vColor;"),this.addVertexParsCode("attribute vec4 color;"),this.addVertexFinalCode("vColor = color;")),this.requires.color[1]&&(this.addVaryCode("varying vec4 vColor2;"),this.addVertexParsCode("attribute vec4 color2;"),this.addVertexFinalCode("vColor2 = color2;")),this.requires.position&&(this.addVaryCode("varying vec3 vPosition;"),this.addVertexFinalCode("vPosition = transformed;")),this.requires.worldPosition,this.requires.normal&&(this.addVaryCode("varying vec3 vObjectNormal;"),this.addVertexFinalCode("vObjectNormal = normal;")),this.requires.modelMatrix&&this.addFragmentParsCode("uniform mat4 modelMatrix;"),this.requires.viewMatrix&&this.addFragmentParsCode("uniform mat4 viewMatrix;"),this.requires.projectionMatrix&&this.addFragmentParsCode("uniform mat4 projectionMatrix;"),this.requires.worldNormal&&(this.addVaryCode("varying vec3 vWNormal;"),this.addVertexFinalCode("vWNormal = inverseTransformDirection( transformedNormal, viewMatrix ).xyz;")),this.requires.vWorldViewDir&&(this.addVaryCode("varying vec3 vWorldViewDir;"),this.addVertexFinalCode("vWorldViewDir = isPerspectiveMatrix( projectionMatrix ) ?  ( (modelMatrix * vec4(position, 1.0)).xyz - cameraPosition ) : vec3( -viewMatrix[0][2], -viewMatrix[1][2], -viewMatrix[2][2] );")),this.needsJitter&&(this.addVertexFinalCode(UMe),this.addFragmentFinalCode(FMe)),this}buildShader(e,t){this.resultCode[e]=t.build(this.setShader(e),"v4")}setMaterial(e,t){return this.defines={},this}addFlow(e,t,i){return this.addSlot(e).addCache(t).addContext(i)}removeFlow(){return this.removeSlot().removeCache().removeContext()}addCache(e){return this.cache=e??"",this.caches.push(this.cache),this}removeCache(){return this.caches.pop(),this.cache=this.caches[this.caches.length-1]||"",this}addContext(e){return this.context=Object.assign({},this.context,e),this.context.extra=this.context.extra||{},this.contexts.push(this.context),this}removeContext(){return this.contexts.pop(),this.context=this.contexts[this.contexts.length-1]||{},this}addSlot(e){return this.slot=e||"",this.slots.push(this.slot),this}removeSlot(){return this.slots.pop(),this.slot=this.slots[this.slots.length-1]||"",this}addFragmentVariable(e,t){this.fragmentVariables[e]===void 0&&(this.addFragmentCode(`${t} ${e};`),this.fragmentVariables[e]="")}addFragmentParsVariable(e,t){this.fragmentParsVariables[e]===void 0&&(this.addFragmentParsCode(`${t} ${e};`),this.fragmentParsVariables[e]="")}addVertexParsVariable(e,t){this.vertexParsVariables[e]===void 0&&(this.addVertexParsCode(`${t} ${e};`),this.vertexParsVariables[e]="")}addVertexCode(e){this.addCode(e,"vertex")}addFragmentCode(e){this.addCode(e,"fragment")}addCode(e,t){this.code[t??this.shader]+=e+`
`}addVertexNodeCode(e){this.addNodeCode(e,"vertex")}addFragmentNodeCode(e){this.addNodeCode(e,"fragment")}addNodeCode(e,t){this.nodeCode[t??this.shader]+=e+`
`}clearNodeCode(e){e=e??this.shader;let t=this.nodeCode[e];return this.nodeCode[e]="",t}clearVertexNodeCode(){return this.clearNodeCode("vertex")}clearFragmentNodeCode(){return this.clearNodeCode("fragment")}addVertexFinalCode(e){this.addFinalCode(e,"vertex")}addFragmentFinalCode(e){this.addFinalCode(e,"fragment")}addFinalCode(e,t){this.finalCode[t??this.shader]+=e+`
`}addVertexParsCode(e){this.addParsCode(e,"vertex")}addFragmentParsCode(e){this.addParsCode(e,"fragment")}addParsCode(e,t){this.parsCode[t??this.shader]+=e+`
`}addVaryCode(e){this.addVertexParsCode(e),this.addFragmentParsCode(e)}isCache(e){return this.caches.indexOf(e)!==-1}isSlot(e){return this.slots.indexOf(e)!==-1}define(e,t){this.defines[e]=t===void 0?1:t}require(e){this.requires[e]=!0}isDefined(e){return this.defines[e]!==void 0}getVar(e,t,i,r="varying",n="V",s=""){let a=this.getVars(r),o=a[e];if(!o){let l=a.length;o={name:i||"node"+n+l+(s?"_"+s:""),type:t},a.push(o),a[e]=o}return o}getTempVar(e,t,i,r){return this.getVar(e,t,i,this.shader,"T",r)}getAttribute(e,t){if(!this.attributes[e]){let i=this.getVar(e,t);this.addVertexParsCode("attribute "+t+" "+e+";"),this.addVertexFinalCode(i.name+" = "+e+";"),this.attributes[e]={varying:i,name:e,type:t}}return this.attributes[e]}getCode(e){return[this.prefixCode,this.parsCode[e],this.getVarListCode(this.getVars("varying"),"varying"),this.getVarListCode(this.inputs.uniforms[e],"uniform"),this.getVarListCode(this.inputs.arrayUniforms[e],"uniform"),this.getIncludesCode("consts",e),this.getIncludesCode("structs",e),this.getIncludesCode("functions",e),"void main() {",this.getVarListCode(this.getVars(e)),this.code[e],this.resultCode[e],this.finalCode[e],"}"].join(`
`)}getVarListCode(e,t){t=t??"";let i="";for(let r=0,n=e.length;r<n;++r){let s=e[r],a=s.type,o=s.name,l=s.size,c=this.getFormatByType(a);if(c===void 0)throw new Error("Node pars "+c+" not found.");c.includes("[]")?i+=t+" "+c.substring(0,c.length-2)+" "+o+`[${l}];
`:i+=t+" "+c+" "+o+`;
`}return i}getVars(e){return this.inputs.vars[e??this.shader]}getNodeData(e){let t=e instanceof zn?e.uuid:e;return this.nodeData[t]=this.nodeData[t]||{}}createUniform(e,t,i,r,n,s){if(t.includes("[]")){let a=this.inputs.arrayUniforms,o=a.list.length,l=new B6({type:t,size:i.size,name:r||"nodeUA"+o+(s?"_"+s:""),node:i,needsUpdate:n});return a.list.push(l),a[e].push(l),a[e][l.name]=l,this.uniforms[l.name]=l,l}else{let a=this.inputs.uniforms,o=a.list.length,l=new B6({type:t,name:r||"nodeU"+o+(s?"_"+s:""),node:i,needsUpdate:n});return a.list.push(l),a[e].push(l),a[e][l.name]=l,this.uniforms[l.name]=l,l}}createVertexUniform(e,t,i,r,n){return this.createUniform("vertex",e,t,i,r,n)}createFragmentUniform(e,t,i,r,n){return this.createUniform("fragment",e,t,i,r,n)}include(e,t,i){var s;let r;if(e=typeof e=="string"?za.get(e):e,this.context.include===!1)return e.name;e instanceof _t?r=this.includes.functions:e instanceof nr?r=this.includes.consts:e instanceof fZ&&(r=this.includes.structs);let n=r[this.shader]=r[this.shader]||[];if(e){let a=n[e.name];if(a||(a=n[e.name]={node:e,deps:[]},n.push(a),a.src=e.build(this,"source")),e instanceof _t&&t&&n[t.name]&&n[t.name].deps.indexOf(e)===-1&&(n[t.name].deps.push(e),(s=e.includes)==null?void 0:s.length)){let o=0;do this.include(e.includes[o++],t);while(o<e.includes.length)}return i&&(a.src=i),e.name}else throw new Error("Include not found.")}colorToVectorProperties(e){return e.replace("r","x").replace("g","y").replace("b","z").replace("a","w")}colorToVector(e){return e.replace(/c/g,"v3")}getIncludes(e,t){return this.includes[e][t||this.shader]}getConstructorFromLength(e){return GMe[e-1]}isTypeMatrix(e){return/^m/.test(e)}getTypeLength(e){return e==="f"?1:parseInt(this.colorToVector(e).substr(1))}getTypeFromLength(e){return e===1?"f":"v"+e}findNode(...e){for(let t=0;t<arguments.length;t++){let i=e[t];if(i!=null&&i.isNode)return i}}resolve(...e){for(let t=0;t<arguments.length;t++){let i=e[t];if(i!==void 0){if(i.isNode)return i;if(i.isTexture)switch(i.mapping){case Vf:case Hf:return new NMe(i);case Lw:return new zMe(new Fu(i));default:return new Fu(i)}else{if(i.isVector2)return new gs(i);if(i.isVector3)return new Bo(i);if(i.isVector4)return new Ru(i)}}}}format(e,t,i){switch(this.colorToVector(i+" <- "+t)){case"f <- v2":return e+".x";case"f <- v3":return e+".x";case"f <- v4":return e+".x";case"f <- i":case"f <- b":return"float( "+e+" )";case"v2 <- f":return"vec2( "+e+" )";case"v2 <- v3":return e+".xy";case"v2 <- v4":return e+".xy";case"v2 <- i":case"v2 <- b":return"vec2( float( "+e+" ) )";case"v3 <- f":return"vec3( "+e+" )";case"v3 <- v2":return"vec3( "+e+", 0.0 )";case"v3 <- v4":return e+".xyz";case"v3 <- i":case"v3 <- b":return"vec2( float( "+e+" ) )";case"v4 <- f":return"vec4( "+e+" )";case"v4 <- v2":return"vec4( "+e+", 0.0, 1.0 )";case"v4 <- v3":return"vec4( "+e+", 1.0 )";case"v4 <- i":case"v4 <- b":return"vec4( float( "+e+" ) )";case"i <- f":case"i <- b":return"int( "+e+" )";case"i <- v2":return"int( "+e+".x )";case"i <- v3":return"int( "+e+".x )";case"i <- v4":return"int( "+e+".x )";case"b <- f":return"( "+e+" != 0.0 )";case"b <- v2":return"( "+e+" != vec2( 0.0 ) )";case"b <- v3":return"( "+e+" != vec3( 0.0 ) )";case"b <- v4":return"( "+e+" != vec4( 0.0 ) )";case"b <- i":return"( "+e+" != 0 )"}return e}getTypeByFormat(e){return jMe[e]||e}getFormatByType(e){return WMe[e]||e}getUUID(e,t){return t=t!==void 0?t:!0,t&&this.cache&&(e=this.cache+"-"+e),e}getElementByIndex(e){return F6[e]}getIndexByElement(e){return F6.indexOf(e)}isShader(e){return this.shader===e}setShader(e){return this.shader=e,this}mergeDefines(e){for(let t in e)this.defines[t]=e[t];return this.defines}mergeUniform(e){for(let t in e)this.uniforms[t]=e[t];return this.uniforms}getTextureEncodingFromMap(e){let t;return e?e.isTexture&&(t=e.encoding):t=Vl,t===Vl&&this.context.gamma&&(t=hi),t}},$r=class extends Xa{constructor(e=0,t,i,r){super("c"),this.nodeType="Color",this.value=e instanceof Es?e:new Es(e||0,t,i,r)}setRGBA(e){this.value.setRGBA(e.r,e.g,e.b,e.a)}generate(e,t,i,r,n,s){i=e.getUUID(i??this.getUUID()),r=r??this.getType(e);let a=e.getNodeData(i),o=this.getReadonly()&&this.generateReadonly!==void 0;if(this.alpha){let l=this.alpha.build(e,"f");e.addFragmentNodeCode(`accumAlpha += ( 1.0 - accumAlpha ) * ${l};`)}return o?this.generateReadonly(e,t,i,r,n,s):e.isShader("vertex")?(a.vertex||(a.vertex=e.createVertexUniform(r,this,n,s,this.getLabel())),e.format(a.vertex.name,r,t)):(a.fragment||(a.fragment=e.createFragmentUniform(r,this,n,s,this.getLabel())),e.format(a.fragment.name,r,t))}generateReadonly(e,t,i,r,n,s){return e.format("vec3("+this.value.r+", "+this.value.g+", "+this.value.b+")",r,t)}},ur=class extends Xa{constructor(e){super("i"),this.nodeType="Int",this.value=Math.floor(e??0)}generateReadonly(e,t,i,r,n,s){return e.format(this.value.toString(),r,t)}},da=class extends Xa{constructor(e){super("b"),this.nodeType="Bool",this.value=e??!1}generateReadonly(e,t,i,r){return e.format(this.value?"true":"false",r,t)}},Gp=class extends Xa{constructor(e=1,t){super("f[]"),this.nodeType="FloatArray",this.size=e,this.value=Array.isArray(t)?t:typeof t=="number"?new Array(e).fill(t):new Array(e).fill(0)}},hk=class extends Xa{},XMe=class extends hk{constructor(e){super("v3"),this.image=e,this._value=new B}get value(){return this._value.x=this.image.isVideo?this.image.img.videoWidth??0:this.image.img.width,this._value.y=this.image.isVideo?this.image.img.videoHeight??0:this.image.img.height,this._value}},ZO=class extends hk{constructor(e,t,i=1008,r=1006){super("t"),this.image=e,this.wrap=t,this.minFilter=i,this.magFilter=r}get value(){return this.image.getTexture(this.wrap,this.minFilter,this.magFilter)}},vZ=class extends Xa{constructor(e){super("m3"),this.nodeType="Matrix3",this.value=e??new Mn}generateReadonly(e,t,i,r,n,s){return e.format("mat3("+this.value.elements.join(", ")+")",r,t)}get elements(){return this.value.elements}set elements(e){this.value.fromArray(e)}},Yc=class extends Xa{constructor(e){super("m4"),this.nodeType="Matrix4",this.value=e??new ht}generateReadonly(e,t,i,r,n,s){return e.format("mat4("+this.value.elements.join(", ")+")",r,t)}get elements(){return this.value.elements}set elements(e){this.value.fromArray(e)}};function V6(e,t,i,r=0){e.setUvTransform(i[0],i[1],t[0],t[1],0,0,0).premultiply(new Mn().makeRotation(r*Et.DEG2RAD))}var qMe=class extends vZ{constructor(e,t,i=0){super(new Mn),this.repeat=e,this.offset=t,this.rotation=i,V6(this.value,e,t,i)}updateMatrix(){V6(this.value,this.repeat,this.offset,this.rotation)}},jp=class extends Xa{constructor(e=1,t){super("v4[]"),this.nodeType="Vector4Array",this.size=e,this.value=Array.isArray(t)?t:t instanceof ti?new Array(e).fill(t):new Array(e).fill(new ti(0))}},H6=class extends lr{constructor(e,t,i,r){super("v3"),this.nodeType="Blend",this.a=e,this.b=t,this.alpha=i,this.mode=r}generate(e,t){if(e.isShader("fragment")){let i=[];return i.push(this.a.build(e,"c")),i.push(this.b.build(e,"c")),i.push(this.alpha.build(e,"f")),i.push(this.mode.build(e,"i")),e.format("spe_blend("+i.join(",")+")",this.getType(e),t)}else return console.warn("BlendNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},yZ=class extends lr{constructor(e,t){super("v3"),this.nodeType="CustomColor",this.color=e,this.alpha=t,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){let i=e.include(yZ.Nodes.customColor);e.addFragmentVariable(this.calpha,"float");let r=[];return r.push(this.color.build(e,"v3")),r.push(this.mask?`luminance(${this.mask.build(e,"v3")})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("CustomColorNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},$O=yZ;$O.Nodes=function(){return{customColor:new _t(`vec3 customColor(vec3 color, float mask, float alpha, out float calpha) {
				float lalpha = alpha * mask;
				calpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha;

				return color;
			}`)}}();var xZ=class extends lr{constructor(e,t){super("v3"),this.nodeType="CustomNormal",this.cnormal=e,this.alpha=t,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){let i=e.include(xZ.Nodes.customNormal);e.addFragmentVariable(this.calpha,"float");let r=[];return r.push(this.cnormal.build(e,"v3")),r.push("normal"),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("CustomNormalNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},wZ=xZ;wZ.Nodes=function(){return{customNormal:new _t(`vec3 customNormal(vec3 cnormal, vec3 norm, float mask, float alpha, out float calpha) {
				vec3 normal = packNormalToRGB( norm ).rgb;
				normal *= step( vec3(0.5), cnormal );

				float lalpha = alpha * mask;
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * lalpha;

				return normal;
			}`)}}();var Ex=class extends lr{constructor(e,t,i,r,n,s,a,o,l,c,u,h){super("v3"),this.nodeType="CustomTexture",this.texture=e,this.textureSize=t,this.crop=i,this.projection=r,this.axis=n,this.side=s,this.size=a,this.blending=o,this.mat=l,this.isMask=h,this.alpha=c,this.mode=u,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){e.require("position"),e.require("normal"),e.require("uv"),e.requires.uv=[!0],e.extensions.shaderTextureLOD=!0,e.extensions.derivatives=!0;let i=`g${this.uuid.toString().replace(/-/g,"")}`,r;switch(this.projection.value){case 3:r=e.include(Ex.Nodes.cylindrical);break;case 2:r=e.include(Ex.Nodes.spherical);break;case 1:let s=["vec3(1.0, 0.0, 0.0)","vec3(0.0, 1.0, 0.0)","vec3(0.0, 0.0, 1.0)"][this.axis.value],a=["zy","xz","xy"][this.axis.value],o=new _t(`
		vec3 ${i}_planarTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
				vec2 projected = (1. + (position.${a})) / 2.;
				vec2 uvs = ( mat * vec3( (projected * 2. - 1.) / (size * .5), 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

				vec4 tmp = texture2D( tex, uvs );

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				${this.side.value===2?"":`lalpha *= step(0.0, ${this.side.value===1?"-1.0 * ":""}dot(vObjectNormal, ${s}));`}

				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}
				
				lalpha *= mask;

				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}`);r=e.include(o);break;case 4:r=e.include(Ex.Nodes.triplanar);break;default:r=e.include(Ex.Nodes.uv);break}e.addFragmentVariable(this.calpha,"float");let n=[];if(n.push("normal"),n.push(this.texture.generate(e,"t")),n.push(this.textureSize.build(e,"v2")),n.push(this.crop.build(e,"f")),n.push(this.mat.build(e,"mat3")),n.push(this.size.build(e,"v2")),n.push(this.blending.build(e,"f")),n.push(this.isMask.build(e,"b")),n.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.mode.build(e,"i")),n.push(this.calpha),this.projection.value===4){let s=`${i}_writeUvs`,a=s+"0",o=s+"1",l=s+"2",c=`${i}_triplanarWeights`;e.addFragmentVariable(a,"vec2"),e.addFragmentVariable(o,"vec2"),e.addFragmentVariable(l,"vec2"),e.addFragmentVariable(c,"vec3"),n.push(a),n.push(o),n.push(l),n.push(c)}else{let s=`${i}_writeUvs`;e.addFragmentVariable(s,"vec2"),n.push(s)}return e.format(r+"("+n.join(",")+")",this.getType(e),t)}},dk=Ex;dk.Nodes=function(){let e=new _t(`
vec3 cylindricalTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
                vec3 posN = normalize(position);
                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);
                float scaledHeight = position.y / (size.y * 0.5);
                float v =  (scaledHeight / 2.) + .5;

                vec2 calculatedUv = vec2(u,v);
				vec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

                vec2 df = fwidth(uvs);
               	if(df.x > 0.5) df.x = 0.;

				#ifdef GL_EXT_shader_texture_lod
                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#else
                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}

				lalpha *= mask;
				
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}
`),t=new _t(`
vec3 sphericalTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
                vec3 posN = normalize(vPosition);
                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);
                float v = 0.5 + asin(posN.y) / 3.1415;

                vec2 calculatedUv = vec2(u,v);
				vec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

                vec2 df = fwidth(uvs);
               	if(df.x > 0.5) df.x = 0.;
				#ifdef GL_EXT_shader_texture_lod
                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#else
                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}

				lalpha *= mask;

				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}
`),i=new _t(`vec3 uvTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
				vec2 uvs = ( mat * vec3( vUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

				vec4 tmp = texture2D( tex, uvs );

				vec3 col = tmp.rgb;

				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}
				
				lalpha *= mask;

				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}`),r=new _t(`vec3 triplanarTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUvs0, out vec2 writeUvs1, out vec2 writeUvs2, out vec3 writeWeights) {
				vec3 p = position;
				vec2 uv0 = (1.0 + p.xy) / 2.0;     
				vec2 uv1 = (1.0 + p.zy) / 2.0;		
				vec2 uv2 = (1.0 + p.xz) / 2.0;		
	
				uv0 = (mat * vec3((uv0 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;
				uv1 = (mat * vec3((uv1 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;
				uv2 = (mat * vec3((uv2 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;

				// Range from 3 to 128 seems to be good
				float exponent = (1.0 - blending) * 125.0 + 3.0;

				vec3 n = vObjectNormal;
				vec3 weights = abs(normalize(n));
				weights = pow(weights, vec3(exponent));
				weights /= dot(weights, vec3(1.0));

				// Write out all sets of UVs that we generated
				writeUvs0 = uv0;
				writeUvs1 = uv1;
				writeUvs2 = uv2;
				writeWeights = weights;

				// Derivatives for LOD
				vec2 df0 = fwidth(uv0);
				vec2 df1 = fwidth(uv1);
				vec2 df2 = fwidth(uv2);
				if (df0.x > 0.5) df0.x = 0.0;
				if (df1.x > 0.5) df1.x = 0.0;
				if (df2.x > 0.5) df2.x = 0.0;

				#ifdef GL_EXT_shader_texture_lod
                	vec4 tmp = 
						texture2DLodEXT(tex, uv0, log2(max(df0.x, df0.y)*min(textureSize.x, textureSize.y))) * weights.z + 
						texture2DLodEXT(tex, uv1, log2(max(df1.x, df1.y)*min(textureSize.x, textureSize.y))) * weights.x + 
						texture2DLodEXT(tex, uv2, log2(max(df2.x, df2.y)*min(textureSize.x, textureSize.y))) * weights.y;
				#else
                	vec4 tmp = 
						textureLod(tex, uv0, log2(max(df0.x, df0.y)*min(textureSize.x, textureSize.y))) * weights.z + 
						textureLod(tex, uv1, log2(max(df1.x, df1.y)*min(textureSize.x, textureSize.y))) * weights.x + 
						textureLod(tex, uv2, log2(max(df2.x, df2.y)*min(textureSize.x, textureSize.y))) * weights.y;
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;

				// Apply cropping across all 3 planes
				if ( crop > 0.5 ) {
					if ( uv0.x < 0.0 || uv0.x > 1.0 || uv0.y < 0.0 || uv0.y > 1.0 )  {
						lalpha = 0.0;
					}
					if ( uv1.x < 0.0 || uv1.x > 1.0 || uv1.y < 0.0 || uv1.y > 1.0 )  {
						lalpha = 0.0;
					}
					if ( uv2.x < 0.0 || uv2.x > 1.0 || uv2.y < 0.0 || uv2.y > 1.0 )  {
						lalpha = 0.0;
					}
				}

				lalpha *= mask;
				calpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;//n * 0.5 + 0.5;
			}			
			`);return{cylindrical:e,spherical:t,uv:i,triplanar:r}}();var Ax=class extends lr{constructor(e,t,i,r,n,s,a,o,l,c,u,h){super("v3"),this.nodeType="Depth",this.gradientType=e,this.smooth=t,this.near=i,this.far=r,this.isVector=n,this.isWorldSpace=s,this.origin=a,this.direction=o,this.colors=l,this.steps=c,this.isMask=h,this.alpha=u,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){let i=`g${this.uuid.toString().replace(/-/g,"")}`,r=new _t(`vec3 ${i}_sdepth(float near, float far, vec3 origin, vec3 direction, vec4 colors[${i}_MAX_COLORS], float steps[${i}_MAX_COLORS], bool isMask, float mask, float alpha, out float calpha) {
               vec4 color = colors[0];
               #ifdef ${i}_IS_VECTOR
                   #ifdef ${i}_LINEAR
                       #ifdef ${i}_WORLDSPACE
                       float depth = vectorLinearWorldSpaceDepth(direction, origin, near, far);
                       #else
                       float depth = vectorLinearObjectSpaceDepth(direction, origin, near, far);
                       #endif
                   #else
                       #ifdef ${i}_WORLDSPACE
                           float depth = vectorSphericalWorldSpaceDepth(origin, near, far);
                       #else
                           float depth = vectorSphericalObjectSpaceDepth(origin, near, far);
                       #endif
                   #endif
               #else
                   float dist = length(vWPosition - cameraPosition);
			       float depth = ( dist - near ) / ( far - near );
               #endif


              float p;
              #ifdef ${i}_SMOOTH
				for ( int i = 1; i < ${i}_MAX_COLORS; i++ ) {
						p = clamp( ( depth - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
					}
              #else
                for ( int i = 1; i < ${i}_MAX_COLORS; i++ ) {
                   p = clamp(( depth - steps[i - 1] ) / ( steps[i] - steps[i - 1] ), 0.0, 1.0);
                   color = mix(color, colors[i], p);
                 }
              #endif

               float lalpha = alpha * color.a * mask;
               calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
			   accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));
			   
               return color.rgb;
			}`,[Ax.Nodes.vectorLinearWorldSpaceDepth,Ax.Nodes.vectorLinearObjectSpaceDepth,Ax.Nodes.vectorSphericalObjectSpaceDepth,Ax.Nodes.vectorSphericalWorldSpaceDepth]);if(e.isShader("fragment")){e.define(`${i}_MAX_COLORS`,this.colors.value.length),this.smooth.value&&e.define(`${i}_SMOOTH`),this.isVector.value>.5&&e.define(`${i}_IS_VECTOR`),this.gradientType.value===0&&e.define(`${i}_LINEAR`),this.isWorldSpace.value>.5&&e.define(`${i}_WORLDSPACE`),e.require("worldPosition"),e.addFragmentVariable(this.calpha,"float");let n=e.include(r),s=[];return s.push(this.near.build(e,"f")),s.push(this.far.build(e,"f")),s.push(this.origin.build(e,"v3")),s.push(this.direction.build(e,"v3")),s.push(this.colors.build(e,"v4[]")),s.push(this.steps.build(e,"f[]")),s.push(this.isMask.build(e,"b")),s.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),s.push(this.alpha.build(e,"f")),s.push(this.calpha),e.format(n+"("+s.join(",")+")",this.getType(e),t)}else return console.warn("DepthNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},bZ=Ax;bZ.Nodes=function(){let e=new _t(`float vectorLinearWorldSpaceDepth(vec3 direction, vec3 origin, float near, float far) {
               vec3 n = normalize(direction);
               float dist = (n.x*(vWPosition.x - origin.x) + n.y*(vWPosition.y - origin.y) + n.z*(vWPosition.z - origin.z));
               return ( dist - near ) / ( far - near );
            }`),t=new _t(`float vectorLinearObjectSpaceDepth(vec3 direction, vec3 origin, float near, float far) {
               vec3 n = normalize(direction);
               float dist = (n.x*(position.x - origin.x) + n.y*(position.y - origin.y) + n.z*(position.z - origin.z));
               return ( dist - near ) / ( far - near );
            }`),i=new _t(`float vectorSphericalWorldSpaceDepth(vec3 origin, float near, float far) {
               float dist = length(vWPosition - origin);
               return ( dist - near ) / ( far - near );
            }`),r=new _t(`float vectorSphericalObjectSpaceDepth(vec3 origin, float near, float far) {
               float dist = length(position - origin);
               return ( dist - near ) / ( far - near );
            }`);return{vectorLinearWorldSpaceDepth:e,vectorLinearObjectSpaceDepth:t,vectorSphericalWorldSpaceDepth:i,vectorSphericalObjectSpaceDepth:r}}();var YMe=class extends lr{constructor(e,t,i,r,n,s,a,o){super("v3"),this.nodeType="Fresnel",this.color=e,this.bias=t,this.scale=i,this.intensity=r,this.factor=n,this.isMask=o,this.alpha=s,this.mode=a,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("vWorldViewDir"),e.require("worldNormal"),e.isShader("fragment")){e.addFragmentVariable(this.calpha,"float");let i=new _t(`vec3 fresnel(vec3 color, float bias, float scale, float intensity, float factor, bool isMask, float mask, float alpha, int mode, out float calpha) {
					float fresnel = bias + scale * pow( abs( factor + dot( normalize( vWorldViewDir ), normalize( vWNormal ) ) ), intensity );

					float lalpha = clamp(fresnel, 0.0, 1.0) * alpha * mask;
					calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
					accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

					return color;
				}`),r=e.include(i),n=[];return n.push(this.color.build(e,"c")),n.push(this.bias.build(e,"f")),n.push(this.scale.build(e,"f")),n.push(this.intensity.build(e,"f")),n.push(this.factor.build(e,"f")),n.push(this.isMask.build(e,"b")),n.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.mode.build(e,"i")),n.push(this.calpha),e.format(r+"("+n.join(",")+")",this.getType(e),t)}else return console.warn("FresnelNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},_Z=class extends lr{constructor(e,t,i,r,n,s,a,o,l){super("v3"),this.nodeType="Gradient",this.gradientType=e,this.smooth=t,this.colors=i,this.steps=r,this.offset=n,this.morph=s,this.angle=a,this.isMask=l,this.alpha=o,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){e.define("GRAD_MAX",10),e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let i=e.include(_Z.Nodes.gradient),r=[];return r.push(this.gradientType.build(e,"i")),r.push(this.smooth.build(e,"b")),r.push(this.colors.build(e,"v4[]")),r.push(this.steps.build(e,"f[]")),r.push(this.offset.build(e,"v2")),r.push(this.morph.build(e,"v2")),r.push(this.angle.build(e,"f")),r.push(this.isMask.build(e,"b")),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("GradientNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},SZ=_Z;SZ.Nodes=function(){return{gradient:new _t(`vec3 gradient(int gradientType, bool smoothed, vec4 colors[GRAD_MAX], float steps[GRAD_MAX], vec2 offset, vec2 morph, float angle, bool isMask, float mask, float alpha, out float calpha) {
				vec4 color = colors[0];
				vec2 m = morph / vUv.xy;
				vec2 rot = vec2( 0.5 + m.x, m.y );
				vec2 dt = vec2(
					cos( angle ) * rot.x - sin( angle ) * rot.y,
					sin( angle ) * rot.x + cos( angle ) * rot.y
				);
				vec2 pt = ( vUv - 0.5 + offset ) / 2.0 + dt / 2.0;
				float t = dot( pt, dt ) / dot( dt, dt );
				if ( gradientType == 1 ) {
					t = distance (
						( vUv + morph ) * 3.0,
						( vUv + offset ) + 1.0
					) + angle;
				} else if ( gradientType == 2 ) {
					float polar = atan(
						vUv.x + morph.x - 0.5 + offset.x,
						vUv.y + morph.y - 0.5 + offset.y
					) * -1.0;
					t = fract( ( angle / PI / -2.0 ) + 0.5 * ( polar / PI ) );
				}

				float p;
				if (smoothed) {
					for ( int i = 1; i < GRAD_MAX; i++ ) {
						p = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
					}

				} else {
					for ( int i = 1; i < GRAD_MAX; i++ ) {
						p = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], p);
					}
				}

				float lalpha = alpha * color.a * mask;
				calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));
				
				return color.xyz;
			}`)}}();var MZ=class extends lr{constructor(e,t,i,r,n){super("v3"),this.nodeType="Matcap",this.texture=e,this.isMask=r,this.alpha=t,this.mode=i,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`,this.rotation=n}generate(e,t){if(e.isShader("fragment")){e.addFragmentVariable(this.calpha,"float");let i=e.include(MZ.Nodes.matcap);e.require("normal"),e.requires.normal=!0;let r=[];return r.push(this.texture.generate(e,"t")),r.push("normal"),r.push(this.isMask.build(e,"b")),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.mode.build(e,"i")),r.push(this.calpha),r.push(this.rotation.build(e,"f")),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("MatcapNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},EZ=MZ;EZ.Nodes=function(){return{matcap:new _t(`vec3 matcap(sampler2D matcapTex, vec3 normal, bool isMask, float mask, float alpha, int mode, out float calpha, float rotation) {
					vec3 viewDir = normalize( vViewPosition );
					vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
					vec3 y = cross( viewDir, x );
					vec2 uv = vec2( dot( x, normal ), dot( y, normal ) );
					uv = mat2( cos(rotation), sin(rotation), -sin(rotation), cos(rotation) ) * uv;
					uv = uv * 0.495 + 0.5;
					vec4 matcapColor = texture2D( matcapTex, uv );

					float lalpha = alpha * mask;
					calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
					accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));
					
					return matcapColor.rgb;
            	}`)}}();var pk=(e=>(e.SIMPLEX="simplex3d",e.SIMPLEX_FRACTAL="simplex3dFractal",e.ASHIMA="simplexAshima",e.FBM="fbm",e.PERLIN="perlin",e.VORONOI="voronoi",e))(pk||{}),La=function(){let e=new _t(`vec3 random3(vec3 c) {
			float j = 4096.0*sin(dot(c,vec3(17.0, 59.4, 15.0)));
			vec3 r;
			r.z = fract(512.0*j);
			j *= .125;
			r.x = fract(512.0*j);
			j *= .125;
			r.y = fract(512.0*j);
			return r-0.5;
		}`),t=new _t(`float simplex3d(vec3 p) {
			 vec3 s = floor(p + dot(p, vec3(F3)));
			 vec3 x = p - s + dot(s, vec3(G3));
			 
			 vec3 e = step(vec3(0.0), x - x.yzx);
			 vec3 i1 = e*(1.0 - e.zxy);
			 vec3 i2 = 1.0 - e.zxy*(1.0 - e);
				
			 vec3 x1 = x - i1 + G3;
			 vec3 x2 = x - i2 + 2.0*G3;
			 vec3 x3 = x - 1.0 + 3.0*G3;
			 
			 vec4 w, d;
			 
			 w.x = dot(x, x);
			 w.y = dot(x1, x1);
			 w.z = dot(x2, x2);
			 w.w = dot(x3, x3);
			 
			 w = max(0.6 - w, 0.0);
			 
			 d.x = dot(random3(s), x);
			 d.y = dot(random3(s + i1), x1);
			 d.z = dot(random3(s + i2), x2);
			 d.w = dot(random3(s + 1.0), x3);
			 
			 w *= w;
			 w *= w;
			 d *= w;
			 
			 return dot(d, vec4(52.0));
		}`,[e]);t.keywords.F3=new nr("float F3 0.3333333"),t.keywords.G3=new nr("float G3 0.1666667");let i=new _t(`float simplex3dFractal(vec3 m) {
			mat3 rot1 = mat3(-0.37, 0.36, 0.85,-0.14,-0.93, 0.34,0.92, 0.01,0.4);
			mat3 rot2 = mat3(-0.55,-0.39, 0.74, 0.33,-0.91,-0.24,0.77, 0.12,0.63);
			mat3 rot3 = mat3(-0.71, 0.52,-0.47,-0.08,-0.72,-0.68,-0.7,-0.45,0.56);
			return 0.5333333 * simplex3d(m * rot1)
				 + 0.2666667 * simplex3d(2.0 * m * rot2)
				 + 0.1333333 * simplex3d(4.0 * m * rot3)
				 + 0.0666667 * simplex3d(8.0 * m);
		}`,[t]),r=new _t("vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}"),n=new _t("vec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}"),s=new _t(`float simplexAshima(vec3 v) {
		  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;
		  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);
		  vec3 i  = floor(v + dot(v, C.yyy) );
		  vec3 x0 =   v - i + dot(i, C.xxx) ;
		  vec3 g = step(x0.yzx, x0.xyz);
		  vec3 l = 1.0 - g;
		  vec3 i1 = min( g.xyz, l.zxy );
		  vec3 i2 = max( g.xyz, l.zxy );
		  vec3 x1 = x0 - i1 + 1.0 * C.xxx;
		  vec3 x2 = x0 - i2 + 2.0 * C.xxx;
		  vec3 x3 = x0 - 1. + 3.0 * C.xxx;
		  i = mod(i, 289.0 ); 
		  vec4 p = permute( permute( permute( 
					 i.z + vec4(0.0, i1.z, i2.z, 1.0 ))
				   + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) 
				   + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));
		  float n_ = 1.0/7.0; // N=7
		  vec3  ns = n_ * D.wyz - D.xzx;
		  vec4 j = p - 49.0 * floor(p * ns.z *ns.z);  //  mod(p,N*N)
		  vec4 x_ = floor(j * ns.z);
		  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)
		  vec4 x = x_ *ns.x + ns.yyyy;
		  vec4 y = y_ *ns.x + ns.yyyy;
		  vec4 h = 1.0 - abs(x) - abs(y);
		  vec4 b0 = vec4( x.xy, y.xy );
		  vec4 b1 = vec4( x.zw, y.zw );
		  vec4 s0 = floor(b0)*2.0 + 1.0;
		  vec4 s1 = floor(b1)*2.0 + 1.0;
		  vec4 sh = -step(h, vec4(0.0));
		  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;
		  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;
		  vec3 p0 = vec3(a0.xy,h.x);
		  vec3 p1 = vec3(a0.zw,h.y);
		  vec3 p2 = vec3(a1.xy,h.z);
		  vec3 p3 = vec3(a1.zw,h.w);
		  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));
		  p0 *= norm.x;
		  p1 *= norm.y;
		  p2 *= norm.z;
		  p3 *= norm.w;
		  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
		  m = m * m;
		  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), 
										dot(p2,x2), dot(p3,x3) ) );
		}`,[r,n]),a=new _t("vec4 mod289(vec4 x){return x - floor(x * (1.0 / 289.0)) * 289.0;}"),o=new _t("vec4 perm(vec4 x){return mod289(((x * 34.0) + 1.0) * x);}",[a]),l=new _t(`float noise(vec3 p){
			vec3 a = floor(p);
			vec3 d = p - a;
			d = d * d * (3.0 - 2.0 * d);
			vec4 b = a.xxyy + vec4(0.0, 1.0, 0.0, 1.0);
			vec4 k1 = perm(b.xyxy);
			vec4 k2 = perm(k1.xyxy + b.zzww);
			vec4 c = k2 + a.zzzz;
			vec4 k3 = perm(c);
			vec4 k4 = perm(c + 1.0);
			vec4 o1 = fract(k3 * (1.0 / 41.0));
			vec4 o2 = fract(k4 * (1.0 / 41.0));
			vec4 o3 = o2 * d.z + o1 * (1.0 - d.z);
			vec2 o4 = o3.yw * d.x + o3.xz * (1.0 - d.x);
			return o4.y * d.y + o4.x * (1.0 - d.y);
		}`,[o]),c=new _t(`float fbm(vec3 x) {
			float v = 0.0;
			float a = 0.5;
			vec3 shift = vec3(100);
			for (int i = 0; i < NUM_OCTAVES; ++i) {
				v += a * noise(x);
				x = x * 2.0 + shift;
				a *= 0.5;
			}
			return v;
		}`,[l]);c.keywords.NUM_OCTAVES=new nr("int NUM_OCTAVES 5");let u=new _t("vec3 fade(vec3 t) {return t*t*t*(t*(t*6.0-15.0)+10.0);}"),h=new _t(`float perlin(vec3 P){
		  vec3 Pi0 = floor(P);
		  vec3 Pi1 = Pi0 + vec3(1.0);
		  Pi0 = mod(Pi0, 289.0);
		  Pi1 = mod(Pi1, 289.0);
		  vec3 Pf0 = fract(P);
		  vec3 Pf1 = Pf0 - vec3(1.0);
		  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);
		  vec4 iy = vec4(Pi0.yy, Pi1.yy);
		  vec4 iz0 = Pi0.zzzz;
		  vec4 iz1 = Pi1.zzzz;
		  vec4 ixy = permute(permute(ix) + iy);
		  vec4 ixy0 = permute(ixy + iz0);
		  vec4 ixy1 = permute(ixy + iz1);
		  vec4 gx0 = ixy0 / 7.0;
		  vec4 gy0 = fract(floor(gx0) / 7.0) - 0.5;
		  gx0 = fract(gx0);
		  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);
		  vec4 sz0 = step(gz0, vec4(0.0));
		  gx0 -= sz0 * (step(0.0, gx0) - 0.5);
		  gy0 -= sz0 * (step(0.0, gy0) - 0.5);
		  vec4 gx1 = ixy1 / 7.0;
		  vec4 gy1 = fract(floor(gx1) / 7.0) - 0.5;
		  gx1 = fract(gx1);
		  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);
		  vec4 sz1 = step(gz1, vec4(0.0));
		  gx1 -= sz1 * (step(0.0, gx1) - 0.5);
		  gy1 -= sz1 * (step(0.0, gy1) - 0.5);
		  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);
		  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);
		  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);
		  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);
		  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);
		  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);
		  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);
		  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);
		  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));
		  g000 *= norm0.x;
		  g010 *= norm0.y;
		  g100 *= norm0.z;
		  g110 *= norm0.w;
		  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));
		  g001 *= norm1.x;
		  g011 *= norm1.y;
		  g101 *= norm1.z;
		  g111 *= norm1.w;
		  float n000 = dot(g000, Pf0);
		  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));
		  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));
		  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));
		  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));
		  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));
		  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));
		  float n111 = dot(g111, Pf1);
		  vec3 fade_xyz = fade(Pf0);
		  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);
		  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);
		  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); 
		  return 2.2 * n_xyz;
		}`,[r,n,u]),d=new _t(`float hashwithoutsine13(vec3 p3)
		{
			p3  = fract(p3 * .1031);
			p3 += dot(p3, p3.yzx + 33.33);
			return fract((p3.x + p3.y) * p3.z);
		}`),p=new _t(`vec3 hashwithoutsine33(vec3 p3)
		{
			p3 = fract(p3 * vec3(.1031, .1030, .0973));
			p3 += dot(p3, p3.yxz+33.33);
			return fract((p3.xxy + p3.yxx)*p3.zyx);
		}`),f=new _t(`float metric(in vec3 p)
		{
			// L2 
			return length(p);

			// Chebyshev 
			// vec3 a = abs(p);
			// return max(a.x, max(a.y, a.z));
		}`),v=new _t(`float smin( float a, float b, float k )
		{
			float h = smoothstep(0.0, 1.0, 0.5 + 0.5 * (b - a) / k);
			float correction = k * h * (1.0 - h);
			return mix(b, a, h) - correction;
		}`),g=new _t(`float smax( float a, float b, float k )
		{
			float h = smoothstep(1.0, 0.0, 0.5 + 0.5 * (a - b) / k);
			float correction = k * h * (1.0 - h);
			return mix(a, b, h) + correction;
		}`),m=new _t(`float remap(float value, float input_min, float input_max, float output_min, float output_max) {
			// Compute width of each interval
			float input_width = input_max - input_min;
			float output_width = output_max - output_min;
		
			// Convert input range into a 0-1 range 
			float scaled = (value - input_min) / input_width;
		
			// Convert the 0-1 range into a value in output range
			return output_min + (scaled * output_width);
		}`),x=new _t(`float voronoi(in vec3 x, in int style, in float smoothness, in float seed, in int quality) 
		{
			// Integer and fractional parts of this point's coordinates
			ivec3 p = ivec3(floor(x));
			vec3 f = fract(x);

			// Different variables that we will use to construct noise:
			//
			// f1: distance to the closest feature point
			// f2: distance to the second closest feature point
			// e: distance to the closest edge (cell boundary)
			//
			// We also compute "smooth" versions of all of the above quantites, essentially
			// replacing "hard" minimums with "smooth" minimums (described by IQ)
			float f1_smooth = 8.0;
			float f1 = 8.0;
			float f2_smooth = 8.0;
			float f2 = 8.0;
			float e_smooth = 8.0;
			float e = 8.0;

			// Variables stored from closest cell
			ivec3 mb;
			vec3 mr; 

			int steps = quality;
			
			for (int x = -steps; x <= steps; x++) 
			for (int y = -steps; y <= steps; y++)
			for (int z = -steps; z <= steps; z++)
			{
				ivec3 b = ivec3(x, y, z);
				vec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;
				float d = length(r);
				
				f1_smooth = smin(d, f1_smooth, smoothness);

				// Store un-smoothed distances too 
				if (d < f1) 
				{
					f2 = f1;
					f1 = d;

					mb = ivec3(x, y, z);
					mr = r;
				} 
				else if (d < f2) 
				{
					f2 = d;
				}
			}	
			
			float id = hashwithoutsine13(vec3(p + mb) + seed);

			// Second pass for edge distance  
			for (int x = -steps; x <= steps; x++) 
			for (int y = -steps; y <= steps; y++)
			for (int z = -steps; z <= steps; z++)
			{
				// Start search at the cell that contains the closest point to "x" (found in 1st pass)
				ivec3 b = mb + ivec3(x, y, z);
				vec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;
				float d1 = dot(0.5 * (mr + r), (r - mr)); 				// IQ normalizes "r - mr" but that breaks things for the smooth version?
				float d2 = dot(0.5 * (mr + r), normalize(r - mr));

				e_smooth = smin(d1, e_smooth, smoothness);

				e = min(e, d2);

				// Also compute a smooth version of F2 in this pass
				{
					ivec3 b = ivec3(x, y, z);
					if (b != mb) 
					{
						vec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;
						float d = length(r);

						f2_smooth = smin(d, f2_smooth, smoothness);
					}
				}
			}

			// Different visualization modes 
			if (style == 0) 
			{
				return f1_smooth;
			}
			if (style == 1) 
			{
				return f2_smooth;
			}
			if (style == 2) 
			{
				return f2_smooth - f1_smooth;
				
				// "Pebbles" also cool
				//return step(0.2, f2_smooth - f1_smooth);
			}
			if (style == 3) 
			{
				// This one is really good for rock / stone effects
				float a = f1; 
				float b = f2;
				float k = 3.0;
				float h = max(k - abs(a - b), 0.0) / k;
				float final = min(a, b) - h * h * k * (1.0 / 4.0);
				return final;
			}
			if (style == 4) 
			{
				// Some random adjustments to make this style stand out more 
				return exp(5.0 * e_smooth);
			}
			if (style == 5) 
			{
				return pow(f1_smooth, 3.0);
			}
			if (style == 6) 
			{				
				const float eps = 0.0125;

				// Thicker lines as the user increases the smoothness slider
				float thickness = smoothness * 0.25 + eps;

				// Blurrier lines as the user increases the smoothness slider
				float blur = pow(smoothness, 3.0) * 0.25 + eps;

				return smoothstep(
					thickness - thickness * blur, 
					thickness + thickness * blur, 
					e
				);
			}
			if (style == 7) 
			{
				return hashwithoutsine13(vec3(p + mb) + seed);
			}
		}
	`,[d,p,f,v,g,m]);return{simplex:t,simplexFractal:i,simplexAshima:s,fbm:c,perlin:h,voronoi:x}}(),AZ=class extends lr{constructor(e,t,i,r,n,s,a,o,l,c,u,h,d,p,f,v,g,m,x){super("v3"),this.nodeType="Noise",this.scale=e,this.size=t,this.move=i,this.fA=r,this.fB=n,this.distortion=s,this.colorA=a,this.colorB=o,this.colorC=l,this.colorD=c,this.noiseType=h,this.voronoiStyle=p,this.highCut=f,this.lowCut=v,this.smoothness=g,this.seed=m,this.quality=x,this.isMask=d,this.alpha=u,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t,i,r,n){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let s=Object.values(pk)[this.noiseType.value],a=s=="voronoi"?`
		float v = ${s}(st + move, voronoiStyle, smoothness, seed, quality);

		// Apply clipping to colors
		v = remap(v, lowCut, highCut, 0.0, 1.0);
		v = smax(v, 0.0, smoothness * 0.25);
		v = smin(v, 1.0, smoothness * 0.25);

		// Note that the voronoi mode only uses colors "A" and "C" from the UI 
		vec4 color = mix(colorA, colorC, v); 
		`:`
		vec3 q = vec3(${s}(st),
					   ${s}(st + vec3(1.0)),
					   ${s}(st + vec3(1.0)));
		vec3 r = vec3(${s}(st + vec3(distortion, 1.0) * q + vec3(fA, 1.0) + move),
					  ${s}(st + vec3(distortion, 1.0) * q + vec3(fB, 1.0) + move), 
					  ${s}(st * q));
		float f = ${s}(st + r);
		vec4 color;
		color = mix(colorA, colorB, clamp((f * f) * 4.0, 0.0, 1.0));
		color = mix(color, colorC, clamp(length(q), 0.0, 1.0));
		color = mix(color, colorD, clamp(length(r.x), 0.0, 1.0));
		`,o=new _t(`vec3 ${s}customNoise(float scale, vec3 size, float move, vec2 fA, vec2 fB, vec2 distortion, vec4 colorA, vec4 colorB, vec4 colorC, vec4 colorD, int voronoiStyle, float highCut, float lowCut, float smoothness, float seed, int quality, bool isMask, float mask, float alpha, out float calpha) 
			{
                // Prevent scale of zero 
				scale = max(abs(scale), 0.001);

				vec3 st = position / size;
				st /= scale;

				${a}

				float lalpha = alpha * color.a * mask;
				calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return clamp(color, 0.0, 1.0).rgb;
			}`,[La.simplex,La.simplexFractal,La.simplexAshima,La.fbm,La.perlin,La.voronoi]),l=e.include(o),c=[];return c.push(this.scale.build(e,"f")),c.push(this.size.build(e,"v3")),c.push(this.move.build(e,"f")),c.push(this.fA.build(e,"v2")),c.push(this.fB.build(e,"v2")),c.push(this.distortion.build(e,"v2")),c.push(this.colorA.build(e,"v4")),c.push(this.colorB.build(e,"v4")),c.push(this.colorC.build(e,"v4")),c.push(this.colorD.build(e,"v4")),c.push(this.voronoiStyle.build(e,"i")),c.push(this.highCut.build(e,"f")),c.push(this.lowCut.build(e,"f")),c.push(this.smoothness.build(e,"f")),c.push(this.seed.build(e,"f")),c.push(this.quality.build(e,"i")),c.push(this.isMask.build(e,"b")),c.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),c.push(this.alpha.build(e,"f")),c.push(this.calpha),e.format(l+"("+c.join(",")+")",this.getType(e),t)}};AZ.numOctaves=5;var CZ=class extends lr{constructor(e,t,i,r,n,s,a,o,l,c,u,h,d,p,f,v){super("v3"),this.nodeType="Outline",this.firstTime=!0,this.outlineColor=e,this.contourColor=t,this.outlineWidth=i,this.contourWidth=r,this.contourThreshold=n,this.outlineThreshold=s,this.contourFrequency=a,this.outlineSmoothing=o,this.contourDirection=l,this.positionalLines=c,this.compensation=u,this.resolution=h,this.normalMap=d,this.depthMap=p,this.pixelRatio=f,this.alpha=v,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){let i=`g${this.uuid.toString().replace(/-/g,"")}`;if(e.require("vWorldViewDir"),e.require("worldNormal"),e.extensions.derivatives=!0,this.compensation.value&&e.define("OUTLINE_COMPENSATION",`${i}_offset`),this.firstTime){let r=this.outlineWidth.build(e,"f"),n=this.resolution.build(e,"v2"),s=this.compensation.build(e,"b"),a=this.pixelRatio.build(e,"f");e.addVertexParsVariable("randomColor","attribute vec3"),e.addVertexParsVariable("extrudeNormal","attribute vec3"),e.addVertexParsVariable(r,"uniform float"),e.addVertexParsVariable(n,"uniform vec2"),e.addVertexParsVariable(s,"uniform bool"),e.addVertexParsVariable(a,"uniform float"),e.addVertexParsVariable("vID","flat out float"),e.addFragmentParsVariable("vID","flat in float"),e.addVertexFinalCode(`
                vID = randomColor.r;
                vec2 ${i}_offset = vec2(0.0);
                if (${s}) {
                    vec4 ${i}_clipPosition = projectionMatrix * (modelViewMatrix * vec4(transformed, 1.0));
                    // NOTE: For certain shapes, like spheres, we get incorrect extrusion when the
                    // normals face the camera directly. So we hackily fix this by offsetting the normal
                    // by a tiny amount.
                    vec3 ${i}_clipNormal = mat3(projectionMatrix) * (mat3(modelViewMatrix) * extrudeNormal) + 0.0000001;
                    ${i}_offset = normalize(${i}_clipNormal.xy) / ${n} * (${r} / 2.0) * ${i}_clipPosition.w * 2.0 * ${a};
                    ${i}_clipPosition.xy += ${i}_offset;
                    // TODO(MAX): To handle multiple outline layers, we only want to extrude
                    // if this offset is the biggest of all the potential offsets
                    gl_Position = ${i}_clipPosition;
                }
            `)}if(e.isShader("fragment")){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let r=e.include(CZ.Nodes.outline),n=[];return n.push(this.outlineColor.build(e,"c")),n.push(this.contourColor.build(e,"c")),n.push(this.outlineWidth.build(e,"f")),n.push(this.contourWidth.build(e,"f")),n.push(this.contourThreshold.build(e,"f")),n.push(this.outlineThreshold.build(e,"f")),n.push(this.contourFrequency.build(e,"f")),n.push(this.outlineSmoothing.build(e,"f")),n.push(this.contourDirection.build(e,"v3")),n.push(this.positionalLines.build(e,"b")),n.push(this.resolution.build(e,"v2")),n.push(this.normalMap.getTexture(e,"t")),n.push(this.depthMap.getTexture(e,"t")),n.push(this.pixelRatio.build(e,"f")),n.push(this.compensation.build(e,"b")),n.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.calpha),this.firstTime=!this.firstTime,e.format(r+"("+n.join(",")+")",this.getType(e),t)}else return console.warn("OutlineNode is not compatible with "+e.shader+" shader."),""}},TZ=CZ;TZ.Nodes=function(){let e=new _t(`
float sobelSample(sampler2D t, sampler2D d, vec2 uv, vec2 resolution, float outlineWidth, float pixelRatio)
{
    vec2 halton = haltonSequence[frameIndex];
    float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
    float temporalAngle  = temporalOffset * PI2;

    vec2 texelSize = (vec2(1.0) / resolution);
    vec2 offsetSize = texelSize * outlineWidth * pixelRatio;

    vec2 uvSamples[9];
    vec4 normalSamples[9];

	uvSamples[0] = uv + vec2( -offsetSize.x, -offsetSize.y) + (vogelDiskSample(0, 9, temporalAngle) * texelSize);
	uvSamples[1] = uv + vec2(0.0, -offsetSize.y) + (vogelDiskSample(1, 9, temporalAngle) * texelSize);
	uvSamples[2] = uv + vec2(  offsetSize.x, -offsetSize.y) + (vogelDiskSample(2, 9, temporalAngle) * texelSize);
	uvSamples[3] = uv + vec2( -offsetSize.x, 0.0) + (vogelDiskSample(3, 9, temporalAngle) * texelSize);
	uvSamples[4] = uv;
	uvSamples[5] = uv + vec2(  offsetSize.x, 0.0) + (vogelDiskSample(5, 9, temporalAngle) * texelSize);
	uvSamples[6] = uv + vec2( -offsetSize.x, offsetSize.y) + (vogelDiskSample(6, 9, temporalAngle) * texelSize);
	uvSamples[7] = uv + vec2(0.0, offsetSize.y) + (vogelDiskSample(7, 9, temporalAngle) * texelSize);
	uvSamples[8] = uv + vec2(  offsetSize.x, offsetSize.y) + (vogelDiskSample(8, 9, temporalAngle) * texelSize);


    normalSamples[0] = texture2D(t, uvSamples[0]);
    normalSamples[1] = texture2D(t, uvSamples[1]);
    normalSamples[2] = texture2D(t, uvSamples[2]);
    normalSamples[3] = texture2D(t, uvSamples[3]);
    normalSamples[4] = texture2D(t, uvSamples[4]);
    normalSamples[5] = texture2D(t, uvSamples[5]);
    normalSamples[6] = texture2D(t, uvSamples[6]);
    normalSamples[7] = texture2D(t, uvSamples[7]);
    normalSamples[8] = texture2D(t, uvSamples[8]);

    float depthBias = 0.0001;
    // TODO(MAX): Can we somehow reduce the number of conditionals here with MATH?!
    if (normalSamples[0].a != vID && normalSamples[0].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[0]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[1].a != vID && normalSamples[1].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[1]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[2].a != vID && normalSamples[2].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[2]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[3].a != vID && normalSamples[3].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[3]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }


    if (normalSamples[4].a != vID && normalSamples[4].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[4]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[5].a != vID && normalSamples[5].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[5]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[6].a != vID && normalSamples[6].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[6]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[7].a != vID && normalSamples[7].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[7]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[8].a != vID && normalSamples[8].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[8]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    vec3 sobel_edge_h = normalSamples[2].rgb + (2.0*normalSamples[5].rgb) + normalSamples[8].rgb - (normalSamples[0].rgb + (2.0*normalSamples[3].rgb) + normalSamples[6].rgb);
  	vec3 sobel_edge_v = normalSamples[0].rgb + (2.0*normalSamples[1].rgb) + normalSamples[2].rgb - (normalSamples[6].rgb + (2.0*normalSamples[7].rgb) + normalSamples[8].rgb);

    float edgeNormal = sqrt(dot(sobel_edge_h, sobel_edge_h) + dot(sobel_edge_v, sobel_edge_v));
    return edgeNormal;
}
`);return{outline:new _t(`vec3 outline(vec3 outlineColor, vec3 contourColor, float outlineWidth, float contourWidth, float outlineThreshold, float contourThreshold, float outlineSmoothing, float contourFrequency, vec3 contourDirection, bool positionalLines, vec2 resolution, sampler2D normalMap, sampler2D depthMap, float pixelRatio, bool compensation, float mask, float alpha, out float calpha) {
                vec3 result = outlineColor;
                float resultAlpha = 0.0;

                vec3 N = normalize(vWNormal);
                vec2 nuv = (gl_FragCoord.xy / resolution);
                float sobelSample = compensation ? sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth / 2., pixelRatio) : sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth, pixelRatio);
                resultAlpha = smoothstep(outlineThreshold - outlineSmoothing, outlineThreshold + outlineSmoothing, sobelSample);

                //resultAlpha = 1.0;
                //result = vec3(sobelSample);

                float t = 1.0 - contourThreshold;
                if(positionalLines) {
                    vec3 NDir = position * contourDirection;
                    float NT = NDir.x + NDir.y + NDir.z;
                    float f  = fract(NT * contourFrequency * 0.01);
                    float df = fwidth(NT * contourFrequency);

                    float g = smoothstep(df * (contourWidth * 0.01), df * (contourWidth * 0.01 * 2.0), f);
                    if (g < 1.0 && resultAlpha == 0.0) {
                        result = contourColor;
                        resultAlpha = 1.0;
                    }
                 }
                 else {
                    vec3 NDir = N * contourDirection;
                    float NT = NDir.x + NDir.y + NDir.z;
                    float df = fwidth(NT * contourThreshold);
                    float f = sin(NT * 1.0 * contourFrequency);
                    float g = smoothstep(0.0, df * contourWidth, 1.0 - f);

                    if (df > (t * 0.5) && g < 1.0 && resultAlpha == 0.0) {
                        result = contourColor;
                        resultAlpha = 1.0 - g;
                    }
                 }

                 float lalpha = alpha * resultAlpha * mask;
                 calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
                 accumAlpha += ( 1.0 - accumAlpha ) * lalpha;
				 
                 return result;
             }`,[e])}}();var Tu=class extends lr{constructor(e,t,i,r,n,s,a,o,l,c,u,h,d,p,f,v,g,m){super("v3"),this.nodeType="Pattern",this.style=e,this.projection=t,this.axis=i,this.blending=r,this.offset=n,this.colorA=s,this.colorB=a,this.frequency=o,this.size=l,this.variation=c,this.smoothness=u,this.zigzag=h,this.rotation=d,this.vertical=p,this.horizontal=f,this.sides=v,this.isMask=m,this.alpha=g,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){e.require("position"),e.require("uv"),e.requires.uv=[!0],e.require("normal"),e.requires.normal=!0,e.addFragmentVariable(this.calpha,"float");let i;switch(this.style.value){case 0:i="circle";break;case 1:i="ring";break;case 2:i="polygon";break;case 3:i="xcross";break;case 4:i="diamond";break;case 5:i="checkerboard";break;case 6:i="line";break;case 7:i="wave";break;default:i="circle";break}let r=`g${this.uuid.toString().replace(/-/g,"")}`,n=new _t(`float hashwithoutsine12(vec2 p)
				{
					vec3 p3 = fract(vec3(p.xyx) * .1031);
					p3 += dot(p3, p3.yzx + 33.33);
					return fract((p3.x + p3.y) * p3.z);
				}`),s=new _t(`vec2 rotate_uv(in vec2 uv, float a, bool repeat) 
				{
					const float mid = 0.5;
					float radians = a * (PI / 180.0);
					vec2 rotated = vec2(
						cos(radians) * (uv.x - mid) + sin(radians) * (uv.y - mid) + mid,
						cos(radians) * (uv.y - mid) - sin(radians) * (uv.x - mid) + mid
					);
					return repeat ? fract(rotated): rotated;
				}`),a="";if(this.projection.value===4){let u=this.style.value===2?`${i}(uv0, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(uv0, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,h=this.style.value===2?`${i}(uv1, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(uv1, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,d=this.style.value===2?`${i}(uv2, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(uv2, frequency, size, variation, smoothness_remapped, zigzag, rotation)`;a=`
				vec3 p = position;
				float factor = 0.0125;
				vec2 uv0 = fract(p.xy * factor);
				vec2 uv1 = fract(p.zy * factor);
				vec2 uv2 = fract(p.xz * factor);
				
				uv0 = rotate_uv(uv0 + offset, rotation, true);
				uv1 = rotate_uv(uv1 + offset, rotation, true);
				uv2 = rotate_uv(uv2 + offset, rotation, true);
	
				float d0 = ${u};
				float d1 = ${h};
				float d2 = ${d};
				
				// Range from 3 to 128 seems to be good
				float exponent = (1.0 - blending) * 125.0 + 3.0;

				vec3 n = vObjectNormal;
				vec3 weights = abs(normalize(n));
				weights = pow(weights, vec3(exponent));
				weights /= dot(weights, vec3(1.0));
				d0 *= weights.z;
				d1 *= weights.x;
				d2 *= weights.y;
				float draw = d0 + d1 + d2;
	
				vec2 custom_uv = uv0 * weights.z + uv1 * weights.x + uv2 * weights.y;
				`}else{let u=this.style.value===2?`${i}(custom_uv, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(custom_uv, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,h="";this.axis.value===0?h=`float radius = length(p);
					float theta = atan(p.y, p.z);
					float phi = acos(p.x / radius);`:this.axis.value===1?h=`float radius = length(p);
					float theta = atan(p.x, p.z);
					float phi = acos(p.y / radius);`:(this.axis.value,h=`float radius = length(p);
					float theta = atan(p.y, p.x);
					float phi = acos(p.z / radius);`);let d="";switch(this.projection.value){case 0:d="custom_uv = vUv.st;";break;case 1:break;case 2:d=`
							vec3 p = position;
							${h}
							custom_uv = vec2(theta, phi);
							custom_uv /= PI;
							`;break}a=`
				vec2 custom_uv;
				${d}
	
				custom_uv += offset;
				custom_uv = fract(custom_uv);
				custom_uv = rotate_uv(custom_uv, rotation, true);
	
				float draw = ${u};
				`}let o=new _t(`vec3 ${r}_pattern(vec3 normal, float blending, int style, vec2 offset, vec4 colorA, vec4 colorB, vec2 frequency, float size, float variation, float smoothness, float zigzag, float rotation, vec2 vertical, vec2 horizontal, int sides, bool isMask, float mask, float alpha, out float calpha) {
					const float TWO_PI = PI * 2.0;
					float smoothness_remapped = pow(smoothness, 5.0);	

					${a}

					// Construct final output color
					vec4 color = mix(colorA, colorB, draw);
					color.a = clamp(color.a, 0.0, 1.0);

					// Apply cuts
					color.a *= 
						step(vertical.x, custom_uv.y) * 
						step(custom_uv.y, vertical.y);
					color.a *= 
						step(horizontal.x, abs(custom_uv.x)) * 
						step(abs(custom_uv.x), horizontal.y);

					// Accumulate alpha 
					float lalpha = alpha * clamp(color.a, 0.0, 1.0) * mask;
					calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
					accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

					return clamp(color, 0.0, 1.0).rgb;
				}`,[s,n,Tu.DrawFunctions.circle,Tu.DrawFunctions.ring,Tu.DrawFunctions.polygon,Tu.DrawFunctions.cross,Tu.DrawFunctions.diamond,Tu.DrawFunctions.checkerboard,Tu.DrawFunctions.line,Tu.DrawFunctions.wave]),l=e.include(o),c=[];return c.push("normal"),c.push(this.blending.build(e,"f")),c.push(this.style.build(e,"i")),c.push(this.offset.build(e,"v2")),c.push(this.colorA.build(e,"v4")),c.push(this.colorB.build(e,"v4")),c.push(this.frequency.build(e,"v2")),c.push(this.size.build(e,"f")),c.push(this.variation.build(e,"f")),c.push(this.smoothness.build(e,"f")),c.push(this.zigzag.build(e,"f")),c.push(this.rotation.build(e,"f")),c.push(this.vertical.build(e,"v2")),c.push(this.horizontal.build(e,"v2")),c.push(this.sides.build(e,"i")),c.push(this.isMask.build(e,"b")),c.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),c.push(this.alpha.build(e,"f")),c.push(this.calpha),e.format(l+"("+c.join(",")+")",this.getType(e),t)}else return console.warn("PatterNode is not compatible with "+e.shader+" shader."),e.format("vec3(0.0)",this.getType(e),t)}},PZ=Tu;PZ.DrawFunctions=function(){let e=new _t(`float hashwithoutsine12(vec2 p) {
				vec3 p3 = fract(vec3(p.xyx) * 0.1031);
				p3 += dot(p3, p3.yzx + 33.33);
				return fract((p3.x + p3.y) * p3.z);
			}`),t=new _t(`vec2 tile_and_center(in vec2 uv, in vec2 frequency, in float variation, in float zigzag, in float rotation) {
                // Create tiles in UV-space
                uv *= frequency;

                // Integer coords
                vec2 i = floor(uv);

                // Offset every other row based on zigzag param, then compute fractional coords
                float row_offset = mod(i.y, 2.0);
                uv.x += row_offset * zigzag;
                vec2 f = fract(uv);

				// Rotate the tile itself:
				// const float mid = 0.5;
				// f = vec2(
				// 	cos(rotation) * (f.x - mid) + sin(rotation) * (f.y - mid) + mid,
				// 	cos(rotation) * (f.y - mid) - sin(rotation) * (f.x - mid) + mid
				// );
				// f = fract(f);

                f = f * 2.0 - 1.0;

				// Recompute integer coords after shifting - then, random value per tile 
				i = floor(uv);
				float rand = (hashwithoutsine12(i) * 5.0 + 1.0);
				float jitter = mix(1.0, rand, variation);
				f *= jitter;

                return f;
            }`,[e]),i=new _t(`float circle(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
                return smoothstep(
                    -smoothness, 
                     smoothness, 
                     length(f) - size
                );
            }`,[t]),r=new _t(`float ring(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);

				float d = length(f);
                const float inner_width = 0.5;

                float outer = smoothstep(-smoothness, smoothness, d - size);
                float inner = smoothstep(-smoothness, smoothness, d - size * inner_width);
				return outer + (1.0 - inner);   
            }`,[t]),n=new _t(`float sdf_ngon(in vec2 p, in float r, in int n) {
                float an = (PI * 2.0) / float(n);
                float he = r * tan(0.5 * an);
                
                // Rotate to first sector
                p = -p.yx; 
                float bn = an * floor((atan(p.y, p.x) + 0.5 * an) / an);
                vec2  cs = vec2(cos(bn), sin(bn));
                p = mat2(cs.x, -cs.y, cs.y, cs.x)*p;
            
                // Side of polygon
                return length(p - vec2(r, clamp(p.y, -he, he))) * sign(p.x - r);
            }
            
            float polygon(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation, in int sides) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
                return smoothstep(-smoothness, smoothness, sdf_ngon(f, size, sides));
            }`,[t]),s=new _t(`float sdf_cross(in vec2 p, in vec2 b, float r ) {
                p = abs(p); 
				p = (p.y > p.x) ? p.yx : p.xy;
                vec2  q = p - b;
                float k = max(q.y, q.x);
                vec2  w = (k > 0.0) ? q : vec2(b.y - p.x, -k);
                return sign(k) * length(max(w, 0.0)) + r;
            }
            
            // Avoid namespace conflicts 
            float xcross(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
                return smoothstep(-smoothness, smoothness, sdf_cross(f, vec2(size, size * 0.25), smoothness));
            }`,[t]),a=new _t(`float ndot(vec2 a, vec2 b) { 
                return a.x*b.x - a.y*b.y; 
            }
            
            float sdf_diamond(in vec2 p, in vec2 b) {
                p = abs(p);
                float h = clamp(ndot(b - 2.0 * p, b) / dot(b, b), -1.0, 1.0);
                float d = length(p - 0.5 * b * vec2(1.0 - h, 1.0 + h));
                return d * sign(p.x * b.y + p.y * b.x - b.x * b.y);
            }

            float diamond(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
	            return smoothstep(-smoothness, smoothness, sdf_diamond(f, vec2(size)));
            }`,[t]),o=new _t(`float checkerboard(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                uv *= frequency;
                vec2 i = floor(uv);

                float offset = mod(i.y, 2.0);

                uv.x += offset + zigzag * offset;
                float x = floor(uv.x);
                
                return mod(x, 2.0);
            }`),l=new _t(`float line(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, 0.0, zigzag, rotation);
				
				// Different approach for variation param here
				float row = floor(uv * frequency).y;
				float rand = hashwithoutsine12(vec2(row));
				float s = mix(size, size * rand, variation);

				return smoothstep(
					s - smoothness, 
					s + smoothness, 
					abs(f.y)
				);
            }`,[t]),c=new _t(`// Uses bisection 
            float udf_cos(in vec2 p, in float a, in float b, in float c, in float d) {
                // Convert all data to a primitive cosine wave
                p = c * (p - vec2(d, a));
                
                const float TWO_PI = PI * 2.0;

                // Reduce to principal half cycle
                p.x = mod(p.x, TWO_PI); 
                if (p.x > PI) {
                    p.x = TWO_PI - p.x;
                }
            
                // Find zero of derivative (minimize distance)
                float xa = 0.0;
                float xb = TWO_PI;

                // 24 bit precision
                for (int i = 0; i < 24; i++) {
                    float x = 0.5 * (xa + xb);
                    float y = x - p.x + b * c * sin(x) * (p.y - b * c * cos(x));
                    if (y < 0.0) xa = x; 
                    else xb = x;
                }
                float x = 0.5 * (xa + xb);
                
                // Compute distance    
                vec2 q = vec2(x, b * c * cos(x));
                return length(p - q) / c;
            }

            float wave(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                float repeat = frequency.x;
                uv *= repeat;
                vec2 i = floor(uv);
                float row_offset = mod(i.y, 2.0);
                uv.x += row_offset * zigzag;
                vec2 f = vec2(uv.x, fract(uv.y));

                // Generalized cosine: y(x) = a + b * cos(cx + d)
                const float amplitude = 0.125;
                float wave_frequency = frequency.y * 0.1;
                float distance_estimate = udf_cos(f, 0.50, amplitude, wave_frequency * (2.0 * PI), 0.0);

				// Different approach for variation param here
				float rand = hashwithoutsine12(vec2(i.y));
				float s = mix(size, size * rand, variation);

                return smoothstep(-smoothness, smoothness, distance_estimate - s * 0.5);
            }`);return{tileAndCenter:t,circle:i,ring:r,polygon:n,cross:s,diamond:a,checkerboard:o,line:l,wave:c}}();var DZ=class extends lr{constructor(e,t,i,r,n,s,a,o){super("v3"),this.nodeType="Rainbow",this.filmThickness=e,this.movement=t,this.wavelengths=i,this.noiseStrength=r,this.noiseScale=n,this.offset=s,this.isMask=o,this.alpha=a,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("vWorldViewDir"),e.require("worldNormal"),e.isShader("fragment")){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let i=e.include(DZ.Nodes.rainbow),r=[];return r.push(this.filmThickness.build(e,"f")),r.push(this.movement.build(e,"f")),r.push(this.wavelengths.build(e,"v3")),r.push(this.noiseStrength.build(e,"f")),r.push(this.noiseScale.build(e,"f")),r.push(this.offset.build(e,"v3")),r.push(this.isMask.build(e,"b")),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("RainbowNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},RZ=DZ;RZ.Nodes=function(){let e=new _t(`vec3 attenuation(vec3 wavelengths, float filmThickness, float movement, float noiseStrength, float noiseScale, vec3 offset) {
                 vec3 st = position / noiseScale;
				 vec3 q = vec3(simplex3d(st),
							  simplex3d(st + vec3(1.0)),
							  simplex3d(st + vec3(1.0)));

				 vec3 r = vec3(simplex3d(st + vec3(1.4, 1.3, 1.0) * q + vec3(1.7, 9.2, 1.0)),
							  simplex3d(st + vec3(2.0, 1.2, 1.0) * q + vec3(8.3, 2.8, 1.0)),
							  simplex3d(st * q));

                 float noise = simplex3d(st + r);

                 return .5 + .5 * cos((((filmThickness + (noise * noiseStrength)) / (vec3(wavelengths.r * 1.0, wavelengths.g * 0.8, wavelengths.b * 0.6) + 1.0)) * dot(normalize(vWorldViewDir + (offset * -0.001)), normalize(vWNormal))) + movement);
             }`,[La.simplex]);return{rainbow:new _t(`vec3 rainbow(float filmThickness, float movement, vec3 wavelengths, float noiseStrength, float noiseScale, vec3 offset, bool isMask, float mask, float alpha, out float calpha) {
				vec3 res = clamp(attenuation(wavelengths, filmThickness, movement, noiseStrength, noiseScale, offset), 0.0, 2.0);

				float rainbowContribution = clamp(res.r + res.g + res.b, 0.0, 1.0);

				float lalpha = alpha * rainbowContribution * mask;
				calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return res;
             }`,[e])}}();var IZ=class extends lr{constructor(e,t,i,r,n,s,a,o,l,c){super("v3"),this.nodeType="Toon",this.positioning=e,this.colors=t,this.steps=i,this.source=r,this.isWorldSpace=n,this.noiseStrength=s,this.noiseScale=a,this.shadowColor=o,this.offset=l,this.alpha=c,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("worldNormal"),e.require("worldPosition"),e.isShader("fragment")){e.define("COLORS_MAX",10),e.addFragmentVariable(this.calpha,"float");let i=e.include(IZ.Nodes.toon),r=[];return r.push(this.positioning.build(e,"i")),r.push(this.colors.build(e,"v4[]")),r.push(this.steps.build(e,"f[]")),r.push(this.source.build(e,"v3")),r.push(this.isWorldSpace.build(e,"b")),r.push(this.noiseStrength.build(e,"f")),r.push(this.noiseScale.build(e,"f")),r.push(this.shadowColor.build(e,"v4")),r.push(this.offset.build(e,"v3")),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("ToonNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},LZ=IZ;LZ.Nodes=function(){let e=new _t(`float rand(float n) {
				return fract(sin(n) * 43758.5453123);
			}`),t=new _t(`float hash1(float p) { 
				p = fract(p * 0.011); 
				p *= p + 7.5; 
				p *= p + p; 
				return fract(p); 
			}`),i=new _t(`float valueNoise(vec3 x) {
				const vec3 step = vec3(110, 241, 171);
			
				vec3 i = floor(x);
				vec3 f = fract(x);
			 
				// For performance, compute the base input to a 1D hash from the integer part of the argument and the 
				// incremental change to the 1D based on the 3D -> 1D wrapping
				float n = dot(i, step);
			
				vec3 u = f * f * (3.0 - 2.0 * f);
				return mix(mix(mix( hash1(n + dot(step, vec3(0, 0, 0))), hash1(n + dot(step, vec3(1, 0, 0))), u.x),
							   mix( hash1(n + dot(step, vec3(0, 1, 0))), hash1(n + dot(step, vec3(1, 1, 0))), u.x), u.y),
						   mix(mix( hash1(n + dot(step, vec3(0, 0, 1))), hash1(n + dot(step, vec3(1, 0, 1))), u.x),
							   mix( hash1(n + dot(step, vec3(0, 1, 1))), hash1(n + dot(step, vec3(1, 1, 1))), u.x), u.y), u.z);
			}`,[t]),r=new _t(`vec3 hash3(vec3 x) {
				x = vec3(dot(x,vec3(127.1, 311.7, 74.7)),
						 dot(x,vec3(269.5, 183.3, 246.1)),
						 dot(x,vec3(113.5, 271.9, 124.6)));
			
				return fract(sin(x)*43758.5453123);
			}`),n=new _t(`vec3 voronoiNoise(in vec3 x)
			{
				vec3 p = floor(x);
				vec3 f = fract(x);

				float id = 0.0;
				vec2 res = vec2(100.0);

				for(int k=-1; k<=1; k++)
				for(int j=-1; j<=1; j++)
				for(int i=-1; i<=1; i++)
				{
					vec3 b = vec3(float(i), float(j), float(k));

					// Comment out the "+ hash(p + b);" part below to get "square" cells
					vec3 r = vec3(b) - f + hash3(p + b);
					float d = dot(r, r);

					if (d < res.x)
					{
						id = dot(p + b, vec3(1.0, 57.0, 113.0));
						res = vec2(d, res.x);			
					}
					else if (d < res.y)
					{
						res.y = d;
					}
				}

				return vec3(sqrt(res), abs(id));
			}
			`,[r]);return{toon:new _t(`vec3 toon(int positioning, vec4 colors[COLORS_MAX], float steps[COLORS_MAX], vec3 source, bool isWorldSpace, float noiseStrength, float noiseScale, vec4 shadowColor, vec3 offset, float mask, float alpha, out float calpha) {
				float t = 0.0;
				float shadow = 1.0;

				if (positioning == 0) {

					// Can't do this mode if lighting is "none"
					#if (defined(PHONG) || defined(LAMBERT) || defined(STANDARD))

						// Algorithm from Chapter 10 of Graphics Shaders
						const vec3 weights = vec3(0.2125, 0.7154, 0.0721);
						vec3 lpos;
						vec3 l;
						float dproduct;

						#if (NUM_POINT_LIGHTS > 0)

							#if defined(USE_SHADOWMAP) && (NUM_POINT_LIGHT_SHADOWS > 0)
								PointLightShadow pointLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_POINT_LIGHTS; i++) {
								// Light positions are in view-space for some reason?
								lpos = (inverse(viewMatrix) * vec4(pointLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;
								l = normalize(lpos - worldPosition);
								
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								
								// TODO: we want to use "intensity" but it isn't available in the shader code
								//dproduct += dot(pointLights[UNROLLED_LOOP_INDEX].color, weights);

								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS)
									pointLightShadow = pointLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getPointShadow( 
											pointShadowMap[UNROLLED_LOOP_INDEX], 
											pointLightShadow.shadowMapSize, 
											pointLightShadow.shadowBias, 
											pointLightShadow.shadowRadius,
											vPointShadowCoord[UNROLLED_LOOP_INDEX], 
											pointLightShadow.shadowCameraNear, 
											pointLightShadow.shadowCameraFar);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						#if NUM_DIR_LIGHTS > 0 
							
							#if defined(USE_SHADOWMAP) && (NUM_DIR_LIGHT_SHADOWS > 0)
								DirectionalLightShadow directionalLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_DIR_LIGHTS; i++) {
								// Use the direction vector for directional lights instead
								l = (inverse(viewMatrix) * vec4(directionalLights[UNROLLED_LOOP_INDEX].direction, 0.0)).xyz;
		
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS)
									directionalLightShadow = directionalLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getShadow( 
										UNROLLED_LOOP_INDEX,
										directionalShadowMap[UNROLLED_LOOP_INDEX], 
										directionalLightShadow.shadowMapSize, 
										directionalLightShadow.shadowBias, 
										directionalLightShadow.shadowRadius, 
										vDirectionalShadowCoord[UNROLLED_LOOP_INDEX]);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						#if NUM_SPOT_LIGHTS > 0 
							
							#if defined(USE_SHADOWMAP) && (NUM_SPOT_LIGHT_SHADOWS > 0)
								SpotLightShadow spotLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_SPOT_LIGHTS; i++) {
								lpos = (inverse(viewMatrix) * vec4(spotLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;
								l = normalize(lpos - worldPosition);
								
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS)
									spotLightShadow = spotLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getShadow(
										UNROLLED_LOOP_INDEX,
										spotShadowMap[UNROLLED_LOOP_INDEX], 
										spotLightShadow.shadowMapSize, 
										spotLightShadow.shadowBias, 
										spotLightShadow.shadowRadius, 
										vSpotLightCoord[UNROLLED_LOOP_INDEX]);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						t = clamp(t, 0.0, 1.0);
				
					#endif

				} else if (positioning == 1) {
					
					vec3 origin = mix(position, worldPosition, float(isWorldSpace));
					vec3 direction = normalize(source - origin);
					t = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;	

				} else {

					vec3 origin = worldPosition;
					vec3 source = cameraPosition - offset;
					vec3 direction = normalize(source - origin);
					t = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;	
					
				}

				if (noiseStrength > 0.0) {
					// Distort with noise
					vec3 st = position / noiseScale;
					
					// Voronoi "smooth" noise
					float noise = 1.0 - voronoiNoise(st).x;

					// Voronoi cellular noise
					//float noise = 1.0 - rand(voronoiNoise(st).z);

					// Position warp noise
					// vec3 offset = vec3(
					// 	simplex3d(st),
					// 	simplex3d(st + vec3(111.1, 143.89, 217.19)),
					// 	simplex3d(st + vec3(171.1, 247.89, 117.23))
					// );
					// st += offset;
					// float noise = valueNoise(st);

					t += noise * noiseStrength;
				}

				t = clamp(t, 0.0, 1.0);

				// Compute ramp color
				float p;
				vec4 color = colors[0];
				for (int i = 1; i < COLORS_MAX; i++) {
					p = clamp((t - steps[i-1]) / (steps[i] - steps[i-1]), 0.0, 1.0);
					color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
				}

				// Incorporate custom shadow color
				if (positioning == 0) {

					vec3 blendedShadow = mix(color.rgb, shadowColor.rgb, shadowColor.a);
					color.rgb = mix(blendedShadow, color.rgb, shadow);
				
				}

				// Accumulate alpha as usual
				float lalpha = alpha * color.a * mask;
				calpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha;

				return color.xyz;

            }`,[La.simplex,e,i,n])}}();var QMe=function(){return{textureBicubic:new _t(`float w0( float a ) {
            return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
        }
    
        float w1( float a ) {
            return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
        }
    
        float w2( float a ){
            return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
        }
    
        float w3( float a ) {
            return ( 1.0 / 6.0 ) * ( a * a * a );
        }
    
        // g0 and g1 are the two amplitude functions
        float g0( float a ) {
            return w0( a ) + w1( a );
        }
    
        float g1( float a ) {
            return w2( a ) + w3( a );
        }
    
        // h0 and h1 are the two offset functions
        float h0( float a ) {
            return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
        }
    
        float h1( float a ) {
            return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
        }
    
        vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
            uv = uv * texelSize.zw + 0.5;
    
            vec2 iuv = floor( uv );
            vec2 fuv = fract( uv );
    
            float g0x = g0( fuv.x );
            float g1x = g1( fuv.x );
            float h0x = h0( fuv.x );
            float h1x = h1( fuv.x );
            float h0y = h0( fuv.y );
            float h1y = h1( fuv.y );
    
            vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
            vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
            vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
            vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
    
            return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) + 
                   g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
        }

        vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
            vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
            vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
            vec2 fLodSizeInv = 1.0 / fLodSize;
            vec2 cLodSizeInv = 1.0 / cLodSize;
            vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
            vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
            return mix( fSample, cSample, fract( lod ) );
        }`)}}();function KMe(e,t){return e>=t?new ve(t/e,1):new ve(1,e/t)}var OZ=class extends lr{constructor(e,t,i,r,n,s,a,o){super("v3"),this.nodeType="Transmission",this.thickness=e,this.ior=t,this.roughness=i,this.transmissionSamplerSize=r,this.transmissionSamplerMap=n,this.transmissionDepthMap=s,this.aspectRatio=a,this.alpha=o,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.extensions.shaderTextureLOD=!0,e.extensions.derivatives=!0,e.isShader("fragment")){e.define("NUM_SAMPLES",6),e.define("BLUR_SLOD",Math.pow(2,qt.transmissionLod.value)),e.require("worldPosition"),e.requires.worldNormal=!0,e.requires.modelMatrix=!0,e.requires.projectionMatrix=!0,e.addFragmentVariable(this.calpha,"float");let i=e.include(OZ.Nodes.transmission),r=[];return r.push(this.thickness.build(e,"f")),r.push(this.ior.build(e,"f")),r.push(this.roughness.build(e,"f")),r.push(this.transmissionSamplerSize.build(e,"v2")),r.push(this.transmissionSamplerMap.getTexture(e,"t")),r.push(this.transmissionDepthMap.getTexture(e,"t")),r.push(this.aspectRatio.build(e,"v2")),r.push("normal"),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("TransmissionNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},zZ=OZ;zZ.Nodes=function(){let e=new _t(`vec3 blur(sampler2D sp, vec2 U, vec2 scale, float lod, sampler2D dm, vec2 unrefractedU, vec2 aspectRatio) {
                // Slightly modified version of this:
                // https://www.shadertoy.com/view/ltScRG

				// Special case for blur == 0.0
				if (lod == 0.0) {
					#ifdef TEXTURE_LOD_EXT
					return texture2DLodEXT( sp, U, 0.0).rgb;
					#else
					return textureLod( sp, U, 0.0).rgb;
					#endif
				}
				
				vec2 texelSize = vec2(1.0) / resolution;
                vec2 halton = haltonSequence[frameIndex];
                float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
                float temporalAngle  = temporalOffset * PI2;
				vec3 res = vec3(0.0);
                vec2 uv = vec2(0.0);
                vec2 offset = vec2(0.0);
                vec2 vogelSample = vec2(0.0);
                for (int i = 0; i < NUM_SAMPLES; i++) {
                    vogelSample =  vogelDiskSample(i, NUM_SAMPLES, temporalAngle) * texelSize;
                    offset = vogelSample * scale * (lod * 10.0); // TODO: used to be hardcoded to 20
                    uv = U + offset;
                    float opaqueDepth = unpackRGBAToDepth(textureLod(dm, uv, lod));
                    if (opaqueDepth != 0.0 && opaqueDepth < gl_FragCoord.z) {
                        uv = unrefractedU;
                        lod = lod > 4.0 ? lod : lod / 2.0;
                    }
                    res += textureLod(sp, uv, lod).rgb;
                }
                return res / float(NUM_SAMPLES);
            }`),t=new _t(`vec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {
		        // Direction of refracted light.
		        vec3 refractionVector = refract( -v,  n, 1.0 / ior );
		        
				// Compute rotation-independant scaling of the model matrix.
		        vec3 modelScale;
		        modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		        modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		        modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );

		        // The thickness is specified in local space
		        return normalize( refractionVector ) * thickness * modelScale;
	        }`),i=new _t(`float applyIorToRoughness( float roughness, float ior ) {
				// Scale roughness with IOR so that an IOR of 1.0 results in no microfacet refraction and
				// an IOR of 1.5 results in the default amount of microfacet refraction.
				return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
			}`),r=new _t(`vec3 getTransmissionSample( vec2 fragCoord, float roughness, float ior, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 unrefractedCoords, vec2 aspectRatio) {
				// Threejs exports do not pass a depth map to this shader, so we have to fallback to the "Threejs method of blurring" - see
				// also the code in convertTransmission.ts, which runs during export
				#ifdef IS_THREEJS_EXPORT
					float lod = log2(transmissionSamplerSize.x) * applyIorToRoughness(roughness / 5.0, ior);
					return textureBicubic(transmissionSamplerMap, fragCoord.xy, lod).rgb;
				#else
					float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
					float lod = applyIorToRoughness(roughness, ior);
					return blur(transmissionSamplerMap, fragCoord, vec2(lod), min(framebufferLod / 5.5, 8.5), transmissionDepthMap, unrefractedCoords, aspectRatio);
				#endif
			}`,[QMe.textureBicubic,i,e]),n=new _t(`vec3 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;

				// Project refracted vector on the framebuffer, while mapping to normalized device coordinates.
				vec4 ndcPos = projMatrix * viewMatrix *  vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;

				vec4 ndcPosUnrefracted = projMatrix * viewMatrix * vec4(position, 1.0 );
				vec2 unrefractedCoords = ndcPosUnrefracted.xy / ndcPosUnrefracted.w;
				unrefractedCoords += 1.0;
				unrefractedCoords /= 2.0;

				// Sample framebuffer to get pixel the refracted ray hits.
				return getTransmissionSample( refractionCoords, roughness, ior, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, unrefractedCoords, aspectRatio );
    		}`,[r,t]);return{transmission:new _t(`vec3 transmission(float thickness, float ior, float roughness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio, vec3 normal, float mask, float alpha, out float calpha) {
                vec3 v = vec3(0.);
                if (isOrthographic) {
                    v = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
                } else {
                    v = normalize(vWPosition - cameraPosition);
                }
                vec3 transmission = getIBLVolumeRefraction(vWNormal, -v, roughness,  vWPosition, modelMatrix, viewMatrix, projectionMatrix, ior, thickness, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, aspectRatio );
                
				float lalpha = alpha * mask;
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * alpha;

				return transmission;
            }`,[n])}}();var JO=(e=>(e.NOISE="noise",e.MAP="map",e))(JO||{}),NZ=class extends lr{constructor(e,t,i,r,n,s,a,o,l,c,u){super("v3"),this.displacementTypeIndex=new ur(0),this.nodeType="VertexDisplacement",this.intensity=e,this.movementOrTexture=t,Object.values(JO)[this.displacementTypeIndex.value]==="map"&&(this.mat=new vZ(this.movementOrTexture.value.matrix)),this.cropOrOffset=i,this.scale=c,this.noiseFunctionIndex=u,this.voronoiStyle=r,this.smoothness=n,this.seed=s,this.highCut=a,this.lowCut=o,this.quality=l}generate(e,t){if(e.isShader("vertex")){e.define("USE_LAYER_DISPLACE");let i,r=[];switch(r.push("displaced_position"),r.push("displaced_normal"),Object.values(JO)[this.displacementTypeIndex.value]){case"map":{i=e.include(NZ.Nodes.map),r.push(this.movementOrTexture.getTexture(e,"t")),r.push("uv"),r.push(this.cropOrOffset.build(e,"f")),this.mat&&r.push(this.mat.build(e,"mat3"));break}case"noise":{let n=Object.values(pk)[this.noiseFunctionIndex.value],s=new _t(`vec3 orthogonal(vec3 v) {
							return normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));
						}`),a=n=="voronoi"?`
					float v = ${n}((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1), voronoiStyle, smoothness, seed, quality);
					v = remap(v, lowCut, highCut, 0.0, 1.0);
					v = smax(v, 0.0, smoothness * 0.25);
					v = smin(v, 1.0, smoothness * 0.25);

					return p + n * v * intensity;
					`:`
					return p + n * ${n}((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1)) * intensity;
					`,o=new _t(`vec3 distorted(vec3 p, vec3 n, float scale, float intensity, vec3 offset, float neighbour_offset, float movement, int voronoiStyle, float smoothness, float seed, float highCut, float lowCut, int quality) {
							${a}
						}`,[La.simplex,La.simplexFractal,La.simplexAshima,La.fbm,La.perlin,La.voronoi]),l=new _t(`vec3 vertexDisplacementNoise(vec3 position, vec3 normal, float scale, vec3 offset, float movement, int voronoiStyle, float smoothness, float seed, float highCut, float lowCut, int quality, float intensity, out vec3 displaced_normal) {
							vec3 displaced_position = distorted(position, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);
							vec3 tangent1 = orthogonal(normal);
							vec3 tangent2 = normalize(cross(normal, tangent1));

                            // TODO(Max): The distance to the neighbors was originally scaled by 0.1.
                            // This caused some small oval/circular visual artifacts in the lighting.
                            // For now, simply using neighbors further away betters the problem,
                            // but we should figure out the underlying cause when we have some time.
                            // Maybe its related to how we calculate the tangent and bitangent?
							vec3 nearby1 = position + tangent1;
							vec3 nearby2 = position + tangent2;
							vec3 distorted1 = distorted(nearby1, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);
							vec3 distorted2 = distorted(nearby2, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);
							displaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));
							return displaced_position;
						}`,[o,s]);i=e.include(l),r.push(this.scale.build(e,"f")),r.push(this.cropOrOffset.build(e,"v3")),r.push(this.movementOrTexture.build(e,"f")),r.push(this.voronoiStyle.build(e,"i")),r.push(this.smoothness.build(e,"f")),r.push(this.seed.build(e,"f")),r.push(this.highCut.build(e,"f")),r.push(this.lowCut.build(e,"f")),r.push(this.quality.build(e,"i"));break}}return r.push(this.intensity.build(e,"f")),r.push("displaced_normal"),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("VertexDisplacementNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},BZ=NZ;BZ.Nodes=function(){let e=new _t(`vec3 orthogonal(vec3 v) {
				return normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));
			}`),t=new _t(`float displacementMapTexture(sampler2D tex, float crop, vec2 uv, mat3 mat, vec2 offset) {
				vec2 uvs = (mat * vec3(uv * 2.0 - 1.0, 1.0) / 2.0 + 0.5).xy + offset;
				vec4 tmp = texture2D(tex, uvs);
				vec3 col = tmp.rgb;
				if (crop > 0.5) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						return 0.0;
					}
				}
				return col.r;
			}`);return{map:new _t(`vec3 vertexDisplacementMap(vec3 position, vec3 normal, sampler2D tex, vec2 uv, float crop, mat3 mat, float intensity, out vec3 displaced_normal) {
				vec3 displaced_position = position + normal * displacementMapTexture(tex, crop, uv, mat, vec2(0.0)) * intensity;
				vec3 tangent1 = normalize(orthogonal(normal));
				vec3 tangent2 = normalize(cross(normal, tangent1));
				vec3 nearby1 = position + tangent1 * 0.1;
				vec3 nearby2 = position + tangent2 * 0.1;
				vec3 distorted1 = nearby1 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;
				vec3 distorted2 = nearby2 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;
				displaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));
				return displaced_position;
			}`,[e,t])}}();var qt={normalRenderTarget:new Fu,normalRenderTargetDepth:new Fu,transmissionRenderTarget:new Fu,aspectRatio:new gs,transmissionSize:new gs(2048,2048),transmissionRenderTargetDepth:new Fu,aoRenderTarget:new Fu,aoEnabled:new da,pixelRatioNode:new Tt(1),resolution:new gs,penumbraSize:new Gp(5,.5),frameIndex:new ur(0),transmissionLod:new ur(2)};for(let e of Object.values(qt))e.isRenderGlobal=!0;var kZ={skiaWasmUrl:"https://unpkg.com/@splinetool/ui-wasm@1.9.25/build/ui.wasm"},fk=class extends zn{constructor(){super("basic"),this.nodeType="Basic",this.color=new $r(vo),this.shadingAlpha=new Tt(1),this.shadingBlend=new ur(0),this.previousModelViewMatrix=new Yc,this.previouseProjectionMatrix=new Yc}get category(){return"phong"}generate(t){let i;if(t.isShader("vertex")){let r=this.position?this.position.analyzeAndFlow(t,"v3",{cache:"position"}):void 0;t.mergeUniform({frameIndex:qt.frameIndex}),t.mergeUniform({resolution:qt.resolution}),t.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),t.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),t.mergeUniform(S0.merge([wt.fog])),t.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <normal_pars_vertex>"].join(`
`));let n=["#include <beginnormal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = normal;

				#if defined( USE_LAYER_DISPLACE )
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <begin_vertex>
				#endif /* !USE_LAYER_DISPLACE */
				`];r&&n.push(r.code,r.result?"displaced_position = "+r.result+";":""),n.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","	vNormal = transformedNormal;","#endif"),n.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>"),n.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),i=n.join(`
`)}else{this.color===void 0&&(this.color=new $r(vo)),this.color.analyze(t,{slot:"color"}),this.alpha&&this.alpha.analyze(t),this.afterColor&&this.afterColor.analyze(t,{slot:"afterColor"});let r=this.color.flow(t,"c",{slot:"color"}),n=this.alpha?this.alpha.flow(t,"f"):void 0,s=this.alphaOverride?this.alphaOverride.flow(t,"f"):void 0,a=this.afterColor?this.afterColor.flow(t,"c",{slot:"afterColor"}):void 0;t.requires.transparent=n!==void 0,t.addParsCode(["varying vec3 vWPosition;","#include <fog_pars_fragment>","#include <dithering_pars_fragment>","varying vec3 vViewPosition;","#include <normal_pars_fragment>"].join(`
`));let o=["#include <normal_fragment_begin>",r.code];n&&o.push(n.code,"#ifdef ALPHATEST"," if ( "+n.result+" <= ALPHATEST ) discard;","#endif"),a?o.push(a.code,`vec3 outgoingLight = ${r.result};`,`vec3 finalColor = spe_blend(outgoingLight, ${a.result}, 1.0, SPE_BLENDING_NORMAL);`):o.push(`vec3 finalColor = ${r.result};`);let l="1.0";this.mask&&(this.mask.analyze(t),l=`luminance(${this.mask.flow(t,"v3").result})`),n?o.push(`gl_FragColor = vec4( finalColor, accumAlpha * ${n.result} * ${l} );`):o.push("gl_FragColor = vec4("+r.result+", 1.0 );"),s&&o.push(`gl_FragColor.a *= ${s.result};`),o.push("#include <fog_fragment>","#include <dithering_fragment>"),i=o.join(`
`)}return i}},ZMe=class extends zn{constructor(){super("lambert"),this.nodeType="Lambert",this.color=new $r(vo),this.emissive=new $r(0),this.emissiveIntensity=new Tt(1),this.previousModelViewMatrix=new Yc,this.previouseProjectionMatrix=new Yc,this.shadingAlpha=new Tt(1),this.shadingBlend=new ur(0),this.occlusion=new da(!0)}get category(){return"lambert"}build(e){let t;if(e.define("LAMBERT"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:qt.frameIndex}),e.mergeUniform({resolution:qt.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(S0.merge([wt.fog,wt.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","	varying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <color_pars_vertex>","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = objectNormal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("	#include <project_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>",`
					vec3 diffuse = vec3( 1.0 );
					GeometricContext geometry;
					geometry.position = mvPosition.xyz;
					geometry.normal = normalize( transformedNormal );
					geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
				`),r.push(`
					GeometricContext backGeometry;
					backGeometry.position = geometry.position;
					backGeometry.normal = -geometry.normal;
					backGeometry.viewDir = geometry.viewDir;
					vLightFront = vec3( 0.0 );
					vIndirectFront = vec3( 0.0 );
					#ifdef DOUBLE_SIDED
						vLightBack = vec3( 0.0 );
						vIndirectBack = vec3( 0.0 );
					#endif
					IncidentLight directLight;
					float dotNL;
					vec3 directLightColor_Diffuse;
					vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
					vIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );
					#ifdef DOUBLE_SIDED
						vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
						vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );
					#endif
					#if NUM_POINT_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
							getPointLightInfo( pointLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_SPOT_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
							getSpotLightInfo( spotLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_DIR_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
							getDirectionalLightInfo( directionalLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_HEMI_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
							vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
							#ifdef DOUBLE_SIDED
								vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );
							#endif
						}
						#pragma unroll_loop_end
					#endif
				`,"	#include <shadowmap_vertex>","	#include <fog_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{e.mergeUniform({penumbraSize:qt.penumbraSize}),e.mergeUniform({frameIndex:qt.frameIndex}),e.mergeUniform({aoMap:qt.aoRenderTarget}),e.mergeUniform({aoEnabled:qt.aoEnabled}),this.color===void 0&&(this.color=new $r(vo)),this.color.analyze(e,{slot:"color"}),this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let i=this.color.flow(e,"c",{slot:"color"}),r=this.emissive.flow(e,"c",{slot:"emissive"}),n=this.emissiveIntensity.flow(e,"f",{slot:"emissive"}),s=this.occlusion.flow(e,"b",{slot:"occlusion"}),a=this.shadingAlpha.flow(e,"f"),o=this.shadingBlend.flow(e,"i"),l=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,c=this.alpha?this.alpha.flow(e,"f"):void 0,u=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0;e.requires.transparent=c!==void 0,e.addParsCode(["uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#include <normal_pars_fragment>","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","	varying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <fog_pars_fragment>","#include <shadowmap_pars_fragment>","#include <shadowmask_pars_fragment>","#include <clipping_planes_pars_fragment>","#include <dithering_pars_fragment>"].join(`
`));let h=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx, viewdy));
				bool isFrontFacing = (dot(normal, faceNormal) >= 0.0);
				`,"#include <clipping_planes_fragment>"];h.push(i.code,"vec3 diffuseColor = "+i.result+";","ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );"),c&&h.push(c.code,"#ifdef ALPHATEST","if ( "+c.result+" <= ALPHATEST ) discard;","#endif"),h.push("#ifdef DOUBLE_SIDED","	reflectedLight.indirectDiffuse += ( isFrontFacing ) ? vIndirectFront : vIndirectBack;","#else","	reflectedLight.indirectDiffuse += vIndirectFront;","#endif","#include <lightmap_fragment>","reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );","#ifdef DOUBLE_SIDED","	reflectedLight.directDiffuse = ( isFrontFacing ) ? vLightFront : vLightBack;","#else","	reflectedLight.directDiffuse = vLightFront;","#endif","reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();"),r&&h.push(r.code,"reflectedLight.directDiffuse += "+r.result+" * "+n.result+";"),h.push("vec3 ao = aoEnabled && "+s.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = (reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) ;");let d="1.0";this.mask&&(this.mask.analyze(e),d=`luminance(${this.mask.flow(e,"v3").result})`),h.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${a.result} * ${d} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${a.result} * ${d}, ${o.result} );

					outgoingLight *= ao;
				}
				`),l&&h.push(l.code,`outgoingLight = spe_blend(outgoingLight, ${l.result}, 1.0, SPE_BLENDING_NORMAL);`),c?h.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${c.result} );`):h.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),u&&h.push(`gl_FragColor.a *= ${u.result};`),h.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=h.join(`
`)}return t}},s0=function(){let e=new _t(`vec2 dHdxy(sampler2D bumpMap, vec2 bumpMapUv, float bumpScale) {

            // Gradient of UVs w.r.t. X coordinate (in screen-space)
            vec2 dSTdx = dFdx(bumpMapUv);

            // Gradient of UVs w.r.t. Y coordinate (in screen-space)
            vec2 dSTdy = dFdy(bumpMapUv);
            
            // Forward differencing
            float Hll = bumpScale * luminance(texture(bumpMap, bumpMapUv).rgb);
            float dBx = bumpScale * luminance(texture(bumpMap, bumpMapUv + dSTdx).rgb) - Hll;
            float dBy = bumpScale * luminance(texture(bumpMap, bumpMapUv + dSTdy).rgb) - Hll;
            
            return vec2( dBx, dBy );
        }`),t=new _t(`vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
            vec3 vSigmaX = dFdx( surf_pos.xyz );
            vec3 vSigmaY = dFdy( surf_pos.xyz );
            vec3 vN = surf_norm; // normalized
            
            vN = normalize(vN);

            vec3 R1 = cross( vSigmaY, vN );
            vec3 R2 = cross( vN, vSigmaX );

            R1 = normalize(R1);
            R2 = normalize(R2);
    
            float fDet = dot( vSigmaX, R1 ) * faceDirection;
    
            vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
            return normalize( abs( fDet ) * vN - vGrad );
        }`);return{dHdxy:e,perturbNormalArb:t}}(),$Me=class extends zn{constructor(){super("phong"),this.nodeType="Phong",this.color=new $r(vo),this.specular=new $r(1118481),this.shininess=new Tt(30),this.previousModelViewMatrix=new Yc,this.previouseProjectionMatrix=new Yc,this.shadingAlpha=new Tt(1),this.shadingBlend=new ur(0),this.occlusion=new da(!0)}get category(){return"phong"}build(e){let t;if(e.define("PHONG"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:qt.frameIndex}),e.mergeUniform({resolution:qt.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(S0.merge([wt.fog,wt.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = objectNormal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("	#include <project_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>","	#include <shadowmap_vertex>","	#include <fog_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{e.mergeUniform({penumbraSize:qt.penumbraSize}),e.mergeUniform({frameIndex:qt.frameIndex}),e.mergeUniform({aoMap:qt.aoRenderTarget}),e.mergeUniform({aoEnabled:qt.aoEnabled}),this.color===void 0&&(this.color=new $r(vo)),this.color.analyze(e,{slot:"color"}),this.specular.analyze(e),this.shininess.analyze(e);let i=this.occlusion.flow(e,"b",{slot:"occlusion"});this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let r=this.color.flow(e,"c",{slot:"color"}),n=this.specular.flow(e,"c"),s=this.shininess.flow(e,"f"),a=this.shadingAlpha.flow(e,"f"),o=this.shadingBlend.flow(e,"i"),l=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,c=this.alpha?this.alpha.flow(e,"f"):void 0,u=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0;e.requires.transparent=c!==void 0,e.addParsCode(["varying vec3 vWPosition;","uniform vec3 emissive;","uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","#include <normal_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_phong_pars_fragment>","#include <shadowmap_pars_fragment>","#include <dithering_pars_fragment>"].join(`
`));let h=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	BlinnPhongMaterial material;"];if(this.bumpMap){e.include(s0.dHdxy),e.include(s0.perturbNormalArb);let p=this.bumpMap.texture.flow(e,"t"),f=this.bumpMap.flow(e,"v3"),v=this.bumpMapIntensity?this.bumpMapIntensity.flow(e,"f").result:"1.0",g="";this.bumpMap.projection.value===4?g=`
					vec3 bumpNormal = vec3(0.0);
					{
						vec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						vec2 grad0 = dHdxy(${p.result}, uv0, ${v});
						vec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);

						vec2 grad1 = dHdxy(${p.result}, uv1, ${v});
						vec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);

						vec2 grad2 = dHdxy(${p.result}, uv2, ${v});
						vec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);
						
						bumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;
						bumpNormal = normalize(bumpNormal);
					}

					normal = bumpNormal;
					`:g=`
					vec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;
					vec2 grad = dHdxy(${p.result}, bumpMapCachedUv, ${v});
					normal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );
					`,h.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${f.result};
					${g}
					`)}h.push(r.code,"	vec3 diffuseColor = "+r.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","	vec3 totalEmissiveRadiance = emissive;",n.code,"	vec3 specular = "+n.result+";",s.code,"	float shininess = max( 0.0001, "+s.result+" );","	float specularStrength = 1.0;"),c&&h.push(c.code,"#ifdef ALPHATEST","if ( "+c.result+" <= ALPHATEST ) discard;","#endif"),h.push("material.diffuseColor = diffuseColor;"),h.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),h.push("vec3 ao = aoEnabled && "+i.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse)) + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;");let d="1.0";this.mask&&(this.mask.analyze(e),d=`luminance(${this.mask.flow(e,"v3").result})`),h.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${a.result} * ${d} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${a.result} * ${d}, ${o.result} );
					
					outgoingLight *= ao;
				}
				`),l&&h.push(l.code,`outgoingLight = spe_blend(outgoingLight, ${l.result}, 1.0, SPE_BLENDING_NORMAL);`),c?h.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${c.result});`):h.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),u&&h.push(`gl_FragColor.a *= ${u.result};`),h.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=h.join(`
`)}return t}},JMe=class extends zn{constructor(){super("standard"),this.nodeType="Standard",this.color=new $r(vo),this.roughness=new Tt(.3),this.metalness=new Tt(0),this.reflectivity=new Tt(.5),this.previousModelViewMatrix=new Yc,this.previouseProjectionMatrix=new Yc,this.shadingAlpha=new Tt(1),this.shadingBlend=new ur(0),this.occlusion=new da(!0)}get category(){return"physical"}build(e){let t;if(e.define("STANDARD"),e.requires.lights=!0,e.extensions.derivatives=!0,e.extensions.shaderTextureLOD=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:qt.frameIndex}),e.mergeUniform({resolution:qt.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(S0.merge([wt.fog,wt.lights])),wt.LTC_1&&(e.uniforms.ltc_1={value:void 0},e.uniforms.ltc_2={value:void 0}),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#if !defined( USE_LAYER_DISPLACE )
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = objectNormal;

				#if defined( USE_LAYER_DISPLACE )
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <begin_vertex>
				#endif /* !USE_LAYER_DISPLACE */
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>","#include <shadowmap_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{e.mergeUniform({penumbraSize:qt.penumbraSize}),e.mergeUniform({frameIndex:qt.frameIndex}),e.mergeUniform({aoMap:qt.aoRenderTarget}),e.mergeUniform({aoEnabled:qt.aoEnabled});let i={gamma:!0};this.color===void 0&&(this.color=new $r(vo)),this.color.analyze(e,{slot:"color",context:i}),this.roughness.analyze(e),this.metalness.analyze(e);let r=this.occlusion.flow(e,"b",{slot:"occlusion"});this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e),this.reflectivity&&this.reflectivity.analyze(e);let n=this.color.flow(e,"c",{slot:"color",context:i}),s=this.roughness.flow(e,"f"),a=this.metalness.flow(e,"f"),o=this.shadingAlpha.flow(e,"f"),l=this.shadingBlend.flow(e,"i"),c=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,u=this.alpha?this.alpha.flow(e,"f"):void 0,h=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0,d=this.reflectivity?this.reflectivity.flow(e,"f"):void 0;e.requires.transparent=u!==void 0,e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","#include <normal_pars_fragment>","#include <dithering_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_physical_pars_fragment>","#include <shadowmap_pars_fragment>"].join(`
`));let p=["#include <clipping_planes_fragment>","	#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	PhysicalMaterial material;","	material.diffuseColor = vec3( 1.0 );"];if(this.bumpMap){e.include(s0.dHdxy),e.include(s0.perturbNormalArb);let v=this.bumpMap.texture.flow(e,"t"),g=this.bumpMap.flow(e,"v3"),m=this.bumpMapIntensity?this.bumpMapIntensity.flow(e,"f").result:"1.0",x="";this.bumpMap.projection.value===4?x=`
					vec3 bumpNormal = vec3(0.0);
					{
						vec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						vec2 grad0 = dHdxy(${v.result}, uv0, ${m});
						vec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);

						vec2 grad1 = dHdxy(${v.result}, uv1, ${m});
						vec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);

						vec2 grad2 = dHdxy(${v.result}, uv2, ${m});
						vec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);
						
						bumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;
						bumpNormal = normalize(bumpNormal);
					}

					normal = bumpNormal;
					`:x=`
					vec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;
					vec2 grad = dHdxy(${v.result}, bumpMapCachedUv, ${m});
					normal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );
					`,p.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${g.result};
					${x}
					`)}if(p.push(n.code,"	vec3 diffuseColor = "+n.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",a.code,"	float metalnessFactor = "+a.result+";"),this.roughnessMap){let v=this.roughnessMap.texture.flow(e,"t"),g=this.roughnessMap.flow(e,"v3"),m="";this.roughnessMap.projection.value===4?m=`
					float roughnessChange = 1.0;
					{
						vec2 uv0 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						float r0 = luminance(texture(${v.result}, uv0).rgb) * roughnessScale;
						float r1 = luminance(texture(${v.result}, uv1).rgb) * roughnessScale;
						float r2 = luminance(texture(${v.result}, uv2).rgb) * roughnessScale;

						roughnessChange = (r0 * weights.z + r1 * weights.x + r2 * weights.y);
					}
					float roughnessFactor = roughnessChange * ${s.result};
					`:m=`
					vec2 roughnessMapCachedUv = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs;

					vec4 vals = texture(${v.result},  roughnessMapCachedUv);
					float roughnessFactor = luminance(vals.rgb) * ${s.result};
					`,p.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${g.result};

					const float roughnessScale = 1.0;

					${m}
				`)}else p.push(s.code,"	float roughnessFactor = "+s.result+";");u&&p.push(u.code,"#ifdef ALPHATEST","	if ( "+u.result+" <= ALPHATEST ) discard;","#endif"),p.push("vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );"),p.push("material.diffuseColor = diffuseColor * ( 1.0 - metalnessFactor );","material.roughness = max( roughnessFactor, 0.0525 );","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.roughness = clamp( roughnessFactor, 0.04, 1.0 );"),d?p.push(d.code,"material.specularColor = mix( vec3( 0.16 * pow2( "+d.result+" ) ), diffuseColor, metalnessFactor );"):p.push("material.specularColor = mix( vec3( 0.04 ), diffuseColor, metalnessFactor );"),p.push("#include <lights_fragment_begin>"),p.push("#include <lights_fragment_end>"),p.push("vec3 ao = aoEnabled && "+r.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse)) + reflectedLight.directSpecular + reflectedLight.indirectSpecular;");let f="1.0";this.mask&&(this.mask.analyze(e),f=`luminance(${this.mask.flow(e,"v3").result})`),p.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${o.result} * ${f} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${o.result} * ${f}, ${l.result} );
					
					outgoingLight *= ao;
				}
				`),c&&p.push(c.code,`outgoingLight = spe_blend(outgoingLight, ${c.result}, 1.0, SPE_BLENDING_NORMAL);`),u?p.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${u.result} );`):p.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),h&&p.push(`gl_FragColor.a *= ${h.result};`),p.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=p.join(`
`)}return t}},eEe=class extends zn{constructor(){super("toon"),this.nodeType="Toon",this.color=new $r(vo),this.specular=new $r(1118481),this.shininess=new Tt(30),this.previousModelViewMatrix=new Yc,this.previouseProjectionMatrix=new Yc,this.shadingAlpha=new Tt(1),this.shadingBlend=new ur(0)}get category(){return"toon"}build(e){let t;if(e.define("TOON"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:qt.frameIndex}),e.mergeUniform({resolution:qt.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(S0.merge([wt.fog,wt.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = objectNormal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("	#include <project_vertex>","	#include <fog_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>","	#include <shadowmap_vertex>","	#include <fog_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{e.mergeUniform({penumbraSize:qt.penumbraSize}),e.mergeUniform({frameIndex:qt.frameIndex}),e.mergeUniform({aoMap:qt.aoRenderTarget}),e.mergeUniform({aoEnabled:qt.aoEnabled}),this.color===void 0&&(this.color=new $r(vo)),this.color.analyze(e,{slot:"color"}),this.specular.analyze(e),this.shininess.analyze(e),this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let i=this.color.flow(e,"c",{slot:"color"}),r=this.specular.flow(e,"c"),n=this.shininess.flow(e,"f"),s=this.shadingAlpha.flow(e,"f"),a=this.shadingBlend.flow(e,"i"),o=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,l=this.alpha?this.alpha.flow(e,"f"):void 0,c=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0;e.requires.transparent=l!==void 0,e.addParsCode(["uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","varying vec3 vWPosition;","#include <normal_pars_fragment>","#include <gradientmap_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <dithering_pars_fragment>",`
					varying vec3 vViewPosition;
					struct ToonMaterial {
						vec3	diffuseColor;
						vec3	specularColor;
						float	specularShininess;
						float	specularStrength;
					};
					void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
						vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
			
						reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
						reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
					}
					void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
						reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
					}
					#define RE_Direct				RE_Direct_Toon
					#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
					#define Material_LightProbeLOD( material )	(0)
					`,"#include <shadowmap_pars_fragment>","#include <bumpmap_pars_fragment>","#include <normalmap_pars_fragment>"].join(`
`));let u=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	ToonMaterial material;"];if(this.bumpMap){e.include(s0.dHdxy),e.include(s0.perturbNormalArb);let d=this.bumpMap.texture.flow(e,"t"),p=this.bumpMap.flow(e,"v3"),f=this.bumpMapIntensity?this.bumpMapIntensity.flow(e,"f").result:"1.0",v="";this.bumpMap.projection.value===4?v=`
					vec3 bumpNormal = vec3(0.0);
					{
						vec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						vec2 grad0 = dHdxy(${d.result}, uv0, ${f});
						vec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);

						vec2 grad1 = dHdxy(${d.result}, uv1, ${f});
						vec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);

						vec2 grad2 = dHdxy(${d.result}, uv2, ${f});
						vec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);
						
						bumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;
						bumpNormal = normalize(bumpNormal);
					}

					normal = bumpNormal;
					`:v=`
					vec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;
					vec2 grad = dHdxy(${d.result}, bumpMapCachedUv, ${f});
					normal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );
					`,u.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${p.result};
					${v}
					`)}u.push(i.code,"	vec3 diffuseColor = "+i.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",r.code,"	vec3 specular = "+r.result+";",n.code,"	float shininess = max( 0.0001, "+n.result+" );","	float specularStrength = 1.0;"),l&&u.push(l.code,"#ifdef ALPHATEST","if ( "+l.result+" <= ALPHATEST ) discard;","#endif"),u.push("material.diffuseColor = diffuseColor;"),u.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),u.push("vec3 ao = aoEnabled ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) * ao) + reflectedLight.directSpecular;");let h="1.0";this.mask&&(this.mask.analyze(e),h=`luminance(${this.mask.flow(e,"v3").result})`),u.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${s.result} * ${h} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${s.result} * ${h}, ${a.result} );
				}
				`),o&&u.push(o.code,`outgoingLight = spe_blend(outgoingLight, ${o.result}, 1.0, SPE_BLENDING_NORMAL);`),l?u.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${l.result} );`):u.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),c&&u.push(`gl_FragColor.a *= ${c.result};`),u.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=u.join(`
`)}return t}},tEe=class{constructor(e=1e3*10){this.timeout=e,this.cache=new Map,this.head={data:null,time:0,src:null,next:null,prev:null},this.tail={data:null,time:1/0,src:null,next:null,prev:null},this.hasClean=!1,this.head.next=this.tail,this.tail.prev=this.head}log(...e){}remove(e){let t=this.cache.get(e);t&&(this.dispose(e,t.data),this.cache.delete(e),t.prev.next=t.next,t.next.prev=t.prev)}scheduleCleanup(){this.hasClean||(this.log("scheduled cleanup"),this.hasClean=!0,setTimeout(()=>{this.hasClean=!1,this.log("cleaning");let e=Date.now(),t=this.head.next;for(;t.time<e-this.timeout;)this.dispose(t.src,t.data),this.cache.delete(t.src),t=t.next,t.prev=this.head,this.head.next=t;this.head.next!==this.tail?this.scheduleCleanup():this.log("no more cleanup")},this.timeout+1e3))}has(e){var t;return(t=this.cache.get(e))==null?void 0:t.data}load(e){let t=Date.now(),i=this.cache.get(e);return i===void 0?(i={data:this.create(e),src:e,time:t,next:null,prev:null},this.cache.set(e,i)):(i.time=t,i.prev.next=i.next,i.next.prev=i.prev),i.prev=this.tail.prev,i.next=this.tail,this.tail.prev.next=i,this.tail.prev=i,this.scheduleCleanup(),i.data}},iEe=class extends tEe{create(e){return URL.createObjectURL(new Blob([e]))}dispose(e,t){URL.revokeObjectURL(t)}},N3;function rEe(e){return typeof e=="string"?e:(N3||(N3=new iEe),N3.load(e))}var nEe=class{constructor(e,t){this.data=e,this.cache=t,this.refCount=0}deref(){this.refCount,this.refCount-=1,this.refCount===0&&(this.cache.remove(this),this.dispose())}dispose(){this.refCount}},sEe=class{constructor(){this.cache=new Map}remove(e){this.cache.delete(e.data)}load(e){let t=this.cache.get(e);return t===void 0&&(t=this.create(e),this.cache.set(e,t)),t.refCount+=1,t}},UZ=class extends nEe{constructor(e,t){super(e,t.imageHolderCache),this.data=e,this.shared=t,this.loaded=!1,this.isVideo=!1,this.isBuffer=!1,this._cache={1e3:{},1001:{},1002:{}},this.isVideo=e.type==="video",this.isBuffer=e.isWebGLRenderTarget===!0,this.loadPromise=this.updateSrc(this.isBuffer?e:e.data)}async updateSrc(e){if(typeof document>"u")return;this.disposeTextures(),this.loaded=!1;let t=()=>{this.loaded=!0;for(let r of Object.values(this._cache))for(let n of Object.values(r))for(let s of Object.values(n))s&&(s.image=this.img,s.needsUpdate=!0);this.shared.requestRender()};if(this.isBuffer)this.img=e,this.loaded=!0;else if(this.isVideo){if(this.img=document.createElement("video"),this.img.preload="auto",this.img.playsInline=!0,this.img.currentTime=.01,typeof e!="string"){var i=new FileReader;i.readAsDataURL(new Blob([e],{type:"video/mp4"}));let r;await new Promise(n=>{i.onloadend=s=>{var a;r=(a=s.target)==null?void 0:a.result,n(null)}}),this.img.src=r}else this.img.src=e;this.img.onloadeddata=()=>{t()}}else this.img=new Image,this.img.src=rEe(e),this.img.onload=t,await new Promise(r=>{this.img.onload=()=>{t(),r(null)}})}getTexture(e,t=1008,i=1006){var n,s;let r=(s=(n=this._cache[e])==null?void 0:n[t])==null?void 0:s[i];if(r)return r;{let a;return this.isBuffer?a=this.img.texture:this.isVideo?a=new Hde(this.img,void 0,e,e):a=new Br(this.img,void 0,e,e,i,t),this.loaded&&(a.needsUpdate=!0),this._cache[e]===void 0&&(this._cache[e]={}),this._cache[e][t]===void 0&&(this._cache[e][t]={}),this._cache[e][t][i]=a,a}}setNeedsUpdate(e){for(let t of Object.values(this._cache))for(let i of Object.values(t))for(let r of Object.values(i))r&&(r.needsUpdate=e)}disposeTextures(){for(let[e,t]of Object.entries(this._cache))for(let[i,r]of Object.entries(t))for(let[n,s]of Object.entries(r))s==null||s.dispose(),this._cache[e]!==void 0&&this._cache[e][i]!==void 0&&(this._cache[e][i][n]=void 0)}dispose(){super.dispose(),this.disposeTextures()}},gd=class extends UZ{};function aEe(e,t){var i=uEe(t);return i.formatToParts?lEe(i,e):cEe(i,e)}var oEe={year:0,month:1,day:2,hour:3,minute:4,second:5};function lEe(e,t){try{for(var i=e.formatToParts(t),r=[],n=0;n<i.length;n++){var s=oEe[i[n].type];s>=0&&(r[s]=parseInt(i[n].value,10))}return r}catch(a){if(a instanceof RangeError)return[NaN];throw a}}function cEe(e,t){var i=e.format(t).replace(/\u200E/g,""),r=/(\d+)\/(\d+)\/(\d+),? (\d+):(\d+):(\d+)/.exec(i);return[r[3],r[1],r[2],r[4],r[5],r[6]]}var B3={};function uEe(e){if(!B3[e]){var t=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:"America/New_York",year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(new Date("2014-06-25T04:00:00.123Z")),i=t==="06/25/2014, 00:00:00"||t==="06/25/2014 00:00:00";B3[e]=i?new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:e,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):new Intl.DateTimeFormat("en-US",{hourCycle:"h23",timeZone:e,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}return B3[e]}function FZ(e,t,i,r,n,s,a){var o=new Date(0);return o.setUTCFullYear(e,t,i),o.setUTCHours(r,n,s,a),o}var G6=36e5,hEe=6e4,k3={timezone:/([Z+-].*)$/,timezoneZ:/^(Z)$/,timezoneHH:/^([+-]\d{2})$/,timezoneHHMM:/^([+-]\d{2}):?(\d{2})$/};function VZ(e,t,i){var r,n;if(!e||(r=k3.timezoneZ.exec(e),r))return 0;var s;if(r=k3.timezoneHH.exec(e),r)return s=parseInt(r[1],10),j6(s)?-(s*G6):NaN;if(r=k3.timezoneHHMM.exec(e),r){s=parseInt(r[1],10);var a=parseInt(r[2],10);return j6(s,a)?(n=Math.abs(s)*G6+a*hEe,s>0?-n:n):NaN}if(fEe(e)){t=new Date(t||Date.now());var o=i?t:dEe(t),l=ez(o,e),c=i?l:pEe(t,l,e);return-c}return NaN}function dEe(e){return FZ(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds())}function ez(e,t){var i=aEe(e,t),r=FZ(i[0],i[1]-1,i[2],i[3]%24,i[4],i[5],0).getTime(),n=e.getTime(),s=n%1e3;return n-=s>=0?s:1e3+s,r-n}function pEe(e,t,i){var r=e.getTime(),n=r-t,s=ez(new Date(n),i);if(t===s)return t;n-=s-t;var a=ez(new Date(n),i);return s===a?s:Math.max(s,a)}function j6(e,t){return-23<=e&&e<=23&&(t==null||0<=t&&t<=59)}var W6={};function fEe(e){if(W6[e])return!0;try{return new Intl.DateTimeFormat(void 0,{timeZone:e}),W6[e]=!0,!0}catch{return!1}}var mEe=Sh(Pae(),1),X6=Sh(Dae(),1),gEe=/(Z|[+-]\d{2}(?::?\d{2})?| UTC| [a-zA-Z]+\/[a-zA-Z_]+(?:\/[a-zA-Z_]+)?)$/,vEe=gEe,U3=36e5,q6=6e4,yEe=2,pa={dateTimePattern:/^([0-9W+-]+)(T| )(.*)/,datePattern:/^([0-9W+-]+)(.*)/,plainTime:/:/,YY:/^(\d{2})$/,YYY:[/^([+-]\d{2})$/,/^([+-]\d{3})$/,/^([+-]\d{4})$/],YYYY:/^(\d{4})/,YYYYY:[/^([+-]\d{4})/,/^([+-]\d{5})/,/^([+-]\d{6})/],MM:/^-(\d{2})$/,DDD:/^-?(\d{3})$/,MMDD:/^-?(\d{2})-?(\d{2})$/,Www:/^-?W(\d{2})$/,WwwD:/^-?W(\d{2})-?(\d{1})$/,HH:/^(\d{2}([.,]\d*)?)$/,HHMM:/^(\d{2}):?(\d{2}([.,]\d*)?)$/,HHMMSS:/^(\d{2}):?(\d{2}):?(\d{2}([.,]\d*)?)$/,timeZone:vEe};function xEe(e,t){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");if(e===null)return new Date(NaN);var i={},r=i.additionalDigits==null?yEe:(0,mEe.default)(i.additionalDigits);if(r!==2&&r!==1&&r!==0)throw new RangeError("additionalDigits must be 0, 1 or 2");if(e instanceof Date||typeof e=="object"&&Object.prototype.toString.call(e)==="[object Date]")return new Date(e.getTime());if(typeof e=="number"||Object.prototype.toString.call(e)==="[object Number]")return new Date(e);if(!(typeof e=="string"||Object.prototype.toString.call(e)==="[object String]"))return new Date(NaN);var n=wEe(e),s=bEe(n.date,r),a=s.year,o=s.restDateString,l=_Ee(o,a);if(isNaN(l))return new Date(NaN);if(l){var c=l.getTime(),u=0,h;if(n.time&&(u=SEe(n.time),isNaN(u)))return new Date(NaN);if(n.timeZone||i.timeZone){if(h=VZ(n.timeZone||i.timeZone,new Date(c+u)),isNaN(h))return new Date(NaN)}else h=(0,X6.default)(new Date(c+u)),h=(0,X6.default)(new Date(c+u+h));return new Date(c+u+h)}else return new Date(NaN)}function wEe(e){var t={},i=pa.dateTimePattern.exec(e),r;if(i?(t.date=i[1],r=i[3]):(i=pa.datePattern.exec(e),i?(t.date=i[1],r=i[2]):(t.date=null,r=e)),r){var n=pa.timeZone.exec(r);n?(t.time=r.replace(n[1],""),t.timeZone=n[1].trim()):t.time=r}return t}function bEe(e,t){var i=pa.YYY[t],r=pa.YYYYY[t],n;if(n=pa.YYYY.exec(e)||r.exec(e),n){var s=n[1];return{year:parseInt(s,10),restDateString:e.slice(s.length)}}if(n=pa.YY.exec(e)||i.exec(e),n){var a=n[1];return{year:parseInt(a,10)*100,restDateString:e.slice(a.length)}}return{year:null}}function _Ee(e,t){if(t===null)return null;var i,r,n,s;if(e.length===0)return r=new Date(0),r.setUTCFullYear(t),r;if(i=pa.MM.exec(e),i)return r=new Date(0),n=parseInt(i[1],10)-1,Q6(t,n)?(r.setUTCFullYear(t,n),r):new Date(NaN);if(i=pa.DDD.exec(e),i){r=new Date(0);var a=parseInt(i[1],10);return AEe(t,a)?(r.setUTCFullYear(t,0,a),r):new Date(NaN)}if(i=pa.MMDD.exec(e),i){r=new Date(0),n=parseInt(i[1],10)-1;var o=parseInt(i[2],10);return Q6(t,n,o)?(r.setUTCFullYear(t,n,o),r):new Date(NaN)}if(i=pa.Www.exec(e),i)return s=parseInt(i[1],10)-1,K6(t,s)?Y6(t,s):new Date(NaN);if(i=pa.WwwD.exec(e),i){s=parseInt(i[1],10)-1;var l=parseInt(i[2],10)-1;return K6(t,s,l)?Y6(t,s,l):new Date(NaN)}return null}function SEe(e){var t,i,r;if(t=pa.HH.exec(e),t)return i=parseFloat(t[1].replace(",",".")),F3(i)?i%24*U3:NaN;if(t=pa.HHMM.exec(e),t)return i=parseInt(t[1],10),r=parseFloat(t[2].replace(",",".")),F3(i,r)?i%24*U3+r*q6:NaN;if(t=pa.HHMMSS.exec(e),t){i=parseInt(t[1],10),r=parseInt(t[2],10);var n=parseFloat(t[3].replace(",","."));return F3(i,r,n)?i%24*U3+r*q6+n*1e3:NaN}return null}function Y6(e,t,i){t=t||0,i=i||0;var r=new Date(0);r.setUTCFullYear(e,0,4);var n=r.getUTCDay()||7,s=t*7+i+1-n;return r.setUTCDate(r.getUTCDate()+s),r}var MEe=[31,28,31,30,31,30,31,31,30,31,30,31],EEe=[31,29,31,30,31,30,31,31,30,31,30,31];function HZ(e){return e%400===0||e%4===0&&e%100!==0}function Q6(e,t,i){if(t<0||t>11)return!1;if(i!=null){if(i<1)return!1;var r=HZ(e);if(r&&i>EEe[t]||!r&&i>MEe[t])return!1}return!0}function AEe(e,t){if(t<1)return!1;var i=HZ(e);return!(i&&t>366||!i&&t>365)}function K6(e,t,i){return!(t<0||t>52||i!=null&&(i<0||i>6))}function F3(e,t,i){return!(e!=null&&(e<0||e>=25)||t!=null&&(t<0||t>=60)||i!=null&&(i<0||i>=60))}function CEe(e,t,i){var r=xEe(e,i),n=VZ(t,r,!0),s=new Date(r.getTime()-n),a=new Date(0);return a.setFullYear(s.getUTCFullYear(),s.getUTCMonth(),s.getUTCDate()),a.setHours(s.getUTCHours(),s.getUTCMinutes(),s.getUTCSeconds(),s.getUTCMilliseconds()),a}function ma(e,t){return t.color(e)}function Z6(e=new Date,t){let i=t.format,r=e.getSeconds(),n=e;t&&t.timeZone!==null&&(n=CEe(new Date,t.timeZone));let s=n.getHours(),a=n.getMinutes(),o;t.format12h24h==="12ampm"&&(o=s>=12?"PM":"AM");let l=s;t.format12h24h!=="24"&&(l=s%12,l===0&&(l=12));let c,u;switch(i){case"HH:mm:ss":c=[l,a,r];break;case"HH:mm":c=[l,a];break;case"HH":c=[l],o=void 0;break;case"mm":c=[a],o=void 0;break;case"ss":c=[r],o=void 0;break;case"year":u=n.getFullYear();break;case"month":u=n.getMonth()+1;break;case"dayOfYear":u=Math.floor((n.getTime()-new Date(n.getFullYear(),0,0).getTime())/864e5);break;case"dayOfMonth":u=n.getDate();break;case"secondOfDay":u=s*60*60+a*60+r;break;default:console.error("Unknown time format",i),u=0;break}return c!==void 0?{textValue:c,suffix:o}:u}function TEe(e,t){switch(e.type){case"fresnel":return REe(e,t);case"gradient":return IEe(e,t);case"depth":return LEe(e,t);case"normal":return OEe(e,t);case"noise":return zEe(e,t);case"rainbow":return NEe(e,t);case"toon":return BEe(e,t);case"outline":return kEe(e,t);case"transmission":return UEe(e,t);case"color":return DEe(e,t);case"pattern":return FEe(e,t)}}function PEe(e){return{type:e.type}}function Yl(e,t){let{alpha:i,mode:r,isMask:n}=e,s=typeof i=="string"?(Number(t.getVariable(i))??100)/100:i;return{...PEe(e),alpha:s,mode:r,isMask:n}}function DEe(e,t){return{...Yl(e,t),color:ma(e.color,t)}}function REe(e,t){let{bias:i,scale:r,intensity:n,factor:s,color:a}=e;return{...Yl(e,t),color:ma(a,t),bias:i,scale:r,intensity:n,factor:s}}function IEe(e,t){let{gradientType:i,smooth:r,colors:n,steps:s,angle:a,offset:o,morph:l}=e;return{...Yl(e,t),gradientType:i,smooth:r,colors:n.map(c=>new ti(c[0],c[1],c[2],c[3])),num:n.length,steps:s,offset:new ve(...o),morph:new ve(...l),angle:a}}function LEe(e,t){let{gradientType:i,near:r,far:n,isVector:s,isWorldSpace:a,origin:o,direction:l,colors:c,steps:u,smooth:h}=e;return{...Yl(e,t),gradientType:i,near:r,far:n,isVector:s,isWorldSpace:a,origin:new B(...o),direction:l?new B(...l):new B(1,0,0),colors:c.map(d=>d!==void 0?new ti(d[0],d[1],d[2],d[3]):new ti(0,0,0,0)),steps:u.slice(0,c.length),smooth:h}}function OEe(e,t){let{cnormal:i}=e;return{...Yl(e,t),cnormal:new B(i[0],i[1],i[2])}}function zEe(e,t){return{...Yl(e,t),scale:e.scale,move:e.move,fA:new ve(...e.fA),fB:new ve(...e.fB),size:new B(...e.size),distortion:new ve(...e.distortion),colorA:ma(e.colorA,t),colorB:ma(e.colorB,t),colorC:ma(e.colorC,t),colorD:ma(e.colorD,t),noiseType:e.noiseType,voronoiStyle:e.voronoiStyle,highCut:e.highCut,lowCut:e.lowCut,smoothness:e.smoothness,seed:e.seed,quality:e.quality}}function NEe(e,t){return{...Yl(e,t),filmThickness:e.filmThickness,movement:e.movement,wavelengths:new B(...e.wavelengths),noiseStrength:e.noiseStrength,noiseScale:e.noiseScale,offset:new B(...e.offset)}}function BEe(e,t){return{...Yl(e,t),positioning:e.positioning,colors:e.colors.map(i=>new ti(i[0],i[1],i[2],i[3])),num:e.colors.length,steps:e.steps,source:new B(...e.source),isWorldSpace:e.isWorldSpace,noiseStrength:e.noiseStrength,noiseScale:e.noiseScale,shadowColor:ma(e.shadowColor,t),offset:new B(...e.offset)}}function kEe(e,t){return{...Yl(e,t),outlineColor:ma(e.outlineColor,t),contourColor:ma(e.contourColor,t),outlineWidth:e.outlineWidth,contourWidth:e.contourWidth,outlineThreshold:e.outlineThreshold,contourThreshold:e.contourThreshold,outlineSmoothing:e.outlineSmoothing,contourFrequency:e.contourFrequency,contourDirection:new B(...e.contourDirection),positionalLines:e.positionalLines,compensation:e.compensation}}function UEe(e,t){return{...Yl(e,t),thickness:e.thickness,ior:e.ior,roughness:e.roughness}}function FEe(e,t){return{...Yl(e,t),style:e.style,projection:e.projection,axis:e.axis,blending:e.blending,offset:new ve(...e.offset),colorA:ma(e.colorA,t),colorB:ma(e.colorB,t),frequency:new ve(...e.frequency),size:e.size,variation:e.variation,smoothness:e.smoothness,zigzag:e.zigzag,rotation:e.rotation,vertical:new ve(...e.vertical),horizontal:new ve(...e.horizontal),sides:e.sides}}var aC=class extends Es{},VEe={noise:["noiseType"],texture:["projection","axis","side"],video:["projection","axis","side"],displace:["noiseType"],light:["roughnessMap","bumpMap"],depth:["smooth","isWorldSpace","gradientType","isVector"],pattern:["style","projection","axis"]},HEe={depth:["colors"]};function GEe(e,t,i){var s,a;if(t==="isMask")return!0;let r=VEe[e.type],n=HEe[e.type];if(n!==void 0){let o=e.color;if(n.includes(t)){let l=(a=(s=o[t])==null?void 0:s.value)==null?void 0:a.length;if(l!==void 0&&l!==i.length)return!0}}return r!==void 0?r.includes(t):!1}function GZ(e,t,i){let r=i.uniforms[`f${i.id}_texture`];if(!r)return!1;let n=!1,s=e;if("image"in s){let a=s.image,o=t.image(a),l=r;l.image instanceof gd||l.image.deref(),l.image=o}if("video"in s){let a=s.video,o=t.video(a),l=r;l.image instanceof gd||l.image.deref(),l.image=o}if("wrapping"in s){let a=r;a.wrap=s.wrapping}if("minFilter"in s){let a=r;a.minFilter=s.minFilter}if("magFilter"in s){let a=r;a.magFilter=s.magFilter}if("rotation"in s&&i.uniforms[`f${i.id}_rotation`])return i.uniforms[`f${i.id}_rotation`].value=(s.rotation??0)*Et.DEG2RAD,n;if("repeat"in s||"offset"in s||"rotation"in s){let a="mat",o=i.uniforms[`f${i.id}_${a}`];"repeat"in s&&(o.repeat=s.repeat),"offset"in s&&(o.offset=s.offset),"rotation"in s&&(o.rotation=s.rotation??0),o.updateMatrix()}return n}function jEe(e,t,i,r){let n=!1;for(let[s,a]of Object.entries(e)){if(s==="bumpMap"||s==="roughnessMap"){n=!0;continue}if(!s||a===void 0)continue;if(WZ(s,i,r,t)){s==="visible"&&i.type==="light"&&(n=!0);continue}i.visible=r.visible;let o=i.uniforms[`f${i.id}_${s}`];if(o&&!(o instanceof hk))switch(n=n||GEe(i,s,a),o.constructor){case $r:if(typeof a=="string"){let l=t.getColor(a);l&&(o.value=l);break}else{let l=a;o.value instanceof aC?o.value=new Es(l.r,l.g,l.b,l.a):o.setRGBA(l);break}case Ru:if(typeof a=="string"){let l=t.getColor(a);l&&(o.value=l);break}else{let l=a;o.value instanceof aC?o.value=new Es(l.r,l.g,l.b,l.a):o.value.setRGBA(l.r,l.g,l.b,l.a);break}case gs:{let l=a;o.value.setX(l[0]),o.value.setY(l[1]);break}case Bo:{let l=a;o.value.setX(l[0]),o.value.setY(l[1]),o.value.setZ(l[2]);break}case Fu:{GZ(a,t,i);break}case jp:{o.value=a.map(l=>new ti(...l));break}default:{o.value=a;break}}}return n}var Xf=(e,t,i)=>Math.max(0,Math.min(1,Number(t.getVariable(typeof e=="number"?e*100:e,i)??100)/100))??1,Gw=class{constructor(e,t,i,r,n){this.id=e,this.uuid=t,this.data=i,this.uniforms={};for(let s in r)this.uniforms[`f${this.id}_${s}`]=r[s];for(let s in i)WZ(s,this,i,n)}get type(){return this.data.type}static create(e,t,i,r){if(i.type==="light")return wc.createLigherLayer(e,t,i,r);if(i.type==="texture"||i.type==="video"){let n=i.type==="texture"?r.uiBuffer(i.texture.image)??r.image(i.texture.image):r.video(i.texture.video),s=new ZO(n,i.texture.wrapping,i.texture.minFilter??1008,i.texture.magFilter??1006),a=new XMe(n),o=new qMe(i.texture.repeat,i.texture.offset,i.texture.rotation??0),l=new Tt(i.crop?1:0),c=new ur(i.projection??0),u=new ur(["x","y","z"].indexOf(i.axis)??0),h=new ur(i.side??0),d=new gs(i.size?new ve(i.size[0],i.size[1]):new ve(100,100)),p=new Tt(i.blending??0),f=new Tt(Xf(i.alpha,r)),v=new ur(i.mode??0),g=new da(i.isMask??!1),m=new dk(s,a,l,c,u,h,d,p,o,f,v,g),x=new xr(m.calpha,"f");return new Xr(e,t,i,{texture:s,textureSize:a,crop:l,projection:c,axis:u,side:h,size:d,blending:p,mat:o,alpha:f,mode:v,isMask:g},m,v,x,g,r)}else if(i.type==="matcap"){let n=r.image(i.texture.image),s=new ZO(n,i.texture.wrapping,i.texture.minFilter??1008,i.texture.magFilter??1006),a=new Tt(Xf(i.alpha,r)),o=new ur(i.mode??0),l=new da(i.isMask??!1),c=new Tt((i.texture.rotation??0)*Et.DEG2RAD),u=new EZ(s,a,o,l,c),h=new xr(u.calpha,"f");return new Xr(e,t,i,{texture:s,alpha:a,mode:o,isMask:l,rotation:c},u,o,h,l,r)}else if(i.type==="displace")if(i.displacementType==="noise"){let n=new Bo(new B(...i.offset)),s=new Tt(i.scale??10),a=new Tt(i.intensity??8),o=new Tt(i.movement??1),l=new ur(i.noiseType??0),c=new ur(i.voronoiStyle??0),u=new Tt(i.smoothness??.5),h=new Tt(i.seed??0),d=new Tt(i.highCut??1),p=new Tt(i.lowCut??0),f=new ur(i.quality??1),v=new BZ(a,o,n,c,u,h,d,p,f,s,l);return new jZ(e,t,i,{offset:n,scale:s,intensity:a,movement:o,noiseType:l,voronoiStyle:c,smoothness:u,seed:h,highCut:d,lowCut:p,quality:f},v,r)}else throw new Error;else return qEe(e,t,i,r)}updateByOp(e,t,i){let r=e;if(r.path[0]===void 0){if(r.type===0)return"type"in r.props||"category"in r.props||"visible"in r.props?(i.scene.markNeedsUpdateRendererDirty(),!0):jEe(r.props,i.shared,this,t)}else if(r.path[0]==="texture")return"texture"in t||"video"in t?GZ(r.props,i.shared,this):!0;return!1}dispose(){if(WEe(this)){let e=this.uniforms[`f${this.id}_texture`];if(!e)return!1;let t=e;t.image instanceof gd||t.image.deref()}}hasValueByKey(e){return this.uniforms[e]!==void 0}hasValue(e){return this.hasValueByKey(`f${this.id}_${e}`)}setValue(e,t){let i=`f${this.id}_${e}`;this.hasValueByKey(i)&&t!==void 0&&(this.uniforms[i].value=t)}getNode(e){let t=`f${this.id}_${e}`;if(this.hasValueByKey(t))return this.uniforms[t]}getValue(e){let t=`f${this.id}_${e}`;if(this.hasValueByKey(t))return this.uniforms[t].value}getName(e){let t=/f\d+_(.*)/.exec(e);if(t&&t.length>1)return t[1];console.log(`Layer.getName: error ${e}`)}getNames(){let e=[];for(let t in this.uniforms){let i=this.getName(t);i&&e.push(i)}return e}},Xr=class extends Gw{constructor(e,t,i,r,n,s,a,o,l){super(e,t,i,r,l),this.params=r,this.color=n,this.mode=s,this.alpha=a,this.isMask=o}},jZ=class extends Gw{constructor(e,t,i,r,n,s){super(e,t,i,r,s),this.position=n}},wc=class extends Gw{constructor(e,t,i,r,n,s){super(e,t,i,n,s),this.node=r}static createLigherLayer(e,t,i,r){let n,s=new Tt(Xf(i.alpha,r)),a=new ur(i.mode),o=new Tt(i.bumpMapIntensity),l=new Tt(Xf(i.alphaOverride,r)),c;if(!i.visible)n=new fk,c={};else if(i.category==="lambert"){n=new ZMe;let u=new $r(r.color(i.emissive)??0),h=new da(i.occlusion??!0);c={emissive:u,occlusion:h},n.emissive=u,n.occlusion=h}else if(i.category==="toon"){n=new eEe;let u=new Tt(i.shininess??30),h=new $r(r.color(i.specular)??1118481);c={shininess:u,specular:h},n.shininess=u,n.specular=h}else if(i.category==="physical"){n=new JMe;let u=new Tt(i.roughness??.3),h=new Tt(i.metalness??0),d=new Tt(i.reflectivity??.5),p=new da(i.occlusion??!0);c={roughness:u,metalness:h,reflectivity:d,occlusion:p},n.roughness=u,n.metalness=h,n.reflectivity=d,n.occlusion=p}else{n=new $Me;let u=new Tt(i.shininess??30),h=new $r(i.specular!==void 0?r.color(i.specular)??1118481:1118481),d=new da(i.occlusion??!0);c={shininess:u,specular:h,occlusion:d},n.shininess=u,n.specular=h,n.occlusion=d}return n.alpha=new Tt(1),n.shadingAlpha=s,n.shadingBlend=a,n.bumpMapIntensity=o,n.alphaOverride=l,c.alpha=n.shadingAlpha,c.mode=n.shadingBlend,c.bumpMapIntensity=n.bumpMapIntensity,c.alphaOverride=n.alphaOverride,new wc(e,t,i,n,c,r)}get category(){return this.node.category}};function WEe(e){let t=e instanceof Gw?e.type:e;return t==="texture"||t==="video"||t==="displace_map"||t==="matcap"}function Io(e){return{alpha:new Tt(e.alpha??1),mode:new ur(e.mode??0),isMask:new da(e.isMask??!1)}}function XEe(e,t,i,r,n){switch(e.type){case"color":{let s=new $r(r.color??vo),a=Io(r),o=new $O(s,a.alpha),l=new xr(o.calpha,"f");return new Xr(t,i,e,{color:s,...a},o,a.mode,l,a.isMask,n)}case"fresnel":{let s=new $r(r.color??16777215),a=new Tt(r.bias??.1),o=new Tt(r.scale??1),l=new Tt(r.intensity??2),c=new Tt(r.factor??1),u=Io(r),h=new YMe(s,a,o,l,c,u.alpha,u.mode,u.isMask),d=new xr(h.calpha,"f");return new Xr(t,i,e,{color:s,bias:a,scale:o,intensity:l,factor:c,...u},h,u.mode,d,u.isMask,n)}case"rainbow":{let s=new Tt(r.filmThickness??30),a=new Tt(r.movement??0),o=new Bo(r.wavelengths??new B(0,0,0)),l=new Tt(r.noiseStrength??0),c=new Tt(r.noiseScale??1),u=new Bo(r.offset??new B(0,0,0)),h=Io(r),d=new RZ(s,a,o,l,c,u,h.alpha,h.isMask),p=new xr(d.calpha,"f");return new Xr(t,i,e,{filmThickness:s,movement:a,wavelengths:o,noiseStrength:l,noiseScale:c,offset:u,...h},d,h.mode,p,h.isMask,n)}case"transmission":{let s=new Tt(r.thickness??10),a=new Tt(r.ior??1.5),o=new Tt(r.roughness??.5),l=qt.transmissionSize,c=qt.transmissionRenderTarget,u=qt.transmissionRenderTargetDepth,h=window.innerWidth,d=window.innerHeight,p=h>=d?new gs(d/h,1):new gs(1,h/d),f=Io(r),v=new zZ(s,a,o,l,c,u,p,f.alpha),g=new xr(v.calpha,"f");return new Xr(t,i,e,{thickness:s,ior:a,roughness:o,aspectRatio:p,...f},v,f.mode,g,f.isMask,n)}case"toon":{let s=new ur(r.positioning??0),a;r.colors?a=new jp(r.colors.length,r.colors):(a=new jp(10,new ti(0,0,0,1)),a.value[1]=new ti(1,1,1,1));let o;r.steps?o=new Gp(r.steps.length,r.steps):(o=new Gp(10,1),o.value[0]=0);let l=new Bo(r.source??new B(0,0,0)),c=new da(r.isWorldSpace??!0),u=new Tt(r.noiseStrength??0),h=new Tt(r.noiseScale??1),d=new Ru(r.shadowColor),p=new Bo(r.offset??new B(0,0,0)),f=Io(r),v=new LZ(s,a,o,l,c,u,h,d,p,f.alpha),g=new xr(v.calpha,"f");return new Xr(t,i,e,{positioning:s,colors:a,steps:o,source:l,isWorldSpace:c,noiseStrength:u,noiseScale:h,shadowColor:d,offset:p,...f},v,f.mode,g,f.isMask,n)}case"outline":{let s=new $r(r.outlineColor??16777215),a=new $r(r.contourColor??16777215),o=new Tt(r.outlineWidth??.1),l=new Tt(r.contourWidth??.1),c=new Tt(r.outlineThreshold??.1),u=new Tt(r.contourThreshold??.1),h=new Tt(r.outlineSmoothing??.1),d=new Tt(r.contourFrequency??.1),p=new Bo(r.contourDirection??new B(0,1,0)),f=new da(r.positionalLines??!1),v=new da(r.compensation??!0),g=qt.normalRenderTarget,m=qt.normalRenderTargetDepth,x=qt.pixelRatioNode,w=qt.resolution,_=Io(r),M=new TZ(s,a,o,l,c,u,h,d,p,f,v,w,g,m,x,_.alpha),S=new xr(M.calpha,"f");return new Xr(t,i,e,{outlineColor:s,contourColor:a,outlineWidth:o,contourWidth:l,outlineThreshold:c,contourThreshold:u,outlineSmoothing:h,contourFrequency:d,contourDirection:p,positionalLines:f,compensation:v,..._},M,_.mode,S,_.isMask,n)}case"depth":{let s=new ur(r.gradientType??0),a=new da(r.smooth??!1),o=new Tt(r.near??50),l=new Tt(r.far??200),c=new Tt(r.isVector??1),u=new Tt(r.isWorldSpace??0),h=new Bo(r.origin??new B),d=new Bo(r.direction??new B),p;r.colors?p=new jp(r.colors.length,r.colors):(p=new jp(2,new ti(0,0,0,1)),p.value[1]=new ti(1,1,1,1));let f;r.steps?f=new Gp(r.steps.length,r.steps):(f=new Gp(2,1),f.value[0]=0);let v=Io(r),g=new bZ(s,a,o,l,c,u,h,d,p,f,v.alpha,v.isMask),m=new xr(g.calpha,"f");return new Xr(t,i,e,{gradientType:s,smooth:a,near:o,far:l,isVector:c,isWorldSpace:u,origin:h,direction:d,colors:p,steps:f,...v},g,v.mode,m,v.isMask,n)}case"noise":{let s=new Tt(r.scale??1),a=new Bo(r.size??new B(100,100,100)),o=new Tt(r.move??1),l=new gs(r.fA??new ve(1.7,9.2)),c=new gs(r.fB??new ve(8.3,2.8)),u=new gs(r.distortion??new ve(1,1)),h=new Ru(r.colorA),d=new Ru(r.colorB),p=new Ru(r.colorC),f=new Ru(r.colorD),v=new ur(r.noiseType??0),g=new ur(r.voronoiStyle??0),m=new Tt(r.highCut??1),x=new Tt(r.lowCut??0),w=new Tt(r.smoothness??.5),_=new Tt(r.seed??.5),M=new ur(r.quality??1),S=Io(r),A=new AZ(s,a,o,l,c,u,h,d,p,f,S.alpha,v,S.isMask,g,m,x,w,_,M),T=new xr(A.calpha,"f");return new Xr(t,i,e,{scale:s,size:a,move:o,fA:l,fB:c,distortion:u,colorA:h,colorB:d,colorC:p,colorD:f,noiseType:v,...S,voronoiStyle:g,highCut:m,lowCut:x,smoothness:w,seed:_,quality:M},A,S.mode,T,S.isMask,n)}case"normal":{let s=new Bo(r.cnormal??new B(1,1,1)),a=Io(r),o=new wZ(s,a.alpha),l=new xr(o.calpha,"f");return new Xr(t,i,e,{cnormal:s,...a},o,a.mode,l,a.isMask,n)}case"gradient":{let s=new ur(r.gradientType??0),a=new da(r.smooth??!1),o;r.colors?o=new jp(r.colors.length,r.colors):(o=new jp(10,new ti(0,0,0,1)),o.value[1]=new ti(1,1,1,1));let l;r.steps?l=new Gp(r.steps.length,r.steps):(l=new Gp(10,1),l.value[0]=0);let c=new gs(r.offset??new ve(0,0)),u=new gs(r.morph??new ve(0,0)),h=new Tt(r.angle??0),d=Io(r),p=new SZ(s,a,o,l,c,u,h,d.alpha,d.isMask),f=new xr(p.calpha,"f");return new Xr(t,i,e,{gradientType:s,smooth:a,colors:o,steps:l,offset:c,morph:u,angle:h,...d},p,d.mode,f,d.isMask,n)}case"pattern":{let s=new ur(r.style??0),a=new ur(r.projection??0),o=new ur(["x","y","z"].indexOf(r.axis)??0),l=new Tt(r.blending??0),c=new gs(r.offset??new ve(0,0)),u=new Ru(r.colorA),h=new Ru(r.colorB),d=new gs(r.frequency??new ve(10,10)),p=new Tt(r.size??.5),f=new Tt(r.variation??0),v=new Tt(r.smoothness??.5),g=new Tt(r.zigzag??0),m=new Tt(r.rotation??0),x=new gs(r.vertical??new ve(0,1)),w=new gs(r.horizontal??new ve(0,1)),_=new ur(r.sides??6),M=Io(r),S=new PZ(s,a,o,l,c,u,h,d,p,f,v,g,m,x,w,_,M.alpha,M.isMask),A=new xr(S.calpha,"f");return new Xr(t,i,e,{style:s,projection:a,axis:o,blending:l,offset:c,colorA:u,colorB:h,frequency:d,size:p,variation:f,smoothness:v,zigzag:g,rotation:m,vertical:x,horizontal:w,sides:_,...M},S,M.mode,A,M.isMask,n)}default:{let s=new $r(1,0,0,1),a=Io(r),o=new $O(s,a.alpha),l=new xr(o.calpha,"f");return new Xr(t,i,e,{color:s,...a},o,a.mode,l,a.isMask,n)}}}function qEe(e,t,i,r){let n=TEe(i,r);return XEe(i,e,t,n,r)}function WZ(e,t,i,r){if(i.type==="displace"&&(e==="intensity"||e==="visible")){let n=t.uniforms[`f${t.id}_intensity`];return n?(n.value=i.intensity*(i.visible?1:0),n):void 0}if(i.type!=="displace"&&(e==="alpha"||e==="visible")){let n=t.uniforms[`f${t.id}_alpha`];if(!n)return;if(n.value=Xf(i.alpha,r)*(i.visible?1:0),i.type==="outline"&&e==="visible"){let s=t.uniforms[`f${t.id}_compensation`];s&&(s.value=i.compensation&&i.visible)}return n}}function av(e,t){let i=0,r=e.layers.find(n=>n.data.type==="light");if(r){let n=r.data,s=Number(t.getVariable(n.alphaOverride));if((typeof n.alphaOverride=="string"?s/100:n.alphaOverride)<1)return!0}for(let n of e.layers){if(n.data.type!=="displace"&&n.data.isMask)return!0;if(n.data.type!=="displace"&&"alpha"in n.data&&n.data.type!=="light"&&n.data.type!=="fresnel"&&n.data.type!=="texture"&&n.data.type!=="matcap"&&n.data.type!=="rainbow"&&n.data.type!=="outline"&&n.data.type!=="pattern"){let s=n.data.visible?n.data.alpha:0;if(typeof s=="string"&&(s=Math.max(0,Math.min(1,Number(t.getVariable(s)??100)/100))),s===1&&n.data.type==="depth"||n.data.type==="gradient"){for(let a of n.data.colors)if(a[3]<1){s=a[3];break}}else if(s===1&&n.data.type==="noise"){let a=t.color(n.data.colorA).a,o=t.color(n.data.colorB).a,l=t.color(n.data.colorC).a,c=t.color(n.data.colorD).a,u=Math.min(a,Math.min(o,Math.min(l,c)));u<1&&(s=u)}i+=(1-i)*s}}return i<1}var Yd=class extends Ui{constructor(){super(void 0),this.flatShading=!1,this.needsJitter=!0,this.nodeContextUuid=0,this.fog=!0,this.dithering=!0,this.vertexColors=!0,this.transparent=!0}customProgramCacheKey(){return""}},YEe=class extends Yd{constructor(e,t,i,r){super(),this.flatShading=e,this.side=t,this.wireframe=i,this.root=r}updateAfterBuild(){let e=this.root;this.lights=e.lights,this.vertexShader=e.vertexShader,this.fragmentShader=e.fragmentShader,this.defines=e.defines,this.uniforms=e.uniforms,this.extensions=e.extensions,this.transparent=e.transparent,this.cacheKey=e.customProgramCacheKey()+"flat"+this.flatShading+this.side}onBeforeCompile(e,t){this.root.onBeforeCompile(e)}get data(){return this.root.data}get category(){return this.root.category}get hasAO(){return this.root.hasAO}getFlavor(e,t,i){return this.root.getFlavor(e,t,i)}get layers(){return this.root.layers}get fragment(){return this.root.fragment}getLayersOfType(e){return this.root.getLayersOfType(e)}getLayerByUuid(e){return this.root.getLayerByUuid(e)}updateByOp(e,t,i){this.root.updateByOp(e,t,i)}nodeMaterialDispose(){this.root.nodeMaterialDispose()}},mk=class extends Yd{constructor(e,t,i=!0){super(),this.data=e,this.allowVariableSaves=i,this.layerIdGen=0,this.flavors=[],this.masks={},this.type="NodeMaterial",this.updaters=[],this.needsJitter=t.shared.needsJitter,zn.startContext(this),this.reset0(e,t),zn.endContext(this)}get nodeMaterial(){return this}getFlavor(e,t,i){let r=i?6:(e?3:0)+t;if(r===0)return this;this.flavors===void 0&&(this.flavors=[]),r-=1;let n=this.flavors[r];return n===void 0&&(n=new YEe(e,t,i,this),n.needsJitter=this.needsJitter,this.flavors[r]=n,n.flatShading=e,n.side=t,n.updateAfterBuild()),n}get fragment(){return this.lightLayer.node}get category(){return this.lightLayer.category}get hasAO(){var e;return((e=this.lightLayer.getNode("occlusion"))==null?void 0:e.value)??!1}reset(e,t,i=!1){zn.startContext(this),(this.data!==e||i)&&this.reset0(e,t),zn.endContext(this)}reset0(e,t){this.data=e;let i=e.layers??_s.defaultTwoLayerData("phong").layers;try{this.layers=i.map(r=>Gw.create(this.layerIdGen++,r.id,r.data,t.shared))}catch{this.layers=[]}this.layers.reverse(),this.name=e.name??"Untitled Material",this.onUpdate(t.shared),this.transparent=av(e,t.shared),this.saveVariableLocations(t)}onVariableUpdate(e,t,i){if(e[0]==="alphaOverride")this.transparent=av(this.data,i.shared),this.lightLayer.setValue("alphaOverride",Math.max(0,Math.min(Number(t)/100,1)));else if(e[0]==="layer"){let r=e[1],n=e[2];if(r&&n){let s=this.layers.find(a=>a.uuid===r);s!=null&&s.hasValue(n)&&(n==="alpha"?(this.transparent=av(this.data,i.shared),s.setValue(n,Math.max(0,Math.min(Number(t)/100,1)))):s.setValue(n,t))}}}saveVariableLocations(e){if(!this.allowVariableSaves)return;let t=this.data.layers.find(i=>i.data.type==="light");t&&e.shared.getVariable(t.data.alphaOverride,["material",this.uuid,"alphaOverride"]),this.data.layers.forEach(i=>{"alpha"in i.data&&typeof i.data.alpha=="string"&&e.shared.getVariable(i.data.alpha,["material",this.uuid,"layer",i.id,"alpha"])})}getLayersOfType(e){return this.layers.filter(t=>t.type===e)}getLayerByUuid(e){return this.layers.find(t=>t.uuid===e)}onUpdate(e){this.lightLayer=this.layers.find(t=>t instanceof wc),this.lightLayer===void 0&&(this.lightLayer=new wc(0,"",{...Zn.defaultData("light","phong"),visible:!1},new fk,{},e)),this.dispose();for(let t of this.flavors)t&&t.dispose();this.applyTextureMaps(),this.applyMasks(),this.blendColors(),this.blendAfterColors(),this.blendPositions(),this.build(),this.nodeContextUuid=0}applyTextureMaps(){let e=this.layers.find(n=>n instanceof wc);if(!e)return;let t=e.data,i=t.bumpMap,r=t.roughnessMap;e.node.bumpMap=void 0,e.node.roughnessMap=void 0;for(let n=0;n<this.layers.length;++n){let s=this.layers[n];s instanceof Xr&&s.color instanceof dk&&(s.uuid===i&&(e.node.bumpMap=s.color),s.uuid===r&&(e.node.roughnessMap=s.color))}}updateByOp(e,t,i){if(zn.startContext(this),t!==void 0?this.data=t:t=this.data,this.transparent=av(t,i.shared),e.path[0]==="layers"){let r=i.shared,n=e.path[1];if(n===void 0)i.scene.markNeedsUpdateRendererDirty(),this.reset0(t,i);else{e.type===0&&e.props.occlusion!==void 0&&i.scene.markNeedsUpdateRendererDirty();let s=this.layers.find(a=>a.uuid===n);if(s){let a=t.layers.data(n),o;e.type===0&&("alpha"in e.props||"alphaOverride"in e.props)&&("alpha"in e.props?o={...e.props,alpha:Xf(e.props.alpha,r,["material",this.uuid,"layer",n,"alpha"])}:o={...e.props,alphaOverride:Xf(e.props.alphaOverride,r,["material",this.uuid,"alphaOverride"])}),s.updateByOp({...e,...o?{props:o}:{},path:e.path.slice(2)},a,i)&&this.reset0(t,i)}}}else this.reset0(t,i);zn.endContext(this)}applyMasks(){for(let e=0;e<this.layers.length;++e){let t=this.layers[e];t instanceof Xr?t.color.mask=void 0:t instanceof wc&&(t.node.mask=void 0)}for(let e=0;e<this.layers.length;++e){let t=this.layers[e];if(t instanceof Xr&&t.isMask.value&&t.data.visible&&e>0){let i=e-1,r=this.layers[i];r instanceof wc?r.node.mask=new Da(t.color,t.alpha,Da.MUL):r instanceof Xr&&(r.isMask.value||(r.color.mask=new Da(t.color,t.alpha,Da.MUL)))}}}blendColors(){let e=this.layers.findIndex(i=>i instanceof Xr),t=this.layers.findIndex(i=>i instanceof wc);if(e!==-1&&e<t){let i=this.layers[e].color;for(let r=e+1;r<t;++r){let n=this.layers[r];if(n instanceof Xr){if(n.isMask.value)continue;i=new H6(i,n.color,n.alpha,n.mode)}}this.fragment.color=i}else this.fragment.color=void 0}blendAfterColors(){let e=new xr("outgoingLight","f"),t=this.layers.findIndex(i=>i instanceof wc);if(this.layers.length>t+1){for(let i=t+1;i<this.layers.length;++i){let r=this.layers[i];if(r instanceof Xr){if(r.isMask.value)continue;e=new H6(e,r.color,r.alpha,r.mode)}}this.fragment.afterColor=e}else this.fragment.afterColor=void 0}blendPositions(){let e=this.layers.filter(t=>t instanceof jZ);if(e.length>0){let t=e[0].position;for(let i=1;i<e.length;++i)e[i]&&(t=new Da(t,e[i].position,Da.ADD),t=new Da(t,new Tt(.5).setReadonly(!0),Da.MUL));this.fragment.position=t}else this.fragment.position=void 0}getDefines(){return this.defines}getUniforms(){return this.uniforms}getVertexShader(){return this.vertexShader}getFragmentShader(){return this.fragmentShader}onBeforeCompile(e){e.defines=this.defines,e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.extensionDerivatives=this.extensions.derivatives===!0,e.extensionFragDepth=this.extensions.fragDepth===!0,e.extensionDrawBuffers=this.extensions.drawBuffers===!0,e.extensionShaderTextureLOD=this.extensions.shaderTextureLOD===!0}clampUniformsForPreview(e,t){let i=(r,n,s)=>Math.min(Math.max(r,n),s);for(let r of this.layers)if(r.type==="displace"){let n=i(r.uniforms[`f${r.id}_intensity`].value,e,t);r.uniforms[`f${r.id}_intensity`].value=n}}updateFrame(e){for(let t=0;t<this.updaters.length;++t)e.updateNode(this.updaters[t])}build(){let e=new gZ;e.needsJitter=this.needsJitter,this.lights=this.lightLayer.data.visible,e.build(this.fragment,this.fragment),this.vertexShader=e.getCode("vertex"),this.fragmentShader=e.getCode("fragment"),this.defines=e.defines,this.uniforms=e.uniforms,this.extensions=e.extensions,this.updaters=e.updaters;for(let t of this.flavors)t&&t.updateAfterBuild();return this}nodeMaterialDispose(){this.layers.forEach(e=>e.dispose()),super.dispose();for(let e of this.flavors)e&&e.dispose()}assetsLoaded(){for(let e of this.layers)if(e instanceof Xr){let t=e.params.texture;if(t instanceof ZO&&!t.image.loaded)return!1}return!0}};Object.defineProperties(Yd.prototype,{properties:{get:function(){return this.fragment.properties}}});var tz=class extends mk{constructor(e,t,i){super(e,t,!1),this.uuid=i,this.allowVariableSaves=!0,this.saveVariableLocations(t)}},$6=new Map;function QEe(e){if(typeof e=="string")return e;let t=$6.get(e);return t||(t={url:URL.createObjectURL(new Blob([e]))},$6.set(e,t)),t.url}var XZ,KEe=new Promise(e=>{XZ=e}),J6=!1,ES;function ZEe(){if(J6)return;if(ES)return ES;async function e(){await ip(()=>import("./howler-0BAmHj4x.js").then(t=>t.h),[]),XZ(window!==void 0?window:global),J6=!0}return ES=e(),ES}var qZ;KEe.then(e=>qZ=e);function $Ee(e){let t=!1;return e.scene.objects.traverse((i,r)=>{if(r.events===void 0||Array.isArray(r.events)===!1)return!0;let n=[];r.events.forEach(s=>{"dragDropActions"in s.data?(n.push(...s.data.dragDropActions.drag),n.push(...s.data.dragDropActions.drop)):"inActions"in s.data?(n.push(...s.data.inActions),n.push(...s.data.outActions)):"gameActions"in s.data?(n.push(...s.data.gameActions.idle),n.push(...s.data.gameActions.move),n.push(...s.data.gameActions.jump),n.push(...s.data.gameActions.run)):"breakpoints"in s.data?s.data.breakpoints.forEach(a=>{n.push(...a.data.actions)}):"actions"in s.data&&n.push(...s.data.actions),t=t||n.some(a=>a.data.type==="Audio")})}),t}var Cx=class{constructor({src:e,volume:t,delay:i,loop:r}){this._volume=1,this.delay=0,this._loop=1,this.loopsRemaining=0,this._status="stopped",this.onEnd=()=>{this.loopsRemaining===1/0?this.replay():this.loopsRemaining>1?(this.replay(),this.loopsRemaining--):(this._status="stopped",this.loopsRemaining=this._loop)};let n;typeof e=="string"?n={src:e}:n={src:QEe(e),format:"wav"},this.sound=new qZ.Howl(n),this.sound.on("end",this.onEnd),this.src=e,t!==void 0&&(this.volume=t),i!==void 0&&(this.delay=i),r!==void 0&&(this.loop=r)}get status(){return this._status}get volume(){return this._volume}set volume(e){this._volume=e,this.sound.volume(e)}get loop(){return this._loop}set loop(e){this._loop=e,this.loopsRemaining=e}replay(){this.clearDelay(),this.delayTimerId=window.setTimeout(()=>{this.sound.play(),this.clearDelay()},this.delay)}fade(e,t=1e3){e?(this.sound.volume(this._volume),this.clearFade(),this.fadeTimerId=window.setTimeout(()=>{this.sound.fade(this._volume,0,t),this.clearFade()},e)):this.sound.fade(this._volume,0,t)}on(e,t,i){this.sound.on(e,t,i)}off(e,t,i){this.sound.off(e,t,i)}play(){this._status==="playing"||this.sound.playing()||(this._status==="paused"?(this.sound.seek()===0?this.replay():this.sound.play(),this._status="playing"):this._status==="stopped"&&(this.replay(),this._status="playing"))}pause(){this._status==="playing"&&(this.sound.pause(),this.clearFade(),this.clearDelay(),this._status="paused")}stop(){this.sound.stop(),this.loopsRemaining=this._loop,this.clearFade(),this.clearDelay(),this._status="stopped"}clearFade(){this.fadeTimerId&&(clearTimeout(this.fadeTimerId),delete this.fadeTimerId)}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}dispose(e=!1){this.off(),this.stop(),this.clearFade(),this.clearDelay()}},JEe=class{constructor(){this.type="ShapePath",this.color=new jt,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new bA,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){var i;return(i=this.currentPath)==null||i.lineTo(e,t),this}quadraticCurveTo(e,t,i,r){var n;return(n=this.currentPath)==null||n.quadraticCurveTo(e,t,i,r),this}bezierCurveTo(e,t,i,r,n,s){var a;return(a=this.currentPath)==null||a.bezierCurveTo(e,t,i,r,n,s),this}splineThru(e){var t;return(t=this.currentPath)==null||t.splineThru(e),this}toShapes(){let e={ORIGIN:0,DESTINATION:1,BETWEEN:2,LEFT:3,RIGHT:4,BEHIND:5,BEYOND:6},t={loc:e.ORIGIN,t:0};function i(p,f,v,g){let m=p.x,x=f.x,w=v.x,_=g.x,M=p.y,S=f.y,A=v.y,T=g.y,E=(_-w)*(M-A)-(T-A)*(m-w),C=(x-m)*(M-A)-(S-M)*(m-w),D=(T-A)*(x-m)-(_-w)*(S-M),I=E/D,L=C/D;if(D===0&&E!==0||I<=0||I>=1||L<0||L>1)return null;if(E===0&&D===0){for(let z=0;z<2;z++)if(r(z===0?v:g,p,f),t.loc===e.ORIGIN){let F=z===0?v:g;return{x:F.x,y:F.y,t:t.t}}else if(t.loc===e.BETWEEN){let F=+(m+t.t*(x-m)).toPrecision(10),Q=+(M+t.t*(S-M)).toPrecision(10);return{x:F,y:Q,t:t.t}}return null}else{for(let Q=0;Q<2;Q++)if(r(Q===0?v:g,p,f),t.loc===e.ORIGIN){let Y=Q===0?v:g;return{x:Y.x,y:Y.y,t:t.t}}let z=+(m+I*(x-m)).toPrecision(10),F=+(M+I*(S-M)).toPrecision(10);return{x:z,y:F,t:I}}}function r(p,f,v){let g=v.x-f.x,m=v.y-f.y,x=p.x-f.x,w=p.y-f.y,_=g*w-x*m;if(p.x===f.x&&p.y===f.y){t.loc=e.ORIGIN,t.t=0;return}if(p.x===v.x&&p.y===v.y){t.loc=e.DESTINATION,t.t=1;return}if(_<-Number.EPSILON){t.loc=e.LEFT;return}if(_>Number.EPSILON){t.loc=e.RIGHT;return}if(g*x<0||m*w<0){t.loc=e.BEHIND;return}if(Math.sqrt(g*g+m*m)<Math.sqrt(x*x+w*w)){t.loc=e.BEYOND;return}let M;g!==0?M=x/g:M=w/m,t.loc=e.BETWEEN,t.t=M}function n(p,f){let v=[],g=[];for(let m=1;m<p.length;m++){let x=p[m-1],w=p[m];for(let _=1;_<f.length;_++){let M=f[_-1],S=f[_],A=i(x,w,M,S);A!==null&&v.find(T=>T.t<=A.t+Number.EPSILON&&T.t>=A.t-Number.EPSILON)===void 0&&(v.push(A),g.push(new ve(A.x,A.y)))}}return g}function s(p,f,v){let g=new ve;f.getCenter(g);let m=[];return v.forEach(x=>{x.boundingBox.containsPoint(g)&&n(p,x.points).forEach(w=>{m.push({identifier:x.identifier,isCW:x.isCW,point:w})})}),m.sort((x,w)=>x.point.x-w.point.x),m}function a(p,f,v,g,m){(m==null||m==="")&&(m="nonzero");let x=new ve;p.boundingBox.getCenter(x);let w=[new ve(v,x.y),new ve(g,x.y)],_=s(w,p.boundingBox,f);_.sort((C,D)=>C.point.x-D.point.x);let M=[],S=[];_.forEach(C=>{C.identifier===p.identifier?M.push(C):S.push(C)});let A=M[0].point.x,T=[],E=0;for(;E<S.length&&S[E].point.x<A;)T.length>0&&T[T.length-1]===S[E].identifier?T.pop():T.push(S[E].identifier),E++;if(T.push(p.identifier),m==="evenodd"){let C=T.length%2===0,D=T[T.length-2];return{identifier:p.identifier,isHole:C,for:D}}else if(m==="nonzero"){let C=!0,D=null,I=null;for(let L=0;L<T.length;L++){let z=T[L];f[z]&&(C?(I=f[z].isCW,C=!1,D=z):I!==f[z].isCW&&(I=f[z].isCW,C=!0))}return{identifier:p.identifier,isHole:C,for:D}}else console.warn('fill-rule: "'+m+'" is currently not implemented.')}let o=0,l=999999999,c=-999999999,u=[];this.subPaths.forEach(p=>{let f=p.getPoints(),v=-999999999,g=999999999,m=-999999999,x=999999999;for(let w=0;w<f.length;w++){let _=f[w];_.y>v&&(v=_.y),_.y<g&&(g=_.y),_.x>m&&(m=_.x),_.x<x&&(x=_.x)}c<=m&&(c=m+1),l>=x&&(l=x-1),f.length&&u.push({curves:p.curves,points:f,isCW:ZY.isClockWise(f),identifier:o++,boundingBox:new cQ(new ve(x,g),new ve(m,v))})});let h=u.map(p=>{var f;return a(p,u,l,c,(f=this.userData)==null?void 0:f.style.fillRule)}),d=[];return u.forEach(p=>{let f=h[p.identifier];if(f&&!f.isHole){let v=new _A;v.curves=p.curves,h.filter(g=>(g==null?void 0:g.isHole)&&g.for===p.identifier).forEach(g=>{if(g){let m=u[g.identifier],x=new bA;x.curves=m.curves,v.holes.push(x)}}),d.push(v)}}),d}},YZ=!1,QZ,ej=new Promise(e=>{QZ=e}),tj=!1,AS;function eAe(){if(YZ=!0,tj)return;if(AS)return AS;async function e(){let t=await ip(()=>import("./opentype-D6jUvuOk.js"),[]);QZ(t),tj=!0}return AS=e(),AS}var tAe=class{async load(e,t,i=()=>{}){let{load:r}=await ej;r(e,(n,s)=>{n||!s?i(n??"Something went wrong"):t(s)})}async parse(e){let{parse:t,Bidi:i}=await ej;try{let r=t(e),n=new i,s=a=>r.charToGlyphIndex(a.char);return n.registerModifier("glyphIndex",null,s),n.applyFeatures(r,r.defaultRenderOptions.features),{font:r,bidi:n}}catch(r){console.error(r)}}};async function iAe(e){return await(await fetch(e)).arrayBuffer()}var rAe=new tAe;async function ij(e){let t,i,r=!1;if(e.url?(t=await iAe(e.url),i=e.url,r=e.url.startsWith("/")):e.data&&(t=e.data.buffer.slice(e.data.byteOffset,e.data.byteOffset+e.data.byteLength)),t)if(YZ){let n=await rAe.parse(t);if(n)return{font:n.font,url:i,intercepted:r,arr:t,bidi:n.bidi}}else return{font:void 0,url:i,intercepted:r,arr:t,bidi:null}}function nAe(e,t){return t.state.glyphIndex===e||t.state.fina===e||t.state.medi===e||t.state.init===e}var sAe=class{constructor(e){this._arrayBuffer=new ArrayBuffer(1),this._isLoaded=!1,this._intercepted=!1,this._isUserFont=e.isUserFont??!1,this._loadingPromise=ij(e).then(t=>{t&&(this._arrayBuffer=t.arr,this._url=t.url,this.font=t.font,this._intercepted=t.intercepted,this._isLoaded=!0,this._bidi=t.bidi)})}update(e){this._isLoaded=!1,this._isUserFont=e.isUserFont??!1,this._loadingPromise=ij(e).then(t=>{t&&(this._arrayBuffer=t.arr,this._url=t.url,this.font=t.font,this._intercepted=t.intercepted,this._isLoaded=!0,this._bidi=t.bidi)})}get url(){return this._url}get intercepted(){return this._intercepted}get isLoaded(){return this._isLoaded}get loadingPromise(){return this._loadingPromise}reverseLigaturesTable(e,t,i){if(!this._bidi)return[];let r=this._bidi;r.getTextGlyphs(t);let n=r.tokenizer.tokens,s=[],a=0,o=i.length===n.length;for(let l=0;l<i.length;l++){let c=i[l].index,u=String.fromCharCode(i[l].unicode),h=n[a];if(nAe(c,h)||o)s.push({char:u,index:c,replacements:[h.state.glyphIndex],replacementChars:[h.char]}),a++;else{let d=h.char,p="",f=[h.state.glyphIndex],v=[],g=!1;for(;!g;)a++,p=t.charAt(a),d+=p,f.push(e.charToGlyphIndex(p)),v=e.stringToGlyphs(d),v.length===1&&v[0].index===c&&(g=!0),a>t.length&&(g=!0);s.push({char:u,index:c,replacements:f,replacementChars:Array.from(d)}),a++}}return s}generateShapes(e,t){if(!this._isLoaded)return;let i=this.font,r=t.fontSize/this.unitsPerEm,n=t.fontSize*t.lineHeight,s=e.map(m=>this.getTextWidth(m,t)),a=t.width,o=this.getCharWidth(`
`,t),l=t.horizontalAlign===1?o:0,c=this.computeSpaceWidthForLine(e,0,t),u=this.getLineInitialOffsetX(s[0],a,t.horizontalAlign,e[0],o),h=this.getLineInitialOffsetY(n,e.length,t.height,r,t.verticalAlign),d=[],p=e.map(m=>[]),f=e.map(m=>[]),v;for(let m=0;m<e.length;m++){let x=e[m],w={features:{liga:!0}},_=[];try{_=i.stringToGlyphs(x,w)}catch(S){console.warn(S)}u=this.getLineInitialOffsetX(s[m],a,t.horizontalAlign,x,o);let M=[];try{M=this.reverseLigaturesTable(i,x,_)}catch(S){console.warn(S)}c=this.computeSpaceWidthForLine(e,m,t);for(let S=0;S<_.length;S++){let A=_[S],T=A.index===0?`
`:A.unicode?String.fromCharCode(A.unicode):void 0,E=M[S],C=0,D=0;S===0&&t.horizontalAlign===2&&A.leftSideBearing!==void 0&&(D=-A.leftSideBearing*r),v&&(C=i.getKerningValue(A,v)*r),u+=D+C;let I=0;if(T===`
`)I=l;else if(T===" ")I=c;else{let L=this.createPath(A,r,u,h,t);L&&(I=L.offsetX-(C+D),d.push(L.path))}if(E.replacements.length===1)f[m].push([u,h]),p[m].push(I);else{let L=E.replacements.map(Y=>(i.glyphs.get(Y).advanceWidth??0)*r),z=L.reduce((Y,O)=>Y+=O,0),F=L.map(Y=>Y/z),Q=u;for(let Y=0;Y<F.length;Y++){let O=I*F[Y];f[m].push([Q,h]),p[m].push(O),Q+=O}}u+=I,v=A}h-=n}let g=[];for(let m=0,x=d.length;m<x;m++)g.push(...d[m].toShapes());return{shapes:g,charWidths:p,lineWidths:s,charCoords:f}}get isUserFont(){return this._isUserFont}get arrayBuffer(){return this._arrayBuffer}get ascender(){var e;return((e=this.font)==null?void 0:e.ascender)??0}get descender(){var e;return((e=this.font)==null?void 0:e.descender)??0}get familyName(){var e;return((e=this.font)==null?void 0:e.names.fontFamily)??""}get subfamilyName(){var e;return((e=this.font)==null?void 0:e.names.fontSubfamily)??""}get unitsPerEm(){var e;return((e=this.font)==null?void 0:e.unitsPerEm)??1}getLineInitialOffsetX(e,t,i,r,n){return(i===3||i===2)&&r.indexOf(`
`)>=0&&(e-=n),i===3?t*.5-e*.5:i===2?t-e:0}getLineInitialOffsetY(e,t,i,r,n){let s=t*e,a=Math.abs(this.ascender-this.descender)*r,o=e-a,l=-this.ascender*r-o/2;return n===3?-(i-s-l):n===2?-(i*.5-s*.5-l):l}createPath(e,t,i,r,n){var l;let s=e.getPath(i,-r,n.fontSize,{kerning:!1,letterSpacing:n.letterSpacing});if(!s){console.error('THREE.Font: character "'+e+'" does not exists in font family '+this.familyName+".");return}let a=new JEe,o=(e.advanceWidth??1)*t;if(e)for(let c of s.commands){let u=(l=a.currentPath)==null?void 0:l.currentPoint;if(!(u&&c.type!=="Z"&&u.x===c.x&&-u.y===c.y))switch(c.type){case"M":a.moveTo(c.x,-c.y);break;case"L":a.lineTo(c.x,-c.y);break;case"Q":a.quadraticCurveTo(c.x1,-c.y1,c.x,-c.y);break;case"C":a.bezierCurveTo(c.x1,-c.y1,c.x2,-c.y2,c.x,-c.y);break}}return a.subPaths.forEach(c=>{let u=aAe(c.curves);u!==void 0&&c.currentPoint.distanceTo(u)>0&&c.lineTo(u.x,u.y)}),{offsetX:o+n.fontSize*n.letterSpacing,path:a}}getCharWidth(e,t){var i;return((i=this.font)==null?void 0:i.getAdvanceWidth(e,t.fontSize,{kerning:!0,letterSpacing:t.letterSpacing}))??0}getTextWidth(e,t){var i;return((i=this.font)==null?void 0:i.getAdvanceWidth(e,t.fontSize,{kerning:!0,letterSpacing:t.letterSpacing}))??0}computeSpaceWidthForLine(e,t,i){let r=this.getCharWidth(" ",i),n=e[t];if(n){let s=this.countSpaces(n.trimEnd());if(i.horizontalAlign===4&&t<e.length-1&&s){let a=i.width,o=this.getTextWidth(n,i);return(a-(o-s*r))/s}}return r}countSpaces(e){return(e.match(/ /g)||[]).length}};function aAe(e){if(e.length){let t=e[0];if(t instanceof Bl)return t.v1;if(t instanceof Rl||t instanceof Xd)return t.v0}}var oAe=class{constructor(){this.objects=new Map,this.unreachable=new Set}getCached(e){return this.objects.get(e)}get size(){return this.objects.size}get(e,t,i){let r=this.objects.get(e);return r===void 0?(r=this.createObject(e,t,i),this.objects.set(e,r)):r.isShared=!0,r}forceDelete(e){let t=this.objects.get(e);t&&(this.disposeObject(t),this.objects.delete(e))}mutateIfUnique(e,t){let i=this.objects.get(e);if(i&&i.isShared!==!0)return this.objects.delete(e),this.objects.set(t,i),i}startGc(){this.unreachable=new Set(this.objects.keys())}markAsReachable(e,t){let i=this.objects.get(e);t===i&&this.unreachable.delete(e)}endGc(){this.unreachable.forEach(e=>{this.disposeObject(this.objects.get(e)),this.objects.delete(e)}),this.unreachable.clear()}dispose(){this.objects.forEach(e=>{this.disposeObject(e)}),this.objects.clear()}},rj=class extends oAe{constructor(e){super(),this.flatShading=e}disposeObject(e){e.dispose()}createObject(e,t,i){let r=Z1(e,t,this.flatShading,i);return r.computeBoundingSphere(),r}},lAe={markNeedsUpdateRendererDirty:()=>{}};function gk(e){return{all:e=e||new Map,on:function(t,i){var r=e.get(t);r?r.push(i):e.set(t,[i])},off:function(t,i){var r=e.get(t);r&&(i?r.splice(r.indexOf(i)>>>0,1):e.set(t,[]))},emit:function(t,i){var r=e.get(t);r&&r.slice().map(function(n){n(i)}),(r=e.get("*"))&&r.slice().map(function(n){n(t,i)})}}}var cAe=class{constructor(e,t,i){var r;this.id=e,this.userAPI=t,this.result=void 0,this.error="null",this.isPrefetched=!1,this.isLoading=!1,this.isLoaded=!1,this.prefetchPromise=new Promise(n=>n()),this.emitter=gk(),((r=t==null?void 0:t.integration)==null?void 0:r.type)==="OpenAI"?this.result={content:""}:t.method==="GET"&&t.url!==""&&(this.prefetchPromise=this.prefetch(i))}async prefetch(e){await this.callUserAPI(e)}async callUserAPI(e){var t,i,r;this.emitter.emit("start",{userAPIId:this.id}),this.isLoading=!0,this.isLoading=!1;try{this.result=await fAe(this.userAPI,e),this.error="null",this.emitter.emit("success",{userAPIId:this.id})}catch(n){let s=((r=(i=(t=n.message)==null?void 0:t.split("_:_"))==null?void 0:i[0])==null?void 0:r.replace("status:",""))??"null";this.error=s,this.result=null,this.emitter.emit("error",{userAPIId:this.id})}this.isLoading=!1,this.isPrefetched=!0,this.isLoaded=!0}update(e,t){this.userAPI=e,this.userAPI.url!==""&&this.userAPI.method==="GET"&&this.prefetch(t)}retrieveValue(e){if(this.result)try{return Bn.zoom(this.result,e)}catch(t){console.error(t)}}retrieveZoomedKeyValues(e){if(this.result){let t=e&&e.length?Bn.zoom(this.result,e):this.result;if(pAe(t))return Object.entries(t);if(dAe(t))return t.map((i,r)=>[r.toString(),i]);throw hAe(t)?new Error("This path points to a value, use retrieveValue() instead. "+(e==null?void 0:e.join("."))):new Error("Path error"+(e==null?void 0:e.join(".")))}}dispose(){}on(e,t){this.emitter.on(e,t)}off(e,t){this.emitter.off(e,t)}get autostart(){return this.userAPI.autoStart}};function uAe(e){let t=new Headers;return e.headers.forEach(i=>{i.data.key!==""&&t.append(i.data.key,i.data.value)}),t}function hAe(e){return typeof e=="string"||typeof e=="number"||typeof e=="boolean"||e===null}function dAe(e){return Array.isArray(e)}function pAe(e){return typeof e=="object"&&e!==null}async function fAe(e,t,i=new AbortController){var s,a;let r;if(((s=e.integration)==null?void 0:s.type)==="OpenAI"){let o=xE(e.integration.prompt===""?"":JSON.parse(e.integration.prompt),t),l=e.integration.behavior===""?"":xE(JSON.parse(e.integration.behavior),t);r=`{
			"model": "${e.integration.model}",
			"messages": [${e.integration.useBehavior?`
			{
				"role": "system",
				"content": "${l}"
			},`:""}
			{
				"role": "user",
				"content": "${o}"
			}
			]
		}`}else e.method==="POST"&&e.body&&(r=xE(JSON.parse(e.body),t));let n=await fetch(e.url,{method:e.method,headers:uAe(e),signal:i.signal,body:r});if(!n.ok)throw new Error("status:"+n.status+"_:_"+n.statusText);return((a=e.integration)==null?void 0:a.type)==="OpenAI"?{content:(await n.json()).choices[0].message.content}:await n.json()}var KZ=(e,t)=>{if(typeof e=="string"){let i=t.getVariable(e);if(i)return KZ(i,t)}return Ss.isBoolean(e)?Ss.getDisplayedValue(e).toLowerCase():Ss.getDisplayedValue(e)},xE=(e,t)=>e.map((i,r)=>{if("text"in i)return i.text;if("type"in i){if(i.type==="paragraph")return(r>0?`
`:"")+xE(i.children,t);if(i.type==="variable"){let n=t.getVariable(i.variableId);if(n!==void 0)return KZ(n,t)}}return""}).join(""),wE=1e3,nj=512*wE;function mAe(e,t){let i=typeof e;return!!((t==="string"||t==="number")&&i===t||t==="boolean"&&(e==="true"||e==="false"||e===!0||e===!1)||t==="image"&&i==="string"&&e.startsWith("http"))}var gAe="https://hooks.spline.design",vAe=`${gAe}/events?hashFile=`,yAe=class{constructor(e,t){this.id=e,this.userWebhook=t,this.result=void 0,this._connected=!1,this.emitter=gk(),this.reconnectWaitFor=wE,this._onError=i=>{var r,n,s;(r=this.eventSource)==null||r.removeEventListener("message",this._onMessage),(n=this.eventSource)==null||n.removeEventListener("error",this._onError),(s=this.eventSource)==null||s.removeEventListener("open",this._onConnected),this._scheduleReconnect()},this._onConnected=i=>{clearTimeout(this.scheduledReconnectHandle),this.reconnectWaitFor=wE,this._connected=!0},this._onDisconnected=()=>{clearTimeout(this.scheduledReconnectHandle),this.reconnectWaitFor=wE,this._connected=!1},this._onMessage=i=>{let r=i.data,n;try{n=JSON.parse(r)}catch(s){console.error("Error parsing webhook message",s)}if(n){let s=!1;this.userWebhook.parametersSchemas.forEach(({data:a})=>{n[a.name]!==void 0&&mAe(n[a.name],a.type)&&(this.result===void 0&&(this.result={}),this.result[a.name]=n[a.name],s=!0)}),s&&this.emitter.emit("message",{userWebhookId:this.id})}}}connect(){clearTimeout(this.scheduledReconnectHandle),this.userWebhook.url&&(this.eventSource=new EventSource(vAe+this.userWebhook.url),this.eventSource.addEventListener("message",this._onMessage),this.eventSource.addEventListener("error",this._onError),this.eventSource.addEventListener("open",this._onConnected))}disconnect(){var e,t,i,r;(e=this.eventSource)==null||e.removeEventListener("message",this._onMessage),(t=this.eventSource)==null||t.removeEventListener("error",this._onError),(i=this.eventSource)==null||i.removeEventListener("open",this._onConnected),(r=this.eventSource)==null||r.close(),this._onDisconnected(),clearTimeout(this.scheduledReconnectHandle)}_scheduleReconnect(){this.reconnectWaitFor*=2,this.reconnectWaitFor>nj&&(this.reconnectWaitFor=nj),clearTimeout(this.scheduledReconnectHandle),this.scheduledReconnectHandle=setTimeout(()=>{this.scheduledReconnectHandle=void 0,this.connect()},this.reconnectWaitFor)}update(e){this.userWebhook=e}dispose(){this._connected&&this.disconnect()}get connected(){return this._connected}on(e,t){this.emitter.on(e,t)}off(e,t){this.emitter.off(e,t)}getParametersKeys(){return this.userWebhook.parametersSchemas.map(e=>e.data.name)}getParameterValue(e){var t;if(this.getParametersKeys().includes(e)){if(this.result)return(t=this.result)==null?void 0:t[e];for(let i of this.userWebhook.parametersSchemas)if(i.data.name===e)return PO.defaultParameterValueByType(i.data.type)}}};function iz(e){return"variable_"+e}var xAe=class extends sEe{constructor(e){super(),this.shared=e}create(e){return new UZ(e,this.shared)}},vk=class{constructor(e,t={},i=!0,r=!1){if(this.data=e,this.needsJitter=i,this.enableLocalStorageForPersistentVariables=r,this.geometryCache=new rj(!0),this.geometryCache2=new rj(!1),this.imageHolderCache=new xAe(this),this.thisContext={scene:lAe,shared:this},this.deletedMaterial=new tz(_s.defaultTwoLayerData("phong"),this.thisContext,""),this.deletedImage=new gd(RO.emptyImage,this),this.deletedVideo=new gd(GA.defaultVideo,this),this.materials={},this.images={},this.uiBuffers={},this.videos={},this.colors={},this.audios={},this.particles={},this.fonts={},this.variables={},this.userAPIs={},this.userWebhooks={},this.mouseProperty=null,this.raycastProperty=null,this.requestRender=()=>{this._requestRender&&this._requestRender()},t.images)for(let[n,s]of Object.entries(t.images))this.addImage(n,s);if(t.videos)for(let[n,s]of Object.entries(t.videos))this.addVideo(n,s);if(t.audios)for(let[n,s]of Object.entries(t.audios))this.addAudio(n,s);if(t.particles)for(let[n,s]of Object.entries(t.particles))this.addParticle(n,s);this.reset(e)}setRequestRender(e){this._requestRender=e}getImageLoadPromises(){return Object.values(this.images).map(e=>e.loadPromise)}setEntityOpContext(e){this.entityOpContext=e}reset(e,t=!1){this.data=e,this.resetLib(e.lib);for(let{id:i,data:r}of e.variables)this.addVariableHolder(i,r),t&&this.updateVariableHolder(i,r);for(let[i,r]of Object.entries(e.userAPIs))this.addUserAPI(i,r);for(let[i,r]of Object.entries(e.userWebhooks))this.addUserWebhook(i,r);for(let[i,r]of Object.entries(e.images))this.addImage(i,r);for(let[i,r]of Object.entries(e.videos))this.addVideo(i,r);for(let[i,r]of Object.entries(e.colors))this.addColor(i,r);for(let[i,r]of Object.entries(e.materials))this.addMaterial(i,r);for(let[i,r]of Object.entries(e.audios))this.addAudio(i,r);for(let[i,r]of Object.entries(e.particles))this.addParticle(i,r);for(let[i,r]of Object.entries(e.fonts))this.addFont(i,r)}addMaterial(e,t){if(this.materials[e]){let i=this.materials[e];i.reset(t,this.thisContext),i.dispose()}else{let i=new tz(t,this.thisContext,e);this.materials[e]=i}}deleteMaterial(e){this.materials[e]&&(this.materials[e].nodeMaterialDispose(),delete this.materials[e])}getMaterial(e){return this.materials[e]}getMaterialOrDeletedPlaceholder(e){return this.materials[e]??this.deletedMaterial}material(e){return typeof e=="string"?this.getMaterialOrDeletedPlaceholder(e):e==null?(console.error("material is undefined or null"),this.deletedMaterial):new mk(e,this.thisContext)}getMaterials(){return this.materials}addImage(e,t){return this.images[e]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),this.images[e].updateSrc(t.data),!0):(this.images[e]=new gd(t,this),!1)}deleteImage(e){let t=this.images[e];t&&(t.dispose(),delete this.images[e])}getDefaultImage(){return this.images.image_0}getImage(e){return this.images[e]??this.deletedImage}image(e){return typeof e=="string"?this.getImage(e):this.imageHolderCache.load(e)}addUIBuffer(e,t){return this.uiBuffers[e]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),this.uiBuffers[e].updateSrc(t),!0):(this.uiBuffers[e]=new gd(t,this),!1)}uiBuffer(e){return this.uiBuffers[e]}addVideo(e,t){return this.videos[e]?(this.videos[e].updateSrc(t.data),!0):(this.videos[e]=new gd(t,this),!1)}deleteVideo(e){let t=this.videos[e];t&&(t.dispose(),delete this.videos[e])}getVideo(e){return this.videos[e]??this.deletedVideo}video(e){return typeof e=="string"?this.getVideo(e):this.imageHolderCache.load(e)}addColor(e,t){return this.colors[e]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),"a"in t?this.colors[e].setRGBA(t.r,t.g,t.b,t.a):this.colors[e].setRGBA(t.r,t.g,t.b,1),!0):("a"in t?this.colors[e]=new aC(t.r,t.g,t.b,t.a):this.colors[e]=new aC(t.r,t.g,t.b,1),!1)}updateColor(e,t){if(this.colors[e]){this.onColorOrImageUpdate&&this.onColorOrImageUpdate();let i=this.colors[e];return this.colors[e].r=t.r??i.r,this.colors[e].g=t.g??i.g,this.colors[e].b=t.b??i.b,this.colors[e].a=t.a??i.a,!0}return!1}deleteColor(e){this.colors[e]&&delete this.colors[e]}getColor(e){return this.colors[e]}color(e){let t;if(typeof e=="string"){let i=this.getColor(e);i?t=i:(console.warn("Tried to create color layer params with a color key that does not exist in the assets manager"),t=new Es(0,0,0,0))}else return"a"in e?new Es(e.r,e.g,e.b,e.a):new Es(e.r,e.g,e.b,1);return t}addAudio(e,t){this.audios[e]=t}getAudio(e){let t=this.audios[e];if(t instanceof Cx)return t;{let i=new Cx({src:t.data});return this.audios[e]=i,i}}addParticle(e,t){this.particles[e]=t}getParticle(e){return this.particles[e]}deleteParticle(e){this.particles[e]&&delete this.particles[e]}deleteAudio(e){let t=this.audios[e];t&&(t instanceof Cx&&t.dispose(),delete this.audios[e])}addFont(e,t){this.fonts[e]=new sAe(t),this.fonts[e].loadingPromise.then(()=>this.requestRender())}getFont(e){return this.fonts[e]}deleteFont(e){this.fonts[e]&&delete this.fonts[e]}dispose(){Object.keys(this.materials).forEach(e=>this.deleteMaterial(e)),this._requestRender=void 0,Object.values(this.audios).forEach(e=>{e instanceof Cx&&e.dispose()}),this.audios={},this.particles={},this.geometryCache.dispose(),this.geometryCache2.dispose()}addVariableHolder(e,t){if(this.variables[e]===void 0){let i=t.value;if(this.enableLocalStorageForPersistentVariables&&t.persistent){let r=localStorage.getItem(iz(e));i=r!==null?JSON.parse(r):t.value}return this.variables[e]={value:i,locations:[],persistent:t.persistent},"dynamicVariableType"in t&&(this.variables[e].dynamicVariablePlayState="Playing",this.variables[e].dynamicVariableToggleIsForward=void 0),!0}return this.variables[e].value=t.value,!1}resetDynamicVariablePlayState(){for(let e in this.variables)this.variables[e].dynamicVariablePlayState!==void 0&&(this.variables[e].dynamicVariablePlayState="Playing",this.variables[e].dynamicVariableToggleIsForward=void 0)}updateVariableHolder(e,t){this.updateVariable(e,t.value)}updateVariable(e,t){if(this.variables[e]===void 0)return!1;this.variables[e].value=t,this.enableLocalStorageForPersistentVariables&&this.variables[e].persistent&&localStorage.setItem(iz(e),JSON.stringify(t));let i=t;for(;typeof i=="string";)i=this.variables[i].value;let r=this.entityOpContext.scene;for(let n=this.variables[e].locations.length-1;n>=0;n--){let s=this.variables[e].locations[n];if(s[0]==="material"){let a=s[1],o=i,l={scene:r,shared:this},c=s.slice(2);r.traverseMaterial(h=>{let d=h.root??h;d.uuid===a&&d.onVariableUpdate(c,o,l)});let u=this.materials[a];u&&u.onVariableUpdate(c,o,l)}else{let a=r.find(s[0]);if(a===void 0){this.variables[e].locations.splice(n,1);continue}if(s[1]!=="geometry"&&s[1]!=="particles"){for(let o=1;o<s.length-1;o++)a=a[s[o]];s[1]==="rotation"?a[s[s.length-1]]=i*Et.DEG2RAD:a[s[s.length-1]]=i}if(a=r.find(s[0]),a.type==="ParticleEmitter"&&a.updateVariableState(i,s),Pi.is(a)){if(s[1]==="position"||s[1]==="rotation"||s[1]==="scale")a.onVariableUpdate();else if(s[1]==="geometry"){let o=a;a.component&&(o=a.component);let l=o.dataPatched;o.chooseGeoemtryCache(this).forceDelete(l.geometry),o.createGeometryDelayed(this.entityOpContext),o.onVariableUpdate(!0),o.instances.forEach(c=>{let u=c.dataPatched;c.chooseGeoemtryCache(this).forceDelete(u.geometry),c.createGeometryDelayed(this.entityOpContext),c.onVariableUpdate(!0)})}}}}return this.requestRender(),!0}deleteVariable(e){this.variables[e]&&delete this.variables[e]}getVariable(e,t){var i,r,n;if(Array.isArray(e)){if(e[0]==="mouse")return((i=this.mouseProperty)==null?void 0:i[e[1]])??0;if(e[0]==="raycast")return((r=this.raycastProperty)==null?void 0:r[e[1]])??0;let s=this.entityOpContext.scene.find(e[0]);if(e[1]==="width"||e[1]==="height"||e[1]==="depth")return s.geometry.userData.parameters[e[1]];for(let a=1;a<e.length;a++)s=s[e[a]];return e[1]==="rotation"&&(s*=Et.RAD2DEG),s}for(let s in this.variables){if(t===void 0)break;let a=this.variables[s],o=(n=a.locations)==null?void 0:n.findIndex(l=>Bn.equal(l,t));o!==void 0&&o!==-1&&a.locations.splice(o,1)}if(typeof e=="string"){let s=e,a=e;do{if(a=s,this.variables[s]===void 0)break;let o=this.variables[s].value;t&&this.variables[a]!==void 0&&this.variables[a].locations.push(t),s=o}while(typeof s=="string");return s}else return e}getVariables(){return this.variables}getDynamicVariablePlayState(e){var t;return(t=this.variables[e])==null?void 0:t.dynamicVariablePlayState}setDynamicVariablePlayState(e,t){this.variables[e]!==void 0&&(this.variables[e].dynamicVariablePlayState=t)}getDynamicVariableToggleIsForward(e){var t;return(t=this.variables[e])==null?void 0:t.dynamicVariableToggleIsForward}setDynamicVariableToggleIsForward(e,t){this.variables[e]!==void 0&&(this.variables[e].dynamicVariableToggleIsForward=t)}resetLib(e){for(let[t,i]of Object.entries(e.images))this.addImage(t,i.asset);for(let[t,i]of Object.entries(e.audios))this.addAudio(t,i.asset);for(let[t,i]of Object.entries(e.particles))this.addParticle(t,i.asset);for(let[t,i]of Object.entries(e.colors))this.addColor(t,i.asset);for(let[t,i]of Object.entries(e.fonts))this.addFont(t,i.asset);for(let[t,i]of Object.entries(e.materials))this.addMaterial(t,i.asset);for(let[t,i]of Object.entries(e.videos))this.addVideo(t,i.asset);for(let[t,i]of Object.entries(e.variables))this.addVariableHolder(t,i.asset)}updateLibByOp(e,t){e.path[0]==="images"?e.path.length===1&&e.type===1?this.addImage(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteImage(e.id):e.path[0]==="videos"?e.path.length===1&&e.type===1?this.addVideo(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteVideo(e.id):e.path[0]==="audios"?e.path.length===1&&e.type===1?this.addAudio(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteAudio(e.id):e.path[0]==="particles"?e.path.length===1&&e.type===1?this.addParticle(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteParticle(e.id):e.path[0]==="colors"?e.path.length===1&&e.type===1?this.addColor(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteColor(e.id):e.path[0]==="materials"?e.path.length===1&&e.type===1?this.addMaterial(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteMaterial(e.id):e.path[0]==="fonts"?e.path.length===1&&e.type===1?this.addFont(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteFont(e.id):e.path[0]==="variables"?e.path.length===1&&e.type===1?this.addVariableHolder(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteVariable(e.id):e.path[0]==="components"&&t.updateByLibOp(e,this)}updateByOp(e,t,i){var r,n;if(this.data=t,e.path[0]==="images")e.path.length===2&&e.type===0?e.props.data&&this.getImage(e.path[1]).updateSrc(e.props.data):e.path.length===1&&e.type===1?this.addImage(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteImage(e.id);else if(e.path[0]==="videos")e.path.length===2&&e.type===0?e.props.data&&this.getVideo(e.path[1]).updateSrc(e.props.data):e.path.length===1&&e.type===1?this.addVideo(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteVideo(e.id);else if(e.path[0]==="audios")e.path.length===2&&e.type===0?e.props.data&&this.addAudio(e.path[1],t.audios[e.path[1]]):e.path.length===1&&e.type===1?this.addAudio(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteAudio(e.id);else if(e.path[0]==="particles")e.path.length===2&&e.type===0?e.props.data&&this.addParticle(e.path[1],t.particles[e.path[1]]):e.path.length===1&&e.type===1?this.addParticle(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteParticle(e.id);else if(e.path[0]==="colors")e.path.length===2&&e.type===0?this.updateColor(e.path[1],e.props):e.path.length===1&&e.type===1?this.addColor(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteColor(e.id);else if(e.path[0]==="materials")e.path.length===1&&e.type===1?this.addMaterial(e.id,e.data):e.path.length===1&&e.type===2?this.deleteMaterial(e.id):e.path.length>1&&this.getMaterial(e.path[1]).updateByOp(rs.drop(e,2),t.materials[e.path[1]],{shared:this,scene:i});else if(e.path[0]==="fonts")e.path.length===2&&e.type===0?this.updateFont(e.path[1],e,i):e.path.length===1&&e.type===1?this.addFont(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteFont(e.id);else if(e.path[0]==="variables")e.path.length===2&&e.type===0?"value"in e.props?this.updateVariable(e.path[1],e.props.value):"persistent"in e.props&&(this.variables[e.path[1]].persistent=e.props.persistent):e.path.length===1&&e.type===4?this.addVariableHolder(e.id,e.data):e.path.length===1&&e.type===5&&this.deleteVariable(e.id);else if(e.path[0]==="userAPIs"){if(e.path.length===1&&e.type===1)this.addUserAPI(e.id,e.data);else if(e.path.length===1&&e.type===2)this.deleteUserAPI(e.id);else if(typeof e.path[1]=="string"){let s=t.userAPIs[e.path[1]];s&&((r=this.getUserAPI(e.path[1]))==null||r.update(s,this))}}else if(e.path[0]==="userWebhooks"){if(e.path.length===1&&e.type===1)this.addUserWebhook(e.id,e.data);else if(e.path.length===1&&e.type===2)this.deleteUserWebhook(e.id);else if(typeof e.path[1]=="string"){let s=t.userWebhooks[e.path[1]];s&&((n=this.getUserWebhook(e.path[1]))==null||n.update(s))}}else e.path[0]==="lib"&&this.updateLibByOp(rs.drop(e,1),i)}updateFont(e,t,i){if(t.props.url){let r=this.getFont(e),n={...this.data.fonts[e],url:t.props.url};r.update(n),r.loadingPromise.then(()=>this.requestRender()),i.updateFont(e,this)}}addUserAPI(e,t){return this.userAPIs[e]?(this.userAPIs[e].update(t,this),!0):(this.userAPIs[e]=new cAe(e,t,this),!1)}getUserAPI(e){return this.userAPIs[e]}getUserAPIs(){return this.userAPIs}deleteUserAPI(e){let t=this.userAPIs[e];t&&(t.dispose(),delete this.userAPIs[e])}addUserWebhook(e,t){return this.userWebhooks[e]?(this.userWebhooks[e].update(t),!0):(this.userWebhooks[e]=new yAe(e,t),!1)}getUserWebhook(e){return this.userWebhooks[e]}getUserWebhooks(){return this.userWebhooks}deleteUserWebhook(e){let t=this.userWebhooks[e];t&&(t.dispose(),delete this.userWebhooks[e])}};new vk(Fo.emptyData());var N0=class extends wa{updateByPatchedOp(e,t,i){if(super.updateByPatchedOp(e,t,i),Kwe(e.path,["materials"])!==null&&e.type===0&&Array.isArray(this.material))for(let[r,n]of Object.entries(e.props)){let s=i.shared.material(n);this.material[Number(r)]=s}else if(hr(e.path,["material"])&&this.material instanceof Yd)"material"in t&&typeof t.material!="string"&&this.material.updateByOp(rs.drop(e,1),t.material,i);else if(hr(e.path,["materials","*"])&&Array.isArray(this.material)){let r=e.path[1];if("materials"in t&&r<this.material.length){let n=t.materials[r];typeof n!="string"&&this.material[r].updateByOp(rs.drop(e,2),n,i)}}}get needsAO(){return this.material!==void 0?(Array.isArray(this.material)?this.material[0]:this.material).hasAO:!1}updateState(e,t){var r,n;super.updateState(e,t),e.castShadow!==void 0&&(this.castShadow=e.castShadow),e.receiveShadow!==void 0&&(this.receiveShadow=e.receiveShadow);let i=this.dataPatched;if(((r=e.geometry)==null?void 0:r.type)!=="NonParametricGeometry"&&"material"in e&&e.material!==void 0&&(this.disposeMaterial(),this.material=t.shared.material(e.material).getFlavor(i.flatShading,i.side,i.wireframe),t.scene.markNeedsUpdateRendererDirty()),(((n=e.geometry)==null?void 0:n.type)==="NonParametricGeometry"||"materials"in e)&&("materials"in e&&e.materials!==void 0?(this.disposeMaterial(),this.material=e.materials.map(s=>t.shared.material(s).getFlavor(i.flatShading,i.side,i.wireframe)),t.scene.markNeedsUpdateRendererDirty()):"material"in e&&e.material!==void 0&&(this.disposeMaterial(),this.material=[t.shared.material(e.material).getFlavor(i.flatShading,i.side,i.wireframe)],t.scene.markNeedsUpdateRendererDirty())),e.flatShading!==void 0||e.wireframe!==void 0||e.side!==void 0)if(Array.isArray(this.material))for(let s=0;s<this.material.length;s++)this.material[s]=this.material[s].getFlavor(i.flatShading,i.side,i.wireframe);else this.material=this.material.getFlavor(i.flatShading,i.side,i.wireframe)}disposeMaterial(){this.material&&YQ(this.material).forEach(e=>{e instanceof Yd&&(e instanceof tz||e.nodeMaterialDispose())})}dispose(){this.disposeMaterial(),super.dispose()}},sj=new B,aj=new ti,oj=new ti,wAe=new B,lj=new ht,qs=class extends N0{constructor(e,t,i){super(e,t),this.data=t,this.isSkinnedMesh=!1,this.localGeometry=void 0,t.bindMode&&t.bindMatrix&&(this.bindMode=t.bindMode,this.bindMatrix=new ht().fromArray(t.bindMatrix),this.bindMatrixInverse=new ht)}chooseGeoemtryCache(e){return e.geometryCache}markGeometryAsReachable(e){this.geometryCreateDeleyed instanceof Bt&&this.chooseGeoemtryCache(e).markAsReachable(this.dataPatched.geometry,this.geometryCreateDeleyed)}get geometry(){if(this.localGeometry!==void 0)return this.localGeometry;if(this.geometryCreateDeleyed instanceof vk){let e=this.geometryCreateDeleyed,t=this.chooseGeoemtryCache(e);this.geometryCreateDeleyed=t.get(this.dataPatched.geometry,e,this)}return this.geometryCreateDeleyed}set geometry(e){this.localGeometry=e}get is2DAndNoDepth(){let e=this.dataPatched.geometry;return XA.is2DParametricMesh(e.type)&&e.depth===0}get is2DType(){return XA.is2DParametricMesh(this.geometry.userData.type)}get isNonParametric(){return this.geometry.userData.type==="NonParametricGeometry"}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),hr(e.path,["geometry"])&&this.updateByPatchedOpGeometry(rs.drop(e,1),t.geometry,i)}removeInteractionGeometry(e){var t;(t=this.localGeometry)==null||t.dispose(),this.localGeometry=void 0}updateGeometryInteractions(e,t){var r;this.invalidateDownstreamBooleanData();let i=this.data.geometry.type;if(i==="NonParametricGeometry"||i==="SubdivGeometry"){let n=e;if(this.localGeometry===void 0){let c={...this.data.geometry,...n};this.localGeometry=Z1(c,t,this.data.flatShading,this)}let s,a,o;n.scaleBaked?[s,a,o]=n.scaleBaked:{width:s,height:a,depth:o}=n;let l=this.localGeometry.userData;l.sxPrev!==void 0&&QO(this.localGeometry.attributes,s/l.sxPrev,a/l.syPrev,o/l.szPrev),l.sxPrev=s,l.syPrev=a,l.szPrev=o}else{let n={...this.data.geometry,...e};(r=this.localGeometry)==null||r.dispose(),this.localGeometry=Z1(n,t,this.data.flatShading,this)}}refreshAttachedClonersInteractions(){for(let e of this.attachedSurfaceCloners)e.update()}refreshAttachedCloners(e){for(let t of this.attachedSurfaceCloners)e.scene.addPendingUpdateCloner(t.object)}refreshAttachedPaths(e){for(let t of this.attachedPaths)e.scene.addPendingCommand(()=>t.updateShape())}createGeometryDelayed(e){this.geometryCreateDeleyed=e.shared,this.refreshAttachedCloners(e),this.refreshAttachedPaths(e)}updateByPatchedOpGeometry(e,t,i){var n;let r=!1;e.type===0&&e.path.length===0&&Object.keys(e.props).includes("scaleBaked")&&this.geometryCreateDeleyed instanceof ha&&this.chooseGeoemtryCache(i.shared).mutateIfUnique(this.geometryCreateDeleyed.data,t)===this.geometryCreateDeleyed&&(r=!0,this.geometryCreateDeleyed.mutateDirectlyScaleBaked(t,e.props.scaleBaked),this.refreshAttachedCloners(i),this.refreshAttachedPaths(i)),r||((n=i.scene)==null||n.markGeometryCacheDirty(),this.createGeometryDelayed(i)),this.resetBBoxNeedsUpdate(),this.invalidateDownstreamBooleanData()}updateGeometryOnStateUpdate(e,t){this.createGeometryDelayed(t)}updateState(e,t){e.geometry!==void 0&&this.updateGeometryOnStateUpdate(e.geometry,t),super.updateState(e,t)}updateGeometryGroupsIfNeeded(){var e;Array.isArray(this.material)&&this.geometry.groups.length===0&&this.geometry.addGroup(0,Math.max(((e=this.geometry.getIndex())==null?void 0:e.count)??0,this.geometry.getAttribute("position").count),0)}updateEntityBoxSize(e,t){let i=this.geometry.userData.parameters;this.is2DType?e.set(0,0,i.depth*.5):this.isNonParametric?(e.setScalar(0),this.geometry.boundingSphere&&e.copy(this.geometry.boundingSphere.center),t.set(i.width,i.height,i.depth??0).multiplyScalar(.5)):e.setScalar(0),t.set(i.width,i.height,i.depth??0).multiplyScalar(.5)}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"&&this.bindMatrixInverse.copy(this.bindMatrix).invert()}bind(e,t){this.skeleton=e,this.isSkinnedMesh=!0,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(e){let t=new ti,i=this.geometry.attributes.skinWeight;for(let r=0,n=i.count;r<n;r++){t.fromBufferAttribute(i,r);let s=1/t.manhattanLength();s!==1/0?t.multiplyScalar(s):t.set(1,0,0,0),i.setXYZW(r,t.x,t.y,t.z,t.w)}}boneTransform(e,t){let i=this.skeleton;if(i===void 0)return;let r=this.geometry;aj.fromBufferAttribute(r.attributes.skinIndex,e),oj.fromBufferAttribute(r.attributes.skinWeight,e),sj.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let n=0;n<4;n++){let s=oj.getComponent(n);if(s!==0){let a=aj.getComponent(n);lj.multiplyMatrices(i.bones[a].matrixWorld,i.boneInverses[a]),t.addScaledVector(wAe.copy(sj).applyMatrix4(lj),s)}}return t.applyMatrix4(this.bindMatrixInverse)}};function bAe(e){var a,o;if(e.geometry.attributes.extrudeNormal||!e.geometry.attributes.position||!e.geometry.attributes.normal)return;let t=new Map,i=e.geometry.attributes,r=i.position.array,n=i.normal.array,s=new Float32Array(r.length);for(let l=0;l<r.length;l+=3){let c=`${r[l]}_${r[l+1]}_${r[l+2]}`,u=new B(n[l],n[l+1],n[l+2]);t.has(c)?(a=t.get(c))==null||a.normals.push(u):t.set(c,{normals:[u],result:new B})}t.forEach((l,c)=>{for(let u of l.normals)l.result.add(u);l.result.divideScalar(l.normals.length)});for(let l=0;l<r.length;l+=3){let c=`${r[l]}_${r[l+1]}_${r[l+2]}`,u=(o=t.get(c))==null?void 0:o.result;u&&(s[l]=u.x,s[l+1]=u.y,s[l+2]=u.z)}e.geometry.setAttribute("extrudeNormal",new St(s,3))}function _Ae(e){if(e.geometry.attributes.extrudeNormals||!e.geometry.attributes.position)return;let t=e.geometry.attributes.position.array,i=new Float32Array(t.length),r=new B;for(let n=0;n<t.length;n+=3)r.set(t[n],t[n+1],t[n+2]).normalize(),i[n]=r.x,i[n+1]=r.y,i[n+2]=r.z;e.geometry.setAttribute("extrudeNormal",new St(i,3))}function yk(e){if(Array.isArray(e.material)){for(let t of e.material)if(t.getLayersOfType("outline").length===0)return}else if(!(e.material instanceof Yd)||e.material.getLayersOfType("outline").length===0)return;e instanceof qs&&e.is2DAndNoDepth?_Ae(e):bAe(e)}function xk(e){if(!e.geometry.attributes.position)return;let t=e.geometry.attributes.position.array,i=new Float32Array(t.length),r=parseInt(e.uuid.replace(/\D/g,"")),n=[Et.seededRandom(r),Et.seededRandom(r+1e4),Et.seededRandom(r+2e4)];for(let s=0;s<t.length;s++)i[s]=n[s%3];e.geometry.setAttribute("randomColor",new $t(i,3))}var uc=new cn,Uy=new B;function SAe(e){let t=!1;return e.scene.objects.traverse((i,r)=>{r.type==="Mesh"&&r.geometry.type==="SubdivGeometry"&&(t=!0)}),t}var $1=class extends qs{constructor(e,t,i){super(e,t,i),this.data=t,this.hiddenMatrixOld=new ht,this.smoothShading=!0,this.skipReactionUpdate=!1}chooseGeoemtryCache(e){return this.dataPatched.flatShading?e.geometryCache:e.geometryCache2}get subdivPointerNew(){return this.localGeometry!==void 0?this.subdivPointer:this.geometry.ensureSubdivPointer()}get originalGeometryNew(){return this.localGeometry!==void 0?this.originalGeometry:this.geometry.originalGeometry}get phongAngle(){return this.data.geometry.phongAngle??45}updateEntityBoxSize(e,t){let i=this.geometry.userData.parameters;e.copy(this.originalGeometryNew.boundingSphere.center),t.set(i.width,i.height,i.depth??0).multiplyScalar(.5)}createGeometryByControls(e){var s,a,o;if(this.skipReactionUpdate===!0)return;let t=(s=this.localGeometry)==null?void 0:s.uuid,{originalGeometry:i,subdividedGeometry:r,subdivPointer:n}=ha.build(e,this.subdivPointer,this.smoothShading,this.hasNonUniformScale?this.shearScale:void 0);this.subdivPointer=n,i!==void 0&&((a=this.originalGeometry)==null||a.dispose(),this.originalGeometry=i),r!==void 0&&((o=this.subdividedGeometry)==null||o.dispose(),this.subdividedGeometry=r??void 0),this.localGeometry=this.subdividedGeometry??this.originalGeometry,yk(this),xk(this),this.calcBoundingBox(),t&&(this.localGeometry.uuid=t)}updateState(e,t){if(super.updateState(e,t),e.flatShading!==void 0){let i=this.material;this.material=Array.isArray(i)?i.map(r=>r.getFlavor(!1,r.side,r.wireframe)):i.getFlavor(!1,i.side,i.wireframe),this.smoothShading=!e.flatShading,this.createGeometryDelayed(t)}}updateMesh(e=!1){ha.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1,this.originalGeometry,e&&this.hasNonUniformScale?this.shearScaleInv:void 0),this.subdividedGeometry&&ha.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1,this.subdividedGeometry,e&&this.hasNonUniformScale?this.shearScaleInv:void 0)}updateTopology(){this.originalGeometry.dispose(),this.originalGeometry=ha.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1),this.subdividedGeometry&&(this.subdividedGeometry.dispose(),this.subdividedGeometry=ha.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1)),this.localGeometry=this.subdividedGeometry??this.originalGeometry}raycast(e,t){let i=this.localGeometry;this.localGeometry=this.originalGeometryNew,wa.prototype.raycast.call(this,e,t),this.localGeometry=i}activateSVDCompensation(){!this.hasNonUniformScale||(this.matrix.copy(this.matrixWorldRigid),this.hiddenMatrixOld.copy(this.hiddenMatrix),this.hiddenMatrix.copy(this.parent.matrixWorld).invert())}deactivateSVDCompensation(){!this.hasNonUniformScale||(this.updateMatrix(),this.hasNonUniformScale=void 0,this.hiddenMatrix.copy(this.hiddenMatrixOld))}calcBoundingBox(){let e=this.originalGeometry;e.boundingSphere===null&&(e.boundingSphere=new ja,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=e.boundingSphere));let t=e.attributes.position,i=e.boundingSphere.center;uc.setFromBufferAttribute(t),uc.getCenter(i),e.boundingSphere.radius=i.distanceTo(uc.max),isNaN(e.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),uc.getSize(Uy),this.hasNonUniformScale&&Uy.divide(this.scale);let r={width:Uy.x,height:Uy.y,depth:Uy.z};return this.geometry.userData.parameters=r,r}updateBoundingSphere(e){let t=this.originalGeometry;uc.min.set(e[0],e[2],e[4]),uc.max.set(e[1],e[3],e[5]),this.hasNonUniformScale&&(uc.min.applyMatrix4(this.shearScaleInv),uc.max.applyMatrix4(this.shearScaleInv)),t.boundingSphere===null&&(t.boundingSphere=new ja);let i=t.boundingSphere.center;uc.getCenter(i),t.boundingSphere.radius=i.distanceTo(uc.max)}freeSubdivPointer(){var e,t;this.subdivPointer&&(ha.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0),this.localGeometry=void 0,(e=this.originalGeometry)==null||e.dispose(),(t=this.subdividedGeometry)==null||t.dispose()}dispose(){super.dispose(),this.freeSubdivPointer()}updateByPatchedOpGeometry(e,t,i){super.updateByPatchedOpGeometry(e,t,i),this.localGeometry&&this.createGeometryByControls(t)}},cj=-1,MAe=1,EAe={x:[1,0,0],"-x":[-1,0,0],y:[0,1,0],"-y":[0,-1,0],z:[0,0,1],"-z":[0,0,-1]},AAe={polygon_center:0,edge:1,vertex:2},CS=(e,t)=>(i,r)=>!t||i===0||e===0?0:e*r/100,ui=(e,t)=>{let i=Math.abs(t),r=i*-1;return(e-cj)*(i-r)/(MAe-cj)+r};function CAe(e){let t=[],i={};for(var r=0,n=e.length;r<n;r++){var s=JSON.stringify(e[r].pos.map(a=>Math.round(a*1e4)/1e4));i[s]||(t.push(e[r]),i[s]=!0)}return t}var TAe=new B,TS=new B,PAe=new B,DAe=new B;function Dv(e,t){let i=PAe.fromArray(e),r=DAe.fromArray(t);TS.copy(r).sub(i);let n=TS.length();return TS.normalize().multiplyScalar(n*.5),TAe.copy(i).add(TS).toArray()}var jo=new ws,PS=new B,oC=new B,$p=new B;function RAe(e){let t=[];for(let i=0;i<=e.index.count;i++)if(PS.fromArray(e.index.array,i*3),jo.setFromAttributeAndIndices(e.attributes.position,PS.x,PS.y,PS.z),jo.getNormal(oC),jo.getMidpoint($p),!(isNaN($p.x)||isNaN($p.y)||isNaN($p.z))){let{a:r,b:n,c:s}=jo,a=r.toArray(),o=n.toArray(),l=s.toArray(),c=r.distanceTo(n),u=n.distanceTo(s),h=s.distanceTo(r),d=Dv(a,o),p=Dv(o,l),f=Dv(l,a),v=[c,u,h],g=Math.max(...v),m=v.filter(_=>Math.round(_)===Math.round(g)).length>1,x=[],w=jo.getMidpoint($p).toArray();g===c&&!m&&(x=[p,f,f],w=d),g===u&&!m&&(x=[d,f,f],w=p),g===h&&!m&&(x=[d,p,p],w=f),m&&(x=[d,p,f]),t.push({vertices:[a,o,l],faceCenters:x,midpoint:w,norm:jo.getNormal(oC).toArray()})}return t}function IAe(e){let t=[],{position:i}=e.attributes;for(let r=0;r<i.count;r++){jo.setFromAttributeAndIndices(i,r*3,r*3+1,r*3+2),jo.getNormal(oC),jo.getMidpoint($p);let n=jo.a.toArray(),s=jo.b.toArray(),a=jo.c.toArray();t.push({vertices:[n,s,a],faceCenters:[Dv(n,s),Dv(s,a),Dv(a,n)],midpoint:$p.toArray(),norm:oC.toArray()})}return t}var LAe=4,OAe=.5,V3=e=>.5*(1-Math.cos(e*Math.PI)),zAe=class{constructor(){this.perlin=new Array(4096)}noise(e,t=0,i=0){if(this.perlin==null){this.perlin=new Array(4096);for(let g=0;g<4096;g++)this.perlin[g]=Math.random()}e<0&&(e=-e),t<0&&(t=-t),i<0&&(i=-i);let r=Math.floor(e),n=Math.floor(t),s=Math.floor(i),a=e-r,o=t-n,l=i-s,c,u,h=0,d=.5,p,f,v;for(let g=0;g<LAe;g++){let m=r+(n<<4)+(s<<8);c=V3(a),u=V3(o),p=this.perlin[m&4095],p+=c*(this.perlin[m+1&4095]-p),f=this.perlin[m+16&4095],f+=c*(this.perlin[m+16+1&4095]-f),p+=u*(f-p),m+=256,f=this.perlin[m&4095],f+=c*(this.perlin[m+1&4095]-f),v=this.perlin[m+16&4095],v+=c*(this.perlin[m+16+1&4095]-v),f+=u*(v-f),p+=V3(l)*(f-p),h+=p*d,d*=OAe,r<<=1,a*=2,n<<=1,o*=2,s<<=1,l*=2,a>=1&&(r++,a--),o>=1&&(n++,o--),l>=1&&(s++,l--)}return h}noiseSeed(e){let t=(()=>{let i,r;return{setSeed(n){r=i=(n??Math.random()*4294967296)>>>0},getSeed(){return i},rand(){return r=(1664525*r+1013904223)%4294967296,r/4294967296}}})();t.setSeed(e),this.perlin=new Array(4096);for(let i=0;i<4096;i++)this.perlin[i]=t.rand()}},NAe=zAe,uj=new B,hj=new ht,dj=new _0;function pj(e){let t=!1;return e.scene.objects.traverse((i,r)=>{r.type==="Mesh"&&r.geometry.type==="TextGeometry"&&(t=!0)}),t}var wk=class extends qs{constructor(e,t,i){super(e,t,i),this.data=t}get textGeometry(){return this.geometry}get charWidths(){return this.textGeometry.charWidths}get charCoords(){return this.textGeometry.charCoords}get wrappedText(){return this.textGeometry.wrappedText}get font(){return this.textGeometry.font}get initialOffsetY(){var t;let e=this.dataPatched;return((t=this.font)==null?void 0:t.getLineInitialOffsetY(this.lineHeight,this.wrappedText.length,e.geometry.height,this.fontScale,e.geometry.verticalAlign))??0}get fontScale(){let e=this.dataPatched;return this.font?e.geometry.fontSize/this.font.unitsPerEm:1}get AD(){return Math.abs(this.ascender-this.descender)}get ascender(){var e;return(((e=this.font)==null?void 0:e.ascender)??1)*this.fontScale}get descender(){var e;return(((e=this.font)==null?void 0:e.descender)??1)*this.fontScale}get lineHeight(){let e=this.dataPatched;return e.geometry.fontSize*e.geometry.lineHeight}raycast(e,t){let{matrixWorld:i}=this;if(!(isNaN(e.ray.origin.x)||this.scale.x===0||this.scale.y===0||this.scale.z===0)&&(hj.copy(i).invert(),dj.copy(e.ray).applyMatrix4(hj),dj.intersectBox(this.singleBBox,uj))){let r=uj.applyMatrix4(i),n=e.ray.origin.distanceTo(r);t.push({distance:n,point:r.clone(),object:this})}}},sa=1e-4,hc,ZZ,$Z,JZ,fj=new B,mj=new B;oZ.then(e=>{hc=e,ZZ=[hc.get_face_center,hc.get_edge_midpoint,hc.get_vertex_position],$Z=[hc.get_face_normal,hc.get_edge_normal,hc.get_vertex_normal],JZ=[hc.face_count,hc.edge_count,hc.vertex_count]});var BAe=new ht,kAe=new ht,Gh=new B,DS=new B,Fy=new B,H3=new B,UAe=new B,FAe=new B,fu=new NAe,Ll=class extends ek(ir){constructor(e,t){super(),this.parameters=t,this.objectForSample=void 0,this._pendingMediaLoad=!1,this.object=e}resetOnMove(){this.removeFromParent(),this.parent=null}expandClones(e){if(this.parent===null)this.updateState(this.parameters,e);else for(let t of this.children)t instanceof Xs&&t.expand()}invalidateTransform(e){this.matrixWorldNeedsUpdate=!0,this.traverse(t=>{t instanceof Xs&&t.object===e&&(t.matrixWorldNeedsUpdate=!0)})}onObjUpdateMatrix(){this.parameters.type!=="toObject"&&(this.matrixWorldNeedsUpdate=!0)}update(){switch(this._updateCount(),this.parameters.type){case"radial":this._updateRadial(this.parameters);break;case"linear":this._updateLinear(this.parameters);break;case"grid":this._updateGrid(this.parameters);break;case"toObject":this._updateToObject(this.parameters)}for(let e of this.children)e.updateMatrix(),e.hasNonUniformScale&&(e.updateMatrixWorld(),e.updateMatrixWorldSVD())}_updateCount(e){let t;if(e!==void 0?t=e:t=this.parameters.type==="grid"?Math.round(this.parameters.grid.count[0])*Math.round(this.parameters.grid.count[1])*Math.round(this.parameters.grid.count[2]):this.parameters.count,this.parameters.type==="toObject"&&!this.parameters.toObject.object&&(t=0),this.parameters.type==="toObject"&&this.objectForSample){for(let r=0,n=this.children.length;r<n;++r)this.remove(this.children[0]);let i=this.children;if(i.length===t)return;if(i.length<t)for(let r=0,n=t-i.length;r<n;++r){let s=new Xs(this.object);s.expand(),this.add(s)}else for(let r=0,n=i.length-t;r<n;++r)this.remove(i[r])}else{if(this.children.length===t)return;if(this.children.length<t)for(let i=0,r=t-this.children.length;i<r;++i){let n=new Xs(this.object);n.expand(),this.add(n)}else for(let i=0,r=this.children.length-t;i<r;++i)this.remove(this.children[0])}}_updateRadial(e){let t=e.radial,i=t.start*Et.DEG2RAD,r=t.end*Et.DEG2RAD,n=i-r,s=new Nn(t.rotation[0],t.rotation[1],t.rotation[2]),a;switch(t.axis){case"z":a=new B(0,0,1);break;case"y":a=new B(0,1,0);break;default:case"x":a=new B(1,0,0);break}let o=e.randomnessObject??Sd.defaultData([1,1,1]).randomnessObject,l=o.noiseType==="perlin";fu.noiseSeed(o.seed);let c=w3((0,Oy.default)(o.seed)),u=CS(o.strength,this.parameters.randomness);for(let[h,d]of this.children.entries()){let p=h*(o.freqScale/10)+o.movement,f=l?fu.noise(p):c(p,p),v=h+1;d.scale.x=t.scale[0]+u(v,ui(f,o.scale[0]))||sa,d.scale.y=t.scale[1]+u(v,ui(f,o.scale[1]))||sa,d.scale.z=t.scale[2]+u(v,ui(f,o.scale[2]))||sa,d.position.setScalar(0);let g=n/e.count*h-i;switch(t.axis){case"x":d.rotation.set(0,g,0);break;case"y":d.rotation.set(0,0,g);break;case"z":d.rotation.set(g,0,0);break}d.translateOnAxis(a,t.radius),d.position.x+=t.position[0]+u(v,ui(f,o.position[0])),d.position.y+=t.position[1]+u(v,ui(f,o.position[1])),d.position.z+=t.position[2]+u(v,ui(f,o.position[2]));let m=u(v,ui(f,o.rotation[0])),x=u(v,ui(f,o.rotation[1])),w=u(v,ui(f,o.rotation[2]));t.alignment===!0?(d.rotation.x+=s.x+m,d.rotation.y+=s.y+x,d.rotation.z+=s.z+w):d.rotation.set(s.x+m,s.y+x,s.z+w)}}_updateLinear(e){if(e.type!=="linear")throw new Error;let t=e.linear,i=new Nn(t.rotation[0],t.rotation[1],t.rotation[2]),r=e.randomnessObject??Sd.defaultData([1,1,1]).randomnessObject,n=r.noiseType==="perlin";fu.noiseSeed(r.seed);let s=w3((0,Oy.default)(r.seed)),a=CS(r.strength,this.parameters.randomness);for(let[o,l]of this.children.entries()){let c=o*(r.freqScale/10)+r.movement,u=n?fu.noise(c):s(c,c),h=o+1,d=a(h,ui(u,r.rotation[0])),p=a(h,ui(u,r.rotation[1])),f=a(h,ui(u,r.rotation[2]));l.scale.x=1+(t.scale[0]-1)*o+a(h,ui(u,r.scale[0]))||sa,l.scale.y=1+(t.scale[1]-1)*o+a(h,ui(u,r.scale[1]))||sa,l.scale.z=1+(t.scale[2]-1)*o+a(h,ui(u,r.scale[2]))||sa,l.rotation.x=i.x*o+d,l.rotation.y=i.y*o+p,l.rotation.z=i.z*o+f,l.position.x=t.position[0]*o+a(h,ui(u,r.position[0])),l.position.y=t.position[1]*o+a(h,ui(u,r.position[1])),l.position.z=t.position[2]*o+a(h,ui(u,r.position[2]))}}_updateGrid(e){let t=0,i=e.grid,r=e.randomnessObject??Sd.defaultData([1,1,1]).randomnessObject,n=CS(r.strength,this.parameters.randomness),s=r.noiseType==="perlin";fu.noiseSeed(r.seed);let a=I_e((0,Oy.default)(r.seed));if(i.useCenter===!0){let o={x:i.count[0]%2===0?2:1,y:i.count[1]%2===0?2:1,z:i.count[2]%2===0?2:1},l=new B(i.size[0]*(i.count[0]-o.x)*.5,i.size[1]*(i.count[1]-o.y)*.5,i.size[2]*(i.count[2]-o.z)*.5);for(let c=0;c<i.count[0];c++)for(let u=0;u<i.count[1];u++)for(let h=0;h<i.count[2];h++){let d=[(c+1)*(r.freqScale/10)+r.movement,(u+1)*(r.freqScale/10)+r.movement,(h+1)*(r.freqScale/10)+r.movement],p=s?fu.noise(...d):a(...d),f=this.children[t++];f.scale.x=1+n(t,ui(p,r.scale[0]))||sa,f.scale.y=1+n(t,ui(p,r.scale[1]))||sa,f.scale.z=1+n(t,ui(p,r.scale[2]))||sa;let v=n(t,ui(p,r.rotation[0])),g=n(t,ui(p,r.rotation[1])),m=n(t,ui(p,r.rotation[2]));f.rotation.set(v,g,m),f.position.x=i.size[0]*c-l.x+n(t,ui(p,r.position[0])),f.position.y=i.size[1]*u-l.y+n(t,ui(p,r.position[1])),f.position.z=i.size[2]*h-l.z+n(t,ui(p,r.position[2]))}}else for(let o=0;o<i.count[0];o++)for(let l=0;l<i.count[1];l++)for(let c=0;c<i.count[2];c++){let u=[(o+1)*(r.freqScale/10)+r.movement,(l+1)*(r.freqScale/10)+r.movement,(c+1)*(r.freqScale/10)+r.movement],h=s?fu.noise(...u):a(...u),d=this.children[t++];d.scale.x=1+n(t,ui(h,r.scale[0]))||sa,d.scale.y=1+n(t,ui(h,r.scale[1]))||sa,d.scale.z=1+n(t,ui(h,r.scale[2]))||sa;let p=n(t,ui(h,r.rotation[0])),f=n(t,ui(h,r.rotation[1])),v=n(t,ui(h,r.rotation[2]));d.rotation.set(p,f,v),d.position.x=i.size[0]*o+n(t,ui(h,r.position[0])),d.position.y=-i.size[1]*l+n(t,ui(h,r.position[1])),d.position.z=-i.size[2]*c+n(t,ui(h,r.position[2]))}}_updateToObject(e){var v;if(e.type!=="toObject")throw new Error;let{toObject:t}=e,i=new Nn(t.rotation[0],t.rotation[1],t.rotation[2]),r=e.randomnessObject??Sd.defaultData([1,1,1]).randomnessObject,n=r.noiseType==="perlin";fu.noiseSeed(r.seed);let s=w3((0,Oy.default)(r.seed)),a=CS(r.strength,this.parameters.randomness);if(!t.object){for(let[,g]of this.children.entries())g.position.set(0,0,0),g.scale.setScalar(1),g.rotation.set(0,0,0);this.objectForSample=void 0;return}if(!this.objectForSample)return;if(this.objectForSample instanceof wk)if(!((v=this.objectForSample.font)!=null&&v.isLoaded)||this.objectForSample.geometry.attributes.position===void 0){this._pendingMediaLoad=!0;return}else this._pendingMediaLoad=!1;if(this.objectForSample.geometry===void 0&&this.objectForSample.isAncestorOf(this.object.uuid)){console.warn(`Oh no! The object "${this.object.name}" (${this.object.uuid}) seem to be a child/descendant of the object it's being cloned to. Please re-parent it so that they are siblings instead.`);return}let o=this.getSubdivData(),l=[],c=g=>{let m=g.length,x=g.map(M=>M[0]).reduce((M,S)=>M+S,0),w=g.map(M=>M[1]).reduce((M,S)=>M+S,0),_=g.map(M=>M[2]).reduce((M,S)=>M+S,0);return[x/m,w/m,_/m]},u=g=>Math.round(g*1e6)/1e6;o.forEach(g=>{let m=o.filter(x=>u(g.pos[0])===u(x.pos[0])&&u(g.pos[1])===u(x.pos[1])&&u(g.pos[2])===u(x.pos[2]));m.length>1?l.push({pos:g.pos,norm:c(m.map(x=>x.norm))}):l.push(g)});let h=CAe(l);if(h.length>0){let g=Math.round(h.length*t.count/100);this._updateCount(g)}else{let g=this.objectForSample.geometry.getAttribute("position");if(!g||isNaN(g.count)||g.count===0){console.warn(`Oh no! The object "${this.object.name}" (${this.object.uuid}) cannot be cloned on the surface of "${this.objectForSample.name}" (${this.objectForSample.uuid}) because the latter does not have a valid geometry.`);return}}this.objectForSample.updateMatrixWorld();let d=new L_e(this.objectForSample).build(),p=EAe[t.axis],f=this.children;d.setRandomGenerator((0,Oy.default)(this.object.uuid+t.seed));for(let[g,m]of f.entries()){let x=g*(r.freqScale/10)+r.movement,w=n?fu.noise(x):s(x,x),_=g+1,M=a(_,ui(w,r.rotation[0])),S=a(_,ui(w,r.rotation[1])),A=a(_,ui(w,r.rotation[2]));t.spreadType==="random"?d.sample(Fy,H3):(h.length&&(Fy.fromArray(h[g].pos),H3.fromArray(h[g].norm)),this.objectForSample instanceof $1&&Fy.applyMatrix4(BAe.copy(this.objectForSample.matrixWorld).invert())),Fy.applyMatrix4(this.object.hiddenMatrix.clone().invert()),m.position.copy(Fy),Gh.fromArray(p);let T=t.align==="normal"?H3:this.object.getWorldDirection(FAe),E=DS.fromArray(t.position);DS.x+=a(_,ui(w,r.position[0])),DS.y+=a(_,ui(w,r.position[1])),DS.z+=a(_,ui(w,r.position[2]));let C=Math.acos(T.dot(Gh)),D=UAe.crossVectors(Gh,T).normalize(),I=kAe.makeRotationAxis(D,C),L=T.clone().cross(this.object.up).normalize(),z=L.clone().cross(T).normalize(),F=new ht().makeBasis(L,T,z),Q=new B(Gh.y,Gh.z,Gh.x).normalize(),Y=Q.clone().cross(Gh).normalize(),O=new ht().makeBasis(Q,Gh,Y).invert(),j=new ht().multiplyMatrices(F,O);m.rotation.setFromRotationMatrix(j),E.applyMatrix4(I),m.position.add(E),m.rotation.x=m.rotation.x+i.x+M,m.rotation.y=m.rotation.y+i.y+S,m.rotation.z=m.rotation.z+i.z+A,m.scale.setScalar(1),m.scale.x=m.scale.x+t.scale[0]+a(_,ui(w,r.scale[0]))||sa,m.scale.y=m.scale.y+t.scale[1]+a(_,ui(w,r.scale[1]))||sa,m.scale.z=m.scale.z+t.scale[2]+a(_,ui(w,r.scale[2]))||sa,m.scale.multiply(this.object.scale),m.hiddenMatrix=this.object.hiddenMatrix}}getSubdivData(){if(!this.objectForSample)return[];let e=this.parameters.toObject.spreadType;if(e==="random")return[];if(this.objectForSample instanceof $1){let t=this.objectForSample,i=AAe[e],r=JZ[i],n=ZZ[i],s=$Z[i],a=[],o=r(t.subdivPointerNew);for(let l=0;l<=o-1;l++){let c=n(t.subdivPointerNew,l),u=s(t.subdivPointerNew,l);fj.fromArray(c).applyMatrix4(t.matrixWorld),mj.fromArray(u),a.push({pos:fj.toArray(),norm:mj.toArray()})}return a}else return(this.objectForSample.geometry.index?RAe(this.objectForSample.geometry):IAe(this.objectForSample.geometry)).map((t,i)=>e==="polygon_center"?{pos:t.midpoint,norm:t.norm}:e==="vertex"?[{pos:t.vertices[0],norm:t.norm},{pos:t.vertices[1],norm:t.norm},{pos:t.vertices[2],norm:t.norm}]:e==="edge"?[{pos:t.faceCenters[0],norm:t.norm},{pos:t.faceCenters[1],norm:t.norm},{pos:t.faceCenters[2],norm:t.norm}]:[]).flat()}updateState(e,t){var i;if(this.parameters=IT(e),this.parameters.type!=="toObject")(this.parent===null||this.parent!==this.object)&&(this.removeFromParent(),(i=this.object.parent)==null||i.add(this),this.matrix=this.object.matrix,this.hiddenMatrix=this.object.hiddenMatrix,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1);else if(this.parent===null||this.parent.uuid!==this.parameters.toObject.object){this.removeFromParent();let r=t.find(this.parameters.toObject.object);r instanceof wa?this.objectForSample=r:this.objectForSample=void 0,this.matrix=new ht,this.hiddenMatrix=new ht,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1,r&&r.add(this)}this.update()}get pendingMediaLoad(){return this._pendingMediaLoad}},jw=e=>{var t;return t=class extends e{},t.geometryHelper=new Hl(30,30,30),t},RS=new _0,G3=new ja,gj=new ht,Ww=(e,t,i,r,n=!1,s=e)=>{let a=t,o=s.matrixWorld;if(a.boundingSphere===null&&a.computeBoundingSphere(),G3.copy(a.boundingSphere),G3.applyMatrix4(o),i.ray.intersectsSphere(G3)===!1||(gj.copy(o).invert(),RS.copy(i.ray).applyMatrix4(gj),a.boundingBox!==null&&RS.intersectsBox(a.boundingBox)===!1))return;let l,c,u,h,d=a.index,p=a.attributes.position,f=a.drawRange,v,g;if(n===!1){let x=Math.max(0,f.start),w=Math.min(d.count,f.start+f.count);for(v=x,g=w;v<g;v+=3)if(c=d.getX(v),u=d.getX(v+1),h=d.getX(v+2),l=m(e,i,RS,p,c,u,h),l){l.faceIndex=Math.floor(v/3),r.push(l);return}}else{let x=a.attributes.position,w=new B,_=new B,M=new B,S=new B,A=2,T=1/((s.scale.x+s.scale.y+s.scale.z)/3),E=T*T,C=Math.max(0,f.start),D=Math.min(x.count,f.start+f.count);for(let I=C,L=D-1;I<L;I+=A){if(w.fromBufferAttribute(x,I),_.fromBufferAttribute(x,I+1),RS.distanceSqToSegment(w,_,S,M)>E)continue;S.applyMatrix4(s.matrixWorld);let z=i.ray.origin.distanceTo(S);z<i.near||z>i.far||r.push({distance:z,point:M.clone().applyMatrix4(s.matrixWorld),object:e})}}function m(x,w,_,M,S,A,T){let E=new B,C=new B,D=new B,I=new B,L=new B;if(E.fromBufferAttribute(M,S),C.fromBufferAttribute(M,A),D.fromBufferAttribute(M,T),_.intersectTriangle(E,C,D,!1,I)===null)return null;L.copy(I),L.applyMatrix4(x.matrixWorld);let z=w.ray.origin.distanceTo(L);return z<w.near||z>w.far?null:{faceIndex:1,distance:z,point:L.clone(),object:x}}},IS=new B,Lo=new tm,VAe=class extends zw{constructor(e){let t=new Bt,i=new rp({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],n=[],s={},a=new jt(15711266),o=new jt(15711266),l=new jt(2857471);c("n1","n2",a),c("n2","n4",a),c("n4","n3",a),c("n3","n1",a),c("f1","f2",a),c("f2","f4",a),c("f4","f3",a),c("f3","f1",a),c("n1","f1",a),c("n2","f2",a),c("n3","f3",a),c("n4","f4",a),c("p","n1",o),c("p","n2",o),c("p","n3",o),c("p","n4",o),c("u1","u2",l),c("u2","u3",l),c("u3","u1",l);function c(h,d,p){u(h,p),u(d,p)}function u(h,d){r.push(0,0,0),n.push(d.r,d.g,d.b),s[h]===void 0&&(s[h]=[]),s[h].push(r.length/3-1)}t.setAttribute("position",new St(r,3)),t.setAttribute("color",new St(n,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update()}update(){let e=this.geometry,t=this.pointMap;Lo.projectionMatrixInverse.elements=[.5112609807824982,-0,-0,-0,-0,.41421356237309503,-0,-0,-0,-0,-0,-.099999,-0,-0,-1.0000000000000002,.100001];let i=1,r=1,n=.8;ml("n1",t,e,Lo,-i,-r,n),ml("n2",t,e,Lo,i,-r,n),ml("n3",t,e,Lo,-i,r,n),ml("n4",t,e,Lo,i,r,n);let s=n;ml("f1",t,e,Lo,-i,-r,s),ml("f2",t,e,Lo,i,-r,s),ml("f3",t,e,Lo,-i,r,s),ml("f4",t,e,Lo,i,r,s);let a=s,o=.5;ml("u1",t,e,Lo,i*.7*o,r*1.1,a),ml("u2",t,e,Lo,-i*.7*o,r*1.1,a),ml("u3",t,e,Lo,0,r*(1.1+.9*o),a),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function ml(e,t,i,r,n,s,a){IS.set(n,s,a).unproject(r);let o=t[e];if(o!==void 0){let l=i.getAttribute("position");for(let c=0,u=o.length;c<u;c++)l.setXYZ(o[c],IS.x,IS.y,IS.z)}}var HAe=class extends jw(VAe){constructor(e){super(e),this.object=e,this.object=e,this.name=`CombinedCameraHelper: ${e.uuid}`}updateMatrixWorld(e){super.updateMatrixWorld(e),this.updateTarget()}updateTarget(){let e=this.object.getTarget();this.updateWorldMatrix(!0,!1),this.worldToLocal(e)}raycast(e,t){Ww(this.object,this.geometry,e,t,!0)}},rz;(e=>e.is=t=>"objectHelper"in t)(rz||(rz={}));var B0=(e,t)=>class extends tk(e){constructor(){super(...arguments),this.objectHelper=new t(this),this.gizmos={}}get geometryHelper(){return t.geometryHelper}raycast(i,r){this.objectHelper.raycast(i,r)}showGizmos(){for(let i in this.gizmos){let r=this.gizmos[i];r instanceof CA&&(r.visible=!0)}}updateEntityBoxSize(i,r){this.objectHelper.visible&&this.geometryHelper instanceof Hl?(i.setScalar(0),r.set(this.geometryHelper.parameters.width,this.geometryHelper.parameters.height,this.geometryHelper.parameters.height).multiplyScalar(.5)):super.updateEntityBoxSize(i,r)}hideGizmos(){for(let i in this.gizmos){let r=this.gizmos[i];r instanceof CA&&(r.visible=!1)}}},LS=790,Km=new B,j3=new B,W3=new ei,X3=new B,Vy=new B,q3=new B,Qs=class extends B0(tm,HAe){constructor(e="",t={...G1.defaultData,name:""}){super(),this._cameraType="OrthographicCamera",this.targetOffset=$v.DefaultTargetOffset,this.isUpVectorFlipped=!1,this.angleOffsetFromUp=0,this.wasMovedByUser=!1,this.wasMovedBySwitchCameraAction=!1,this.super_Entity(e,t),this.previousProjectionMatrix=new ht,this.matrixAutoUpdate=!0,this.width=window.innerWidth,this.height=window.innerHeight;let i=this.width,r=this.height;this.orthoCamera=new _T(i*-.5,i*.5,r*.5,r*-.5,-5e4,1e4),this.perspCamera=new Gs(45,i/r,50,1e4),this.left=this.orthoCamera.left,this.right=this.orthoCamera.right,this.top=this.orthoCamera.top,this.bottom=this.orthoCamera.bottom,this.far=this.orthoCamera.far,this.view=this.orthoCamera.view,this.aspect=this.perspCamera.aspect,this.focus=this.perspCamera.focus,this.filmGauge=this.perspCamera.filmGauge,this.filmOffset=this.perspCamera.filmOffset,this.objectHelper.update()}get isPerspectiveCamera(){return this.cameraType==="PerspectiveCamera"}get isOrthographicCamera(){return!this.isPerspectiveCamera}get cameraType(){return this._cameraType}set fov(e){this.perspCamera.fov=e}get fov(){return this.perspCamera.fov}setNear(e,t){e==="PerspectiveCamera"?this.perspCamera.near=t:this.orthoCamera.near=t}setZoom(e,t){t>=0&&(e==="PerspectiveCamera"?this.perspCamera.zoom=t:this.orthoCamera.zoom=t)}set cameraType(e){e==="PerspectiveCamera"?this.toPerspective():e==="OrthographicCamera"&&this.toOrthographic()}get near(){return this._cameraType==="PerspectiveCamera"?this.perspCamera.near:this.orthoCamera.near}set near(e){this._cameraType==="PerspectiveCamera"?this.perspCamera.near=e:this.orthoCamera.near=e}get zoom(){return this._cameraType==="PerspectiveCamera"?this.perspCamera.zoom:this.orthoCamera.zoom}set zoom(e){e>=0&&(this._cameraType==="PerspectiveCamera"?this.perspCamera.zoom=e:this.orthoCamera.zoom=e)}lookAt(e,t,i){typeof e=="number"&&(e=new B(e,t,i)),super.lookAt(e),this.getWorldPosition(Km),this.targetOffset=Km.distanceTo(e)}getTarget(e=new B){return this.getWorldDirection(j3),this.getWorldPosition(Km),j3.multiplyScalar(this.targetOffset),e.copy(Km).add(j3),e}getDistanceToTarget(){let e=this.getTarget();return this.getWorldPosition(Km),Km.distanceTo(e)}updateUp(){this.getWorldQuaternion(W3),X3.set(0,0,1).applyQuaternion(W3),Vy.copy(ir.DEFAULT_UP),this.isUpVectorFlipped&&Vy.negate(),Vy.applyQuaternion(W3),q3.copy(ir.DEFAULT_UP).projectOnPlane(X3),this.angleOffsetFromUp=q3.angleTo(Vy),this.angleOffsetFromUp*=q3.cross(Vy).dot(X3)>=0?1:-1}updateTransformState(e,t){let i=super.updateTransformState(e,t);return e.isUpVectorFlipped!==void 0&&(this.isUpVectorFlipped=e.isUpVectorFlipped),this.updateUp(),i}getViewFrontToObject(e){let t=e.getWorldPosition(new B),i=e.getWorldDirection(new B).multiplyScalar(this.targetOffset);return{position:t.clone().add(i),target:t}}getViewToTarget(e){let t=this.getWorldDirection(new B).multiplyScalar(this.targetOffset);return{position:e.clone().sub(t),target:e}}getViewToObject(e){let t=new B;return e.getWorldPosition(t),this.getViewToTarget(t)}setViewplaneSize(e,t,i=!1){if(this.aspect=e/t,i){let r=e>t?this.aspect:1,n=e>t?1:this.aspect;this.left=-LS*.5*r,this.right=LS*.5*r,this.top=LS*.5*(1/n),this.bottom=-LS*.5*(1/n)}else this.left=-e*.5,this.right=e*.5,this.top=t*.5,this.bottom=-t*.5;this.updateProjectionMatrix()}copyViewPlaneSize(e){this.aspect=e.aspect,this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.updateProjectionMatrix()}toOrthographic(){this.orthoCamera.left=this.left,this.orthoCamera.right=this.right,this.orthoCamera.top=this.top,this.orthoCamera.bottom=this.bottom,this.orthoCamera.view=this.view,this.orthoCamera.far=this.far,this.orthoCamera.updateProjectionMatrix(),this.projectionMatrix=this.orthoCamera.projectionMatrix,this.projectionMatrixInverse=this.orthoCamera.projectionMatrixInverse,this._cameraType="OrthographicCamera",this.objectHelper&&this.objectHelper.update()}toPerspective(){this.perspCamera.aspect=this.aspect,this.perspCamera.fov=this.fov,this.perspCamera.view=this.view,this.perspCamera.far=this.far,this.perspCamera.updateProjectionMatrix(),this.projectionMatrix=this.perspCamera.projectionMatrix,this.projectionMatrixInverse=this.perspCamera.projectionMatrixInverse,this._cameraType="PerspectiveCamera",this.objectHelper&&this.objectHelper.update()}setFocalLength(e){this.perspCamera.setFocalLength(e),this.toPerspective()}getFocalLength(){return this.perspCamera.getFocalLength()}getEffectiveFOV(){return this.perspCamera.getEffectiveFOV()}getFilmWidth(){return this.perspCamera.getFilmWidth()}getFilmHeight(){return this.perspCamera.getFilmHeight()}setViewOffset(e,t,i,r,n,s){this._cameraType==="PerspectiveCamera"?this.perspCamera.setViewOffset(e,t,i,r,n,s):this.orthoCamera.setViewOffset(e,t,i,r,n,s)}clearViewOffset(){this._cameraType==="PerspectiveCamera"?(this.perspCamera.clearViewOffset(),this.toPerspective()):(this.orthoCamera.clearViewOffset(),this.toOrthographic())}copyHistory(){this.previousProjectionMatrix&&this.previousProjectionMatrix.copy(this.projectionMatrix)}updateProjectionMatrix(){this._cameraType==="PerspectiveCamera"?this.toPerspective():this._cameraType==="OrthographicCamera"&&this.toOrthographic()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}copy(e,t){return super.copy(e,t),this.parent=e.parent,this.orthoCamera.copy(e.orthoCamera),this.perspCamera.copy(e.perspCamera),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.far=e.far,this.view=e.view===null?null:Object.assign({},e.view),this._cameraType=e._cameraType,this.aspect=e.aspect,this.fov=e.fov,this.focus=e.focus,this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this.targetOffset=e.targetOffset,this.updateProjectionMatrix(),this}toCameraState(e=[]){let t={type:this.cameraType,far:this.far,orthographic:{near:this.orthoCamera.near,zoom:this.orthoCamera.zoom},perspective:{near:this.perspCamera.near,fov:this.perspCamera.fov,zoom:this.perspCamera.zoom},up:this.up.toArray(),targetOffset:this.targetOffset,isUpVectorFlipped:this.isUpVectorFlipped};return KL(t,e)}updateCameraSubtype(e,t){let i=e==="perspective"?"PerspectiveCamera":"OrthographicCamera";t.zoom!==void 0&&this.setZoom(i,t.zoom),t.near!==void 0&&this.setNear(i,t.near),t.fov!==void 0&&i==="PerspectiveCamera"&&(this.fov=t.fov)}updateState(e,t){this.updateCameraState(e,t)}updateCameraState(e,t){this.updateState_Entity(e,t),e.far!==void 0&&(this.far=e.far),e.orthographic!==void 0&&this.updateCameraSubtype("orthographic",e.orthographic),e.perspective!==void 0&&this.updateCameraSubtype("perspective",e.perspective),e.type!==void 0&&(this.cameraType=e.type),e.up!==void 0&&this.up.fromArray(e.up),e.targetOffset!==void 0&&(this.targetOffset=e.targetOffset),e.isUpVectorFlipped!==void 0&&(this.isUpVectorFlipped=e.isUpVectorFlipped),this.updateProjectionMatrix()}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),e.path.length===1&&e.type===0&&this.updateCameraSubtype(e.path[0],e.props)}toState(e){return{...super.toState(e),...this.toCameraState(e),type:this.cameraType}}},Zm=new ht,GAe=new ht;function vj(e){let t=!1;return e.scene.objects.traverse((i,r)=>{var n;((n=r.geometry)==null?void 0:n.type)==="BooleanGeometry"&&(t=!0)}),t}var qf=class extends N0{constructor(e,t,i){super(e,t),this.data=t,this.meshSetAddresses=[],this.needsTransformForDownstream=!1,this.geometry=new Bt,this.onAfterRender=(r,n,s,a,o,l)=>{super.onAfterRender(r,n,s,a,o,l),this.recomputeBoolean()},this.geometry.userData.parameters={width:0,height:0,depth:0}}get booleanOp(){return this.data.geometry.operation}get phongAngle(){return this.data.geometry.phongAngle??45}get isLOD(){return this.recomputeBoolean(),!1}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),e.path.length===1&&e.path[0]==="geometry"&&e.type===0&&e.props.operation!==void 0&&(this.freeBooleanPointer(),this.resetBBoxNeedsUpdate())}freeBooleanPointer(){super.freeBooleanPointer(),this.geometry.dispose()}recomputeBoolean(e,t=!0){var r;if(this.booleanMeshSetAddress!==-1&&!e)return;for(let n=0;n<this.children.length;n++){let s=this.children[n];s instanceof qf&&s.dataPatched.visible===!0&&s.recomputeBoolean(e===!0,t)}this.meshSetAddresses=[];for(let n=0;n<this.children.length;n++){let s=this.children[n];if(s instanceof wa&&s.dataPatched.visible===!0&&((r=s.geometry.attributes.position)==null?void 0:r.count)>0&&s.geometry.drawRange.count>0&&s.booleanMeshSetAddress!==0){Zm.multiplyMatrices(s.hiddenMatrix,s.matrix);try{if(s.booleanMeshSetAddress===-1){if((s.geometry.index??s.geometry.getAttribute("position")).count/3<15e5&&(s.booleanMeshSetAddress=Du.getMeshSet(s.geometry,e===!0,t)),s.booleanMeshSetAddress===-1)return;Du.transformMeshSet(s.booleanMeshSetAddress,Zm),s.booleanMatrixInvOld.copy(Zm).invert(),s.booleanWasTransformed=!1}else s instanceof qf&&s.needsTransformForDownstream===!0?(Du.transformMeshSet(s.booleanMeshSetAddress,Zm),s.needsTransformForDownstream=!1):s.booleanWasTransformed===!0&&(Du.transformMeshSet(s.booleanMeshSetAddress,GAe.multiplyMatrices(Zm,s.booleanMatrixInvOld)),s.booleanMatrixInvOld.copy(Zm).invert(),s.booleanWasTransformed=!1)}catch(a){console.error(a),s.booleanMeshSetAddress=0,s.geometry.userData.booleanOperationDidFail=!0;continue}Du.hasOpenEdges(s.booleanMeshSetAddress)===!1||n===this.children.length-1&&this.booleanOp===2?(this.meshSetAddresses.push(s.booleanMeshSetAddress),s.geometry.userData.booleanOperationDidFail=!1):s.geometry.userData.booleanOperationDidFail="openEdges"}}if(this.meshSetAddresses.length===0){this.geometry.setAttribute("position",new St([],0)),this.geometry.setDrawRange(0,0);return}if(e===!0)return Du.calcBooleanTopological(this.meshSetAddresses,this.booleanOp);let i=this.geometry;i.dispose(),this.geometry=new Bt,this.geometry.userData=i.userData,this.geometry.boundingSphere=i.boundingSphere;try{this.booleanMeshSetAddress=Du.calcBoolean(this.meshSetAddresses,this.booleanOp,this.geometry,this.phongAngle)}catch(n){this.booleanMeshSetAddress=0,this.geometry.userData.booleanOperationDidFail=!0,console.error(n)}this.booleanMatrixInvOld.copy(this.matrix).invert(),this.needsTransformForDownstream=!0,yk(this),xk(this)}dispose(){super.dispose(),this.geometry.dispose()}},nz;(e=>{function t(i){return Pi.is(i)&&i instanceof kw}e.is=t})(nz||(nz={}));var bk=(e,t)=>class extends B0(e,t){updateState_Light(i,r){this.updateState_Entity(i,r),i.color!==void 0&&(this.color=r.shared.color(i.color)),i.intensity!==void 0&&(this.intensity=i.intensity),i.depth!==void 0&&(this.shadow.camera.far=i.depth,this.shadow.needsUpdate=!0),i.shadows!==void 0&&(this.castShadow=i.shadows)}},Pl=e=>e instanceof wa,Zu=e=>e!==null&&e instanceof qf,jAe=e=>e instanceof Qs,WAe=e=>nz.is(e),sz=e=>rz.is(e),XAe=new B(1,1,1),yj=new B,qAe=new B,xj=new ei,Xw=class extends jw($pe){constructor(e,t=15){super(t),this.object=e,this.dummy=new Qu,this.object.updateMatrixWorld(),this.name=`EmptyObjectHelper: ${e.uuid}`,this.matrix=this.dummy.matrixWorld,this.matrixAutoUpdate=!1,this.object.isBone&&(this.visible=!1)}raycast(e,t){Ww(this.object,Xw.geometryHelper,e,t,!1,this.dummy)}update(){}updateMatrix(){}updateMatrixWorld(e){this.object.matrixWorld.decompose(yj,xj,qAe),this.matrix.compose(yj,xj,XAe),super.updateMatrixWorld(e)}updateWorldMatrix(e,t){}},Rv=class extends B0(Qu,Xw){constructor(e,t){super(),this.super_Entity(e,t),this.objectHelper.update()}updateState(e,t){this.updateState_Entity(e,t),"buffer"in e&&Object.keys(e).length===1&&t.scene.reloadSplats()}},bE=class extends B0(Qu,Xw){constructor(e,t,i){super(),this.super_Entity(e,t),this.context=i,this.objectHelper.update()}updateState(e,t){this.updateState_Entity(e,t)}},e$={RED:0,GREEN:1,BLUE:2,ALPHA:3},qw="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",YAe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform lowp sampler2D cocBuffer;uniform vec2 texelSize;uniform float scale;uniform vec4 kernel64[32];varying vec2 vUv;void main(){
#ifdef FOREGROUND
vec2 CoCNearFar=texture2D(cocBuffer,vUv).rg;float CoC=CoCNearFar.r*scale;
#else
float CoC=texture2D(cocBuffer,vUv).g*scale;
#endif
if(CoC==0.0){gl_FragColor=texture2D(inputBuffer,vUv);}else{
#ifdef FOREGROUND
vec2 step=texelSize*max(CoC,CoCNearFar.g*scale);
#else
vec2 step=texelSize*CoC;
#endif
vec4 acc=vec4(0.0);for(int i=0;i<32;++i){vec4 kernel=kernel64[i];vec2 uv=step*kernel.xy+vUv;acc+=texture2D(inputBuffer,uv);uv=step*kernel.zw+vUv;acc+=texture2D(inputBuffer,uv);}gl_FragColor=acc/64.0;}}`,OS=class extends Ui{constructor(e=!1,t=!1){super({name:"BokehMaterial",defines:{PASS:e?"2":"1"},uniforms:{kernel64:new at(null),kernel16:new at(null),inputBuffer:new at(null),cocBuffer:new at(null),texelSize:new at(new ve),scale:new at(1)},blending:An,depthWrite:!1,depthTest:!1,fragmentShader:YAe,vertexShader:qw}),this.toneMapped=!1,t&&(this.defines.FOREGROUND="1"),this.generateKernel()}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}set cocBuffer(e){this.uniforms.cocBuffer.value=e}setCoCBuffer(e){this.uniforms.cocBuffer.value=e}get scale(){return this.uniforms.scale.value}set scale(e){this.uniforms.scale.value=e}getScale(e){return this.uniforms.scale.value=e}setScale(e){this.uniforms.scale.value=e}generateKernel(){let e=2.39996323,t=new Float32Array(128),i=new Float32Array(32),r=0,n=0;for(let o=0;o<80;++o){let l=o*e,c=Math.sqrt(o)/Math.sqrt(80),u=c*Math.cos(l),h=c*Math.sin(l);o%5===0?(i[n++]=u,i[n++]=h):(t[r++]=u,t[r++]=h)}let s=[],a=[];for(let o=0;o<128;)s.push(new ti(t[o++],t[o++],t[o++],t[o++]));for(let o=0;o<32;)a.push(new ti(i[o++],i[o++],i[o++],i[o++]));this.uniforms.kernel64.value=s,this.uniforms.kernel16.value=a}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t)}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}};function wj(e,t,i){return e*(t-i)-t}function az(e,t,i){return Math.min(Math.max((e+t)/(t-i),0),1)}var QAe=`#include <common>
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform float focusDistance;uniform float focusRange;uniform float cameraNear;uniform float cameraFar;varying vec2 vUv;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}void main(){float depth=readDepth(vUv);
#ifdef PERSPECTIVE_CAMERA
float viewZ=perspectiveDepthToViewZ(depth,cameraNear,cameraFar);float linearDepth=viewZToOrthographicDepth(viewZ,cameraNear,cameraFar);
#else
float linearDepth=depth;
#endif
float signedDistance=linearDepth-focusDistance;float magnitude=smoothstep(0.0,focusRange,abs(signedDistance));gl_FragColor.rg=magnitude*vec2(step(signedDistance,0.0),step(0.0,signedDistance));}`,KAe=class extends Ui{constructor(e){super({name:"CircleOfConfusionMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new at(null),focusDistance:new at(0),focusRange:new at(0),cameraNear:new at(.3),cameraFar:new at(1e3)},blending:An,depthWrite:!1,depthTest:!1,fragmentShader:QAe,vertexShader:qw}),this.toneMapped=!1,this.uniforms.focalLength=this.uniforms.focusRange,this.adoptCameraSettings(e)}get near(){return this.uniforms.cameraNear.value}get far(){return this.uniforms.cameraFar.value}set depthBuffer(e){this.uniforms.depthBuffer.value=e}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=Mh){this.depthBuffer=e,this.depthPacking=t}get focusDistance(){return this.uniforms.focusDistance.value}set focusDistance(e){this.uniforms.focusDistance.value=e}get worldFocusDistance(){return-wj(this.focusDistance,this.near,this.far)}set worldFocusDistance(e){this.focusDistance=az(-e,this.near,this.far)}getFocusDistance(e){this.uniforms.focusDistance.value=e}setFocusDistance(e){this.uniforms.focusDistance.value=e}get focalLength(){return this.focusRange}set focalLength(e){this.focusRange=e}get focusRange(){return this.uniforms.focusRange.value}set focusRange(e){this.uniforms.focusRange.value=e}get worldFocusRange(){return-wj(this.focusRange,this.near,this.far)}set worldFocusRange(e){this.focusRange=az(-e,this.near,this.far)}getFocalLength(e){return this.focusRange}setFocalLength(e){this.focusRange=e}adoptCameraSettings(e){e&&(this.uniforms.cameraNear.value=e.near,this.uniforms.cameraFar.value=e.far,e instanceof Gs?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},ZAe=`#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;
#include <encodings_fragment>
#include <dithering_fragment>
}`,$Ae="uniform vec2 texelSize;uniform vec2 halfTexelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize*vec2(kernel)+halfTexelSize)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}",bj=class extends Ui{constructor(e=new ve){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new at(null),texelSize:new at(new ve),halfTexelSize:new at(new ve),kernel:new at(0),scale:new at(1)},blending:An,depthWrite:!1,depthTest:!1,fragmentShader:ZAe,vertexShader:$Ae}),this.toneMapped=!1,this.setTexelSize(e.x,e.y)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.inputBuffer=e}get scale(){return this.uniforms.scale.value}set scale(e){this.uniforms.scale.value=e}getScale(){return this.uniforms.scale.value}setScale(e){this.uniforms.scale.value=e}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(e){this.uniforms.kernel.value=e}setKernel(e){this.kernel=e}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t),this.uniforms.halfTexelSize.value.set(e,t).multiplyScalar(.5)}setSize(e,t){let i=this.uniforms;i.texelSize.value.set(1/e,1/t),i.halfTexelSize.value.copy(i.texelSize.value).multiplyScalar(.5)}},JAe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;
#include <encodings_fragment>
}`,eCe=class extends Ui{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new at(null),opacity:new at(1)},blending:An,depthWrite:!1,depthTest:!1,fragmentShader:JAe,vertexShader:qw}),this.toneMapped=!1}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}getOpacity(e){return this.uniforms.opacity.value}setOpacity(e){this.uniforms.opacity.value=e}},tCe=`varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
#if EDGE_DETECTION_MODE == 1
#include <common>
#endif
#if EDGE_DETECTION_MODE == 0 || PREDICATION_MODE == 1
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}vec3 gatherNeighbors(){float p=readDepth(vUv);float pLeft=readDepth(vUv0);float pTop=readDepth(vUv1);return vec3(p,pLeft,pTop);}
#elif PREDICATION_MODE == 2
uniform sampler2D predicationBuffer;vec3 gatherNeighbors(){float p=texture2D(predicationBuffer,vUv).r;float pLeft=texture2D(predicationBuffer,vUv0).r;float pTop=texture2D(predicationBuffer,vUv1).r;return vec3(p,pLeft,pTop);}
#endif
#if PREDICATION_MODE != 0
vec2 calculatePredicatedThreshold(){vec3 neighbours=gatherNeighbors();vec2 delta=abs(neighbours.xx-neighbours.yz);vec2 edges=step(PREDICATION_THRESHOLD,delta);return PREDICATION_SCALE*EDGE_THRESHOLD*(1.0-PREDICATION_STRENGTH*edges);}
#endif
#if EDGE_DETECTION_MODE != 0
uniform sampler2D inputBuffer;
#endif
void main(){
#if EDGE_DETECTION_MODE == 0
const vec2 threshold=vec2(DEPTH_THRESHOLD);
#elif PREDICATION_MODE != 0
vec2 threshold=calculatePredicatedThreshold();
#else
const vec2 threshold=vec2(EDGE_THRESHOLD);
#endif
#if EDGE_DETECTION_MODE == 0
vec3 neighbors=gatherNeighbors();vec2 delta=abs(neighbors.xx-vec2(neighbors.y,neighbors.z));vec2 edges=step(threshold,delta);if(dot(edges,vec2(1.0))==0.0){discard;}gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 1
float l=luminance(texture2D(inputBuffer,vUv).rgb);float lLeft=luminance(texture2D(inputBuffer,vUv0).rgb);float lTop=luminance(texture2D(inputBuffer,vUv1).rgb);vec4 delta;delta.xy=abs(l-vec2(lLeft,lTop));vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}float lRight=luminance(texture2D(inputBuffer,vUv2).rgb);float lBottom=luminance(texture2D(inputBuffer,vUv3).rgb);delta.zw=abs(l-vec2(lRight,lBottom));vec2 maxDelta=max(delta.xy,delta.zw);float lLeftLeft=luminance(texture2D(inputBuffer,vUv4).rgb);float lTopTop=luminance(texture2D(inputBuffer,vUv5).rgb);delta.zw=abs(vec2(lLeft,lTop)-vec2(lLeftLeft,lTopTop));maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges.xy*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 2
vec4 delta;vec3 c=texture2D(inputBuffer,vUv).rgb;vec3 cLeft=texture2D(inputBuffer,vUv0).rgb;vec3 t=abs(c-cLeft);delta.x=max(max(t.r,t.g),t.b);vec3 cTop=texture2D(inputBuffer,vUv1).rgb;t=abs(c-cTop);delta.y=max(max(t.r,t.g),t.b);vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}vec3 cRight=texture2D(inputBuffer,vUv2).rgb;t=abs(c-cRight);delta.z=max(max(t.r,t.g),t.b);vec3 cBottom=texture2D(inputBuffer,vUv3).rgb;t=abs(c-cBottom);delta.w=max(max(t.r,t.g),t.b);vec2 maxDelta=max(delta.xy,delta.zw);vec3 cLeftLeft=texture2D(inputBuffer,vUv4).rgb;t=abs(c-cLeftLeft);delta.z=max(max(t.r,t.g),t.b);vec3 cTopTop=texture2D(inputBuffer,vUv5).rgb;t=abs(c-cTopTop);delta.w=max(max(t.r,t.g),t.b);maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#endif
}`,iCe=`uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,0.0);vUv1=vUv+texelSize*vec2(0.0,-1.0);
#if EDGE_DETECTION_MODE != 0
vUv2=vUv+texelSize*vec2(1.0,0.0);vUv3=vUv+texelSize*vec2(0.0,1.0);vUv4=vUv+texelSize*vec2(-2.0,0.0);vUv5=vUv+texelSize*vec2(0.0,-2.0);
#endif
gl_Position=vec4(position.xy,1.0,1.0);}`,VT={DEPTH:0,LUMA:1,COLOR:2},rCe={DISABLED:0,DEPTH:1,CUSTOM:2},nCe=class extends Ui{constructor(e=new ve,t=VT.COLOR){super({name:"EdgeDetectionMaterial",defines:{THREE_REVISION:b0.replace(/\D+/g,""),LOCAL_CONTRAST_ADAPTATION_FACTOR:"2.0",EDGE_THRESHOLD:"0.1",DEPTH_THRESHOLD:"0.01",PREDICATION_MODE:"0",PREDICATION_THRESHOLD:"0.01",PREDICATION_SCALE:"2.0",PREDICATION_STRENGTH:"1.0",DEPTH_PACKING:"0"},uniforms:{inputBuffer:new at(null),depthBuffer:new at(null),predicationBuffer:new at(null),texelSize:new at(e)},blending:An,depthWrite:!1,depthTest:!1,fragmentShader:tCe,vertexShader:iCe}),this.toneMapped=!1,this.edgeDetectionMode=t}set depthBuffer(e){this.uniforms.depthBuffer.value=e}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=Mh){this.depthBuffer=e,this.depthPacking=t}get edgeDetectionMode(){return Number(this.defines.EDGE_DETECTION_MODE)}set edgeDetectionMode(e){this.defines.EDGE_DETECTION_MODE=e.toFixed(0),this.needsUpdate=!0}getEdgeDetectionMode(){return this.edgeDetectionMode}setEdgeDetectionMode(e){this.edgeDetectionMode=e}get localContrastAdaptationFactor(){return Number(this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR)}set localContrastAdaptationFactor(e){this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR=e.toFixed("6"),this.needsUpdate=!0}getLocalContrastAdaptationFactor(){return this.localContrastAdaptationFactor}setLocalContrastAdaptationFactor(e){this.localContrastAdaptationFactor=e}get edgeDetectionThreshold(){return Number(this.defines.EDGE_THRESHOLD)}set edgeDetectionThreshold(e){this.defines.EDGE_THRESHOLD=e.toFixed("6"),this.defines.DEPTH_THRESHOLD=(e*.1).toFixed("6"),this.needsUpdate=!0}getEdgeDetectionThreshold(){return this.edgeDetectionThreshold}setEdgeDetectionThreshold(e){this.edgeDetectionThreshold=e}get predicationMode(){return Number(this.defines.PREDICATION_MODE)}set predicationMode(e){this.defines.PREDICATION_MODE=e.toFixed(0),this.needsUpdate=!0}getPredicationMode(){return this.predicationMode}setPredicationMode(e){this.predicationMode=e}set predicationBuffer(e){this.uniforms.predicationBuffer.value=e}setPredicationBuffer(e){this.uniforms.predicationBuffer.value=e}get predicationThreshold(){return Number(this.defines.PREDICATION_THRESHOLD)}set predicationThreshold(e){this.defines.PREDICATION_THRESHOLD=e.toFixed("6"),this.needsUpdate=!0}getPredicationThreshold(){return this.predicationThreshold}setPredicationThreshold(e){this.predicationThreshold=e}get predicationScale(){return Number(this.defines.PREDICATION_SCALE)}set predicationScale(e){this.defines.PREDICATION_SCALE=e.toFixed("6"),this.needsUpdate=!0}getPredicationScale(){return this.predicationScale}setPredicationScale(e){this.predicationScale=e}get predicationStrength(){return Number(this.defines.PREDICATION_STRENGTH)}set predicationStrength(e){this.defines.PREDICATION_STRENGTH=e.toFixed("6"),this.needsUpdate=!0}getPredicationStrength(){return this.predicationStrength}setPredicationStrength(e){this.predicationStrength=e}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}},sCe=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#if THREE_REVISION >= 137
vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}FRAGMENT_HEADvoid main(){FRAGMENT_MAIN_UVvec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGEgl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <encodings_fragment>
#endif
#include <dithering_fragment>
}`,aCe="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEADvoid main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORTgl_Position=vec4(position.xy,1.0,1.0);}",gl={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},oz=class extends Ui{constructor(e,t,i,r,n=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:b0.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new at(null),depthBuffer:new at(null),resolution:new at(new ve),texelSize:new at(new ve),cameraNear:new at(.3),cameraFar:new at(1e3),aspect:new at(1),time:new at(0)},blending:An,depthWrite:!1,depthTest:!1,dithering:n}),this.toneMapped=!1,e&&this.setShaderParts(e),t&&this.setDefines(t),i&&this.setUniforms(i),this.adoptCameraSettings(r)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(e){this.uniforms.depthBuffer.value=e}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=Mh){this.depthBuffer=e,this.depthPacking=t}setShaderParts(e){return this.fragmentShader=sCe.replace(gl.FRAGMENT_HEAD,e.get(gl.FRAGMENT_HEAD)).replace(gl.FRAGMENT_MAIN_UV,e.get(gl.FRAGMENT_MAIN_UV)).replace(gl.FRAGMENT_MAIN_IMAGE,e.get(gl.FRAGMENT_MAIN_IMAGE)),this.vertexShader=aCe.replace(gl.VERTEX_HEAD,e.get(gl.VERTEX_HEAD)).replace(gl.VERTEX_MAIN_SUPPORT,e.get(gl.VERTEX_MAIN_SUPPORT)),this.needsUpdate=!0,this}setDefines(e){for(let t of e.entries())this.defines[t[0]]=t[1];return this.needsUpdate=!0,this}setUniforms(e){for(let t of e.entries())this.uniforms[t[0]]=t[1];return this}setExtensions(e){this.extensions={};for(let t of e)this.extensions[t]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(e){this.encodeOutput!==e&&(e?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(e){return this.encodeOutput}setOutputEncodingEnabled(e){this.encodeOutput=e}get time(){return this.uniforms.time.value}set time(e){this.uniforms.time.value=e}setDeltaTime(e){this.uniforms.time.value+=e}adoptCameraSettings(e){e&&(this.uniforms.cameraNear.value=e.near,this.uniforms.cameraFar.value=e.far,e instanceof Gs?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(e,t){let i=this.uniforms;i.resolution.value.set(e,t),i.texelSize.value.set(1/e,1/t),i.aspect.value=e/t}static get Section(){return gl}},oCe=`#include <common>
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef RANGE
uniform vec2 range;
#elif defined(THRESHOLD)
uniform float threshold;uniform float smoothing;
#endif
varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);
#ifdef RANGE
float low=step(range.x,l);float high=step(l,range.y);l*=low*high;
#elif defined(THRESHOLD)
l=smoothstep(threshold,threshold+smoothing,l);
#endif
#ifdef COLOR
gl_FragColor=vec4(texel.rgb*l,l);
#else
gl_FragColor=vec4(l);
#endif
}`,lCe=class extends Ui{constructor(e=!1,t=null){super({name:"LuminanceMaterial",defines:{THREE_REVISION:b0.replace(/\D+/g,"")},uniforms:{inputBuffer:new at(null),threshold:new at(0),smoothing:new at(1),range:new at(null)},blending:An,depthWrite:!1,depthTest:!1,fragmentShader:oCe,vertexShader:qw}),this.toneMapped=!1,this.colorOutput=e,this.luminanceRange=t}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get threshold(){return this.uniforms.threshold.value}set threshold(e){this.smoothing>0||e>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=e}getThreshold(){return this.threshold}setThreshold(e){this.threshold=e}get smoothing(){return this.uniforms.smoothing.value}set smoothing(e){this.threshold>0||e>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=e}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(e){this.smoothing=e}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(e){}get colorOutput(){return this.defines.COLOR!==void 0}set colorOutput(e){e?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(e){return this.colorOutput}setColorOutputEnabled(e){this.colorOutput=e}get useRange(){return this.luminanceRange!==null}set useRange(e){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(e){e!==null?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=e,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(e){this.luminanceRange=e}},cCe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef MASK_PRECISION_HIGH
uniform mediump sampler2D maskTexture;
#else
uniform lowp sampler2D maskTexture;
#endif
#if MASK_FUNCTION != 0
uniform float strength;
#endif
varying vec2 vUv;void main(){
#if COLOR_CHANNEL == 0
float mask=texture2D(maskTexture,vUv).r;
#elif COLOR_CHANNEL == 1
float mask=texture2D(maskTexture,vUv).g;
#elif COLOR_CHANNEL == 2
float mask=texture2D(maskTexture,vUv).b;
#else
float mask=texture2D(maskTexture,vUv).a;
#endif
#if MASK_FUNCTION == 0
#ifdef INVERTED
mask=step(mask,0.0);
#else
mask=1.0-step(mask,0.0);
#endif
#else
mask=clamp(mask*strength,0.0,1.0);
#ifdef INVERTED
mask=1.0-mask;
#endif
#endif
#if MASK_FUNCTION == 2
gl_FragColor=vec4(mask*texture2D(inputBuffer,vUv).rgb,mask);
#else
gl_FragColor=mask*texture2D(inputBuffer,vUv);
#endif
}`,t$={DISCARD:0,MULTIPLY:1,MULTIPLY_RGB_SET_ALPHA:2},uCe=class extends Ui{constructor(e=null){super({name:"MaskMaterial",uniforms:{maskTexture:new at(e),inputBuffer:new at(null),strength:new at(1)},blending:An,depthWrite:!1,depthTest:!1,fragmentShader:cCe,vertexShader:qw}),this.toneMapped=!1,this.setColorChannel(e$.RED),this.setMaskFunction(t$.DISCARD)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}set maskTexture(e){this.uniforms.maskTexture.value=e,delete this.defines.MASK_PRECISION_HIGH,e.type!==Js&&(this.defines.MASK_PRECISION_HIGH="1"),this.needsUpdate=!0}setMaskTexture(e){this.maskTexture=e}set colorChannel(e){this.defines.COLOR_CHANNEL=e.toFixed(0),this.needsUpdate=!0}setColorChannel(e){this.colorChannel=e}set maskFunction(e){this.defines.MASK_FUNCTION=e.toFixed(0),this.needsUpdate=!0}setMaskFunction(e){this.maskFunction=e}get inverted(){return this.defines.INVERTED!==void 0}set inverted(e){this.inverted&&!e?delete this.defines.INVERTED:e&&(this.defines.INVERTED="1"),this.needsUpdate=!0}isInverted(){return this.inverted}setInverted(e){this.inverted=e}get strength(){return this.uniforms.strength.value}set strength(e){this.uniforms.strength.value=e}getStrength(){return this.strength}setStrength(e){this.strength=e}},hCe=`#define sampleLevelZeroOffset(t, coord, offset) texture2D(t, coord + offset * texelSize)
#if __VERSION__ < 300
#define round(v) floor(v + 0.5)
#endif
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform lowp sampler2D areaTexture;uniform lowp sampler2D searchTexture;uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}vec2 decodeDiagBilinearAccess(in vec2 e){e.r=e.r*abs(5.0*e.r-5.0*0.75);return round(e);}vec4 decodeDiagBilinearAccess(in vec4 e){e.rb=e.rb*abs(5.0*e.rb-5.0*0.75);return round(e);}vec2 searchDiag1(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 searchDiag2(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);coord.x+=0.25*texelSize.x;vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;e=decodeDiagBilinearAccess(e);coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 areaDiag(const in vec2 dist,const in vec2 e,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE_DIAG,AREATEX_MAX_DISTANCE_DIAG)*e+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.x+=0.5;texCoord.y+=AREATEX_SUBTEX_SIZE*offset;return texture2D(areaTexture,texCoord).rg;}vec2 calculateDiagWeights(const in vec2 texCoord,const in vec2 e,const in vec4 subsampleIndices){vec2 weights=vec2(0.0);vec4 d;vec2 end;if(e.r>0.0){d.xz=searchDiag1(texCoord,vec2(-1.0,1.0),end);d.x+=float(end.y>0.9);}else{d.xz=vec2(0.0);}d.yw=searchDiag1(texCoord,vec2(1.0,-1.0),end);if(d.x+d.y>2.0){vec4 coords=vec4(-d.x+0.25,d.x,d.y,-d.y-0.25)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.xy=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).rg;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).rg;c.yxwz=decodeDiagBilinearAccess(c.xyzw);vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.z);}d.xz=searchDiag2(texCoord,vec2(-1.0,-1.0),end);if(sampleLevelZeroOffset(inputBuffer,texCoord,vec2(1,0)).r>0.0){d.yw=searchDiag2(texCoord,vec2(1.0),end);d.y+=float(end.y>0.9);}else{d.yw=vec2(0.0);}if(d.x+d.y>2.0){vec4 coords=vec4(-d.x,-d.x,d.y,d.y)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.x=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).g;c.y=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(0,-1)).r;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).gr;vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.w).gr;}return weights;}float searchLength(const in vec2 e,const in float offset){vec2 scale=SEARCHTEX_SIZE*vec2(0.5,-1.0);vec2 bias=SEARCHTEX_SIZE*vec2(offset,1.0);scale+=vec2(-1.0,1.0);bias+=vec2(0.5,-0.5);scale*=1.0/SEARCHTEX_PACKED_SIZE;bias*=1.0/SEARCHTEX_PACKED_SIZE;return texture2D(searchTexture,scale*e+bias).r;}float searchXLeft(in vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x>end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(-2.0,0.0)*texelSize+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.0)+3.25;return texelSize.x*offset+texCoord.x;}float searchXRight(vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x<end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(2.0,0.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.5)+3.25;return-texelSize.x*offset+texCoord.x;}float searchYUp(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.y>end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=-vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.0)+3.25;return texelSize.y*offset+texCoord.y;}float searchYDown(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;i++){if(!(texCoord.y<end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.5)+3.25;return-texelSize.y*offset+texCoord.y;}vec2 area(const in vec2 dist,const in float e1,const in float e2,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE)*round(4.0*vec2(e1,e2))+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.y=AREATEX_SUBTEX_SIZE*offset+texCoord.y;return texture2D(areaTexture,texCoord).rg;}void detectHorizontalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,1)).r;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).r;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,-2)).r;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,-2)).r;weights*=clamp(factor,0.0,1.0);
#endif
}void detectVerticalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(1,0)).g;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).g;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(-2,0)).g;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(-2,1)).g;weights*=clamp(factor,0.0,1.0);
#endif
}void main(){vec4 weights=vec4(0.0);vec4 subsampleIndices=vec4(0.0);vec2 e=texture2D(inputBuffer,vUv).rg;if(e.g>0.0){
#if !defined(DISABLE_DIAG_DETECTION)
weights.rg=calculateDiagWeights(vUv,e,subsampleIndices);if(weights.r==-weights.g){
#endif
vec2 d;vec3 coords;coords.x=searchXLeft(vOffset[0].xy,vOffset[2].x);coords.y=vOffset[1].y;d.x=coords.x;float e1=texture2D(inputBuffer,coords.xy).r;coords.z=searchXRight(vOffset[0].zw,vOffset[2].y);d.y=coords.z;d=round(resolution.xx*d+-vPixCoord.xx);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.zy,vec2(1,0)).r;weights.rg=area(sqrtD,e1,e2,subsampleIndices.y);coords.y=vUv.y;detectHorizontalCornerPattern(weights.rg,coords.xyzy,d);
#if !defined(DISABLE_DIAG_DETECTION)
}else{e.r=0.0;}
#endif
}if(e.r>0.0){vec2 d;vec3 coords;coords.y=searchYUp(vOffset[1].xy,vOffset[2].z);coords.x=vOffset[0].x;d.x=coords.y;float e1=texture2D(inputBuffer,coords.xy).g;coords.z=searchYDown(vOffset[1].zw,vOffset[2].w);d.y=coords.z;d=round(resolution.yy*d-vPixCoord.yy);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.xz,vec2(0,1)).g;weights.ba=area(sqrtD,e1,e2,subsampleIndices.x);coords.x=vUv.x;detectVerticalCornerPattern(weights.ba,coords.xyxz,d);}gl_FragColor=weights;}`,dCe="uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void main(){vUv=position.xy*0.5+0.5;vPixCoord=vUv*resolution;vOffset[0]=vUv.xyxy+texelSize.xyxy*vec4(-0.25,-0.125,1.25,-0.125);vOffset[1]=vUv.xyxy+texelSize.xyxy*vec4(-0.125,-0.25,-0.125,1.25);vOffset[2]=vec4(vOffset[0].xz,vOffset[1].yw)+vec4(-2.0,2.0,-2.0,2.0)*texelSize.xxyy*MAX_SEARCH_STEPS_FLOAT;gl_Position=vec4(position.xy,1.0,1.0);}",pCe=class extends Ui{constructor(e=new ve,t=new ve){super({name:"SMAAWeightsMaterial",defines:{MAX_SEARCH_STEPS_INT:"16",MAX_SEARCH_STEPS_FLOAT:"16.0",MAX_SEARCH_STEPS_DIAG_INT:"8",MAX_SEARCH_STEPS_DIAG_FLOAT:"8.0",CORNER_ROUNDING:"25",CORNER_ROUNDING_NORM:"0.25",AREATEX_MAX_DISTANCE:"16.0",AREATEX_MAX_DISTANCE_DIAG:"20.0",AREATEX_PIXEL_SIZE:"(1.0 / vec2(160.0, 560.0))",AREATEX_SUBTEX_SIZE:"(1.0 / 7.0)",SEARCHTEX_SIZE:"vec2(66.0, 33.0)",SEARCHTEX_PACKED_SIZE:"vec2(64.0, 16.0)"},uniforms:{inputBuffer:new at(null),searchTexture:new at(null),areaTexture:new at(null),resolution:new at(t),texelSize:new at(e)},blending:An,depthWrite:!1,depthTest:!1,fragmentShader:hCe,vertexShader:dCe}),this.toneMapped=!1}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get searchTexture(){return this.uniforms.searchTexture.value}set searchTexture(e){this.uniforms.searchTexture.value=e}get areaTexture(){return this.uniforms.areaTexture.value}set areaTexture(e){this.uniforms.areaTexture.value=e}setLookupTextures(e,t){this.searchTexture=e,this.areaTexture=t}get orthogonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_INT)}set orthogonalSearchSteps(e){let t=Math.min(Math.max(e,0),112);this.defines.MAX_SEARCH_STEPS_INT=t.toFixed("0"),this.defines.MAX_SEARCH_STEPS_FLOAT=t.toFixed("1"),this.needsUpdate=!0}setOrthogonalSearchSteps(e){this.orthogonalSearchSteps=e}get diagonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_DIAG_INT)}set diagonalSearchSteps(e){let t=Math.min(Math.max(e,0),20);this.defines.MAX_SEARCH_STEPS_DIAG_INT=t.toFixed("0"),this.defines.MAX_SEARCH_STEPS_DIAG_FLOAT=t.toFixed("1"),this.needsUpdate=!0}setDiagonalSearchSteps(e){this.diagonalSearchSteps=e}get diagonalDetection(){return this.defines.DISABLE_DIAG_DETECTION===void 0}set diagonalDetection(e){e?delete this.defines.DISABLE_DIAG_DETECTION:this.defines.DISABLE_DIAG_DETECTION="1",this.needsUpdate=!0}isDiagonalDetectionEnabled(){return this.diagonalDetection}setDiagonalDetectionEnabled(e){this.diagonalDetection=e}get cornerRounding(){return Number(this.defines.CORNER_ROUNDING)}set cornerRounding(e){let t=Math.min(Math.max(e,0),100);this.defines.CORNER_ROUNDING=t.toFixed("4"),this.defines.CORNER_ROUNDING_NORM=(t/100).toFixed("4"),this.needsUpdate=!0}setCornerRounding(e){this.cornerRounding=e}get cornerDetection(){return this.defines.DISABLE_CORNER_DETECTION===void 0}set cornerDetection(e){e?delete this.defines.DISABLE_CORNER_DETECTION:this.defines.DISABLE_CORNER_DETECTION="1",this.needsUpdate=!0}isCornerRoundingEnabled(){return this.cornerDetection}setCornerRoundingEnabled(e){this.cornerDetection=e}setSize(e,t){let i=this.uniforms;i.texelSize.value.set(1/e,1/t),i.resolution.value.set(e,t)}},fCe=new tm,jh=null;function mCe(){if(jh===null){let e=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),t=new Float32Array([0,0,2,0,0,2]);jh=new Bt,jh.setAttribute!==void 0?(jh.setAttribute("position",new $t(e,3)),jh.setAttribute("uv",new $t(t,2))):(jh.addAttribute("position",new $t(e,3)),jh.addAttribute("uv",new $t(t,2)))}return jh}var Sa=class{constructor(e="Pass",t=new Uc,i=fCe){this.name=e,this.renderer=null,this.scene=t,this.camera=i,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(e){if(this.rtt===e){let t=this.getFullscreenMaterial();t!==null&&(t.needsUpdate=!0),this.rtt=!e}}setRenderer(e){this.renderer=e}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(e){let t=this.screen;t!==null?t.material=e:(t=new zr(mCe(),e),t.frustumCulled=!1,this.scene===null&&(this.scene=new Uc),this.scene.add(t),this.screen=t)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(e){this.fullscreenMaterial=e}getDepthTexture(){return null}setDepthTexture(e,t=Mh){}render(e,t,i,r,n){throw new Error("Render method not implemented!")}setSize(e,t){}initialize(e,t,i){}dispose(){for(let e of Object.keys(this)){let t=this[e];if(t!==null&&typeof t=="object"&&typeof t.dispose=="function"){if(t instanceof Uc||t===this.renderer)continue;this[e].dispose()}}}},lz=class extends Sa{constructor(e,t=!0){super("CopyPass"),this.fullscreenMaterial=new eCe,this.needsSwap=!1,this.renderTarget=e,e===void 0&&(this.renderTarget=new Wi(1,1,{minFilter:pi,magFilter:pi,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=t}get resize(){return this.autoResize}set resize(e){this.autoResize=e}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(e){this.autoResize=e}render(e,t,i,r,n){this.fullscreenMaterial.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){this.autoResize&&this.renderTarget.setSize(e,t)}initialize(e,t,i){i!==void 0&&(this.renderTarget.texture.type=i,i!==Js?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":e.outputEncoding===hi&&(this.renderTarget.texture.encoding=hi))}},gCe=class extends Sa{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(e,t,i,r,n){let s=e.state.buffers.stencil;s.setLocked(!1),s.setTest(!1)}},Y3=new jt,_k=class extends Sa{constructor(e=!0,t=!0,i=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=e,this.depth=t,this.stencil=i,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(e,t,i){this.color=e,this.depth=t,this.stencil=i}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(e){this.overrideClearColor=e}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(e){this.overrideClearAlpha=e}render(e,t,i,r,n){let s=this.overrideClearColor,a=this.overrideClearAlpha,o=e.getClearAlpha(),l=s!==null,c=a>=0;l?(Y3.copy(e.getClearColor(Y3)),e.setClearColor(s,c?a:o)):c&&e.setClearAlpha(a),e.setRenderTarget(this.renderToScreen?null:t),e.clear(this.color,this.depth,this.stencil),l?e.setClearColor(Y3,o):c&&e.setClearAlpha(o)}},Wh=-1,ka=class extends Cs{constructor(e,t=Wh,i=Wh,r=1){super(),this.resizable=e,this.base=new ve(1,1),this.preferred=new ve(t,i),this.target=this.preferred,this.s=r}get width(){let{base:e,preferred:t,scale:i}=this,r;return t.width!==Wh?r=t.width:t.height!==Wh?r=Math.round(t.height*(e.width/Math.max(e.height,1))):r=Math.round(e.width*i),r}set width(e){this.preferredWidth=e}get height(){let{base:e,preferred:t,scale:i}=this,r;return t.height!==Wh?r=t.height:t.width!==Wh?r=Math.round(t.width/Math.max(e.width/Math.max(e.height,1),1)):r=Math.round(e.height*i),r}set height(e){this.preferredHeight=e}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(e){this.s!==e&&(this.s=e,this.preferred.setScalar(Wh),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getScale(){return this.scale}setScale(e){this.scale=e}get baseWidth(){return this.base.width}set baseWidth(e){this.base.width!==e&&(this.base.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getBaseWidth(){return this.base.width}setBaseWidth(e){this.base.width!==e&&(this.base.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}get baseHeight(){return this.base.height}set baseHeight(e){this.base.height!==e&&(this.base.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(e){this.baseHeight=e}setBaseSize(e,t){(this.base.width!==e||this.base.height!==t)&&(this.base.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}get preferredWidth(){return this.preferred.width}set preferredWidth(e){this.preferred.width!==e&&(this.preferred.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(e){this.preferredWidth=e}get preferredHeight(){return this.preferred.height}set preferredHeight(e){this.preferred.height!==e&&(this.preferred.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(e){this.preferredHeight=e}setPreferredSize(e,t){(this.preferred.width!==e||this.preferred.height!==t)&&(this.preferred.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}copy(e){this.base.set(e.getBaseWidth(),e.getBaseHeight()),this.preferred.set(e.getPreferredWidth(),e.getPreferredHeight()),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height)}static get AUTO_SIZE(){return Wh}},Q3=!1,_j=class{constructor(e=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(e),this.meshCount=0,this.replaceMaterial=t=>{if(t.isMesh){let i;if(t.material.flatShading)switch(t.material.side){case Ws:i=this.materialsFlatShadedDoubleSide;break;case ns:i=this.materialsFlatShadedBackSide;break;default:i=this.materialsFlatShaded;break}else switch(t.material.side){case Ws:i=this.materialsDoubleSide;break;case ns:i=this.materialsBackSide;break;default:i=this.materials;break}this.originalMaterials.set(t,t.material),t.isSkinnedMesh?t.material=i[2]:t.isInstancedMesh?t.material=i[1]:t.material=i[0],++this.meshCount}}}setMaterial(e){if(this.disposeMaterials(),this.material=e,e!==null){let t=this.materials=[e.clone(),e.clone(),e.clone()];for(let i of t)i.uniforms=Object.assign({},e.uniforms),i.side=Fl;t[2].skinning=!0,this.materialsBackSide=t.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},e.uniforms),r.side=ns,r}),this.materialsDoubleSide=t.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},e.uniforms),r.side=Ws,r}),this.materialsFlatShaded=t.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},e.uniforms),r.flatShading=!0,r}),this.materialsFlatShadedBackSide=t.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},e.uniforms),r.flatShading=!0,r.side=ns,r}),this.materialsFlatShadedDoubleSide=t.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},e.uniforms),r.flatShading=!0,r.side=Ws,r})}}render(e,t,i){let r=e.shadowMap.enabled;if(e.shadowMap.enabled=!1,Q3){let n=this.originalMaterials;this.meshCount=0,t.traverse(this.replaceMaterial),e.render(t,i);for(let s of n)s[0].material=s[1];this.meshCount!==n.size&&n.clear()}else{let n=t.overrideMaterial;t.overrideMaterial=this.material,e.render(t,i),t.overrideMaterial=n}e.shadowMap.enabled=r}disposeMaterials(){if(this.material!==null){let e=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(let t of e)t.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return Q3}static set workaroundEnabled(e){Q3=e}},vCe=class extends Sa{constructor(e,t,i=null){super("RenderPass",e,t),this.needsSwap=!1,this.clearPass=new _k,this.overrideMaterialManager=i===null?null:new _j(i),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}get renderToScreen(){return super.renderToScreen}set renderToScreen(e){super.renderToScreen=e,this.clearPass.renderToScreen=e}get overrideMaterial(){let e=this.overrideMaterialManager;return e!==null?e.material:null}set overrideMaterial(e){let t=this.overrideMaterialManager;e!==null?t!==null?t.setMaterial(e):this.overrideMaterialManager=new _j(e):t!==null&&(t.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(e){this.overrideMaterial=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getSelection(){return this.selection}setSelection(e){this.selection=e}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(e){this.ignoreBackground=e}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(e){this.skipShadowMapUpdate=e}getClearPass(){return this.clearPass}render(e,t,i,r,n){let s=this.scene,a=this.camera,o=this.selection,l=a.layers.mask,c=s.background,u=e.shadowMap.autoUpdate,h=this.renderToScreen?null:t;o!==null&&a.layers.set(o.getLayer()),this.skipShadowMapUpdate&&(e.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(s.background=null),this.clearPass.enabled&&this.clearPass.render(e,t),e.setRenderTarget(h),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(e,s,a):e.render(s,a),a.layers.mask=l,s.background=c,e.shadowMap.autoUpdate=u}},Sj=class extends Sa{constructor(e,t,{resolutionScale:i=1,width:r=ka.AUTO_SIZE,height:n=ka.AUTO_SIZE,renderTarget:s}={}){super("DepthPass"),this.needsSwap=!1,this.renderPass=new vCe(e,t,new FY({depthPacking:AY}));let a=this.renderPass;a.skipShadowMapUpdate=!0,a.ignoreBackground=!0;let o=a.getClearPass();o.overrideClearColor=new jt(16777215),o.overrideClearAlpha=1,this.renderTarget=s,this.renderTarget===void 0&&(this.renderTarget=new Wi(1,1,{minFilter:Qi,magFilter:Qi,stencilBuffer:!1}),this.renderTarget.texture.name="DepthPass.Target");let l=this.resolution=new ka(this,r,n,i);l.addEventListener("change",c=>this.setSize(l.baseWidth,l.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,i,r,n){let s=this.renderToScreen?null:this.renderTarget;this.renderPass.render(e,s)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height)}},Ri={SKIP:0,ADD:1,ALPHA:2,AVERAGE:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,EXCLUSION:8,LIGHTEN:9,MULTIPLY:10,DIVIDE:11,NEGATION:12,NORMAL:13,OVERLAY:14,REFLECT:15,SCREEN:16,SOFT_LIGHT:17,SUBTRACT:18},yCe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return min(x+y,1.0)*opacity+x*(1.0-opacity);}",xCe="vec3 blend(const in vec3 x,const in vec3 y,const in float opacity){return y*opacity+x*(1.0-opacity);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){float a=min(y.a,opacity);return vec4(blend(x.rgb,y.rgb,a),max(x.a,a));}",wCe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(x+y)*0.5*opacity+x*(1.0-opacity);}",bCe="float blend(const in float x,const in float y){return(y==0.0)?y:max(1.0-(1.0-x)/y,0.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",_Ce="float blend(const in float x,const in float y){return(y==1.0)?y:min(x/(1.0-y),1.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",SCe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return min(x,y)*opacity+x*(1.0-opacity);}",MCe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return abs(x-y)*opacity+x*(1.0-opacity);}",ECe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(x+y-2.0*x*y)*opacity+x*(1.0-opacity);}",ACe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return max(x,y)*opacity+x*(1.0-opacity);}",CCe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return x*y*opacity+x*(1.0-opacity);}",TCe="float blend(const in float x,const in float y){return(y>0.0)?min(x/y,1.0):1.0;}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",PCe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(1.0-abs(1.0-x-y))*opacity+x*(1.0-opacity);}",DCe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y*opacity+x*(1.0-opacity);}",RCe="float blend(const in float x,const in float y){return(x<0.5)?(2.0*x*y):(1.0-2.0*(1.0-x)*(1.0-y));}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",ICe="float blend(const in float x,const in float y){return(y==1.0)?y:min(x*x/(1.0-y),1.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",LCe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(1.0-(1.0-x)*(1.0-y))*opacity+x*(1.0-opacity);}",OCe="float blend(const in float x,const in float y){return(y<0.5)?(2.0*x*y+x*x*(1.0-2.0*y)):(sqrt(x)*(2.0*y-1.0)+2.0*x*(1.0-y));}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",zCe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return max(x+y-1.0,0.0)*opacity+x*(1.0-opacity);}",NCe=new Map([[Ri.SKIP,null],[Ri.ADD,yCe],[Ri.ALPHA,xCe],[Ri.AVERAGE,wCe],[Ri.COLOR_BURN,bCe],[Ri.COLOR_DODGE,_Ce],[Ri.DARKEN,SCe],[Ri.DIFFERENCE,MCe],[Ri.EXCLUSION,ECe],[Ri.LIGHTEN,ACe],[Ri.MULTIPLY,CCe],[Ri.DIVIDE,TCe],[Ri.NEGATION,PCe],[Ri.NORMAL,DCe],[Ri.OVERLAY,RCe],[Ri.REFLECT,ICe],[Ri.SCREEN,LCe],[Ri.SOFT_LIGHT,OCe],[Ri.SUBTRACT,zCe]]),BCe=class extends Cs{constructor(e,t=1){super(),this.f=e,this.opacity=new at(t)}getOpacity(){return this.opacity.value}setOpacity(e){this.opacity.value=e}get blendFunction(){return this.f}set blendFunction(e){this.f=e,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(e){this.blendFunction=e}getShaderCode(){return NCe.get(this.blendFunction)}},Fc={NONE:0,DEPTH:1,CONVOLUTION:2},Zc=class extends Cs{constructor(e,t,{attributes:i=Fc.NONE,blendFunction:r=Ri.SCREEN,defines:n=new Map,uniforms:s=new Map,extensions:a=null,vertexShader:o=null}={}){super(),this.name=e,this.renderer=null,this.attributes=i,this.fragmentShader=t,this.vertexShader=o,this.defines=n,this.uniforms=s,this.extensions=a,this.blendMode=new BCe(r),this.blendMode.addEventListener("change",l=>this.setChanged())}getName(){return this.name}setRenderer(e){this.renderer=e}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(e){this.attributes=e,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(e){this.fragmentShader=e,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(e){this.vertexShader=e,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(e,t=Mh){}update(e,t,i){}setSize(e,t){}initialize(e,t,i){}dispose(){for(let e of Object.keys(this)){let t=this[e];if(t!==null&&typeof t=="object"&&typeof t.dispose=="function"){if(t instanceof Uc||t===this.renderer)continue;this[e].dispose()}}}};function Mj(e,t,i){for(let r of t){let n="$1"+e+r.charAt(0).toUpperCase()+r.slice(1),s=new RegExp("([^\\.])(\\b"+r+"\\b)","g");for(let a of i.entries())a[1]!==null&&i.set(a[0],a[1].replace(s,n))}}function kCe(e,t,i,r,n,s,a){let o=new Map([["fragment",t.getFragmentShader()],["vertex",t.getVertexShader()]]),l=o.get("fragment")!==void 0&&/mainImage/.test(o.get("fragment")),c=o.get("fragment")!==void 0&&/mainUv/.test(o.get("fragment")),u=[],h=[],d=!1,p=!1;if(o.get("fragment")===void 0)console.error("Missing fragment shader",t);else if(c&&a&Fc.CONVOLUTION)console.error("Effects that transform UV coordinates are incompatible with convolution effects",t);else if(!l&&!c)console.error("The fragment shader contains neither a mainImage nor a mainUv function",t);else{let f=/(?:\w+\s+(\w+)\([\w\s,]*\)\s*{[^}]+})/g,v=oz.Section;if(c){let m=`	${e}MainUv(UV);
`;i.set(v.FRAGMENT_MAIN_UV,i.get(v.FRAGMENT_MAIN_UV)+m),d=!0}if(o.get("vertex")!==null&&/mainSupport/.test(o.get("vertex"))){let m=`	${e}MainSupport(`;m+=/mainSupport *\([\w\s]*?uv\s*?\)/.test(o.get("vertex"))?`vUv);
`:`);
`,i.set(v.VERTEX_MAIN_SUPPORT,i.get(v.VERTEX_MAIN_SUPPORT)+m),u=u.concat([...o.get("vertex").matchAll(/(?:varying\s+\w+\s+(\w*))/g)].map(x=>x[1])),h=h.concat(u).concat([...o.get("vertex").matchAll(f)].map(x=>x[1]))}h=h.concat([...o.get("fragment").matchAll(f)].map(m=>m[1])),h=h.concat([...t.defines.keys()].map(m=>m.replace(/\([\w\s,]*\)/g,""))),h=h.concat([...t.uniforms.keys()]),t.uniforms.forEach((m,x)=>s.set(e+x.charAt(0).toUpperCase()+x.slice(1),m)),t.defines.forEach((m,x)=>n.set(e+x.charAt(0).toUpperCase()+x.slice(1),m)),Mj(e,h,n),Mj(e,h,o);let g=t.blendMode;if(r.set(g.blendFunction,g),l){let m=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/,x=`${e}MainImage(color0, UV, `;a&Fc.DEPTH&&m.test(o.get("fragment"))&&(x+="depth, ",p=!0),x+=`color1);
	`;let w=e+"BlendOpacity";s.set(w,g.opacity),x+=`color0 = blend${g.blendFunction}(color0, color1, ${w});

	`,i.set(v.FRAGMENT_MAIN_IMAGE,i.get(v.FRAGMENT_MAIN_IMAGE)+x),x=`uniform float ${w};

`,i.set(v.FRAGMENT_HEAD,i.get(v.FRAGMENT_HEAD)+x)}i.set(v.FRAGMENT_HEAD,i.get(v.FRAGMENT_HEAD)+o.get("fragment")+`
`),o.get("vertex")!==null&&i.set(v.VERTEX_HEAD,i.get(v.VERTEX_HEAD)+o.get("vertex")+`
`)}return{varyings:u,transformedUv:d,readDepth:p}}var lC=class extends Sa{constructor(e,...t){super("EffectPass"),this.fullscreenMaterial=new oz(null,null,null,e),this.effects=t.sort((i,r)=>r.attributes-i.attributes),this.skipRendering=!1,this.uniformCount=0,this.varyingCount=0,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(e){this.fullscreenMaterial.encodeOutput=e}get dithering(){return this.fullscreenMaterial.dithering}set dithering(e){let t=this.fullscreenMaterial;t.dithering=e,t.needsUpdate=!0}verifyResources(){let e=this.renderer.capabilities,t=Math.min(e.maxFragmentUniforms,e.maxVertexUniforms);this.uniformCount>t&&console.warn("The current rendering context doesn't support more than "+t+" uniforms, but "+this.uniformCount+" were defined"),t=e.maxVaryings,this.varyingCount>t&&console.warn("The current rendering context doesn't support more than "+t+" varyings, but "+this.varyingCount+" were defined")}updateMaterial(){let e=oz.Section,t=new Map([[e.FRAGMENT_HEAD,""],[e.FRAGMENT_MAIN_UV,""],[e.FRAGMENT_MAIN_IMAGE,""],[e.VERTEX_HEAD,""],[e.VERTEX_MAIN_SUPPORT,""]]),i=new Map,r=new Map,n=new Map,s=new Set,a=0,o=0,l=0,c=!1,u=!1;for(let d of this.effects)if(d.blendMode.blendFunction===Ri.SKIP)l|=d.getAttributes()&Fc.DEPTH;else if(l&d.getAttributes()&Fc.CONVOLUTION)console.error("Convolution effects cannot be merged",d);else{l|=d.getAttributes();let p="e"+a++,f=kCe(p,d,t,i,r,n,l);if(o+=f.varyings.length,c=c||f.transformedUv,u=u||f.readDepth,d.extensions!==null)for(let v of d.extensions)s.add(v)}let h=/\bblend\b/g;for(let d of i.values()){let p=d.getShaderCode().replace(h,`blend${d.blendFunction}`);t.set(e.FRAGMENT_HEAD,t.get(e.FRAGMENT_HEAD)+p+`
`)}l&Fc.DEPTH?(u&&t.set(e.FRAGMENT_MAIN_IMAGE,`float depth = readDepth(UV);

	`+t.get(e.FRAGMENT_MAIN_IMAGE)),this.needsDepthTexture=this.getDepthTexture()===null):this.needsDepthTexture=!1,c?(t.set(e.FRAGMENT_MAIN_UV,`vec2 transformedUv = vUv;
`+t.get(e.FRAGMENT_MAIN_UV)),r.set("UV","transformedUv")):r.set("UV","vUv"),t.forEach((d,p,f)=>f.set(p,d.trim().replace(/^#/,`
#`))),this.uniformCount=n.size,this.varyingCount=o,this.skipRendering=a===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderParts(t).setExtensions(s).setUniforms(n).setDefines(r)}recompile(){this.updateMaterial(),this.verifyResources()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(e,t=Mh){this.fullscreenMaterial.depthBuffer=e,this.fullscreenMaterial.depthPacking=t;for(let i of this.effects)i.setDepthTexture(e,t)}render(e,t,i,r,n){for(let s of this.effects)s.update(e,t,r);if(!this.skipRendering||this.renderToScreen){let s=this.fullscreenMaterial;s.inputBuffer=t.texture,s.time+=r,e.setRenderTarget(this.renderToScreen?null:i),e.render(this.scene,this.camera)}}setSize(e,t){this.fullscreenMaterial.setSize(e,t);for(let i of this.effects)i.setSize(e,t)}initialize(e,t,i){this.renderer=e;for(let r of this.effects)r.initialize(e,t,i),r.addEventListener("change",n=>this.handleEvent(n));this.updateMaterial(),this.verifyResources(),i!==void 0&&i!==Js&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(let e of this.effects)e.dispose()}handleEvent(e){switch(e.type){case"change":this.recompile();break}}},UCe=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],Sk=class extends Sa{constructor({resolutionScale:e=.5,width:t=ka.AUTO_SIZE,height:i=ka.AUTO_SIZE,kernelSize:r=HT.LARGE}={}){super("KawaseBlurPass"),this.renderTargetA=new Wi(1,1,{minFilter:pi,magFilter:pi,stencilBuffer:!1,depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";let n=this.resolution=new ka(this,t,i,e);n.addEventListener("change",s=>this.setSize(n.baseWidth,n.baseHeight)),this.blurMaterial=new bj,this.ditheredBlurMaterial=new bj,this.ditheredBlurMaterial.uniforms.scale=this.blurMaterial.uniforms.scale,this.ditheredBlurMaterial.dithering=!0,this.dithering=!1,this.kernelSize=r}getResolution(){return this.resolution}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get scale(){return this.blurMaterial.scale}set scale(e){this.blurMaterial.scale=e}getScale(){return this.blurMaterial.scale}setScale(e){this.blurMaterial.scale=e}getKernelSize(){return this.kernelSize}setKernelSize(e){this.kernelSize=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,i,r,n){let s=this.scene,a=this.camera,o=this.renderTargetA,l=this.renderTargetB,c=UCe[this.kernelSize],u=this.blurMaterial,h=t,d,p;for(this.fullscreenMaterial=u,d=0,p=c.length-1;d<p;++d){let f=d&1?l:o;u.kernel=c[d],u.inputBuffer=h.texture,e.setRenderTarget(f),e.render(s,a),h=f}this.dithering&&(u=this.ditheredBlurMaterial,this.fullscreenMaterial=u),u.kernel=c[d],u.inputBuffer=h.texture,e.setRenderTarget(this.renderToScreen?null:i),e.render(s,a)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t);let r=i.width,n=i.height;this.renderTargetA.setSize(r,n),this.renderTargetB.setSize(r,n),this.blurMaterial.setSize(r,n),this.ditheredBlurMaterial.setSize(r,n)}initialize(e,t,i){i!==void 0&&(this.renderTargetA.texture.type=i,this.renderTargetB.texture.type=i,i!==Js?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.ditheredBlurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):e.outputEncoding===hi&&(this.renderTargetA.texture.encoding=hi,this.renderTargetB.texture.encoding=hi))}static get AUTO_SIZE(){return ka.AUTO_SIZE}},FCe=class extends Sa{constructor({width:e=ka.AUTO_SIZE,height:t=ka.AUTO_SIZE,renderTarget:i,luminanceRange:r,colorOutput:n}={}){super("LuminancePass"),this.fullscreenMaterial=new lCe(n,r),this.needsSwap=!1,this.renderTarget=i,this.renderTarget===void 0&&(this.renderTarget=new Wi(1,1,{minFilter:pi,magFilter:pi,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target",this.renderTarget.texture.generateMipmaps=!1);let s=this.resolution=new ka(this,e,t);s.addEventListener("change",a=>this.setSize(s.baseWidth,s.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(e,t,i,r,n){let s=this.fullscreenMaterial;s.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height)}initialize(e,t,i){i!==void 0&&i!==Js&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},VCe=class extends Sa{constructor(e,t){super("MaskPass",e,t),this.needsSwap=!1,this.clearPass=new _k(!1,!1,!0),this.inverse=!1}get inverted(){return this.inverse}set inverted(e){this.inverse=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(e){this.inverted=e}render(e,t,i,r,n){let s=e.getContext(),a=e.state.buffers,o=this.scene,l=this.camera,c=this.clearPass,u=this.inverted?0:1,h=1-u;a.color.setMask(!1),a.depth.setMask(!1),a.color.setLocked(!0),a.depth.setLocked(!0),a.stencil.setTest(!0),a.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),a.stencil.setFunc(s.ALWAYS,u,4294967295),a.stencil.setClear(h),a.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?c.render(e,null):(c.render(e,t),c.render(e,i))),this.renderToScreen?(e.setRenderTarget(null),e.render(o,l)):(e.setRenderTarget(t),e.render(o,l),e.setRenderTarget(i),e.render(o,l)),a.color.setLocked(!1),a.depth.setLocked(!1),a.stencil.setLocked(!1),a.stencil.setFunc(s.EQUAL,1,4294967295),a.stencil.setOp(s.KEEP,s.KEEP,s.KEEP),a.stencil.setLocked(!0)}},Wo=class extends Sa{constructor(e,t="inputBuffer"){super("ShaderPass"),this.fullscreenMaterial=e,this.inputBufferUniform=null,this.setInput(t)}setInput(e){if(this.inputBufferUniform=null,this.fullscreenMaterial!==null){let t=this.fullscreenMaterial.uniforms;t!==void 0&&t[e]!==void 0&&(this.inputBufferUniform=t[e])}}render(e,t,i,r,n){this.inputBufferUniform!==null&&t!==null&&(this.inputBufferUniform.value=t.texture),e.setRenderTarget(this.renderToScreen?null:i),e.render(this.scene,this.camera)}initialize(e,t,i){i!==void 0&&i!==Js&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},K3=1/1e3,HCe=1e3,GCe=class{constructor(){this.previousTime=0,this.currentTime=0,this.delta=0,this.fixedDelta=1e3/60,this.elapsed=0,this.timescale=1,this.fixedDeltaEnabled=!1,this.autoReset=!1}setFixedDeltaEnabled(e){return this.fixedDeltaEnabled=e,this}isAutoResetEnabled(e){return this.autoReset}setAutoResetEnabled(e){return typeof document<"u"&&document.hidden!==void 0&&(e?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this.autoReset=e),this}getDelta(){return this.delta*K3}getFixedDelta(){return this.fixedDelta*K3}setFixedDelta(e){return this.fixedDelta=e*HCe,this}getElapsed(){return this.elapsed*K3}getTimescale(){return this.timescale}setTimescale(e){return this.timescale=e,this}update(e){return this.fixedDeltaEnabled?this.delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=e!==void 0?e:performance.now(),this.delta=this.currentTime-this.previousTime),this.delta*=this.timescale,this.elapsed+=this.delta,this}reset(){return this.delta=0,this.elapsed=0,this.currentTime=performance.now(),this}handleEvent(e){document.hidden||(this.currentTime=performance.now())}dispose(){this.setAutoResetEnabled(!1)}},HT={VERY_SMALL:0,SMALL:1,MEDIUM:2,LARGE:3,VERY_LARGE:4,HUGE:5},jCe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=clamp(texture2D(map,uv)*intensity,0.0,1.0);}`,WCe=class extends Zc{constructor({blendFunction:e=Ri.SCREEN,luminanceThreshold:t=.9,luminanceSmoothing:i=.025,resolutionScale:r=.5,intensity:n=1,width:s=ka.AUTO_SIZE,height:a=ka.AUTO_SIZE,kernelSize:o=HT.LARGE}={}){super("BloomEffect",jCe,{blendFunction:e,uniforms:new Map([["map",new at(null)],["intensity",new at(n)]])}),this.renderTarget=new Wi(1,1,{minFilter:pi,magFilter:pi,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.renderTarget.texture.generateMipmaps=!1,this.uniforms.get("map").value=this.renderTarget.texture,this.luminancePass=new FCe({renderTarget:this.renderTarget,colorOutput:!0}),this.luminanceMaterial.threshold=t,this.luminanceMaterial.smoothingFactor=i,this.blurPass=new Sk({resolutionScale:r,width:s,height:a,kernelSize:o});let l=this.blurPass.getResolution();l.addEventListener("change",c=>this.setSize(l.baseWidth,l.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}get resolution(){return this.blurPass.resolution}getResolution(){return this.blurPass.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get dithering(){return this.blurPass.dithering}set dithering(e){this.blurPass.dithering=e}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(e){this.blurPass.kernelSize=e}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(e){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(e){this.uniforms.get("intensity").value=e}getIntensity(){return this.intensity}setIntensity(e){this.intensity=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}update(e,t,i){let r=this.renderTarget;this.luminancePass.enabled?(this.luminancePass.render(e,t,r),this.blurPass.render(e,r,r)):this.blurPass.render(e,t,r)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height),this.luminancePass.resolution.copy(i)}initialize(e,t,i){this.blurPass.initialize(e,t,i),i!==void 0&&(this.renderTarget.texture.type=i,e.outputEncoding===hi&&(this.renderTarget.texture.encoding=hi))}},XCe="uniform float brightness;uniform float contrast;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=inputColor.rgb+vec3(brightness-0.5);if(contrast>0.0){color/=vec3(1.0-contrast);}else{color*=vec3(1.0+contrast);}outputColor=vec4(min(color+vec3(0.5),1.0),inputColor.a);}",qCe=class extends Zc{constructor({blendFunction:e=Ri.NORMAL,brightness:t=0,contrast:i=0}={}){super("BrightnessContrastEffect",XCe,{blendFunction:e,uniforms:new Map([["brightness",new at(t)],["contrast",new at(i)]])})}get brightness(){return this.uniforms.get("brightness").value}set brightness(e){this.uniforms.get("brightness").value=e}getBrightness(e){return this.brightness}setBrightness(e){this.brightness=e}get contrast(){return this.uniforms.get("contrast").value}set contrast(e){this.uniforms.get("contrast").value=e}getContrast(e){return this.contrast}setContrast(e){this.contrast=e}},YCe="void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=vec4(vec3(average(inputColor.rgb)),inputColor.a);}",QCe=class extends Zc{constructor(e=Ri.NORMAL){super("ColorAverageEffect",YCe,{blendFunction:e})}},KCe="varying vec2 vUvR;varying vec2 vUvB;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec2 ra=texture2D(inputBuffer,vUvR).ra;vec2 ba=texture2D(inputBuffer,vUvB).ba;outputColor=vec4(ra.x,inputColor.g,ba.x,max(max(ra.y,ba.y),inputColor.a));}",ZCe="uniform vec2 offset;varying vec2 vUvR;varying vec2 vUvB;void mainSupport(const in vec2 uv){vec2 shift=offset*vec2(1.0,aspect);vUvR=uv+shift;vUvB=uv-shift;}",$Ce=class extends Zc{constructor({blendFunction:e=Ri.NORMAL,offset:t=new ve(.001,5e-4)}={}){super("ChromaticAberrationEffect",KCe,{vertexShader:ZCe,blendFunction:e,attributes:Fc.CONVOLUTION,uniforms:new Map([["offset",new at(t)]])})}get offset(){return this.uniforms.get("offset").value}set offset(e){this.uniforms.get("offset").value=e}getOffset(){return this.offset}setOffset(e){this.offset=e}},JCe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D nearColorBuffer;uniform mediump sampler2D farColorBuffer;
#else
uniform lowp sampler2D nearColorBuffer;uniform lowp sampler2D farColorBuffer;
#endif
uniform lowp sampler2D nearCoCBuffer;uniform float scale;void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){vec4 colorNear=texture2D(nearColorBuffer,uv);vec4 colorFar=texture2D(farColorBuffer,uv);float CoCNear=texture2D(nearCoCBuffer,uv).r;CoCNear=min(CoCNear*scale,1.0);vec4 result=inputColor*(1.0-colorFar.a)+colorFar;result=mix(result,colorNear,CoCNear);outputColor=result;}`,eTe=class extends Zc{constructor(e,{blendFunction:t=Ri.NORMAL,worldFocusDistance:i,worldFocusRange:r,focusDistance:n=0,focalLength:s=.1,focusRange:a=s,bokehScale:o=1,width:l=ka.AUTO_SIZE,height:c=ka.AUTO_SIZE}={}){super("DepthOfFieldEffect",JCe,{blendFunction:t,attributes:Fc.DEPTH,uniforms:new Map([["nearColorBuffer",new at(null)],["farColorBuffer",new at(null)],["nearCoCBuffer",new at(null)],["scale",new at(1)]])}),this.camera=e,this.renderTarget=new Wi(1,1,{minFilter:pi,magFilter:pi,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="DoF.Intermediate",this.renderTarget.texture.generateMipmaps=!1,this.renderTargetMasked=this.renderTarget.clone(),this.renderTargetMasked.texture.name="DoF.Masked.Far",this.renderTargetNear=this.renderTarget.clone(),this.renderTargetNear.texture.name="DoF.Bokeh.Near",this.uniforms.get("nearColorBuffer").value=this.renderTargetNear.texture,this.renderTargetFar=this.renderTarget.clone(),this.renderTargetFar.texture.name="DoF.Bokeh.Far",this.uniforms.get("farColorBuffer").value=this.renderTargetFar.texture,this.renderTargetCoC=this.renderTarget.clone(),this.renderTargetCoC.texture.name="DoF.CoC",this.renderTargetCoCBlurred=this.renderTargetCoC.clone(),this.renderTargetCoCBlurred.texture.name="DoF.CoC.Blurred",this.uniforms.get("nearCoCBuffer").value=this.renderTargetCoCBlurred.texture,this.cocPass=new Wo(new KAe(e));let u=this.cocMaterial;u.focusDistance=n,u.focusRange=a,i!==void 0&&(u.worldFocusDistance=i),r!==void 0&&(u.worldFocusRange=r),this.blurPass=new Sk({kernelSize:HT.MEDIUM,width:l,height:c});let h=this.blurPass.getResolution();h.addEventListener("change",p=>this.setSize(h.getBaseWidth(),h.getBaseHeight())),this.maskPass=new Wo(new uCe(this.renderTargetCoC.texture));let d=this.maskPass.fullscreenMaterial;d.maskFunction=t$.MULTIPLY,d.colorChannel=e$.GREEN,this.bokehNearBasePass=new Wo(new OS(!1,!0)),this.bokehNearBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehNearFillPass=new Wo(new OS(!0,!0)),this.bokehNearFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehFarBasePass=new Wo(new OS(!1,!1)),this.bokehFarBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.bokehFarFillPass=new Wo(new OS(!0,!1)),this.bokehFarFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.target=null,this.bokehScale=o}get cocTexture(){return this.renderTargetCoC.texture}get cocMaterial(){return this.cocPass.fullscreenMaterial}get circleOfConfusionMaterial(){return this.cocMaterial}getCircleOfConfusionMaterial(){return this.circleOfConfusionMaterial}getBlurPass(){return this.blurPass}get resolution(){return this.blurPass.getResolution()}getResolution(){return this.blurPass.getResolution()}get bokehScale(){return this.uniforms.get("scale").value}set bokehScale(e){let t=[this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass];for(let i of t)i.fullscreenMaterial.setScale(e);this.maskPass.fullscreenMaterial.setStrength(e),this.uniforms.get("scale").value=e}getBokehScale(){return this.bokehScale}setBokehScale(e){this.bokehScale=e}getTarget(){return this.target}setTarget(e){this.target=e}calculateFocusDistance(e){let t=this.camera,i=t.position.distanceTo(e);return az(-i,t.near,t.far)}setDepthTexture(e,t=Mh){this.circleOfConfusionMaterial.depthBuffer=e,this.circleOfConfusionMaterial.depthPacking=t}update(e,t,i){let r=this.renderTarget,n=this.renderTargetCoC,s=this.renderTargetCoCBlurred,a=this.renderTargetMasked;if(this.target!==null){let o=this.calculateFocusDistance(this.target);this.circleOfConfusionMaterial.focusDistance=o}this.cocPass.render(e,null,n),this.blurPass.render(e,n,s),this.maskPass.render(e,t,a),this.bokehFarBasePass.render(e,a,r),this.bokehFarFillPass.render(e,r,this.renderTargetFar),this.bokehNearBasePass.render(e,t,r),this.bokehNearFillPass.render(e,r,this.renderTargetNear)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t);let r=i.width,n=i.height,s=[this.cocPass,this.blurPass,this.maskPass,this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass];s.push(this.renderTargetCoC,this.renderTargetMasked),s.forEach(a=>a.setSize(e,t)),s=[this.renderTarget,this.renderTargetNear,this.renderTargetFar,this.renderTargetCoCBlurred],s.forEach(a=>a.setSize(r,n)),[this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass].forEach(a=>a.fullscreenMaterial.setSize(r,n))}initialize(e,t,i){[this.cocPass,this.maskPass,this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass].forEach(r=>r.initialize(e,t,i)),this.blurPass.initialize(e,t,Js),i!==void 0&&(this.renderTarget.texture.type=i,this.renderTargetNear.texture.type=i,this.renderTargetFar.texture.type=i,this.renderTargetMasked.texture.type=i,e.outputEncoding===hi&&(this.renderTarget.texture.encoding=hi,this.renderTargetNear.texture.encoding=hi,this.renderTargetFar.texture.encoding=hi,this.renderTargetMasked.texture.encoding=hi))}};new B;new ht;var tTe="uniform vec3 hue;uniform float saturation;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=vec3(dot(inputColor.rgb,hue.xyz),dot(inputColor.rgb,hue.zxy),dot(inputColor.rgb,hue.yzx));float average=(color.r+color.g+color.b)/3.0;vec3 diff=average-color;if(saturation>0.0){color+=diff*(1.0-1.0/(1.001-saturation));}else{color+=diff*-saturation;}outputColor=vec4(min(color,1.0),inputColor.a);}",iTe=class extends Zc{constructor({blendFunction:e=Ri.NORMAL,hue:t=0,saturation:i=0}={}){super("HueSaturationEffect",tTe,{blendFunction:e,uniforms:new Map([["hue",new at(new B)],["saturation",new at(i)]])}),this.hue=t}get saturation(){return this.uniforms.get("saturation").value}set saturation(e){this.uniforms.get("saturation").value=e}getSaturation(){return this.saturation}setSaturation(e){this.saturation=e}get hue(){let e=this.uniforms.get("hue").value;return Math.acos((e.x*3-1)/2)}set hue(e){let t=Math.sin(e),i=Math.cos(e);this.uniforms.get("hue").value.set((2*i+1)/3,(-Math.sqrt(3)*t-i+1)/3,(Math.sqrt(3)*t-i+1)/3)}getHue(){return this.hue}setHue(e){this.hue=e}};new jt;var rTe=`void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 noise=vec3(rand(uv*time));
#ifdef PREMULTIPLY
outputColor=vec4(min(inputColor.rgb*noise,vec3(1.0)),inputColor.a);
#else
outputColor=vec4(noise,inputColor.a);
#endif
}`,nTe=class extends Zc{constructor({blendFunction:e=Ri.SCREEN,premultiply:t=!1}={}){super("NoiseEffect",rTe,{blendFunction:e}),this.premultiply=t}get premultiply(){return this.defines.has("PREMULTIPLY")}set premultiply(e){this.premultiply!==e&&(e?this.defines.set("PREMULTIPLY","1"):this.defines.delete("PREMULTIPLY"),this.setChanged())}isPremultiplied(){return this.premultiply}setPremultiplied(e){this.premultiply=e}},sTe="uniform bool active;uniform vec2 d;void mainUv(inout vec2 uv){if(active){uv=vec2(d.x*(floor(uv.x/d.x)+0.5),d.y*(floor(uv.y/d.y)+0.5));}}",aTe=class extends Zc{constructor(e=30){super("PixelationEffect",sTe,{uniforms:new Map([["active",new at(!1)],["d",new at(new ve)]])}),this.resolution=new ve,this.d=0,this.granularity=e}get granularity(){return this.d}set granularity(e){let t=Math.floor(e);t%2>0&&(t+=1),this.d=t,this.uniforms.get("active").value=t>0,this.setSize(this.resolution.width,this.resolution.height)}getGranularity(){return this.granularity}setGranularity(e){this.granularity=e}setSize(e,t){this.resolution.set(e,t),this.uniforms.get("d").value.setScalar(this.d).divide(this.resolution)}};new B;new B;var Ej="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAQCAYAAACm53kpAAAAeElEQVRYR+2XSwqAMAxEJ168ePEqwRSKhIIiuHjJqiU0gWE+1CQdApcVAMUAuARaMGCX1MIL/Ow13++9lW2s3mW9MWvsnWc/2fvGygwPAN4E8QzAA4CXAB6AHjG4JTHYI1ey3pcx6FHnEfhLDOIBKAmUBK6/ANUDTlROXAHd9EC1AAAAAElFTkSuQmCC",Aj="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAIwCAYAAAABNmBHAAAgAElEQVR4Xuy9CbhlV1ktOvbpq09DkiIkUBI6kxASIH0DlAQiIK1wRfSJTx+i4JX7vKIigs8HXpXvqVcvrcC9agQ7IDTSSWgqCQQliDRBJKkkhDSkqVPNqVOnP+8b//rH3P+eZ+199tlznVTlvVrft7+1T7OaueZY42/m37QALKNk2wHg1pITlB17mC+Pp11W3X/LHyT32vhg48/5SOv+PnwpsHA70JoGlueB1iKApeqzvOzn44GatTB76Xzhd7suBR7+WWADgDEAwwCG/L54b/poDLrHuvvm70Z2Avhsc+PVcxscBU8F8C8ADg5+ipIjD/PlGwfgju8B924E5seARUfLsiNmqQW0IjL8+7L2NYD/7COBzfcCm+aB8SVgdAkYIRCXKyDax4EdAanL5PuNPllNvXDlAHwFgP8AcC2AhRIoDXbsYb48dl5WkVFTE3LGDcC9m4CZCWBuFFgeAZaGAYJQQCRqDHT+McJrVb8zwATUXH02MHYfMHEIGFsAxgjApQqACYQORjtd/B7Axt/z79sC0+cMPgjjlwPwVwHcA+DfAHzTxcVgWBroqMN8+cYBeM71wH0TwKExYHYUWCIAHYRLTlkCYgcIBcAgU/n3qy8GRu4HRgnAOWBkERhddPAJhGJDBxkvw7cqimr+zFM/ZLnZF64cgL8BYD+AWwB8x/dlWuWagHiYL984AJ/0RWBy1AE4AizyM1yxYAcTigW55xMbAkxEiwEdkJ/ZCQxPAiOHgBECcKEC4TBZcKkSv+mTieNcNPNC26mLNsj45QD8LQDTAO4GcJt/7iw2bfoG4WG+vAGwm9ExiEg69zpg/wgwPQLMjgALzn4E4aIzoJjQ9g4024uygkj+pyuAoX0VAIfngOH5NgCHMhAm8Sv2y3XDZeBhNIp8OzJE8OsBzAKYBHAXgDt8/4O+MVT0j4f58o0D8Pxrgf3DwMwIMEPQEYRkNwfgsuuDZLskip0No0gWMD/9HGDoADAkAC4Aw/wsAgZAgs2Z0ABI0GU6IVmKv+f28KDnHxkA/G0A8y6G73N9kOCjXnh/Ebb6OvgwX75xAF5wLTA1VIHPADgMLDj4yIA5AAm6aCUnv4oz46eeDwxNAUMzwJAz4BABSNDFTwSfg7DDKHE23MG5PqIY8A1u/dINs9dBdy8AgnGPM2NfUBrsnw7z5RsH4IXXAAcJviFgluAbygBINnSLWOAjGxJ4pgOKDV0v/OSLKp8iGXBovhLBBOCQM2ACoTOhnYrAdItYbCij5JFzRyIAqRccAnDAQUjg6UNQ7hsMXP0cRQAexss3DsCLCECCLwCQzMcPwUi2MwAScAKbfnY/YRLFQ8DHX+IAJAMSfDkAF13kLvleIjhjQQHxUVS3jjgGpKeeNzYVQEjgUS8k+PghONdhIwAP4+XXBYCHKIJbwJyDTgaIAdCBJx3Q2M8tYAHP9m4df/ylQOsQ0JqtRLCx30K1wtLBggScQOgsKBGcWHAJeOwRC0BSM1mQIKRbhh+Bj98JQP6t4U0APEyXXxcAEnxkQAFwoVUxID9kvQg+c1C7vidRbIDkc24B//hTQGumDcCWA5DgMxASdNIFBUI5pCML8v8API5zfEQx4BudgqiczviSnJhQwCP4BMCGl+wO8+U7AJi/W4O4YS6+pmK/2ciADsAOBhTIIiAJnPB7AvNjP+0AnANaYkAHX2JBAc+tYaJXOqBZv24Vc386XW5dtkHGW+4HFAJonpOe+YYQZAShgKjv3PNvPQaxVoI8zJdfFwASfPzMUwS3Kt1v0UFIlos6oDFdAGFcliMAP/ryAEAGNwQRnDOgLbdlIEwrIs6AZ/QgkMMHQF6ZAKQcJAsSYPwIeAIk9wJgoPK1gi7+PwF4GC/fOAAvIQPSs0URTPBJ/Pp3GSEGRHfBCIQ0xowBtUbcAj7ys5X4Jfu1HIAGQrIgQRXEsAFQIORDFhiDY/rMHmrU4QUgR08AkgUjCAW6CD6CkwBsAIQC4GG6fPMA3OXiNzCg2I9gNCMksmAAoemDzoimFwL48M85AKkiuQVMAAp8CYRRDAt8GQiJ67N6GJODAXAHlsGguscA2AJg1IPGYmxOpBxFWkRN9LsATgIwXnNs/v/5z/9XCf8BO3YAtxbc/46/KDt+5+ea1Yku2VUxHz/z0v24FwMGK1gWsK2OUUxHHdCBeRUB6OxHABr4ZICIBd0QWSF+XRdMTAjgCdTrG9cBNwE4F8CpDkICyYLGsuhFt6zs+gISwUen8zEAjgMw4cfx2H6O/90yAFo84Cbg4ID3/9TfLTt+5+ebnRABkODjx0SwPi5ec/FrYpmqSAxM8Dn60CsqAFI6GfhqAMiDE/gokmvEr0C4PgDkBQm40wE8zMFEUDKEVoxIMLl/KS73mE7H9d+vcKHQQcjwW0Yu9nP8m8sAmOIBuWY6wP2/4s0ezjjg8TuvaR6ABJ70vxUApGrm7EbGE+i472BAB+WHfqHS/eoAaEwY2E9+wLSXTqhI7CXgnB6LCoOJ4BiST+hTnG0HcCwAglCx3ARoZEVFXnBPp/O/A/hXACc7CPs9/i1lAOyIB+RDX+P9/+pbQjjjAMfv/PL6AFDs1wFAgs/9fgKfgdE/ZEpuiQlbwAde6QAMBgiRmsSwA9BY0JfjovGRDBMH4TlcXGhcBOc6HkF0gjPhZgchxTLZMAci/04W/B6Ab3t09EPXcPyflgFwRTwgJ2MN9/8bf5qFM67x+B/aW4XQz42FeL0YrRyikztUFw0704mf9kXgxhOAqc3AAsPyRxxQCs/PdXOFY0W1KHy3QIUGtx+6vdnx1vsB+dsTncm2AogglFgVEAlUWrOMB2RyEmMCGQ/Y7/HvKns6tfGAnJQ+r/9b76oJZ1zD8WdyQjYBh8aBhVEHjELouQ8ukQ7VRSCJAALwkr+sALhnGzDD3JAJYJHg9uhoi4bx8ytkWUtvHT/7+Zc4dw1uZ3612fH2dkQf7yxIEEockwkJQn4IQoq8unhAhmPRKKFx0uv4K8ueTs94wD7u//VX9ghn7OP4c+4G7h8HpseB+dF2AKlFLwuAIZ8jD6NPrOhAffmfA9/ZBuzZCkyRWSeqBCWyoYGQ5yQrBpDbum/ME1HoPo0XEkSD2zlfbna8q6+EUJcTCxKEtHL5EQjP6BEPyIgYAZBvYt3xHyx7OqvGA65y/7/9wVXCGVc5/sl7qxD66dEqiYgRzAqhN1A4CBNAAlDyAFI+iZ9/N3DLJuC+jcDUBmCWyUnOrmTYCMIOkNclLg0B8/RsNLg9+UvNjnd1APLmmQpFHyEBROuWACQT8nN+H/GAvY7/VNnT6SsesMf13/CpahGnZzhjj+PPmwX2MYdDIfQexWyBAwEUOQDrRDN/98p3A7dvAO6fAA5sqHJDBEAyoUVGkwEd6HR12XU4kwzfl6fCXTZzjy57vvnR513X7Hj7AyDvggAUi9EyFgiZqNxPQF6345nOWbD1HQ/Y5fpvuLa/2+82/vNHgAPDFQDnhoF5j2C2qBWCI8bw1eRw5CL5l94L3DEOTI4DB8Y9OWmsEu/zBJ3rgsaybqBob/7A4C7jtWcooRrczr+u2fH2D0AOQgAUCxKEP7aGgLy64+m6KdjWFA9Yc/03/Osa4glrjr+AupqHz1sEs0cxG0BC9HIePLoit9eNkVf9L+DuUWByDJgaq4ybGYLPAWgiXmLedUE7dwC7saL7CqfPKXi4NYdaykCD410bAHlDEsNiwZ9wAPYbkJcfz6T2gm3N8YDZ9d/wHxUA+739fPwXPrSKYGb+BuP3jAFDElFH9HIWwbzCIGkBr/or4J4RYO8oMOW6ZVcAuvi1Cgoha04BCwT5gfMKHm7NoRde2+x41w5A3hQZkADk5+cGiAeMx3+/7AENFA8Yrv/G71cAXFM4Yzj+otOAaQLQA0gZxaIIZtMDFTigKJV8H9Iq6aZ59ZXAvSPAvpEKgBTtBODcSCWCZeRYtpzrmLyeGNCAyFl1v+Hei8qeb370Rdc2O97BAMi7EgB/2QG41nhAHU9LuWAbOB7Qr//GPRUA13r7Gv9FZwIMoVcEswEwfDoimEP0shKKtIphaZQAXv1+YM+wA3DEdcvRKkGJADQQEsQuhi1Tjt95vBsh5nx2IO59SsHDrTmUOStNjndwAAqEry0IyCMICkOyiuIBNwBvPFQQT7gBuPjc9oRYAIHyOEL4vIFEYVNaOou5vCGE/tV/A0wOVcnpzI47NOri3QFIBpSeaSDUdYLOSWvYImSGgftpJDa4MWJbAGxivGUA5MAOc0Be6eVLj7/4Mk+hzCOYPYpZDBiNkLh+G/M3yFyv/ltgL3W3YQfgcFUhgRY2PwY+Z7/EhAR1SFyXCOb57r28QfQBsJQBMn5D4y0HYLPje9Cd7RIC0PM3EiMofF4gVCBp1P840ix/gyz56r+vAMjk9Gl375iB4+CzveuZdLkkEPJ8ZEfX/6R73vOjzT5Si9hucLxHAVg4PwJgRwh9CKOXK8YA4ZEqKZXSQWh5P+5AftXfA/uGKvYjCKn72cctbFrZNECka5L5CPwIPtMH3TVz17MLB5gdLgA2Nd6jACycHwLQxFEUSR5ASvARDB0h9AQb9bXIgCGk6lUfAPYTgEPAITKgg1BObk58srTJgG58WMkWMaAbQQT1nc8rHGANAJsc71EAFs4PAagQestgC1lsBJ4BMCSOK6dDUcwqqaFiQr/0QeAAAdjy+jBiQQeeMSBZT3nCPUDIa9z+/MIB1gCwyfEeBWDh/BCAeQSzgkjFfGLBBD5nxQ4DxN0wv3hVxX5TBGDwL5obxvVA5YqYL5BeMLd66YYxJpRB0gK+96LCAdYAsMnxHgVg4fwIgMrhUPKQ2C+Bz0PmBTqBMQehAbDlIjj4F80KJguSVZ0FuXpjoCOgXawLjALhbT9eOMAuAGxqvEcBWDg/l1IE05Ed0ygZnyHdz0VwCqEPIfNyx0QQvvLDFQCp+8nfZk5und8tXwIgWcHSNX0N2CJmnAl3v6RwgNnhl17T7HiPArBwfghAS7mV/hey2JS9FvM3BLpUUi1YwDRMXvkRYJoAlAh2l0dcZ04s6JUTDIjyBcrl4yDc/dLCAdYAsMnxHgVg4fxwKVwJgGEJNmWtxpQMpX9on2eRhVA+O56AjMfnP+e3Xvf3NwG4xIPTleiY55bpGh6UbafNU0l0z0p+5Jh5HqYJ6b51nP6XP8cx12XNHQVgIQB/bFPVg2OC7Q+WgVFWng/FvtWLI06uWh5oguKEcXVS/9sEAF//VGD7t4ETDgJbF4CNi8CGZWBs2fPL/H6Vwp2KEtVk4fJ+v/EIYPN9wKa5qu+IncfPwXHVZe/aOL3EbwS7xv8A1rQvnO0j8PArTgTGZ4BxFv9mIxhOCGsv+0OPYDRghcLfkWkEuq0+G00x4OtfDGz+d2DbHmDLjL8si8AYP/7CGIAiEEMTG92zXqSbH+d9R2aA0XnvO+JjthiIrOVDHHPOkBrzUQAWAPsZp3oPDpa/Xag6EVkLBK+5rAnJC3/nYk/APD704WiEAV8OTHwX2LQH2DgFbJgFNrBhjd8r79deGoEwsllgNBOzy8CdjweG9wBj08AIAci2D6HafmyAk4/Z7SJ72hGYRwFYAMDLTwOGp4FRFgD3HhzqRGQiyeurqOdG6r0Rm8IEZjzRlkiqCWoEgK8Axm4BJu4HJhyAbFhDxmbDGnZO4j0SgLGDkpibgEq66TJw/1nA0F5gdLpq+zDqFfd5LMeWqu5HNST0uJOIllg+qgMWgI+HPv0xwLA3gWHpW2sC441gCECbmKziaGrnUdMO4aHeh6MxAP4SMHI7ML4HGD8AjHvHJGNAgpDgY/ck3stipRemvVhc+uASMPUEYGh/9dIRgGx8Y+MNbR/00uVtH0wEx94j/v0oAxaA8Ed+GBieAYZZg5kADC0QWGOFzGJlcGPzl1BxNLXD8sk4xftwNAbA/wwM3wGMUmxOOQBnHXzetIYvibonmSiuYTNjriVg7glAiwBk0fNZH6+PmX9P6kfNmCXGpftJ7TgKwBIAnln14BAAYxMYm5C6RjCyCoOyr0qkD/c+HI0B8DXA8N3AyCQwesD1VQKH7EcASm1Q+y4CkN9pUKiVF5nLvy+fBbTUd8QBaH1HvNBROiZvfsNnrF4kcvPwpdsBLBeU18Nf7AB23Dp4ecHC8oBgUlJJecLS+7+WOpE3gbE+HKw+yoevCYkMGKqPJrdEKARutaFYRs1fiEZ0wP8CDN8LDO8FRqYq3W10pgKgfYLaYCzootgA6KXaTA90y374TKB1sBozy77xHFZ536utRgAmEaw6g5kUSFZwSXnA330qsOlfgHMPDlZesLA8IOjoLypPWHj/11EnCiVwkz7kAExtsGraYUWdSDX5TmsagL8KDBGA7Bd30JsW0oWivnEOQNP7yGTSBR101AlZSUtGyfgZDkCWY1HnJdcBVe6325hTvelg2CQjZNDygG/2An0j1wKnL6y9vGBheUC8prQ8YeH9X39OVQSc7Mc6fCaKvAeHdCIVf4yMYCynTpX+nb97NJmlSQb8r8DQHm9YOFUZTKOzoXGhs6AxF0HIexcLBvWBuiHN8s2ne98R3qc6L4Vyb2oBVjfm9MIFHbjDCh6kPOBbQoG+oW8CO5bWVl6wsDwgfr20PGHh/X/1iaEIuDcCTIW/1Q4rFv8OnYiW3c+W2iKwUjKbyjQNwL1uuR6sAEgDgq1brXOmV81PxhNB6DUDBSYzQJwFtz623XcktX1Q1VWKaTF/zZhVazBVYA1tX5MazsGvobwe/jQr0Ne6BTh5uf/ygoXlAfG60vKEhff/rSe1i4DnTWDUACY1guFTDqLYdCBvf6DJYSMYATBfOx1kLfj1v1axH10nQ3Sd0GUkBnTfpemtBJgseIKQAHLQcVxa2TnuMW0Aqui5es8xBIegVdVVE8VhzHnLh65WMB9An+X18K6aAn2tO4ETl6vqbKuVFywsDwhevqg8YeH93/Rk70JE90nowxZbIJjvS3WYNSGUwGHJTpPxwwcbBuBrgRYBeKACn7VtpdUu/c0NJxO9BIxcKu4TTODzbkonPLoaL0vyUQRb2y8HsL1ckfWzMeuFi40Qezqi+yiPhyt7FOjr6/gCFwgP7Xb5vssTFt7/nQRg6MGRWmDRoeyTlpgw68GRTwgZgo1gGmXAX6/8dtaylSKY/koyID9BhzML3q1gAos2AcOrZYSoq/pJp1VtODRm9Z3LS/7WjVkvXOzEtOpKyGrlAT+4SoG+VY8vBGCvy/dVnrDw/vee65NBJiAjBIVcAJQjOm+DkCZEeiGAMw6sAwDZsJrAdhFM9rPGhd4904Co5oVuCZPV6kD40Ec6+9W8dBTBsfdc3nkpvnB82fp2RPcs79dHgb51LA9ofsDV6vut5/3PnxcAmLVBiDqgevDaJLkYrpuQxzcNwN8AWgIgRbB8loEBzXDwl4cGiDGft58SCOWGedgjvOJ+bPvgRkiuA+ZjzhnQQOiFNVbloa7l/fos0LdO5QENgEXlCfs8Qbf7HyMA3QVjYihYhLENgjX9y/qwxQmRU/asfd0ZcLU2CHVGyusJQLKfVi98CS12T5f7iECkHpsMkAhCF8+nshWH2I/jXsOYO144GV/9ApAIrS3vt4YCfetQHtAA2G+/4PW4/2PPbzMgmUMi2NoeSCRxIt2/FvuxWURIWCXg357gfTjEDNIHnTRXRCpH5ugKwGl3HpMBXQc0v6WLYVm/5limj04rG762K2uYY9jBkr9+rI03NL5ZbczS/dJ+LQyoga4o77fGAn0NlwdMAOy3vl/T938KAcj121z8Bn+Y9eWQJRz8Y6kNagDh2ey5EvxjxQD8TWdAuneCCO4An1vw5vdzQMmdktwq7pLZQR+dM34+ZumAxvY1Y04uqOAJ6FsExzeto7zfAAX6GiwPaLWR1lrfr8n7f/Rl3QGzmsis+/uO71V9OFgP2gpPhgr7TGRqRUT6dyvr4aIs/pm/2zVUNbBSv6G8e5pEv0Cvec7Po7+bTtjlBRlkvAMBkDeQyvsNWKCvofKACYBrre/X1P0/oWEAnnFD1YdjhtXxR73mX10FfCHHE9pVWcGAI/S0gKsfA2y+twrFZw6Hxf/F0Pk8Ri/kpGSnMuDx5T0iACgQHioo0NdAecBUHW6QdsV2/cL7v/Cyqr5gnc42CCOcfX1VIZ/V8We9IDmTzVXwPDJiXuKXPxtDBma8+lzP4WAgKkPxCUAPE4v5GzEuMX0PYJPLhB6FJsc7MAMmkVxaYC/K9gG+F1++8AQ7Gwbgk78I7GFpXgIwFiRXOwaJZPUbiR0yCUDRk+cHf+YpwMj9HgfI8ClGPyvsSiH0WSKRuYlitLb/zHM/JOSs5C/YIC9cMQDZr/dwxgOW9gtGYUBi0wA8l304vDQvAchilFbpIBQhZ7Ejq6ZQ0/Yhil8y4j89Axie9DAsD6FX9HOK3QtROTFkviN83kG4felIY8DCeLrSeMDSfsEovAECUFsTjHD+tcB+tkFgcXKvBRir7qtFl9owmO4Xy/1G3bAFfPrZHorFNWBFwHjQAFctIghj2kBarw06If/+MM9ZqTN6DgsDojCerjQesLRfMApvoGkAWh8Ob/tgAPSKWCp8ngNQtadjmTdltvNvn3peFYhgQQgh+iUmEaUAUoXM1yRLmWuFLaE9Z+XIAWBhPF1pPGBpv2AU3kDTALzwmqo6qtVh9kJErAudABia38TC5wJgS2xIhAwBn3yhByL4EhzXfRXxYsDTJ4IvrNN2JFMxZcBzVo4cABbG05XGA5b2C0bhDTQNQLZBYH1AVsQSAAU+imI1obHyblnjG/kJk3U8BHz8xVUQAhnQIl5CyNgKAGp5LKSSCoAySh5Jj79vTagcxUaIBeRNe79g9gq+DXig4wGzy+PONfT7RWFA4noAkGXZVAhcBckJQgNgrLiaNb3paIDo1vHHX+oA9LQBi4DxJcOUPJUnTgU2NJUyROs8irGARxQAC+PpCtsFd40H/AEf0gMQkLgeACT41PiGoLOKqyrJq3K/Ya9mNyr5FusN/uPLPIeDa8Bc+w3rtyl4VFHaMZc3i9RWBM9jjzgAFsbTFbYLRmm/YBTeQNMAtD4cBKDXBTQGdAB2MGBo8SCLmEuS1AFVAJ3A/NhPt0PoCcA8bSDG76XI7aySg6JYuGfKwJHFgH0E5B3ueMCe/Y4L+xVHAOZ+9EHcEgQgwbeiEYx6jwTdz4qfu7EhEJqxGqruf/RnHIAEnxgwBM0aC8aUAYWNBRCmoIll4HTqO122QcZbrgMWxtMVtgvuOx6wa7/jwhtoGoDWh4MBJ16WN4lfr8AqI0TVV1O1fa9BbQzovkAy4Ed+NgCQUSxZCFWvCOaOFREXyUwZOPIA2GdA3uGOB6wPaOz+QPv5S+MA3OXiN9aclghW+d3IgupBF2pPqxcxGenDPxfSRh2ASiKKiVP2PaZScvAKoA0VDc6cOlIB2GdA3uGOB1zR77iwX/F6AFB9ONSOQW0frA50sILVcckWJyIDSgwPAVcJgFbYuZ3FJvAlEHbJ3IsgJLGedeBIA+AAAXmHOx6wo99xYb/i9QKg2iAIfDJEJHqj4SExbEty0gkdhB/6P9oZbBZIGiKYVb9GKaN50lRHBLOvhDxh/5EKwDUG5B3ueMB2QGM/grb7/6wHAPNGMAY+GSGUjC52VX2f2CD4+HO0gqkZfegXKgBaHkcWtS0AWii9xG1ImrLlN5XR8L8fmQD05BVrmEENmpYSP9QX+KHiqj2/82+HqqDWwnbBRfGATdzAegGwru2DpRq7Mzq2fpAf0Nq0Rl2wBXzglZ4yUAPAmDSVWDBPHQjLcgTqOZ6zUvdKHh4ruDCerox/Dnu7YqwXAC1NI/QcEQuK6WK/kdgCTGC0PYAP/KIDMBgglq+hIkrOfsaCviLSofcJgJ5AdM7kkSaCj/HqQKVIGvD4swF8bcBjmzjsaQ2H5D/6acBd9wALB4DFWWB5AVherMp4GKIYEOp7+26UF0aSfT/xYuDG7wDjrIpAERytXf2vajj7ueryQXSFl10K/ON3gIWDwCLvjfGB8Z54O+Ee4ve6513uB2R1yzsqC+twbC8HcNVhfAeaBuDP/TvwtS3A/ePAIfYFVlPq2HHTuyulZCTlhbjhETF5yxTQGgPGhoHhIWC4VSXGD3n0tLkMHXHxu+YyB+MlPwDuZs5K6FlsbCzdVO9DuKfkHM8AEkP7B8fOkwDcD+B7np42+JkGOvKdAL4E4K8P0zvQdET0b14D3DgB3D0B7B8HZka9WzrD88N6sFm+YcUjrn7E1ZDvMtF9DBgeAYaHgSGB0PNHCD4BLwLRsByAyX/ij0/dDUxuqlIG5hix7eFhvLcOVUAtyPSydAFmOQNe6EYGV/9ZESiKgIEgtbaD/gHALQC4ovY5r5KwtjOU/XfTAHzzLuCmIeDuMWDvKHBwpMoN0WQzNtAaYSs0K4ZlOSAjGG9kPjCBRwZ0ABKEBJexYAZEAU3A7Oi1BeDym4EDnjQ1TwCGWMW8MXcKks0YOyZNlQOQjcgYIUHllEzYQ0ktm+r6oz8G4F4AXwXwRd8/kO9A0wB8y65KmPxgGJgcqYJTKYpTv2CCzyddQJRDOjKivn+Deh8BF8BnwBtaCUA+YYEyAU8h+c6Az9gNHHRmrgOgmDA3jHQ+iWupCeUAvNSrA9HNwqx+muk9nJVNg/CTfrmbAPwbgK8D+PcHkIibjob5o13A3XypWsAkG1cPA9PDFQDZM1id0i1KxsWfOrKnAFXlifCFFMMRcASigOcs2MGAIfE9iWXplS6On7UbmPaUUTXQrgsVMzcRj5Folg2V5ayUA5BWYKwOxKUafnosWjcJwk+7W5F2EKvlE3xcXaNYfiCYsGkA/smuqug6hcleAnAImPbO6YwRpMgjCAVAm/yQmKTv5hNsAf/i7SyNBSl2a8Qv/4/M1yF+BZSYlNQCnnVrpbC+mToAACAASURBVJcaI7sOSEY2NpaDXLqpR+vE/OVksDgImgGgghHoYJbTWc7oJtFWc65/cg2AYvh2ALsB3AzgVv95nS/f4QdsIkT9T3cBrGtITWZfC5hqtQHInsEGQn3UDDvEDEY/ICf7SxMOrAg8T+c00JGkvHGd2DABUYZIAONzCUDppCFhSukCBsLQrFtZe/IixYQpSyEoJoqnuPWrVRAubQh83HNlZB23z7j1ywmj6CIIqUPxw2Xeu9bx2jx10wz4Z7sqTYZaDD8EIDuoE3hMVEphWg66JIp90k0sBxBcy+iPIIaT1RtEsHS/yIAqw+VSNPWQfe5tlVEk8auXgVa5BUsEJuT5uoliAbE5AGotmIAjCPnR9xDG3TQernYAUupTdBGEFMf83OkApHG+XlvTAPwfuyrgSZOhas3u6cwTsUBVn2gTwyFMi8wjHZAA1M9fYGHDULJD1m8Cpa8fRxDad+l+Ykf/3XNvd11U+qiL39SxXevSsshdDFvgbI1O2AwAtRZMZzTBRuDFjxe1Xg8QEIB8yyj5yYIUxfQIkfkIRnmHCM712JoG4FsdgHHp3ACoMH2G6jM4lWzoQarSvwQ6MSB/vporVaFkh+mCLlpVR8Z+dqDZLoDOpHSiQeAFDkBjPrlgCHgCUaFifg67H/9uYjn4Ai1vpTERTAASBaoQJBAKeNqHlL6mwPDZYAOROag/EYRkPX34MwHIvzW9rQcA+TLpI22G7EcQKlJGsYIJhC6ClUMiXfBTbFUQAej6nPS/OuAl9pOOqIc2BLzg++3VmWgIEUz82cRuCAtLIHQQm0gO52uOAb22sC3JEWgRfPpZf2sQBQIgLydPEIFGwPEj8MlF2bSbsulghLftqsCXq9HGgHysznrGgi5qzTUTFH8FLhAUn3hIJwCN0HLncw37qaF2zoYvuKNivmQIuUNc7GvWt6sHNs26twA6vhyq8NEMAHlyntFrDCcQehyaPTl+FwAbXDcmAKMRThakEk8Q8kPg8SPL0qzLBl+A9QCgR6uZGs3vfHz8TtBZvkgGQrEPBVAUg2Sij50QAOjiVKI3saADJRm7dSLYWfSFDkCem/dhZeMy9pPY5QvSDYQyUJoDIK8qMezh3wY6fSL49PcGgCAA8pScJLIgAUYQEmz8RPA17StvGoBv39W24eREiBoNQSgWNI1HBkdgxJSw1AI+dFIbgOYmkjimQ1r6XXC3rAbCHycAgytohf8vsB/r2KRaRq7zpZ+D37HMX0s3DDcCUGLYaw53MJ4YUODzusqlGCQAOQCejuxA8UULUkxIwAmMAp8Wa3qkN/R9W+sBwOhIEPjk5SLr8HeKFbTQfb77csPIMHGl/4MPbReslPhNe4+MiTpi9AFGV4nI7MfvagNQLh/pfrYnDAS8aJQ42A2w4em2cAyWQUuJVQTGWLs1uL7DG9J1RjhA+jvYk4t3KXeMqijpzrud4At9z3XtP16yGfjKZmCGooYh1tZzvv8xXPFl4PoJYC97k9FlwZWD+Azi/deMZWeP13eQCGEyoERudChIjbb3mJYwH7V0QIKuCwj/gfMj0asn2I0FXRSHXfL/iRkNgLyeVj8ccMY//J1fyxzTAXT2+xoQViKYD/1hDqLxPiYxTgSvQrphphG97tz4Slqafnj7uk1kIQDZrvWTw8B3jwEW+RLxPgSiCERdPwPR7+wCPg/gulFgfruDkOMQkFc5x84e708JAMmCuRNBXi4TIg5CGRzGiBGE/D4E/C2r2vcAYJoify62i0aJSMhB+2IHoNwu0fkcjQ85pu3ack5nIBREqneYFyWLkAXIJHESe00Cyx5QyeL6F/tyEcDcrOW2n7fX8df0mME+/vQ/PQjhoy3gzo3AISYf80MQaQx1peH9wb7v2mrtmCBkIMMejp3jIJD1MsaxaMZ8v5N/67INAsB3BAYU4JL4DSo1J15AFPAEwuQHZJzkKfUAtOHLJSOQRWndBYQvCQA01cfnNopfsaCJaD2baBn79QjSTiOEP1EcawIpkq2kegBTNgHWEpOKF8Uwq2NRFPM4AqCf46/rA2U9/uVDvurB01zvAJpiiwOl3fEeciCGF+Ij11f+QkbSfMPfIzqw57mEFZ9Dl3Ps5HXWAYByHJAJKV7N+s0cCQQhwSlfm4lGZ0KB8C/rABgZUS6ZHITBSEhCowUYAAksF7cStWREyxRwtuPpOlgw+5s9sq6OaIJIIlUgEhA1edoTgHxa9HVw5jibZNF+j/9yGQA/7pbujZ4bwv2+cWB6tFo0NzYnkxFA+cvEAo43VBoEo2e+48EMXEOmD9F6xhCE8RwZEJ80VblKvDlmzwicfqy93/o+8K8TwB2jVSgW138FrJQTXBNlnJgmrjZwanow9CBP/rL9wF0jwAGWDtFyoN9PHutnIHT05mPXz93dMGQAPniJsjiBXiTbxDZFMF9NLUPQxKR5qezz1Y6/YZDH0D6GkdAkYJIvRalAdHAMmPZoYhb6NhDWvEyf/ma737CXN7R1ZC7hUbPgcFgqt/ZZjADnM1xqEVhYBpb4CUk5UsL7jQvj///5buDrLeCOEeD+YQchYwG9VIfyg1NaZszFiCH6DkRGLze5/dgk8IMWcMCjdCiCzR8od1B8OTwvJM8JEShFut1fzMhi+eRJr6LI7hYP2M/xVLwKNoZjUTwRMAQQmYyhWGQxsSADOflZ4kukj7PhZ75bETjBpkAGahMkcrGgwhsXeCyBHBj1wmOBQwvAwqKzoFeRV8ZaerjKYAuirmPY/o9X7q5Cyr7fAvYMAftCPGAEoYlBiVtFwLjtp2U4irj7yOANbi+crHyrfCbTquJV44O0F1FrwQGIMZFqdQDyP/gGSZ8TC0ZRRsOlVzzgasd/u+zpMByLehAfCgMQCDyGZJHFCCgLZ2f8mgI5qauEcVx9e5vACTgCTwEMWr5TdIpWKJb5MvrnoocDswvAPAG4VLGg6UKeqmi4iuDz4er30oX0FP7u5moMvIf7W8B+jwlUNAzFnlZCIhvGFRCeWzrgXSSIBreXTFZSgVLHAp4UHOFuociEEsn2PJwl/XEk0dzfSojeerFg1IOo5BKAveIBex1P67lgUzgWQaJwLAKRH04i14ItgDKEtGsRnWx49b2Vkk9wUefTGrKCF7R0JxZMqxN8cmPAxWcAcxGABKEAKPA5u9lEaAbCmKMI+sDN1X3z+ro24wEZFc0VEE64ABgT180PF9ZdBcDb6JpqcPtPk+1ACbmKjJnllwyuILunEAWjZHkBsrsRUnfD0qEiC5IJfyisgMhzWhcP2O14Ro4WbASgAMQJ48SJwchmBCDFa8qpyBbSP7OvU4PQ0p2W7+LSnSJUFOrI4V7w5IoBTQQTfJ6oTSYk2mQcpGRyH2syGjIF6EM3V/fM++C1CfwUExhCsmzCaQT43lZC3e1hBpEHh36XEqrB7Scmq5dV0XZxmV8WuDFzAF9iwhow9seAGoBcGtKjqAc+1l9rLb/1igesO55ysmCrC8ei6IxRMAKTWNBi6Xw98xNTFUi0jEcmpYgRAPhddpVi9OIEPP5cYD4CcLkCooHPwaW9kV+iwWrQHT8uA1fd3F7DFvgUHUP2k8jTiogAqLoxFpDgbMj9jXSuN7i9dLIdaxzBp5XVBMIMgFEnFAPKT9qPd6A9BIGI7MfPmf4U+40HzI8nWgq2PBxL4FEkjKJixGRRFyQQPzzd1iAUzCAQas1YOmAEoFjwkecDC/PAwhKw6CxIkCXwOdVJLxTobMjBdyIgfvimNvNJ7Evf4jWtdnRYD1YNGVuG93VWuWs4Jf+mlZCCZxwP/cnJ6mXVKk2+tK8lQQVHRTGc64SDAZB3Ey3JcxyACkToJx4wHl+YwqloGDICmYmTFgMQFBET8yyYzyAG/AfWX8mCGQg0BTRoHwt9KVaPE/HQ890AIfgWK+CRAaMRYnVdxHbhdY8Wslw1V93UDsmPIj9GxgiAioRRMIJNvoti+SW/Ikd0gwAU8+XxJcbGITJPDvI6XdCFREFSknTB83xka40H1PGF9dnycCxFwygkK0bASJQSVAbAYeD98xUAe5U3jKIwBosSgNsuABYogl3/IwgFPrOIg1Xc4ZrpAsSrvruykl2ucykapkMMh4CExD5DwJfWAYAxwk4MKPAJgOIjGSEGwuCakRhemw6Yv0UUwRf7L00L9pnsNx6Qx4feY4O8pDEcixOjsoTKKpMYjSFYYjOC8Eq3Wnnr0YYS+0Tmi2HysrPGLqwASNYzBnT2Mz2QD91laxLB0gs12GAh81cf/o/OcHyJ+qj0S/zxnhUZbSyYWaL8+Rq2S29wowiWkJPan4MvgrDDGAlRe7KIywDIgR3meEDWg9HbJgApNTkXo8o0i7oVgxnEgFr8F7jEdnU5GvqfJQKQKyEOPlsNIQvyvupAGHS/Okv4qv9oh+PHxMLk8ggBCRxvAmEN+AiEzz2iQfQBeNmkh4K52hJBKOaNe/FSLobLRXCz43rQnu2yi9oMSMDxs2jo8303ERz1wsCGZECF4kd3DwEYYwJjhoNlQrgIjlYodbBPrwMAZfEmyzcIv27gs6XDzC/IR1DOgA9a6DRz4wZAsZ+LYXvQYsHoD4ziOFklna6YD3+nnU6dZ7bGDAcBUImIAmEUw/zbJ1i/scGNDJiLXmle3RhQ+l/aq57gUQCWzwwBKPeLsZ/LFrGg/ShRXAe64Ajkv30kALAjF8R11Dy3K7KRwJcsUTaqWScARou3w/INVnCH+A36n8RvM3nB5XP4oD6DATBYwGb5ajlOLOh6X8JaBKRG77+7ygGYp1bn+V25/01AzBnwQ1ypanD7KWfA1QDYC3zJIj7KgOUzc9nFbetX/r+O5biwNhyX5uSEDr5o0xsJwLp8/m4A7GaJUv/j3/5+HQFYJ3oFPPkho/hNeqBcMkcB2BAA6XrxmMBkfFAci/m0JpwzXw0TXvXtzrz+PKc/Ml/ugzM9MDqCAbz/keVjjGcQA/YLvjoguo1mRslRI6RwfsiA5nqhL5D6nscF8gfTdfxpS+/hLzvWfzMQCoB1Fq/8b3VWaPIDZqsRV64DALsZHVHs1gEvsqFAeBSApQC8pHK90Oql4UEAyvCwNeGcBXNLOPMLftgZsI75ouUr9ousp2TEyIJ/sU4AzC1e+WIFshyAHPZREVwItrrD3wGAhibTYBhxVpe/xePyrNBuWaoNp3DgFwC81O+RAepK/a5Lfe51jxr7JwA83nPXYgq1asl0yX5N48+f4VEGLATlK1vAo5YB1gBSRmsM+NFE57lcfPD5pPFWCJImtyvGgGfOAacBYO59zFglgHgPefZsXV6/gPXBYeC0RVgyJNOGYuJjPka9eHWgjL9bWzhWk0/n/wPn+k8bgFNmgYcsVflZnBRmIShtJM/m7JGibGBoOIIez9wKPP4AcNpylfbNlGfdI+9NjBjz8JVzppckZuJ+dBw4aQ44drk6j1LIY9JkPD7P4s2lwVEGLHwJnncscNIh4Nh5YMsSsHm5ndOu1BGFThJ8/K6JrZtoslST2+XHA6ftB05ZAE5crgAups5TfaL6EF+UyIif3gAcOwtsXep82eIYY9JkXpMgMp/AeZQBC2b8OduBYw8C2+aALQvARgJwGZhY7swEzbNa88IRvAVO1qkF91J36DNOBE7eD2yfB45fqphLnevzdGeBKBfL8UX5/CZgyyyweRHYsFwxYHzRNK6oetSBMDLjUQAWTPqPngpsnQK2zgKbCMAlYMMSME4ALrcnR6JYQIwsoUnjpDRstOLy7cBJB4CHUGwuAtuW2nUDVH1EFUhycSwWjGD64mZg0xywcaECoI0z5P3X5P6nWlHdgHgUgAUAfOYOYMtBYNMssHEe2LgITBCADkIzSJZXpCOnIg25uPrhgnupO/TyhwLHHwSOmwW2LVSik2pCrDsQskzNIBGIpBdGI+VfNgMb5oENCxX4yPRjPj4xaJ0+WGeEHRXBDUz2Mx4FbDoIbJypADixUAFwzAFI8KUJChMV2SUaAGc1cE/xFJef3FYRti64nkqWDrqqEhbrsm5zvZCdPCd8nHzJOLZuABRz9hTHZwPL7LnLnoNMIY2VyaKcjtZLHOAbNgNPngKe4BacfGF1pnydD+hphQ/8XV5UiEueLGnDN1tWXj/3/4cTwAUzwGPcRcFJiDpPt3FLmf5vjwE2HAQ2zPrEzDv7OQg5OSM+ScYQy5Xbo8465u/ZfLTJ7fKHAdumKxVh8wKwealSE6inEoSy2MWCdbUHIghv3AqMzwHji9VLZuDzD8cXxxWZs5c7apmW0fMBnIHKn5X7d6I5npvRz94O7LgXuGIReJSb+Xl1tzqflybwRwqf9i97BQRWomWJQ7oZVFtJoqDX/b/oGODsvcBTATB9gsfGqmzdjtVz+G+PAyamgYmZCoDjFE2anCVg1CeJwOMnTRB/DmUINVkkgia3y08BtkwDW+YqAFJFMD1VAAw6XG61R31O9/fdrcDYPDDmY0zjc1UjivBuAMx1QdMB+WAYXU8dhEU16dOSkppbcHFSrng8MHwnsGMPcN5ypURHp2xMIa7zDz2z8Gn/kVe0YomO0wEwBYKujL7v/zHA6C3AxfOVh58g5AsZxx4fZM7sf3h6BcDxWWeGBZ+cMEFiwGEHHRnDzun7ONHs/djkRgBunql0VDOSHIDU3cxSD4aEajhFXS4H4S1bgVGN0V8we7E0Fh9jVDG6Obr1LJMRwn+kOCaTEYT0dsfqZHXl/p7PrLi9wIY7gO0H2yAgCAWCWCowKrYE8nMLn/a7PQn9X7zIJPPkCcK+758y7x7guNsB6l98gZjLLYet3Ay5n0sv4R+fCYxPA2MOwLEAQLIDPyP8uBg2cRYmzFweAYilKkn+OC8/Fdh0CNhEA4nGA40kd6FES13WLO8v1qHKAfh9B+DoYjU2Ak/js/8NAIwg7OUb7LCC+WAfB4CpBJoIiTRNRmS1l13kqWh3Adv2A8cdqqp1MB+aIOSxWv6pq5D2kkIAvt8rF7BLJksN/jMqfa7v+7/Ak4B3A6ceqpasKMq5akAmlLWY37t8ZW97PDB2qALg2BxgAFwANEGcnI5JcrDZRPlkaXL4u1KJUAfAjbTQ59x6dSvdLPXAgGYshZWR6JIRaXB/NwFI8C1WwLMXzMeSwLfcXuKrA2G+wrLCDcN/IIg4ERRn0qvyySAQX6mG1XuA4fuAbTOVwktRRr2MLCoQyvEZ/UY/WwjAj3jtFJZkU79g1ghkgEBf98+0Umb/3A2M3lkBl/fOcdMok2EjkZyv8773LAfgHDDKjwNwxEUw9yailpwdxBAEYhBbAuGzG3aKkQEJwAkCkOCjlb7Y6SYyf2UwlAS+vKYnAXjfNmDEX7DEfA5CjUcsnzvbu1nDtUMmCDkRZEEyGdlAk6G6lQTSa6m0MP6HuY73AxNTlcJLZ6WOJYC5/CNxLpHMgdKIKNl69Qvu6/75AjHOiTU87gKOOViJb748BKCWrnK/maTA+58AjM0Ao7PA6Lx/xBAupoYDC9okBRAmPdBZ47lNA/DhwMRsxX7mPgl+SrmK5EaRNRslXFQ9CKB9DkADn79cZtkHFkysJ103eBbqlh97DpmTQTYgk9VNxu+xYbXKU3lhFoJPOgdFGY+lPkgQxokkgF9Xgj4AvfoFs84eX4Ke9x9fIC+tRfDxvvniif358sSir2LCj5wNjBKAc8CIi2AxxLCzIAGY9L7AhGIKgpATw4l8wToB0JjPrfTkp+SLQbHrOqm5jNyajS6VCMIpApDAWwQ4LrGgXqzIfnq5cv0vN0ZXHTInME5GBNLb1DGdOYQsI7AfGKFjlgqve8wJwG4T+fuFAFytXzCLb+VgWnH/fIGYfc46Hs7iHC8ZkPcdXx4VfVXJw8+cA4wIgM6AHSLKWZCTESfLfg7WsIyRF3ckiRQ+HACXkwHptyP4KHrpJvKVGnOhRF9eBF9wE0mUEogz2wC+WGI/vVxiQQIxAs9+rmHA6E1YFYB8DJwQMZl0OrLZ++i7sfT8zroYHLS9df4RACWKxSZvLXzG/fQLZqk2gqn2/vUCUQ9UZaM9wDaPeSPrC4A5C1KV+NITKwCS/SiCR/jRBDlLmP7nHynsxno1IPwJSyRpbiMADXzuPDYfZfBTEoAmcuVQdiaW0zwXwQsCYDYmMaDA1wG8TBSvaoR0G77EcGSET6hjOvVApfRPAUN0zjr45JzVcSqiTxD+VeGzXku/4Nr7JwDJOkxFIwt6j6+RqUrlkO4bXzp1gCAAv04AzgLDDsBhKugLFUvQUhTwCEKbnKCw14HwJ9cDgGQ9WegRgDI8XEcVEDvAl7lVlglAgi+I4CR+Zf1mLGgMmDFhBGFfDCicRJFERviSABjLS7FC0MFKMU+07wOPE0kGvaoQgGvtF9z1/iODkwn3VWoEXxres5ib9xx1wZufBAwLgAQexbAD0JiQwJOuJBA68/H3Zhk6+3CifqqwWNMKN8wjKgbk6gWJgC+FMaBb5vJVmsUbV2vCqo3cRWZcCIACoax53+ulkqNd7iqOcU1WcC9cxEm5kQBUdZ+sTnSL/jEtTWngi21jhJNJBivZBukXvOL+yYBkcOqxKjJ4AGgxzMrBVwdAMmHrZOAYF2l6y/mwV6xD17zmWo6MbRyeWtOHwxJ91IIhr6rqZS70DPPLXDVUrfBwzHKr1EUp6/h0T/6L/GcCqslt4IhoTcwdAqDSs7I60WQH6R329pHuFyuXDJmEjuOSbdB+wSvuP5bGUjmsA5XoUvcvBXKKAQnApUdXwah0b8jXR2YzJTsC0ZHB33FL+2yiX3h/1YeD1fFZGT81g/H6yqkVa9YEpqMhTADle8erHA6t7Mh6j4ZBXdBGjFyO4CSIm9wGBiBvgqxwIAJQlXIyEJLyI/i0SkAG/FbhaEr6BXfcv+5dLKhCg4z1C1HEBJ8+BODQGZXfk/quAZC6ketAZEQCTWAU8PIJt0fgwHzZvVWNaKqi7JLOmtDWFy42g1FxH/XfqGkII0C+a0tnDkfsGxQjn3VPsk7tXmuy+Xp0JhtoJosAaFcUAJUYKiYJxcqHqKAH9rPlG2cMrmCUbMX9guMLpGTcCMKDlZGhMK8IPnPIn1X5PA2AwegwEEYmDGBMjOI5whGQP3NPBT7VJlRNaKvF4t2IWHbDErtDlSk1p4lJ7/zd246tglGZryIfrFhQ7pU8WCAX0ZENG+57U14Z4YrCeLrSxXdev6TfLwrbxT7znMrfKQXfHLQCnyvmRIv0Q3430ezMmL98P393G3wqz6am1NYzzoGn+svqRmTAU2citctqAX/2EI8F9ACEmLHXLZGoFxtSl2xyK2bAYwrj6Xr12+1noL/jUTCD9vvFrn6u0v1/nvGkaoVBAQi0eummMAuXQHMWJAA7gCixG8U0gFfcXdlBKk4Z6zELgAJfZEKrxpC1xOIl/+Sk7jkcdYlSco90y9+gK6vJrRiADD0piad7RuFo3udNCgft94vCdrGXn+tujgV3QAcHLcFnroelivHkchEL8ue0uQ74S3eubAITS3IQhKkMRjBMokgWG3L//2z3VSnP4VDgQWxUEEUxAZFHL0eR3HDfm3IRbDHkBfF0zy4EIKNhSvr9goGEBdvTz/MIYQLQdVsTwRTFDj5jQmdArRDYJQNDSs961R3tPhx5NXoVgoxleHnarjohgLec3D2HI492yQNvIwvqO9fJm9zKGbAwnu6FhaP5pFuMg/b7tTbpBdvTz68cz/zI8azVj8iAHTqgmFHXDUB89R2dtaC7tUGw4kDOgFb0R2wYRDGZ8g9O8aU4XwPOczhiwGlMjqqLWiFYGu570wADFsbTvaxg8nkow7E8nM/atfKzln6/1mS4YHv6BQ4+Z0BbqHcd0NwwYbVD3+1yWhXJxPBrbq8AqE/XApSqAxiBV2MZ/54DMOZwKE00rnDUWcR5KiV/brjtSAMALIyn+/mCyeehjIYp6fdrvVELth8RAClyHXxmhPi6r1m8FM0ucgk8+y4RHC1kAK/5XgW+2hZYofafWcPq1B5AqDqEYsQ3nepR2gqhV2yiol1COkD0C+aOaoGx4aL7DQCwMJ7uVwomn4fm7VrX2u/XAlELth+5sHPtN+l/Ap6sX2dCsZ/phZkIJgv9l++1wbcq+2WFv2NXIjNKAPzuw7MUAV8DTuynFIEsQy83RgTAhiv+NgBABaQOGE/3mwWTLwAqHnaQfr9GnwUbARgDNBUlkpzQboyYCyYDYdILdf0l4NduW9kGoa4geNdazLElKoA3Prx7DofiETtC6XvE7hGEzJlpcis3Qgrj6d5UOJoYDcMglrX2+y0NPtl5UZUjkfx/Hqbecoe0OZzdF1gHQrln9Bhee4s3f3Zxm4MvAk9VSFdUIw0i+Q2PaBtISiBSSFgCYMjMW00MP7pwvvLDmwFgQTzdHxcOSGvBg/b7ZRZByWYAlOERluKM3Ra9CKWc0q73dTBhMFT4ZwIw9l5Lrpes+HjeBiGCUOKXeuBvPcKTiEIOR0f+RhDBMYi0Lhea4GTaa5NbOQAVDzhgPB1La5RssV3rIP1+7yy5OAADoAchEHBkFbKfGRpiweAPtMs5IFNokyOGk/7rAYC9OhBFwNXVY1at5tftCBHaWVS2AJdEcEinrDNC+Lumiyc1B8AB4+muLARAXTDCWvr93lR4/Z0Xt6ODFQkj8WtumEwHTKDLQejAfN3uds/dfjoQdatGLxb8jQBAYz6/boxiFgAVudzNIc2/s3xLk1szAORoB4yn+2DhaATAGJCtbpkCYq9+v4V+aBgAQ4i66XtaC85YkDog/zdZvzUgfN1N7a633Xqv6fe9msDIHfNaB6Ay2JRE1AHAEDIfI5nzZCLeN4Nbm9yaA+CA8XSsul6yqV0rJ2WQfr+splCyCYBR/HJyKX4phs0PKBZ0lqOYTpvniAiUAmAd+HKjo1cvDjHgr+3wPJQsVCymUZrPMuRsRBDG4AQCsunyJtFGHwAAIABJREFUcc0BUJlxQoH62q8ST8cggpKNAFRGwCD9fkuvbwAkyGgJE3C+Nz1P1q9/T3F1EZBxvZh50s6AEYC5yyUHXt5/Q8zI5/KrAmAIkkipkyGPYwXz1aRT8v5ZO6jJrRyAvKOvNXlLazsXs9bo/ztc29Pohgotp5J49Rcj/pzfIwGS//3OM4CNd1dpntQpFUmjEH4LYIgnyn/OLjL8FeDGhwJbNgFjI8DIEDA8BAy1PFK7FSKf43cNKrvHx+8C/vmxwMgmYHgEaA35J0StpvvzL/nP8RbLAfhyT207TChgDRiu/ZL9DsfWNABvYzbhCDBKoBAk/pEobGWTqp819hzQ1/0k0PoaMDEJbJjxVZFgDad0SaUO5LksWVj+XScDmw5UEUDJ6U4d0nVbC91S3ovfVHp5al64cgC+k7mZAP768KCA0WD3A/ieLz090CDceVmlAuhBljLgrfcAw6PAyDAwPFwBkCAbItM4a/FiNtERjBl76W9ffD2AbwJDdwFj+6syImRXrd5Y2FjIYcnzWPLEqnsfC0zsr6qBMQmfIDR/pyJ6xMhKyMrSDiKD2xja6TADTt0/AGAs1KcAUCFrOLF6tbtiRVFavT/wuMCa7MfVTlH098YBeBcwNAIMEYAUlS4uBULOmK3LCnwOPANlEIOSoF9+C4DvVoWXhvdWZVOYqWgi3vOXDUQhgieB0EElViMYJ08HxqeqnG8D4IIDkAzo51DKQQJvBKUmKACzbM4+5hUivwrgiwC4LzvjmgCh6nBcgiMTcv9Abo0D8E6g5eCjfpUA6AxoQIzgi8ALmWwC4z//DxcPPwBak8DQFDB8yJPpPZHeGCyC0KN5DFCByfh9/+OAsekKgEzCTwD047X0SCPM1IYQjCv2E/MJoGVwUUQoPboq0MdqkWVn7RtDDMahB4g+P6qhXFpjVtkDtRGA2nKjos7IyOyHFUbIrXe0FXsTuzIYfNb4O2M3ATGIYQOmPn6hG6gi3eUkQQAeAIYOAUOzALMVh2pAlESqGFBAXAYOMQVjxll03iO/yYKRAT0FQXkwZkjp1pz51LO2XAT3KtD3AIAwj4Wg05kfiuUHYlsXAJLVnP0INLM0OYFx78AzcRySeTsw2AJueI+Dj2Fne4EWKz5MA0MzDkCCkAByUWqsJzarEanzj2zXwjEGFHuGY+pYsMojzZL1G9EBexXou339IRBrC3lJGmNDuSHX+w7WC4Cm6wWxm8DngLTImgC8pBcGBuTXf/1fXnyTugnFwxTQOgi0CECyIFlsvvJfEnh0mhsYI/s5uxFYi1xZof7oOqSAawwYjRGBzYGXbtWXaCIrlvHUagX6SP/ruMVYCEbEqECXAMjfree2HgA0ESur1/0vtnNwGSsG0RsZME20/+/XWH6Mugk/yngPAGy5GDYALjiIHIgRUIrsZjM7Ax+BSx1S4pfffQVIep8dL7dMDsTGjJB+CvQxTHmdtrw4l0CovFruC2NOe975egDQsCXRK/eK634JhBK90q2C7I1i+Gt0jxF40k1cPJAB7UP2m3MGJAAFQrGei9iUTH9yBUDTHfU3B5+BOIKQ43BWtNtPcWIOzEZE8FoK9K0DCGNxLi3FqaKA9gTgeoFwPQAoI0OulWT11oEwiFz7cwbErzNxWtEYBB+VY76Vh4DWrH8IOoGQ7Ocg1CqMRLPltmxvs1/SHaP4dcAJePYyyUCRIzrTB8tE8FoL9DUMwl61kQQ87Rmy2PS2rgB0a1ci18RudEJH57OsY02y/+83/sZdBKr4FXQTApBvprGgQCg9UEAM+h9F6ugJDkC3gJPBEvRGrYoYCBX9IxEcS5K4i6cZAHIw8oXQ4mLBb35YH5d7OekadtTV1UZSjaEIPH4nQzYNwgjAHNwDuWGYpZc7lzPfX1cQur5oBorfzDf+zi0yVTuSkuxBI2Q+PhQDIUEnMLo1TBCZLufGw/ixbQa0KB8CTODjPohdY78IQmfDjmW7Yo/doAX6GqIiAtDHaYswSmeMubV81kp11L6hy2PdAcgblfslOKC1IiKRmyRxZgV/8++DS8BFrxXi5Hd/U6MeSKdqEsEKhpBRsgRMbAtuG4KU/+9ry5brzP/lPVMv1EPOQegharrVcgZUhVHFxNPcp9VFtlOWkL437C0WABWypFRGsV0sb5Hn2zYBwvUGoKl10v1knDgo0y7XA8Pfv0UACnjaK33Co9gJQAOe64FkNvtZAHQdjz9v2Nz2GSa3jYej2W3KGuZ9ixGdIVSoKT13B2s5AHkGheST6qn0erHv5AIgAAU+LVfw/wq3CEAV7clBKDDGZG9/5oVXx/oyYARczcqH5GyH8eFplTawFvAtrtXLGpNrQDGbejupB3omlIHQGc/ErzOcGSRs8zrhAbbuL1Tco/JfbLlNwHOmi2kIcs3owbdwNpYtynDQhsFcgvuG9/YapGFvYX22zZcAU0/GwA2LJ/4AmGF9mwEbBu98Y3cMF+uAGQCj2HVp3BbPuo3IlqxAy5wHAq4OfARmEBXGfNIBa0BIsG0ecwC67merHgRpZLwocrWaovuTxew/V0txJQ2DWeae3WAGbdhb2DB4+wRw7w5g8Qpv88liyGtoWHzMi4C9fAEHbBi8kwUKu2xNAdBxaGBLbJdZux1LwAGECYAEm6wyfpelJrEgFnRDxESwgyUxIUsVMwjVy5AYO0bG89Auu1/5BF38KqjBHlUAYXsteNCGwTeWNuwtk4JMkrlzGNizA1hm69g1Nix+zDOBW0aBeRZZGqBh8M4emfWNADDT+zqMjQyESdQFHfDbZECCLRgdHeCTe8CBaKJY1rDnBRCIAuGW4TYAZeFG8ZuMkGiQ1IEwGCJtHZBmy1obBsvVMnDD3jIAerti3LEBOMjGcOpa3WfD4ic9t6oveDtLfw7QMHjnH6wPAybW6yaG4+8D4HIQfvtDIVtLejpBFsVvUI7NIBHw3DUjRzL3rDVtsYPOkAScuX3coNDynT2VYJCkn+PjqvUD8hVbS8NgjphGxcANe8sAGNoVY/824BCBtIaGxRe8pLKZdpMkTvXiJ2toGHzSNHDPScAyq3er4qPyGaNc7JCRXWLT2TjwGmCOeQashq6+qSpZmp8vojQpheF58ncdZVjLnjWPHr4VWKTKxrHGUqq97qXu3jp0wPy+eEC/DYNZsZAO6IEb9pY9lNCuGPcNV830ZmkM9dmw+OKfbdcXvJMPdY0Ng0/7GnDXKcDMccBS7MwdKz8KCAKQIgY0MWGCtr4TOHAasMwOkTqf6unyuLykfd254nkb7qsw/iVg7jhgmSX31Vpd9yRHeLx+zRhjEGRbB6wDYT8NdymyubzDzCCGfpMJWfSRYfr9HP/aMgBm7YoxNQHMbQHm+ID6aFh8yS93tAvGQb7da2gYfPoXgbtPAqaPA+a3AEubgGU1RM6B060fgkRoCzj+TcD+04CFE4BldZdRc4/YxlxgjJMewSiwN1zWfsOngdljq3EmY08vm5i/7j5yIMqpvupKyGoNg9lngYosl9wY/0dZdrMzYl8Ne8sAWNOu2MA3zw/F2CoNiy99XbvftrcLriz6PhsGn3U9cM9xMODObQYWCMANwPJ49UliuW6SaqqBn/gGYP8pwPyJwNIxwDK76ahDeN6uXYCuYyABkEza4LbpY5WEWdSLxjF26/dQB0SJ6r4ByAN6NQxmkWcqrnQ00x1DEDJFjR8CcNWGvWVPp6ZdMQ6OVOCb3wAscPJ6NCy+7PerkP5Q3tBY1PrT9tEw+JwbgPu2AlNbgVkCcCOwtAFYcgAuiwWlM/XqDjMEbP9t4MB2YO54YJFMo/5gHIcALV1TRZ17FXOhPtvgtvkqf9H4kvHDlyKK4l6VzvVSBF22uwjOb7pbw+CfcwBSkyeFEHAUx/yw9JTyEbo27C17Ol3aFWNuAlgIn9QxO2tYfNlbK6MvaxeMRYquvL9rTcPgJ30TuH8LcHAzMOugX3QALo21WXBZLEHwRF1OgHS2eOgbgIPHA7PHAezNu7QFWFZ7JnXJ5rnqxHEulvlzwyVNN3+wern5Yovl7SXLGwvn4riLWO4fgMRJXcPd/+pmOymELEhRzBxJAo9gVL4kwVnbsLccgHEpWi3epocCAMeBRU5eTcPiy/6qtl0wpvhA+2gYfO7NwOQm4OBGYGaDs+5ExYDGgqP+ccAkINaVpB8GTv4d4OBxwNw2YGFrxYCmV0YxLNYheCXau7EhV3ga3Lb8g4+R45uoGLADgHWqhsBXA8K1AZADyRvuvtkBSArh+i9DsQhCOtf0UUgW/7aiYW/Z0+nRrhizoxXwFhyAi5y4rGHxU66qAFhT3rDSIVdpGHzencDejcDBDcDsBDBP1uX1CMJRwFiQIBzxieL3KIY1YW5MPOxNwLRb8gs0aghAss1GZ1O+SFHsdRPt0i/PLHu++dFb/x4mXfhcbWxhfCtYMFr/uWvKxfDaAcg7ipPCvFOVpuo3HrCjYW/ZA+rRrti6TS6MVQ+L4NPH2nx698GnXF0BsKa8Iab4dFZpGHz+JLBvApieqAA4J8CPOQuOBBAOV0CUYbIskRkAecrvAdNbXc/aDCxSpyT4CEIyTgRgneiLIp3nP6fs+a4A4N8B8/48CUC+ZGJA29fpuLmxJW+5h5kNFg2jiWHSi0r0Uv4pCoZsxw8DUfnhd4Vk0XGdGvaWPaBV2hVjdjgA0BlpkQ/K9bmn/HOVqtClvKEBqlfD4AtmgP3jDsBxB6DA7tdbcvYzJvQJkii2n4NOeMpbgJktbYPGACiF3wFoEx1ZMNe/4jnPLXu+KwD4t/5SO/iMBcXuesHylyACMBPDgzGg7opM8mEHIGdwrfGA1rC37AH10a64Yr4APvvOSdwEPOVbKxu+K2pdKRTmdI3dqkPPVgbSTBGAY8AsATjWniBdx0QxJylOFCcr6HBiw1P/CDgU3EgEIMW52M8YkLolQRddIN1AyKWiBretf9MJQN6HsaCPxe4rvgDdHOcOxDIAcmDFDXvLnk4f7Yqt63gEIB/Yoj+4p9xaAbBHeUPM8qF2aRh84QQwNQYcGgdmx4C50WqCFngNsgSvQ+Dxu4MuiawhwIAXVk1O+e/A7CZgThY1dcno1nHL2oDIyZULpBsAFTBZ9pjT0QQgn2V6ufRicS8QRgbs5ZYpEsENDejBfpoLrwAOjgIzZMBRZ0AHoUC+SOA56xJwNlEyTFw5FxBPeWvlzpnbANCdQ1eSGTRybMuydgMggVBsKmtYoC6Mt8znZxsZMLzAxoAOvsh+ydDqtXx4FIDl8L/omQ7A0QqA82S/ERdTI22mNfaTuBIIxR4BhKe+y61punQC+MytI/Zz/c9EuvyBeetLAfGZ5WOMZ9j2/gqABB1fMLsHAVBqhfTcyH5d9MByEdzs+B50Z7voGZX+NzNSsd8cwUcG5ASRKYbdHRNYwhhDIHRgGmO0gFP+HJh15jOXjnyKblVT5Cbfoq+yJOszF8P8+VnNPlICkMAzds/YLxlYznrJwIpO6egTPMqA5ZNDAB6iCCYAyYBcBqTRQ0e4630SxZyQJQIvMJ8mSeLrYe+p/GzGfnTpEIBy6US/out+K1wg+brs88rHmDOgAVCMnrEfxxMte1Mt6j7u9zzKgIXzczEBOJIB0BnCJoqgIfDEhM58SWzJEPGJe9hfVH42un/Mfxl9bgSiBySIBWnAJBDGEDAB8QWFA8wO3/a+wH4+rg4RLPYLul8tCI8CsJmJMQAOuwFC9qMI9g9Z0CxhZz65K0wfFBPqu7PEyVdWAOTHVlTcpxhXHZLz1w0ZA6EDLhkCskRf0sw4dRYC0PQ/vVSRAYPo7QCdj7GqVOSMeBSAzUzMxZcDMwLgcKX/zbv45SQlHXDIgagJc+bjZBqAWhUoH/Y+B2D0J7rFa6LYDRmzomsAaOeKqxEvbWacHQB08JkRIteSXiSBLYJOLB+X4xrzAzY7vgfd2S4RAKkDDgPzNEAIxMASSWF38WsgkuXLyXTRSRCe/DduSZMBMwe6ObTd8JBj24Aot07uDObPP9XsIzUGFPs5+JJ/M6oT4buxHv9X7BeY8KgOWDg/Z58GTC9Xq5FxTXOw9c3Cm6k5fPcjgbHbgAlvVG2tH1T3Oavoq6BlniZ+12n5u/2sDbOvasqoFg8x2Lnbcd1GdhSAhXN+7qMrAC4sA8sORJ6yHwD28z+Ft4fdv8UyqUDrDmCEBcpZ39kLS6aq9l4D2rLb/KYsFTPWdfbvh86vQu2s1K/K+zIjTsXIVQ9a59Egs4Y6sZfIA/EcSp/jEXv8BWcAhxaA+SVgSQAkGAMICcwVlNLlqTc9Gbv/HAA7MrL4+f1VlXwrUq7SvCoyGcrrWpGhuur2fNGYwM8YT67hT3s1LaZvqn5MLM0bzmHMmIFSgdFNj/mIBct63NhFZwEzDsBFgpDPeanNgATfCtGsX9TIKwNrg9tuVkhlng7TI/YArX1VkXKrEe1l2SynN1RCsFJsqnQv3UIMxhwIRjU5AGN9QUteVz3BUAvahuNgjC3HxLAND7nBp/cgONXF5wCz8xUDGgCjKPbvevlzcKUHH2ag6cnYzepYBB9Zi2FxDJdjoXJv1WDFiLJ6MKqKZUzoQFTfj2HmwTKcTpVWvcxHKm6kKgoORAEvVclPD6NdzLXpMT8IYNPcLV7yJGB2AVhYrAC4SNA5AxKM9ryDPE5fs6eeVKWGZ2M3S3MQfEyJUKV8L1ZpJXpVJ9pLilmlAxWkVJHKwIhjjD9TtVXVm1HdOy/pJiaMFRWM+bo0rWl4yM1N7oPhTJecC8wRgAttBjQWdBBGESwgSiV0Pb9DRgu0TY19N+M1mRKh8niqFx3rRDsLqjgl9yaGXT80vcL1wnE252PAZCzAHQCoiqoW3yYWFIt664fUpKaREr1NPakH6XkuOQ+YDwy4FMSwgU8GSRSz0UJx3Vx/5vFNbrs/EiLRY+v4ACITww6iJEodQKwBIyBRv9vwhKzUW6z66TUGEwhDS3ezqusAyNxnJn8xa1KRPSFts9YfFB/QDZcAm78CnDBT5U8rCqjfc3yh8Gn/hGd/MsKf1+QzYJ4891Jye13iy1cAE9cDJ+6FpYrEkidxDN3OtXR+FwBGMezoMmxJLOumAuD4J4rxJrfdH/XCoLGFVKiUbw+LAPQqWWaMMLrd6/+JycSIm85w9lOpt1j1MwAwFTiqAWEUxeYH5ENn/jInUVHeMXQ/f/jRePvCa4DhTwLHfBc4frGqqaNJzLPw6iZxV+HTplFGvZrXZT45N39+HW3TujlZv8D6fp8HRq8Dts9XIOR5YtakgBgdrrrt5Qsq8Ssd0BhQ4HMwmVitAWHAY/LbLDQNQDaTVJ8Q6W4qVB51OOqDZDPVB3TLOBepW5jmqaLbec3jGgBGMSxvvemDYkQ9GoKF1ShUCSKCqBeQrvmfVZPC1keBjXcCmw911tTJ8q5XgOLaQgA+x/OdWA2EGZ98gbjleTHdQHQN+2iwls3nK3/Zhj3VeQhovYzdxmArSwQgDRA3QiSCJUrTnjfl4KozRCSCCeYmt90EoJJbVCk/1+FiCwFZxLk4dRfLFia6x8LbYkD9v9cXtLG6+O4AYQRfrgPygVIcqyhTXcWFOJH8fh3rz7EKwnUArq8mcGwK2MCC1i7WY7Zenh56feHT/jE3yliE4TZncd636gPFCKWavGhcRx2J+cvs9MlSw0Ty3cCm+c7n0G0MExdW4BMIbTXE9UCynvyCCX+Ovm4gbByA/xisVgJPpXrzLj4EoRJjJIZrWHArS9iprK+KcefgiyB0XVKGjOmCmW9xhRVMUSyRFnNeFGEdI2q+/HFXclkp9WsAbgTG9wGj08CI64WxRk/OTDcUAvBHXSLQxcVCDMQSWbzv+1e7WVbz+k5w2tJtsbcCYV6WJY7hmAsDA7r1Sz3OgOgoM+KTOJbcjSI5yGIaNE1uuwlAAU/MF+tF5/0sIghVLdVdM2S0bSzHx2Mi+FTxXf8X925NC4BycK8QwfmgVX1LlcFiykEMcL2BndJJ7aQfijKfxLGDwAhByM7aC5U4qwPzNwufNnNuOH4VZaCPlPo2AahqFqoPVFc14ga2m+WEEL0cAz9kdPrOmMu8r1o/rTsXz7f9oswFs+jO6LAqkvC3Ggg5Fg6mwW03CUI6X12h8lyfcz3QHqr3DIl64DbqaQKc9mI87QXACD6vpJqY0EVxz2CEyCI5eMSGX2e7VtI5J4yTRyZhscrvt1nQuivOAaNLlYESwcySgiVbr37Bfd0/u31yEgg2FVaiPCeVOguqAfGov0iR0R9JABJ0bnwk9nMxw+fOh55EbgRhzozrBUA1polN9CLwok5HEEUQBjFMQB7D+j656PW+IrJ8O/bBCo4sGFdGejqiyYCx3mKe9/JtTiBvmI5OFiTisg9LtJFF7gZGDrUbHKs79+hyu5hSaUvh1foFr3r/6vZJCiXgCDwVVFJ7MVmRLsrGltuFCc68yFdACMDAflwR4QM3HPoKgIExt4gz42SuaQb8hBOE2oZmlu+KFlKR3QSssMJxDPWbbjpfLoJrxG8CYT8MKGZSVTCxYFTIb84nkCxCIPLDiby30gXFghaF4c2ReR466Uu2fvoFr3r/fKAEFxvpqMcd9yonIrkuK5LLV7MVCM+/uDJCyIC2J8a0z1iwqyESgMl15Sa33QKgmtPEBnp11mwuXgO70Ud4DHWzfgDYC3zBEOk7HlA6XKyHQzb8HgGoCSQLqsxorIy1Bxie7Wx0rFaf+wr9Xv32C+56/7HbJ5VHtRYT+GJrsehHcya57PyKAQk6+vBkBZPpjPEExlwU59awg3C24W6KBsC6tqHR+MidyVG3i3rdAnAsH2T093XT+zLr197MTA80h3SfsZP2UqpCrPQ46oF317VrpeiKXTJ9MhMLkgGdCacKG/mupV9w1/vnwyGgCDCKWzJe3lqsyzLWZWe6/kc/oKzgKH4jC7oolhdC4jiuzM0WPo+cPQ2AsX1obFCTO5Jzn566PwbReiwnfTWjI4KvDoh1juh+aT+WKSYD3i8Aql2rJk+VsVQly5kkddv2FvHT61icqO7Fr71/IkLNXOi0FQjV0046oBy6wZ922Q95ICqDEaL4XWw3COcf9Mw73DFB9AqE6wZAAS8XuzGQIDKf+oVkqxt00ttAc+YT0PJ9qRFSB8xoye5Xu1ZVeCSgCLbYLVNswoncHxoeLwCzBGjBNki/4BX3z9lXgUCyIIGmhova83cRgO5Te9yLgP3MfmsBS8xs8/U67ePQOqy9umBUruDchqo8sHSd3PMfT5ifo+ack8eFHI6QEcnT5GvdOnVdXof+ptJ+BVPWceiaRHA8Us/nkACo8mzqlqmWrbFDppT5A5UIZm7CPA2Vgm3QfsEd909kKIqB1qJAKCBG8ZstZz3xHOAAiwmpDIdng1maZQAkZzsHZ537YfQrwNyxoQ+HakrnS0h1mUA1C96TdJTmORyhC3oeqdwROi+GDhkFI6bYNrcNDEDeAkXwQizPRpmnIs3OdqZPSaRFUcbchHlgie6agq2kX7Dd/+d8lUJVXuUzk8ERmS+2vfd4uvN2VOV5rSwb0y3JhgIh9wJeN3YMQCIgR78Q+nDEVYBYZUrUpbXFnM7COSdf7N4IPvtDnT2BY/h8Chh10MXQeYGS+7GGjaQiABpuNIFiECnzdWJMIUHcazLptC7YivsF8/7FgLFMqpiQL5TuNbKfA/DC46rqqAbAwIKWK+timRUBEiNGsOQsyQm+Gpjd4n046hbT84KPuYjOmHHyp92gcgDS2OoIuVIeh/xyUkaVwyEWdLrewHE3uBUDcKIwnq40HpDXL+n3CzbaKdguel5VnFJl2awaghLQBTzteZ0cjLq2A2n0M6EPh2pC57Wg41poLzZsAZNso0Hw6eVR/J8bF9YjWGmVCpGKwQLBRCcrbiSxNLgVAxCF8XSl8YDHHFPW7xeFBRwv/rGqOKUBkODzqgdWPYAM53vTASMQu4Bx9J+69OHIF+N71F1O1gUB+AsBfFqKC+4Wi4BWX+CYgOTAU36wdMVNVKka3MoBWBhPxyiuko3xkSX9fvGMkqsDlzzHC1N6SQ4DoINOe7KelWWTheziObeKCdARApD1AdVnRH048gKUAmAEYi6Oh4DJV4VoGDWqjq4XLbO5o1jBoimEPhPJmwu9FvnTLgdgYTwd2wyXbMyRKen3i2eXXB245FlVYUpVxUpGiLtmGBlrTEhVUwV8dEkVKAq3MHJ1uzRbRx+OOgDWFX6MsXJU/36lJoEoA2AKvw8+uwTEDIBbStdOs8ddDsDCeDom7ZdszBIs6fcL9ror2C75US9IxJJsEsHdGFBil4yYuUwknofJgF4XcEUfjrz+X7fKo4EJJ//PkMORO6FrVjQMeL5kJhZMMXzLwNZCt1nzDFgYT8cQwpLt4hDON0i/X7ys5OrAJVe0S/ISgFY7j9ZvnQ7I3+lyqpYaL98CWp/N+nDkZdhi6bW8An1kP3fRTLKVWlwF6RZCH2L4zDDR0k1IqeTNb2OQSYNbOQMWxtMxeqtkY6I+ny9VEz6btfb7xc+XXB249AoXv85+tIBVgJJ6n4lf6oV+mfjdDJNMH0wAVFX90GMk1f5TxlS3Fggh92DyN0IORy5665KIfCktsl+K3VsGtpVOWOMiuDCerlSnjQ2rB+n3C+pIBdulz8wqonrNPLKgwKaC5B3s53qhXVq6oDNg6sOhqvqhEr3V2VNLBjmnSSNdrOLJ1zkAu6VPRjFcFz4fXDJ8i45hG94Gt3IGjOFYA8TTlQZ/qGH1oP1+8ZtlT1MAtHK8mQg25zOZUSCLIliWcbw8wfW5Ln04ssqnHX04euiCk6/3de66MPpuAQVZAEFkw2MKFw6a1wEL4+lSBvmAOMhD8vkOkFX77feLNw14YT/ssmc4A6oOdHBEkwXlgjH2k4Nal6wB4fIuX9LzZjAmorNeHMo5Tc0OewHwDTUh9HXxfGJsYkAbAAAgAElEQVS/uvCpoAcew6zBBrdyBlQwwoDxdLZWXLDFkHyF8xGE/fb7xR8XXByAAVC1oB18HQYIT+8uGfP75SCUs1o64he8v4j6cIQ+IqkPhxrBCHjdjBH6AblQkAeY1ondukSiELmsUPpjbyp7XuvDgAXxdNZVvWCLIfmKg6Bbhrjup98v3lVwcQLw8gqA5v9zC9jErutltg8gMxDWWMBaMVkmANWFyEV6R0uH2I1IzW7ypbkQOTP5f2ch9KsFkwp0kQlDAOmxzHpscGuGAQvi6VD4RgmAg/b7xZVlT5MATNXwqQc6KGwf2U2uGV2uzg3D4ua7fDnPwZcKgIdq9GaIBPZb0YdD7hgyIFWMXiH0eQ5vXS5HcMkc++9lz2t9GLAgns7KxxZsCkgdtN8vWD+vYDMAUpcja7lOR9eLVcIP4tcuob/3AOHCdW02VTX62ApB4Mv1v24gnPy9HiH03fJ366KYHYTHsgBBg1s5AxbG0+HLZaOp65i+ln6/YM5EwdYBwGj1cmUkE7+8THLNdAHhwrUOXtcrO/pwhF4cct2oN68BMDCfmsJM/n6PEPoYPp8bH3kCkbtjji2tJJA962YAWBBPZ0WBCrbYsFoOf9pDAiENk179fkuvf9nTXewKcBSjsn7ldonWbgQpx+26otaLIwAlfi2QQSJY3Yjy5i9dmsFM/oEDMM/Z7Uf0RiYUA7J+ToNbOQC3e0WBBm9qLad6HICG1ZK1XB5PoxnuOOIcxSXe/Of8xHV/P+FpwN47gKUpYHmuSve0pKZgCKSq5wqniWE1WZz/xouBm74KTMwBI17lVBXwtWSs+8/vL45Ff3vhpcAnvwos8d48DZX3M2hx9XIAnu0IIO0chu35AOgLL0yuG/jOmwbg028G/mNz1YWdETbm4I5BrFlov+EtD2wIo7l+Atg8D2xY7iw3V5diEqO54mnj6XdMAYcU+6gon7A3NSO2qFjlyZYDkAX6uD5Iam44YaUfVNDNxaJcLIPXcGGpfi6PnZdVD1wPspQBX/wl4OaNwN6Jqg+xwrxslcVFuYJblehkcYYZGPS3L20BxueBcS8nwg5H5kZkx6TQSbXFZcCQKadx5Cz5mPurAFxrRaa17pAR2PFC+ElSHKQ/0QjQcgCyGyM9v3SnsDBRJgL6msWCf6IfWeUJac8UFlpY8500DcCfvgb43hiwZwyYVhd2D/VSrKGAmIDnBkiafEcN9cprHgKMzgNjS1V7rRjRlceyrqif6KAkMgXIM+6tAnDl+zSL36O9+U8p9jGHQo285/2XA/AnXeNnKAorDXH/AILwbSvLEz6Ql2+cAf/3XcCdw8DkKHBwpOpFbE2wadzIdyh3jjNQirYWEwYq+/zJwMh8pf+xKNSwM6DZMmzNRRbM2K+2Ii6TlFrAWfd5V3i/F7IgT2LBF5LbIdkqxLPWvtzlAGQ3RpU3Y7AiixMxLOUB2t7pKQ8M0qCTnp8HkojJgNqaMEJesQv4AR3Iw8DB4QqAs+6SWRiqgJgY0HVDAdBA4Ba4xN7ndlSFAAjAYX4IPO5dBDMAdS2i+Jx7XTf1eEdTDfgAQnR34p/wQkRmjNAoByDT/ugFphXAmjAEn8qaPQAgZCs0lSckCNmVigEbFMsPBBE3DcBX7gLuawH7hoAD7EM8DMw48AhATrjtQwiXoqkTEwWd7LOneXNCbz6Tiq/TInb2M8ZzIFrTQbGiy92oGz7pXl/7jvdAJnb2470IbB3T77Sai+hyAP5voTqW6sKwFAc/TAdc5+3dvcsTrvPVYSK4SQb8xV3+6IaAqSHg0FDVh3iOIFTIFxtit9orL5Z/LD1Q4s+B8OnHVuXwhhdd5DoLGsgCCJ04q66X/Ju/vSaeAxDPvbdtmdtKDV90gVEPIl/xySkviOhmAEjrlzSkwj40SlQZYZ39I+8JBMx8mZryhOsKwqYB+KpdVSDFvhYwPVR9BD7uyX4SwRS59nNI+bRck/DzJ05v12M0nY8fAk8iWL5BB5qASPGRCi8EVjzv3mqpkC9ACrrwhKukB67GhpqRRowQMqCiYbj8oOoHeUWpdYIBAUj8c8WjrjyhNIJ1unzjDPjqXdUjJAAP8TMEzLYq9uOHICQALe/EwWe+QgddAqCzzD8+vgIgg0qp+5nYjaDzCgjmnCYone0klqP4JSgvvK+6LoFPoFMlkPGh+0rPWta4RHTNJJQz4M8EAGoNTPVU8opS64CC9zoAWTFChcq7lCdch6s3L4J/2QFIEBKA1P9mHIBmhPh3Ai354RyAAmWsR/PRs6vOR8Z8FMPS97yxtIlYgVB/I7jC0rIKSfLXF1EEB+BFFjQ3jCLA49OWsRTTEPzvzQEwry7VrZ5KwzAQAPssT9jw1dcHgCrORQCS/bgn+1HsCYQSveaHkzvGv1scgU/6R55Y1YIxhvOm1EZekQWl8wVDxJgwc88QiJc6AKX/meHDawX9z16M/Em7bO8Q08GBP/jEkAEVjMBoAFWXUjRA3KtNwOBXW3EkAZhrALktpC6lKtTV4OU7RHB+3kHWgv/zrnYZl2kCkF4uF8MGQGc+MqEYUCA0n1tkwxbw4ScHAHr71Q7W4++c8czwcBAmHVB/c7Bcek9b3FuwbdD/kjGWgzJjQ3thGmVA3jhfOyU+RxB6FamOFp8NrhsTgLy8Cpzm5QlVptAU+6CiNgXCaIQ0BcDYV8b0P4pi30vfIxD5+w72C9aliegW8MHzqrmh/meuFhYi0pKbs6D9fsh/n1XFMrYMbPgUByCZz6J+uEknDA9AornWFRb01WZEsACoHhOqyC7wdetT0QAK2KqOb5MCUvPyhLE0oQxzqaYNXL5xBvyVXe12vByLADjXAvgxBvSPGFGMIjCmJbEW8HfntxtQmxT0cmxp9UPAdKAZ1upA6EB7qgDo6oCUxXRtPVSpAwJpnUhuxAqWCCYK1MBExZljY5S8SYr+pxAFAuBayhNG26jw8usCQLX0SAAkwwcAEngyQizaXoziIli+Oe7/9kJvNk1LmBMe9ECO3XRB7aPeF0EYHNVPdT8gj016YBcWtBfBVYJuz7mF7VgGY/pO8f5WdQ1/7U67nIKNS7j0wIbDPFZsyNHHY7od/xdlEHj8CcC3TgCWHgGAPSxiSdt4312u/8SPAl8/Dlh4pDeZW2PD4J1c9+uyDaIDkgEJQKnTfG/N8nUAmu5HUnMW5ARbPfEuIHy/ACjRK7FL5pOR4RaxgTHofKl8r/S1ZWBnAGDKefbn3AFIPRPXB7sFiVQimKVgGdl5ooNwLQ1/1U+DQGSXQ9r5Evy1q9rZbP1lGQDZsPpzI8APHgXgod7qUx11YtBbFzC+/C+BL7SAWwhgdoLkONSLqy5oLogYft3ZI1F7EAC+phsAnekokhP4HIzml/PvthQWmPB9LJ7jxkcSr14jWj4/0wFlgJD5eoDw6fe4DzAYPHokWhHJZ3TFSkn4h7YOSOBwEtiMTv1aY0uktFYTmI2/43EMQmCuAJmUE0gmVD8EFdPpdnxhVhqzDr8F4NMtYM9Jfg98EVTeNu9Q2OFZBX7vr9vtgm/lcezczZ61ZNN8DCvilYCdPXqNDQpAlfGTKm0M6AA0PTAyoMSx64cRfPQHXsniOTI+fEWDFGp+Qb9BeySRBV2kpl0QxxGAlHDmkI56X6z+EP7UDYSdRgh/IouwIZ36lHabBE0GJ0r10Rgb/xA/tt/j/6aMAf+7R4CxzuBXWRGULwBfIrY6UNfpvLae7n0I+LO/reoLMqiVMbW38oUhkNkQIzZO7tIweGePcmWlAFTjAYHPVGwXxWoLYblEDkLuTT8MDPhXLJ4jALpaJB+ggU6xfgJknT7IKXIQXh4Y0FZCog+wxiUTwSkXUbSMV1rB/A31OXWuFpPUda/mRHKi1e6U+hA7Zq7l+A+UAfDtHg/LrptkQpZ727cRWOL9542Pa3rOvuOqagUltgtmJM08j4/PILbIDKz6w5PAHsbraTnMGdZWIwIzxIfeK0rn578J3LAVuH8CODRahV/FFQ/1IumIvXP1QudNfyNT8oVqcHviPcBd48A0g2RDuoDqHdb2SalZAdG9dnfDkAE0gXnH5ijWCDbKCq5/MRiV0QD8HgHQ63jG0hdsLGxA3x9Bw1Asli7hO3BwApgng/Gjvq01IHrXJ7q3Cz7E++YziF2rs1ZLZ+8H9jJsSoECWXj6igmR87aLgfbGq4GvbgLu2gjsHwdmCEIPSI1h+SkCRjpfUC3iNWcpoRrcnrYbuGsUOMBo7QBCxSTG/igxVcBIVGPWM1h1JYQPnyKNExGZMDIJ9b66eEBGxPDY1Y5nv+GCjfGAxD+DDpiawphABWZPjwNzNLAEIH4XCH0M7/5c93bBfI8Yk2cgVAdvdT10ifDkBWC/r9lGH51NhIsnsWHOfPmEUKT94WeAG8eAO8aAfWPAwVEHISNQlKQUglJjJExqC+H6Nq93kOpUg9szbwLuHa66QzFWkaFieXxi6hgVHOMCYGRuJ+5V4jYJIDKI9KlsAvFDq8QDrnb8NWVPh9EwdFkQ79TlSMIsN0Mi5s9MoOGno4U6f3YAvefL7Y7rvdoFLxOANSA8f7xSgWmd0kCQbmZ6mTLEnJ0UqWLhUkxlrBn6n3wWuGkYuGukCsufGq2iojnRFpafsU7MDxErJuZhYCsJosHtWTcBe1oeq+hxigJgXBrMmTBPnJKLrr+VED54ibHYvZos8sO+DNcrHrDX8YVVyglAKud0LtMjFPtNMz6QLDY7VomLJd671AEH4Xu+3g7nWq28ISvX58/hguOBg8vtFQvV/hEzxfqOevuTfpjri8vAWz8L3NYCfjBc6ZYHmBcitnFd06pxyb8W4gPlgonBqffTtdTg9pybqiVNBssyUsdUD7eGO9amnf3sXtxQipl7Wg/sD4A8AwHIyZMYky50Tp/xgN2OL8y051qw2hXzwRCEdT2nmck1RxHG+w5jeO9NFQBpR6ldMIMXlFWgVndqF2dVFsJzuOgRwMElB6DcI6rznemD0RnbwQiSRS3g7Z+tVIl7PC9kahiYZm6IizuLigliT/VoUog+p8P9l3wJ7qGEanB77k3VczroUToWLCsABud4ypaLCUoxf9i/9w9ADiICULrQRWuIB6w7nuZrwaZwLBGwClSqSyz3AhHbaRGEFGOmC44D72UVgjW2C2Z4lIF4ArjodODQcqUGqAxfcpG4mJVuVqcL5tbs2z/veV0tYK/nhTAqesYNHdO5PCJZos+WuzxHJIViuXFyJxupNLg976ZK2lizUKodilGUgzyGhokF8yw5Mf+qRkjdjfuDtwkkm7DTkNaBaQ2ox1q3eMD8+B6O3H6em8Kx1Ccx9ptWl9iYIUAAWrI3I3nHgPdOtsO5eOuxXXBdj0V1vOL/so3Cxef60tlSpYwveKf0pAu6ohfdJ8k4CUqgvr5jV6VGTBKALeCAh+VbZLTnh5gu6D44A6H8cVlkNK95O1WkBrfn31R5HSy+JCwPplAxRegE/2T+AloGncNmbQyogUQx/KwB4gHj8YWNTwRAOW0FIIIndoqNkTAxz/bd09XDGLBdMM6/pLKi5whAX60gCK2ujxzEAqGL2pQ1Jis5AJEAFHvTujYAKjRf+SEugm1d2COQLU/DAwQ44caEw8AtZzSIPgAvuKkdrWMM6M7xCMBoiBn4YpCE2NCfxWAA5MEuwvCCEICwlnhAHV+YORfDsWJGgPpMKwg1b9QpFnzHbD2BK2JGul9s8KkYW17vLALQRTCBpzXZpS4gtCXXMAkduuAy8E7PijPWprXJ5CR38ygw1fJDohh2BlRAgq2OeN7uTWc1D0AFNtmL54ESBsCaJcLkDajxj5ZXRiCIGA0waDwgjy8sk5+HY+X9ppUbJSCp6TnFCMXwny1WAFQ8rUAc2wUrRL6mXTAefWnFfnz3FpbagQKLAqAzoZjAKkkpXkNO5GCEvOMLFXOnnC4xIKOjnQGNdWSM+GqHQGd7JSsxUf+JzQLwhTdV4je1nQvr1MkPGtlf9yP2Dy+gAqZ6rQytfvdHSDxgLwBF8AmAYjHWluEDiKGMiqOVvtejXTBOuRSYJwDJAARgZAGWL9Nk+IM3SzgTydE4eec1nZHbtDaNAf1Dpd/SMx2END6kD0oXtFhBXmcY+OY6AFChnKnzl7NfdMR3qCAae2B+VVMYXASvDs3/X/zHJZcB84vuiqABEo0QPnhnwqQLyRURmZBPytnwHde0M1vN2lR6picoKULaxHDIEdHkW2iWg4/7b5zb7DSQAVd0/griV2JYojfpwRGEYsGBrOBmx/OgP5sAKANkcbFzNWTRnX/GSGImMYH/LYlk+gGvdT+bW+SWH+Ig1GqL5QeTtR2EYj5LVHfjw/ZDwL8yJ6TB7UU3VVoTjTYxYDK+Ivv7dzNAZIxpZSiU8jjKgIWTcykZkBawDBBnQdMr5QeTKI5iWCB09AmEb7+ucnOQ/aTPWn6wuzyS4u+R0Ob6CUGqJpIDA97AdqINbgRgBJ69CG4Jp6q/ckjXqB/RKla4WpkO2ODgHoynigA0JiLwaNiEt95YQKJ4FRC+7brKzRH9jZbN6iJYuSHm9I5iOAOhHNJfZkh+gxsBKPbLu3+JgaWDdojhMO5kkDWSlNTg4B6MpyIAjf3IggJgMD4MCARjFMU9QCgAykhSKnUCYHB9JB0wy5aTRUxmup4h+Q1uAmDs+hpXgFLnB6ULONOn5xACNJqxghsc3IPxVBGAiQG9aLeilWUJW1FvVXEN0TKp1C6At19TMSCBpz1dHtT/JH7N9yaxp6QkF73KBxYIr10nAMproB44qQGTj6sjUrtOFPtLeFQHLES9AdDFrq1E6M13MaxVCTNAXNFThIylLcor40zxtgDAPKuVwDMrOKw+SBTbtR2MND7sZwC7Qvm4wqHa4T/uIrhb+7n0EgbQdTijoyg+agWXT8llDsAFWr/B8qP1K7bT0pvtVwHhW6+t2C/m8svvZlawi2CKe37nhFtapkDnILRqBQA+v04AjMyn79EIkXO/DnzyCBwVweX4wxs9B4rRZgyPVFqykgDd+5JSpBU5r0vHyHz+jsc3ub0KABsZMCyQgeExKyFPVIz3lmcM6OfPAGCADYPE67Jfs6h7G0o+xvi7oyK4cLZfOgpsXwC2Lq9MwuuVERonKn4nSJrcXnQKcM7dwMMXgYcsVxkSebJgzOWPqdB1ad2f3gpsnwK2LXWeR9m3danUIV1lBSCPArBwtp+7DThuBti6UDWDmWA/DvXk8LRptfPtNUlihYZTOPCi04GH3wFsnwGOW6iAs5n3GeJJ+KLoE+9VDClQ8R6vOQHYegDYwuY3S6H/iJ8jb11ck0q9Qhoc9QMWgPBZJwFbpoFN88DGRWBiqQIgWyJY3lPozaGJ1KTEPh36zpTkJrcXPRE44S7g+Cng2DlgyyKwaclfFoIwvCwx9Zn3Q1DmIPx/2/sSaMuusszvjfXq1ZRUElJkKsBEGQyYhJCBSkUqAW1tsBdpuxEVaBzowXZqe1g90G2LotjQdmMjKqtBxQERdAWUAkUlZNBGkQRNyIAEMAkxpFKpqjfUG3t9//m/c/+737njPq9uVeqcte66b7jnnn32/s6///3v//++Tz0dmD0KzC4DM6vAFpd/0L3Gh6yTDgnvLwKzAWDGiH/ThcC2OWDrErB1pRgQisIQhAa+AED+HEEY6uNLyrRnZLSl6tSbrgLOeBQ44yiw8ziwfaV4UGbdegmA5QMTLFlqsfn7XecDW+eAmePAltXiXnkuZSBkRcm4UGXtU2uo3xsAZgz6y54JzMwDWzkgBOAqMMVBCSAUObh8QuN/CiTgcWAuyWhL1amvvBbY+VgxbW477paa7gIBqCnUrbUBiQuhAKDUot13IbBlDtiyBEyvtO5VDxvvVfxW/JkWNFrCeK8NAGsY7BsvKQC4hQCkJNaKy2LRIsg6SJ3IQSe1onKKC2CsOYMeN+0Dtj0ObDsGbFsEZmWp5S74g2Ir2uA22BScAJGA+dJFwPQ8ML0ETAUAkgDTPq9zdK/+sMWpPF19NxYwA4g3PtsHxAE4SQC6FdSgmGWRRIJLZJll8EGKjHiX1jwaN10HzD4BbD0GzC4WrsKMW2pNobZoCu6CLCDfCTqzgg6sr+wFphaAKQfgZHKvpRSYg7HN5XCL2AbAZwPrZGaj6ippXhgn0kqmU1woxnHedg5AATuWHig2FE1uVRwoxoX+Wcbg89S3AqCKPONcCi8oPtVP+9++G3j+oSK2xRBFDElUxbTS+3nvc4FpDsjxllXQoJg8FgdCQoGJJTTicLcQ6vPL6wbg9cDM4cJv27oAzFA5ky9/UOSvmg8oP86n0dICBn25JwjARWDSAUgBHN6vfdbv10AbARh8X91vDM2ss+NvAECKPVLCsHoyUgRqrlbnRwB933OBc+4DXrIC0IEmiLnE75di8HsyAcjzWUVGUi6uICMpVwwJVMXdeOk3XAxc+Hng+vV2esAYw+sWoP31r3eLcLwQBeQUrEHh4Jo2h4vDmJPuAyMLGAeEn7uqbgB+I7DlSWBGCwe31Gb9aL20kGDb/EGRxY6WTz8f2wtM8l4pgL1SgM8esHCvsuylME4nn9cfQLtldg6TZ0kUKorAfij23vAPCmqp3fcCl60XFINid1PlZrf41/dnApB6wSQjutUfIDJR8CGIQOwWEH7DywpKrWc8CFzqRLHkVYrB2jS2FQH5vkuBycXCAlIUUAAkCM2iRBA6+ARCe7DjYmQduLYTleiQ/XTTS4DpI+6nLhZW2nzVCEBaMLd+soIGqjD1ampdugiYWCpeBKA9bBJC9ActAk8LES26SqsftInLZ44dQif4Igdhym5WLrPDyuYH/7HTCNwDnPko8LXrBccjQaioe6BiKad3+QY/MGTH6rS3OBvCnQDuAIyqhiDkQ9RX+29yE3on8IwjxQPI8zkTiApGU3oVkD/4fGDieAuAdMw5MFQjEgg1DYsUku+a3uI0TGBfV7PotwHwaOEmbHEATvuDIutni6UAQoFRIFRYhfe/dhEw7tbe9Of0Si1g8HkrwRcevDajz07gIJ7n05rYyWIpb4ya/7vv8PRdFpj/LXDmkQLAnA4jCCOlTBRN/rFMAJKgkkVHpGUjySSBSFeg7/azqk8EgbSEq8UDRACLKDXSyaQ7Br//DcA4LSCtwnKhTEkQcmAIQhtM+Uaajl0uS9NatITXWzpzfcdNB4DpY+6nBgDaCtanYLN6fCj4u1ay0QIqtML/EYC61wSA9tAJeP6eWsAoDysFpg1eB0HIQRCIIkVeCqQf/05P3WCB+UPA+CPAzvmCaFWDKEuYcl1yMN+Y2dckqGTeHPEvvWDSNhOAfbefX0A6rS8CUw8X9066bFIfdqMHJID++DJgLACQumyc3gyAEYRRKFCLD1eu5ODLF6QvXedx0w3A1BwwxdAJLTXjd8seQnGrZ9bPFxLyA7WIKON63tYtCQBN/sv9QPm6BkLp0vl9t/m6ietR6fbyBA4gnXtORwRRpNnTtPpW6gWLH83lKqcOFTEnDiKtoHwy8RNFhrefyeztbnrBfbWfgttsP+kIyO32ELD1cHHvInrlvWs6TsnB7qAUlg/suFtAWkE55zYQ0QpqcALoNCXTEt7A3KoaDwGQfqoAOEUBa7fUbKctltwCajVbxvSiyvoasM0BaBKwwdKb9fN7NfcqBWGiSWykWXER0umeacUEonQgCKRfIgDFjya5yq8Wfsfs8dYgiuMxgpAg/vnMzu6mF0z6Zj5APdvPQec0TEosnvQosGOhaLuIYvnwEYSithE52F1XFAA0p5yigD4otCqygFKnpHUpLYP0OcKURYv6Mj4MNR433QhM0gL6QongawOg+6rl9CswKoSkEIxPyTsuAPigCYBmAXVfYcVf+n0SRYw6dP1YwNgHsgSajiJP429RrpWOM6cxDiJB6NINM4w7LbUGMQUwB/M9mZ3dSy+YVG0EoBiDBST5ddZ+PkCsAiIlQZDa3LVatJ0WXG2PbL98AB+4omB3oP/HgTUhmGgBfRqWf2TTrUSjExDSP/qWzQDgfAFAWyzR8rkFtDAKX75jo6nUguZxZ8NByHbvvqBQ36T1swcsBaBAGGRg40Ir+rt9WUDhQ5ZAU7Es2e9LLzglqHRxNkbeuW+oQRRls5jaMjnK0a9ecNf2R4LAwO829kQB3LTtEYQPUwzQAWgW0AGo8AQH0ljp/V17pm0KRcEifGuNOnocO1rACQbKPXhs8TtNwVr5uh+n6Zf3wDgu29g2FdMtOc8B6PdpFj08ZFrplw+ZA5FTvAQQ0/BT36FPDkRqBT9Jag7xYlQItY0f88j78sZzCcKPZlrAQfSCK9uvB4h577SCotUiEJ8opq8IQFl/PUBPEoBLxbRE62LSqG4dFB8r5bHcOtiOQSqT5T7RKzYDgJx+BUCCTxZQCwhaQc9oKcEnEBKknj5FsJ1LAPo9xoWWPWDy+6IIoqbeaO0VA+zHB0zxIQDKkn1GgtXiRxMIAx0Vn0Db+lkuFjLRCt5WEwD71Qvu2H5OfekD5FaciQay/GIbFgBXriwAyGmJADR1ck3DwTE3TQ4B0LetzBJErTYAr2BBSI3HTS8tLKBZPo/fWQDZp197Z3scjGb5BDp/L3+njMweB6B83Gj9wj3atOsPWin9WgXCFlVO/3ctf4iD8XkBkH5USlAZlNPZAQqARr5vxu1yjmH0givbX0UQKI63o0Wun/xHuR8E4VnPK5JQLd4VNttTBvK2uoiKOUf/f+GjwMNBh0NMV6J0c0NpcRv7mrYv3kh8/uHxYp+bVpwLp3R7sts2YzouSq3KGa+q7+x7Co4nazAerRKsVlV1QitF59dyyFZaYY0HMu9mWL3gtvZXMbymBIFMZ1ov2h0B+LTLisxgW+Eq5uU92iZ72ud9vvR+4JFp4NjkRh2ONi0OB1/UBCkvEYRhfuNs4OmhhiPKnFQlx6aAjMnSXJUAACAASURBVPjmz1w41nnwO4cCIBvBwZgTAOUHRq3gyDExD4zRGVYEnpm5LqmQc0M5esFt7acFl0SlHiBxuTkYxxdaihUC4QVXFu5FCUD5QtJl85sjGA0ziQxqeu/fem+hw0F2fLLQGxFlYMRvo7v1WmIVtpt1DFkXvOR7LwJ2HSkyoZmEypoVVe8p7b6qEMnidGG/Vl/L2aPOIwuA1pAIQE3DAmFa4j9f7CPaFpCHKujr5xzZesGdHqAqKz5X+FLRAl58le+jui+kTBALMcgZ73CDBkpN2/7+bfcWOhwUyCEAjQTcAVhKdjkPc2RajewKyu/n1//qJcA2uhBMRGXQOcn9U6JIOjXHQqSYOsVoQp1HNgAvz8yny80H5PVz9H6RqVd849WtXQ/zA0Ow2ayGLJ474L0G79vvbulwkJi8BGCg4S01SKqofoNvSIC+5zkhFUupV8rUTpJN06KpaBkFQm5M1HlkA3AyM5/u9Zl38zrk6f0iU6/4hmscgK5ISUtCTowyDqb7UxwsqFJW3fo/vbuIBJEZ1YRgyHwQKNi0KEl1OKTCZJdxtPDn//v8ooaDaVgqFyiTD2IKfcjZS4Fo+7g+HXOPv84jG4DIzKfLzQf8KVfI/FNKrQ6h94tfz+vOA9cGAAbrpylY2SDlVTTt+uCnV3/V3a7DQQAysJAwobZJgUXi78Qayhd812WeiOAZzEyUiAkHMeu5BF5FwZQAWLPwknkLQy9CrPMy8+lIHZFzvN3T+YbV+8X7c64OHHix74V6zIxB+RJ0wQ+UU992tYoFy3fcXcTDxQkoPsCUhFIczKVCegSg5B8A/PILN9ZwxBSxtiKiUAOi7JW0dLTustF8AGbm0/1o3vjjnSGdj+lYlGwdRO8XN+c1wABIoHk6k61yuSCJITq3jDY9Vx0BqK++uwAfX6JkI/hME0SC1EGguiQ+isqcQRLrF6/0jO2w+6FMnZhyZYsQ1W50qOHgPX1NXndtODsfgMwHzMin+0+ZN0S9YOllMzWfLwKQSS396P3iY3kNOLDPM1y065H4gOW3p4uTDkB8zWdb7FgbdDhEgJkCUDRvogTmd/vPv3BVAUBuvylNzAAYi4hisVQnEHoIqWblrxqm4Mx8ujfljT+YjsWBYgIOc0oJPsq1slCpH71fKybJOEoAuuVTRSCnYlmU6P/Z4iSJEcbLv+Yu9/1EAh7JKEXDKxq4ChUiKymRbwjgHdcUWTARgLYXHSr2LOU+BV7MVwzxwOfkOWybYAGZD5iRT0edjpxD6VhcOQ6j94tP51wdOHBdMeXa9OqWRcmWXA1XLUIUH6zyCwlAs3z+YBkfs1u+VIejJEF3ckrjI9T0y/aMA2+/tgAg08VURKT8vbKMUgAMIGzzAcOi5HknHQAz8+l+MW/829KxhtH7tTz+jIMAJPCYMULAWd6fvi+EY9ouoZBM/Kx/4LUBgFLgNC5o16FrE8JJVJgkiFhaQQBv3+dVbMrWVsC8UxFRkjjaVsW2DtRdOJ/vAyohVYK7A+bTvTdj8HlqTMcaRu/XxHkzjgNkIOWuDr8jnYYDKDutgpUhra0uAlAyCCUAK8BXcjBXgLCk/h0D/hcByDxFAdAzoFUqUBYRJTUcMWdPP7ONL6i5bLQeALJRQ+bT/W7G4AuAOXq/lsGdcRgAY+glLkYclJVTsa6ptCX3uQjAKINQstFrAZKIwWxQIhIJuovB/Nx+r2LzFCwlj8Y0evl/MYk0kieVtcvrwGUnHQCVjjVkPl3mItQsIPuElx9G79dOzDgMgGkAWlNyBJn8xKprBRC+zgEo4LWRgcdVcOCjjlNvmx84DrzNAahaFZWLygKWxUNibIhTcPD9BMLLa65bzreAMSGVoXvJ/Cgh1WUfO+XTZS5CDYDs9GH1fnOrIDcAkABTTDCCLYK0Cwi/586WcKJUiEpC8CCBYDsiiSplqUIUmOjf+o2tIiKVUJbgU5uSWl4DWwX4+PcXnrQATBNS+8yny1yEopdcay+930y5YhgAg+9n2OoUeI5TdQer+32fdhmGoOBZanBo+g1yEKU4dYgFSvqB//vZBIBt9RshkTbW8ZZZ2hUgvDL3iU3uux4LSBM0ZD7dPRnTH08VAIfV+2XAOucQAMuVcKfFSD/+IAABsEoGwYAoHZIKEEYxRIHwLS8pUuhjFVs6/ZZhIVWyxVKBBIRXnbQATBNS+8ynI4tBzkEACv+chlUVIKE/5cRGsWmlKfIzudc3APLQSlg3E2OCyVRc1kpU3DgBmKoQsWtlBcswjPu+nfTYtBL+GQdgOf16GCZW6pXlBCqWSgqJypoOAFfXXDifbwFJLvi5HAjlnUsiIe6AjOp4iQNQHRlT2PlgJCUbbc2s+v/hFwFb/q7gm6HlYpBbmTV2sscQyy/qFBj2v0/cAdz/HGD7NDA1AUyOOU+1CwWOewNjKj6/O03F1/WuugW4/XJgfBoYmwDGdH7IxB5kLPIB+I8AfNwZgga5ck2fJbEm8V9zNWPfrasbgMuPAcuseJ8Exsb9FdBhA+7gaQNKB6TfcgCYug+YJT+g89aoBDMmIMScP12uTKj13uDv8zsKig/uJ1uQOsnojm3qB5P5ACRBH3OhPuzzRN9DV88HqQLEWPJnvTy5nm/t/1s4BcuSpRZtGAu4fi+wtBVYEyccrYwn6hF8/FkJp9bKxAKVFsn/d8urgbHPA9NPOEOWl4+2cfoFHhfVrJTZPKHSj5daOtup6JyCpPx8rHWRVQ7WOlrYCMx8AHIzlxkALPD9c0VB+x/A3E/+E2fUYHXdF7KTGwdvTd0AHP9r4PgWYG0KWBdfsBdsMPfPrKKsoL9XAVLAvO2fFylCE4cKliyrDVZNcGS1CqEYhWFiAZV+XntaURdTLmpCEbpchTYLqi6NrkMCzLzt5Xc4HwyJmmkJ+Z73jQOh4NWeDUZiK1K08f0EXt7CMHVawIk7gaVpYJUA9LI1Ao8bzKX1cytoFtFfpdCIWz7rgzHgth8u0oPGDwETc8CEMySUzFaikgtlpW1Ta8JqNba7lVljSRgW+Q6ZP/57WQvj6fydBjXfAjKbgEvMLwWCvhNoipgNpnQshlS4IGFWzIk6ylWwAz93ETLxGWB5ClidLABoIOS7pmGfG+33YAG5mND0G8F4678vkiPJczNOAC4UyQm2N8w94kirFlfIAl7i402d6dbPWWAtrsjOFiuCvAJZOQE0pHTFsckHYDeCvhNgipQNxoAz8/8IPr5nbvH2jd+6AThJAE4AqwTdZKEBLDoDgU4+YVkPHIBoPwareOt/BkDexsMFAFnbzNJYm0IDnVwbt4uyur1kwL7Tp+iZM/08WT9Rc7DHUmuYTr/x+6o4ovvu9fjBbgR9JyA+omwwxvZI5ULg6ZW7y9FPf9QNwKm/CgCcKABovh8ByVy/UCtJq2f+X1yYJPGU27lIZLbuEWDsWBHesZeDz4iURLUWa1TE47LqK12fZmd3OXidFctqm92KatVs1jAEsNv6sdymaa2g8+xUL4I+Pn2beCgbLGWHI/h8G3oTr45iK86POlbBU9yKI/AcfLR+ouQwH9BfmmbLlTHboOnZ/T9+5vaf8FUaAThXsFOQ45mUcgZCWTAxe0UQ+urYMO1/37GtxQmoLCBtRSp30LrDp2SFdzYMgk/R+VNwvwR9mwQDsaspGSfJgYDYNTbp8psCQFJxEIBkQjDrxt8dXCUIY+COH5MVFPi8SOn2n/QYLZ9Gp0cxANIP5IvAkzVzxivRydnKNzBa8fddM84b6AFyAriMF2pajk9kYIeoClXmA3AQgr5NQEHMBqMVFMNaIOayNRL/vhlH3RZwmhbQQUcAasrVVGz4EtjCu/3dfb/ID3PbT7uKAZ/MhcIC0vqRTo4W0IBIEAmEtFwCYqjW03bcmdwBYeoWgetUbrR8snrloiR2drpACf+rD4D9EvTVjIJu7HBV+781X752Czj9lwUZkTEgcPoNPp5Nv4oBRhCG6dd+1DkMz1JIhR1BAHJ7zwqO3fIRRM5tmDK5CoQKsSgOeBYBKFZULTqcB9r6Ni5KYmd3WKDUA0BlhNLM8EbT1QBXBU72aI5ZjUcVOxz7WLkQ8d37vsart/uA6RcPsxNSAtAXHDYNC1AEpf9s01kKwuBwGU7HgVt/1jtD1e60fgQigSe/j5bQp+KYpGB+H62jT7P8/ZypBIC8Dhcx8eY9wF015abhmnoAyJ5WSrKeNgKO9SHxnT/LSasJBim5lRjWBEIVeROInKL1qunybRawLgASdEy74qjaNNzJCgqEEYzBGvK0297mAFSHEIB6ebKDgc8J1ksmV8t29f1en6L5v6cxIK5iK6Xne/5jCTiFcTqVn/r/tWDPWwXnEPTVgIKUHU7ljASawKefIwDpMdRxRB+wFgD+RREDJABpwSzz2c0LfxczVjkVKwaYgtBBezu3SvX08d39P5uO3QKahXMQciourZRAGKZWar/YZ1xXRPe8wQr2AUK7TvbOVTZBXx4MBECRnConUBSFEXT6mf/TK+/qmzAF/0UBOPqBZYF52HrTFCw2LH5G8UCzJEko5nZqmRnPh/uCXmpnVpDTsIPPwKApOaSA2QLDLSHf97iPx0tpISLfz7bl4iFfsUsnj+HZWEeOYDCDnDmCvZkEgedcCjxGseIhBYt3vx049HwMLRh8gA9gh2MoH9ABqKJzxf0McO7XlSAU4HzhYYFq+5D7hwBu/98OQLlIBCKnW39SlXNY+nqeiq2dkQg+gnGPb9/ZpT0lq6MV5D96gLCwgDmCwbdnCvZmCgY/dxy47xxg5SWuUjigYPHFbwA+fyGwfr2rXrMvPB+vp3L3GHCgi9JOHQCkRVPppeUBigXLFymyejYTB4YsgfA20ofRAlYB0FfAlvQqP0/TsX5PLOB5DNu471cmIwiBaRww/F01J+mz2pqChxUMZvpJlmBv3iTocsW4dzewfhkGFix+2febXDAeJO/YEILBB7pU1g8LQFo98QASVGYNQ6DZfEG3fnEqrgLhbf/HV15anbkFNCvohWSl9XPQ2XTM/2s3I4DwPIZwBEDfgitH0Ek6N6x+u/iD7T4g/YdBBYPpWHEaHlqwNw+AQa4Yj54JrJO+aQDB4pt+oCAyYvOPEIQDCgYfeF/9U3AbAMX7ItAlVtAspKZdz5SOlvA2pstxjES3wJ+92NgAGK2gwi78QoVfEhBeQACqNNP1RdoA18kKdgDhxkUI/zKIYDCnqyzB3jwAJnLFOEIW7QEEi1/1Y21ywVglCAcQDD5/Efj7M4CVrZ5AKlkhxeQUaxBI4nvFzxf8IfCVC4HV7cC6ZEX5nen3VX1vAGLZq8ysrvHY+QBwbGfI2E6JpLvdX+ksthpUvQrmX/sVDGZVUJZgb17vJHLFeGQcmCdVb5+Cxd/5xjZ6QzzMLOQBBIOfTV2Ps4HFHQ7CLQUQmUrV0rgKJMsCjsxGAqTn/hzw0EXA4tnAyg5gbTYBorKkUyLnkB9YVhTxu+kT13iccwtwdBewPAus+b2ar9xJAafqfgMQO4dh+J9+BHe5gqZZZzYok1JJUcpaR6bp93P+W/N6p0KuGIemgEWKgPQhWPxdP7NBLhiHKYHUp2DwpZ8rLOD8tmJQVplOLxAqmbRKC6EDYC7/CeCRPcCx3cDSrsISrs04CPm9ArZk55UvKAspYLqPaPdR4/H0g8DRHcDyVr/X6VabLHk2PhjpPVZY7d5xwF6CwS9y/4LbbVyQsEKIufGiKe0p2JvXOx3kinF0GjhOQY+oNRtljji9TQPf/fOV9IZY4Gq4D8Hgy/4W+Oo2YG5bUUy04vUcLCqSJVRWszJbNgxSmMau+q/Ao2cBR88EjtOqbgNWWaTkIFz3YiWrF4nAjtN0nBZrJnU+/8PA3CxwfMYB6LUra3oglL0tps6wlVha5rLiqd9AdDfB4Je6U0s/0BXTDYh80Sr2FOzNA2AXuWIszABL1JaKWq1R+nwGeM17OsoFY5XTVw/B4Cv+Djg0C8xvLYqJCECzgsxmZlq9T8e0XGUyaUizavPtxoFr/zvw2BnA0Z3A8e2FVV3x6c4sqwObckeyhiXAowUSADhD1XhceDMwx37lvU4XxVN2n3rJIocygkr/Vbs7fe+EdBLcfaXXQ3IPWIrpBB6XlnwpR76jYG9e7/SQKzarxM7qJFj8mg8UarMV9IZ4gvNDD8HgKx8HDs8A8zMFAFnPYQPDl0Co2g4fpDZLqKCxT0/7fhJ4fCdwbFvhRiwRgJruCOwUgCpeCvUjZmEFxhfk9W969kW/B8xvKQqnVgg+B6CB0MsI7P70AHgmd2n1NQ0rv7FvALIlVYK73MnQCDLThSGZoDpuP7uCeuX5n8zroB5yxThGnQ0CgyBMxY63Aq/5aBHG6EBviDlOLV0Eg1+0AByZLgbl+HRxnZXJoqqttA4ODovlJZVuSjTQFtq+NwNPbHMAzramdVpVs6wEoPtdNg37wJfvsYiJP9NFqvHY+7vAwjSwxAeNxVO8T6aNVRRRlT6hHrJ0Ovaw0WDJCKng7g86APvNB9wg2JvXO33IFWOBgn8EIf2nRLD4tbe1+AU7yAWbZeskGHwVdd2mgAUCcNKnJgLQrZ/V9/Jnn5JUYmnAE3hCmv3+t8AWQfSzyPK/POOgJgDdsgqA5nfJAvLdLV+bz0kK4RqPZ3wQWJxyAPqDVhZQyQr7gyaXI9axWCFVAGLvRUhV46PgLnUWBs0HbBPszeudPuWKsTRZAJDTo8l8ui/42juL5veQC7ZpsEow+OrZQlqVVuH4FLA8WVyDAOTAmHUQCAWQkOlsQAwDt/9/AE8SgPQpNa07+AhAA6HLXbb5Xr4IaAMfv/eGvP5NzyYA7UGjBWTWjh40v9fSyscHLtaxhJWxFVsNNAXH1khw983+DYPmA5aCvXkdNIBccemfceooAfhAAcA+6A2xLuAGucxrzgKOMexDfV9OwbS2BB/BEoqLSrBoYGgJ3E8qLcIEsP/ngCPuUy7S13L3wb6PU56/m/Xj4Ps0TKCXQA6AXuNeZY3HMz5QANAeND1kwcKXlj6wOZQ+b7R+Pi0PD0DeFAfk590CKg8qncfoFzIRVWVqfFfBhgn25vXOAHLFWCDbvPstBsJZ4LUPt+jdesgFg+qVptWq11bg2gtgfuLiRAAgQeg+oEmsOujsXb5SsAoCIN/3vx04OlNM6Yv0tdx1MKvK7/TFjVmeCD4HQQQhf159eV7/pmc/kwCcKABoeYvR0oept7SEoZQ0Tr1lPuPQFlAtO0nyAcWhpzw/FSjFzGjLx+RGvxzoSeC1hwsA9klvaFN5FAy+9mJgnhaQ0qqagglADo4c9AhCDpJPl5ZommQ8738HcGw6AJBW1VecZv0cePwOY0/wl1lAD/WUCx0mMlDLr8bjmb+Dwp3x4nkDYbD0thIO5aNtfmDi/xGEeRawxhs7Vb/q2huABQJwAlhyy2cC0xoggjAAUCWWAkksOiIY978TmOOqeqqwqAx3WGhHK06n7TDwOcAV/iipPAKjwgrZm2o8nkUA0gKmAHTrp+o9MTrEYvq44o9pZIOtgmu8mafCV72YAKT/RwAy5OPOuVlAAk9Oule6xQRTWUKlWtkU/IvAHAHti5oIwDK841ZPFtCmdr0U8PaC9hVultd4CIC8P2Ztt/m5/qC11TJXlJDGGpfGAmYODgFoCxACkLpuWh3KCgqE8gNVZK4KtxgjJAB/2X1Krao1rfN7CWZf3LSBT4uAEIyWBVpipL7GgwA0AW25GbGENBTRx3rm1M2w39mmrFVwjTd1Kn+VAZALEE5LtIDyMWUBvbLNLGHgd5H/V07BDp7r3uU+Jadgn3ptxekA5MBri0/Wp4wzBjDbCnkMWMqVpE8GJwLQqvfc0pqbkVj5aNk7gbCxgJno30cAjntowtXNaZ1suvSKNhsYTcVKmw9F5xGE+94dfEoP+JYhD/8OC8eIPUsUHokVVKB78XszbzAF4Pvd//PCKVGIpOAr78mn4DZOm8YC1jco+w6EFTDDPJqeCEBZBa5GffVbhmQ8DtZW5TYOvPhXip0GTuu22lTMLSw+aAVl9QhEWjurI/aQiLJkTMLsX9R3r/ymZ73fp1+37OU9hunXSkdl7T3QrhKCtlCM59k2i5CMMSIAGdqxEIwrmptzTsCEut5yilKoJLAcxCq3fe8tLCDBFwO+tKjyuxSCMdYEXoeDrHcHvu0tTwLzmwHA4N/Gh6zNCqqeOSxC2lb8tQSiMwbuqXIqAcjFh2JjBKGJyShQG6ygVbfJegULWBYcMR3rvb6oCRaQwFPgl1M5rR7/JtBZOIZWx/0+s4QeY5z/1/X2tFnAxPpFELaVkdLN8MWGVr4pCBsfMHN8bmTKfCjZ0Ncp456/x58zLzfw6Qf3ABd8pUgEYmqk5bGyek06IQl1bkXScnlN/u8L24Gdx1qVq91KQvrpgwaAAw9p+wnXPw1YjyWMGtDo2ASOFGMU7SIEUzdYD34vMPmXwLbHgdkFYAtlGiim6DpxJtvq9LtlVr/aWKEB8pUXAOOPAFPzwBTZ9r04vdQ9Ts4pAZ3cd+yHxgfMAOH+vcA69/9Uxijmz/AerYpdar1lNSMYzV+vWY/34I8DY58Gph8Bpo8A04vAFEFIknIHohGVR62QhFRSYjQE6qFri2z3iaPAhHNNlxKwArI0Q1IAxwfReacbC5gBPp66/5ICgLKCtqnsrKKlrFZUFPKOr7osMTtdsxzqQRZ93Q1MPARMPllohUxRqkEK6gShOP0S+dY2hlRv99y+ovRi7IiTnTvLqmg6xDPYpqAUgRgsoR7MxgJmgHD/c4E1FXu7FRRbvEgd7evXWlbPpp9EgUjiJpwe6zwOMlvpAWCMVusJYPIYMOlSDZRpoGiNxKzbdIQlXONMWJbGtw4svdgz3El47nzTRvPrrKptAJT6ZrzfintvAJgx4vsvdQvIXK5VYF3sUZxmJUvgA1FOvwF8spKyBtM1y6EepI4LqVMedbEaTp0EIKdPKh5FqYYqSxgo2jgFr13j6XXHnOiSZOeBVSvyC8qC2r05FVvVw9cAMAOA178AWPMp2LJaaekiCPXExwHw660n1oB/niGQazwOkkSepbJ/72I1x4CJ+cJ6lYI1riccrVicUuVSmIW82pkwnHHVOKbFsOozQGkFkwewnBES37ABYMaAX39ZAUCCb82nIlo+40p2gNnvsoKunxH1xGwA/LOzdQOQJPIuHzV2GBg7Cow7AI0l33XfjOsv6oVodes6ISbBsAZMX+kJxU56KY7pkmFVhOciuvTzSt05v0+ryuT/9gDrZNe4wPMsI7VJP3GcP7gUOOdvgL1rRYJ0ZI5IV3hV4/wrGYPPU3/AiRhYusy2K7mU999P+z90ObD7LuBZK0Xdkeq9NSX2+o4HLwfWlopFCC0fgciBMtAFC8CGrYXVoVjnU2G7rTXrzh4kfRzLY1kyGwBoeiGcPiXb5eAzdXWnazPCSScb4j3xfmav8Cx2p50lAMW0VXINitCogl2r9H2dcctWwQxQsn6ZTBbMNtcgdKIbiZj51VcBk38CXPxoQcfCUg8pjcYgZScw/momACnXyr4leBhs5QaBTHpf7X8dMPYJYO8XgAv9e8QJlAZZq8D4xSuANYKPJQn0AR2AHKy1MACKe9nfFI6IEqduEWoHIJ9wlsVKLekoMCa9EAegSTYQeM4TXco2SEMkAHEbBZoj4bbYtdyCVrFqGXgTSxgXYTZeHLi9AMjEQRCVUXP/n4KUaaT8vVTi+Rtg7GPAuYcAWlMCgUVkQfJ2Q12yBvPXMwHImhDWwf81imsTiLSEvHZkr+jY/p9CQRD4p8DOBwteItai05qn31FFdfLlFxYWgCDUIkRkj/TxbCEi/89jfPZ3X2VqYSJQbmUNQY3HQT7hbv2sLoerVwKQHNEEoCsm8R4MhPRjXUGzVEIKIoY7yaEYuY4dgGb5RXruoSgtSCLLarkICQ9f6QNykGjFdjsIBaI4kGlt8W+Rg5g0HJ8qAp47nihAzFpuWtPIMBZJlASILvR6fQ0DCVbJCkJOJCqnk4pGpb99tZ8MopyiKDX7WWDiwYKXiEQOehCrgKh+eJQ+EQHo1Lby/zRlyf8TIbf9XS5ftIb8I92YugH4ay2pLusorl7dAoonWtMwQSTdOFuQSLTGHyIC8kxSIQuA4hwU2WUAoO4/grBcDbsfWElSzg+JCoYDoEGM1ixSkHzgF/wG7y8sIa3J7JPAGWuFJSQIaU01iJHUiYP4e33BrPOHmG/JMaOfTZVYRhwGav87vWKPJ9/rSH4IOGO5sITqg/ggxXs4TOaBAECbeoOsgfl+DrQShFqcEIhyyt0MbMusEkx76iAZXKM8BvXiZAGlF+KaIbaadYpem4aDgpJZQz6YJABV5VcHAJZ0v4FxX6KG5UpYs0KnqjhRuagEVgPglYAl9ciHf8mdUrJh0Qx9vkDBzBywfbkYQIGwahA/kglATsHsDzKA0BATiPyZ4NEDwIeoa/uFYKKXL2f24nQoIgd9R3yQCMTFqwIAfdBWI7+yB5ZLECYLETd85YJl+2YAUNosLIel/xYlu4Jsl6bhNhD6it4WJCvA2Zc4Gxo73RcgJeOqFmGR6rcChLYACyGojmEYdj59KnZ+tIQRhH9IvWA2hiREjDeRI9Cly7fMF3EtWRFawhQIf5IJwE56wdTIYdt7tp9ys1K8JnoJvod9Wn682PNkP4hUy1ndWgstAtBDMLYN5/6PAc5DGNoF4SrZfN+4+IhT8jqwg2Cp8ThIJ5vfSWBXAVCrWN9SMxDK+skaOvhoAc8me654pmUB3f0wyt+E8FyRAGmPlOEoiSD2qgvmAKoOm52fAuiTDHSyIRxx+lI0QxxADubfF5vffMmSajrWlP7nmZ3dSy+4r/ZzAUEHnQ8R70HsXlK+PgJsW68G4XYGZj0EY2EYATCAT6tAhmE0DXcC4faapcwMgAIfLb0kuzT9Qmw5uwAAIABJREFUSi+EfeALkSrpBovbrQDnkm8wAo8/E3i+CCsZ98NCpAp8cUekZyBavI4ET/TnaAk/RQCyAXy6uNSPA0i+wMeB6ePA5HFgZq2wpNGK3FUDAHmv3fSCe7afX8CB4UNEEOolVi/3obastNwJ9cO5BOBKEQMsAcifHWzRAigWWAlCn5K2bQYAOe1KMjTIR2kRUhKVS7IrLia0v+3xwHMZMCbYNP0KfG79zAqK5DxOvyEuWu6VD5KSHy2YAEQAfpaRdl5UkuUctIpBnCIIl4psD03FtIIP1ADAlBuJM47EqqUX3LX9kSBQcuuyftK78xUkHyQ+RLqHZ3Fv1KcgLj5kAQ1s0Qo6IA1nHhNLQzA8ZxvBXuNx8DcS5UYpNnoYxsCnUIqvZo0F3wPTMa7Hv53HOJVbS/l+5bumX7d+5WLE44hxIRJB2NMCqj9ixwuE90svWCaIA6bAp959EKeWChAyA0PTOV2unGMQveCO7bfqHbcS4rJR7Ewqnw5AWhLuImg2uFQAXAVs8RGmntW4+g2hB3P79L/EJ9zGvqrxOPibiVihAOgrWQOf/EBfBcsPNBBqW9Hv6zzGqFzmoXz3B9AePgXiq6bgiv4YOB9QHS8AfpkAFMMjrWAcQA0iO9XJiQyAnos2vV7ESHOOQfWCO7Zf7F40mZFQScRKAYBaSU6vAVcTgN7xXHiUFpDTMK2dFh56912BTiDcvpkATIXzCL4g3WXTZ4jpGfjoF/oihL+fx+0yWUABLwIwtYKKIabgCzHQvi2ggBKn0McEQDaKT5cGkIOo6SuyYzEfjQB0EM5nZgAPoxe8of3sgSqCQM3jkdFLvpRvR13+7UVRuhUFSavNO6otwp88ZZ3+t4M6HLtch6OT9AG/q9cmtf//gV1JDYcnQ2zY6/YakfSrU+Pg1M45NqPt3IEtoM7WFHokyrWKkooglCMWLYjiUXMtK3g8Uzd1WL3gDe3vRRCoUEYCwGtYFxxqgA2E/jI20F5hhmQod98BHNnlxOTig1aGiDanO21yV4DygWuB8YeB6fnC9WEtiKVVKeE0ZGiXWczeJoWMIig5a9V5DA1ANoKDeDylZ9NSXxyAsiKawrQqmCv2HVf5e8aRoxfc1n7xs+khItAUvojvyWryxVcWJZksVSyZoQRA3dcAoHzax4Gj2wtu6FVKM7gMgti02jbV476oUJJs1j/AbA1mQ3Pm8eTRsoZDtR+xZKCiEKmMXTIeXHPGdhYArX8FwG4DGMEnAHIK4yvT58nWC2b73cexaZgWWaEKgU1gjNbPP7PvOYGsUSBkv3hBtmRWNzxjTk9RWktvxp6POj0vARjY9sWkFel8RWxegjIF4RjwAOnZWMPBTGjqvHmszxJOBUD3xyznL2bqROvoP3N3q84jG4C7M/PpcvMBef0cvV9k6hXv+2Yno5QfGArRbaCC0mWv2YtF3ecerNDhkNZIIsXQRv5dlTtGADJSz2gEE1EJQM//026HdIEZLC8B6A0tk0g1Ja8DuzJdphS82QBEZj5dbj7gxZN5er/IZI+67pscgE7QaDOUMyC0Wb8+gXjuR4F5J6YsaXnFhBoAGEVvUhb60jISgCQnoh/OLBgvIrL8v7DdFkEYM5dtNg97tvz5zJqzdfIBmJlPl5sP+DJP5xtW7xffnzeh7H+Z+3+RpkyWT1YxuURJYVtx6T0fCTocouQV85VkHRIGegEuEv/YKpkA/JceVmL8kv6t5/9pu62tfiPWcFQVEa0DZ9WcLJEPwMx8uvfnjT9IgZyj94t/ldeA/S9tMaGa9SNdmsIxbvVscVJ1GScoMt4UPwhAsmMZ0aXzQBsvdGRBjQz0FUpEJRAJQOq4KAnBdz+sfiPJ3bOYn8fsykyVWMfiN3BOzckS+QDMzKe7OW/88aqQzsfE5kH1fvGjeQ0wADodmVGwOeiMsUqHrGOnS4UFy9P/wAEojkEnI+IqOIJQNLgpCXhcmLAtD/D+kgQE235L93tj+YBqgTX9BiCeW/NedT4AmQ+YkU/3sbzxBymQuZhm8g1T+QbV+wWFdjKO/Te2mEFNlCb6gPF708VJ1TXHgKd91GnZpDfi1k/gM2vqU3DUnCuBmNQe3P9vw6pe229KOvB0K1k+ZS+rnrfM2AlA3JMZtah/EZKZT3drxuDz1O/yxAwu9JgJxr3lQfR+8aa8Buy/wdWQZAVl+ZzCrG3q9c/YrkmHy3IRYryAAqAkEBIlopJxNNUbER+fA/H+/+AAdP9PmS9dazicJybm7mlB8nR2dI1HvgVkOlZGPt2nM29GCamcGZjAwlQ+vvrV+8X/zGsAAUiLVPp/wd+zaTMFWw+/kAA0GQQnpCw5mDsAMIrcRB5mC/+MAffTwgfwKY2KfmCZ6ZIkUShrxXxBX4yYaV8Hzmcn13jUA8CMfDqWYeQcSkhVOl8U6uxH7xekrsg49h8oiCENgC5TUG5vKxxT8f2aRtOtcAKQ1s8soPuOVUIwpchNlEEIOyNSIrrvv3hwnckWIZPZsnbcDyzTpvg3lU8mpZQqozyfK74aj3wAKh1LgrsD5tMxiz/nkGD1sHq/YNFOxkEAcuW7oqmXlisuQOT7VV2jwi/kTgj1RkoZhBje8Z83SCAEEJZW0C3gff8tADCt4VASaWIBK0HI9q8BF5yUAMzIp8tNx5Jg9bB6v/jdDPSRns0BWIZeUitIo9IhHmhXTvzCPQddccnZ76U1V/IvC4SBCFyg26DFNg7c++Mhhb6qiCikT7WVUmr6lYn2nRKyrdZ51GMBlZIc07GUBdMjny6XCiUmpA6j94vMZbgBMFo552pu27PXAqXTyAUQcitOQjAm9xX0N9pIwIPmSCmH5QuPqER0L4kDYgp9zOUL6fYxkbZcFceyAreAF3GlV+NRDwAz8uksnT3jiILVSmpWNlhMze+k94vMZfgGAPJeHDjpCrgM01Tdry9OzvmYAzAqLVWIwEShwzbRwwSEn+MqP6bQK5tZlWyhjCCCsC19Xv7gOnBRbgp7cu/5AOyVjqVMmA75dJZ9nHF0yohWNlhMxKnS+0XmMtwAmFq4imnYbrEqNJPc+9kfd62RKh0On8qV9hXZ9askEPgAfI56ziocUgVbzGT28lEtRMoKtg7lBHtznfZNA+CQ+XQWM8k4uglWK/NLYKzS+8U9GReXD0g/Tyvh4Ne17Yb4Zbr6g6y7/aNWcoPpjKRTsJIags5IJwkEAv6en05S6GUBfRWsUExZyVZVQCQwrgN7Wfdd41GPBczIp8ODeXfTSbBa6YYxlY8/p3q/udc3C+jTbtvqt2oadnB2m4oNgMn0W0p+hYWHWbwg9yU/0Kb9EIy+5y2hiCit4UgKyTeAkN8Valk4Le/ldlONRz4AWWBRM6fdIPfHstw/G+SE5rMnVQ/kA5AkLHS0ak7V7reXfhgACaBqDtD3e/nmc5k9kA/A80JReq+U38zGVp3ObJo/BvAOD3dtwiWar9zEHsgHIGlFubqSx7+Jja36anLLcDvvgwA+NDpDfILv+qlzuXwAXuSjrkKemlO2e3U1uWUYnL8dwB/5e2apca9LNv+vsQfyAUheX4VguB+mzIsaG9ntqxhF4Xbe3QD+n7/uHLAW9wQ1tblMRQ/UA0CaHC7plXEh+q4T0OWcfhleYTSHBK0EH/mi+fcRuKQn4I6fWpeoB4AevCz3HOOm9yb3F5mBlZBNclYCj1aRfyfrbgPCTR6AzK+vD4CyglX7jpmN7HY66d1E0ctdIrEEE4wEIMlam+Pk7YF6AMj7EwAVbU82vTerCwhAXopJN9zVI+AYrOeULLZgErY2x8nZA/kAJGWr0naUWdFpy2cT+oCWjpdjLFxE5UzYIBBpEUX5nLnlvAktb76SPVAfAOUHpiAMm96bsVtCAMaKALICMyxDq6cXfycA+b/mOLl6oF4AiqBRIEzBp7/X2Af0+fi1XIioMIlAI+AIPIGPmeROWV3j1Zuvyu2B+gHoFfZiDS2lC0LiY52WUADkQoTTMH1BFSYRdHoRfKSu5v9qrizMHYPT+vx6ARhSuDcAzzmDo5ZGHT1PAKYMwQxME2jiSo/gEwBrrq+u41ZOy++oD4BaCcsXTPiSI3ey8s4KGoG8QwCMFM+0ggQhLR0BF19SXuD/ayakz7uR0/TsMcxg3SjfqWNA0hsrga/ojaq/8WPcC+YIk4Ke4CMSuB2XVht1Oj8zIfXlU8BtU8DhmYRXWdfrdF1fgr3+S8At48CD04DVjXQSDO70PTUnaJ5uOCwsIIFHSSFy1pKPWCDsZxCpw8UVgKSPxLXM937OzxxAljzcPAbcswU4Qh4V3UN8mKoeKm/bu78IfKJQa8VD48CylHQiL3O3/qg5Rf30BKACMtJXjXKQcfBSK8Dfqc3KVCwuN2VFGRnm/yKZtq4Re5ifyQQgM2A+BeB3GHaZBo5MAIue0l7Kt3cC4xhw+5eL7TuCkJk1jBtyerbUfYG5ExjZ/pqrxE5fAOrOq5SmowVIrRp1IyT2R6+fg0bgVYG4CsyZe2UsaiOGKXr4Sfp9k8CxCYAFSKyvXeY1o1BxQux91yMtfsHPutgnnyUuUvhc0ZsgUXib+nVkq6+ZKaABIHsgVZnuwD9sVo66rrR4ImdhLGSQ8zPL/JgBQxeU1ouWkO9PTgDzbgmXxrzMkatl3keivfG5x4r4IRcz5BfkO5vEZ0kgpIfBZ8yKjlL17syy0tMNcOn9dl4Fy6dLFabj1Mpvow9Ify+I4Nlo9Xt+ZqU9VdJpqZh4QDDyxUyYOYJwHDg+DhgI/WUVZl7aSEt93+GO9Ia2iuZKOfA7lhp9JpvAVy61w2mOwO5hmCgMHC1H9O24gu6UD9jP+ZmbtLRaSsei9SL4XDPbAEh/kGQ/pSUcc0lbApFWb67lQUhpVnLBsoKqqZclFMmUtrxPcwxl3X7vOCAtYLSCcugFQmqhdssH7HU+RznjiOlYXA8wqkOfkItTAom+oKygca4ES8jY+N3z7fSG4hfUtp3ihUHruVSsFy1iRvNP+1N7A5BdJACmVpAgZPhGOyCigEjlPLudn7kvFtOxuB4g6OjD8UWLRkCZFRwrLCEXJQQhp2K+37lQeBCRX1A7KPQto1prFEmSYn2mB9EAsO+kYfk8KQhZF8yjVz5gp/MztyOUjiW9bCUhEBhKRCCgSis45uQ/PhX/xfFWMgOnWu2gxB0TF/o0kEZ/kCDM1Ts+3RHYnwVUL6XhDFrAswfIB6w6P1MrTulY0sum1VICglKwCEACqvQFCUK3gHcsFQCM/ILayqP1k9JshVqrncMalOYYvgcGAyCvIwuod8YBJQmZpmGJeyRwkGw4n8jJOJQNw3idLFhMRNB0SgASTJyKoy/4ieXCeFfJBUeV2SoAclFyR0bbm1OHTUiN0/DTAwD7zQeM52dqj8VsGEkVE2jKetG7AEhQ0frJAv6RC0trC1skl+IWlNinGLbSaZg7Mc0xfA8MbgF1LQV1z08A2G8+oM7PVF9Ms2GUE0gQyp+Lwu2yagLgR9ZaYpkSypQ6a6Q2DCqzpkvietXIFdoZfuieGmcOD0DeP0HEbBhNwYPmA/L8zJQsATAKnguEqS+XTqkE4YfWWwCUFZTksYAYwZfIBeN9Tw0cjOwu8gDIZqsoSSvhEeQDiiGYFoyWiSDRypWgi69UP5sc5fIcquSCNeXqe2X9ZAHfM7Khe2pcOB+AT41+aO5iRD3QAHBEHd9ctuiBBoANEkbaAw0AR9r9zcUbADYYGGkPNAAcafc3F28A2GBgpD3QAHCk3d9cvAFgg4GR9kADwJF2f3PxBoANBkbaAw0AR9r9zcUbADYYGGkPNAAcafc3F28A2GBgpD3QAHCk3d9cfOxqYJ2au9RdPtdp/khoEOlglDYT39V1PzQFXLsMXAlgt9PCxJKPbufyf8/KHIPfBPAZABf79Xc5XQ0ZQ1Q7360NbxoHrlsDvs5ZRsgo0une06by6X1mZvtP99PNAp4F4LsBXA5gjw8EGTeqaGF4QhzQF80CX7cAvGIdeDYAfhdZ2sTKUcVrpE7nd31N5gj8e2dIo2osk7NZpMdK0Z19tv+bJ4F9K8D1ACj8yfNSikHeg+5Z969m57Y/8/ZP+dPLKZhP/rcA+AYAF7g1oRUhEMUzFMt6eSJfX78b2DkPfM0i8GIAX+uWlAMppreUUErn8p2gzTl+2flg/sDbTkvIOik+CP20//mzwAXzwDcCuNTPJeFXpEpM6QEjIHm/zTF8D7T5gATYNQCe69aAloRTGulfBESBSYNyxR5g/Bhw7hKwZwl4vk9LnM5JmsBzUyDGAX3B8G23Mz/g9BuUa/0IiutfMkj7zwKmngAuXSvOpUvAWYBtF4BTnspIj/O8zPaf7qdvWITw6eZA0JLQEhKEGgxZhUj/dz3NzSKwbR44exnYvVKcy+mM5Km0JhxInUtrGkmzCPicg3W5LMGkQiZZTm9xS9Z3+4m2o8C5c4X15pTKW2Lb+fCx7WLtjYxzqiql29Icw/dA5SqYf6RTTilg+lYCIXmICKQ4IK9wxfSJY8AZK8CuFWDnanEua9ZTAMsaCog3Dt92O/MvnRGBtGwkqKRmMEkqCaa+2k+0LQDTh4rP88UHj74kF1WaATo9QHQ7mmP4HugYhtEKj4PB6ZQ+FS0hQahpldPya1kXTOqNY8DscgG+HavAttUCvBxInitrkgL4lcO33c7spBdM3kAuSnq2nx9gQfAh4JyVwvrxwel2z3p4aMlzH6DM2z/lT+8aB+Q/OT4EEqckWQSBkGD6EQKQnDCLwBSnYgcf32fXioGUFawC4esyu7CXXnDP9tOCsyD4KLB1rmgvX7zfbu2WG/Jtme0/3U/vKxBNAMoi0KcjkATCN3HOEr3UAjDrwOP71rXixYEkeKMFlSX8ocwR6KUXTJ7AaNE2tF8WfA4Ye7Kw1mwvX/yZn+eKnvcrfzC6IK/ObP/pfnpfAGQnySoISBqUXyAASS1AK0JfagWYcRDOrAF66TxZQU7jBOEbM0egH71gcgXSFZAV54NQtj9YcNIpbONCyh8Ygi8CVospApDuB63g92W2/3Q/vW8AsqM4gLIKBBIH8bcJwMCNMX68BTqBb8s6sGWtsIA6jwDk662ZI9CvXjA5A6NVa2t/IAicnC/aGV+8T74IQPm/AmGuBc+8/VP+9IEAyLslAKMV/LgAyIUInfnjwPQqMOOgI/DstQ5Mr7UAqMF8V2YXDqoXXNl+EQQ6N9v29aKdesUpWJZbAPyPme0/3U8fGIDssDid/pUASCvCaXgJmFguAEfgEXT27gDkuwaUg/nbmSMwjF7whvbLhSDL5TwwvdRqo9oqHzACkCB8U2b7T/fThwIgO01T1IMCoAZxGRhbKoAXQUcQTjkI+a4B5e5FzjGsXvCG9gdqrLGFYrpVG/UuHzBOw2/LaXxzbh43DKeoJwlAHqLndSs4udoCoIBHQE45EPk3DuitmYOQoxdctp8+rFwIWsGFYiFFoLGNchcEQC6e+OJC5J2Z7T/dTx/aApYdJ37AyJK/DIwvFxYvWr0IwEn/H1Opco5sveDUhSAAF4HJpQJkWixp6k2n4IYfMGf0amDHev2I8+l4/UbvNw8Eozw72wJePOJ8und7EkKj9ztKGA1/7WwATo44n45pWI3e7/AAGPWZ2QBkYHCU+XTMfGGQmYIxjd7vqOE0+PXzATjifDrKtTZ6v4MP/MlyRj4AR5xPF+VaqZLJF1UzKdPV6P2eLDDr3I58AI44n07ZMARbo/d78gMubWE+AEecT8e9YOn2Uheu0fs9tUCYD8AR59MpG6bR+z21gKfW1gNAz4geRT5dTEZo9H5PPRDmAzBmRM8BJzqfLiYjSKKr0fs9dYBYDwBHmE9XtRfMsIz04aQZ1+j9npygrA+Akqs8wfl0BCCTWRq935MTYL1aVQ8Ao1zlAnAi8+kEQGZTNXq/vYb75Pt/fQAcUT5dBGCj93vyAaxXi+oDoFLyT3A+3Rcavd9eY3xS/z8fgCQX/LPR3SOzkon55jg1eyAfgD8M4NcAPD6aDmBtB1e4NMDNcer1QD4AbwbwxwDe4UvRE9wHZG1gNSXDLlwLNcep1QP5APxzzwj9IIAPnXhT5ORc5EYCA9HNcWr1QD4AmRH6FQBMTSZZH98ZmD5Bh5g1FopiNns1x6nTA/kAvAfAEwDudnI+EvQxPfkEzYfaCXRSBluQMB7YHKdGD+QDsBNBH/9+AkAobqTADGK7Inw1x8nfA/kA7EXQt8kgrGAGMfBxZ5Cv5ji5eyAfgL0I+r68uR0QmUFoBQU8vfNvzXHy9kA9AORoMw7CdGQCjoUZDwL4kv/+8OZ1gJhBIjGDgMh3vTavBc035/RAPgD7JegjODfhiMwgoqeJwNPPTaB6Ezq/hq+sB4AcXeXEP+ZhGVo9vRimIQD5v5oPAZCupgDI9wg8/qz/1Xz55usyeyAfgMMQ9GU2Op4eAchpOIJQQEz/VuPlm6/K7IH6AMjgGzdl6QtyX5jWjpQFevF3lq3xf6yhrOlIAUgQCojR8gmE+l9Nl2++JrMH6gEgR5UA5KYsc+AZmCbQCDi+IvgEQMob1XBEAHIajgBMLV+0kCdws6aGu3zqfkV9AGTwjftg3JRVVRAtHQEXX/wbAcoXP5d5CID8GoJKvqDAloKOoIz/y7x8c3pmD4zhaqwjRzCYyQg5gr2ZgsFTLweWr8XQgsXjbwLWrnNtMlKgNoLBmZAa7PTCAuYIBlMvlWQswwr2UlUw45jdDSx8HbD+Ctd+HVCwePKbgJV9aASDM8Yg59TWFDysYPBtmYK91IbNOHaPA/M7gUXKXA4hWDz79cA8+W0aweCMURj+1HYfcBjBYO54MMY3tGDv8I3nmWSHOzYOLJ0LLPGXAQWLz3oB8MQUsEa16kYwOG8whjh74yJkUMFgbsNlCfYO0epwissVY34bsHw2sEIRkAEEi/dcU0SP5qhF1ggG5w3GEGdXr4L5134Fg4kAjuDQgr1DtDqcUmZETwArZwAru4BVqsv0KVh8/o3F4v0QXZBGMDhvMIY4u3MYhv95Zh+Cu1xBcxuOU/HfeDIq5cv7FuwdotXhlCBXjOXZAnyrO4BV6in0IVh8wStLuWCsUAyvEQzOG5ABz+4eB+R/ewnu/kOP/3G/l4kJTERlljQtIot2e53/IwO2OPl4FLtcnCqAp9cahT56CBZf+LpSLhhz1N5qBIPzBmTAs/sLRHcTDKbiNHdBGGymOC/3hglEvgjAnoK9A7Y4+XgiV4zVWYDAs/etxaubYPFFP1QkLtCIP8neaASD8wZkwLP7AyC/tJNg8L/xLNBu+YBdBXsHbHEFAINcMVamgdWZAoRrfPdXm8KitLdmgYveWAq+2y7iMqfuRjA4b1AGOLt/APJLqwSD3+y5T1yI0AoSbAxMMzGV1o8/My2ro2DvAK2t+GgiV4zj4+3AIwDXtwBrVJeuECze+9aW4Dut4PxkIhYsdetGMDhvoDqcPRgA+SWp4O4veQ5Uv/mAGwR78+6rQq4Yq9PAOi2fA4/vBkKudKVU7VZw77uKvWFuZbtcMNb5v0YwOG9g+jx7cADyi6Pg7gccgIxlcA5TKhaD01yYKBmVFpBZMfx/m2Bvny3t8LGqoqTliZbVI+gMgHwnMAnCIFi897cLAAZ6QyzFzzSCwXkD1OPs4QDIL5XgLmk5JHk/SD5gKdibd38VcsVYGmuBTaAzEHLHgyCcaokB7/1IkUET5IKxwF5pBIPzBqbPs4cHIC/AaeqvPL9pmHxAE+zts6VdLCD/lcgVY3UyWD0Bj1ZwqgCggXA7sPfWAoAJvaEtZBrB4Lyx6efsPADyCtmCvf00s/NnOsgVY3m8BTRZPZuGBUACdArY+5lWDqGmYbIrLHEx0ggG5w1OH2fnA7CPizQfaXqgUw80AGywMdIeaAA40u5vLt4AsMHASHugAeBIu7+5eAPABgMj7YEGgCPt/ubiDQAbDIy0BxoAjrT7m4s3AGwwMNIeaAA40u5vLt4AsMHASHugAeBIu7+5eAPABgMj7YEGgCPt/ubiDQAbDIy0B8ZYNMbkX+ZekpuIiOQrPar+xs889HJg6jZg5jAwvVZ8B+ll9PlO5/Fc/o+ECjnHfi8zYfkvM5ulmp4qJXVqx5deD4zfAkw/CGxdAZgoHfuh131QkaI5hu8Bs4Ds8B0AWLnIRGCBsFfn87JffDMwdjOw5R5g8giwZa34jnQQUwDo99wBfJ4TM7COiNdlaj2rA/jeV/vfDeATAP4UGH8I2Lrc6gc+SHqY4oMZ74VSKM0xfA+UUzB/oBUUCKMl6zSQ/PsXqZD5KQC/A0w/DEwcAcYXgYnVwppwADuBkefnCim90FmBWXwnK87Uen53BI8sbuwqaz9p5UgnQhBS+ZN1zE8Ak0utviCwq8DI8/nx5hi+Bzb4gJzKZE1SEFZZgS9/2pWR/gTAJ4HJQ8DEMWB8ARhfBsaWCwDquwQKvvNgHXvOcYVbPFJPkw+dDxC/W1Y4tWDpw/Rlgo4lo1T4/KxTihDNpJwj3/UiMLXemprjffC7eWpzDN8DlYsQDiKtVxzEqoHkyX9HRizW+nIgaQnvAiaeBCbmC0s4tgSMu2rMePAR9X252jXklaTFU108K0MHav/nvJ6ZxVVk9OI7GR2IZoGQNc/HgbHgIwqILIVujuF7oOMqWFawCoRxkfEIB5CWgkREBCNf9wMTc8A4QciBWyoGz16rwNgaML5eWKpctYZL3N+TWLX0gvtuP0HHk2n16JDyxXmVhfU0qywbJbr5GSuXKxA/sV5Y9UYWdnjwyS3qKKgarWA69Wg6fjQOIK0HadnIjPVFB+AiME4AuiUkCFnESyCSkmAuU7Cjm15wX+2X2ifBRn9A8mKcW2UFjULVQcgVDl80u40SYh763FfvquhLCxitoBYUsoJfjXKttByMq9CKcHn4sPuCbgXNJwyWkECcz5Q376UX3LNncZyQAAADEklEQVT9fFgIJs6lBBwtn3Tt6FpIz4RWnuQxPh2XIGzm4CwQ9hWIFgBTK0gQHiIAJddKq0ELQh+KL1qUR4MvSEsoENIKrgALHNiMox+94K7tl9qnnMio8MSf6SNwGpYVjCDk/Ju7isq496fCqX0BkDeqlWwKwic1gAQSpzGREnFgREz01eALLvvq2Kfi45m6cf3qBXdsfxRbJMho8dimqOhEK8cXQRr9QVpvPoDNMXQP9A3ACELFxPh+jACkP0fLIKFCCRRqKuPUdqjlC9o07JZwKVNHeBC94DQcZO0XAAkmgotAk9QYrR9f/BvByYfMSATDVMzwTXMM3QMDAVAgVHCZ7/MaQK4QZUHiNCbBQlqUw74YCb7gcmYkelC9YFlwvVv7RRAorTuBkECU9asCID9/x9B935zYzyKkqpfiNHxcA0gLQgvBAaPVkCqm3h2AtC5m/RyEqzw/4xhGL3hD++MmslgqCbgUfLKAcRrmTlBzDN0DA1tAXUlWcDm1IOIIJAjlT/Fd05lbFQFwjdtgGcewesFt7Rc/Gx8iWjUCjGCT1YvWT1MwgUqrf3NG45tTbcu0aximWx9xENcEQHGbcYAEwtSXSqY0gnCdgeuMI0cvuGx/FUGgFhwEYrR80QckWN+X0fjm1DwAWv8RgJFilJZBznz0pQg+AZAAlVWh1GvGka0XzB0cCQi30aSGVa9AF62fLOB7MhrfnJoPwPER59Px+o3e76mL5Kwp2G57xPl0kxc3er+nLvyKtLmhfUC78RHn081ONnq/pzcAR5xPR9mRRu/31IVgvgUccT4dNaobvd/TGYAjzqejumqj93s6A3DE+XRUg2VSCjdaGr3fUw+I+VPwiPPpqJjO8J1Nw43e7ymHwHoAKMFd7QErAeEE5NNJMb3R+z3lsGcNzgfgiPPpomJ6o/d76oGwPgCOKJ8uKqY3er+nKwBHmE+noqRG7/fUA199U/AI8+kEwEbv93QHoEhZTnA+nYqSGr3fBoAtaiqBUImdm5hPJwA2er+nKwBHnE+X1gUzSbnR+z11wPj/AeCpPDD3t7rvAAAAAElFTkSuQmCC",oTe="uniform sampler2D weightMap;varying vec2 vOffset0;varying vec2 vOffset1;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 a;a.x=texture2D(weightMap,vOffset0).a;a.y=texture2D(weightMap,vOffset1).g;a.wz=texture2D(weightMap,uv).rb;vec4 color=inputColor;if(dot(a,vec4(1.0))>=1e-5){bool h=max(a.x,a.z)>max(a.y,a.w);vec4 blendingOffset=vec4(0.0,a.y,0.0,a.w);vec2 blendingWeight=a.yw;movec(bvec4(h),blendingOffset,vec4(a.x,0.0,a.z,0.0));movec(bvec2(h),blendingWeight,a.xz);blendingWeight/=dot(blendingWeight,vec2(1.0));vec4 blendingCoord=blendingOffset*vec4(texelSize,-texelSize)+uv.xyxy;color=blendingWeight.x*texture2D(inputBuffer,blendingCoord.xy);color+=blendingWeight.y*texture2D(inputBuffer,blendingCoord.zw);}outputColor=color;}",lTe="varying vec2 vOffset0;varying vec2 vOffset1;void mainSupport(const in vec2 uv){vOffset0=uv+texelSize*vec2(1.0,0.0);vOffset1=uv+texelSize*vec2(0.0,1.0);}",Jp={LOW:0,MEDIUM:1,HIGH:2,ULTRA:3},i$=class extends Zc{constructor({preset:e=Jp.MEDIUM,edgeDetectionMode:t=VT.COLOR,predicationMode:i=rCe.DISABLED}={}){super("SMAAEffect",oTe,{vertexShader:lTe,blendFunction:Ri.NORMAL,attributes:Fc.CONVOLUTION|Fc.DEPTH,uniforms:new Map([["weightMap",new at(null)]])});let r,n;arguments.length>1&&(r=arguments[0],n=arguments[1],arguments.length>2&&(e=arguments[2]),arguments.length>3&&(t=arguments[3])),this.renderTargetEdges=new Wi(1,1,{minFilter:pi,stencilBuffer:!1,depthBuffer:!1}),this.renderTargetEdges.texture.name="SMAA.Edges",this.renderTargetWeights=this.renderTargetEdges.clone(),this.renderTargetWeights.texture.name="SMAA.Weights",this.uniforms.get("weightMap").value=this.renderTargetWeights.texture,this.clearPass=new _k(!0,!1,!1),this.clearPass.overrideClearColor=new jt(0),this.clearPass.overrideClearAlpha=1,this.edgeDetectionPass=new Wo(new nCe),this.edgeDetectionMaterial.edgeDetectionMode=t,this.edgeDetectionMaterial.predicationMode=i,this.weightsPass=new Wo(new pCe);let s=new sQ;s.onLoad=()=>{let a=new Br(r);a.name="SMAA.Search",a.magFilter=Qi,a.minFilter=Qi,a.generateMipmaps=!1,a.needsUpdate=!0,a.flipY=!0,this.weightsMaterial.searchTexture=a;let o=new Br(n);o.name="SMAA.Area",o.magFilter=pi,o.minFilter=pi,o.generateMipmaps=!1,o.needsUpdate=!0,o.flipY=!1,this.weightsMaterial.areaTexture=o,this.dispatchEvent({type:"load"})},s.itemStart("search"),s.itemStart("area"),r!==void 0&&n!==void 0?(s.itemEnd("search"),s.itemEnd("area")):typeof Image<"u"&&(r=new Image,n=new Image,r.addEventListener("load",()=>s.itemEnd("search")),n.addEventListener("load",()=>s.itemEnd("area")),r.src=Ej,n.src=Aj),this.applyPreset(e)}get edgesTexture(){return this.renderTargetEdges.texture}getEdgesTexture(){return this.edgesTexture}get weightsTexture(){return this.renderTargetWeights.texture}getWeightsTexture(){return this.weightsTexture}get edgeDetectionMaterial(){return this.edgeDetectionPass.fullscreenMaterial}get colorEdgesMaterial(){return this.edgeDetectionMaterial}getEdgeDetectionMaterial(){return this.edgeDetectionMaterial}get weightsMaterial(){return this.weightsPass.fullscreenMaterial}getWeightsMaterial(){return this.weightsMaterial}setEdgeDetectionThreshold(e){this.edgeDetectionMaterial.edgeDetectionThreshold=e}setOrthogonalSearchSteps(e){this.weightsMaterial.orthogonalSearchSteps=e}applyPreset(e){let t=this.edgeDetectionMaterial,i=this.weightsMaterial;switch(e){case Jp.LOW:t.edgeDetectionThreshold=.15,i.orthogonalSearchSteps=4,i.diagonalDetection=!1,i.cornerDetection=!1;break;case Jp.MEDIUM:t.edgeDetectionThreshold=.1,i.orthogonalSearchSteps=8,i.diagonalDetection=!1,i.cornerDetection=!1;break;case Jp.HIGH:t.edgeDetectionThreshold=.1,i.orthogonalSearchSteps=16,i.diagonalSearchSteps=8,i.cornerRounding=25,i.diagonalDetection=!0,i.cornerDetection=!0;break;case Jp.ULTRA:t.edgeDetectionThreshold=.05,i.orthogonalSearchSteps=32,i.diagonalSearchSteps=16,i.cornerRounding=25,i.diagonalDetection=!0,i.cornerDetection=!0;break}}setDepthTexture(e,t=Mh){this.edgeDetectionMaterial.depthBuffer=e,this.edgeDetectionMaterial.depthPacking=t}update(e,t,i){this.clearPass.render(e,this.renderTargetEdges),this.edgeDetectionPass.render(e,t,this.renderTargetEdges),this.weightsPass.render(e,this.renderTargetEdges,this.renderTargetWeights)}setSize(e,t){this.edgeDetectionMaterial.setSize(e,t),this.weightsMaterial.setSize(e,t),this.renderTargetEdges.setSize(e,t),this.renderTargetWeights.setSize(e,t)}dispose(){let{searchTexture:e,areaTexture:t}=this.weightsMaterial;e!==null&&t!==null&&(e.dispose(),t.dispose()),super.dispose()}static get searchImageDataURL(){return Ej}static get areaImageDataURL(){return Aj}},cTe=`uniform float offset;uniform float darkness;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){const vec2 center=vec2(0.5);vec3 color=inputColor.rgb;
#if VIGNETTE_TECHNIQUE == 0
float d=distance(uv,center);color*=smoothstep(0.8,offset*0.799,d*(darkness+offset));
#else
vec2 coord=(uv-center)*vec2(offset);color=mix(color,vec3(1.0-darkness),dot(coord,coord));
#endif
outputColor=vec4(color,inputColor.a);}`,zS={DEFAULT:0,ESKIL:1},uTe=class extends Zc{constructor({blendFunction:e=Ri.NORMAL,technique:t=zS.DEFAULT,eskil:i=!1,offset:r=.5,darkness:n=.5}={}){super("VignetteEffect",cTe,{blendFunction:e,defines:new Map([["VIGNETTE_TECHNIQUE",t.toFixed(0)]]),uniforms:new Map([["offset",new at(r)],["darkness",new at(n)]])})}get technique(){return Number(this.defines.get("VIGNETTE_TECHNIQUE"))}set technique(e){this.technique!==e&&(this.defines.set("VIGNETTE_TECHNIQUE",e.toFixed(0)),this.setChanged())}get eskil(){return this.technique===zS.ESKIL}set eskil(e){this.technique=e?zS.ESKIL:zS.DEFAULT}getTechnique(){return this.technique}setTechnique(e){this.technique=e}get offset(){return this.uniforms.get("offset").value}set offset(e){this.uniforms.get("offset").value=e}getOffset(){return this.offset}setOffset(e){this.offset=e}get darkness(){return this.uniforms.get("darkness").value}set darkness(e){this.uniforms.get("darkness").value=e}getDarkness(){return this.darkness}setDarkness(e){this.darkness=e}},Eh=class{constructor(e,t){this.enabled=!1,this.effect=new e(t),Object.defineProperty(this,"opacity",{enumerable:!0,set(i){this.effect.blendMode.opacity.value=i},get(){return this.effect.blendMode.opacity.value}}),Object.defineProperty(this,"blendFunction",{enumerable:!0,set(i){this.effect.blendMode.setBlendFunction(Number(i))},get(){return this.effect.blendMode.blendFunction}}),this.blendFunction=Ri.NORMAL}},hTe=class extends Eh{constructor(){super(WCe),this.blendFunction=Ri.SCREEN}set intensity(e){this.effect.intensity=e}get intensity(){return this.effect.intensity}set luminanceThreshold(e){this.effect.luminanceMaterial.threshold=e}get luminanceThreshold(){return this.effect.luminanceMaterial.threshold}set luminanceSmoothing(e){this.effect.luminanceMaterial.smoothing=e}get luminanceSmoothing(){return this.effect.luminanceMaterial.smoothing}set blurScale(e){this.effect.blurPass.scale=e}get blurScale(){return this.effect.blurPass.scale}set kernelSize(e){this.effect.blurPass.kernelSize=e}get kernelSize(){return this.effect.blurPass.kernelSize}},dTe=class extends Eh{constructor(){super(qCe)}set contrast(e){this.effect.uniforms.get("contrast").value=e}get contrast(){return this.effect.uniforms.get("contrast").value}set brightness(e){this.effect.uniforms.get("brightness").value=e}get brightness(){return this.effect.uniforms.get("brightness").value}},pTe=class extends Eh{constructor(){super($Ce),this.effect.offset=new ve(.01,.01)}set offset(e){this.effect.offset.set(e[0]/1e3,e[1]/1e3)}get offset(){return[this.effect.offset.x*1e3,this.effect.offset.y*1e3]}},fTe=class extends Eh{constructor(){super(QCe)}},mTe=class extends Eh{constructor(){super(iTe),this._hue=0}set hue(e){this._hue=e,this.effect.setHue(e)}get hue(){return this._hue}set saturation(e){this.effect.uniforms.get("saturation").value=e}get saturation(){return this.effect.uniforms.get("saturation").value}},gTe=class extends Eh{constructor(){super(nTe),this.blendFunction=Ri.OVERLAY}},vTe=class extends Eh{constructor(){super(uTe)}get eskil(){return this.effect.eskil}set eskil(e){this.effect.eskil=e}get darkness(){return this.effect.uniforms.get("darkness").value}set darkness(e){this.effect.uniforms.get("darkness").value=e}get offset(){return this.effect.uniforms.get("offset").value}set offset(e){this.effect.uniforms.get("offset").value=e}},yTe=class extends Eh{constructor(e){super(eTe)}set focalLength(e){this.effect.circleOfConfusionMaterial.uniforms.focalLength.value=e/2e3}get focalLength(){return this.effect.circleOfConfusionMaterial.uniforms.focalLength.value}set focusDistance(e){this.effect.circleOfConfusionMaterial.uniforms.focusDistance.value=this.isPerspectiveCamera?e/2e3:(e+992)/2e3}get focusDistance(){return this.effect.circleOfConfusionMaterial.uniforms.focusDistance.value}get bokehScale(){return this.effect.bokehScale}set bokehScale(e){this.effect.bokehScale=e}setCamera(e){let t=!1;(e.isPerspectiveCamera&&this.isPerspectiveCamera===!1||!e.isPerspectiveCamera&&this.isPerspectiveCamera===!0)&&(t=!0),e.isPerspectiveCamera?(this.effect.circleOfConfusionMaterial.adoptCameraSettings(e.perspCamera),this.isPerspectiveCamera=!0):(this.effect.circleOfConfusionMaterial.adoptCameraSettings(e),this.isPerspectiveCamera=!1),t&&this.effect.setChanged()}},xTe=class extends Eh{constructor(){super(aTe)}get granularity(){return this.effect.getGranularity()}set granularity(e){this.effect.setGranularity(e)}},wTe=`#define GLSLIFY 1
varying vec2 vUv;varying vec2 vTexCoords[9];uniform vec2 resolution;void main(){vUv=position.xy*0.5+0.5;vec2 texelSize=vec2(1.0)/resolution;vTexCoords[0]=vUv+vec2(-texelSize.x,-texelSize.y);vTexCoords[1]=vUv+vec2(0.0,-texelSize.y);vTexCoords[2]=vUv+vec2(texelSize.x,-texelSize.y);vTexCoords[3]=vUv+vec2(-texelSize.x,0.0);vTexCoords[4]=vUv+vec2(0.0,0.0);vTexCoords[5]=vUv+vec2(texelSize.x,0.0);vTexCoords[6]=vUv+vec2(-texelSize.x,texelSize.y);vTexCoords[7]=vUv+vec2(0.0,texelSize.y);vTexCoords[8]=vUv+vec2(texelSize.x,texelSize.y);gl_Position=vec4(position.xy,1.0,1.0);}`,bTe=`#define GLSLIFY 1
#include <common>
varying vec2 vUv;varying vec2 vTexCoords[9];uniform sampler2D inputBuffer;uniform sampler2D historyBuffer;uniform sampler2D velocityBuffer;uniform sampler2D depthBuffer;uniform vec2 resolution;
#define USE_YCOCG
#define USE_CATMULL_ROM
const float feedback_min=0.5;const float feedback_max=0.95;vec3 RGB_YCoCg(vec3 c){return vec3(c.x/4.0+c.y/2.0+c.z/4.0,c.x/2.0-c.z/2.0,-c.x/4.0+c.y/2.0-c.z/4.0);}vec3 YCoCg_RGB(vec3 c){return clamp(vec3(c.x+c.y-c.z,c.x+c.z,c.x-c.y-c.z),vec3(0.0),vec3(1.0));}vec4 sample_color(sampler2D tex,vec2 uv){
#ifdef USE_YCOCG
vec4 c=texture(tex,uv);return vec4(RGB_YCoCg(c.rgb),c.a);
#else
return texture(tex,uv);
#endif
}vec4 sample_catmull_rom(sampler2D tex,vec2 uv,vec2 texSize){vec2 samplePos=uv*texSize;vec2 texPos1=floor(samplePos-0.5)+0.5;vec2 f=samplePos-texPos1;vec2 w0=f*(-0.5+f*(1.0-0.5*f));vec2 w1=1.0+f*f*(-2.5+1.5*f);vec2 w2=f*(0.5+f*(2.0-1.5*f));vec2 w3=f*f*(-0.5+0.5*f);vec2 w12=w1+w2;vec2 offset12=w2/(w1+w2);vec2 texPos0=texPos1-1.0;vec2 texPos3=texPos1+2.0;vec2 texPos12=texPos1+offset12;texPos0/=texSize;texPos3/=texSize;texPos12/=texSize;vec4 result=vec4(0.0);result+=texture2D(tex,vec2(texPos12.x,texPos0.y))*w12.x*w0.y;result+=texture2D(tex,vec2(texPos0.x,texPos12.y))*w0.x*w12.y;result+=texture2D(tex,vec2(texPos12.x,texPos12.y))*w12.x*w12.y;result+=texture2D(tex,vec2(texPos3.x,texPos12.y))*w3.x*w12.y;result+=texture2D(tex,vec2(texPos12.x,texPos3.y))*w12.x*w3.y;return result;}vec3 choose_motion_vector(){
#ifdef CHOOSE_LONGEST_MOTION_VECTOR
float longest=-1.0;vec3 v_choose=vec3(-1.0);for(int i=0;i<9;i++){vec3 v=texture2D(velocityBuffer,vTexCoords[i]).rgb;float l=length(v.xy);if(l>longest){longest=l;v_choose=v;}}return v_choose;
#else
float closest_depth=1000.0;vec2 closest_uv_offset=vec2(0.0);for(int i=0;i<9;i++){float neighbor_depth=texture2D(depthBuffer,vTexCoords[i]).r;if(neighbor_depth<closest_depth){closest_uv_offset=vTexCoords[i];closest_depth=neighbor_depth;}}return texture2D(velocityBuffer,closest_uv_offset).rgb;
#endif
}vec4 clipAabb(vec3 aabb_min,vec3 aabb_max,vec4 avg,vec4 input_texel){const float FLT_EPS=0.00000001;vec3 p_clip=0.5*(aabb_max+aabb_min);vec3 e_clip=0.5*(aabb_max-aabb_min)+FLT_EPS;vec4 v_clip=input_texel-vec4(p_clip,avg.w);vec3 v_unit=v_clip.xyz/e_clip;vec3 a_unit=abs(v_unit);float ma_unit=max(a_unit.x,max(a_unit.y,a_unit.z));if(ma_unit>1.0){return vec4(p_clip,avg.w)+v_clip/ma_unit;}else{return input_texel;}}vec3 clip_aabb_variance(in vec3 cOld,in vec3 cNew,in vec3 centre,in vec3 halfSize){if(all(lessThanEqual(abs(cOld-centre),halfSize))){return cOld;}vec3 dir=(cNew-cOld);vec3 near=centre-sign(dir)*halfSize;vec3 tAll=(near-cOld)/dir;float t=0.0001;for(int i=0;i<3;i++){if(tAll[i]>=0.0&&tAll[i]<t){t=tAll[i];}}if(t>=0.0001){return cOld;}return cOld+dir*t;}void main(){vec3 v=choose_motion_vector();vec2 velocity=v.rg;vec2 previousPixelPos=vUv-velocity;vec4 currentColor=sample_color(inputBuffer,vUv);
#ifdef USE_CATMULL_ROM
vec4 previousColor=sample_catmull_rom(historyBuffer,previousPixelPos,resolution);
#else
vec4 previousColor=sample_color(historyBuffer,previousPixelPos);
#endif
#ifdef USE_YCOCG
previousColor=vec4(RGB_YCoCg(previousColor.rgb),previousColor.a);
#endif
vec4 ctl=sample_color(inputBuffer,vTexCoords[0]);vec4 ctc=sample_color(inputBuffer,vTexCoords[1]);vec4 ctr=sample_color(inputBuffer,vTexCoords[2]);vec4 cml=sample_color(inputBuffer,vTexCoords[3]);vec4 cmc=sample_color(inputBuffer,vTexCoords[4]);vec4 cmr=sample_color(inputBuffer,vTexCoords[5]);vec4 cbl=sample_color(inputBuffer,vTexCoords[6]);vec4 cbc=sample_color(inputBuffer,vTexCoords[7]);vec4 cbr=sample_color(inputBuffer,vTexCoords[8]);vec4 cmin=min(ctl,min(ctc,min(ctr,min(cml,min(cmc,min(cmr,min(cbl,min(cbc,cbr))))))));vec4 cmax=max(ctl,max(ctc,max(ctr,max(cml,max(cmc,max(cmr,max(cbl,max(cbc,cbr))))))));vec4 cavg=(ctl+ctc+ctr+cml+cmc+cmr+cbl+cbc+cbr)/9.0;vec4 cmin5=min(ctc,min(cml,min(cmc,min(cmr,cbc))));vec4 cmax5=max(ctc,max(cml,max(cmc,max(cmr,cbc))));vec4 cavg5=(ctc+cml+cmc+cmr+cbc)/5.0;cmin=0.5*(cmin+cmin5);cmax=0.5*(cmax+cmax5);cavg=0.5*(cavg+cavg5);
#ifdef USE_YCOCG
vec2 chroma_extent=vec2(0.25*0.5*(cmax.r-cmin.r));vec2 chroma_center=currentColor.gb;cmin.yz=chroma_center-chroma_extent;cmax.yz=chroma_center+chroma_extent;cavg.yz=chroma_center;
#endif
vec4 previousColorClipped=clamp(previousColor,cmin,cmax);
#ifdef LUMINANCE_DIFFERENCES
#ifdef USE_YCOCG
float lum0=currentColor.r;float lum1=previousColorClipped.r;
#else
float lum0=luminance(currentColor.rgb);float lum1=luminance(previousColorClipped.rgb);
#endif
float unbiased_diff=abs(lum0-lum1)/max(lum0,max(lum1,0.2));float unbiased_weight=1.0-unbiased_diff;float unbiased_weight_sqr=unbiased_weight*unbiased_weight;float k_feedback=mix(feedback_min,feedback_max,unbiased_weight_sqr);vec4 result=mix(currentColor,previousColorClipped,vec4(k_feedback));
#else
const float alpha=0.1;vec4 result=mix(currentColor,previousColorClipped,1.0-alpha);
#endif
#ifdef USE_YCOCG
gl_FragColor=vec4(YCoCg_RGB(result.rgb).rgb,result.a);
#else
gl_FragColor=result;
#endif
}`,_Te=`#define GLSLIFY 1
varying vec2 vUv;void main(){gl_Position=vec4(position.xy,1.0,1.0);vUv=position.xy*0.5+0.5;}`,STe=`#define GLSLIFY 1
layout(location=1)out vec4 gVelocity;varying vec2 vUv;uniform sampler2D inputBuffer;void main(){gl_FragColor=texture2D(inputBuffer,vUv);gVelocity=vec4(0.0);}`,cz=class extends Ui{constructor(){super({name:"PassthroughMaterial",uniforms:{inputBuffer:new at(null)},blending:An,depthWrite:!1,depthTest:!1,vertexShader:_Te,fragmentShader:STe})}set inputBuffer(e){this.uniforms.inputBuffer.value=e}},MTe=class extends Sa{constructor(){super("TAAResolvePass"),this.MRTCompatible=!0,this.needsSwap=!1,this.passThroughMaterial=new cz,this.resolutionVector=new ve,this.resolveMaterial=new Ui({name:"TAAResolveMaterial",uniforms:{inputBuffer:new at(null),historyBuffer:new at(null),velocityBuffer:new at(null),depthBuffer:new at(null),resolution:new at(new ve)},blending:An,depthWrite:!1,depthTest:!1,vertexShader:wTe,fragmentShader:bTe}),this.historyRenderTarget=new Wi(1024,1024,{minFilter:pi,stencilBuffer:!1,depthBuffer:!1}),this.historyRenderTarget.texture.name="TAA.History",this.resultRenderTarget=new Wi(1024,1024,{minFilter:pi,stencilBuffer:!1,depthBuffer:!1}),this.resultRenderTarget.texture.name="TAA.Output"}setSize(e,t){this.historyRenderTarget.setSize(e,t),this.resultRenderTarget.setSize(e,t)}render(e,t){this.fullscreenMaterial=this.resolveMaterial,this.resolveMaterial.uniforms.inputBuffer.value=t.texture[0],this.resolveMaterial.uniforms.velocityBuffer.value=t.texture[1],this.resolveMaterial.uniforms.depthBuffer.value=t.depthTexture,this.resolveMaterial.uniforms.historyBuffer.value=this.historyRenderTarget.texture,this.resolveMaterial.uniforms.resolution.value.set(t.width,t.height),e.setRenderTarget(this.resultRenderTarget),e.render(this.scene,this.camera),this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=this.resultRenderTarget.texture,e.setRenderTarget(this.historyRenderTarget),e.render(this.scene,this.camera);let i=this.renderToScreen?null:t;this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=this.resultRenderTarget.texture,e.setRenderTarget(i),e.render(this.scene,this.camera)}dispose(){this.resultRenderTarget.dispose(),this.historyRenderTarget.dispose(),this.resolveMaterial.dispose(),this.passThroughMaterial.dispose()}},ETe=class extends Sa{constructor(e,t,i){super("TransmissionPass",void 0,t),this.MRTCompatible=!0,this.depthPass=new Sj(e,t,{renderTarget:i.transmissionDepthTarget}),this.passThroughMaterial=new cz,this.splineScene=e,this.needsSwap=!1}updatePasses(e){this.passThroughMaterial=new cz,this.depthPass=new Sj(this.splineScene,this.camera,{renderTarget:e.transmissionDepthTarget})}setCamera(e){this.camera=e}setScene(e){this.splineScene=e}render(e,t,i){let r=this.camera.layers.mask,n=e;n.setRenderTarget(n.transmissionRenderTarget),this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=t.texture[0],n.clear(),n.render(this.scene,this.camera),this.camera.layers.disable(3),this.depthPass.render(e,t,i),n.shadowMap.needsUpdate=!1,n.shadowMap.autoUpdate=!1;let s=this.renderToScreen?null:t;this.camera.layers.set(3),e.setRenderTarget(s),e.render(this.splineScene,this.camera),this.camera.layers.mask=r}},Cj=new Uc,ATe=new Ui({transparent:!0,vertexShader:`
        void main() {
            gl_Position = vec4(0.0);
        }
    `,fragmentShader:`
        layout(location = 1) out vec4 gVelocity;

        void main() {
            gl_FragColor = vec4(0.0);
			gVelocity = vec4(0.0);
        }
    `}),uz=class extends Sa{constructor(e,t,i){super("OpaquePass",t??Cj,i),this.MRTCompatible=!0,this.hasTransmissionPass=!1,this.clear=!0,this.clearColorOnly=!1,this.clearDepth=!1,this.needsSwap=!1,this.originalMaterials=new Map,this.MRTCompatible=e}setCamera(e){this.camera=e}setScene(e){this.scene=e??Cj}getScene(){return this.scene}render(e,t){this.camera.layers.enable(3),this.hasTransmissionPass&&(this.originalMaterials.clear(),this.scene.traverse(r=>{r.layers.isEnabled(3)&&r instanceof wa&&(this.originalMaterials.set(r.id,r.material),r.material=ATe)}),e.shadowMap.needsUpdate=!0,e.shadowMap.autoUpdate=!0),this.camera.layers.enable(8);let i=this.renderToScreen?null:t;e.setRenderTarget(i),this.clearColorOnly&&e.clear(!0,!1,!0),this.clear&&e.clear(),e.render(this.scene,this.camera),this.clearDepth&&e.clear(!1,!0,!1),this.hasTransmissionPass&&this.originalMaterials.forEach((r,n)=>{let s=this.scene.getObjectById(n);s&&(s.material=r)})}},CTe=class{constructor(e,{depthBuffer:t=!0,stencilBuffer:i=!1,multisampling:r=0,frameBufferType:n=0}={}){this.renderer=e,this.helperStartIndex=0,this.copyPass=new lz,this.depthTexture=null,this.timer=new GCe,this._width=1,this._height=1,this.passes=[],this.helperPasses=[],this.autoRenderToScreen=!0,this.inputBuffer=this.createBuffer(t,i,n,r,!0,"input buffer mrt"),this.inputBufferSingle=this.createBuffer(t,i,n,r,!1," input buffer single"),this.inputBufferSingle.texture.dispose(),this.inputBufferSingle.depthTexture.dispose(),this.inputBufferSingle.texture=this.inputBuffer.texture[0],this.inputBufferSingle.depthTexture=this.inputBuffer.depthTexture,this.outputBuffer=this.inputBuffer.clone(),this.outputBuffer.name="output buffer mrt",this.outputBufferSingle=this.createBuffer(t,i,n,r,!1,"output buffer single"),this.outputBufferSingle.texture.dispose(),this.outputBufferSingle.depthTexture.dispose(),this.outputBufferSingle.texture=this.outputBuffer.texture[0],this.outputBufferSingle.depthTexture=this.outputBuffer.depthTexture,this.setRenderer(e)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(e){let t=this.inputBuffer,i=this.multisampling;i>0&&e>0?(this.inputBuffer.samples=e,this.outputBuffer.samples=e,this.inputBuffer.dispose(),this.outputBuffer.dispose()):i!==e&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),console.log("creating new input buffer"),this.inputBuffer=this.createBuffer(t.depthBuffer,t.stencilBuffer,t.texture.type,e,!0,"new input buffer"),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(e){var t;if(this.renderer=e,e!==null){let i=e.getSize(new ve),r=((t=e.getContext().getContextAttributes())==null?void 0:t.alpha)??!1,n=this.inputBuffer.texture[0].type;n===Js&&e.outputEncoding===hi&&(this.inputBuffer.texture[0].encoding=hi,this.outputBuffer.texture[0].encoding=hi,this.inputBuffer.dispose(),this.outputBuffer.dispose(),console.log("doing some kinda dispose??")),e.autoClear=!1,this.setSize(i.width,i.height,!1);for(let s of this.passes)s.initialize(e,r,n)}}replaceRenderer(e,t=!0){let i=this.renderer,r=i.domElement.parentNode;return this.setRenderer(e),t&&r!==null&&(r.removeChild(i.domElement),r.appendChild(e.domElement)),i}createDepthTexture(){let e=this.depthTexture=new qv(this._width,this._height);return this.inputBuffer.depthTexture=e,this.inputBuffer.stencilBuffer?(e.format=Gf,e.type=Sf):e.type=qu,e}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(let e of this.passes)e.setDepthTexture(null)}}createBuffer(e,t,i,r,n,s){let a=this.renderer,o=a===null?new ve:a.getDrawingBufferSize(new ve),l={minFilter:pi,magFilter:pi,wrapS:Ar,wrapT:Ar,stencilBuffer:t,depthBuffer:e},c;return r>0?(c=new Wi(o.width,o.height,l),c.samples=r):(n?(c=new Goe(o.width,o.height,2,l),c.texture[1].type=ch):c=new Wi(o.width,o.height,l),c.depthTexture=new qv(2048,2048),c.depthTexture.type=Sn),i===Js&&a!==null&&a.outputEncoding===hi&&(Array.isArray(c.texture)?c.texture.forEach(u=>u.encoding=hi):c.texture.encoding=hi),Array.isArray(c.texture)?c.texture.forEach((u,h)=>{u.name=`EffectComposer.Buffer ${n} ${h}`,u.generateMipmaps=!1}):(c.texture.name=`EffectComposer.Buffer ${n}`,c.texture.generateMipmaps=!1),c.name=s,c}addPass(e,t){var o;let i=this.passes,r=this.renderer,n=r.getDrawingBufferSize(new ve),s=((o=r.getContext().getContextAttributes())==null?void 0:o.alpha)??!1,a;if(e.MRTCompatible&&(a=this.inputBuffer.texture[0].type),e.MRTCompatible||(a=this.inputBuffer.texture.type),e.setRenderer(r),e.setSize(n.width,n.height),e.initialize(r,s,a),this.autoRenderToScreen&&(i.length>0&&(i[i.length-1].renderToScreen=!1),e.renderToScreen&&(this.autoRenderToScreen=!1)),t!==void 0?i.splice(t,0,e):i.push(e),this.autoRenderToScreen&&(i[i.length-1].renderToScreen=!0),e.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){let l=this.createDepthTexture();for(e of i)e.setDepthTexture(l)}else e.setDepthTexture(this.depthTexture)}setHelperStartIndex(e){this.helperStartIndex=e}removePass(e){let t=this.passes,i=t.indexOf(e);if(i!==-1&&t.splice(i,1).length>0){if(this.depthTexture!==null){let r=(n,s)=>n||s.needsDepthTexture;t.reduce(r,!1)||e.getDepthTexture()===this.depthTexture&&e.setDepthTexture(null)}this.autoRenderToScreen&&i===t.length&&(e.renderToScreen=!1,t.length>0&&(t[t.length-1].renderToScreen=!0))}}removeAllPasses(){let e=this.passes;e.length>0&&(this.autoRenderToScreen&&(e[e.length-1].renderToScreen=!1),this.passes=[])}render(e){let t=this.renderer,i=this.copyPass,r=this.inputBuffer,n=this.outputBuffer,s=this.inputBufferSingle,a=this.outputBufferSingle,o=!1,l,c,u,h;e===void 0&&(e=this.timer.update().getDelta());for(let d of this.passes)d.enabled&&(d.MRTCompatible?d.render(t,r,n,e,o):d.render(t,s,a,e,o),d.needsSwap&&(o&&(i.renderToScreen=d.renderToScreen,l=t.getContext(),c=t.state.buffers.stencil,c.setFunc(l.NOTEQUAL,1,4294967295),i.render(t,r,n,e,o),c.setFunc(l.EQUAL,1,4294967295)),u=r,h=s,r=n,s=a,n=u,a=h),d instanceof VCe?o=!0:d instanceof gCe&&(o=!1))}setSize(e,t,i){let r=this.renderer;if(this._width=e,this._height=t,e===void 0||t===void 0){let s=r.getSize(new ve);e=s.width,t=s.height}r.setSize(e,t,i);let n=r.getDrawingBufferSize(new ve);this.inputBuffer.setSize(n.width,n.height),this.outputBuffer.setSize(n.width,n.height),this.inputBufferSingle.setSize(n.width,n.height),this.outputBufferSingle.setSize(n.width,n.height);for(let s of this.passes)s.setSize(n.width,n.height)}reset(){let e=this.timer.isAutoResetEnabled();this.dispose(),this.autoRenderToScreen=!0,this.timer.setAutoResetEnabled(e)}dispose(){for(let e of this.passes)e.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.inputBufferSingle!==null&&this.inputBufferSingle.dispose(),this.outputBufferSingle!==null&&this.outputBufferSingle.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose()}},TTe=new Ui({name:"CombineMaterial",uniforms:{inputBufferA:new at(null),inputBufferB:new at(null)},blending:An,depthWrite:!1,depthTest:!1,vertexShader:`
varying vec2 vUv;
void main() {
    gl_Position = vec4(position.xy, 1.0, 1.0);
    vUv = position.xy * 0.5 + 0.5;
}
`,fragmentShader:`
    varying vec2 vUv;
    uniform sampler2D inputBufferA;
    uniform sampler2D inputBufferB;

    // TODO: Why do we need these when postpro of framemode is enabled???
    layout(location = 1) out vec4 gVelocity;

    void main() {
	vec4 resA = texture2D(inputBufferA, vUv);
	vec4 resB = texture2D(inputBufferB, vUv);
    float a = resA.a + resB.a * ( 1.0 - resA.a );

	vec4 res;
	res.rgb =  resA.rgb + (resB.rgb * (1.0 - resA.a));
	res.a = resA.a + resB.a * (1.0 - resA.a);
	gl_FragColor = res;
    gVelocity = vec4(0.0);
    }
`}),PTe=class extends Sa{constructor(e){super("HelperPass",void 0,e),this.MRTCompatible=!1,this.fullscreenMaterial=TTe,this.helperPass=new uz(!1,void 0,this.camera),this.helperPass.hasTransmissionPass=!1,this.helperPass.clear=!1,this.helperPass.renderToScreen=!1,this.helperPassOnTop=new uz(!1,void 0,this.camera),this.helperPassOnTop.hasTransmissionPass=!1,this.helperPassOnTop.clear=!1,this.helperPassOnTop.renderToScreen=!1;let t=new i$({preset:Jp.LOW,edgeDetectionMode:VT.COLOR});this.effectPass=new lC(this.camera,t),this.rt=new Wi(10,10,{minFilter:pi,magFilter:pi,wrapS:Ar,wrapT:Ar,depthBuffer:!0})}setSize(e,t){this.rt.setSize(e,t),this.effectPass.setSize(e,t)}set sceneHelpers(e){this.helperPass.setScene(e)}get sceneHelpers(){return this.helperPass.getScene()}set sceneHelpersOnTop(e){this.helperPassOnTop.setScene(e)}get sceneHelpersOnTop(){return this.helperPassOnTop.getScene()}setCamera(e){this.helperPass.setCamera(e),this.helperPassOnTop.setCamera(e)}initialize(e,t,i){super.initialize(e,t,i),this.effectPass.initialize(e,t,i)}dispose(){super.dispose(),this.rt.dispose(),this.effectPass.dispose()}render(e,t,i){this.rt.depthTexture=t.depthTexture;let r=e.getClearAlpha();e.setClearAlpha(0),this.helperPass.clearDepth=!0,this.helperPass.clearColorOnly=!0,this.helperPass.render(e,this.rt),this.helperPassOnTop.render(e,this.rt),this.effectPass.renderToScreen=!1,this.effectPass.render(e,this.rt,i),this.fullscreenMaterial.uniforms.inputBufferA.value=i.texture,this.fullscreenMaterial.uniforms.inputBufferB.value=t.texture,e.setClearAlpha(r),e.setRenderTarget(null),e.clear(),e.render(this.scene,this.camera)}},DTe=`#define GLSLIFY 1
#include <skinning_pars_vertex>
out vec3 n;void main(){
#include <beginnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
#include <defaultnormal_vertex>
#include <begin_vertex>
#include <skinning_vertex>
vec4 view_space=viewMatrix*modelMatrix*vec4(transformed,1.0);gl_Position=projectionMatrix*view_space;n=normalize(transformedNormal);}`,RTe=`#define GLSLIFY 1
in vec3 n;void main(){gl_FragColor=vec4(n,1.0);}`,ITe=`#define GLSLIFY 1
out vec2 v_uv;void main(){v_uv=uv;gl_Position=vec4(position.xy,1.0,1.0);}`,LTe=`#define GLSLIFY 1
in vec2 v_uv;const float pi=3.14159265;const float num_steps=4.0;const float num_directions=4.0;uniform float near;uniform float far;uniform float fov;uniform vec4 proj_info;uniform bool is_ortho;uniform vec2 resolution;uniform float radius_of_influence;uniform float radius_in_screen_space;uniform float exponent;uniform vec3 ao_color;uniform float bias;uniform sampler2D texture_depth;uniform sampler2D texture_normals;uniform sampler2D texture_blue_noise;uniform sampler2D texture_blue_noise_in_disk;uniform sampler2D texture_color_pass;uniform int frame_index;uniform bool fog_enabled;uniform float fog_near;uniform float fog_far;vec3 uv_to_view_space(vec2 uv,float eye_z){return vec3((uv*proj_info.xy+proj_info.zw)*(is_ortho ? 1.0 : eye_z),eye_z);}float linearize_depth(float depth_sampled){float z=is_ortho ? depth_sampled : depth_sampled*2.0-1.0;return mix((2.0*near*far)/(far+near-z*(far-near)),near+z*(far-near),float(is_ortho));}vec3 get_view_position(vec2 uv_coords){float linear_depth=linearize_depth(texture(texture_depth,uv_coords).x);return uv_to_view_space(uv_coords,linear_depth);}vec3 min_difference(vec3 p,vec3 right,vec3 left){vec3 v1=right-p;vec3 v2=p-left;return(dot(v1,v1)<dot(v2,v2))? v1 : v2;}vec3 rebuild_normal(in vec2 uv,in vec3 p){vec2 one_over_resolution=1.0/resolution;vec3 r=get_view_position(uv+vec2(one_over_resolution.x,0));vec3 l=get_view_position(uv+vec2(-one_over_resolution.x,0));vec3 t=get_view_position(uv+vec2(0,one_over_resolution.y));vec3 b=get_view_position(uv+vec2(0,-one_over_resolution.y));return normalize(cross(min_difference(p,r,l),min_difference(p,t,b)));}float falloff(float distance_squared){float neg_inv_r2=-1.0/(radius_of_influence*radius_of_influence);return distance_squared*neg_inv_r2+1.0;}float ao_contribution(vec3 P,vec3 N,vec3 S){vec3 to_sample=S-P;float norm_squared=dot(to_sample,to_sample);float norm=sqrt(norm_squared);float cos_theta=dot(N,to_sample)/norm;return clamp(cos_theta-bias,0.0,1.0)*clamp(falloff(norm_squared),0.0,1.0);}float compute_ambient_occlusion(vec2 uv,float radius_in_screen_space,vec3 pc,vec3 view_space_n){vec2 one_over_resolution=1.0/resolution;ivec2 noise_uv=ivec2(int(mod(gl_FragCoord.x,128.0)),int(mod(gl_FragCoord.y,128.0)));float noise=texelFetch(texture_blue_noise,noise_uv,0).r;noise=fract(noise+0.61803398875*float(frame_index));float theta=noise*2.0*3.1415;float ct=cos(theta);float st=sin(theta);float step_size=radius_in_screen_space/(num_steps+1.0);const float angle_step=2.0*pi/num_directions;float contribution=0.0;for(int i=0;i<int(num_directions);++i){float current_pixel=step_size+1.0;for(int j=0;j<int(num_steps);++j){int index=i*int(num_steps)+j;vec2 blue_noise_sample=texelFetch(texture_blue_noise_in_disk,ivec2(index,0),0).rg;vec2 disk_point;disk_point.x=blue_noise_sample.x*ct-blue_noise_sample.y*st;disk_point.y=blue_noise_sample.x*st+blue_noise_sample.y*ct;vec2 sample_direction=disk_point;vec2 snapped_uv=round(current_pixel*sample_direction)*one_over_resolution+uv;vec3 ps=get_view_position(snapped_uv);current_pixel+=step_size;contribution+=ao_contribution(pc,view_space_n,ps);}}float mult=1.0/(1.0-bias);contribution*=mult/(num_directions*num_steps);return clamp(1.0-contribution*2.0,0.0,1.0);}
#define USE_GBUFFER_NORMALS
void main(){vec3 view_space_p=get_view_position(v_uv);
#ifdef USE_GBUFFER_NORMALS
vec3 view_space_n=texture(texture_normals,v_uv).rgb;view_space_n.z*=-1.0;
#else
vec3 view_space_n=-rebuild_normal(v_uv,view_space_p);
#endif
float radius_ss=radius_in_screen_space/(is_ortho ? 1.0 : view_space_p.z);float ao=compute_ambient_occlusion(v_uv,radius_ss,view_space_p,view_space_n);float final=pow(ao,exponent);if(view_space_p.z>=far){final=1.0;}vec3 color=mix(ao_color,vec3(1.0),final);if(fog_enabled){float fog_factor=smoothstep(fog_near,fog_far,view_space_p.z);color=mix(color,vec3(1.0),fog_factor);}gl_FragColor=vec4(color,1.0);}`,OTe=`#define GLSLIFY 1
out vec2 v_uv;void main(){gl_Position=vec4(position.xy,1.0,1.0);v_uv=uv;}`,zTe=`#define GLSLIFY 1
in vec2 v_uv;uniform sampler2D texture_ao_lrez;uniform sampler2D texture_depth_lrez;uniform sampler2D texture_depth_hrez;uniform float near;uniform float far;float linearize_depth(float depth_sampled){float z=depth_sampled*2.0-1.0;return(2.0*near*far)/(far+near-z*(far-near));}vec2 nearest_depth_filter(in vec2 uv){vec2 resolution=vec2(textureSize(texture_depth_lrez,0));vec2 texel_size=1.0/resolution;vec2 offset=uv-0.5*texel_size;float d_hrez=texture(texture_depth_hrez,uv).r;float a=abs(d_hrez-texture(texture_depth_lrez,offset).r);float b=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(texel_size.x,0.0)).r);float c=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(0.0,texel_size.y)).r);float d=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(texel_size.x,texel_size.y)).r);float min_diff=min(a,min(b,min(c,d)));if(min_diff==a)return offset;if(min_diff==b)return offset+vec2(texel_size.x,0.0);if(min_diff==c)return offset+vec2(0.0,texel_size.y);if(min_diff==d)return offset+vec2(texel_size.x,texel_size.y);}void main(){
#ifdef DEBUG
float d_lrez=texture(texture_depth_lrez,v_uv).r;float d_hrez=texture(texture_depth_hrez,v_uv).r;float output_d=mix(linearize_depth(d_lrez)/far,linearize_depth(d_hrez)/far,step(0.5,v_uv.x));gl_FragColor=vec4(vec3(output_d),1.0);
#else
vec2 filtered_uv=nearest_depth_filter(v_uv);vec4 ao=texture(texture_ao_lrez,filtered_uv);gl_FragColor=vec4(ao.rgb,1.0);gl_FragColor=ao;
#endif
}`,Hy=[[.478712,.875764],[-.337956,-.793959],[-.955259,-.028164],[.864527,.325689],[.209342,-.395657],[-.106779,.672585],[.156213,.235113],[-.413644,-.082856],[-.415667,.323909],[.141896,-.93998],[.954932,-.182516],[-.766184,.410799],[-.434912,-.458845],[.415242,-.078724],[.728335,-.491777],[-.058086,-.066401],[.20299,.686837],[-.808362,-.556402],[.507386,-.640839],[-.723494,-.22924],[.48974,.317826],[-.622663,.765301],[-.01064,.929347],[.663146,.647618],[-.096674,-.413835],[.525945,-.321063],[-.122533,.366019],[.195235,-.687983],[-.563203,.098748],[.418563,.561335],[-.378595,.800367],[.826922,.001024],[-.085372,-.766651],[-.92192,.183673],[-.590008,-.721799],[.167751,-.164393],[.032961,-.56253],[.6329,-.107059],[-.46408,.569669],[-.173676,-.958758],[-.242648,-.234303],[-.275362,.157163],[.382295,-.795131],[.562955,.115562],[.190586,.470121],[.770764,-.297576],[.237281,.93105],[-.666642,-.455871],[-.905649,-.298379],[.33952,.157829],[.701438,-.7041],[-.062758,.160346],[-.220674,.957141],[.642692,.432706],[-.77339,-.015272],[-.671467,.24688],[.158051,.062859],[.806009,.527232],[-.05762,-.247071],[.333436,-.51671],[-.550658,-.315773],[-.652078,.589846],[.008818,.530556],[-.210004,.519896]],NTe=new Ui({vertexShader:DTe,fragmentShader:RTe}),$m=new Ui({vertexShader:OTe,fragmentShader:zTe,uniforms:{texture_ao_lrez:new at(null),texture_depth_lrez:new at(null),texture_depth_hrez:new at(null),near:new at(null),far:new at(null)}}),BTe=class extends Sa{constructor(e,t){super("AmbientOcclusionPass",void 0,t),this.fogEnabled=!1,this.fogNear=1,this.fogFar=1e3,this.frameIndex=0,this._runHalfRes=!0,this._width=1,this._height=1;let i=1024,r=1024;this.gBuffer=new Wi(i,r,{type:Vw?ch:Sn,depthTexture:new qv(i,r),minFilter:pi,magFilter:pi}),this.depthBufferHighRes=new Wi(i,r,{depthTexture:new qv(i,r)}),this.aoBuffer=new Wi(i,r,{minFilter:pi,magFilter:pi}),this.splineScene=e,this.splineCamera=t;let n=new Float32Array(Hy.length*2);for(let a=0;a<Hy.length;a++){let o=a*2;n[o+0]=Hy[a][0],n[o+1]=Hy[a][1]}this.blueNoiseInDiskTexture=new Yo(n,Hy.length,1,fA,Sn),this.blueNoiseInDiskTexture.wrapS=Xu,this.blueNoiseInDiskTexture.wrapT=Xu,this.blueNoiseInDiskTexture.needsUpdate=!0,this.hbaoMaterial=new Ui({vertexShader:ITe,fragmentShader:LTe,uniforms:{near:new at(null),far:new at(null),fov:new at(null),proj_info:new at(new ti),is_ortho:new at(!1),resolution:new at(new ve),radius_of_influence:new at(8),radius_in_screen_space:new at(1),exponent:new at(1),ao_color:new at(new B),bias:new at(.5),texture_depth:new at(null),texture_normals:new at(null),texture_blue_noise:new at(null),texture_blue_noise_in_disk:new at(this.blueNoiseInDiskTexture),frame_index:new at(0),fog_enabled:new at(!1),fog_near:new at(1),fog_far:new at(1e3)}}),this.radius=128,this.aoColor={r:0,g:0,b:0},this.bias=.5,this.hbaoMaterial.uniforms.texture_depth.value=this.gBuffer.depthTexture,this.hbaoMaterial.uniforms.texture_normals.value=this.gBuffer.texture,this.needsSwap=!0,this.aaBuffer=new Wi(i,r,{minFilter:pi,magFilter:pi,wrapS:Ar,wrapT:Ar,depthBuffer:!1,type:Sn});let s=new i$({preset:Jp.ULTRA,edgeDetectionMode:VT.COLOR});this.effectPass=new lC(this.camera,s)}initialize(e,t,i){super.initialize(e,t,i),this.effectPass.initialize(e,t,i)}setBlueNoiseTexture(e){this.hbaoMaterial.uniforms.texture_blue_noise.value=e}setSize(e,t){this._width=e,this._height=t,this.depthBufferHighRes.setSize(e,t);let i=this._runHalfRes?.5:1,r=e*i,n=t*i;this.gBuffer.setSize(r,n),this.aoBuffer.setSize(r,n),this.hbaoMaterial.uniforms.resolution.value.set(r,n),this.aaBuffer.setSize(r,n),this.effectPass.setSize(r,n)}get runHalfRes(){return this._runHalfRes}set runHalfRes(e){this._runHalfRes=e,this.setSize(this._width,this._height)}setCamera(e){this.splineCamera=e}setScene(e){this.splineScene=e}setDepthTexture(e){this.depthBufferHighRes.depthTexture=e,$m.uniforms.texture_depth_hrez.value=e,$m.needsUpdate=!0}render(e,t,i){this.splineScene.overrideMaterial=NTe;let r=this.splineCamera.layers.mask;if(this.splineCamera.layers.set(5),e.setRenderTarget(this.gBuffer),e.clear(),e.render(this.splineScene,this.splineCamera),e.setRenderTarget(this.depthBufferHighRes),e.clear(),e.render(this.splineScene,this.splineCamera),this.splineScene.overrideMaterial=null,this.splineCamera.layers.mask=r,this.hbaoMaterial.uniforms.radius_of_influence.value=this.radius,this.hbaoMaterial.uniforms.ao_color.value.set(this.aoColor.r,this.aoColor.g,this.aoColor.b),this.hbaoMaterial.uniforms.bias.value=this.bias,this.hbaoMaterial.uniforms.fog_enabled.value=this.fogEnabled,this.hbaoMaterial.uniforms.fog_near.value=this.fogNear,this.hbaoMaterial.uniforms.fog_far.value=this.fogFar,this.hbaoMaterial.uniforms.frame_index.value=this.frameIndex,this.frameIndex++,this.splineCamera.isPerspectiveCamera){this.hbaoMaterial.uniforms.near.value=this.splineCamera.perspCamera.near,this.hbaoMaterial.uniforms.far.value=this.splineCamera.perspCamera.far;let n=this.splineCamera.perspCamera.projectionMatrix.elements,s=2/n[0],a=2/n[5],o=-(1-n[8])/n[0],l=-(1+n[9])/n[5];this.hbaoMaterial.uniforms.proj_info.value.set(s,a,o,l);let c=this.splineCamera.perspCamera.fov*(Math.PI/180),u=this.hbaoMaterial.uniforms.resolution.value.y/(Math.tan(c*.5)*2),h=this.hbaoMaterial.uniforms.radius_of_influence.value*.5*u;this.hbaoMaterial.uniforms.radius_in_screen_space.value=h,this.hbaoMaterial.uniforms.is_ortho.value=!1}else{this.hbaoMaterial.uniforms.near.value=this.splineCamera.orthoCamera.near,this.hbaoMaterial.uniforms.far.value=this.splineCamera.orthoCamera.far;let n=this.splineCamera.orthoCamera.projectionMatrix.elements,s=2/n[0],a=2/n[5],o=-(1+n[12])/n[0],l=-(1-n[13])/n[5];this.hbaoMaterial.uniforms.proj_info.value.set(s,a,o,l);let c=.5*(this.hbaoMaterial.uniforms.resolution.value.y/a),u=this.hbaoMaterial.uniforms.radius_of_influence.value*c;this.hbaoMaterial.uniforms.radius_in_screen_space.value=u,this.hbaoMaterial.uniforms.is_ortho.value=!0}this.runHalfRes?(this.fullscreenMaterial=this.hbaoMaterial,e.setRenderTarget(this.aoBuffer),e.clear(),e.render(this.scene,this.camera),this.fullscreenMaterial=$m,$m.uniforms.texture_ao_lrez.value=this.aoBuffer.texture,$m.uniforms.texture_depth_lrez.value=this.gBuffer.depthTexture,$m.uniforms.texture_depth_hrez.value=this.depthBufferHighRes.depthTexture,e.setRenderTarget(e.aoRenderTarget),e.clear(),e.render(this.scene,this.camera)):(this.fullscreenMaterial=this.hbaoMaterial,e.setRenderTarget(this.aaBuffer),e.clear(),e.render(this.scene,this.camera),this.effectPass.renderToScreen=!1,this.effectPass.render(e,this.aaBuffer,e.aoRenderTarget))}dispose(){this.gBuffer.dispose(),this.depthBufferHighRes.dispose(),this.aoBuffer.dispose()}},kTe=`
varying vec2 vUv;
void main() {
    vUv = uv;
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,UTe=`
uniform sampler2D tInput;
uniform sampler2D tMap;
uniform vec2 resolution;
varying vec2 vUv;

uniform vec2 uResolution;
uniform vec2 uCoords;

// Draws a rectangle at center <st> with size <size>
float rectangle(vec2 st, vec2 size) {
    size = vec2(0.5) - size * 0.5;
    vec2 uv = vec2(step(size.x, st.x), step(size.y, st.y));
    uv *= vec2(step(size.x, 1.0 - st.x), step(size.y, 1.0 - st.y));

    return uv.x * uv.y;
}

uniform vec2 uSize;
uniform float uScale;
uniform float uDPR;
uniform float uCurrent;
uniform vec3 uSceneColor;

void main() {
    vec2 screenUv = gl_FragCoord.xy / uResolution.xy;
    screenUv *= 1.0 / uDPR;

    vec2 center = vec2(0.5, -0.5);
    vec2 outsideUv = screenUv;
    outsideUv += center;
    outsideUv -= uCoords.xy / uResolution.xy;
    outsideUv = (outsideUv - 0.5) + 0.5;
    outsideUv -= center;
    vec2 s = (uSize / uResolution) * uScale;
    float isOutside = 1.0 - rectangle(outsideUv, s);
    
    vec2 mid = vec2(0.5);
    vec2 insideUv = (screenUv - mid + s * mid) / s;
    vec4 background = texture2D(tInput, screenUv);
    vec4 image = texture2D(tMap, insideUv);
    gl_FragColor = mix(image, background, isOutside);
}
`,FTe=class extends Wo{constructor(){super(new Ui({vertexShader:kTe,fragmentShader:UTe,uniforms:{tInput:new at(null),tMap:new at(null),uResolution:new at(new ve),uSize:new at(new ve),uCoords:new at(new ve),uScale:new at(1),uSceneColor:new at(new jt(16711680)),uDPR:new at(1),uCurrent:new at(0)}}),"tInput"),this.needsSwap=!0}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.tMap.value}set texture(e){this.uniforms.tMap.value=e}},VTe=`
void main() {
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,HTe=`
uniform sampler2D toScene;
uniform sampler2D fromScene;
uniform vec2 resolution;

uniform vec2 uResolution;
uniform float uDPR;

uniform float mixRatio;
uniform sampler2D tMixTexture;
uniform int useTexture;
uniform float threshold;

void main() {
	vec2 screenUv = gl_FragCoord.xy / uResolution.xy;
	screenUv *= 1.0 / uDPR;

	vec4 texel1 = texture2D( fromScene, screenUv );
	vec4 texel2 = texture2D( toScene, screenUv );

	if (useTexture==1) {
		
		vec4 transitionTexel = texture2D( tMixTexture, screenUv );
		float r = mixRatio * (1.0 + threshold * 2.0) - threshold;
		float mixf=clamp((transitionTexel.r - r)*(1.0/threshold), 0.0, 1.0);
		
		gl_FragColor = mix( texel1, texel2, mixf );
	} else {
		
		gl_FragColor = mix( texel1, texel2, mixRatio );
		
	}
}
`,GTe=[],jTe=class extends Wo{constructor(){super(new Ui({vertexShader:VTe,fragmentShader:HTe,uniforms:{toScene:new at(null),fromScene:new at(null),uResolution:new at(new ve),uDPR:new at(1),mixRatio:new at(0),threshold:new at(.1),useTexture:new at(0),tMixTexture:{value:GTe[0]}}}),"toScene"),this.needsSwap=!0}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.fromScene.value}set texture(e){this.uniforms.fromScene.value=e}},WTe=`
void main() {
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,XTe=`
uniform sampler2D inputBuffer;
uniform sampler2D blurredInputBuffer;
uniform sampler2D overlay;
uniform float blurIntensity;

uniform vec2 uResolution;
uniform float uDPR;

void main() {
	vec2 screenUv = gl_FragCoord.xy / uResolution.xy;
	screenUv *= 1.0 / uDPR;

	vec4 texel1 = texture2D( overlay, screenUv );
	vec4 texel2 = texture2D( inputBuffer, screenUv );
	vec4 texel3 = texture2D( blurredInputBuffer, screenUv );

	float blurMask2 = max(sign(texel1.a), 0.0) * blurIntensity;
    gl_FragColor = mix( mix(texel2, texel3, blurMask2), texel1, texel1.a );
}
`,qTe=class extends Wo{constructor(){super(new Ui({vertexShader:WTe,fragmentShader:XTe,uniforms:{inputBuffer:new at(null),blurredInputBuffer:new at(null),overlay:new at(null),uResolution:new at(new ve),uDPR:new at(1),blurIntensity:new at(0)}})),this._blurEnabled=!1,this.blurTarget=new Wi(1,1,{minFilter:pi,magFilter:pi,wrapS:Ar,wrapT:Ar}),this.blurPass=new Sk({width:window.innerWidth,height:window.innerHeight,kernelSize:HT.HUGE,resolutionScale:.25}),this.blurPass.renderToScreen=!1,this.uniforms.blurredInputBuffer.value=this.blurTarget.texture}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.overlay.value}set texture(e){this.uniforms.overlay.value=e}setResolution(e,t,i=1){this.uniforms.uResolution.value.set(e,t),this.uniforms.uDPR.value=i,this.blurPass.setSize(e,t),this.blurTarget.setSize(e,t),this.blurPass.setSize(e,t)}get uiCanvas(){return this._uiCanvas}set uiCanvas(e){this._uiCanvas=e,e.texture&&(this.uniforms.overlay.value=e.texture);let t=e.frame;if(t){let i=t.data.backgroundBlur,r=i.radius;this._blurEnabled=i.enabled,this.uniforms.blurIntensity.value=this._blurEnabled?1:0,this.blurPass.scale=r/3}}render(e,t,i,r,n){this._blurEnabled&&(this.blurPass.setDepthTexture(this.getDepthTexture()),this.blurPass.render(e,t,this.blurTarget,r,n)),super.render(e,t,i,r,n)}},YTe=`
varying vec2 vUv;
void main() {
    vUv = uv;
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,QTe=`
uniform sampler2D tInput;
uniform sampler2D tOverlayImage;
varying vec2 vUv;
uniform vec2 uResolution;
uniform vec2 uRightBottom;
uniform vec2 uImageSize;
uniform float uScale;
uniform float uDPR;

vec3 blendNormal(vec3 base, vec3 blend) {
	return blend;
}

vec3 blendNormal(vec3 base, vec3 blend, float opacity) {
	return (blendNormal(base, blend) * opacity + base * (1.0 - opacity));
}

vec4 drawFixedSizeImage(sampler2D image, vec2 screenUV, vec2 imageSize, vec2 imageCoords, vec2 screenSize, float dpr) {
	vec2 uv = (screenUV * screenSize * dpr - imageCoords) / (imageSize * dpr);
	if (uv.x < 0.0 || uv.x > 1.0 || uv.y < 0.0 || uv.y > 1.0) {
		return vec4(0.0);
	}
	return texture2D(image, uv);
}

void main() {
    vec2 screenUV = gl_FragCoord.xy / (uResolution.xy * uDPR);
	vec2 imageCoords = vec2(uResolution.x * uDPR - uImageSize.x * uScale * uDPR - uRightBottom.x * uDPR, uRightBottom.y * uDPR);
    vec4 background = texture2D(tInput, screenUV);
    vec4 image = drawFixedSizeImage(tOverlayImage, screenUV, uImageSize * uScale, imageCoords, uResolution, uDPR);
    gl_FragColor = vec4(blendNormal(background.rgb, image.rgb, image.a), max(background.a, image.a));
}
`,KTe=class extends Wo{constructor(){super(new Ui({vertexShader:YTe,fragmentShader:QTe,uniforms:{tInput:new at(null),tOverlayImage:new at(null),uResolution:new at(new ve),uImageSize:new at(new ve),uRightBottom:new at(new ve(20,20)),uScale:new at(.25),uDPR:new at(1)}}),"tInput")}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.tOverlayImage.value}set texture(e){this.uniforms.tOverlayImage.value=e,this.uniforms.uImageSize.value.set(e.image.width,e.image.height)}};function Tj(e,t){return t&&t.enabled&&e.push(t.effect),e}var ZTe=e=>Object.values(Ri).includes(e)?e:Ri.NORMAL,$Te=class extends Cs{constructor(e,t){super(),this._needsDOFResize=t,this.postprocessingState=qA.defaultData,this._scene=new Uc,this._camera=new Qs,this.effects=new Map,this.blueNoiseTexture=new Yo,this._renderToScreen=!0,this._isUIOverlayEnabled=!1,this.clock=new zpe,this.renderer=e,this.debug=!1,this.effects.set("bloom",new hTe),this.effects.set("chromaticAberration",new pTe),this.effects.set("vignette",new vTe),this.effects.set("noise",new gTe),this.effects.set("colorAverage",new fTe),this.effects.set("hueSaturation",new mTe),this.effects.set("brightnessContrast",new dTe),this.effects.set("depthOfField",new yTe),this.effects.set("pixelation",new xTe),this.effectComposer=new CTe(this.renderer),this.effectComposer.autoRenderToScreen=!1,this.opaquePass=new uz(!0,this.scene,this.camera),this.opaquePass.clear=!0,this.transmissionPass=new ETe(this.scene,this.camera,this.renderer),this.aoPass=new BTe(this.scene,this.camera),this.taaPass=new MTe,this.taaPass.renderToScreen=!1,this.helperPass=new PTe(this.camera),this.helperPass.renderToScreen=!1,this.stylesOverlayPass=new FTe,this.stylesOverlayPass.enabled=!1,this.uiOverlayPass=new qTe,this.uiOverlayPass.enabled=!1,this.logoOverlayPass=new KTe,this.logoOverlayPass.enabled=!1,this.sceneTransitionPass=new jTe,this.sceneTransitionPass.enabled=!1,this._initCopyPass(),this._initPasses()}set overlayTexture(e){e!==void 0?(this.stylesOverlayPass.texture=e,this.stylesOverlayPass.enabled=!0):this.stylesOverlayPass.enabled=!1}get overlayTexture(){return this.stylesOverlayPass.texture}set sceneHelpers(e){this.helperPass.sceneHelpers=e}get sceneHelpers(){return this.helperPass.sceneHelpers}set sceneHelpersOnTop(e){this.helperPass.sceneHelpersOnTop=e}get sceneHelpersOnTop(){return this.helperPass.sceneHelpersOnTop}get scene(){return this._scene}set scene(e){this._scene=e,this.opaquePass.setScene(e),this.transmissionPass.setScene(e),this.aoPass.setScene(e)}get camera(){return this._camera}set camera(e){let t=this._camera!==e;this._camera=e,this.opaquePass.setCamera(e),this.transmissionPass.setCamera(e),t&&this.transmissionPass.updatePasses(this.renderer),this.aoPass.setCamera(e),this.helperPass.setCamera(e),this.effects.get("depthOfField").setCamera(e)}updateRenderToScreen(){let e=!1;for(let t=this.effectComposer.passes.length-1;t>=0;t--){let i=this.effectComposer.passes[t];if(i.enabled===!0&&!e&&this._renderToScreen){i.renderToScreen=!0,e=!0;continue}i.renderToScreen=!1}}get isUIOverlayEnabled(){return this._isUIOverlayEnabled}disableUIOverlay(){this._isUIOverlayEnabled=!1}enableUIOverlay(){this._isUIOverlayEnabled=!0}disableHelpers(){this.helperPass.enabled=!1,this.updateRenderToScreen()}enableHelpers(){this.helperPass.enabled=!0,this.updateRenderToScreen()}updateBlueNoiseTexture(e){this.blueNoiseTexture=new Yo(e,128,128),this.blueNoiseTexture.wrapS=Xu,this.blueNoiseTexture.wrapT=Xu,this.blueNoiseTexture.minFilter=Qi,this.blueNoiseTexture.magFilter=Qi,this.blueNoiseTexture.needsUpdate=!0}setAmbientOcclusionParams(e,t,i,r,n,s,a,o){this.aoPass.enabled=e,this.aoPass.radius=t,this.aoPass.bias=i,this.aoPass.aoColor=r,this.aoPass.fogEnabled=n,this.aoPass.fogNear=s,this.aoPass.fogFar=a,this.aoPass.runHalfRes!==!o&&(this.aoPass.runHalfRes=!o)}setTransmissionPassEnabled(e){this.transmissionPass.enabled=e,this.opaquePass.hasTransmissionPass=e}_initPasses(){var e,t,i;if((e=this.uvEffectPass)==null||e.dispose(),(t=this.effectPass)==null||t.dispose(),this.effectComposer.removeAllPasses(),this.transmissionPass.updatePasses(this.renderer),this.effectComposer.addPass(this.aoPass),this.effectComposer.addPass(this.opaquePass),this.effectComposer.addPass(this.transmissionPass),this.effectComposer.addPass(this.taaPass),this.postprocessingState.enabled){let r=[this.effects.get("pixelation")].reduce(Tj,[]);r.length>0&&(this.uvEffectPass=new lC(this.camera,...r),this.uvEffectPass.renderToScreen=!1,this.effectComposer.addPass(this.uvEffectPass));let n=[this.effects.get("chromaticAberration"),this.effects.get("bloom"),this.effects.get("depthOfField"),this.effects.get("colorAverage"),this.effects.get("hueSaturation"),this.effects.get("brightnessContrast"),this.effects.get("vignette"),this.effects.get("noise")].reduce(Tj,[]);if(n.length>0&&(this.effectPass=new lC(this.camera,...n),this.effectPass.renderToScreen=!1,this.effectComposer.addPass(this.effectPass),this._needsDOFResize&&((i=this.effects.get("depthOfField"))==null?void 0:i.enabled)&&window!==void 0)){let s=this.renderer.viewportWidth,a=this.renderer.viewportHeight;this.renderer.setSize(s-1,a-1),this.renderer.setSize(s,a)}}this.effectComposer.addPass(this.stylesOverlayPass),this.effectComposer.addPass(this.uiOverlayPass),this.effectComposer.addPass(this.sceneTransitionPass),this.effectComposer.addPass(this.helperPass),this.effectComposer.addPass(this.logoOverlayPass)}_initCopyPass(){if(this._savePass)return;let e=new ve;this.renderer.getDrawingBufferSize(e),this._rt=new Wi(e.x,e.y,{depthBuffer:!1,stencilBuffer:!1,wrapS:Xu,wrapT:Xu}),this._rt.samples=0,this._savePass=new lz(this._rt,!1),this._savePass.renderToScreen=!1}setCopyPass(e){this._rt=e,this._savePass=new lz(this._rt,!1),this.renderToScreen=!1}get renderToScreen(){return this._renderToScreen}set renderToScreen(e){if(this._renderToScreen===e)return;let t=this.effectComposer;!t||(e===!0?t.removePass(this._savePass):t.addPass(this._savePass),this._renderToScreen=e,this.updateRenderToScreen())}set sceneTransitionFromTexture(e){e!==this.sceneTransitionPass.texture&&(e!==null?this.sceneTransitionPass.enabled=!0:(this.sceneTransitionPass.enabled=!1,this.updateRenderToScreen()),this.sceneTransitionPass.texture=e)}setWatermark(e){this.logoOverlayPass.enabled=e!==null,e&&(this.logoOverlayPass.texture=e)}get texture(){return this._rt&&this._rt.texture}get renderTarget(){return this._rt}updatePostprocessing(e){let{enabled:t,...i}=e,r=!1;t!==this.postprocessingState.enabled&&(r=!0);for(let n of Object.entries(i)){let s=n[1],a=this.effects.get(n[0]);if(a){a.enabled!==s.enabled&&(r=!0),a.enabled=s.enabled;for(let[o,l]of Object.entries(s))o==="blendFunction"?a.blendFunction=ZTe(l):a[o]=l}}this.postprocessingState=e,r&&this._initPasses()}render(){this.effectComposer.render(this.clock.getDelta())}setScissor(e,t,i,r){e instanceof ti?(this.effectComposer.inputBuffer.scissor.set(e.x,e.y,e.z,e.w),this.effectComposer.outputBuffer.scissor.set(e.x,e.y,e.z,e.w)):(this.effectComposer.inputBuffer.scissor.set(e,t,i,r),this.effectComposer.outputBuffer.scissor.set(e,t,i,r));let n=this.renderer.getPixelRatio();this.effectComposer.inputBuffer.scissor.multiplyScalar(n),this.effectComposer.outputBuffer.scissor.multiplyScalar(n),this.renderer.setScissor(e,t,i,r)}setScissorTest(e){this.effectComposer.inputBuffer.scissorTest=e,this.effectComposer.outputBuffer.scissorTest=e,this.renderer.setScissorTest(e)}setViewport(e,t,i,r){e instanceof ti?(this.effectComposer.inputBuffer.viewport.copy(e),this.effectComposer.outputBuffer.viewport.copy(e)):(this.effectComposer.inputBuffer.viewport.set(e,t,i,r),this.effectComposer.outputBuffer.viewport.set(e,t,i,r))}resize(e,t,i){if(this.effectComposer.setSize(e,t,i),this._rt){let r=this.renderer.getPixelRatio();this._rt.setSize(e*r,t*r)}}dispose(){var e,t;(e=this.uvEffectPass)==null||e.dispose(),(t=this.effectPass)==null||t.dispose(),this.effectComposer.dispose()}},JTe=e=>`

// PCSS implementation based on:
// https://www.gamedev.net/articles/programming/graphics/contact-hardening-soft-shadows-made-fast-r4906/
// NOTE: This number affects how big the shadow blur can
// possibly get. Bigger number == bigger blur, but less precise results

const float  gPenumbraFilterSize = 80.0;
const int   gPenumbraSamples = ${e};
const int gShadowSamples = ${e};
const float gShadowSamplesRpc = 1.0f / float(gShadowSamples);

#ifdef USE_SHADOWMAP
    #if NUM_DIR_LIGHT_SHADOWS > 0

        uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
        varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];

        struct DirectionalLightShadow {
            float shadowBias;
            float shadowNormalBias;
            float shadowRadius;
            vec2 shadowMapSize;
        };

        uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];

    #endif

    #if NUM_SPOT_LIGHT_SHADOWS > 0

        uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
        varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_SHADOWS ];

        struct SpotLightShadow {
            float shadowBias;
            float shadowNormalBias;
            float shadowRadius;
            vec2 shadowMapSize;
        };

        uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];

    #endif

    #if NUM_POINT_LIGHT_SHADOWS > 0

        uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
        varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];

        struct PointLightShadow {
            float shadowBias;
            float shadowNormalBias;
            float shadowRadius;
            vec2 shadowMapSize;
            float shadowCameraNear;
            float shadowCameraFar;
        };

        uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];

    #endif

    /*
    #if NUM_RECT_AREA_LIGHTS > 0

        // TODO (abelnation): create uniforms for area light shadows

    #endif
    */

float computePenumbra(int index, sampler2D shadowMap, float temporalAngle, float texelSize, vec2 uv, float compare, float texelScalar, float shadowRadius)
{
    float penumbra = 1.0;
    float blockerDepthAvg = 0.0;
    float blockerCount = 0.0;

    #pragma unroll_loop_start
    for(int i = 0; i < gPenumbraSamples; i ++)
    {
        vec2 offset = (vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize) * texelScalar;
        float depth = unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) );

        if(depth < compare + 0.0001)
        {
            blockerDepthAvg += depth;
            blockerCount++;
        }
    }
    #pragma unroll_loop_end

    if (blockerCount > 0.0)
    {
        blockerDepthAvg /= blockerCount;

        // Compute penumbra
        penumbra = (compare - blockerDepthAvg) / (blockerDepthAvg);
        penumbra *= penumbra;
        penumbra *= 200.0 * penumbraSize[min(index, 5 - 1)]; // Magic number that affects how quickly the penumbra grows

        return clamp(penumbra, 0.00, 1.0);
    }
    return 0.0;
}

float vogelShadow(int index, sampler2D shadowMap, vec2 uv, float texelSize, float compare, float shadowRadius)
{
    float shadow         = 0.0f;

    // NOTE: When using TAA, we should use screen space interleaved gradient noise
    vec2 halton = haltonSequence[frameIndex];
    float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
    float temporalAngle  = temporalOffset * PI2;

    float texelScalar = (gPenumbraFilterSize) / (texelSize * 1024.);
    float penumbra = computePenumbra(index, shadowMap, temporalAngle, texelSize, uv, compare, texelScalar, shadowRadius);
    if (penumbra == -1.0) {
        return 1.0;
    }

    #pragma unroll_loop_start
    for (int i = 0; i < gShadowSamples; i++)
    {
        vec2 vogelSample =  vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;
        // Overall blurring offset
        vec2 offset = vogelSample * (shadowRadius * 2.);

        // Penumbra offset
        offset += vogelSample * (penumbra * texelScalar);

        shadow += step( compare, unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) ) );
    }
    #pragma unroll_loop_end

    return shadow * gShadowSamplesRpc;
}


    float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {

        return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );

    }

    vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {

        return unpackRGBATo2Half( texture2D( shadow, uv ) );

    }

    float VSMShadow (sampler2D shadow, vec2 uv, float compare ){

        float occlusion = 1.0;

        vec2 distribution = texture2DDistribution( shadow, uv );

        float hard_shadow = step( compare , distribution.x ); // Hard Shadow

        if (hard_shadow != 1.0 ) {

            float distance = compare - distribution.x ;
            float variance = max( 0.00000, distribution.y * distribution.y );
            float softness_probability = variance / (variance + distance * distance ); // Chebeyshevs inequality
            softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 ); // 0.3 reduces light bleed
            occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );

        }
        return occlusion;

    }

    float getShadow( int i, sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {

        float shadow = 1.0;

        shadowCoord.xyz /= shadowCoord.w;
        shadowCoord.z += shadowBias;

        // if ( something && something ) breaks ATI OpenGL shader compiler
        // if ( all( something, something ) ) using this instead

        bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
        bool inFrustum = all( inFrustumVec );

        bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );

        bool frustumTest = all( frustumTestVec );

        if ( frustumTest ) {

        #if defined( SHADOWMAP_TYPE_PCF )

            vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
            return vogelShadow(i, shadowMap, shadowCoord.xy, texelSize.x, shadowCoord.z, shadowRadius );

        #elif defined( SHADOWMAP_TYPE_PCF_SOFT )

            vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
            float dx = texelSize.x;
            float dy = texelSize.y;

            vec2 uv = shadowCoord.xy;
            vec2 f = fract( uv * shadowMapSize + 0.5 );
            uv -= f * texelSize;

            shadow = (
                texture2DCompare( shadowMap, uv, shadowCoord.z ) +
                texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
                texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
                texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
                mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
                     f.x ) +
                mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
                     f.x ) +
                mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
                     f.y ) +
                mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
                     f.y ) +
                mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
                          texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
                          f.x ),
                     mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
                          texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
                          f.x ),
                     f.y )
            ) * ( 1.0 / 9.0 );

        #elif defined( SHADOWMAP_TYPE_VSM )

            shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );

        #else // no percentage-closer filtering:

            shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );

        #endif

        }

        return shadow;

    }

    // cubeToUV() maps a 3D direction vector suitable for cube texture mapping to a 2D
    // vector suitable for 2D texture mapping. This code uses the following layout for the
    // 2D texture:
    //
    // xzXZ
    //  y Y
    //
    // Y - Positive y direction
    // y - Negative y direction
    // X - Positive x direction
    // x - Negative x direction
    // Z - Positive z direction
    // z - Negative z direction
    //
    // Source and test bed:
    // https://gist.github.com/tschw/da10c43c467ce8afd0c4

    vec2 cubeToUV( vec3 v, float texelSizeY ) {

        // Number of texels to avoid at the edge of each square

        vec3 absV = abs( v );

        // Intersect unit cube

        float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
        absV *= scaleToCube;

        // Apply scale to avoid seams

        // two texels less per square (one texel will do for NEAREST)
        v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );

        // Unwrap

        // space: -1 ... 1 range for each square
        //
        // #X##         dim    := ( 4 , 2 )
        //  # #         center := ( 1 , 1 )

        vec2 planar = v.xy;

        float almostATexel = 1.5 * texelSizeY;
        float almostOne = 1.0 - almostATexel;

        if ( absV.z >= almostOne ) {

            if ( v.z > 0.0 )
                planar.x = 4.0 - v.x;

        } else if ( absV.x >= almostOne ) {

            float signX = sign( v.x );
            planar.x = v.z * signX + 2.0 * signX;

        } else if ( absV.y >= almostOne ) {

            float signY = sign( v.y );
            planar.x = v.x + 2.0 * signY + 2.0;
            planar.y = v.z * signY - 2.0;

        }

        // Transform to UV space

        // scale := 0.5 / dim
        // translate := ( center + 0.5 ) / dim
        return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );

    }

    float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {

        float shadow = 1.0;
        vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );

        // for point lights, the uniform @vShadowCoord is re-purposed to hold
        // the vector from the light to the world-space position of the fragment.
        vec3 lightToPosition = shadowCoord.xyz;

        // dp = normalized distance from light to fragment position
        float compare = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear ); // need to clamp?
        compare += shadowBias;

        // bd3D = base direction 3D
        vec3 bd3D = normalize( lightToPosition );

        vec2 halton = haltonSequence[frameIndex];
        float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
        float temporalAngle  = temporalOffset * PI2;

        #if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_VSM )
            for (int i = 0; i < gShadowSamples; i++) {
                vec2 vogelSample = vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;

                // Overall blurring offset
                vec3 offset = vec3(vogelSample.x, vogelSample.y, -vogelSample.x) * (shadowRadius + 5.);

                // NOTE: Removed for now
                // Penumbra offset
                //offset += vec3(vogelSample.x, vogelSample.y, vogelSample.y)  * (penumbra * gPenumbraFilterSize);

                shadow += texture2DCompare( shadowMap, cubeToUV( bd3D + offset, texelSize.y ), compare );

            }
            return shadow * gShadowSamplesRpc;

        #elif defined( SHADOWMAP_TYPE_PCF_SOFT )
            for (int i = 0; i < 16; i++) {
                vec2 vogelSample = vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;

                // Overall blurring offset
                vec3 offset = vec3(vogelSample.x, vogelSample.y, -vogelSample.x) * (shadowRadius + 5.);

                shadow += texture2DCompare( shadowMap, cubeToUV( bd3D + offset, texelSize.y ), compare );

            }
            return shadow * (1.0 / 16.0);
        #else // no percentage-closer filtering

            return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), compare );

        #endif

    }

#endif
`,e2e=di.lights_fragment_begin,t2e=di.shadowmask_pars_fragment,Pj=null,i2e=e=>{switch(e){case"low":return 8;case"medium":return 16;case"high":return 32;default:return 16}},r2e=(e="medium")=>{if(Pj===e)return!1;Pj=e;let t=i2e(e);di.shadowmap_pars_fragment=JTe(t);let i=e2e.slice();i=i.replace("getShadow( spotShadowMap[ i ]","getShadow( UNROLLED_LOOP_INDEX + 3, spotShadowMap[ i ]"),i=i.replace("getShadow( directionalShadowMap[ i ]","getShadow( UNROLLED_LOOP_INDEX, directionalShadowMap[ i ]"),di.lights_fragment_begin=i;let r=t2e.slice();return r=r.replaceAll("getShadow(","getShadow( UNROLLED_LOOP_INDEX, "),di.shadowmask_pars_fragment=r,!0},n2e=`
attribute vec3 randomColor;
varying vec3 vNormal;
flat out vec3 vColor;
#include <skinning_pars_vertex>

void main()
{
#include <beginnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
vec3 transformed = vec3(position);
#include <skinning_vertex>

vNormal = normal;
vColor = randomColor;
gl_Position = projectionMatrix * (modelViewMatrix * vec4(transformed, 1.0));
}
`,s2e=`
uniform float depthContrast;
varying vec3 vNormal;
flat in vec3 vColor;
void main()
{
vec3 normal = (normalize(vNormal)).rgb;

float contrastDepth = (gl_FragCoord.z - 0.5) * depthContrast + 0.5;

vec3 resultColor = mix(mix(vColor, normal, 0.2), vec3(contrastDepth), 0.4);
gl_FragColor = vec4(resultColor, vColor.r);
gl_FragColor = vec4(resultColor, vColor.r);
}
`,Z3=new Ui({vertexShader:n2e,fragmentShader:s2e,uniforms:{depthContrast:{value:1}}}),Dj=new Br,Rj=new ve,a2e=class extends VY{constructor(e){super(e),this._pixelRatio=this.getPixelRatio(),this.viewportWidth=1,this.viewportHeight=1,this.resolution=new ve,this.dummyCamera=new Qs,this.sceneTransitionDuration=0,this.sceneTransitionTimeRemaining=-1,this.isXRCopyPassSet=!1,this.clear=(n=!0,s=!0,a=!0)=>{let o=this.getContext(),l=0;n&&(l|=o.COLOR_BUFFER_BIT),s&&(l|=o.DEPTH_BUFFER_BIT),a&&(l|=o.STENCIL_BUFFER_BIT),o.clear(l),o.clearBufferfv(o.COLOR,1,[0,0,0,1])},this.pipeline=new $Te(this,(e==null?void 0:e.needsDOFResize)??!1),this.autoClear=!1;let t=this.setPixelRatio.bind(this),i=this.setSize.bind(this);this.shadowMap.enabled=!0,this.shadowMap.type=lB,this.dummyCamera.matrixAutoUpdate=!1,this.domElement.removeAttribute("data-engine");let r=this.getContext();if(r&&"drawingBufferColorSpace"in r)try{r.drawingBufferColorSpace="display-p3"}catch(n){console.warn(n)}this.setPixelRatio=n=>{this._pixelRatio!==n&&(this._pixelRatio=n,t(n))},this.setSize=(n,s,a=!0)=>{var o,l;(this.viewportWidth!==n||this.viewportHeight!==s)&&(this.viewportWidth=n,this.viewportHeight=s,i(n,s,a),(o=this.normalRenderTarget)==null||o.setSize(n*this._pixelRatio,s*this._pixelRatio),this._resizeTransmission(n,s),(l=this.transmissionDepthTarget)==null||l.setSize(n*this._pixelRatio/2,s*this._pixelRatio/2),this.pipeline.resize(n,s,a))},this._superDispose=this.dispose,this.dispose=this._currentDispose}createAORenderTarget(){this.aoRenderTarget===void 0&&(this.aoRenderTarget=new Wi(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio,{generateMipmaps:!1,minFilter:pi,magFilter:pi,wrapS:Ar,wrapT:Ar,depthBuffer:!1}))}_resizeTransmission(e,t){var i,r;(i=this.transmissionRenderTarget)==null||i.setSize(e*this._pixelRatio/(this.hdTransmission?1:2),t*this._pixelRatio/(this.hdTransmission?1:2)),(r=this.aoRenderTarget)==null||r.setSize(e*this._pixelRatio/1,t*this._pixelRatio/1)}get hdTransmission(){return qt.transmissionLod.value===1}set hdTransmission(e){qt.transmissionLod.value=e===!0?1:2,this._resizeTransmission(this.viewportWidth,this.viewportHeight)}createTransmissionRenderTarget(){this.transmissionRenderTarget===void 0&&(this.transmissionRenderTarget=new Wi(this.viewportWidth*this._pixelRatio/(this.hdTransmission?1:2),this.viewportHeight*this._pixelRatio/(this.hdTransmission?1:2),{generateMipmaps:!0,minFilter:Wv,magFilter:pi,wrapS:Ar,wrapT:Ar,depthBuffer:!1}),this.transmissionDepthTarget=new Wi(this.viewportWidth*this._pixelRatio/2,this.viewportHeight*this._pixelRatio/2,{minFilter:Qi,magFilter:Qi,depthBuffer:!1}))}createNormalRenderTarget(){this.normalRenderTarget===void 0&&(this.normalRenderTarget=new Wi(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio,{generateMipmaps:!1,minFilter:Qi,magFilter:Qi,type:Sn,depthTexture:new qv(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio)}))}renderNormal(e,t,i){this.normalRenderTarget&&(this.setClearColor(0),i.layers.enable(8),i.layers.disable(0),i.layers.disable(3),t.traverseEntity(r=>{r.layers.isEnabled(8)&&(r.copyPreviousMatrix=!1)}),this.setRenderTarget(this.normalRenderTarget),this.clear(),i instanceof Qs?Z3.uniforms.depthContrast.value=(i.far-i.near)/1e4:Z3.uniforms.depthContrast.value=1,t.overrideMaterial=Z3,this.render(t,i),this.setClearColor(t.bgColor,t.bgColor.a),this.setRenderTarget(null),t.overrideMaterial=e.wireframeState?vz:null,i.layers.enable(0),i.layers.enable(3),t.traverseEntity(r=>{r.layers.isEnabled(8)&&(r.copyPreviousMatrix=!0)}))}renderSplineSceneWithDummyCamera(e,t,i=1){this.dummyCamera.updateCameraState(t.dataPatched),this.dummyCamera.matrix.copy(t.matrixWorld);let r=t.height,n=t.width,s=this.viewportWidth/this.viewportHeight;n<r?n=r*s:r=n/s,this.dummyCamera.setViewplaneSize(n,r);for(let a=0;a<i;a++)this.renderSplineScene(e,this.dummyCamera)}renderSplineScene(e,t,{sceneHelpers:i=this.sceneHelpers,sceneHelpersOnTop:r=this.sceneHelpersOnTop,overrideTransmission:n=void 0,overrideNormal:s=void 0}={}){var d;let a=e instanceof Rk?e.activePage:e,o=a.visible;a.visible=!0;let l=a.scene;this.xr.enabled&&(this.isXRCopyPassSet===!1&&this.getRenderTarget()!==null&&(this.pipeline.setCopyPass(this.getRenderTarget()),this.isXRCopyPassSet=!0),this.xr.updateCamera(t)),this.setClearColor(a.bgColor,a.bgColor.a),a.penumbraSizeArray.forEach((p,f)=>{qt.penumbraSize.value[f]=p}),qt.pixelRatioNode.value=this.getPixelRatio(),this.resolution.x!==0&&this.resolution.y!==0?qt.resolution.value.set(this.resolution.x,this.resolution.y):qt.resolution.value.set(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio),s!==void 0?(qt.normalRenderTarget.value=s,qt.normalRenderTargetDepth.value=Dj):l.needsNormal()&&(this.createNormalRenderTarget(),qt.normalRenderTarget.value=this.normalRenderTarget.texture,qt.normalRenderTargetDepth.value=this.normalRenderTarget.depthTexture,this.renderNormal(l,a,t));let c=a.data.ao,u=c.occlusion;if(u&&(this.createAORenderTarget(),qt.aoRenderTarget.value=this.aoRenderTarget.texture),qt.aoEnabled.value=u,this.pipeline.setAmbientOcclusionParams(c.occlusion,c.radius,c.bias,a.aoColor,a.fog!==null,a.backupFog.near,a.backupFog.far,c.aoFullRes&&!Vw),this.pipeline.aoPass.setBlueNoiseTexture(this.pipeline.blueNoiseTexture),this.pipeline.isUIOverlayEnabled&&((d=a.uiCanvas)==null?void 0:d.enabled)&&a.uiCanvas.texture&&a.uiCanvas.texture.image.width>0){let p=this.getSize(Rj),f=this.getPixelRatio();(a.uiCanvas.width!==this.viewportWidth||a.uiCanvas.height!==this.viewportHeight||a.uiCanvas.dpr!==f)&&a.uiCanvas.applySize({width:this.viewportWidth,height:this.viewportHeight},f),a.uiCanvas.render(this),this.pipeline.uiOverlayPass.uiCanvas=a.uiCanvas,this.pipeline.uiOverlayPass.enabled=!0,this.pipeline.uiOverlayPass.setResolution(p.x,p.y,f),this.pipeline.updateRenderToScreen()}else this.pipeline.uiOverlayPass.enabled=!1,this.pipeline.updateRenderToScreen();if(this.pipeline.logoOverlayPass.enabled){let p=this.getSize(Rj),f=this.getPixelRatio();this.pipeline.logoOverlayPass.uniforms.uResolution.value.set(p.x,p.y),this.pipeline.logoOverlayPass.uniforms.uDPR.value=f}let h=!1;if(n!==void 0)qt.transmissionRenderTarget.value=n,qt.transmissionRenderTargetDepth.value=Dj,this.pipeline.setTransmissionPassEnabled(!1);else{let p=l.needsTransmission();p&&(this.transmissionRenderTarget===void 0&&(h=!0),this.createTransmissionRenderTarget(),qt.transmissionRenderTarget.value=this.transmissionRenderTarget.texture,qt.aspectRatio.value=KMe(this.viewportWidth,this.viewportHeight),qt.transmissionRenderTargetDepth.value=this.transmissionDepthTarget.texture),this.pipeline.setTransmissionPassEnabled(p)}t.layers.enable(3),t.layers.enable(8),this.pipeline.sceneHelpers=i,this.pipeline.sceneHelpersOnTop=r,this.pipeline.scene=a,this.pipeline.camera=t,h&&this.pipeline.transmissionPass.updatePasses(this),this.pipeline.postprocessingState!==a.postprocessing&&(this.pipeline.updatePostprocessing(a.postprocessing),!i&&!r&&this.pipeline.disableHelpers()),this.clearAlphaOverride!==void 0&&this.setClearAlpha(this.clearAlphaOverride),a.overrideMaterial=l.wireframeState?vz:null,this.pipeline.render(),qt.frameIndex.value=(qt.frameIndex.value+1)%16,t instanceof Qs&&t.copyHistory(),a.visible=o}renderFromSceneForSceneTransitionPass(e,t,i){this.pipeline.renderToScreen=!1,this.pipeline.renderTarget,this.renderSplineScene(e,t),this.pipeline.sceneTransitionFromTexture=this.pipeline.renderTarget.texture,this.sceneTransitionDuration=i,this.sceneTransitionTimeRemaining=i,this.pipeline.renderToScreen=!0;let r=this.pipeline.sceneTransitionPass.uniforms;r.uDPR.value=window.devicePixelRatio,r.uResolution.value.set(this.domElement.width,this.domElement.height).divideScalar(window.devicePixelRatio)}_currentDispose(){var e,t,i,r,n,s;this._superDispose(),this.pipeline.dispose(),(e=this.aoRenderTarget)==null||e.dispose(),(t=this.transmissionRenderTarget)==null||t.dispose(),(i=this.transmissionDepthTarget)==null||i.dispose(),(r=this.normalRenderTarget)==null||r.dispose(),(s=(n=this.normalRenderTarget)==null?void 0:n.depthTexture)==null||s.dispose()}},r$=class extends jw(Zpe){constructor(e,t=15,i=10066329){super(e,t,i),this.object=e,this.added=!1,this.name=`DirectionalLightHelper: ${e.uuid}`}raycast(e,t){Ww(this.object,r$.geometryHelper,e,t)}},n$=class extends jw(Kpe){constructor(e,t=15,i=6710886){super(e,t,i),this.object=e,this.name=`PointLightHelper: ${e.uuid}`}raycast(e,t){Ww(this.object,n$.geometryHelper,e,t)}},hz=class extends jw(Qpe){constructor(t,i=6710886){super(t,i),this.object=t,this.name=`SpotLightHelper: ${t.uuid}`}raycast(t,i){Ww(this.object,hz.geometryHelper,t,i)}update(){if(this.object!==void 0){let t=hz._vector,i=this.object.distance?this.object.distance:1e3,r=i*Math.tan(this.object.angle);this.cone.scale.set(r,r,i),t.setFromMatrixPosition(this.object.target.matrixWorld),this.cone.lookAt(t);let n=this.color!==void 0?this.color:this.light.color;if(this.cone.material instanceof Array)for(let s=0,a=this.cone.material.length;s<a;s++)this.cone.material[s].color.set(n);else this.cone.material.color.set(n)}}},s$=hz;s$._vector=new B;var a$=class extends Qu{constructor(){super(),this.caretIndex=0,this._caretVisibleAlpha=1,this._selectionVisibleAlpha=.3,this.current={start:0,end:void 0},this.matrixAutoUpdate=!1,this.caretMesh=new zr(new hh(1,1),new uh({transparent:!0,opacity:0,side:Ws})),this.add(this.caretMesh),this.selectionMesh=new zr(new hh(1,1),new uh({color:2857471,transparent:!0,depthTest:!1,depthWrite:!1,opacity:0,side:Ws})),this.add(this.selectionMesh),this.hide()}get caretHeight(){var e;return((e=this.object)==null?void 0:e.AD)??0}show(e){this.visible=!0,this.object=e,this.caretMesh.scale.set(1,this.caretHeight,1),this.caretMesh.position.y=-this.caretHeight*.5,this.setCaretPosition(this.caretIndex),this.update()}hide(){this.visible=!1}update(){if(this.object===void 0)return;this.updateHelperMatrix();let{depth:e}=this.object.geometry.userData.parameters;this.caretMesh.position.z=e,this.selectionMesh.position.z=e}updateHelperMatrix(){if(this.object===void 0)return;let e=this.object,t=e.parent;t!==null&&t.updateWorldMatrix(!0,!1),e.matrixAutoUpdate&&e.updateMatrix(),t!==null?(this.matrixWorld.multiplyMatrices(t.matrixWorld,e.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,e.matrix)):this.matrixWorld.multiplyMatrices(e.hiddenMatrix,e.matrix),this.matrix.copy(this.matrixWorld);for(let i of this.children)i.matrixWorld.copy(this.matrixWorld);e.updateWorldMatrix(!0,!0)}setCaretColor(e){let t=this.caretMesh.material;t.color.setRGB(e.r,e.g,e.b);let i=this._caretVisibleAlpha===t.opacity;this._caretVisibleAlpha=e.a,i&&(t.opacity=this._caretVisibleAlpha)}setSelectionColor(e){this.selectionMesh.material.color.setRGB(e.r,e.g,e.b)}setCaretPosition(e,t={}){if(this.object===void 0)return;this.caretIndex=e;let i=this.object.wrappedText,[r,n]=cC(i,e),[s,a]=e>0?cC(i,e-1):[null,null];(e>0&&i.length?i[s].charAt(a):null)===`
`&&(r++,n=0),this.current.start=e,this.current.end=void 0;let[o,l]=$3(this.object,r,n),{AD:c,descender:u}=this.object,h=u+c*.5,{width:d,height:p,depth:f}=this.object.geometry.userData.parameters,v=typeof d=="string"?0:d,g=typeof p=="string"?0:p;this.caretMesh.scale.set(1,this.caretHeight,1),this.caretMesh.position.set(o-v*.5,l+h+g*.5,f),this.hideSelectionMesh(),this.showCaretMesh()}setSelection(e,t){if(this.object===void 0)return;let i=this.object.wrappedText;this.current.start=e,this.current.end=t;let r=[],n=[],s=o2e(i,e,t),{lineHeight:a,AD:o,descender:l}=this.object,c=l+o*.5-a*.5;for(let[g,m,x]of s)if(m!==x){let[w,_]=$3(this.object,g,m),[M,S]=$3(this.object,g,x);_+=c,S+=c,S+=a;let A=r.length/3;r.push(w,_,0),r.push(M,_,0),r.push(M,S,0),r.push(w,S,0),n.push(A+0,A+1,A+2),n.push(A+2,A+3,A+0)}let u=new Bt;u.setIndex(n),u.setAttribute("position",new St(r,3));let{width:h,height:d,depth:p}=this.object.geometry.userData.parameters,f=typeof h=="string"?0:h,v=typeof d=="string"?0:d;this.selectionMesh.geometry.dispose(),this.selectionMesh.geometry=u,this.selectionMesh.position.x=-f*.5,this.selectionMesh.position.y=v*.5,this.selectionMesh.position.z=p,this.showSelectionMesh(),this.hideCaretMesh()}getSelectionFromPosition(e,t,i="previous"){if(this.object===void 0||this.object.font===void 0)return;let r=this.object.wrappedText,n=r.length,s=this.object.lineHeight,a=n*s,{height:o,verticalAlign:l}=this.object.geometry.userData.parameters,c=typeof o=="string"?0:o,u=0;l===3?u=c-a:l===2&&(u=c*.5-a*.5);let h=Math.min(Math.floor(Math.max(Math.min(-t-u,a),0)/s),n-1),d=this.object.charCoords[h],p=this.object.charWidths[h],f=0,v=!1;if(i==="previous"){for(let g=0;g<d.length;g++)if(d[g][0]+p[g]*.5-e>0){f=g,v=!0;break}}else if(i==="closest"){let g=1/0;for(let m=0;m<d.length;m++){let x=d[m][0]+p[m]*.5,w=Math.abs(x-e);w<g&&(g=w,f=m,v=!0)}}else for(let g=0;g<d.length;g++){let m=d[g][0],x=d[g][0]+p[g];if(e>=m&&e<x){f=g,v=!0;break}}return v||(f=d.length),{index:this.getGlobalIndexFromLineAndCharIndexes(r,h,f),lineIndex:h,characterIndex:f}}getGlobalIndexFromLineAndCharIndexes(e,t,i){return e.slice(0,t).reduce((r,n)=>r+=n.length,0)+i}showSelectionMesh(){this.selectionMesh.material.opacity=this._selectionVisibleAlpha}hideSelectionMesh(){this.selectionMesh.material.opacity=0}showCaretMesh(){this.caretMesh.material.opacity=this._caretVisibleAlpha}hideCaretMesh(){this.caretMesh.material.opacity=0}};function $3(e,t,i){let{charCoords:r,charWidths:n,initialOffsetY:s,lineHeight:a}=e;if(r[t]&&r[t].length===0||r.length===0){let u=0,{horizontalAlign:h}=e.data.geometry,d=e.wrappedText,{width:p}=e.geometry.userData.parameters;return d.length===1&&d[0].length===0&&(h===3?u=p*.5:h===2&&(u=p)),[u,s-a*t]}let o=r[t];if(o===void 0||o.length===0)return[0,0];let[l,c]=o[Math.min(i,o.length-1)];return i>=o.length&&(l+=n[t][i-1]),[l,c]}function cC(e,t){var r;let i=0;for(let n=0;n<e.length;n++){let s=e[n],a=t-i;if(a<=s.length)return[n,a];i+=s.length}return[Math.max(0,e.length-1),((r=e[e.length-1])==null?void 0:r.length)??0]}function o2e(e,t,i){let[r,n]=cC(e,t),[s,a]=cC(e,i),o=[];n>=e[r].length&&(r++,n=0);for(let l=r;l<=s;l++){let c=e[l],u=l===r?n:0,h=l===s?a:c.length;o.push([l,u,h])}return o}function l2e(e,t){let i=ys.fromHex(3223857),r=.8;for(let n of e.layers){if(n.data.type==="light"||n.data.type==="displace"||n.data.type==="fresnel"||n.data.type==="matcap"||n.data.type==="texture"||n.data.type==="toon"||n.data.type==="outline"||n.data.type==="transmission"||n.data.type==="noise")continue;let s=typeof n.data.alpha=="string"?Number(t.getVariable(n.data.alpha)):n.data.alpha;if(n.data.type==="color"&&s>.3){i=c2e(n.data.color,t),r=s;break}else if((n.data.type==="depth"||n.data.type==="gradient")&&s>.3){let a=u2e(n.data);i={r:a[0],g:a[1],b:a[2]},r=typeof n.data.alpha=="string"?1:n.data.alpha;break}}return{...i,a:r}}function c2e(e,t){return typeof e=="string"?t.data.colors[e]:e}function u2e(e){return e.colors[0]}function h2e(e,t){e.shadow.camera.right=t/2,e.shadow.camera.left=-t/2,e.shadow.camera.top=t/2,e.shadow.camera.bottom=-t/2,e.shadow.needsUpdate=!0}var o$=class extends bk(Ope,r$){constructor(e,t,i){super(),this.super_Entity(e,t),this.castShadow=!0,this.shadow.mapSize.width=2048,this.shadow.mapSize.height=2048,this.shadow.normalBias=1,this.layers.enable(3);let r=this.shadow.camera;r.top=1250,r.bottom=-1250,r.right=1250,r.left=-1250,r.near=-1e4,r.far=2500;let n=new AA(this.shadow.camera);n.visible=!1,this.gizmos.shadowmap=n}update(){this.shadow.camera.updateProjectionMatrix();for(let e in this.gizmos){let t=this.gizmos[e];t instanceof AA&&t.update()}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.objectHelper&&this.objectHelper.update()}updateState(e,t){this.updateState_Light(e,t);let i=e.depth!==void 0&&e.depth!==this.shadow.camera.far||e.size!==void 0&&e.size/2!==this.shadow.camera.right;e.size!==void 0&&h2e(this,e.size),e.shadowRadius!==void 0&&(this.shadow.radius=e.shadowRadius),e.shadowResolution!==void 0&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null)),e.penumbraSize!==void 0&&t.scene.markPenumbraSizeDirty(),i&&this.update()}},Ij=new B,Lj=new B,Oj=new ei,l$=class extends bk(Dpe,s$){constructor(e,t,i){super(),this.super_Entity(e,t),this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let r=this.shadow.camera;r.fov=Et.RAD2DEG*2*this.angle,r.aspect=1,r.near=100,r.far=2500;let n=new AA(this.shadow.camera);n.visible=!1,this.gizmos.shadowmap=n,this.update()}update(){this.shadow.camera.updateProjectionMatrix();for(let e in this.gizmos){let t=this.gizmos[e];t instanceof AA&&t.update()}}updateMatrixWorld(e){super.updateMatrixWorld(e),Lj.setFromMatrixPosition(this.matrixWorld),Oj.setFromRotationMatrix(this.matrixWorld),Ij.copy(this.up).applyQuaternion(Oj).negate().multiplyScalar(this.distance),this.target.position.copy(Lj).add(Ij),this.target.updateMatrixWorld(),this.objectHelper&&this.objectHelper.update()}updateState(e,t){this.updateState_Light(e,t),e.distance!==void 0&&(this.distance=e.distance),e.decay!==void 0&&(this.decay=e.decay),e.angle!==void 0&&(this.angle=e.angle),e.penumbra!==void 0&&(this.penumbra=e.penumbra),e.shadowRadius!==void 0&&(this.shadow.radius=e.shadowRadius),e.penumbraSize!==void 0&&t.scene.markPenumbraSizeDirty(),e.shadowResolution!==void 0&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}};function d2e(e){let t=(e[0][0]+e[1][1])/2,i=(e[0][0]-e[1][1])/2,r=(e[1][0]+e[0][1])/2,n=(e[1][0]-e[0][1])/2,s=Math.sqrt(t*t+n*n),a=Math.sqrt(i*i+r*r),o=s+a,l=s-a,c=Math.atan2(r,i),u=Math.atan2(n,t),h=(u-c)/2,d=(u+c)/2,p=[[Math.cos(d),Math.sin(d)],[-Math.sin(d),Math.cos(d)]],f=[[o,0],[0,l]],v=[[Math.cos(h),Math.sin(h)],[-Math.sin(h),Math.cos(h)]];return p[0][0]*=-1,p[0][1]*=-1,v[0][0]*=-1,v[1][0]*=-1,[p,f,v]}function _E(e,t){return[[e[0][0]*t[0][0]+e[0][1]*t[1][0],e[0][0]*t[0][1]+e[0][1]*t[1][1]],[e[1][0]*t[0][0]+e[1][1]*t[1][0],e[1][0]*t[0][1]+e[1][1]*t[1][1]]]}function zj(e){return[[e[0][0],e[1][0]],[e[0][1],e[1][1]]]}function p2e(e){let[t,i,r]=d2e(e),n=_E(t,zj(r)),s=_E(_E(r,i),zj(r)),a=Math.atan2(n[1][0],n[0][0]),o=[s[0][0],s[1][1]],l=[s[0][1]/s[1][1],s[1][0]/s[0][0]];return{rotation:a,scale:o,shear:l}}function f2e({rotation:e,scale:t,shear:i}){let r=Math.cos(e),n=Math.sin(e),s=[[r,-n],[n,r]],a=[[t[0],i[0]*t[1]],[i[1]*t[0],t[1]]],o=_E(s,a);return[o[0][0],o[1][0],o[0][1],o[1][1]]}var Oi;(e=>{function t(){return[1,0,0,0,1,0,0,0,1]}e.identity=t;function i(S,A=e.identity()){for(let T=0,E=S.length;T<E;T++)A[T]=S[T];return A}e.copy=i;function r(S,A,T,E,C,D){return e.setAbcdef(e.identity(),S,A,T,E,C,D)}e.create=r;function n(S,A,T,E,C,D,I){return S[0]=A,S[1]=E,S[2]=D,S[3]=T,S[4]=C,S[5]=I,S}e.setAbcdef=n;function s(S,A){let[T,E,C,D,I,L]=o(S),[z,F,Q,Y,O,j]=o(A),V=z*T+F*C,W=z*E+F*D,J=Q*T+Y*C,ce=Q*E+Y*D,$=O*T+j*C+I,ne=O*E+j*D+L;return e.create(V,W,J,ce,$,ne)}e.append=s;function a(S,A){let[T,E,C,D,I,L]=o(S),[z,F,Q,Y,O,j]=o(A),V=T,W=E,J=C,ce=D;(z!==1||F!==0||Q!==0||Y!==1)&&(V=T*z+E*Q,W=T*F+E*Y,J=C*z+D*Q,ce=C*F+D*Y);let $=I*z+L*Q+O,ne=I*F+L*Y+j;return e.create(V,W,J,ce,$,ne)}e.prepend=a;function o(S){return[S[0],S[3],S[1],S[4],S[2],S[5]]}e.getAbcdef=o;function l(S){let[A,T,E,C,D,I]=e.getAbcdef(S),L=A*C-T*E,z=C/L,F=-T/L,Q=-E/L,Y=A/L,O=(E*I-C*D)/L,j=-(A*I-T*D)/L;return e.create(z,F,Q,Y,O,j)}e.invert=l;function c([S,A],T){let[E,C,D,I,L,z]=e.getAbcdef(T);return[E*S+D*A+L,C*S+I*A+z]}e.apply=c;function u(S,A){let[T,E,C,D,I,L]=e.getAbcdef(A),z=1/(T*D+C*-E),[F,Q]=S;return[D*z*F+-C*z*Q+(L*C-I*D)*z,T*z*Q+-E*z*F+(-L*T+I*E)*z]}e.applyInverse=u;function h(S,A,T=A){let[E,C,D,I,L,z]=e.getAbcdef(S);return e.setAbcdef(S,E*A,C*T,D*A,I*T,L*A,z*T),S}e.scale=h;function d(S,A){let T=Math.cos(A),E=Math.sin(A),[C,D,I,L,z,F]=e.getAbcdef(S);return e.setAbcdef(S,C*T-D*E,C*E+D*T,I*T-L*E,I*E+L*T,z*T-F*E,z*E+F*T),S}e.rotate=d;function p(S,A,T){let[E,C]=T,D=e.translate(S,-E,-C);return D=e.rotate(D,A),D=e.translate(D,E,C),D}e.rotateAround=p;function f(S,A,T){let[E,C,D,I,L,z]=e.getAbcdef(S);return e.setAbcdef(S,E,C,D,I,L+A,z+T),S}e.translate=f;function v(S,A,T){let[E,C,D,I]=e.getAbcdef(S);return e.setAbcdef(S,E,C,D,I,A,T),S}e.setTranslate=v;function g(S,A,T){let[E,C,D,I]=e.getAbcdef(S);return e.setAbcdef(S,E,C,D,I,A,T),S}e.setPosition=g;function m(S){let[A,T,E,C]=e.getAbcdef(S),D=Math.sqrt(A*A+T*T),I=Math.sqrt(E*E+C*C);return[D,I]}e.getScale=m;function x(S){let[,,,,A,T]=e.getAbcdef(S);return[A,T]}e.getPosition=x;function w(S,A){return e.decompose(S,A).rotation}e.getRotation=w;function _(S,A){let[T,E,C,D,I,L]=e.getAbcdef(S),{rotation:z,scale:F,shear:Q}=p2e([[T,C],[E,D]]);return{position:[I+(A[0]*T+A[1]*C)-A[0],L+(A[0]*E+A[1]*D)-A[1]],scale:F,rotation:z,shear:Q,pivot:A}}e.decompose=_;function M(S,A,T,E,C=[0,0]){let[D,I]=S,[L,z]=E,[F,Q,Y,O]=f2e({rotation:T,scale:A,shear:C}),j=D-(L*F+z*Y)+L,V=I-(L*Q+z*O)+z;return e.create(F,Q,Y,O,j,V)}e.compose=M})(Oi||(Oi={}));var m2e=Math.PI/180;function g2e(e,t,i,r,n,s){let a=e-i,o=t-r;return a*a/(n*n)+o*o/(s*s)<=1}function v2e(e){return e*m2e}var cs=class{constructor(e,t,i){this.uuid=e,this.data=t,this.localMatrix=Oi.identity(),this.worldMatrix=Oi.identity(),this.ignoreCameraZoom=!1,this.visible=!0,this._singleBBox=new dz,this._recursiveBBox=new dz,this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0,this.stateSelection=null,this.prevState=null,this.currentState=null,this.reversibleToState=null,this.currentTransitionEvent=null,this.previousAction=null,this.name="",this.position=[0,0],this.scale=[1,1],this.rotation=0,this.shear=[0,0],this.emitter=gk(),this.dpr=i.dpr??1,this.dataPatched=t}project(e,t){let i=this.worldMatrix;return t&&(i=Oi.append(t.worldMatrix,i)),Oi.applyInverse(e,i)}intersects(e,t,i,r=!1){return this.visible&&!this.data.raycastLock&&this.intersectsInLocalSpace(...this.project([e,t],i),r)}intersectsInLocalSpace(e,t,i=!1){let{min:r,max:n}=i?this.recursiveBBox:this.singleBBox;return e>=r[0]&&e<=n[0]&&t>=r[1]&&t<=n[1]}applyTransforms(e){e.setTransform(this.worldMatrix,this.ignoreCameraZoom)}get singleBBox(){return this.singleBBoxNeedsUpdate&&(this.singleBBoxNeedsUpdate=!1,this._singleBBox.setFromObjectSize(this,!1),this._singleBBox.computeVertices(),this._singleBBox.computeEdges()),this._singleBBox}get recursiveBBox(){return this.recursiveBBoxNeedsUpdate&&(this.recursiveBBoxNeedsUpdate=!1,this._recursiveBBox.setFromObjectSize(this,!0),this._recursiveBBox.computeVertices(),this._recursiveBBox.computeEdges()),this._recursiveBBox}updateLocalMatrix(){this.localMatrix=Oi.compose(this.position,this.scale,v2e(this.rotation),Cf.getPivot(this.dataPatched),this.shear)}updateWorldMatrix(e,t,i){let r=this.parent;t&&r!==null&&r!==void 0&&r.updateWorldMatrix(e,!0,!1),e&&this.updateLocalMatrix(),this.parent?this.worldMatrix=Oi.append(this.parent.worldMatrix,this.localMatrix):this.worldMatrix=Oi.copy(this.localMatrix),this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}get pivot(){return Cf.getPivot(this.data)}getCenter(){return[0,0]}getHalfSize(){return[0,0]}get id(){return this.uuid}resetBBoxNeedsUpdateSelf(){this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}resetBBoxNeedsUpdate(){this.resetBBoxNeedsUpdateSelf(),this.traverseAncestors(e=>{e.resetBBoxNeedsUpdateSelf()})}updateTransformState(e){let t=!1;e.position!==void 0&&(t=!0,this.position=e.position),e.rotation!==void 0&&(t=!0,this.rotation=e.rotation),e.scale!==void 0&&(t=!0,this.scale=e.scale),e.shear!==void 0&&(t=!0,this.shear=e.shear),t&&(this.updateWorldMatrix(!0,!1,!0),this.resetBBoxNeedsUpdate())}updateByOp(e,t,i){e.type===0&&e.props.visible!==void 0&&(this.visible=e.props.visible),this.data=t,this.data=t;let r=e,n=hr(e.path,["states","*"]);if(n!==null){if(e.type===0){let[s]=n;if((this==null?void 0:this.stateSelection)===s){let a={...e.props};if(delete a.name,Object.values(e.props).some(o=>o===void 0)){let o=this.data;if(o!==void 0){let l=Bn.zoom(o,e.path.slice(2));if(l)for(let c in e.props)e.props[c]===void 0&&c in l&&(a[c]=l[c])}}r={...e,props:a,path:e.path.slice(2)}}}}else if(e.type===0){let s=this.stateSelection?this.data.states.data(this.stateSelection):void 0;if(s!==void 0){if(e.props.name!==void 0&&s.name){let{name:o,...l}=s;s=l}let a=Bn.removeOverridden(e.path,e.props,s);r={...e,props:a}}}this.updateByPatchedOpBase(r,hf.patch(this.data,this.stateSelection?this.data.states.data(this.stateSelection):void 0),i)}changeSelectedState(e,t,i=!1){if(!(this.data.states.length===0&&!i)){for(let r of this.data.states)hf.toOps(this.data,r.data).forEach(n=>{let s=BA.replaceProps(n,this.data);this.dataPatched=this.data,this.updateByPatchedOp(s,this.data,t)});if(e!==null){let r=this.data.states.data(e);r&&(this.dataPatched=hf.patch(this.data,r),hf.toOps(this.data,r).forEach(n=>{this.updateByPatchedOp(n,this.dataPatched,t)}))}i&&this.updateTransformState(this.dataPatched),this.stateSelection=e}}updateState(e,t){e.name!==void 0&&(this.name=e.name),e.visible!==void 0&&(this.visible=e.visible),this.updateTransformState(e)}updateByPatchedOpBase(e,t,i){this.dataPatched=t,this.updateByPatchedOp(e,t,i)}updateByPatchedOp(e,t,i){e.path.length===0&&e.type===0&&this.updateState(e.props,i),this.requestRender()}traverseFrameAncestors(e){this.traverseAncestors(t=>{t.data.type==="frame2d"&&e(t)})}traverseAncestors(e){let t=this.parent;for(;t;)e(t),t=t.parent}requestRender(){this.traverseFrameAncestors(e=>{e.requestRender()})}clone(e){let t=new cs(this.uuid,this.data,e);return t.parent=void 0,t}addEventListener(e,t){this.emitter.on(e,t)}removeEventListener(e,t){this.emitter.off(e,t)}dispatchEvent(e){this.emitter.emit(e.type,{...e,target:e.target??this})}traverseSortNextHelper(){let e=this.parent;if(e){let t=e.children;if(t){let i=t.indexOf(this)+1;return t[i]?t[i]:e.traverseSortNextHelper()}}}sortNext(){let e=this.children;return e&&e.length>0&&e[0]?e[0]:this.traverseSortNextHelper()}isDescendantOf(e){e instanceof cs&&(e=e.uuid);let t=this;for(;t.parent;){if(t.parent.uuid===e)return!0;t=t.parent}return!1}},Dl=class extends cs{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.context=i,this.children=[]}add(e){e.parent&&e.parent instanceof Dl&&e.parent.remove(e),this.children.push(e),e.parent=this}remove(e){let t=this.children.indexOf(e);t>=0&&(this.children.splice(t,1),e.parent=void 0)}traverse(e){let t=e(this);if(t!==!0)for(let i of this.children)i instanceof Dl?i.traverse(e):t=e(i)}intersectsChildrenHelper(e,t,i,r,n){for(let s of this.children)if(s.intersects(e,t,i,!1)&&(n.push(s),r)||s instanceof Dl&&s.intersectsChildrenHelper(e,t,i,r,n))return!0;return!1}intersectsChildren(e,t,i,r=!1,n=[],s=!1){return this.intersectsChildrenHelper(e,t,i,r,n),n}intersectsChildrenHelperReverse(e,t,i,r,n){for(let s of this.children)if(s instanceof Dl&&s.intersectsChildrenHelperReverse(e,t,i,r,n)||s.intersects(e,t,i,!1)&&(n.push(s),r))return!0;return!1}intersectsChildrenReverse(e,t,i,r=!1,n=[],s=!1){return this.intersectsChildrenHelperReverse(e,t,i,r,n),n}updateWorldMatrix(e,t,i){if(super.updateWorldMatrix(e,t,i),i&&this.children)for(let r of this.children)r.updateWorldMatrix(e,!1,!0)}find(e){let t;return this.traverse(i=>{i.uuid===e&&(t=i)}),t}innerDrawChildren(e){for(let t=this.children.length-1;t>=0;t--)this.children[t].draw(e)}resetBBoxNeedsUpdate(){super.resetBBoxNeedsUpdate(),this.traverse(e=>{e.resetBBoxNeedsUpdateSelf()})}clone(e){let t=new Dl(this.uuid,this.data,e);t.parent=void 0;for(let i of this.children)t.add(i.clone(e));return t}},Qd=class extends Dl{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.updateState(t,i)}draw(e){!this.visible||(e.save(),this.applyTransforms(e),this.innerDrawChildren(e),e.restore())}clone(e){let t=new Qd(this.uuid,this.data,e);t.parent=void 0;for(let i of this.children)t.add(i.clone(e));return t}};function y2e(e,t){let[[i,r],[n,s]]=e,[[a,o],[l,c]]=t,u=(i-n)*(o-c)-(r-s)*(a-l);if(u===0)return!1;let h=((i-a)*(o-c)-(r-o)*(a-l))/u,d=-((i-n)*(r-o)-(r-s)*(i-a))/u;return h>=0&&h<=1&&d>=0&&d<=1}var c$=[[-1,1],[-1,-1],[1,-1],[1,1]],Nj=(e,t,i)=>{let r=e.getCenter(),n=e.getHalfSize(),s=Oi.append(t,e.worldMatrix);n[0]===0&&n[1]===0?i.push(Oi.apply(r,s)):c$.forEach(a=>{let o=[a[0]*n[0]+r[0],a[1]*n[1]+r[1]];i.push(Oi.apply(o,s))})},dz=class{constructor(){this.matrix=Oi.identity(),this.min=[1/0,1/0],this.max=[-1/0,-1/0],this.vertices=[],this.edges=[]}setFromObjectSize(e,t=!1){e.updateWorldMatrix(),this.makeEmpty(),Oi.copy(e.worldMatrix,this.matrix);let i=Oi.invert(e.worldMatrix);this.expandByObjectSize(e,i,t)}expandByObjectSize(e,t,i=!1){let r=[];i===!0&&e instanceof Dl?e.traverse(n=>{n.visible&&Nj(n,t,r)}):Nj(e,t,r),this.setFromPoints(r)}setFromSize(e,t,i){this.makeEmpty(),Oi.copy(i,this.matrix),this.expandBySize(e,t,i)}expandBySize(e,t,i){[Oi.apply([0,0],i),Oi.apply([0,t],i),Oi.apply([e,t],i),Oi.apply([e,0],i)].forEach(r=>this.expandByPoint(r))}getCenter(){let[e,t]=this.min,[i,r]=this.getHalfSize();return Oi.apply([e+i,t+r],this.matrix)}getSize(){return[this.max[0]-this.min[0],this.max[1]-this.min[1]]}getHalfSize(){return[(this.max[0]-this.min[0])*.5,(this.max[1]-this.min[1])*.5]}makeEmpty(){this.min=[1/0,1/0],this.max=[-1/0,-1/0]}setFromPoints(e){this.makeEmpty();for(let t of e)this.expandByPoint(t)}expandByPoint(e){this.min=[Math.min(this.min[0],e[0]),Math.min(this.min[1],e[1])],this.max=[Math.max(this.max[0],e[0]),Math.max(this.max[1],e[1])]}computeVertices(){let[e,t]=this.getHalfSize(),i=this.getCenter(),[r,n,s,a]=Oi.getAbcdef(this.matrix),o=Oi.create(r,n,s,a,i[0],i[1]);this.vertices=c$.map(([l,c])=>Oi.apply([l*e,c*t],o))}computeEdges(){this.edges=[];for(let e=0,t=this.vertices.length;e<t;++e)this.edges.push([this.vertices[e],this.vertices[(e+1)%t]])}project(e,t){let i=this.matrix;return t&&(i=Oi.append(t.worldMatrix,i)),Oi.applyInverse(e,i)}intersects(e,t,i){return this.intersectsInLocalSpace(...this.project([e,t],i))}intersectsInLocalSpace(e,t){let{min:i,max:r}=this;return e>=i[0]&&e<=r[0]&&t>=i[1]&&t<=r[1]}containsPoint(e){let[t,i]=e,[r,n]=this.min,[s,a]=this.max;return t>=r&&t<=s&&i>=n&&i<=a}intersectsBBox2D(e){for(let t=0,i=this.edges.length;t<i;t++){let r=this.edges[t];for(let n=0,s=e.edges.length;n<s;n++){let a=e.edges[n];if(y2e(r,a))return!0}}for(let t=0,i=e.vertices.length;t<i;t++){let r=e.vertices[t];if(this.containsPoint(r))return!0}return!1}ensureMinMax(){let e=this.min,t=this.max;this.min=[Math.min(e[0],t[0]),Math.min(e[1],t[1])],this.max=[Math.max(e[0],t[0]),Math.max(e[1],t[1])]}copy(e){this.min=[...e.min],this.max=[...e.max],Oi.copy(e.matrix,this.matrix),this.computeVertices(),this.computeEdges()}clone(){let e=new dz;return e.copy(this),e}},u$,x2e=new Promise(e=>{u$=e}),Bj=!1,NS;function w2e(){if(Bj)return;if(NS)return NS;async function e(){let t=await ip(()=>import("./ui-L7l3pL7d.js"),[]);u$(t.default??t),Bj=!0}return NS=e(),NS}function kj(e){let t=!1;return e.scene.objects.traverse((i,r)=>{(r.type==="Mesh"&&r.geometry.type==="UIGeometry"||r.type==="Page"&&r.uiFrame!==void 0)&&(t=!0)}),t}var ni,J3;async function b2e(e){let t=await x2e;ni||(J3||(J3=t({locateFile:()=>e})),ni=await J3)}var Uj=Oi.identity(),h$=class{constructor(e,t=1){this.canvas=e,this._dpr=t,this._width=0,this._height=0,this._strokeMode="inside",this._layerBlur=0,this._backgroundBlur=0,this._dropShadowBlur=0,this._dropShadowOffsetX=0,this._dropShadowOffsetY=0,this._dropShadowColor=ar.transparent,this._innerShadowBlur=0,this._innerShadowOffsetX=0,this._innerShadowOffsetY=0,this._innerShadowSpread=0,this._innerShadowColor=ar.transparent,this._fonts=new Map,this._isSizeDirty=!1;try{let i=e.getBoundingClientRect();e.width=i.width*t,e.height=i.height*t}catch{console.log(e.width,t)}this._currentM3Transform=Uj,this._currentTransform=new Float32Array(Uj)}get dpr(){return this._dpr}set dpr(e){this._dpr=e,this._isSizeDirty=!0}async init(){var e,t;if(!this.wasmURL)throw Error("Your must set the wasm binary url with renderer.wasmURL = ... before you can call renderer.init");await b2e(this.wasmURL),this._surface=ni.MakeWebGLCanvasSurface(this.canvas),this.ctx=(e=this._surface)==null?void 0:e.getCanvas(),this._paint=new ni.Paint,this._paint.setAntiAlias(!0),this._paintFill=this._paint.copy(),this._paintFill.setStyle(ni.PaintStyle.Fill),this._paintStroke=this._paint.copy(),this._paintStroke.setStyle(ni.PaintStyle.Stroke),(t=this.ctx)==null||t.scale(this.dpr,this.dpr)}get currentTransform(){return this._currentM3Transform}get currentTransformBuffer(){return this._currentTransform}set currentTransform(e){this._currentM3Transform=e,this._currentTransform.set(e)}async loadFont(e,t){let i=await(await fetch(e)).arrayBuffer();this.registerFont(i,t)}registerFont(e,t){if(this._fonts.has(t))return;let i=ni.FontMgr.FromData(e);if(i)this._fonts.set(t,i);else throw new Error("Invalid font data for "+t)}get width(){return this._width}get height(){return this._height}set strokeColor(e){this._paintStroke&&this._paintStroke.setColor(BS(e),ni.ColorSpace.DISPLAY_P3)}set fillColor(e){this._paintFill&&this._paintFill.setColor(BS(e),ni.ColorSpace.DISPLAY_P3)}set lineWidth(e){this._paintStroke&&this._paintStroke.setStrokeWidth(this._strokeMode==="center"?e:e*2)}set strokeMode(e){this._strokeMode=e}set dropShadowBlur(e){this._dropShadowBlur=e}set dropShadowColor(e){this._dropShadowColor=e}set dropShadowOffsetX(e){this._dropShadowOffsetX=e}set dropShadowOffsetY(e){this._dropShadowOffsetY=e}set innerShadowBlur(e){this._innerShadowBlur=e}set innerShadowColor(e){this._innerShadowColor=e}set innerShadowOffsetX(e){this._innerShadowOffsetX=e}set innerShadowOffsetY(e){this._innerShadowOffsetY=e}set innerShadowSpread(e){this._innerShadowSpread=e}set layerBlur(e){this._layerBlur=e}set backgroundBlur(e){this._backgroundBlur=e}clear(){var e;(e=this.ctx)==null||e.clear(ni.TRANSPARENT)}save(){var e;(e=this.ctx)==null||e.save()}restore(){var e;(e=this.ctx)==null||e.restore()}beginPath(){var e;(e=this._currentPath)==null||e.delete(),this._currentPath=new ni.Path}closePath(){let e=this._currentPath;if(e){if(e.isEmpty())return;let t=e.getBounds();(t[3]-t[1]||t[2]-t[0])&&e.close()}}fill(){this._paintInner(this._paintFill,!0)}stroke(){this._paintInner(this._paintStroke,!1)}clipRect(e,t,i,r,n=0,s=0,a=0,o=0){var c,u;let l=ni.XYWHRect(e,t,i,r);if(n===0&&s===0&&o===0&&a===0)(c=this.ctx)==null||c.clipRect(l,ni.ClipOp.Intersect,!0);else{let h=ni.RRectXY(l,n,n);h[4]=h[5]=n,h[6]=h[7]=s,h[8]=h[9]=a,h[10]=h[11]=o,(u=this.ctx)==null||u.clipRRect(h,ni.ClipOp.Intersect,!0)}}_applyShadowOffsetMatrix(){if(this.ctx){let e=Oi.invert(this.currentTransform);this.ctx.concat(e);let t=Oi.translate(Oi.identity(),this._dropShadowOffsetX,this._dropShadowOffsetY);this.ctx.concat(t),this.ctx.concat(this._currentTransform)}}_applyEffectsToPaint(e,t,i=!0){var r,n,s,a;if(this.ctx&&this._currentPath){let o,l=!1;if(i&&this._hasDropShadow()){let c=e.copy();c.setColor(BS(this._dropShadowColor));let u;this._dropShadowBlur>0&&(u=ni.MaskFilter.MakeBlur(ni.BlurStyle.Normal,this._dropShadowBlur*this.dpr*(((r=this.camera)==null?void 0:r.scale)??1),!1),c.setMaskFilter(u)),this.ctx.save(),this.ctx.clipPath(this._currentPath,ni.ClipOp.Difference,!0),this._applyShadowOffsetMatrix(),t(c),this.ctx.restore(),c.delete(),u==null||u.delete()}if(this._backgroundBlur>0&&i){this.ctx.save(),this.ctx.clipPath(this._currentPath,ni.ClipOp.Intersect,!0);let c=ni.ImageFilter.MakeBlur(this._backgroundBlur,this._backgroundBlur,ni.TileMode.Clamp,null),u=e.copy();u.setImageFilter(c),u.setAlphaf(1);let h=this._currentPath.computeTightBounds();this.ctx.saveLayer(u,h,null,ni.SaveLayerInitWithPrevious),this.ctx.drawColor(e.getColor()),this.ctx.restore(),this.ctx.restore(),u.delete(),c.delete(),l=!0}if(this._layerBlur>0){let c=e.copy();o=ni.MaskFilter.MakeBlur(ni.BlurStyle.Normal,this._layerBlur*this.dpr*(((n=this.camera)==null?void 0:n.scale)??1),!1),c.setMaskFilter(o),t(c),c.delete(),o.delete(),l=!0}if(l||t(e),i&&this._hasInnerShadow()){let c=new ni.Paint;c.setAntiAlias(!0),c.setStyle(ni.PaintStyle.Fill),c.setColor(BS(this._innerShadowColor));let u;this._innerShadowBlur>0&&(u=ni.MaskFilter.MakeBlur(ni.BlurStyle.Normal,this._innerShadowBlur*this.dpr*(((s=this.camera)==null?void 0:s.scale)??1),!1),c.setMaskFilter(u));let h=this._currentPath.computeTightBounds(),[d,p,f,v]=h,g=f-d,m=v-p;this.ctx.save(),this.ctx.clipPath(this._currentPath,ni.ClipOp.Intersect,!0),this.ctx.saveLayer(c,h,null,ni.SaveLayerInitWithPrevious),(a=this.ctx)==null||a.translate(this._innerShadowOffsetX,this._innerShadowOffsetY),this.ctx.drawRect(ni.XYWHRect(-1e3-this._innerShadowOffsetX,-1e3-this._innerShadowOffsetY,2e3+g+Math.abs(this._innerShadowOffsetX*2),2e3+m+Math.abs(this._innerShadowOffsetY*2)),c),c.setBlendMode(ni.BlendMode.Clear),this.ctx.drawPath(this._currentPath,c),this.ctx.restore(),this.ctx.restore(),c.delete(),u==null||u.delete()}}}_paintInner(e,t=!0){if(this.ctx&&this._currentPath&&e){let i=this.ctx,r=this._currentPath;this._applyEffectsToPaint(e,n=>{let s=!1;!t&&this._strokeMode!=="center"&&(i.save(),i.clipPath(r,this._strokeMode==="outside"?ni.ClipOp.Difference:ni.ClipOp.Intersect,!0),s=!0),i.drawPath(r,n),s&&i.restore()},t)}}_hasDropShadow(){var e;return((e=this._dropShadowColor)==null?void 0:e.a)>0}_hasInnerShadow(){var e;return((e=this._innerShadowColor)==null?void 0:e.a)>0}path(e){var t;(t=this._currentPath)==null||t.addPath(ni.Path.MakeFromSVGString(e))}ellipse(e,t,i,r,n,s,a,o){var c;if(!Fj([e,t,i,r])||!this._currentPath)return;if(i<0||r<0)throw Error("radii cannot be negative");let l=ni.XYWHRect(e-i,t-r,i*2,r*2);(c=this._currentPath)==null||c.addOval(l)}rect(e,t,i,r,n=0,s=0,a=0,o=0){var c,u;let l=ni.XYWHRect(e,t,i,r);if(Fj(l))if(n===0&&s===0&&o===0&&a===0)(c=this._currentPath)==null||c.addRect(l);else{let h=ni.RRectXY(l,n,n);h[4]=h[5]=n,h[6]=h[7]=s,h[8]=h[9]=a,h[10]=h[11]=o,(u=this._currentPath)==null||u.addRRect(h)}}getHorizontalAlign(e){switch(e){case 2:return ni.TextAlign.Right;case 3:return ni.TextAlign.Center;case 4:return ni.TextAlign.Justify;case 1:default:return ni.TextAlign.Left}}drawTextInner(e,t,i,[r,n,s,a],o,l,c=!0){let u=0,{ctx:h}=this;if(!h)return u;let d=l.copy(),p=l.copy();return p.setAlphaf(0),this._applyEffectsToPaint(d,f=>{t.pushPaintStyle(i,f,p),t.addText(e);let v=t.build();v.layout(s);let g=n;o===2?g+=(a-v.getHeight())/2:o===3&&(g+=a-v.getHeight()),h.drawParagraph(v,r,g),u=v.getHeight(),t.reset(),v.delete()},c),d.delete(),p.delete(),u}drawText(e,t){let i=0,r=this._fonts.get(t.font),{ctx:n,_paintFill:s,_paintStroke:a}=this;if(r&&n){let o=new ni.TextStyle({fontFamilies:[t.font],fontSize:t.fontSize,heightMultiplier:t.lineHeight,letterSpacing:t.letterSpacing}),l=new ni.ParagraphStyle({textStyle:o,textAlign:this.getHorizontalAlign(t.horizontalAlign)}),c=ni.XYWHRect(t.x,t.y,t.width,t.height),u=ni.ParagraphBuilder.Make(l,r);s&&(i=this.drawTextInner(e,u,o,c,t.verticalAlign,s,!0)),a&&(i=this.drawTextInner(e,u,o,c,t.verticalAlign,a,!1)),u.delete()}return{height:i}}render(){var e;(e=this._surface)==null||e.flush()}moveTo(e,t){var i;(i=this._currentPath)==null||i.moveTo(e,t)}lineTo(e,t){var i;(i=this._currentPath)==null||i.lineTo(e,t)}bezierCurveTo(e,t,i,r,n,s){var a;(a=this._currentPath)==null||a.cubicTo(e,t,i,r,n,s)}quadraticCurveTo(e,t,i,r){var n;(n=this._currentPath)==null||n.quadTo(e,t,i,r)}setTransform(e,t=!1){var n,s,a,o,l;if(!this.ctx)return;let i=this.ctx.getTotalMatrix(),r=Oi.invert(i);if(r&&this.ctx.concat(r),(n=this.ctx)==null||n.scale(this.dpr,this.dpr),((s=this.camera)==null?void 0:s.enabled)&&((a=this.ctx)==null||a.concat(this.camera.worldMatrix),t)){let c=Oi.getScale(this.camera.worldMatrix);(o=this.ctx)==null||o.scale(1/c[0],1/c[1])}(l=this.ctx)==null||l.concat(e),this.currentTransform=e}transform(e){var t;(t=this.ctx)==null||t.concat(e)}setSize(e,t){var i;!this._isSizeDirty&&e===this._width&&t===this._height||(this._isSizeDirty=!1,this._width=e,this._height=t,this.canvas.style.width=e+"px",this.canvas.style.height=t+"px",this.canvas.width=e*this.dpr,this.canvas.height=t*this.dpr,this._surface&&(this._surface=ni.MakeWebGLCanvasSurface(this.canvas),this.ctx=(i=this._surface)==null?void 0:i.getCanvas()))}};function Fj(e){for(let t=0;t<e.length;t++)if(e[t]!==void 0&&!Number.isFinite(e[t]))return!1;return!0}function BS({r:e,g:t,b:i,a:r}){return ni.Color4f(e,t,i,r)}var Vj=class{constructor(e,t,i){this.uuid=e,this.data=t,this.enabled=!1,this.color=ar.transparent,this.blurRadius=0,this.offset=[0,0],this.spread=0,this.update(t)}update(e){e.color!==void 0&&(this.color=e.color),e.enabled!==void 0&&(this.enabled=e.enabled),e.blurRadius!==void 0&&(this.blurRadius=e.blurRadius),e.offset!==void 0&&(this.offset=e.offset),e.spread!==void 0&&(this.spread=e.spread)}},Hj=class{constructor(e,t,i){this.uuid=e,this.data=t,this.enabled=!1,this.radius=0,this.update(t)}update(e){e.enabled!==void 0&&(this.enabled=e.enabled),e.radius!==void 0&&(this.radius=e.radius)}},_2e=class{constructor(e,t,i){this.uuid=e,this.data=t,this.enabled=!1,this.color=ar.transparent,this.update(t)}update(e){e.enabled!==void 0&&(this.enabled=e.enabled),e.color!==void 0&&(this.color=e.color)}},S2e=class{constructor(e,t,i){this.uuid=e,this.data=t,this.enabled=!1,this.color=ar.transparent,this.thickness=0,this.mode="inside",this.update(t)}update(e){e.enabled!==void 0&&(this.enabled=e.enabled),e.color!==void 0&&(this.color=e.color),e.thickness!==void 0&&(this.thickness=e.thickness),e.mode!==void 0&&(this.mode=e.mode)}},ts=class extends cs{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.autoClose=!0,this.fill=new _2e(e+"-fill",t.fill,i),this.stroke=new S2e(e+"-stroke",t.stroke,i),this.dropShadow=new Vj(e+"-dropShadow",t.dropShadow,i),this.innerShadow=new Vj(e+"-innerShadow",t.innerShadow,i),this.backgroundBlur=new Hj(e+"-backgroundBlur",t.backgroundBlur,i),this.layerBlur=new Hj(e+"-layerBlur",t.layerBlur,i)}applyFillStroke(e){e.fillColor=this.fill.enabled?this.fill.color:ar.transparent,e.strokeColor=this.stroke.enabled&&this.stroke.thickness>0?this.stroke.color:ar.transparent,e.strokeMode=this.stroke.mode,e.lineWidth=this.stroke.thickness}applyFilters(e){this.layerBlur.enabled?e.layerBlur=this.layerBlur.radius*5:e.layerBlur=0,this.backgroundBlur.enabled?e.backgroundBlur=this.backgroundBlur.radius*5:e.backgroundBlur=0,this.dropShadow.enabled?(e.dropShadowBlur=this.dropShadow.blurRadius*5,e.dropShadowColor=this.dropShadow.color,e.dropShadowOffsetX=this.dropShadow.offset[0],e.dropShadowOffsetY=this.dropShadow.offset[1]):e.dropShadowColor=ar.transparent,this.innerShadow.enabled?(e.innerShadowSpread=this.innerShadow.spread,e.innerShadowBlur=this.innerShadow.blurRadius*5,e.innerShadowColor=this.innerShadow.color,e.innerShadowOffsetX=this.innerShadow.offset[0],e.innerShadowOffsetY=this.innerShadow.offset[1]):e.innerShadowColor=ar.transparent}innerDraw(e){}draw(e){!this.visible||(e.save(),this.applyTransforms(e),this.applyFilters(e),this.applyFillStroke(e),e.beginPath(),this.innerDraw(e),this.autoClose&&e.closePath(),this.fill.enabled&&e.fill(),this.stroke.enabled&&e.stroke(),e.restore())}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),e.type===0&&(hr(e.path,["fill"])?this.fill.update(e.props):hr(e.path,["stroke"])?this.stroke.update(e.props):hr(e.path,["dropShadow"])?this.dropShadow.update(e.props):hr(e.path,["innerShadow"])?this.innerShadow.update(e.props):hr(e.path,["layerBlur"])?this.layerBlur.update(e.props):hr(e.path,["backgroundBlur"])?this.backgroundBlur.update(e.props):this.resetBBoxNeedsUpdate())}updateState(e,t){super.updateState(e,t),e.fill!==void 0&&this.fill.update(e.fill),e.stroke!==void 0&&this.stroke.update(e.stroke),e.dropShadow!==void 0&&this.dropShadow.update(e.dropShadow),e.innerShadow!==void 0&&this.innerShadow.update(e.innerShadow),e.layerBlur!==void 0&&this.layerBlur.update(e.layerBlur),e.backgroundBlur!==void 0&&this.backgroundBlur.update(e.backgroundBlur)}clone(e){let t=new ts(this.uuid,this.data,e);return t.parent=void 0,t}},Mk=class extends ts{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.width=0,this.height=0,this.updateState(t,i)}innerDraw(e){e.ellipse(this.width*.5,this.height*.5,this.width*.5,this.height*.5,0,0,Math.PI*2)}intersectsInLocalSpace(e,t){return g2e(e,t,this.width*.5,this.height*.5,this.width*.5,this.height*.5)}getCenter(){return[this.width*.5,this.height*.5]}getHalfSize(){return[this.width*.5,this.height*.5]}updateSizeState(e){let t=!1;e.width!==void 0&&(this.width=typeof e.width=="number"?e.width:this.width,t=!0),e.height!==void 0&&(this.height=typeof e.height=="number"?e.height:this.height,t=!0),t&&this.updateWorldMatrix(!0,!1,!0)}updateState(e,t){super.updateState(e,t),this.updateSizeState(e)}clone(e){let t=new Mk(this.uuid,this.data,e);return t.parent=void 0,t}},Yw=class extends ts{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.width=0,this.height=0,this.cornerRadius=[0,0,0,0],this.updateState(t,i)}innerDraw(e){e.rect(0,0,this.width,this.height,...this.cornerRadius)}getCenter(){return[this.width*.5,this.height*.5]}getHalfSize(){return[this.width*.5,this.height*.5]}updateCornerState(e){e.cornerRadius!==void 0&&(this.cornerRadius=e.cornerRadius)}updateSizeState(e){let t=!1;e.width!==void 0&&(this.width=typeof e.width=="number"?e.width:this.width,t=!0),e.height!==void 0&&(this.height=typeof e.height=="number"?e.height:this.height,t=!0),t&&this.updateWorldMatrix(!0,!1,!0)}updateState(e,t){super.updateState(e,t),this.updateSizeState(e),this.updateCornerState(e)}clone(e){let t=new Yw(this.uuid,this.data,e);return t.parent=void 0,t}},Ek=class extends ts{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this._textHeight=0,this._textHeightDirty=!0,this.width=0,this.height=0,this.updateState(t,i)}get textHeight(){return this._textHeight}applyFillStroke(e){e.fillColor=this.fill.enabled?this.fill.color:ar.transparent,e.strokeColor=this.stroke.enabled&&this.stroke.thickness>0?this.stroke.color:ar.transparent,e.strokeMode="center",e.lineWidth=this.stroke.thickness}innerDraw(e){var s;(s=this._fontHolder)!=null&&s.arrayBuffer&&this._fontHolder.arrayBuffer.byteLength>1&&this.data.font&&e.registerFont(this._fontHolder.arrayBuffer,this.data.font);let t=this.data.textTransform,i=this.data.text.textValue.toString(),r=t===2?i.toUpperCase():t===3?i.toLowerCase():i,{height:n}=e.drawText(r,{x:0,y:0,width:this.width,height:this.height,fontSize:this.data.fontSize,lineHeight:this.data.lineHeight??1,letterSpacing:this.data.letterSpacing??0,horizontalAlign:this.data.horizontalAlign,verticalAlign:this.data.verticalAlign,font:this.data.font});this._textHeight=n}getCenter(){return[this.width*.5,this.height*.5]}getHalfSize(){return[this.width*.5,this.height*.5]}updateSizeState(e){let t=!1;e.width!==void 0&&(this.width=typeof e.width=="number"?e.width:this.width,t=!0),e.height!==void 0&&(this.height=typeof e.height=="number"?e.height:this.height,t=!0),t&&this.updateWorldMatrix(!0,!1,!0)}updateFontState(e,{shared:t}){e.font!==void 0&&(this._fontHolder=t.getFont(e.font),this._fontHolder&&!this._fontHolder.isLoaded&&this._fontHolder.loadingPromise.then(()=>{this.requestRender()}))}updateState(e,t){super.updateState(e,t),this.updateSizeState(e),this.updateFontState(e,t)}clone(e){let t=new Ek(this.uuid,this.data,e);return t.parent=void 0,t}},d$=class extends ts{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.curves=[],this.extremasBBox={min:[0,0],max:[0,0]},this.updateState(t,i)}computeExtremas(){this.curves.length===0&&this.computeCurves();let e=this.curves.map(r=>uC.extremas(r)),t=[1/0,1/0],i=[-1/0,-1/0];for(let r=0,n=e.length;r<n;r++){let s=e[r];s[0][0]<t[0]&&(t[0]=s[0][0]),s[0][1]<t[1]&&(t[1]=s[0][1]),s[1][0]>i[0]&&(i[0]=s[1][0]),s[1][1]>i[1]&&(i[1]=s[1][1])}return this.extremasBBox.min=[t[0],t[1]],this.extremasBBox.max=[i[0],i[1]],this.extremasBBox}computeCurves(){this.curves=[];for(let i=1,r=this.data.points.length;i<r;i++){let n=this.data.points[i].data,s=this.data.points[i-1].data,a={start:s.position,cp1:s.controlNext.position,cp2:n.controlPrevious.position,end:n.position};this.curves.push(a)}let e=this.data.points[0].data,t=this.data.points[this.data.points.length-1].data;if(this.data.isClosed){let i={start:t.position,cp1:t.controlNext.position,cp2:e.controlPrevious.position,end:e.position};this.curves.push(i)}}getCenter(){let[e,t]=this.extremasBBox.min,[i,r]=this.getHalfSize();return[e+i,t+r]}getHalfSize(){let{min:e,max:t}=this.extremasBBox;return[(t[0]-e[0])*.5,(t[1]-e[1])*.5]}innerDraw(e){for(let r=0,n=this.data.points.length;r<n;r++){let s=this.data.points[r].data;if(r===0){let[a,o]=s.position;e.moveTo(a,o)}else{let a=this.data.points[r-1].data,[o,l]=a.controlNext.position,[c,u]=s.controlPrevious.position,[h,d]=s.position,p={start:a.position,cp1:a.controlNext.position,cp2:s.controlPrevious.position,end:s.position};uC.derive(p),e.bezierCurveTo(o,l,c,u,h,d)}}let t=this.data.points[0].data,i=this.data.points[this.data.points.length-1].data;if(this.data.isClosed){let[r,n]=i.controlNext.position,[s,a]=t.controlPrevious.position,[o,l]=t.position;e.bezierCurveTo(r,n,s,a,o,l)}}updateState(e,t){super.updateState(e,t),this.computeExtremas()}clone(e){let t=new d$(this.uuid,this.data,e);return t.parent=void 0,t}},uC;(e=>{function t(a){let o=a.start,l=a.cp1,c=a.cp2,u=a.end,h=[3*(l[0]-o[0]),3*(l[1]-o[1])],d=[3*(c[0]-l[0]),3*(c[1]-l[1])],p=[3*(u[0]-c[0]),3*(u[1]-c[1])],f={start:h,cp:d,end:p};return a.derivative=f,f.derivative=pz.derive(f),f}e.derive=t;function i(a,o,l,c=!1){let u=a-2*o+l;if(u!==0){let h=-Math.sqrt(Math.abs(o*o-a*l)),d=-a+o,p=-(h+d)/u,f=-(-h+d)/u;return[p,f]}else if(o!==l&&u===0)return[(2*o-l)/(2*(o-l))];return[]}function r(a){let o=a.derivative??e.derive(a),l=o.start,c=o.cp,u=o.end;return[i(l[0],c[0],u[0]),i(l[1],c[1],u[1])]}e.droot=r;function n(a){let[o,l]=e.droot(a),c=[a.start[0],a.end[0]],u=[a.start[1],a.end[1]];for(let h of o)c.push(e.compute(a,Math.min(1,Math.max(0,h)))[0]);for(let h of l)u.push(e.compute(a,Math.min(1,Math.max(0,h)))[1]);return c.sort((h,d)=>h-d),u.sort((h,d)=>h-d),[[c[0],u[0]],[c[c.length-1],u[u.length-1]]]}e.extremas=n;function s(a,o){if(o===0)return[...a.start];if(o===1)return[...a.end];let l=1-o,c=l*l,u=o*o,h=c*l,d=c*o*3,p=l*u*3,f=o*u;return[h*a.start[0]+d*a.cp1[0]+p*a.cp2[0]+f*a.end[0],h*a.start[1]+d*a.cp1[1]+p*a.cp2[1]+f*a.end[1]]}e.compute=s})(uC||(uC={}));var pz;(e=>{function t(n){let s=n.start,a=n.cp,o=n.end,l=[2*(a[0]-s[0]),2*(a[1]-s[1])],c=[2*(o[0]-a[0]),2*(o[1]-a[1])],u={start:l,end:c};return u.derivative=fz.derive(u),n.derivative=u,u}e.derive=t;function i(n){let s=n.derivative??e.derive(n),a=s.start,o=s.end;return[a[0]!==o[0]?a[0]/(a[0]-o[0]):0,a[1]!==o[1]?a[1]/(a[1]-o[1]):0]}e.droot=i;function r(n,s){if(s===0)return[...n.start];if(s===1)return[...n.end];let a=1-s,o=a*a,l=s*s,c=o,u=a*s*2,h=l;return[c*n.start[0]+u*n.cp[0]+h*n.end[0],c*n.start[1]+u*n.cp[1]+h*n.end[1]]}e.compute=r})(pz||(pz={}));var fz;(e=>{function t(r){let n=r.start,s=r.end,a=[s[0]-n[0],s[1]-n[1]];return r.derivative=a,r.derivative}e.derive=t;function i(r,n){if(n===0)return[...r.start];if(n===1)return[...r.end];let s=r.start,a=r.end;return[s[0]+(a[0]-s[0])*n,s[1]+(a[1]-s[1])*n]}e.compute=i})(fz||(fz={}));var Vc=class extends Dl{constructor(e,t,i){super(e,t,i),this.uuid=e,this.width=0,this.height=0,this.clipped=!0,this.background=new Yw(e+"-background",X1.defaultData,i),this.background.parent=this,this.updateState(t,i)}get fill(){return this.background.fill}get stroke(){return this.background.stroke}get backgroundBlur(){return this.background.backgroundBlur}get layerBlur(){return this.background.layerBlur}get dropShadow(){return this.background.dropShadow}get innerShadow(){return this.background.innerShadow}get cornerRadius(){return this.background.cornerRadius}set cornerRadius(e){this.background.cornerRadius=e}updateLocalMatrix(){var e;super.updateLocalMatrix(),(e=this.background)==null||e.updateLocalMatrix()}updateWorldMatrix(e,t,i){var r;super.updateWorldMatrix(e,t,i),(r=this.background)==null||r.updateWorldMatrix(e,t,i)}draw(e){if(!this.visible)return;e.save();let t=this.width,i=this.height;this.applyTransforms(e),this.background.width=t,this.background.height=i,this.background.draw(e),this.clipped&&e.clipRect(0,0,t,i,...this.cornerRadius),this.innerDrawChildren(e),e.restore()}getCenter(){return[this.width*.5,this.height*.5]}getHalfSize(){return[this.width*.5,this.height*.5]}updateCornerState(e){e.cornerRadius!==void 0&&(this.cornerRadius=e.cornerRadius)}updateSizeState(e){let t=!1;e.width!==void 0&&(this.width=typeof e.width=="number"?e.width:this.width,t=!0),e.height!==void 0&&(this.height=typeof e.height=="number"?e.height:this.height,t=!0),t&&this.updateWorldMatrix(!0,!1,!0)}updateState(e,t){super.updateState(e,t),this.updateSizeState(e),this.updateCornerState(e),e.fill!==void 0&&this.fill.update(e.fill),e.stroke!==void 0&&this.stroke.update(e.stroke),e.dropShadow!==void 0&&this.dropShadow.update(e.dropShadow),e.innerShadow!==void 0&&this.innerShadow.update(e.innerShadow),e.layerBlur!==void 0&&this.layerBlur.update(e.layerBlur),e.backgroundBlur!==void 0&&this.backgroundBlur.update(e.backgroundBlur),e.clipped!==void 0&&(this.clipped=e.clipped)}requestRender(){super.requestRender(),this.dispatchEvent({type:"render"})}dispose(){this.removeEventListener("render")}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),e.type===0&&(hr(e.path,["fill"])?this.fill.update(e.props):hr(e.path,["stroke"])?this.stroke.update(e.props):hr(e.path,["dropShadow"])?this.dropShadow.update(e.props):hr(e.path,["innerShadow"])?this.innerShadow.update(e.props):hr(e.path,["layerBlur"])?this.layerBlur.update(e.props):hr(e.path,["backgroundBlur"])?this.backgroundBlur.update(e.props):this.resetBBoxNeedsUpdate())}clone(e){let t=new Vc(this.uuid,this.data,e);t.parent=void 0;for(let i of this.children)t.add(i.clone(e));return t}},M2e=Sh(vY(),1),GT=class extends ts{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this._pathBBox=new DOMRect,this.path="",this.updateState(t,i),this.autoClose=!1,this.computeSVGBBox()}computeSVGBBox(){let e=document.createElementNS("http://www.w3.org/2000/svg","svg"),t=document.createElementNS("http://www.w3.org/2000/svg","path");document.body.appendChild(e),t.setAttribute("d",this.path),e.appendChild(t),this._pathBBox=t.getBBox(),e.remove()}innerDraw(e){e.path(this.path)}intersectsInLocalSpace(e,t){return e>=this._pathBBox.x&&e<=this._pathBBox.x+this._pathBBox.width&&t>=this._pathBBox.y&&t<=this._pathBBox.y+this._pathBBox.height}getCenter(){return[(this._pathBBox.x+this._pathBBox.width)/2,(this._pathBBox.y+this._pathBBox.height)/2]}getHalfSize(){return[(this._pathBBox.x+this._pathBBox.width)/2,(this._pathBBox.y+this._pathBBox.height)/2]}updateState(e,t){super.updateState(e,t),e.path!==void 0&&(this.path=e.path,this.computeSVGBBox())}clone(e){let t=new GT(this.uuid,this.data,e);return t.parent=void 0,t}};function E2e(e,t=1,i=1){if(t<=0||i<=0)return e;let r=(0,M2e.parseSVG)(e).map(n=>{let s={...n};return"x"in s&&(s.x=s.x*t),"y"in s&&(s.y=s.y*i),"x1"in s&&(s.x1=s.x1*t),"x2"in s&&(s.x2=s.x2*t),"y1"in s&&(s.y1=s.y1*i),"y2"in s&&(s.y2=s.y2*i),"rx"in s&&(s.rx=s.rx*t),"ry"in s&&(s.ry=s.ry*i),s});return A2e(r)}function A2e(e){let t=["rx","ry","xAxisRotation","largeArc","sweep","x1","y1","x2","y2","x","y"],i;return e.map(r=>{let n=[];t.forEach(a=>{if(a in r){let o=r[a]*1;n.length&&o>=0&&n.push(","),n.push(o)}});let s=(i===r.code?n[0]<0?"":",":r.code)+n.join("");return i=r.code,s}).join("")}function C2e(e,t,i){switch(t.type){case"ellipse2d":return new Mk(e,t,i);case"rectangle2d":return new Yw(e,t,i);case"text2d":return new Ek(e,t,i);case"vector2d":return new d$(e,t,i);case"path2d":return new GT(e,t,i);case"frame2d":return new Vc(e,t,i);case"group2d":default:return new Qd(e,t,i)}}var p$=class{constructor(e,t,i){this.uuid=e,this.data=t,this.group=new Qd(p$.GROUP_ID,{...iC.defaultData},i),this.createChildrenObjects(t.objects,this.group,i)}createObject(e,t,i,r,n,s){let a=C2e(e,t,s);a&&(r.add(a),r.children.splice(n,0,r.children.pop()),a.updateWorldMatrix(),i.length>0&&(a instanceof Qd||a instanceof Vc)&&this.createChildrenObjects(i,a,s))}createChildrenObjects(e,t,i){let r=0;for(let n of e)this.createObject(n.id,n.data,n.children,t,r,i),r+=1}draw(e){this.group.draw(e)}updateEntityByOp(e,t,i,r){let n=this.find(e);if(n)try{n.updateByOp(t,i,{shared:r})}catch(s){console.error(s)}}updateTreeByOp(e,t){if(e.path.length===0&&e.type===7){let i=e.parent===null?this.group:this.find(e.parent);i!==void 0&&i instanceof Dl&&(this.createObject(e.id,e.data,e.children,i,e.localIndex,t),i.requestRender())}else if(e.path.length===0&&e.type===8){let i=this.find(e.id);if(i!==void 0&&i.parent!==void 0&&i.parent instanceof Dl){let r=i.parent;i.resetBBoxNeedsUpdate(),r==null||r.remove(i),r==null||r.requestRender()}}else if(e.path.length===0&&e.type===9){let i=this.find(e.id);if(i!==void 0){let r=i.parent,n=e.parent===null?this:this.find(e.parent);if(n instanceof Dl||n===this){n.add(i);let s=e.localIndex;n.children.splice(s,0,n.children.pop()),i.updateWorldMatrix(!0,!1,!0),r==null||r.requestRender(),i.requestRender()}i.resetBBoxNeedsUpdate()}}}add(e){this.group.add(e)}remove(e){this.group.remove(e)}traverse(e){this.group.traverse(t=>{t!==this.group&&e(t)})}intersectsChildren(e,t,i,r=!1,n=[]){return this.group.intersectsChildren(e,t,i,r,n,!0)}intersectsChildrenReverse(e,t,i,r=!1,n=[]){return this.group.intersectsChildrenReverse(e,t,i,r,n,!0)}find(e){return this.group.find(e)}get children(){return this.group.children}project(e,t){return this.group.project(e,t)}getWithSortKey(e){let t=this.find(e);if(t===void 0)return;let i=[],r=t;for(;r!==this.group;){let n=r;r=r.parent;let s=r.children.indexOf(n);i.splice(0,0,s)}return{entity:t,sortKey:i}}getAllSorted(e){let t=[];for(let i of e){let r=this.getWithSortKey(i.id);r!==void 0&&t.push(r)}return t.sort((i,r)=>QQ(i.sortKey,r.sortKey)),t.map(i=>i.entity)}},Ak=p$;Ak.GROUP_ID="scene2d";function f$({constraints:e,newParentWidth:t,newParentHeight:i,initialParentWidth:r,initialParentHeight:n,objectInitialWidth:s,objectInitialHeight:a,objectInitialPosition:o}){let{horizontalConstraint:l,verticalConstraint:c}=e,u=t-r,h=i-n,d=s,p=a,f=o[0],v=o[1];if(l!==0){if(l===1)f+=u;else if(l===3)f+=u/2;else if(l===2)d=Math.max(1,d+u);else if(l===4){let g=t/r;d*=g,f*=g}}if(c!==0){if(c===1)v+=h;else if(c===3)v+=h/2;else if(c===2)p=Math.max(1,p+h);else if(c===4){let g=i/n;p*=g,v*=g}}return{width:d,height:p,position:[f,v]}}Sh(vY(),1);var T2e=`
	varying vec2 vUv;
	void main() {
		vUv = uv;
		gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
	}`,P2e=`
	uniform sampler2D tDiffuse;
	varying vec2 vUv;
	void main() {
		vec4 texel = texture2D( tDiffuse, vUv );
		gl_FragColor = texel;
	}`,D2e=new _T(-1,1,1,-1,0,1),R2e=class extends Bt{constructor(){super(),this.setAttribute("position",new St([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new St([0,2,0,0,2,0],2))}},I2e=new R2e,L2e=class{constructor(e){this._mesh=new zr(I2e,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,D2e)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}},m$=new Ui({defines:{},uniforms:{tDiffuse:new at(null)},vertexShader:T2e,fragmentShader:P2e}),O2e=new L2e(m$),eR=null,tR=null,z2e=()=>(eR===null&&(eR=document.createElement("canvas")),eR),N2e=e=>(tR===null&&(tR=new h$(e)),tR),B2e=Oi.identity(),g$=class{constructor(e,t,i,r){this.uuid=e,this.width=t,this.height=i,this.context=r,this.enabled=!0,this.isScreenSpace=!1,this.dpr=window.devicePixelRatio,this.isFrameDirty=!1,this.onRenderRequestedDownstream=()=>{this.isFrameDirty=!0,this.context.shared.requestRender()},this._innerApplySize=()=>{let n=this.width,s=this.height,a=this.dpr;this.renderer.dpr=this.isScreenSpace?a:Math.floor(2048/Math.max(n,s)),this.renderer.setSize(n,s)},this.onFrameOverrideObjectEvent=n=>{var s,a;if(((s=n.target)==null?void 0:s.uuid)!==void 0){let o=(a=this.frameRoot)==null?void 0:a.find(n.target.uuid);o&&o.dispatchEvent({...n,target:o})}},this.scene2d=new Ak(Et.generateUUID(),BO.defaultData,{dpr:window.devicePixelRatio,shared:r.shared}),this.canvas=z2e(),this.renderer=N2e(this.canvas),this.promise=this.init(),this.renderTarget=new Wi(1,1,{type:ch,stencilBuffer:!1,depthBuffer:!1}),r.shared.addUIBuffer(this.uuid,this.renderTarget),this.textureHolder=r.shared.uiBuffer(this.uuid)}get canvasTexture(){return this._canvasTexture||(this._canvasTexture=new Gde(this.canvas)),this._canvasTexture}async init(){this.renderer instanceof h$&&(this.renderer.wasmURL=kZ.skiaWasmUrl),await this.renderer.init()}render(e){var t,i;if(this.isFrameDirty){this.isFrameDirty=!1,this._innerApplySize(),this.renderer.clear(),(t=this.frameOverride)==null||t.draw(this.renderer),this.renderer.render(),m$.uniforms.tDiffuse.value=this.canvasTexture,this.canvasTexture.needsUpdate=!0;let r=e.getRenderTarget();e.setRenderTarget(this.renderTarget),e.clear(),O2e.render(e),e.setRenderTarget(r),(i=this.textureHolder)==null||i.setNeedsUpdate(!0)}}updateEntity2DByOp(e,t,i,r){this.scene2d.updateEntityByOp(e,t,i,r),this.applySize()}updateTreeByOp(e,t){this.scene2d.updateTreeByOp(e,t),this.applySize()}applyOverrides(e){if(this.frameOverride&&this.frameRoot){this.frameOverride.position=[0,0],this.frameOverride.rotation=0;let t=(e==null?void 0:e.width)??this.width,i=(e==null?void 0:e.height)??this.height;this.frameOverride.width=t,this.frameOverride.height=i,this.frameOverride.localMatrix=B2e,this.isScreenSpace&&(this.frameOverride.fill.color=ar.from0to1([0,0,0,0])),this.frameOverride.data={...this.frameOverride.data,width:t,height:i},v$({objectOverride:this.frameOverride,objectRoot:this.frameRoot,newParentWidth:this.frameOverride.width,newParentHeight:this.frameOverride.height,initialParentWidth:this.frameRoot.width,initialParentHeight:this.frameRoot.height}),this.frameOverride.updateWorldMatrix(!0,!1,!0)}}applySize(e,t=window.devicePixelRatio){var o,l;let i=Math.max(1,(e==null?void 0:e.width)??this.width),r=Math.max(1,(e==null?void 0:e.height)??this.height);this.dpr=t,this.width=i,this.height=r,this._innerApplySize();let n=1,s=512,a=512;(i*t<s||r*t<a)&&(n=Math.max(s/(i*t),a/(r*t))),this.renderTarget.setSize(i*t*n,r*t*n),(o=this._canvasTexture)==null||o.dispose(),this._canvasTexture=void 0,this.applyOverrides(e),(l=this.frameOverride)==null||l.requestRender()}applyFrame(e){var i,r;let t=this.context.scene.find2D(e);if(!(!t||!(t instanceof Vc)))return this.disposeFrameOverride(),this.frameRoot=t,this.frameOverride=t.clone({dpr:this.renderer.dpr,shared:this.context.shared}),this.scene2d.add(this.frameOverride),this.applySize(),(i=this.frame)==null||i.addEventListener("render",this.onRenderRequestedDownstream),this.frameOverride.traverse(n=>{n.addEventListener("beginState",this.onFrameOverrideObjectEvent)}),this.frameOverride.traverse(n=>{n.addEventListener("completeState",this.onFrameOverrideObjectEvent)}),(r=this.frame)==null||r.requestRender(),t}get frame(){return this.frameOverride}get frameId(){var e;return(e=this.frame)==null?void 0:e.uuid}find(e){return this.scene2d.find(e)}get texture(){var e;return(e=this.textureHolder)==null?void 0:e.getTexture(1001)}disposeFrameOverride(){var e,t,i;(e=this.frameOverride)==null||e.removeEventListener("render",this.onRenderRequestedDownstream),(t=this.frameOverride)==null||t.traverse(r=>{r.removeEventListener("beginStateChange",this.onFrameOverrideObjectEvent)}),(i=this.frameOverride)==null||i.traverse(r=>{r.removeEventListener("completeState",this.onFrameOverrideObjectEvent)}),this.frameOverride&&this.scene2d.remove(this.frameOverride)}};function v$({objectOverride:e,objectRoot:t,newParentWidth:i,newParentHeight:r,initialParentWidth:n,initialParentHeight:s}){if(e instanceof Vc&&t instanceof Vc||e instanceof Qd&&t instanceof Qd)for(let a=0,o=e.children.length;a<o;a++){let l=e.children[a],c=t.children[a];l&&c&&l.uuid===c.uuid&&U2e({objectOverride:l,objectRoot:c,newParentWidth:i,newParentHeight:r,initialParentWidth:n,initialParentHeight:s})}}function k2e(e){if(mz(e))return[e.width,e.height];if(e instanceof GT){let[t,i]=e.getHalfSize();return[t*2,i*2]}else if(e instanceof Qd){let[t,i]=e.recursiveBBox.getHalfSize();return[t*2,i*2]}return[0,0]}function U2e({objectOverride:e,objectRoot:t,newParentWidth:i,newParentHeight:r,initialParentWidth:n,initialParentHeight:s}){let[a,o]=k2e(t),{width:l,height:c,position:u}=f$({constraints:e.data,newParentWidth:i,newParentHeight:r,initialParentWidth:n,initialParentHeight:s,objectInitialWidth:a,objectInitialHeight:o,objectInitialPosition:t.position});if(e.position=u,e.data={...e.data,position:u},e.states)for(let h in e.states)F2e({stateId:h,objectOverride:e,objectRoot:t,newParentWidth:i,newParentHeight:r,initialParentWidth:n,initialParentHeight:s});if(mz(e)||e instanceof Qd)mz(e)&&(e.width=l,e.height=c,e.data={...e.data,width:l,height:c}),v$({objectOverride:e,objectRoot:t,newParentWidth:l,newParentHeight:c,initialParentWidth:a,initialParentHeight:o});else if(e instanceof GT){let h=t,d=a!==0?l/a:1,p=o!==0?c/o:1;e.path=E2e(h.path,d,p),e.data={...e.data,path:e.path}}}function F2e({stateId:e,objectOverride:t,objectRoot:i,newParentWidth:r,newParentHeight:n,initialParentWidth:s,initialParentHeight:a}){var c,u;let o=(c=t.states)==null?void 0:c[e],l=(u=i.states)==null?void 0:u[e];if(o&&l){let{width:h,height:d,position:p}=f$({constraints:t.data,newParentWidth:r,newParentHeight:n,initialParentWidth:s,initialParentHeight:a,objectInitialWidth:Cf.isResizeable(l)?l.width:0,objectInitialHeight:Cf.isResizeable(l)?l.height:0,objectInitialPosition:l.position});Object.assign(t.states[e],{position:p}),Cf.isResizeable(o)&&Object.assign(t.states[e],{width:h,height:d})}}function mz(e){return e instanceof Yw||e instanceof Vc||e instanceof Mk||e instanceof Ek}var es=class extends tk(Uc){constructor(e,t,i){super(),this.data=t,this.bgColor=new Es(1,1,1,1),this.fog=null,this.backupFog=new HY(16777215,.1,2e3),this.fogUseBGColor=!1,this.isActive=!1,this.aoColor=new jt,this.penumbraSizeArrayCache=null,this.super_Entity(e,t),this.personalCamera=new Qs(L0,{...G1.defaultData,...t.camera,name:"Personal Camera"}),this.personalCamera.objectHelper.visible=!1,this.add(this.personalCamera),this.activeCamera=this.personalCamera,this.ambientLight=new Tpe(13882323,8553090,.75),this.ambientLight.name="Default Ambient Light",this.ambientLight.layers.enable(3),this.ambientLight.removeFromParent(),this.add(this.ambientLight),t.uiScene?this.uiScene=new Ak((Array.isArray(e)?e[0]:e)+"-ui",t.uiScene,{dpr:window.devicePixelRatio,shared:i.shared}):t.uiFrame&&this.createUICanvas(t.uiFrame,i)}get scene(){return this.parent}get postprocessing(){return this.data.postprocessing}get frameId(){return this.data.uiFrame}get frame(){var e;return(e=this.uiCanvas)==null?void 0:e.frame}createUICanvas(e,t){this.uiCanvas=new g$(this.uuid+"-uiscreen",window.innerWidth,window.innerHeight,t),this.uiCanvas.isScreenSpace=!0,this.uiCanvas.promise.then(()=>{var i,r;(i=this.uiCanvas)==null||i.applyFrame(e),(r=this.uiCanvas)==null||r.applySize()})}updateVisible(){}setBackgroundColor(e){this.bgColor=e,this.fogUseBGColor===!0&&(this.backupFog.color=e)}entityChildrenCount(){return this.uiScene?this.uiScene.children.length:super.entityChildrenCount()}updateAmbientLight(e,t){e.color!==void 0&&(this.ambientLight.color=ma(e.color,t)),e.intensity!==void 0&&(this.ambientLight.intensity=e.intensity),e.enabled!==void 0&&(e.enabled?this.add(this.ambientLight):this.remove(this.ambientLight))}onDeactive(){this.isActive=!1}onActive(e){this.isActive=!0,e.fog=this.fog,this.traverseEntity(t=>{t instanceof qf&&t.recomputeBoolean()}),this.updateShadow(this.data.shadow)}forceMaterialsUpdate(){this.traverseEntity(e=>{if(e instanceof N0)if(Array.isArray(e.material))for(let t of e.material)t.needsUpdate=!0;else e.material.needsUpdate=!0,e.material.dispose()})}updateShadow(e){e.softShadowQuality!==void 0&&this.isActive&&r2e(e.softShadowQuality)&&this.forceMaterialsUpdate()}updateFog(e,t){if(e.enabled?this.fog=this.backupFog:this.fog=null,this.isActive){let i=this.scene;i.fog=this.fog}this.fogUseBGColor=e.useBackgroundColor,e.useBackgroundColor?this.backupFog.color.set(this.bgColor):this.backupFog.color=ma(e.color,t),this.backupFog.near=e.near,this.backupFog.far=e.far}updateAo(e,t){e.aoColor!==void 0&&(this.aoColor=ma(e.aoColor,t))}updateByOp(e,t,i,r){let n=this.data.uiFrame;super.updateByOp(e,t,i,r);let s=t;hr(e.path,["fog"])?this.updateFog(s.fog,i.shared):hr(e.path,["ao"])?this.updateAo(s.ao,i.shared):hr(e.path,["ambient"])?this.updateAmbientLight(s.ambient,i.shared):hr(e.path,["shadow"])?this.updateShadow(s.shadow):e.type===0&&e.path.length===0&&(e.props.uiFrame!==void 0||n!==s.uiFrame)&&this.updateUIFrame(e.props.uiFrame,i)}updateUIFrame(e,t){e?(this.uiCanvas||this.createUICanvas(e,t),this.uiCanvas.enabled=!0,this.uiCanvas.applyFrame(e)):this.uiCanvas&&(this.uiCanvas.enabled=!1)}updateState(e,t){this.updateState_Entity(e,t),e.backgroundColor!==void 0&&this.setBackgroundColor(ma(e.backgroundColor,t.shared)),e.fog!==void 0&&this.updateFog(e.fog,t.shared),e.ambient!==void 0&&this.updateAmbientLight(e.ambient,t.shared),e.ao!==void 0&&this.updateAo(e.ao,t.shared),e.shadow!==void 0&&this.updateShadow(e.shadow)}createFrame(e,t){}raycast(e,t){super.raycast(e,t)}switchActiveCamera(e){e&&e.isDescendantOf(this)&&(this.activeCamera!==this.personalCamera&&(this.activeCamera.objectHelper.visible=!0),this.activeCamera=e,e.objectHelper.visible=!1)}get playCamera(){var e;return((e=this.scene)==null?void 0:e.find(this.data.publish.playCamera))??this.personalCamera}switchToPlayCamera(){this.switchActiveCamera(this.playCamera)}get penumbraSizeArray(){return this.penumbraSizeArrayCache===null&&this.updatePenumbraSizeArray(),this.penumbraSizeArrayCache}updatePenumbraSizeArray(){this.penumbraSizeArrayCache=new Array(5).fill(.5);let e=0,t=0;this.traverseEntity(i=>{if(!i.visible)return!0;i instanceof o$&&i.visible&&e<3&&(this.penumbraSizeArrayCache[e]=i.data.penumbraSize??.5,e+=1),i instanceof l$&&i.visible&&e<2&&(this.penumbraSizeArrayCache[3+t]=i.data.penumbraSize??.5,t+=1)})}raycastWithClones(e){let t=[],i=r=>{for(let n of r.children){let s=n.cloner;Pi.is(n)&&(n.visible||s!=null&&s.object.data.visible)&&((Pl(n)||sz(n)&&this.scene.enableHelpers&&n.objectHelper.visible)&&(e.intersectObject(n,!1,t),gz(n,e,t,!0)),i(n))}};return i(this),t}updateEntity2DByOp(e,t,i,r){var n;(n=this.uiCanvas)==null||n.updateEntity2DByOp(e,t,i,r)}},V2e=class extends bk(Ipe,n$){constructor(e,t,i){super(),this.super_Entity(e,t),this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let r=this.shadow.camera;r.fov=90,r.aspect=1,r.near=100,r.far=2500;let n=new B(-r.far+this.position.x,-r.far+this.position.y,-r.far+this.position.z),s=new B(r.far+this.position.x,r.far+this.position.y,r.far+this.position.z),a=new cn(n,s),o=new CA(a,new jt(16755200));o.visible=!1,this.gizmos.shadowmap=o,this.update()}update(){if(this.shadow&&(this.shadow.camera.updateProjectionMatrix(),this.gizmos))for(let e in this.gizmos){let t=this.gizmos[e];if(t instanceof CA){let i=this.shadow.camera,r=new B(-i.far+this.position.x,-i.far+this.position.y,-i.far+this.position.z),n=new B(i.far+this.position.x,i.far+this.position.y,i.far+this.position.z);t.box.set(r,n),t.updateMatrixWorld(!0)}}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.objectHelper&&this.objectHelper.update()}updateState(e,t){this.updateState_Light(e,t),e.distance!==void 0&&(this.distance=e.distance),e.decay!==void 0&&(this.decay=e.decay),e.shadowRadius!==void 0&&(this.shadow.radius=e.shadowRadius),e.shadowResolution!==void 0&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}},H2e=class extends qs{get forceComputeSize(){return!0}get shape(){return this.geometry.userData.shape}updateEntityBoxSize(e,t){let i=this.geometry.getAttribute("position");i!==void 0?ck(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,e,t):super.updateEntityBoxSize(e,t)}},Ck=class extends qs{constructor(e,t,i){super(e,t,i),this._shapeId=null,this._context=i}updateState(e,t){super.updateState(e,t),this.updateShape()}updateShape(){var r;let e={...this.data.geometry.extrusion.shape};for(let n in e)typeof e[n]=="string"&&(e[n]=this._context.shared.getVariable(e[n],[this.uuid,"geometry","extrusion","shape",n]));let t;if(e.type==="Custom"){let n=e.shapeId;if(n!==this._shapeId&&this.detachShape(),n){this._shapeId=n;let s=this._context.scene.find(n);s!=null&&s.data&&(s.attachedPaths.add(this),t=(r=s.geometry.userData)==null?void 0:r.shape),t||this._context.scene.addPendingCommand(()=>this.updateShape())}}else{let n;switch(e.type){case"Rectangle":n=lk;break;case"Ellipse":n=ok;break;case"Polygon":n=iZ;break;case"Star":n=rZ;break;default:throw new Error(`Unknown shape type: ${e.type}`)}t=n.create({parameters:e}).userData.shape}let i=this.geometry;t&&i.inputs&&(i.inputs.shapeData=t,i.build(),this.attachedSurfaceCloners.forEach(n=>n.update()))}detachShape(){var e;this._shapeId!==null&&((e=this._context.scene.find(this._shapeId))==null||e.attachedPaths.delete(this))}createGeometryDelayed(e){this.geometryCreateDeleyed=e.shared,this.updateShape(),this.refreshAttachedPaths(e)}updateTransformState(e,t){return super.updateTransformState(e,t)}updateGeometryInteractions(e,t){super.updateGeometryInteractions(e,t),this.updateShape()}updateEntityBoxSize(e,t){let i=this.geometry.getAttribute("position");i!==void 0?ck(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,e,t):super.updateEntityBoxSize(e,t)}},Tk=class extends wk{constructor(e,t,i){super(e,t,i),this.data=t}},Iv=class extends B0(Qu,Xw){constructor(e,t,i){super(),t.type==="Instance"&&typeof e=="string"&&(t=this.transformAssignData(t,i)),this.super_Entity(e,t),this.objectHelper.update()}get isComponentRoot(){return this.data.type==="Component"&&typeof this.identity=="string"}get isInstanceRoot(){return this.data.type==="Instance"&&typeof this.identity=="string"}transformAssignData(e,t){let i=$A.getComponentData({scene:t.scene.data,shared:t.shared.data},e.component);if(i){let r,n;for(let s of Md.rootOverrideProps)e[s]===void 0?(r===void 0&&(r={...e}),r[s]=i.data[s]):(n===void 0&&(n={}),n[s]=e[s],r===void 0&&(r={...e}),r[s]=Ud.apply(i.data[s],e[s]));return this.overrideData=n,r}else return{...ss.defaultData,...e,...th(ss.defaultData,Md.rootOverrideProps)}}updateByOp(e,t,i,r){let n;if(this.isInstanceRoot&&!r){if(t=this.transformAssignData(t,i),e.type===0&&e.path.length===0&&this.component)for(let s of Md.rootOverrideProps)s in e.props&&e.props[s]===void 0&&(n===void 0&&(n={...e,props:{...e.props}}),n.props[s]=this.component.data[s]);else if(e.type===0&&e.path.length>0&&Md.rootOverrideProps.includes(e.path[0])){let s=e.path[0];n===void 0&&(n={...e,path:[],props:{[s]:t[s]}})}}super.updateByOp(n??e,t,i,r)}updateState(e,t){this.updateState_Entity(e,t)}expandInstanceChildren(e){let t=this.data;if(this.component===void 0){let i=e.scene.find(t.component)??null,r=!1;if(i!==this.oldComponent){if(this.oldComponent){let n=0;for(let s of this.children)if(Pi.is(s))e.scene.disposeAndUnregisterEntityRecursivelyIfNotReregistered(s),Pk(s),n+=1;else break;this.children.splice(0,n)}r=!0}if(i){let n={};y$(e,[this.uuid],t.overrides,this,i,i,0,r,n);for(let s of this.children)if(Pi.is(s)){let a=s.data;a.type==="Empty"&&a.animations&&s.traverseEntity(o=>{let l=o.dataPatched;if(o instanceof qs&&l.bones&&l.boneInverses){let c=o.dataPatched;if(c.bones&&c.boneInverses){let u=c.bones.map(p=>e.scene.find(n[p])),h=c.boneInverses.map(p=>new ht().fromArray(p)),d=new gB(u,h);o.bind(d,o.bindMatrix)}}else o.matrixAutoUpdate=!0})}}this.oldComponent=this.component}}};function Pk(e){if(e.component){let t=e.component.instances.indexOf(e);t>=0&&e.component.instances.splice(t,1);for(let i of e.children)Pi.is(i)&&Pk(i)}}function Gj(e,t,i,r){return e.component===t&&HB(e.identity,r)?e.overrideData===i?2:1:0}function y$(e,t,i,r,n,s,a,o,l){if(a>50)return!1;if(r.component!==n){if(r.component){let u=r.component.instances.indexOf(r);u>=0&&r.component.instances.splice(u,1)}n.instances.find(u=>u===r)||n.instances.push(r),r.component=n}n instanceof Iv&&n.isInstanceRoot&&n.expandInstanceChildren(e);let c=0;for(let u of n.children)if(Pi.is(u)){let h=[...t,...typeof u.identity=="string"?[u.identity]:u.identity],d=YA.resolve(i,h,1);d!=null&&!(d instanceof Cn)&&(Object.setPrototypeOf(d,Cn.prototype),console.error("wrong prototype"));let p=null,f;if(!o){let v=r.children[c];if(p=Pi.is(v)?v:null,p!==null){let g=Gj(p,u,d,h);f=g>=1?p.stateSelection:void 0,g!==2&&(p=null)}if(p===null&&(p=e.scene.findInstance(h)??null,p!==null)){let g=Gj(p,u,d,h);if(f=g>=1?p.stateSelection:void 0,g!==2)p=null;else{let m=p.parent.children.indexOf(p);p.parent.children.splice(m,1),r.children.splice(c,0,p),p.parent===r?m<=c&&console.error("not possible"):(p.parent=r,p.matrixWorldNeedsUpdate=!0,p.resetBBoxNeedsUpdate(),p.updateVisible(),e.pendingDeletes.delete(p))}}}if(p===null){let v=d?Ud.apply(u.data,d):u.data;Wf.is(v.type)&&(v={...v,type:"Empty"}),p=Ad.createEntity(h,v,e),p.overrideData=d,r.add(p),r.children.splice(r.children.length-1,1),r.children.splice(c,0,p),p.updateState(p.data,e),f&&p.changeSelectedState(f,e),e.scene.registerInstanceAndSetUuid(p)}if(p.isBone){let v=p.identity[p.identity.length-1];l[v]=p.uuid}c+=1,y$(e,t,i,p,u,s,a+1,o,l)}if(!o){let u=c;for(;;){let h=r.children[c];if(Pi.is(h))e.pendingDeletes.add(h);else break;c+=1}r.children.splice(u,c-u)}return!0}var G2e=class extends B0(GY,Xw){constructor(e,t){super(),this.super_Entity(e,t),this.objectHelper.update(),this.matrixAutoUpdate=!0}updateState(e,t){this.updateState_Entity(e,t)}},js=class extends qs{constructor(e,t,i){super(e,t,i),this.onBeforeRender=r=>{this.uiCanvas.render(r)},this.uiCanvas=new g$(e+"-canvas",t.geometry.width,t.geometry.height,i),this.uiCanvas.promise.then(()=>{this.applyFrame(this.dataPatched.geometry.frame,i.shared)})}updateByPatchedOpGeometry(e,t,i){super.updateByPatchedOpGeometry(e,t,i),e.type===0&&(e.props.frame!==void 0&&this.applyFrame(e.props.frame,i.shared),(e.props.width!==void 0||e.props.height!==void 0)&&this.applySize(e.props,i.shared))}applySize(e,t){let i=(e==null?void 0:e.width)??this.dataPatched.geometry.width,r=(e==null?void 0:e.height)??this.dataPatched.geometry.height;this.uiCanvas.applySize({width:i,height:r}),this.applyGeometryParametersFromFrame(t)}applyFrame(e,t){this.uiCanvas.applyFrame(e),this.applyGeometryParametersFromFrame(t),this.applyMaterialParametersFromFrame({shared:t})}applyGeometryParametersFromFrame(e){var i;let t=this.frame;t&&(Object.assign(this.data,{geometry:Object.assign(this.data.geometry,{cornerRadius:t.cornerRadius,cornerType:0})}),Object.assign(this.dataPatched,{geometry:Object.assign(this.dataPatched.geometry,{cornerRadius:t.cornerRadius,cornerType:0})}),(i=this.localGeometry)==null||i.dispose(),this.localGeometry=Z1(this.dataPatched.geometry,e,this.data.flatShading,this))}applyMaterialParametersFromFrame(e){let t=this.frame;if(t){let i=t.data.backgroundBlur;Object.assign(this.data.material.layers[0].data.texture,{image:this.uiCanvas.uuid}),Object.assign(this.data.material.layers[1].data,{roughness:i.radius,alpha:i.enabled?1:0}),Object.assign(this.dataPatched.material.layers[0].data.texture,{image:this.uiCanvas.uuid}),Object.assign(this.dataPatched.material.layers[1].data,{roughness:i.radius,alpha:i.enabled?1:0}),this.material.reset(this.dataPatched.material,e,!0)}}updateEntity2DByOp(e,t,i,r){this.uiCanvas.updateEntity2DByOp(e,t,i,r),e===this.frameId&&t.type===0&&(t.props.cornerRadius!==void 0?this.applyGeometryParametersFromFrame(r):hr(t.path,["backgroundBlur"])&&this.applyMaterialParametersFromFrame({shared:r}))}get frame(){return this.uiCanvas.frame}get frameId(){var e;return(e=this.frame)==null?void 0:e.uuid}removeInteractionGeometry(e){super.removeInteractionGeometry(e),this.applySize({},e)}updateGeometryInteractions(e,t){super.updateGeometryInteractions(e,t),this.applySize({width:e.width,height:e.height},t)}},j2e=class{constructor(e,t,i){this.variables=[],this.currentTextureIndex=0;let r=Sn,n=new Uc,s=new tm;s.position.z=1;let a={passThruTexture:{value:null}},o=u(d(),a),l=new zr(new hh(2,2),o);n.add(l),this.setDataType=function(p){return r=p,this},this.addVariable=function(p,f,v){let g=this.createShaderMaterial(f),m={name:p,initialValueTexture:v,material:g,dependencies:null,renderTargets:[],wrapS:null,wrapT:null,minFilter:Qi,magFilter:Qi};return this.variables.push(m),m},this.setVariableDependencies=function(p,f){p.dependencies=f},this.init=function(){if(i.capabilities.isWebGL2===!1&&i.extensions.has("OES_texture_float")===!1)return"No OES_texture_float support for float textures.";if(i.capabilities.maxVertexTextures===0)return"No support for vertex shader textures.";for(let p=0;p<this.variables.length;p++){let f=this.variables[p];f.renderTargets[0]=this.createRenderTarget(e,t,f.wrapS,f.wrapT,f.minFilter,f.magFilter),f.renderTargets[1]=this.createRenderTarget(e,t,f.wrapS,f.wrapT,f.minFilter,f.magFilter),this.renderTexture(f.initialValueTexture,f.renderTargets[0]),this.renderTexture(f.initialValueTexture,f.renderTargets[1]);let v=f.material,g=v.uniforms;if(f.dependencies!==null)for(let m=0;m<f.dependencies.length;m++){let x=f.dependencies[m];if(x.name!==f.name){let w=!1;for(let _=0;_<this.variables.length;_++)if(x.name===this.variables[_].name){w=!0;break}if(!w)return"Variable dependency not found. Variable="+f.name+", dependency="+x.name}g[x.name]={value:null},v.fragmentShader=`
uniform sampler2D `+x.name+`;
`+v.fragmentShader}}return this.currentTextureIndex=0,null},this.compute=function(){let p=this.currentTextureIndex,f=this.currentTextureIndex===0?1:0;for(let v=0,g=this.variables.length;v<g;v++){let m=this.variables[v];if(m.dependencies!==null){let x=m.material.uniforms;for(let w=0,_=m.dependencies.length;w<_;w++){let M=m.dependencies[w];x[M.name].value=M.renderTargets[p].texture}}this.doRenderTarget(m.material,m.renderTargets[f])}this.currentTextureIndex=f},this.getCurrentRenderTarget=function(p){return p.renderTargets[this.currentTextureIndex]},this.getAlternateRenderTarget=function(p){return p.renderTargets[this.currentTextureIndex===0?1:0]},this.dispose=function(){l.geometry.dispose(),l.material.dispose();let p=this.variables;for(let f=0;f<p.length;f++){let v=p[f];v.initialValueTexture&&v.initialValueTexture.dispose();let g=v.renderTargets;for(let m=0;m<g.length;m++)g[m].dispose()}};function c(p){p.defines.resolution="vec2( "+e.toFixed(1)+", "+t.toFixed(1)+" )"}this.addResolutionDefine=c;function u(p,f){f=f||{};let v=new Ui({uniforms:f,vertexShader:h(),fragmentShader:p});return c(v),v}this.createShaderMaterial=u,this.createRenderTarget=function(p,f,v,g,m,x){return p=p||e,f=f||t,v=v||Ar,g=g||Ar,m=m||Qi,x=x||Qi,new Wi(p,f,{wrapS:v,wrapT:g,minFilter:m,magFilter:x,format:is,type:r,depthBuffer:!1})},this.createTexture=function(){let p=new Float32Array(e*t*4),f=new Yo(p,e,t,is,Sn);return f.needsUpdate=!0,f},this.renderTexture=function(p,f){a.passThruTexture.value=p,this.doRenderTarget(o,f),a.passThruTexture.value=null},this.doRenderTarget=function(p,f){let v=i.getRenderTarget(),g=i.xr.enabled,m=i.shadowMap.autoUpdate,x=i.outputEncoding,w=i.toneMapping;i.xr.enabled=!1,i.shadowMap.autoUpdate=!1,i.outputEncoding=Vl,i.toneMapping=kc,l.material=p,i.setRenderTarget(f),i.render(n,s),l.material=o,i.xr.enabled=g,i.shadowMap.autoUpdate=m,i.outputEncoding=x,i.toneMapping=w,i.setRenderTarget(v)};function h(){return`void main()	{

	gl_Position = vec4( position, 1.0 );

}
`}function d(){return`uniform sampler2D passThruTexture;

void main() {

	vec2 uv = gl_FragCoord.xy / resolution.xy;

	gl_FragColor = texture2D( passThruTexture, uv );

}
`}}},ps=new ws,kS=new B,W2e=class{constructor(e){let t=e.geometry;if(!t.isBufferGeometry||t.attributes.position.itemSize!==3)throw new Error("THREE.MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");t.index&&(console.warn("THREE.MeshSurfaceSampler: Converting geometry to non-indexed BufferGeometry."),t=t.toNonIndexed()),this.geometry=t,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.colorAttribute=this.geometry.getAttribute("color"),this.weightAttribute=null,this.distribution=null}setWeightAttribute(e){return this.weightAttribute=e?this.geometry.getAttribute(e):null,this}build(){let e=this.positionAttribute,t=this.weightAttribute,i=new Float32Array(e.count/3);for(let n=0;n<e.count;n+=3){let s=1;t&&(s=t.getX(n)+t.getX(n+1)+t.getX(n+2)),ps.a.fromBufferAttribute(e,n),ps.b.fromBufferAttribute(e,n+1),ps.c.fromBufferAttribute(e,n+2),s*=ps.getArea(),i[n/3]=s}this.distribution=new Float32Array(e.count/3);let r=0;for(let n=0;n<i.length;n++)r+=i[n],this.distribution[n]=r;return this}setRandomGenerator(e){return this.randomFunction=e,this}sample(e,t,i){let r=this.distribution[this.distribution.length-1],n=this.binarySearch(this.randomFunction()*r);return this.sampleFace(n,e,t,i)}binarySearch(e){let t=this.distribution,i=0,r=t.length-1,n=-1;for(;i<=r;){let s=Math.ceil((i+r)/2);if(s===0||t[s-1]<=e&&t[s]>e){n=s;break}else e<t[s]?r=s-1:i=s+1}return n}sampleFace(e,t,i,r){let n=this.randomFunction(),s=this.randomFunction();return n+s>1&&(n=1-n,s=1-s),ps.a.fromBufferAttribute(this.positionAttribute,e*3),ps.b.fromBufferAttribute(this.positionAttribute,e*3+1),ps.c.fromBufferAttribute(this.positionAttribute,e*3+2),t.set(0,0,0).addScaledVector(ps.a,n).addScaledVector(ps.b,s).addScaledVector(ps.c,1-(n+s)),i!==void 0&&ps.getNormal(i),r!==void 0&&this.colorAttribute!==void 0&&(ps.a.fromBufferAttribute(this.colorAttribute,e*3),ps.b.fromBufferAttribute(this.colorAttribute,e*3+1),ps.c.fromBufferAttribute(this.colorAttribute,e*3+2),kS.set(0,0,0).addScaledVector(ps.a,n).addScaledVector(ps.b,s).addScaledVector(ps.c,1-(n+s)),r.r=kS.x,r.g=kS.y,r.b=kS.z),this}};function X2e(e){let t=new Float32Array(e*e*2);for(let i=0;i<e;i++)for(let r=0;r<e;r++){let n=i*e+r;t[n*2+0]=i/(e-1),t[n*2+1]=r/(e-1)}return t}function q2e(e){let t=Math.ceil(Math.sqrt(e));return Math.max(t,1)}function Y2e(e,t){let i=new zr(e.geometry,e.material),r=[],n=[],s=new B,a=new B;i.geometry.index!==null&&(i.geometry=i.geometry.toNonIndexed());let o=new W2e(i).build();for(let u=0;u<t;u++)o.sample(s,a),r.push(s.x,s.y,s.z),n.push(a.x,a.y,a.z);let l=new Float32Array(r),c=new Float32Array(n);return{positions:l,normals:c}}function jj(e,t){let i=e,r=new Float32Array(4*t*t);for(let s=0;s<t*t;s++)r[4*s]=i[3*s],r[4*s+1]=i[3*s+1],r[4*s+2]=i[3*s+2],r[4*s+3]=0;let n=new Yo(r,t,t,is,Sn);return n.needsUpdate=!0,n}function Q2e({size:e}){let t=new Float32Array(4*e*e);for(let r=0;r<e*e;r++)t[4*r]=r,t[4*r+1]=0,t[4*r+2]=0,t[4*r+3]=0;let i=new Yo(t,e,e,is,Sn);return i.needsUpdate=!0,i}function K2e(e){let t=new Float32Array(4*e*e);for(let r=0;r<e*e;r++)t[4*r]=0,t[4*r+1]=0,t[4*r+2]=0,t[4*r+3]=0;let i=new Yo(t,e,e,is,Sn);return i.needsUpdate=!0,i}var Z2e=`
// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU
uniform sampler2D uOriginalPosition;
uniform float uTime;
uniform float uSpeed;     // update speed of the particles
uniform vec3 uWorldOffset;    
uniform vec4 uWorldQuaternion;
uniform float uMaxLifeTime;
uniform vec3 uEmitterSize;
uniform float uFPSRatio;     // 1  for 60 FPS

float random (vec2 st) {
    return fract(sin(dot(st.xy,
        vec2(12.9898,78.233)))*
        43758.5453123);
}
vec3 applyQuaternionToVector( vec4 q, vec3 v ){
    return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );
}

vec3 applyForce(vec3 force, float mass) {
    vec3 acceleration = force / mass;
    
    return acceleration;
  }
  

void main() {
    vec2 vUv = gl_FragCoord.xy / resolution.xy;
    vec3 position = texture2D( uCurrentPosition, vUv ).xyz;
    float currentLife = texture2D( uCurrentPosition, vUv ).w;   // from 1 to 0
    float isSpawning = texture2D( uCurrentEmissionRate, vUv ).r;        // 1. = spawning, 0. = not spawning
    float isActive = texture2D( uCurrentEmissionRate, vUv ).g;          // 1. = active, 0. = not active
    float timeStart = texture2D( uCurrentEmissionRate, vUv ).b;         // timeStart in seconds when the particle was emitted
    vec3 originalPosition = ((texture2D( uOriginalPosition, vUv ).xyz) * uEmitterSize);
    vec3 velocity = texture2D( uCurrentVelocity, vUv ).xyz;
    float collisionFlag = texture2D( uCurrentVelocity, vUv ).w;             // 1. = collided, 0. = not collided
    float lifeTime = uMaxLifeTime;

    // Calculate the position adjustment based on collision
    //     if (collisionFlag > .5) {  
    float isColliding = step(0.5, collisionFlag); // 1.0 if collisionFlag > 0.5, otherwise 0.0
    float bounceOffset = 3.0 * isColliding; // Becomes 3.0 if colliding, 0.0 otherwise
    vec3 collisionAdjustedVelocity = velocity * (1.0 + bounceOffset);

    // Update position based on collision or normal movement
    vec3 fpsVelocity = velocity * min(uFPSRatio, 5.0);
    position += mix(fpsVelocity, collisionAdjustedVelocity, isColliding);

    // EMISSION RATE - BIRTH
    // if (isSpawning == 1.0) {
    // Better Approach to avoid If statement
    vec3 newPosition = applyQuaternionToVector(uWorldQuaternion, originalPosition) + uWorldOffset;
    originalPosition = mix(originalPosition, newPosition, isSpawning);
    position = mix(position, originalPosition, isSpawning);;
    timeStart = mix(timeStart, uTime, isSpawning);

    // Calculate timeLeft for life normalization
    float timeLeft = max(lifeTime - (uTime - timeStart), 0.0);
    float life_Normalize = timeLeft / lifeTime;

    // Use isActive to blend between the calculated color and black
    vec4 activeColor = vec4(position, life_Normalize);
    // if (isActive == 1.0) {
    gl_FragColor = mix(vec4(0.0), activeColor, isActive);

}
`,$2e=`

    vec3 mod289(vec3 x) {
      return x - floor(x * (1.0 / 289.0)) * 289.0;
    }
    
    vec4 mod289(vec4 x) {
    return x - floor(x * (1.0 / 289.0)) * 289.0;
    }
    
    vec4 permute(vec4 x) {
        return mod289(((x*34.0)+1.0)*x);
    }
    
    vec4 taylorInvSqrt(vec4 r)
    {
    return 1.79284291400159 - 0.85373472095314 * r;
    }
    
    vec3 fade(vec3 t) {
  return t*t*t*(t*(t*6.0-15.0)+10.0);
}

    float snoise(vec3 v)
    {
    const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;
    const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);
    vec3 i  = floor(v + dot(v, C.yyy) );
    vec3 x0 =   v - i + dot(i, C.xxx) ;
    vec3 g = step(x0.yzx, x0.xyz);
    vec3 l = 1.0 - g;
    vec3 i1 = min( g.xyz, l.zxy );
    vec3 i2 = max( g.xyz, l.zxy );
    vec3 x1 = x0 - i1 + C.xxx;
    vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y
    vec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y
    
    // Permutations
    i = mod289(i);
    vec4 p = permute( permute( permute(
                i.z + vec4(0.0, i1.z, i2.z, 1.0 ))
              + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))
              + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));
    
    // Gradients: 7x7 points over a square, mapped onto an octahedron.
    // The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)
    float n_ = 0.142857142857; // 1.0/7.0
    vec3  ns = n_ * D.wyz - D.xzx;
    
    vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)
    
    vec4 x_ = floor(j * ns.z);
    vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)
    
    vec4 x = x_ *ns.x + ns.yyyy;
    vec4 y = y_ *ns.x + ns.yyyy;
    vec4 h = 1.0 - abs(x) - abs(y);
    
    vec4 b0 = vec4( x.xy, y.xy );
    vec4 b1 = vec4( x.zw, y.zw );
    
    vec4 s0 = floor(b0)*2.0 + 1.0;
    vec4 s1 = floor(b1)*2.0 + 1.0;
    vec4 sh = -step(h, vec4(0.0));
    
    vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;
    vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;
    
    vec3 p0 = vec3(a0.xy,h.x);
    vec3 p1 = vec3(a0.zw,h.y);
    vec3 p2 = vec3(a1.xy,h.z);
    vec3 p3 = vec3(a1.zw,h.w);
    
    //Normalise gradients
    vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));
    p0 *= norm.x;
    p1 *= norm.y;
    p2 *= norm.z;
    p3 *= norm.w;
    
    // Mix final noise value
    vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
    m = m * m;
    return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),
                                  dot(p2,x2), dot(p3,x3) ) );
    }
    
    vec3 snoiseVec3( vec3 x ){
    
      float s  = snoise(vec3( x ));
      float s1 = snoise(vec3( x.y - 19.1 , x.z + 33.4 , x.x + 47.2 ));
      float s2 = snoise(vec3( x.z + 74.2 , x.x - 124.5 , x.y + 99.4 ));
      vec3 c = vec3( s , s1 , s2 );
      return c;
    
    }
    
      
    vec3 curlNoise( vec3 p, float seed){
      p += seed;
      const float e = .1;
      vec3 dx = vec3( e   , 0.0 , 0.0 );
      vec3 dy = vec3( 0.0 , e   , 0.0 );
      vec3 dz = vec3( 0.0 , 0.0 , e   );
    
      vec3 p_x0 = snoiseVec3( p - dx );
      vec3 p_x1 = snoiseVec3( p + dx );
      vec3 p_y0 = snoiseVec3( p - dy );
      vec3 p_y1 = snoiseVec3( p + dy );
      vec3 p_z0 = snoiseVec3( p - dz );
      vec3 p_z1 = snoiseVec3( p + dz );
    
      float x = p_y1.z - p_y0.z - p_z1.y + p_z0.y;
      float y = p_z1.x - p_z0.x - p_x1.z + p_x0.z;
      float z = p_x1.y - p_x0.y - p_y1.x + p_y0.x;
    
      const float divisor = 1.0 / ( 2.0 * e );
      return normalize( vec3( x , y , z ) * divisor );
    
    }


// Classic Perlin noise
float cnoise(vec3 P)
{
  vec3 Pi0 = floor(P); // Integer part for indexing
  vec3 Pi1 = Pi0 + vec3(1.0); // Integer part + 1
  Pi0 = mod289(Pi0);
  Pi1 = mod289(Pi1);
  vec3 Pf0 = fract(P); // Fractional part for interpolation
  vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0
  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);
  vec4 iy = vec4(Pi0.yy, Pi1.yy);
  vec4 iz0 = Pi0.zzzz;
  vec4 iz1 = Pi1.zzzz;

  vec4 ixy = permute(permute(ix) + iy);
  vec4 ixy0 = permute(ixy + iz0);
  vec4 ixy1 = permute(ixy + iz1);

  vec4 gx0 = ixy0 * (1.0 / 7.0);
  vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;
  gx0 = fract(gx0);
  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);
  vec4 sz0 = step(gz0, vec4(0.0));
  gx0 -= sz0 * (step(0.0, gx0) - 0.5);
  gy0 -= sz0 * (step(0.0, gy0) - 0.5);

  vec4 gx1 = ixy1 * (1.0 / 7.0);
  vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;
  gx1 = fract(gx1);
  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);
  vec4 sz1 = step(gz1, vec4(0.0));
  gx1 -= sz1 * (step(0.0, gx1) - 0.5);
  gy1 -= sz1 * (step(0.0, gy1) - 0.5);

  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);
  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);
  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);
  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);
  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);
  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);
  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);
  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);

  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));
  g000 *= norm0.x;
  g010 *= norm0.y;
  g100 *= norm0.z;
  g110 *= norm0.w;
  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));
  g001 *= norm1.x;
  g011 *= norm1.y;
  g101 *= norm1.z;
  g111 *= norm1.w;

  float n000 = dot(g000, Pf0);
  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));
  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));
  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));
  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));
  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));
  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));
  float n111 = dot(g111, Pf1);

  vec3 fade_xyz = fade(Pf0);
  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);
  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);
  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); 
  return 2.2 * n_xyz;
}


vec3 fbm_vec3(vec3 p, float frequency, float offset)
{
  return vec3(
    cnoise((p+vec3(offset))*frequency),
    cnoise((p+vec3(offset+20.0))*frequency),
    cnoise((p+vec3(offset-30.0))*frequency)
  );
}

`,J2e=`
  #ifdef USE_COLLIDER
    float restitution = max(uBounce * 2., .01); // Energy Loss
    // SPHERE COLLIDER
    // **************************************************************
    #ifdef USE_SPHERE_COLLIDER       
      // Convert collider size to radii (assuming uColliderSize is the diameter in each axis)
      vec3 radii = uColliderSize;
      // Adjust position relative to collider
      vec3 relPos = position - uColliderPos;
      // Apply rotation of the collider to the relative position
      relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            
      // Scale relative position by radii (for ellipsoid collision detection)
      vec3 scaledPos = relPos / radii;
      // Calculate ellipsoidal distance
      float dist = length(scaledPos); // Distance in terms of ellipsoid
      
      // Check for collision
      if (dist <= 1. + particleSize / length(radii) && collisionFlag == 0.0) {
          // Compute the normal at the collision point, accounting for particle size
        vec3 adjustedPos = scaledPos * (1.0 + particleSize / length(radii));          
        // Compute the normal at the collision point
        vec3 normal = ellipsoidNormal(adjustedPos, radii);
        // Rotate the normal back to world space
        normal = applyQuaternionToVector(uColliderQuaternion, normal);
        // Reflect the velocity vector off the normal
        velocity = reflect(velocity, normal) * restitution;

        collisionFlag = 1.0;
      } else {
        collisionFlag = 0.0;
      }
    #endif

    // BOX COLLIDER or PLANE COLLIDER 
    // **************************************************************
    #ifdef USE_BOX_COLLIDER
      // Box dimensions and repulsion variables
      vec3 boxHalfSize = uColliderSize / 2.0;
      // Convert world position to box's local space
      vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      
      // Collision detection
      vec3 localDistance = abs(localPos) - boxHalfSize;
      float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));    

      // Collision Detected
      if (distToSurface <= particleSize * 0.5 && collisionFlag == 0.0) {      
        // Find the nearest face normal for bounce direction
        vec3 normal;
        if (localDistance.x > localDistance.y && localDistance.x > localDistance.z) {
            normal = vec3(sign(localPos.x), 0.0, 0.0);
        } else if (localDistance.y > localDistance.z) {
            normal = vec3(0.0, sign(localPos.y), 0.0);
        } else {
            normal = vec3(0.0, 0.0, sign(localPos.z));
        }            
        // Rotate normal back to world space
        normal = applyQuaternionToVector(uColliderQuaternion, normal);      
        // Reflect velocity and apply repulsion force
        velocity = reflect(velocity, normal) * restitution;
        
        collisionFlag = 1.0;
      } else {
        collisionFlag = 0.0;
      }
    #endif      
  #endif      
  // END COLLIDER    
`,ePe=`
  #ifdef USE_ATTRACTOR

      #ifdef USE_SPHERE_COLLIDER      
        // Convert collider size to radii (assuming uColliderSize is the diameter in each axis)
        vec3 radii = uColliderSize;
        // Adjust position relative to collider
        vec3 relPos = position - uColliderPos;
        // Apply rotation of the collider to the relative position
        relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            
        // Scale relative position by radii (for ellipsoid collision detection)
        vec3 scaledPos = relPos / radii;
        // Calculate ellipsoidal distance
        float distToSurface = length(scaledPos); // Distance in terms of ellipsoid
        float insideCheck = 1.0;

      #endif


      #ifdef USE_BOX_COLLIDER
        // Box dimensions
        vec3 boxHalfSize = uColliderSize / 2.0;
        // Convert world position to box's local space
        vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      
        vec3 localDistance = abs(localPos) - boxHalfSize;
        float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));
        float insideCheck = particleSize;
      #endif      
  
      // Apply vortex force inside the Helper
      #ifdef USE_FORCE_LOCAL_SPACE
        if (distToSurface <= insideCheck ) {    
            // Define parameters for the attractor field
            #ifdef USE_SPHERE_COLLIDER      
              float attractorStrength = (1.0 - distToSurface ) * uForceIntensity; // Adjust as needed
            #endif

            #ifdef USE_BOX_COLLIDER
              float attractorStrength = max((1.0 - insideCheck / distToSurface), 0.) * uForceIntensity; // Adjust as needed
              #endif

            float attractorDamping = uForceDamping;  // Adjust as needed (higher values will attenuate velocity more)
          
            // Use the same radii calculation code as for the collider
            vec3 attractorRadii = uColliderSize;
            // Adjust position relative to attractor center
            vec3 relPos = position - uColliderPos;
            // Apply rotation of the collider to the relative position
            relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            
            // Scale relative position by radii (for ellipsoid attraction)
            vec3 scaledPos = relPos / attractorRadii;

            // Calculate ellipsoidal distance as attractor radius
            float attractorRadius = length(scaledPos);
            // Calculate the distance from the attractor center
            vec3 relativePosition = position - uColliderPos;
            // Calculate the force vector towards the attractor center
            vec3 attractorForce = normalize(relativePosition) * attractorStrength;
            // Apply the attractor force to the particle
            velocity -= attractorForce;
            // Attenuate the particle's velocity
            velocity *= attractorDamping;
        }
      #else 
            // Calculate the distance from the attractor center
            vec3 relativePosition = position - uColliderPos;
            // Calculate the force vector towards the attractor center
            vec3 attractorForce = normalize(relativePosition) * uForceIntensity;
            // Apply the attractor force to the particle
            velocity -= attractorForce;
            // Attenuate the particle's velocity
            velocity *= uForceDamping;
      #endif    
  #endif      
`,tPe=`
  #ifdef USE_VORTEX
    // Box dimensions
    vec3 boxHalfSize = uColliderSize / 2.0;
    // Convert world position to box's local space
    vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      
    vec3 localDistance = abs(localPos) - boxHalfSize;
    float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));

    // Apply vortex force inside the box
    if (distToSurface <= particleSize) {
      float vortexStrength = uForceIntensity;
      vec3 localTopCenter = vec3(0.0, 0., 0.0);

      // Transform the local top center to the world space
      vec3 vortexCenter = uColliderPos + applyQuaternionToVector(uColliderQuaternion, localTopCenter);
      // Calculate the vector from particle to vortex center
      vec3 vortexVector = vortexCenter - position;

      // Calculate the rotation axis from the inverse of the collider's quaternion and the fixed up vector
      // Note: important to add a tiny z component to the up vector to avoid instability
      vec3 upVector = vec3(0.0, 1.0, 0.01);
      vec3 rotationAxis = cross(upVector, applyQuaternionToVector(uColliderQuaternion, vortexVector));
      rotationAxis = normalize(rotationAxis);

      // Add rotational component to velocity
      float rotationSpeed = length(vortexVector * vortexStrength * 3.0) ; 

      vec3 rotationVelocity = rotationAxis * rotationSpeed;
      // velocity += rotationVelocity * 0.005 ;
      velocity = rotationVelocity * 0.005 ;

      // Calculate vortex force
      // vec3 vortexForce = normalize(vortexVector) * uSpeed * .1 ;
      // Apply the vortex force to the particle
      vec3 originDirection = applyQuaternionToVector(uWorldQuaternion, directions);
      velocity += applyForce( originDirection * uSpeed * (1. - uForceDamping) , mass * .5);
    }
  #endif      
`,iPe=`
// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU
uniform sampler2D uOriginalPosition;
uniform sampler2D uDirections;     
uniform vec3 uDirectionsAxis;
uniform vec4 uWorldQuaternion;
uniform vec3 uGravity;        
uniform float uNoiseStrength;     // Variation of the noise
uniform float uNoiseScale;        // Scale of the noise
uniform float uNoiseSeed;         // Seed of the noise
uniform float particleSize;
uniform float uSpeed;     // update speed of the particles
uniform float uRandomMassFactor;

// COLLIDER
uniform vec3 uColliderPos;                // Collider Position
uniform vec3 uColliderSize;               // Collider Dimension
uniform vec4 uColliderQuaternion;         // Collider Rotation
uniform vec4 uColliderQuaternionInvert;   // Collider Rotation
uniform float uBounce;                    // Bounce factor
uniform float uForceDamping;
uniform float uForceIntensity;


`+$2e+`
float rand(vec2 co){
    return fract(sin(dot(co, vec2(12.9898, 78.233))) * 43758.5453);
}
vec3 applyQuaternionToVector( vec4 q, vec3 v ){
    return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );
 } 
vec3 applyForce(vec3 force, float mass) {
  vec3 acceleration = force / mass;
  
  return acceleration;
}

vec4 conjugate(vec4 q) {
  return vec4(q.w, -q.x, -q.y, -q.z);
}

// Function to compute the normal of the ellipsoid at a given point
vec3 ellipsoidNormal(vec3 p, vec3 radii) {
  return normalize(p / (radii * radii));
}

float friction = .3;

void main() {
    vec2 vUv = gl_FragCoord.xy / resolution.xy;
    vec3 position = texture2D( uCurrentPosition, vUv ).xyz;
    vec3 originalPosition = texture2D( uOriginalPosition, vUv ).xyz;
    float timeLeft = texture2D( uCurrentPosition, vUv ).w;
    vec3 directions = texture2D( uDirections, vUv ).xyz;    
    vec3 velocity = texture2D( uCurrentVelocity, vUv ).xyz;
    float mass = rand(originalPosition.xy) * 0.5 + 0.5;
    float isSpawning = texture2D( uCurrentEmissionRate, vUv ).x;        // 1. = spawning, 0. = not spawning
    float isActive = texture2D( uCurrentEmissionRate, vUv ).y;          // 1. = active, 0. = not active
    float collisionFlag =texture2D( uCurrentVelocity, vUv ).w;          // Indicate collision

    // Randomness Mass
    mass = (1.0 - (uRandomMassFactor * mass));
    
    if (isActive == 1.0) {
      // **************************************************************
      // FORCES NOISES
      // **************************************************************
      #ifdef USE_CURL_NOISE
        if (uNoiseScale > 0.0 ) {
          velocity = curlNoise(position * uNoiseScale * .002, uNoiseSeed) * ( uNoiseStrength + 1.0) * .05 * uSpeed;
        }
        // Variation of the noise Over Time
        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0 ) {
          velocity += curlNoise( position, uNoiseSeed)  * uNoiseStrength * 0.05 * uSpeed;
        }
      #endif
      // **************************************************************
      #ifdef USE_SIMPLEX_NOISE
        if (uNoiseScale > 0.0 ) {
          velocity = vec3(snoise(position * uNoiseScale * .001) * ( uNoiseStrength + 1.0) * .1);
          velocity *= uSpeed;
        }
        // Variation of the noise Over Time
        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0) {
          velocity += vec3(snoise(position * uNoiseStrength * .001) * .05 * uSpeed);
        }
      #endif
      // ************************************************************** 
      #ifdef USE_FBM_NOISE
        if (uNoiseScale > 0.0 ) {
          velocity = fbm_vec3(position * uNoiseScale * .001, ( uNoiseStrength + 1.0), uNoiseSeed);
          velocity *= uSpeed;
        }
        // Variation of the noise Over Time
        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0 ) {      
          velocity += fbm_vec3(position * uNoiseStrength * .001, ( uNoiseStrength + 1.0), uNoiseSeed) * .1 * uSpeed;
        }
      #endif

      // COLLIDER
      ${J2e}
      // ATTRACTION
      ${ePe}  
      // VORTEX
      ${tPe}
    } 
    // End isActive

    // SPAWN BIRTH 
    // **************************************************************
    // if (isSpawning == 1.)
    #ifdef USE_NORMALS
      velocity = mix(velocity, applyQuaternionToVector(uWorldQuaternion, directions) * uSpeed, isSpawning);
    #else
      velocity = mix(velocity, applyQuaternionToVector(uWorldQuaternion, uDirectionsAxis) * uSpeed, isSpawning);    
    #endif
    
    // if (collisionFlag == 0.0)
    velocity += applyForce(uGravity, mass * .5) * (1.0 - collisionFlag);

    gl_FragColor = vec4(velocity, collisionFlag);
}
`,x$=`

  // Linear Fade In
  float linearFadeIn(float t) {
    return t;
  }


  // linear fade out
  float linearFadeOut(float t) {
    return 1.0 - t;
  }
  
  float linearInOut(float t) {
    return t < 0.5 ? t :  (1.0 - t);  
  }

    // lerp
    float lerp(float a, float b, float t) {
      return a + (b - a) * t;
    }

  // Ease In Out Quart
  float exponentialInOut(float t) {
    return t < 0.4 ? lerp(0.0, 1.0, t / 0.4) :
    t > 0.6 ? lerp(1.0, 0.0, (t - 0.6) / 0.4) :
    1.0;
   }

  // constant
  float constant(float t) {
    return 1.0;
  } 
`,rPe=`

float rand(vec3 co){
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

vec3 applyQuaternionToVector( vec4 q, vec3 v ){
  return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );
}

vec3 applyForce(vec3 force, float mass) {
  vec3 acceleration = force / mass;
    
  return acceleration;
}
`,nPe=`
vec3 rgb2xyz (in vec3 rgb) {
    float r = rgb.r;
	float g = rgb.g;
	float b = rgb.b;

	r = r > 0.04045 ? pow(((r + 0.055) / 1.055), 2.4) : (r / 12.92);
	g = g > 0.04045 ? pow(((g + 0.055) / 1.055), 2.4) : (g / 12.92);
	b = b > 0.04045 ? pow(((b + 0.055) / 1.055), 2.4) : (b / 12.92);

	float x = (r * 0.4124) + (g * 0.3576) + (b * 0.1805);
	float y = (r * 0.2126) + (g * 0.7152) + (b * 0.0722);
	float z = (r * 0.0193) + (g * 0.1192) + (b * 0.9505);
    
    vec3 xyz = vec3(
        (r * 0.4124) + (g * 0.3576) + (b * 0.1805) * 100.0,
        (r * 0.2126) + (g * 0.7152) + (b * 0.0722) * 100.0,
        (r * 0.0193) + (g * 0.1192) + (b * 0.9505) * 100.0
    );
    return(xyz);
}

vec3 xyz2lab (in vec3 xyz) {
	float x = xyz.x / 95.047;
	float y = xyz.y / 100.0;
	float z = xyz.z / 108.883;

	x = x > 0.008856 ? pow(x, 1.0 / 3.0) : (7.787 * x) + (16.0 / 116.0);
	y = y > 0.008856 ? pow(y, 1.0 / 3.0) : (7.787 * y) + (16.0 / 116.0);
	z = z > 0.008856 ? pow(z, 1.0 / 3.0) : (7.787 * z) + (16.0 / 116.0);

    vec3 lab = vec3((116.0 * y) - 16.0, 500.0 * (x - y), 200.0 * (y - z));
    return(lab);
}

vec3 rgb2lab(in vec3 rgb) {
    vec3 xyz = rgb2xyz(rgb);
    vec3 lab = xyz2lab(xyz);
    return(lab);
}

vec3 xyz2rgb (in vec3 xyz) {
	float x = xyz.x / 100.0;
	float y = xyz.y / 100.0;
	float z = xyz.z / 100.0;
	
    
	float r = (x *  3.2406) + (y * -1.5372) + (z * -0.4986);
	float g = (x * -0.9689) + (y *  1.8758) + (z *  0.0415);
	float b = (x *  0.0557) + (y * -0.2040) + (z *  1.0570);

	r = r > 0.0031308 ? ((1.055 * pow(r, 1.0 / 2.4)) - 0.055) : r * 12.92;
	g = g > 0.0031308 ? ((1.055 * pow(g, 1.0 / 2.4)) - 0.055) : g * 12.92;
	b = b > 0.0031308 ? ((1.055 * pow(b, 1.0 / 2.4)) - 0.055) : b * 12.92;

	r = min(max(0.0, r), 1.0);
	g = min(max(0.0, g), 1.0);
	b = min(max(0.0, b), 1.0);

	return(vec3(r, g, b));
}

vec3 lab2xyz (in vec3 lab) {
    float l = lab.x;
	float a = lab.y;
	float b = lab.z;

  	float y = (l + 16.0) / 116.0;
	float x = a / 500.0 + y;
	float z = y - b / 200.0;

	float y2 = pow(y, 3.0);
	float x2 = pow(x, 3.0);
	float z2 = pow(z, 3.0);

  	y = y2 > 0.008856 ? y2 : (y - 16.0 / 116.0) / 7.787;
	x = x2 > 0.008856 ? x2 : (x - 16.0 / 116.0) / 7.787;
	z = z2 > 0.008856 ? z2 : (z - 16.0 / 116.0) / 7.787;

	x *= 95.047;
	y *= 100.0;
	z *= 108.883;

	return(vec3(x, y, z));
}
vec3 lab2rgb (in vec3 lab) {
    vec3 xyz = lab2xyz(lab);
    vec3 rgb = xyz2rgb(xyz);
    return(rgb);
}

`,sPe=`
  uniform sampler2D uPosition;
  uniform float uSize;
  uniform float uSizeEnd;
  uniform vec3 uWorldOffset;
  uniform vec4 uWorldQuaternion;
  // Billboard Behavior - Currently at Zero, but we can change that
  uniform float uRotation;
  uniform float uRotationEnd;
  uniform vec2 center;

  // Randomness
  uniform float uRandScaleFactor;
  uniform float uRandRotationFactor;

  attribute vec2 ref;

  varying float v_LifeLeft;    // normalized lifetime 1 to 0
  varying vec2 vUv;
  varying vec2 vRef;

  ${rPe}
  ${x$}
`,aPe=({easeSize:e="linearFadeOut"})=>`
  vUv = uv;  
  vRef = ref;
  // Normalized LifeTime 1 to 0
  float lifeLeft = texture2D(uPosition, ref).w;
  v_LifeLeft = lifeLeft;
  // Position From DataTexture Simulation
  vec3 pos = texture2D(uPosition, ref).rgb - uWorldOffset;
  // Apply World Quaternion
  pos = applyQuaternionToVector(uWorldQuaternion, pos);  
            
  #ifdef  USE_SIZE_END
    // Scaled Over Time
    float t = 1. - lifeLeft;
    float currentSize = mix(uSize, uSizeEnd, t); // Linearly interpolate between uSize and uSizeEnd
    vec3 scaledPosition = position * vec3(currentSize);
  #else
    // Change Size Behavior over LifeTime
    float easeSize = ${e}(1. - lifeLeft);
    // Scaled Over Time
    vec3 scaledPosition = position * vec3(uSize * easeSize);
  #endif

  // Billboard Behavior
  vec2 scale;
  scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
  scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );    
  // Randomness 
  float randRef = rand(ref);
  scale *= (1.0 - (uRandScaleFactor * randRef));
  // Rotation
  float randRotation =  2.0 * PI * ( uRandRotationFactor * randRef);
  float originalRotation = (1.0 - uRotation) * 2.0 * PI;
  float originalRotationEnd = (1.0 - uRotationEnd) * 2.0 * PI;
  // OverTime
  float finalRotation = mix(originalRotation + randRotation, originalRotationEnd + randRotation, lifeLeft);

  vec2 alignedPosition = ( scaledPosition.xy - ( center - vec2( 0.5 ) ) ) * scale;
  vec2 rotatedPosition;
  rotatedPosition.x = cos( finalRotation ) * alignedPosition.x - sin( finalRotation ) * alignedPosition.y;
  rotatedPosition.y = sin( finalRotation ) * alignedPosition.x + cos( finalRotation ) * alignedPosition.y;
  
  mat4 instanceMatrix = mat4(
    vec4(1.0, 0.0, 0.0, 0.0),
    vec4(0.0, 1.0, 0.0, 0.0),
    vec4(0.0, 0.0, 1.0, 0.0),
    vec4(pos.x, pos.y, pos.z, 1.0)
  );  

  mvPosition = modelViewMatrix * instanceMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
  mvPosition.xy += rotatedPosition;
  gl_Position = projectionMatrix  * mvPosition;   
`,oPe=`
  uniform vec4 uColor;                // start color
  uniform vec4 uColor2;               // end color
  uniform sampler2D uTexture;         // texture
  varying float v_LifeLeft;   // normalized lifetime 1 to 0
  varying vec2 vUv;
  varying vec2 vRef;

  float random(vec2 co) {
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
  }
  `+x$+`  
  ${nPe}

`,lPe=({easeOpacity:e="linearFadeOut"})=>`  
  // if Particle is dead, hide it
  if (v_LifeLeft <= 0.005 ) {
    discard;
  }

  #ifdef USE_RANDOM_COLORING
    float randVal = random(vRef); // Generate a random value based on the reference
    vec4 color = mix(uColor, uColor2, randVal); // Interpolate between the two colors
  #else
    vec4 color = mix(uColor, uColor2, 1. - v_LifeLeft);
  #endif

  // Opacity over Life Time
  float finalAlpha = ${e}(1. - v_LifeLeft);  
  vec4 textureColor = texture2D(uTexture, vUv).rgba; 
  finalColor = textureColor.rgb * color.rgb;
  finalAlpha = color.a * textureColor.a * finalAlpha;
  
  gl_FragColor = vec4(finalColor, finalAlpha);     

`,cPe=class extends Ui{constructor(e,t){super(),this.needsJitter=!0,this.type="ParticleMaterial",this.easeOpacity="linearFadeIn",this.easeSize="linearFadeIn",this.useSizeEnd=!1,this.isColoringRandom=!1,this.init(e,t),this.context=t}reset(){}init(e,t){this.transparent=!0,this.depthTest=!0,this.depthWrite=!1,this.easeOpacity=e.ease,this.easeSize=e.easeSize,this.layers=[],zn.startContext(zn.globalContext),this.lightLayer=new wc(0,"",{...Zn.defaultData("light","phong"),visible:!1},new fk,{},t.shared),zn.endContext(zn.globalContext),this.build()}updateState(e){e.coloring!==void 0&&(this.isColoringRandom=e.coloring==="random"),e.color!==void 0&&(e.color instanceof Array?this.uniforms.uColor.value=e.color:this.uniforms.uColor.value=this.context.shared.color(e.color)),e.color2!==void 0&&(e.color2 instanceof Array?this.uniforms.uColor2.value=e.color2:this.uniforms.uColor2.value=this.context.shared.color(e.color2)),e.size!==void 0&&(this.uniforms.uSize.value=e.size[0],this.uniforms.uSizeEnd.value=e.size[1],e.size[0]!==e.size[1]?this.useSizeEnd=!0:this.useSizeEnd=!1),e.ease!==void 0&&(this.easeOpacity=e.ease,this.build()),e.easeSize!==void 0&&(this.easeSize=e.easeSize,this.build()),this.needsUpdate=!0}onBeforeCompile(e){this.build(),e.defines=this.defines,e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader}build(){let e=new gZ;return e.needsJitter=this.needsJitter,e.addFragmentParsCode(VMe),e.buildShader("vertex",this.fragment),e.buildShader("fragment",this.fragment),e.addFragmentFinalCode(HMe),this.isColoringRandom&&e.define("USE_RANDOM_COLORING"),this.useSizeEnd&&e.define("USE_SIZE_END"),e.addVertexParsCode(sPe),e.addFragmentParsCode(oPe),e.addVertexFinalCode(aPe({easeSize:this.easeSize})),e.addFragmentFinalCode(lPe({easeOpacity:this.easeOpacity})),this.vertexShader=e.getCode("vertex"),this.fragmentShader=e.getCode("fragment"),this.defines=e.defines,this.uniforms={...e.uniforms,...this.uniforms},this.extensions=e.extensions,this}get nodeMaterial(){return this}get fragment(){return this.lightLayer.node}getDefines(){return this.defines}nodeMaterialDispose(){this.layers.forEach(e=>e.dispose()),super.dispose()}},iR=class{constructor(e,t,i,r){this.type="SphereEmitterShape",this.targetMesh=void 0,this.size=e,this.type=i,this.textureSize=q2e(t);let n=1;this.targetMesh=(r==null?void 0:r.type)==="Mesh"&&r?r:this.getMesh(i,n);let{positions:s,dataTexture:a,dataTextureNormals:o}=this.createPositions(this.textureSize,this.targetMesh??this.getMesh(i,n));this.positionsTexture=a,this.positionsAttribute=s,this.directionsTexture=o}createPositions(e,t){let{positions:i,normals:r}=Y2e(t,e*e),n=jj(i,e),s=jj(r,e);return{dataTexture:n,positions:i,dataTextureNormals:s}}getMesh(e,t){let i=null;switch(e){case"SphereEmitterShape":{i=new _v(t*.5,32,32);break}case"TorusEmitterShape":{i=new JY(t*.5,.3,15,40);break}case"ConeEmitterShape":{i=new wB(t,t,15);break}case"BoxEmitterShape":{i=new Hl(t,t,t);break}case"PlaneEmitterShape":{i=new hh(t,t),i.rotateX(-Math.PI/2);break}case"MeshEmitterShape":{i=new _v(t,32,32);break}default:{i=new _v(t,32,32);break}}return new zr(i,new uh({color:16711680}))}applyToShader(e,t){this.size=new B().fromArray(t.size),e.uEmitterSize.value=this.size}dispose(){this.positionsTexture.dispose(),this.directionsTexture.dispose(),this.positionsAttribute=new Float32Array}};function Ug(e){let t={...e},i=HA.defaultData;t.forceFieldObjectId&&(t.colliderEntityId=t.forceFieldObjectId);let r={...i.shape,...t.shape},n={...i.renderMaterial,...t.renderMaterial};return{...i,...t,shape:r,renderMaterial:n}}var uPe=`
// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU

uniform sampler2D uIndex; // Texture with corresponding index
uniform float uLastIndexEmitted; // Last emitted index
uniform float uParticlesToEmit; // Number of particles to emit on that frame
uniform float uTime;

void main() {
    vec2 vUv = gl_FragCoord.xy / resolution.xy;
    float particleIndex = texture(uIndex, vUv).x;
    float timeLeft = texture2D( uCurrentPosition, vUv ).w;
    float isActive = texture2D( uCurrentEmissionRate, vUv ).g;    // 1. = active, 0. = not active
    float timeStart = texture2D( uCurrentEmissionRate, vUv ).b;


    // ********** Detect Colision to Create a flag and use it in position **********
    // We are doing this here, so

    // ********** Emit Particles **********
    // X = isSpawning 0.0 or 1.0
    // Y = isActive 0.0 or 1.0
    // Check if the vertex index is between the first value and the last value
    // if (particleIndex >= uLastIndexEmitted && particleIndex < uLastIndexEmitted + uParticlesToEmit) {
    //     // Emit a particle by writing 1 to the red channel of the color output
    //     // r: 1. == emit the particle
    //     // g: 1. == particle is now active
    //     timeStart = uTime;
    //     gl_FragColor = vec4(1.0, 1.0, timeStart, 1.0);
    // } else {
    //     // The Particle is either already emitted or not in the range of the particles to emit
    //     // Do not emit a particle by writing 0 to the red channel of the color output        
    //     gl_FragColor = vec4(0.0, isActive, timeStart, 1.0);
    // }
    // Determine if the particle is within the emission range
    float emitLowerBound = step(uLastIndexEmitted, particleIndex);
    float emitUpperBound = step(particleIndex, uLastIndexEmitted + uParticlesToEmit - 1.0);
    float emitParticle = emitLowerBound * emitUpperBound; // 1.0 if in range, 0.0 otherwise

    // Set timeStart and color
    timeStart = mix(timeStart, uTime, emitParticle);
    gl_FragColor = vec4(emitParticle, mix(isActive, 1.0, emitParticle), timeStart, 1.0);


}
`,rR=10,hPe=class extends ir{constructor(e,t){super(),this.type="ParticleEmitter",this.debugMode=!1,this.worldSpace=!0,this.rootObject=null,this.gpuCompute=null,this.positionSimRT=null,this.velocitySimRT=null,this.emissionRateSimRT=null,this.emitterShape=void 0,this.isEmitting=!1,this.hasBeenReset=!1,this.emittedParticlesAmount=0,this.lastEmitTime=0,this.globalTime=0,this.targetFPS=60,this.previousRatio=1,this.lerpFactor=.4,this.particlesAmount=0,this.noiseStrength=0,this.noiseScale=0,this.isBillboardBased=!0,this.simFeaturesDefinition={USE_COLLIDER:!1,USE_ATTRACTOR:!1,USE_VORTEX:!1,USE_SPHERE_COLLIDER:!1,USE_BOX_COLLIDER:!1,USE_FORCE_LOCAL_SPACE:!1,USE_NORMALS:!1,USE_CURL_NOISE:!0,USE_SIMPLEX_NOISE:!1,USE_FBM_NOISE:!1},this.textureLoader=new Cpe,this.currentWorldPosition=new B,this.systemQuaternion=new ei,this.worldGravity=new B(0,0,0),this.directionAxis=new B(0,0,0),this.colliderV3=new B(0,0,0),this.colliderQuaternion=new ei(0,0,0,1),this.matrixAutoUpdate=!0,this.renderer=e,this.system=t,this.shared=t.context.shared;let i=t.data;this.material=new cPe(i.renderMaterial,t.context),this.material.uniforms={uSize:{value:0},uSizeEnd:{value:0},uColor:{value:i.renderMaterial.color},uColor2:{value:i.renderMaterial.color2},uPosition:{value:new B(0,0,0)},uEmissionData:{value:new B(0,0,0)},uTexture:{value:this.defaultTexture},uWorldOffset:{value:new B(0,0,0)},uWorldQuaternion:{value:new ti(0,0,0,1)},uRandScaleFactor:{value:i.randomScale??0},uRandRotationFactor:{value:i.randomRotation??0},uRotation:{value:i.renderMaterial.spriteRotation[0]??0},uRotationEnd:{value:i.renderMaterial.spriteRotation[1]??0}},this.setTexture(this.material.uniforms,i.renderMaterial.texture),this.init(i)}setTexture(e,t){let i=t.data;if(typeof t=="string"){let r=this.shared.image(t),n=new Br(r.img);n.needsUpdate=!0,e.uTexture.value=n;return}if(typeof i!="string"){let r=new Image;r.onload=()=>{let a=new Br(r);a.needsUpdate=!0,e.uTexture.value=a};let n=new Blob([i],{type:"image/*"}),s=URL.createObjectURL(n);r.src=s}}updateGeometryAttributes(e,t){var r;let i=X2e(t);!((r=this.emitterShape)!=null&&r.positionsAttribute)||e.geometry.setAttribute("ref",new L1(i,2))}applyWorldSpace(){if(!this.system.started||!this.worldSpace||!this.positionSimRT||!this.velocitySimRT)return;let e=this.system;e.getWorldQuaternion(this.systemQuaternion),this.systemQuaternion.invert(),e.getWorldPosition(this.currentWorldPosition),this.material.uniforms.uWorldOffset.value=this.currentWorldPosition,this.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize()),this.positionSimRT.material.uniforms.uWorldOffset.value=this.currentWorldPosition,this.systemQuaternion.invert(),this.positionSimRT.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize()),this.velocitySimRT.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize())}update(e,t){var a;if(!this.gpuCompute||!this.positionSimRT||!this.velocitySimRT||!this.emissionRateSimRT||this.hasBeenReset)return;if(this.checkIfAllParticlesAreDead()&&!this.hasBeenReset){this.reset();return}this.applyWorldSpace(),this.globalTime=e,this.positionSimRT.material.uniforms.uTime.value=e,this.emissionRateSimRT.material.uniforms.uTime.value=e;let i=1e3/t,r=this.targetFPS/i,n=this.previousRatio+(r-this.previousRatio)*this.lerpFactor;this.positionSimRT.material.uniforms.uFPSRatio.value=n,this.previousRatio=n;let s=this.isEmitting?this.GoEmitSomeParticles(e,this.system.data.birthRatePerSec):0;this.emissionRateSimRT.material.uniforms.uLastIndexEmitted.value=this.emittedParticlesAmount,this.emissionRateSimRT.material.uniforms.uParticlesToEmit.value=s,this.material.uniforms.uPosition.value=(a=this.gpuCompute.getCurrentRenderTarget(this.positionSimRT))==null?void 0:a.texture,this.system.colliderEntities.length>0&&this.renderColliders(),this.gpuCompute.compute()}renderColliders(){if(!this.velocitySimRT)return;let e=this.system.colliderEntities[0],t=this.simFeaturesDefinition.USE_COLLIDER||this.simFeaturesDefinition.USE_ATTRACTOR||this.simFeaturesDefinition.USE_VORTEX;if(e.destroyedInAction&&t&&this.init(Ug({...this.system.data,colliderEntityId:null})),!e||e.destroyedInAction)return;e.getWorldPosition(this.colliderV3),this.colliderV3.y===0&&(this.colliderV3.y=1e-4),this.velocitySimRT.material.uniforms.uColliderPos.value.copy(this.colliderV3);let i=e.data.size;this.colliderV3.fromArray(i),this.velocitySimRT.material.uniforms.uColliderSize.value.copy(this.simFeaturesDefinition.USE_SPHERE_COLLIDER?this.colliderV3.multiplyScalar(.5):this.colliderV3),e.getWorldQuaternion(this.colliderQuaternion),this.velocitySimRT.material.uniforms.uColliderQuaternion.value.copy(this.colliderQuaternion.normalize()),this.velocitySimRT.material.uniforms.uColliderQuaternionInvert.value.copy(this.colliderQuaternion.normalize().invert())}updateState(e){!this.velocitySimRT||!this.positionSimRT||(e.renderMaterial&&this.updateMaterialState(e.renderMaterial),this.updateParticleState(e))}updateVariableState(e,t){if(!this.velocitySimRT||!this.positionSimRT)return;t[2]==="size"&&this.material.updateState({size:[e,this.material.uniforms.uSizeEnd.value]}),t[2]==="sizeEnd"&&this.material.updateState({size:[this.material.uniforms.uSize.value,e]});let i=(r,n)=>{let s=[...this.system.data.shape.size];s[r]=n,this.updateParticleState({shape:{...this.system.data.shape,size:s}})};t[2]==="shape_size_0"&&i(0,e),t[2]==="shape_size_1"&&i(1,e),t[2]==="shape_size_2"&&i(2,e),t[2]==="speed"&&(this.velocitySimRT.material.uniforms.uSpeed.value=e/rR),t[2]==="gravity"&&this.worldGravity.set(0,e/100,0),t[2]==="noiseStrength"&&(this.noiseStrength=e,this.velocitySimRT.material.uniforms.uNoiseStrength.value=this.noiseStrength),t[2]==="noiseScale"&&(this.noiseScale=e,this.velocitySimRT.material.uniforms.uNoiseScale.value=this.noiseScale),t[2]==="direction_x"&&(this.directionAxis=this.getDirectionAxis([Number(e),this.system.data.direction[1],this.system.data.direction[2]])),t[2]==="direction_y"&&(this.directionAxis=this.getDirectionAxis([this.system.data.direction[0],Number(e),this.system.data.direction[2]])),t[2]==="direction_z"&&(this.directionAxis=this.getDirectionAxis([this.system.data.direction[0],this.system.data.direction[1],Number(e)]))}updateMaterialState(e){this.material.updateState({...e,size:e.size?[Number(this.shared.getVariable(e.size[0],[this.uuid,"particles","size"])),Number(this.shared.getVariable(e.size[1],[this.uuid,"particles","sizeEnd"]))]:[0,0]}),e.texture&&(this.setTexture(this.material.uniforms,e.texture),this.material.needsUpdate=!0)}updateParticleState(e){var t,i,r;if(!(!this.positionSimRT||!this.velocitySimRT)){if(this.shouldReInitGPUCompute(e)&&this.init(Ug(this.system.data)),e.life!==void 0&&(this.positionSimRT.material.uniforms.uMaxLifeTime.value=e.life),e.speed!==void 0&&(this.velocitySimRT.material.uniforms.uSpeed.value=Number(this.shared.getVariable(e.speed,[this.uuid,"particles","speed"]))/rR),e.collisionBounce!==void 0&&(this.velocitySimRT.material.uniforms.uBounce.value=e.collisionBounce),e.noiseStrength!==void 0&&(this.noiseStrength=Number(this.shared.getVariable(e.noiseStrength,[this.uuid,"particles","noiseStrength"])),this.velocitySimRT.material.uniforms.uNoiseStrength.value=this.noiseStrength),e.noiseScale!==void 0&&(this.noiseScale=Number(this.shared.getVariable(e.noiseScale,[this.uuid,"particles","noiseScale"])),this.velocitySimRT.material.uniforms.uNoiseScale.value=this.noiseScale),e.noiseSeed!==void 0&&(this.velocitySimRT.material.uniforms.uNoiseSeed.value=e.noiseSeed),e.randomMass!==void 0&&(this.velocitySimRT.material.uniforms.uRandomMassFactor.value=e.randomMass),((t=e.renderMaterial)==null?void 0:t.size)!==void 0){let n=this.shared.getVariable(e.renderMaterial.size[0],[this.uuid,"particles","size"]);this.velocitySimRT.material.uniforms.particleSize.value=Number(n)}if(((i=e.renderMaterial)==null?void 0:i.spriteRotation)!==void 0&&(this.material.uniforms.uRotation.value=e.renderMaterial.spriteRotation[0],this.material.uniforms.uRotationEnd.value=e.renderMaterial.spriteRotation[1]),e.shape!==void 0){let n=e.shape.size??this.system.data.shape.size,s=[Number(this.shared.getVariable(n[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(n[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(n[2],[this.uuid,"particles","shape_size_2"]))],a={...Ug(this.system.data).shape,size:s};(r=this.emitterShape)==null||r.applyToShader(this.positionSimRT.material.uniforms,a)}if(e.gravity!==void 0&&(this.worldGravity.set(0,Number(this.shared.getVariable(this.system.data.gravity,[this.uuid,"particles","gravity"]))/100,0),this.velocitySimRT.material.uniforms.uGravity={value:this.worldGravity}),e.direction!==void 0){let n=this.getDirectionFromVariable(e.direction);this.directionAxis=this.getDirectionAxis(n),this.velocitySimRT.material.uniforms.uDirectionsAxis.value=this.directionAxis}e.randomRotation!==void 0&&(this.material.uniforms.uRandRotationFactor.value=e.randomRotation),e.randomScale!==void 0&&(this.material.uniforms.uRandScaleFactor.value=e.randomScale)}}updateForceFieldParameters(e){!this.velocitySimRT||(e.forceIntensity!==void 0&&(this.velocitySimRT.material.uniforms.uForceIntensity.value=e.forceIntensity),e.forceDambing!==void 0&&(this.velocitySimRT.material.uniforms.uForceDamping.value=e.forceDambing))}getDirectionAxis(e){let t=[Number(e[0])*Et.DEG2RAD,Number(e[1])*Et.DEG2RAD,Number(e[2])*Et.DEG2RAD],i=new Nn(t[0],t[1],t[2],"XYZ");return this.directionAxis.set(0,1,0).applyEuler(i).normalize(),this.velocitySimRT&&(this.velocitySimRT.material.uniforms.uDirectionsAxis.value=this.directionAxis),this.directionAxis}shouldReInitGPUCompute(e){let{birthRatePerSec:t,rootObjectType:i,colliderEntityId:r,shape:n,emitTimeDuration:s,emitTimeCycle:a,life:o,directionMode:l,noiseType:c}=e;return t!==void 0||i!==void 0||r||r===null||a!==void 0||n!==void 0||o!==void 0||s!==void 0||l!==void 0||c!==void 0}init(e){this.dispose(),this.particlesAmount=this.getMaxParticlesAmount({birthRatePerSecond:e.birthRatePerSec,particleMaxLifeTime:e.life,loopDuration:e.emitTimeCycle==="infinity"?0:e.emitTimeDuration}),this.particlesAmount>1e5&&(console.warn("The maximum number of particles is limited to 100000."),this.particlesAmount=1e5),this.emitterShape=this.createShape(e.shape,this.particlesAmount);let t=setInterval(()=>{if(this.emitterShape)if(isNaN(this.emitterShape.positionsTexture.source.data.data[0])){this.init(e);return}else clearInterval(t)},100);if(!this.emitterShape)return;let i=new j2e(this.emitterShape.textureSize,this.emitterShape.textureSize,this.renderer),r=this.updateSimulationDefinition(e),n=i.addVariable("uCurrentPosition",r+Z2e,this.emitterShape.positionsTexture),s=i.addVariable("uCurrentVelocity",r+iPe,this.emitterShape.directionsTexture),a=i.addVariable("uCurrentEmissionRate",uPe,K2e(this.emitterShape.textureSize));i.setVariableDependencies(n,[n,s,a]),i.setVariableDependencies(s,[n,s,a]),i.setVariableDependencies(a,[n,s,a]);let o=Q2e({size:this.emitterShape.textureSize}),l={uOriginalPosition:{value:this.emitterShape.positionsTexture},uWorldOffset:{value:new B(0,0,0)},uWorldQuaternion:{value:new ti(0,0,0,1)},uTime:{value:0},uFPSRatio:{value:1},uMaxLifeTime:{value:e.life},uEmitterSize:{value:new B(Number(this.shared.getVariable(e.shape.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(e.shape.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(e.shape.size[2],[this.uuid,"particles","shape_size_2"])))},particleSize:{value:0}};n.material.uniforms=l;let c=this.getDirectionFromVariable(e.direction);this.directionAxis=this.getDirectionAxis(c),this.worldGravity.set(0,Number(this.shared.getVariable(this.system.data.gravity,[this.uuid,"particles","gravity"]))/100,0),this.noiseStrength=Number(this.shared.getVariable(e.noiseStrength,[this.uuid,"particles","noiseStrength"])),this.noiseScale=Number(this.shared.getVariable(e.noiseScale,[this.uuid,"particles","noiseScale"]));let u=e.colliderEntityId&&this.system.getColliderData(e.colliderEntityId),h={uOriginalPosition:{value:this.emitterShape.positionsTexture},uDirections:{value:this.emitterShape.directionsTexture},uDirectionsAxis:{value:this.directionAxis},uWorldQuaternion:{value:new ti(0,0,0,1)},uColliderPos:{value:new B(0,0,0)},uColliderSize:{value:new B(0,0,0)},uForceIntensity:{value:u?u.forceIntensity:0},uForceDamping:{value:u?u.forceDambing:0},uColliderQuaternion:{value:new ti(0,0,0,1)},uColliderQuaternionInvert:{value:new ti(0,0,0,1)},particleSize:{value:0},uGravity:{value:this.worldGravity},uNoiseStrength:{value:this.noiseStrength},uNoiseScale:{value:this.noiseScale},uNoiseSeed:{value:e.noiseSeed},uRandomMassFactor:{value:e.randomMass},uBounce:{value:e.collisionBounce},uSpeed:{value:Number(this.shared.getVariable(e.speed,[this.uuid,"particles","speed"]))/rR}};s.material.uniforms=h;let d={uIndex:{value:o},uTime:{value:0},uLastIndexEmitted:{value:0},uParticlesToEmit:{value:0}};a.material.uniforms=d;let p=[Number(this.shared.getVariable(e.shape.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(e.shape.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(e.shape.size[2],[this.uuid,"particles","shape_size_2"]))],f={...Ug(this.system.data).shape,size:p};this.emitterShape.applyToShader(n.material.uniforms,f),i.init(),this.gpuCompute=i,this.positionSimRT=n,this.velocitySimRT=s,this.emissionRateSimRT=a,this.rootObject=this.createPrimaryEmitter(this.emitterShape.textureSize),this.add(this.rootObject),this.material.needsUpdate=!0}getDirectionFromVariable(e){let t=Number(this.shared.getVariable(e[0],[this.uuid,"particles","direction_x"])),i=Number(this.shared.getVariable(e[1],[this.uuid,"particles","direction_y"])),r=Number(this.shared.getVariable(e[2],[this.uuid,"particles","direction_z"]));return[t,i,r]}updateSimulationDefinition(e){if(this.simFeaturesDefinition.USE_COLLIDER=!1,this.simFeaturesDefinition.USE_ATTRACTOR=!1,this.simFeaturesDefinition.USE_VORTEX=!1,this.simFeaturesDefinition.USE_SPHERE_COLLIDER=!1,this.simFeaturesDefinition.USE_BOX_COLLIDER=!1,this.simFeaturesDefinition.USE_FORCE_LOCAL_SPACE=!1,this.simFeaturesDefinition.USE_NORMALS=!1,this.simFeaturesDefinition.USE_CURL_NOISE=!1,this.simFeaturesDefinition.USE_SIMPLEX_NOISE=!1,this.simFeaturesDefinition.USE_FBM_NOISE=!1,e.colliderEntityId&&this.system.colliderEntities.length>0){let i=this.system.getColliderData(e.colliderEntityId);switch(i==null?void 0:i.forceType){case"attractor":this.simFeaturesDefinition.USE_ATTRACTOR=!0;break;case"collider":this.simFeaturesDefinition.USE_COLLIDER=!0;break;case"vortex":this.simFeaturesDefinition.USE_VORTEX=!0;break}let r=i==null?void 0:i.colliderType;r==="sphere"&&(this.simFeaturesDefinition.USE_SPHERE_COLLIDER=!0),r==="box"&&(this.simFeaturesDefinition.USE_BOX_COLLIDER=!0),(i==null?void 0:i.forceRange)==="helper"&&(this.simFeaturesDefinition.USE_FORCE_LOCAL_SPACE=!0)}e.directionMode==="normals"&&(this.simFeaturesDefinition.USE_NORMALS=!0),e.noiseType==="curl"&&(this.simFeaturesDefinition.USE_CURL_NOISE=!0),e.noiseType==="simplex"&&(this.simFeaturesDefinition.USE_SIMPLEX_NOISE=!0),e.noiseType==="fbm"&&(this.simFeaturesDefinition.USE_FBM_NOISE=!0);let t="";for(let[i,r]of Object.entries(this.simFeaturesDefinition))r&&(t+=`#define ${i}
`);return t}createShape(e,t){this.emitterShape&&this.emitterShape.dispose();let i=new B(Number(this.shared.getVariable(e.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(e.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(e.size[2],[this.uuid,"particles","shape_size_2"])));if(e.type==="MeshEmitterShape"){let r=null;return this.system.context.scene.traverseEntity(n=>{n.uuid===e.fromMeshId&&(r=n)}),r?new iR(i,t,e.type,r):new iR(i,t,"SphereEmitterShape")}else return new iR(i,t,e.type)}createPrimaryEmitter(e){let t,i=e*e;return t=new Vde(new hh(1,1,1),this.material,i),this.updateGeometryAttributes(t,e),this.material.needsUpdate=!0,t.onBeforeRender=()=>{this.applyWorldSpace()},t}getMaxParticlesAmount({birthRatePerSecond:e,particleMaxLifeTime:t,loopDuration:i=0}){return Math.ceil(e*(t+i))}dispose(){var e,t,i;!this.gpuCompute||((t=(e=this.rootObject)==null?void 0:e.parent)==null||t.remove(this.rootObject),this.gpuCompute.dispose(),this.material.nodeMaterialDispose(),(i=this.emitterShape)==null||i.dispose())}GoEmitSomeParticles(e,t){let i=e-this.lastEmitTime,r=1/t;if(i>=r){let n=Math.max(1,Math.floor(i/r));return this.lastEmitTime=e,this.emittedParticlesAmount+n>this.particlesAmount&&(this.emittedParticlesAmount=0),this.emittedParticlesAmount+=n,n}return 0}checkIfAllParticlesAreDead(){return this.lastEmitTime+this.system.data.life+1<this.globalTime}reset(){this.hasBeenReset=!0,this.lastEmitTime=0,this.emittedParticlesAmount=0,this.gpuCompute&&this.init(Ug(this.system.data))}startEmitting(e){this.isEmitting=!0,this.hasBeenReset=!1,this.lastEmitTime=e}stopEmitting(){this.isEmitting=!1}},SE=class extends wa{constructor(e,t,i){super(e,t),this.type="ParticleSystem",this.geometry=new Bt,this.actualTime=0,this.currentLoopTime=0,this.started=!1,this.stopped=!1,this.timeoutId=void 0,this.isFrozen=!1,this.isIdle=!0,this.emitter=null,this.colliderEntities=[],this.renderer=null,this.isPreWarm=!1,this._hasOnAfterRenderBeenCalled=!1,this.onAfterRender=r=>{this._hasOnAfterRenderBeenCalled||(this._hasOnAfterRenderBeenCalled=!0,this.init(r))},this.context=i,this.data={...t,...Ug(t)},this.geometry.setAttribute("position",new St([],3)),this.material=new uh({colorWrite:!1}),this.frustumCulled=!1}init(e){this.renderer=e,this.emitter=new hPe(e,this),this.add(this.emitter),this.updateParticleState(this.data)}update(e){if(!this.isReady||!this.started||this.isFrozen||this.isIdle)return;this.actualTime+=e,this.stopped||(this.currentLoopTime+=e);let t=this.data.emitTimeCycle==="one_time";if((this.data.emitTimeCycle==="loop"||t)&&this.currentLoopTime>this.data.emitTimeDuration*1e3&&(this.stopped||(this.stop(),t||this.start(this.data.emitTimeDelay*1e3))),this.emitter&&this.started){let i=this.actualTime/1e3;this.emitter.update(i,e)}this.scale.set(1,1,1),this.updateMatrix()}isReady(){return!!this.emitter}hasCollider(e){return this.colliderEntities.some(t=>t.identity===e)}getColliderData(e){let t=this.colliderEntities.find(i=>i.identity===e);return t?t.data:null}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),hr(e.path,["renderMaterial"])&&this.updateParticleState({renderMaterial:{...this.data.renderMaterial,...rs.drop(e,1).props}}),hr(e.path,["shape"])&&this.updateParticleState({shape:{...this.data.shape,...rs.drop(e,1).props}})}updateState(e,t){super.updateState(e,t),this.updateParticleState(e)}updateParticleState(e){if(this.emitter){if(e.colliderEntityId!==void 0&&e.colliderEntityId!==null){let t=this.context.scene.find(e.colliderEntityId);this.colliderEntities=t?[t]:[]}e.colliderEntityId===null&&(this.colliderEntities=[]),this.emitter.updateState(e),e.emitTimeCycle&&this.started&&this.start()}}updateFromColliderEntity(e){!this.emitter||(this.emitter.updateForceFieldParameters(e),this.stop(),this.start())}start(e=0){var t;if(this.currentLoopTime=0,e){this.timeoutId=window.setTimeout(()=>{this.start(0)},e);return}this.started=!0,this.stopped=!1,this.isFrozen=!1,(t=this.emitter)==null||t.startEmitting(this.actualTime/1e3)}froze(){this.isFrozen=!0}unFroze(){this.isFrozen=!1}stop(){var e;this.stopped=!0,this.currentLoopTime=0,(e=this.emitter)==null||e.stopEmitting(),clearTimeout(this.timeoutId)}reset(){var e;this.started=!1,this.stopped=!1,(e=this.emitter)==null||e.reset()}wakeUp(){this.isIdle=!1}sleep(){this.isIdle=!0,this.reset()}};function dPe(){try{let e=window.location.href;if(e.includes("reducesubdiv=")){let t=e.indexOf("reducesubdiv=")+13;return parseInt(e.slice(t,t+1))}}catch{}}var nR=dPe();function pPe(e,t,i){var n;nR!==void 0&&(((n=t==null?void 0:t.geometry)==null?void 0:n.subdivisions)??0)>nR&&(console.log("reducing subdivisions",t.name,t.geometry.subdivisions),t.geometry.subdivisions=nR);let r;return t.geometry.type==="TextGeometry"?new wk(e,t,i):t.geometry.type==="InputGeometry"?new Tk(e,t,i):(t.geometry.type==="SubdivGeometry"?r=new $1(e,t,i):t.geometry.type==="PathGeometry"?r=new Ck(e,t,i):t.geometry.type==="VectorGeometry"?r=new H2e(e,t,i):t.geometry.type==="BooleanGeometry"?r=new qf(e,t,i):t.geometry.type==="UIGeometry"?r=new js(e,t,i):r=new qs(e,t,i),r)}function Dk(e,t,i){return console.assert(t.type!==void 0),t.type==="Mesh"?pPe(e,t,i):t.type==="Empty"?new Rv(e,t):t.type==="Particle"?new SE(e,t,i):t.type==="ParticleCollider"?new bE(e,t,i):t.type==="Splat"?new Rv(e,t):t.type==="Bone"?new G2e(e,t):t.type==="Page"?new es(e,t,i):t.type==="PointLight"?new V2e(e,t,i):t.type==="SpotLight"?new l$(e,t,i):t.type==="DirectionalLight"?new o$(e,t,i):t.type==="Component"||t.type==="Instance"?new Iv(e,t,i):Wf.is(t.type)?new Qs(e,t):(console.error(t),new Rv(e,t))}Ad.createEntity=Dk;function fPe(e,t,i){let r=Dk(e.identity,t,i),n=e.children,s=e.attachedPaths,a=e.parent,o=e.component,l=e.instances,c=e.overrideData,u=e.uuid,h=e.stateSelection;e.dispose();for(let d of Object.keys(e))delete e[d];Object.setPrototypeOf(e,Object.getPrototypeOf(r));for(let d of Object.keys(r))e[d]=r[d];e.children=[...e.children,...n],e.attachedPaths=s,e.parent=a,e.component=o,e.instances=l,e.uuid=u,e.overrideData=c,e.updateState(e.data,i),h&&e.changeSelectedState(h,i),e.resetBBoxNeedsUpdate()}Ad.changeEntityProptotype=fPe;Ad.Cloner=Ll;function mPe(e,t,i,r){e.updateByOp(t,i,r,!1)}function Wj(e,t){let i=!1,r=t.getLayersOfType("transmission"),n=t.getLayersOfType("outline");return n.length>0&&(e.layers.set(8),r.length>0&&e.layers.enable(3),i=!0,xk(e),yk(e)),r.length===0&&n.length===0&&e.layers.set(0),e instanceof N0&&e.needsAO&&e.layers.enable(5),i}function Xj(e,t){if(!t.layers)return!1;let i=!1,r=t.getLayersOfType("transmission").filter(s=>s.data.visible),n=t.getLayersOfType("outline").filter(s=>s.data.visible);return r.length>0&&(e.layers.set(3),n.length>0&&e.layers.enable(8),i=!0),r.length===0&&n.length===0&&e.layers.set(0),e.needsAO&&e.layers.enable(5),i}function gPe(e){let t=!1;return e.traverseEntity(i=>{if(i instanceof N0)if(Array.isArray(i.material))for(let r=0;r<i.material.length;r++)Wj(i,i.material[r])&&(t=!0);else Wj(i,i.material)&&(t=!0)}),t}function vPe(e){let t=!1;return e.traverseEntity(i=>{if(i instanceof N0)if(Array.isArray(i.material))for(let r=0;r<i.material.length;r++)Xj(i,i.material[r])&&(t=!0);else Xj(i,i.material)&&(t=!0)}),t}var yPe=new lQ,xPe=new ht,wPe=new _0;function gz(e,t,i,r=!1){let n=e.cloner;if(n)for(let s of n.children){let a=xPe.copy(s.matrixWorld).invert(),o=wPe.copy(t.ray).applyMatrix4(a),l=e.matrixWorld;o.applyMatrix4(l);let c=yPe;c.set(o.origin,o.direction),c.near=t.near,c.far=t.far;let u=c.intersectObject(e,!1);u.length>0&&i.push({...u[0],object:r?s:e})}}var bPe=class{constructor(){this._constraints=new Map}setConstraint(e,t){t===null?this._constraints.delete(e):this._constraints.set(e,t)}removeDependencies(e){this._constraints.delete(e)}applyConstraints(e){let t=new Set;this._constraints.forEach((i,r)=>{let n=[r,i],s=i;for(;this._constraints.has(s);){if(s=this._constraints.get(s),n.includes(s)){console.warn(`circular dependency detected: ${n.join(" -> ")}`);break}t.has(s)||n.push(s)}for(let a=n.length-2;a>=0;a--)if(!t.has(n[a])){let o=e.find(n[a]);o?o.applyPathSnapping(e):console.warn(`missing entity ${n[a]}`),t.add(n[a])}})}findDependency(e,t){let i=e;for(;this._constraints.has(i);)if(i=this._constraints.get(i),i===t)return!0;return!1}},_Pe="AGFzbQEAAAAADwhkeWxpbmsuMAEEAAAAAAETA2AAAGAIf39/f39/f38AYAABfwISAQNlbnYGbWVtb3J5AgMAgIAEAwQDAAECBzkDEV9fd2FzbV9jYWxsX2N0b3JzAAALc29ydEluZGV4ZXMAARNlbXNjcmlwdGVuX3Rsc19pbml0AAIK3gMDAwABC9IDAwF/BnwBfgJAIAdFDQAgAysDUCEMIAMrAzAhDSADKwMQIQ5BACEDRP///////+9/IQtEAAAAAAAAEAAhCgNAIAIgA0ECdGoCfyAOIAEgA0EMbGoiCCoCALuiIA0gCCoCBLuioCAMIAgqAgi7oqBEAAAAAAAAsECiIgmZRAAAAAAAAOBBYwRAIAmqDAELQYCAgIB4CzYCACAJIAsgCSALYxshCyAJIAogCSAKZBshCiADQQFqIgMgB0cNAAsgB0UNACAGuCAKIAuhoyEJQQAhAwNAAn8gCSACIANBAnRqIgEoAgC3IAuhoiIKmUQAAAAAAADgQWMEQCAKqgwBC0GAgICAeAshCCABIAg2AgAgBCAIQQJ0aiIBIAEoAgBBAWo2AgAgA0EBaiIDIAdHDQALCyAGQQJPBEAgBCgCACEIQQEhAwNAIAQgA0ECdGoiASABKAIAIAhqIgg2AgAgA0EBaiIDIAZHDQALCyAHQQFrIgGtIQ8DQCAEIAIgD6dBAnQiA2ooAgBBAnRqIgcgBygCAEEBayIHNgIAIAUgASAHa0ECdGogACADaigCADYCACAPUCEDIA9CAX0hDyADRQ0ACyAGBEAgBEEAIAZBAnT8CwALCwQAQQAL",Td=class{};yx(Td,"DepthMapRange",65536),yx(Td,"MemoryPageSize",65536),yx(Td,"BytesPerFloat",4),yx(Td,"BytesPerInt",4);function SPe(e){let t,i,r,n,s,a,o,l,c,u,h,d,p,f,v,g;function m(D){let I=new Float64Array(u,a,16);for(let z=0;z<16;z++)I[z]=D[z];let L;if(r>1){t.exports.sortIndexes(n,s,c,a,o,l,d.DepthMapRange,r);let z=new Uint32Array(r);L=z.buffer,z.set(new Uint32Array(u,l,r))}else if(r===1){let z=new Uint32Array(r);z[0]=new Uint32Array(u,n,i)[0],L=z.buffer}else L=new ArrayBuffer(0);e.postMessage({sortDone:!0,indexesBuffer:L},[L])}function x(D,I,L){let z=new Float32Array(u,s,i*3);r=0;let F=new Uint32Array(u,n,i);for(let Q=0;Q<L.length-1;Q++){let Y=I[Q],O=D[Q].elements,j=Y.filter(W=>W.enabled&&W.mode==="Include").map(W=>W.type==="Box"?S(W):E(W)),V=Y.filter(W=>W.enabled&&W.mode==="Exclude").map(W=>W.type==="Box"?S(W):E(W));for(let W=L[Q];W<L[Q+1];W++){let J=p[W*3],ce=p[W*3+1],$=p[W*3+2];if((j.length===0||_(J,ce,$,j))&&(V.length===0||!_(J,ce,$,V))){let ne=1/(O[3]*J+O[7]*ce+O[11]*$+O[15]);z[r*3]=(O[0]*J+O[4]*ce+O[8]*$+O[12])*ne,z[r*3+1]=(O[1]*J+O[5]*ce+O[9]*$+O[13])*ne,z[r*3+2]=(O[2]*J+O[6]*ce+O[10]*$+O[14])*ne,F[r]=W,r++}}}}function w(D,I){let L=[],z=I.filter(Y=>Y.enabled&&Y.mode==="Include").map(Y=>Y.type==="Box"?S(Y):E(Y)),F=I.filter(Y=>Y.enabled&&Y.mode==="Exclude").map(Y=>Y.type==="Box"?S(Y):E(Y)),Q=D.length;for(let Y=0;Y<Q;Y+=3){let O=D[Y],j=D[Y+1],V=D[Y+2];(z.length===0||_(O,j,V,z))&&(F.length===0||!_(O,j,V,F))||L.push(Y/3)}return L}function _(D,I,L,z,F){return z.some(Q=>{let Y=M(D,I,L,Q.invRotationMatrix,Q.cropCenter);return Array.isArray(Q)?T(Y.x,Y.y,Y.z,Q):C(Y.x,Y.y,Y.z,Q)})}function M(D,I,L,z,F){let Q=D-F[0],Y=I-F[1],O=L-F[2],j=1/(z[3]*Q+z[7]*Y+z[11]*O+z[15]);return{x:(z[0]*Q+z[4]*Y+z[8]*O+z[12])*j+F[0],y:(z[1]*Q+z[5]*Y+z[9]*O+z[13])*j+F[1],z:(z[2]*Q+z[6]*Y+z[10]*O+z[14])*j+F[2]}}function S(D){let I=D.cropSize[0]/2,L=D.cropSize[1]/2,z=D.cropSize[2]/2,F=[D.cropCenter[0]-I,D.cropCenter[1]-L,D.cropCenter[2]-z,D.cropCenter[0]+I,D.cropCenter[1]+L,D.cropCenter[2]+z],Q=A(D.cropRotation);return Object.assign(F,{invRotationMatrix:Q,cropCenter:D.cropCenter})}function A(D){let I=[],L=D[0]*Math.PI/180,z=D[1]*Math.PI/180,F=D[2]*Math.PI/180,Q=Math.cos(L),Y=Math.sin(L),O=Math.cos(z),j=Math.sin(z),V=Math.cos(F),W=Math.sin(F),J=Q*V,ce=Q*W,$=Y*V,ne=Y*W;return I[0]=O*V,I[1]=-O*W,I[2]=j,I[4]=ce+$*j,I[5]=J-ne*j,I[6]=-Y*O,I[8]=ne-J*j,I[9]=$+ce*j,I[10]=Q*O,I[12]=0,I[13]=0,I[14]=0,I[3]=0,I[7]=0,I[11]=0,I[15]=1,I}function T(D,I,L,z){return D>=z[0]&&D<=z[3]&&I>=z[1]&&I<=z[4]&&L>=z[2]&&L<=z[5]}function E(D){let I=2/D.cropSize[0],L=2/D.cropSize[1],z=2/D.cropSize[2],F=A(D.cropRotation);return{invRadiusX:I,invRadiusY:L,invRadiusZ:z,cropCenter:D.cropCenter,invRotationMatrix:F}}function C(D,I,L,z){let F=(D-z.cropCenter[0])*z.invRadiusX,Q=(I-z.cropCenter[1])*z.invRadiusY,Y=(L-z.cropCenter[2])*z.invRadiusZ;return F*F+Q*Q+Y*Y<=1}e.onmessage=D=>{if(D.data.getCroppedIndexes){let I=new Uint32Array(w(new Float32Array(D.data.positions),D.data.crops)).buffer;e.postMessage({outOfBoundsIndexes:I},[I])}else if(D.data.positions)h=D.data.positions,p=new Float32Array(h),v=D.data.meshMatrixWorlds,g=D.data.cropsArray,f=D.data.meshIndexIntervals,x(v,g,f),e.postMessage({sortSetupComplete:!0});else if(D.data.sort||D.data.newMatrixWorlds||D.data.newCropsArray)(D.data.newMatrixWorlds||D.data.newCropsArray)&&(g=D.data.newCropsArray||g,v=D.data.newMatrixWorlds||v,x(v,g,f)),m(D.data.sort.view,D.data.sort.cameraPosition);else if(D.data.init){d=D.data.init.Constants,i=D.data.init.splatCount;let I=d.BytesPerInt,L=d.BytesPerFloat*3,z=new Uint8Array(D.data.init.sorterWasmBytes),F=I+L,Q=i*F,Y=i*d.BytesPerInt*2+d.DepthMapRange*d.BytesPerInt*2,O=d.MemoryPageSize*32,j=Q+Y+O,V=Math.floor(j/d.MemoryPageSize)+1,W={module:{},env:{memory:new WebAssembly.Memory({initial:V*2,maximum:V*3,shared:!0})}};WebAssembly.compile(z).then(J=>WebAssembly.instantiate(J,W)).then(J=>{t=J,n=0,s=i*I,a=s+i*L,c=a+16*d.BytesPerFloat*2,o=c+i*d.BytesPerInt,l=o+d.DepthMapRange*d.BytesPerInt,u=W.env.memory.buffer,e.postMessage({sortSetupPhase1Complete:!0})})}}}function MPe(e){let t=new Worker(URL.createObjectURL(new Blob(["(",SPe.toString(),")(self)"],{type:"application/javascript"}))),i=atob(_Pe),r=new Uint8Array(i.length);for(let n=0;n<i.length;n++)r[n]=i.charCodeAt(n);return t.postMessage({init:{sorterWasmBytes:r.buffer,splatCount:e,Constants:{BytesPerFloat:Td.BytesPerFloat,BytesPerInt:Td.BytesPerInt,DepthMapRange:Td.DepthMapRange,MemoryPageSize:Td.MemoryPageSize}}}),t}var sR=function(){let e=new Float32Array(1),t=new Int32Array(e.buffer);return function(i){return e[0]=i,t[0]}}(),EPe=function(e,t,i,r){return e+(t<<8)+(i<<16)+(r<<24)},US=new ve;function qj(e){let t=!1;return e.scene.objects.traverse((i,r)=>{if(r.visible===!1)return!0;r.type==="Splat"&&(t=!0)}),t}var ME=class extends zr{constructor(e,t,i,r,n=!1,s=1,a,o){super(i,r),this.splatCount=t,this.meshIndexIntervals=a,this.meshMatrixWorlds=o,this.splatBuffers=e,this.geometry=i,this.material=r,this.splatDataTextures=null,this.halfPrecisionCovariancesOnGPU=n,this.devicePixelRatio=s,this.resetLocalSplatDataAndTexturesFromSplatBuffer()}static buildMesh(e,t,i=!1,r=1,n,s){let a=ME.buildGeomtery(t),o=ME.buildMaterial(n);return new ME(e,t,a,o,i,r,n,s)}static buildMaterial(e){let t=`
            precision highp float;
            #include <common>

            attribute uint splatIndex;

            uniform highp sampler2D covariancesTexture;
            uniform highp usampler2D centersColorsTexture;
            uniform vec2 focal;
            uniform vec2 viewport;
            uniform vec2 basisViewport;
            uniform vec2 covariancesTextureSize;
            uniform vec2 centersColorsTextureSize;
						uniform highp sampler2D meshMatrixWorldsTexture;
						uniform uint meshIndexIntervals[257];
						uniform float orthoZoom;

            varying vec4 vColor;
            varying vec2 vUv;

            varying vec2 vPosition;

            const vec4 encodeNorm4 = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0);
            const uvec4 mask4 = uvec4(uint(0x000000FF), uint(0x0000FF00), uint(0x00FF0000), uint(0xFF000000));
            const uvec4 shift4 = uvec4(0, 8, 16, 24);
            vec4 uintToRGBAVec (uint u) {
               uvec4 urgba = mask4 & u;
               urgba = urgba >> shift4;
               vec4 rgba = vec4(urgba) * encodeNorm4;
               return rgba;
            }

            vec2 getDataUV(in int stride, in int offset, in vec2 dimensions) {
                vec2 samplerUV = vec2(0.0, 0.0);
                float d = float(splatIndex * uint(stride) + uint(offset)) / dimensions.x;
                samplerUV.y = float(floor(d)) / dimensions.y;
                samplerUV.x = fract(d);
                return samplerUV;
            }

            void main () {
                uvec4 sampledCenterColor = texture(centersColorsTexture, getDataUV(1, 0, centersColorsTextureSize));
                vec3 splatCenter = uintBitsToFloat(uvec3(sampledCenterColor.gba));
                vColor = uintToRGBAVec(sampledCenterColor.r);

                vPosition = position.xy * 2.0;

								uint meshIndex;
								for (int i = 1; i < 257; i++) {
									if (splatIndex < meshIndexIntervals[i]) {
										meshIndex = uint(i - 1);
										break;
									}
								}

								float strideMulmeshIndex = float(4u*meshIndex);
								float meshMatrixWorldsTextureLength = float(256*4);

								mat4 modelMat = mat4(
									texture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+0.0)/meshMatrixWorldsTextureLength, 0)),
									texture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+1.0)/meshMatrixWorldsTextureLength, 0)),
									texture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+2.0)/meshMatrixWorldsTextureLength, 0)),
									texture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+3.0)/meshMatrixWorldsTextureLength, 0))
								);
								mat4 modelViewMat = viewMatrix * modelMat;
								vec4 viewCenter = modelViewMat * vec4(splatCenter, 1.0); 
                vec4 clipCenter = projectionMatrix * viewCenter;

                vec2 sampledCovarianceA = texture(covariancesTexture, getDataUV(3, 0, covariancesTextureSize)).rg;
                vec2 sampledCovarianceB = texture(covariancesTexture, getDataUV(3, 1, covariancesTextureSize)).rg;
                vec2 sampledCovarianceC = texture(covariancesTexture, getDataUV(3, 2, covariancesTextureSize)).rg;

                vec3 cov3D_M11_M12_M13 = vec3(sampledCovarianceA.rg, sampledCovarianceB.r);
                vec3 cov3D_M22_M23_M33 = vec3(sampledCovarianceB.g, sampledCovarianceC.rg);

                // Compute the 2D covariance matrix from the upper-right portion of the 3D covariance matrix
                mat3 Vrk = mat3(
                    cov3D_M11_M12_M13.x, cov3D_M11_M12_M13.y, cov3D_M11_M12_M13.z,
                    cov3D_M11_M12_M13.y, cov3D_M22_M23_M33.x, cov3D_M22_M23_M33.y,
                    cov3D_M11_M12_M13.z, cov3D_M22_M23_M33.y, cov3D_M22_M23_M33.z
                );
                float s = 1.0 / (viewCenter.z * viewCenter.z);

                mat3 W = transpose(mat3(modelViewMat));
                mat3 T = orthoZoom > 0.0 ? W : W * mat3(
									focal.x / viewCenter.z, 0., -(focal.x * viewCenter.x) * s,
									0., focal.y / viewCenter.z, -(focal.y * viewCenter.y) * s,
									0., 0., 0.
								);
                mat3 cov2Dm = transpose(T) * Vrk * T;
                cov2Dm[0][0] += 0.3;
                cov2Dm[1][1] += 0.3;

                // We are interested in the upper-left 2x2 portion of the projected 3D covariance matrix because
                // we only care about the X and Y values. We want the X-diagonal, cov2Dm[0][0],
                // the Y-diagonal, cov2Dm[1][1], and the correlation between the two cov2Dm[0][1]. We don't
                // need cov2Dm[1][0] because it is a symetric matrix.
                vec3 cov2Dv = vec3(cov2Dm[0][0], cov2Dm[0][1], cov2Dm[1][1]);

                vec3 ndcCenter = clipCenter.xyz / clipCenter.w;

                // We now need to solve for the eigen-values and eigen vectors of the 2D covariance matrix
                // so that we can determine the 2D basis for the splat. This is done using the method described
                // here: https://people.math.harvard.edu/~knill/teaching/math21b2004/exhibits/2dmatrices/index.html
                //
                // This is a different approach than in the original work at INRIA. In that work they compute the
                // max extents of the 2D covariance matrix in screen space to form an axis aligned bounding rectangle
                // which forms the geometry that is actually rasterized. They then use the inverse 2D covariance
                // matrix (called 'conic') to determine fragment opacity.
                float a = cov2Dv.x;
                float d = cov2Dv.z;
                float b = cov2Dv.y;
                float D = a * d - b * b;
                float trace = a + d;
                float traceOver2 = 0.5 * trace;
                float term2 = sqrt(trace * trace / 4.0 - D);
                float eigenValue1 = traceOver2 + term2;
								float eigenValue2 = max(traceOver2 - term2, 0.00); // prevent negative eigen value

                const float maxSplatSize = 1024.0;
                vec2 eigenVector1 = normalize(vec2(b, eigenValue1 - a));
                // since the eigen vectors are orthogonal, we derive the second one from the first
                vec2 eigenVector2 = vec2(eigenVector1.y, -eigenVector1.x);
                vec2 basisVector1 = eigenVector1 * min(sqrt(2.0 * eigenValue1), maxSplatSize);
                vec2 basisVector2 = eigenVector2 * min(sqrt(2.0 * eigenValue2), maxSplatSize);

                vec2 ndcOffset = vec2(vPosition.x * basisVector1 + vPosition.y * basisVector2) * basisViewport;

								if (orthoZoom > 0.0) {
									ndcOffset *= orthoZoom;
								}

                gl_Position = vec4(ndcCenter.xy + ndcOffset, ndcCenter.z, 1.0);
            }`,i=`
            precision highp float;
            #include <common>

            uniform vec3 debugColor;

            varying vec4 vColor;
            varying vec2 vUv;

            varying vec2 vPosition;
						layout(location = 1) out vec4 gVelocity; 

            void main () {
                // compute the negative squared distance from the center of the splat to the
                // current fragment in the splat's local space.
                float A = -dot(vPosition, vPosition);
                if (A < -4.0) discard;
                vec3 color = vColor.rgb;
                A = exp(A) * vColor.a;
                gl_FragColor = vec4(color.rgb, A);
								gVelocity = vec4(0.0); // so it is ignored by TAA
            }`,r={covariancesTexture:{type:"t",value:null},centersColorsTexture:{type:"t",value:null},meshIndexIntervals:{value:e},meshMatrixWorldsTexture:{type:"t",value:null},focal:{type:"v2",value:new ve},viewport:{type:"v2",value:new ve},basisViewport:{type:"v2",value:new ve},debugColor:{type:"v3",value:new jt},covariancesTextureSize:{type:"v2",value:new ve(1024,1024)},centersColorsTextureSize:{type:"v2",value:new ve(1024,1024)},orthoZoom:{type:"f",value:-1}};return new Ui({uniforms:r,vertexShader:t,fragmentShader:i,transparent:!0,alphaTest:1,blending:_f,depthTest:!0,depthWrite:!1,side:Ws})}static buildGeomtery(e){let t=new Bt;t.setIndex([0,1,2,0,2,3]);let i=new Float32Array(4*3),r=new $t(i,3);t.setAttribute("position",r),r.setXYZ(0,-1,-1,0),r.setXYZ(1,-1,1,0),r.setXYZ(2,1,1,0),r.setXYZ(3,1,-1,0),r.needsUpdate=!0;let n=new aQ().copy(t),s=new Uint32Array(e),a=new L1(s,1,!1);return a.setUsage(Aoe),n.setAttribute("splatIndex",a),n.instanceCount=e,n}resetLocalSplatDataAndTexturesFromSplatBuffer(){this.updateLocalSplatDataFromSplatBuffer(),this.allocateAndStoreLocalSplatDataInTextures()}updateLocalSplatDataFromSplatBuffer(){this.splatBuffers.forEach(r=>r.buildPreComputedBuffers()),this.covariances=new Float32Array(this.splatCount*6),this.colors=new Uint8Array(this.splatCount*4),this.centers=new Float32Array(this.splatCount*3);let e=0,t=0,i=0;for(let r of this.splatBuffers){let n=r.nsplats;this.colors.subarray(e,e+n*4).set(r.colorsA),e+=n*4,this.centers.subarray(t,t+n*3).set(r.decoded.xyz.denormDequant().data),t+=n*3,this.covariances.subarray(i,i+n*6).set(new Float32Array(r.precomputedCovarianceBufferData)),i+=n*6}}allocateAndStoreLocalSplatDataInTextures(){let e=this.splatCount,t=new ve(4096,1024);for(;t.x*t.y*2<e*6;)t.y*=2;let i=new ve(4096,1024);for(;i.x*i.y*4<e*4;)i.y*=2;let r,n;if(this.halfPrecisionCovariancesOnGPU){n=new Uint16Array(t.x*t.y*2);for(let u=0;u<this.covariances.length;u++)n[u]=ife.toHalfFloat(this.covariances[u]);r=new Yo(n,t.x,t.y,fA,ch)}else n=new Float32Array(t.x*t.y*2),n.set(this.covariances),r=new Yo(n,t.x,t.y,fA,Sn);r.needsUpdate=!0,this.material.uniforms.covariancesTexture.value=r,this.material.uniforms.covariancesTextureSize.value.copy(t);let s=new Uint32Array(i.x*i.y*4);for(let u=0;u<e;u++){let h=u*4,d=u*3,p=u*4;s[p]=EPe(this.colors[h],this.colors[h+1],this.colors[h+2],this.colors[h+3]),s[p+1]=sR(this.centers[d]),s[p+2]=sR(this.centers[d+1]),s[p+3]=sR(this.centers[d+2])}let a=new Yo(s,i.x,i.y,SY,qu);a.internalFormat="RGBA32UI",a.needsUpdate=!0,this.material.uniforms.centersColorsTexture.value=a,this.material.uniforms.centersColorsTextureSize.value.copy(i);let o=256*4,l=new Float32Array(256*16);for(let u=0;u<this.meshMatrixWorlds.length;u++)l.set(this.meshMatrixWorlds[u].elements,u*16);let c=new Yo(l,o,1,is,Sn);c.needsUpdate=!0,this.material.uniforms.meshMatrixWorldsTexture.value=c,this.material.uniformsNeedUpdate=!0,this.splatDataTextures={covariances:{data:n,texture:r,size:t},centerColors:{data:s,texture:a,size:i},meshMatrixWorlds:{data:l,texture:c}}}updateIndexes(e){let t=this.geometry;t.attributes.splatIndex.set(e),t.attributes.splatIndex.needsUpdate=!0,t.instanceCount=e.length}updateUniforms(e,t,i,r){this.splatCount>0&&(US.set(e.x*this.devicePixelRatio,e.y*this.devicePixelRatio),this.material.uniforms.viewport.value.copy(US),this.material.uniforms.basisViewport.value.set(2/US.x,2/US.y),this.material.uniforms.focal.value.set(t,i),this.material.uniforms.orthoZoom.value=r,this.material.uniformsNeedUpdate=!0)}getSplatDataTextures(){return this.splatDataTextures}getSplatCount(){return this.splatCount}getCenters(){return this.centers}getColors(){return this.colors}getCovariances(){return this.covariances}dispose(){this.geometry.dispose(),this.material.dispose(),this.splatDataTextures&&(this.splatDataTextures.covariances.texture.dispose(),this.splatDataTextures.centerColors.texture.dispose(),this.splatDataTextures.meshMatrixWorlds.texture.dispose()),this.removeFromParent()}},w$,APe=new Promise(e=>{w$=e}),Yj=!1,FS;function CPe(){if(Yj)return;if(FS)return FS;async function e(){let t=await ip(()=>import("./gaussian-splat-compression-ro4O0smp.js"),[]);w$(t),Yj=!0}return FS=e(),FS}var b$;APe.then(e=>b$=e);var TPe=class{constructor(e={}){yx(this,"updateView",function(){let t=new ht,i=[],r=new B(0,0,-1),n=new B(0,0,-1),s=new B,a=new B;return function(o=!1,l){let c=this.updateMatrixWorldsInWorkerIfNeeded(),u=this.cropsChanged();if(!o){n.set(0,0,-1).applyQuaternion(l.quaternion);let d=!1,p=!1;if(n.dot(r)<=.95&&(d=!0),a.copy(l.position).sub(s).length()>=1&&(p=!0),!d&&!p&&!c&&!u&&!this.needsInitialRender)return}this.needsInitialRender=!1,s.copy(l.position),r.copy(n),t.copy(l.matrixWorld).invert(),t.premultiply(this.dummyPerspectiveMatrix),i[0]=l.position.x,i[1]=l.position.y,i[2]=l.position.z;let h={sort:{view:t.elements,cameraPosition:i,splatRenderCount:this.splatRenderCount,splatSortCount:this.splatRenderCount},...c?{newMatrixWorlds:this.meshMatrixWorlds}:{},...u?{newCropsArray:this.cropsArray}:{}};this.sortRunning?this.queuedMessage=h:(this.queuedMessage=null,this.sortRunning=!0,this.sortWorker.postMessage(h))}}()),this.scene=e.scene,this.currentPage=null,this.devicePixelRatio=window.devicePixelRatio,this.sortWorker=null,this.splatRenderCount=0,this.splatSortCount=0,this.splatMesh=null,this.sortRunning=!1,this.meshMatrixWorlds=null,this.meshMatrixWorldsOld=null,this.cropsArray=null,this.splatEntries=null,this.queuedMessage=null,this.needsInitialRender=!0,this.dummyPerspectiveMatrix=new ht().makePerspective(-1,1,-1,1,.1,1e3)}updateSplatMeshUniforms(e,t){let i=new ve;this.splatMesh!==null&&this.splatMesh.getSplatCount()>0&&(e.getSize(i),this.cameraFocalLengthX=t.projectionMatrix.elements[0]*this.devicePixelRatio*i.x*.45,this.cameraFocalLengthY=t.projectionMatrix.elements[5]*this.devicePixelRatio*i.y*.45,this.splatMesh.updateUniforms(i,this.cameraFocalLengthX,this.cameraFocalLengthY,t.isPerspectiveCamera?-1:t.zoom*this.devicePixelRatio))}loadSplat(e={}){this.activePage=this.scene.activePage,e.position&&(e.position=new B().fromArray(e.position)),e.orientation&&(e.orientation=new ei().fromArray(e.orientation)),e.halfPrecisionCovariances=!!e.halfPrecisionCovariances;let t=[];if(this.splatEntries=t,this.activePage.traverseVisibleEntity(s=>{s.data.type==="Splat"&&t.push(s)}),this.splatMesh&&this.splatMesh.dispose(),t.length===0)return this.splatMesh=null,!1;this.meshMatrixWorlds=t.map(s=>s.matrixWorld),this.meshMatrixWorldsOld=t.map(s=>s.matrixWorld.clone()),this.cropsArray=t.map(s=>s.data.crops.map(a=>a.data));let i=t.map(s=>new b$.GSplineBuffer(new Uint8Array(s.data.buffer).buffer)),r=0,n=[0];for(let s of i)r+=s.getSplatCount(),n.push(r);return this.setupSplatMesh(i,r,e.position,e.orientation,e.halfPrecisionCovariances,this.devicePixelRatio,n,this.meshMatrixWorlds),this.setupSortWorker(r),!0}updateMatrixWorldsInWorkerIfNeeded(){let e=this.splatDataTextures.meshMatrixWorlds.data;for(let t=0;t<this.meshMatrixWorlds.length;t++)e.set(this.meshMatrixWorlds[t].elements,t*16);return this.splatDataTextures.meshMatrixWorlds.texture.needsUpdate=!0,this.meshMatrixWorlds.every((t,i)=>t.equals(this.meshMatrixWorldsOld[i]))?!1:(this.meshMatrixWorldsOld=this.meshMatrixWorlds.map(t=>t.clone()),!0)}cropsChanged(){let e=!1;return this.splatEntries.forEach((t,i)=>{var r;t.data.crops.forEach((n,s)=>{this.cropsArray[i][s]===void 0?(e=!0,this.cropsArray[i][s]=n.data):Object.entries(n.data).forEach(([a,o])=>{var l;Array.isArray(o)&&o.some((c,u)=>c!==this.cropsArray[i][s][a][u])?(e=!0,this.cropsArray[i][s][a]=o):o!==((l=this.cropsArray[i][s])==null?void 0:l[a])&&(e=!0,this.cropsArray[i][s][a]=o)})}),t.data.crops.length!==((r=this.cropsArray[i])==null?void 0:r.length)&&(this.cropsArray[i].length=t.data.crops.length,e=!0)}),e}setupSplatMesh(e,t,i=new B,r=new ei,n=!1,s=1,a,o){this.splatMesh=ME.buildMesh(e,t,n,s,a,o),this.splatMesh.position.copy(i),this.splatMesh.quaternion.copy(r),this.splatMesh.frustumCulled=!1,this.splatMesh.renderOrder=99999,this.splatRenderCount=t,this.splatMesh.onBeforeRender=(l,c,u)=>this.update(l,u)}setupSortWorker(e){this.sortWorker=MPe(e),this.sortWorker.onmessage=t=>{var i;t.data.sortDone?(this.sortRunning=!1,(i=this.splatMesh)==null||i.updateIndexes(new Uint32Array(t.data.indexesBuffer)),this.lastSortTime=t.data.sortTime,this.queuedMessage&&(this.sortWorker.postMessage(this.queuedMessage),this.queuedMessage=null)):t.data.sortCanceled?this.sortRunning=!1:t.data.sortSetupPhase1Complete?this.sortWorker.postMessage({positions:this.splatMesh.getCenters().buffer,meshMatrixWorlds:this.splatMesh.meshMatrixWorlds,meshIndexIntervals:this.splatMesh.meshIndexIntervals,cropsArray:this.cropsArray}):t.data.sortSetupComplete&&(this.splatDataTextures=this.splatMesh.getSplatDataTextures(),this.scene.activePage.add(this.splatMesh),this.needsInitialRender=!0)}}update(e,t){this.splatMesh!==null&&(this.updateSplatMeshUniforms(e,t),this.updateView(!1,t))}getSplatMesh(){return this.splatMesh}},vz=new uh;vz.wireframe=!0;var Qj=new B,Rk=class extends Uc{constructor(e,t){super(),this.data=e,this.sharedAssets=t,this.enableHelpers=!1,this.wireframeState=!1,this.needsTransmissionDirty=!0,this.needsNormalDirty=!0,this._needsTransmission=!1,this._needsNormal=!1,this.geometryCacheChanged=!1,this.splatViewer=null,this.entityByUuid={},this.entityIdentityToEntity={},this.toExpandCloner=new Set,this.toUpdateCloner=new Set,this.pendingCommands=[],this.pathConstraints=new bPe,this.invisibleObjects=new Rv("jflkdsafjasdifjaslk",{...MO.defaultData,visible:!1,name:"buildin invisible"}),this.needsRecomputeInstances=!1,this.init(e,t),this.matrixAutoUpdate=!1,this.errorPage=new es("fdasfa",{...i0.defaultData,name:""},{shared:t,scene:this})}markGeometryCacheDirty(){this.geometryCacheChanged=!0}markNeedsUpdateRendererDirty(){this.needsTransmissionDirty=!0,this.needsNormalDirty=!0}needsTransmission(){return this.needsTransmissionDirty&&(this._needsTransmission=vPe(this),this.needsTransmissionDirty=!1),this._needsTransmission}needsNormal(){return this.needsNormalDirty&&(this._needsNormal=gPe(this),this.needsNormalDirty=!1),this._needsNormal}registerInstanceAndSetUuid(e){let t=e.identity.join("-"),i=this.entityIdentityToEntity[t];i&&(e.uuid=i.uuid),this.entityIdentityToEntity[t]=e,this.entityByUuid[e.uuid]=e}markPenumbraSizeDirty(){for(let e of this.children)e instanceof es&&(e.penumbraSizeArrayCache=null)}findInstance(e){return this.entityIdentityToEntity[e.join("-")]}get bgColor(){return this.activePage.bgColor}get postprocessing(){return this.activePage.data.postprocessing}getWithSortKey(e){let t=this.find(e);if(t===void 0)return;let i=[],r=t;for(;r!==this;){let n=r;r=r.parent;let s=r.children.indexOf(n);i.splice(0,0,s)}return{entity:t,sortKey:i}}getAllSorted(e){let t=[];for(let i of e){let r=this.getWithSortKey(i.id);r!==void 0&&t.push(r)}return t.sort((i,r)=>QQ(i.sortKey,r.sortKey)),t.map(i=>i.entity)}nonExistOrDescendantOf(e,t){let i=this.find(e);if(i===void 0)return!0;for(;i;){if(i.uuid===t)return!0;i=i.parent}return!1}find(e){if(this.activePage&&this.activePage.personalCamera.parent){if(e==="f23858d0-4a3b-4bd8-8173-66ed0af7f6fb-personalCamera")return this.activePage.personalCamera;if(e===L0)return this.activePage.personalCamera}if(e===""||e===void 0)return;let t=this.entityByUuid[e];return t===void 0?this.getObjectByProperty("uuid",e):t}find2D(e){for(let t of this.children)if(t instanceof es&&t.uiScene){let i=t.uiScene.find(e);if(i)return i}}findScene2DfromObject2D(e){for(let t of this.children)if(t instanceof es&&t.uiScene&&t.uiScene.find(e))return t.uiScene}find2DInUIObjects(e){let t;return this.traverseEntity(i=>{t===void 0&&i instanceof js&&(t=i.uiCanvas.find(e))}),t}traverse2D(e){for(let t of this.children)t instanceof es&&t.uiScene&&t.uiScene.traverse(e)}debugEnsureEntity(e){let t=this.find(e);if(t){if(Array.isArray(t.identity)&&this.findInstance(t.identity)===void 0){console.error("not found instance");debugger}}else{console.error("not found");debugger}}addPendingExpandCloner(e){this.toExpandCloner.add(e)}addPendingUpdateCloner(e){this.toUpdateCloner.add(e)}markToExpandCloner(e){this.toExpandCloner.add(e),e.traverseEntityAncestors(t=>{this.toExpandCloner.add(t)})}doPendingExpandCloner(){this.toExpandCloner.forEach(e=>{e.expandCloner(this)}),this.toExpandCloner.clear()}doPendingUpdateCloner(){this.toUpdateCloner.forEach(e=>{var t;(t=e.cloner)==null||t.update()}),this.toUpdateCloner.clear()}doPendingUpdates(){this.doPendingExpandCloner(),this.doPendingUpdateCloner(),this.applyPendingCommands()}addPendingCommand(e){this.pendingCommands.push(e)}applyPendingCommands(){this.pendingCommands.forEach(e=>e()),this.pendingCommands.length=0}updateByLibOp(e,t){e.path.length===1&&e.path[0]==="components"&&e.type===1&&this.createChildrenObjects([{...e.data.asset,id:e.id}],this.invisibleObjects,t)}updateTreeByOp(e,t){var i;if(e.path.length===0&&e.type===7){let r=e.parent===null?this:this.find(e.parent);if(r===void 0)throw new Error("unexpected");let n=this.createObject(e.id,e.data,e.children,r,e.localIndex,t);n.updateVisible(this),n.resetBBoxNeedsUpdate(),Pl(n)&&Zu(n.parent)&&(n.invalidateUpstreamBooleanData(),n.parent.invalidateDownstreamBooleanData().recomputeBoolean()),this.markNeedsRecomputeInstancesForAncessors(r),this.markNeedsRecomputeInstancesForChildren(n),this.markToExpandCloner(n),this.markPenumbraSizeDirty(),n.updatePathSnapping()}else if(e.path.length===0&&e.type===8){let r=this.find(e.id);if(r===void 0)throw new Error("unexpected");this.markToExpandCloner(r),r.resetBBoxNeedsUpdate(),this.unregisterObject(r);let n=r.parent;this.markNeedsRecomputeInstancesForAncessors(n),this.markNeedsRecomputeInstancesForChildren(r),this.markPenumbraSizeDirty(),r.parent.remove(r),Zu(r.parent)&&(r.parent.invalidateUpstreamBooleanData(),r.parent.invalidateDownstreamBooleanData().recomputeBoolean()),Pl(r)&&(r.freeBooleanPointer(),n instanceof qf&&n.invalidateDownstreamBooleanData().recomputeBoolean()),r instanceof Ck&&r.detachShape(),this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(r),this.pathConstraints.removeDependencies(r.uuid),r.updatePathSnapping()}else if(e.path.length===0&&e.type===9){let r=this.find(e.id);if(r===void 0)throw new Error("unexpected");this.markNeedsRecomputeInstancesForChildren(r);let n=r.parent;this.markNeedsRecomputeInstancesForAncessors(n),(i=r.cloner)==null||i.resetOnMove(),this.markToExpandCloner(r);let s=e.parent===null?this:this.find(e.parent);if(s===void 0)throw new Error("unexpected");s.add(r),this.markNeedsRecomputeInstancesForAncessors(s),this.markToExpandCloner(r),r.invalidateClonerTransform(r),r.updateVisible(this),r.resetBBoxNeedsUpdate(),this.markPenumbraSizeDirty();let a=e.localIndex;s.children.splice(a,0,s.children.pop()),Pl(r)&&(r.invalidateUpstreamBooleanData(),Zu(r.parent)?r.parent.invalidateDownstreamBooleanData().recomputeBoolean():n instanceof qf&&n.invalidateDownstreamBooleanData().recomputeBoolean()),r.updatePathSnapping()}this.markNeedsUpdateRendererDirty(),this.markGeometryCacheDirty()}get playPage(){return this.find(this.data.publish.playPage)??this.errorPage}updatePage(e){var t;this.activePage&&this.activePage.onDeactive(),this.activePage=this.errorPage;for(let i of this.children)i instanceof es&&(i.visible=i.uuid===e,i.visible&&(this.activePage=i,this.activePage.onActive(this)));this.activePage!==((t=this.splatViewer)==null?void 0:t.activePage)&&this.reloadSplats()}updateEntityByOp(e,t,i,r){if(t.type===0){if(("overrides"in t.props||"component"in t.props)&&this.markNeedsRecomputeInstances(),"visible"in t.props&&this.markPenumbraSizeDirty(),t.path.includes("overrides")&&"states"in t.props){let{rest:s}=t.props;t={...t,props:s},this.markNeedsRecomputeInstances()}t.path[0]==="pathSnapping"&&t.props.pathId!==void 0&&this.pathConstraints.setConstraint(e,t.props.pathId)}let n=this.find(e);if(n)try{mPe(n,t,i,{scene:this,shared:r}),n instanceof qs&&n.updateGeometryGroupsIfNeeded()}catch(s){console.error(s)}}updateEntity2DByOp(e,t,i,r,n,s=[]){e.updateEntityByOp(t,i,r,n),this.traverseEntity(a=>{(a instanceof js||a instanceof es)&&(s.includes(a.frameId??"")||a.frameId===t)&&a.updateEntity2DByOp(t,i,r,n)})}get activeCamera(){return this.activePage.activeCamera}switchActiveCamera(e){this.activePage.switchActiveCamera(e)}isInvisibleObjects(e){return e===this.invisibleObjects||e.hasAnccestor(this.invisibleObjects)}init(e,t){let i=Object.entries(t.data.lib.components).map((r,n)=>({data:r[1].asset.data,children:r[1].asset.children,id:r[0],fi:n}));this.invisibleObjects.updateState(this.invisibleObjects.data,{scene:this,shared:t}),this.add(this.invisibleObjects),this.createChildrenObjects(i,this.invisibleObjects,t),this.createChildrenObjects(e.objects,this,t),this.updatePage(e.publish.playPage),this.activePage.switchToPlayCamera(),this.expandInstances(t,!0),this.traverseEntity(r=>{r instanceof Qs&&r.updateUp()}),this.doPendingExpandCloner(),this.applyPendingCommands()}markNeedsRecomputeInstances(){this.needsRecomputeInstances=!0}markNeedsRecomputeInstancesForChildren(e){e.traverseEntity(t=>{(t.data.type==="Component"||t.data.type==="Instance")&&this.markNeedsRecomputeInstances()})}markNeedsRecomputeInstancesForAncessors(e){Pi.is(e)&&(e.data.type==="Component"&&this.markNeedsRecomputeInstances(),e.traverseAncestors(t=>{Pi.is(t)&&t.data.type==="Component"&&this.markNeedsRecomputeInstances()}))}relativeizeInner(e,t,i,r,n,s,a){if(e){let o=r.find(e);o&&o!==r&&n.forInstancesRec(l=>{l.data=H1(l.data,c=>{let u=c.events.data(a.id),h=l.goUp(s);if(h){let d=[...YQ(h.identity),e].join("-"),p=this.entityIdentityToEntity[d];if(p){let f=p.uuid,v=Bn.zoom(u,t);v[i]=f}else console.warn("cannot find instance")}}).data})}}rewriteActions(e,t,i,r,n,s){e.forEach(a=>{a.data.type==="Transition"?this.relativeizeInner(a.data.object,[...t,a.id],"object",i,r,n,s):a.data.type==="Animation"?this.relativeizeInner(a.data.object,[...t,a.id],"object",i,r,n,s):a.data.type==="Conditional"&&(this.rewriteActions(a.data.ifActions,[...t,a.id,"ifActions"],i,r,n,s),this.rewriteActions(a.data.elseActions,[...t,a.id,"elseActions"],i,r,n,s))})}rewriteEventsBeforeGoToPlayMode(){this.traverseEntity(e=>{if(e instanceof Iv&&typeof e.identity=="string"&&e.data.type==="Component")return e.traverseEntity((t,i)=>{t.data.events.forEach(r=>{if(r.data.type==="GameControl"){let n=!1;if(t.forInstancesRec(s=>{s.data=H1(s.data,a=>{s.isInstanceRoot||(a.events.delete(r.id),n=!0)}).data}),n===!1)for(let s of KA.list)this.rewriteActions(r.data.gameActions[s],["gameActions",s],e,t,i,r)}else r.data.type==="Conditional"?(r.data.condition.type==="Distance"?(this.relativeizeInner(r.data.condition.fromObject,["condition"],"fromObject",e,t,i,r),this.relativeizeInner(r.data.condition.toObject,["condition"],"toObject",e,t,i,r)):r.data.condition.type==="State"?this.relativeizeInner(r.data.condition.object,["condition"],"object",e,t,i,r):r.data.condition.type==="Comparison"&&(r.data.condition.lOperand.type==="Property"&&this.relativeizeInner(r.data.condition.lOperand.value[0],["condition","lOperand","value"],0,e,t,i,r),r.data.condition.rOperand.type==="Property"&&this.relativeizeInner(r.data.condition.rOperand.value[0],["condition","rOperand","value"],0,e,t,i,r)),this.rewriteActions(r.data.inActions,["inActions"],e,t,i,r),this.rewriteActions(r.data.outActions,["outActions"],e,t,i,r)):"actions"in r.data&&this.rewriteActions(r.data.actions,["actions"],e,t,i,r)})}),!0})}expandInstances(e,t,i){let r=new Set;this.traverseEntity(n=>{if(n instanceof Iv&&n.isInstanceRoot)return n.expandInstanceChildren({scene:this,shared:e,pendingDeletes:r}),t||n.resetBBoxNeedsUpdate(),i&&n.traverseEntity(s=>{i.addClip(s)}),!0});for(let n of r)this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(n),Pk(n)}recomputeInstances(e,t){this.needsRecomputeInstances&&(this.needsRecomputeInstances=!1,this.traverseEntity(i=>{i instanceof Iv&&i.isInstanceRoot&&(i.component=void 0)}),this.expandInstances(e,!1,t))}disposeAndUnregisterEntityRecursivelyIfNotReregistered(e){e.traverseEntity(t=>{let i=typeof t.identity=="string"?t.identity:t.identity.join("-");this.entityIdentityToEntity[i]===t&&(delete this.entityByUuid[t.uuid],delete this.entityIdentityToEntity[i]),t.dispose()})}clearScene(){for(let e of this.children)Pi.is(e)&&e.disposeRecursively();this.children.length=0}resetAfterClear(e,t){this.init(e,t)}raycast(e){return this.raycast1(e,!1)}raycast1(e,t){let i=[],r=n=>{for(let s of n.children){let a=s.cloner;if(Pi.is(s)&&!s.raycastLock&&(s.visible||a!=null&&a.object.data.visible))if(t===!0&&s.isInstanceRoot){let o=[];if(e.intersectObject(s,!0,o),o.length){let l=o[0];l.object=s,l.point.applyMatrix4(l.object.matrixWorld);let c=s.matrixWorld.clone().invert();l.point.applyMatrix4(c),i.push(l)}}else(Pl(s)||sz(s)&&this.enableHelpers&&s.objectHelper.visible)&&(e.intersectObject(s,!1,i),gz(s,e,i)),r(s)}};return r(this.activePage),i}raycastWithClones(e){let t=[],i=r=>{for(let n of r.children){let s=n.cloner;Pi.is(n)&&(n.visible||s!=null&&s.object.data.visible)&&((Pl(n)||sz(n)&&this.enableHelpers&&n.objectHelper.visible)&&(e.intersectObject(n,!1,t),gz(n,e,t,!0)),i(n))}};return i(this),t}forEachEntity(e){for(let t of this.children)Pi.is(t)&&e(t)}traverseConcreteEntity(e){for(let t of this.children)Pi.is(t)&&t.isConcreteEntity&&t.traverseEntity(e)}traverseEntity(e){for(let t of this.children)Pi.is(t)&&t.traverseEntity(e)}updateFont(e,t){this.traverseEntity(i=>{if(i instanceof qs&&i.data.type==="Mesh"&&(i.data.geometry.type==="TextGeometry"||i.data.geometry.type==="InputGeometry")&&i.data.geometry.font===e){let r=i.geometry,n=i.data.geometry;r.updateFont(e,t).then(()=>{r.update(n);let s=i.invalidateDownstreamBooleanData();Zu(s)&&s.recomputeBoolean()})}})}traverseObject(e){for(let t of this.children)K1.is(t)&&t.traverseObject(e)}traverseVisibleEntity(e){for(let t of this.children)Pi.is(t)&&t.visible&&t.traverseVisibleEntity(e)}dispose(){this.clearScene()}createChildrenObjects(e,t,i){let r=0;for(let n of e)this.createObject(n.id,n.data,n.children,t,r,i),r+=1}registerObjectCreatedInLegacy(e){this.entityByUuid[e.uuid]=e}unregisterObject(e){delete this.entityByUuid[e.uuid];for(let t of e.children)this.unregisterObject(t)}createObject(e,t,i,r,n,s){var l;let a={scene:this,shared:s},o=Dk(e,t,a);return o&&(this.entityByUuid[e]=o,r.add(o),r.children.splice(n,0,r.children.pop()),i.length>0&&(o.isInstanceRoot?console.error("instance should not have children!"):this.createChildrenObjects(i,o,s)),o.updateState(t,a),o instanceof qs&&o.updateGeometryGroupsIfNeeded(),o.updateVisible(this),o.cloner&&this.toExpandCloner.add(o),(l=t.pathSnapping)!=null&&l.pathId&&this.pathConstraints.setConstraint(e,t.pathSnapping.pathId)),t.type==="Empty"&&t.animations&&o.traverseEntity(c=>{let u=c.dataPatched;if(c instanceof qs&&u.bones&&u.boneInverses){let h=u.bones.map(f=>this.find(f)),d=u.boneInverses.map(f=>new ht().fromArray(f)),p=new gB(h,d);c.bind(p,c.bindMatrix)}else c.matrixAutoUpdate=!0}),o}getCenter(e){let t=[];for(let r=0,n=e.length;r<n;++r){let{id:s,recursive:a}=e[r],o=this.find(s),l=a?o.recursiveBBox:o.singleBBox;t.push(...l.vertices)}let i=new cn;return i.setFromPoints(t),i.getCenter(Qj),Qj}copyMatrixWorld(e,t){if(e===null){t.identity();return}let i=this.find(e);i?t.copy(i.matrixWorld):t.identity()}copyParentMatrixWorld(e,t){var r;if(e===null){t.identity();return}let i=(r=this.find(e))==null?void 0:r.parent;i?t.copy(i.matrixWorld):t.identity()}traverseMaterial(e){this.traverseEntity(t=>{if(t instanceof wa)if(Array.isArray(t.material))for(let i=0;i<t.material.length;i++)t.material[i]instanceof Yd&&e(t.material[i]);else t.material instanceof Yd&&e(t.material)})}updateViewPlaneSize(e,t,i=!1){this.traverseConcreteEntity(r=>{r instanceof Qs&&r.setViewplaneSize(e,t,i)})}initializeSplatViewer(){this.splatViewer=new TPe({scene:this}),this.reloadSplats()}reloadSplats(){var e;(e=this.splatViewer)==null||e.loadSplat()}},EE=(e,t)=>{let i=t.x-e.x,r=t.y-e.y;return Math.sqrt(i*i+r*r)},PPe=(e,t)=>{let i=t.x-e.x,r=t.y-e.y;return RPe(Math.atan2(r,i))},DPe=(e,t,i)=>{let r={x:0,y:0};return i=yz(i),r.x=e.x-t*Math.cos(i),r.y=e.y-t*Math.sin(i),r},yz=e=>e*(Math.PI/180),RPe=e=>e*(180/Math.PI),IPe=e=>isNaN(e.buttons)?e.pressure!==0:e.buttons!==0,aR=new Map,Kj=e=>{aR.has(e)&&clearTimeout(aR.get(e)),aR.set(e,setTimeout(e,100))},hC=(e,t,i)=>{let r=t.split(/[ ,]+/g),n;for(let s=0;s<r.length;s+=1)n=r[s],e.addEventListener?e.addEventListener(n,i,!1):e.attachEvent&&e.attachEvent(n,i)},Zj=(e,t,i)=>{let r=t.split(/[ ,]+/g),n;for(let s=0;s<r.length;s+=1)n=r[s],e.removeEventListener?e.removeEventListener(n,i):e.detachEvent&&e.detachEvent(n,i)},_$=e=>(e.preventDefault(),e.type.match(/^touch/)?e.changedTouches:e),$j=()=>{if(typeof window>"u")return;let e=window.pageXOffset!==void 0?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,t=window.pageYOffset!==void 0?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;return{x:e,y:t}},xz=(e,t)=>{t.top||t.right||t.bottom||t.left?(e.style.top=t.top,e.style.right=t.right,e.style.bottom=t.bottom,e.style.left=t.left):(e.style.left=t.x+"px",e.style.top=t.y+"px")},Ik=(e,t,i)=>{let r=S$(e);for(let n in r)if(r.hasOwnProperty(n))if(typeof t=="string")r[n]=t+" "+i;else{let s="";for(let a=0,o=t.length;a<o;a+=1)s+=t[a]+" "+i+", ";r[n]=s.slice(0,-2)}return r},LPe=(e,t)=>{let i=S$(e);for(let r in i)i.hasOwnProperty(r)&&(i[r]=t);return i},S$=e=>{let t={};return t[e]="",["webkit","Moz","o"].forEach(function(i){t[i+e.charAt(0).toUpperCase()+e.slice(1)]=""}),t},oR=(e,t)=>{for(let i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},OPe=(e,t)=>{let i={};for(let r in e)e.hasOwnProperty(r)&&t.hasOwnProperty(r)?i[r]=t[r]:e.hasOwnProperty(r)&&(i[r]=e[r]);return i},wz=(e,t)=>{if(e.length)for(let i=0,r=e.length;i<r;i+=1)t(e[i]);else t(e)},zPe=(e,t,i)=>({x:Math.min(Math.max(e.x,t.x-i),t.x+i),y:Math.min(Math.max(e.y,t.y-i),t.y+i)});typeof window<"u"&&(M$="ontouchstart"in window,E$=!!window.PointerEvent,A$=!!window.MSPointerEvent);var M$,E$,A$,Gy={touch:{start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},mouse:{start:"mousedown",move:"mousemove",end:"mouseup"},pointer:{start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"},MSPointer:{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}},ov,J1={};E$?ov=Gy.pointer:A$?ov=Gy.MSPointer:M$?(ov=Gy.touch,J1=Gy.mouse):ov=Gy.mouse;function am(){}am.prototype.on=function(e,t){var i=this,r=e.split(/[ ,]+/g),n;i._handlers_=i._handlers_||{};for(var s=0;s<r.length;s+=1)n=r[s],i._handlers_[n]=i._handlers_[n]||[],i._handlers_[n].push(t);return i};am.prototype.off=function(e,t){var i=this;return i._handlers_=i._handlers_||{},e===void 0?i._handlers_={}:t===void 0?i._handlers_[e]=null:i._handlers_[e]&&i._handlers_[e].indexOf(t)>=0&&i._handlers_[e].splice(i._handlers_[e].indexOf(t),1),i};am.prototype.trigger=function(e,t){var i=this,r=e.split(/[ ,]+/g),n;i._handlers_=i._handlers_||{};for(var s=0;s<r.length;s+=1)n=r[s],i._handlers_[n]&&i._handlers_[n].length&&i._handlers_[n].forEach(function(a){a.call(i,{type:n,target:i},t)})};am.prototype.config=function(e){var t=this;t.options=t.defaults||{},e&&(t.options=OPe(t.options,e))};am.prototype.bindEvt=function(e,t){var i=this;return i._domHandlers_=i._domHandlers_||{},i._domHandlers_[t]=function(){typeof i["on"+t]=="function"?i["on"+t].apply(i,arguments):console.warn('[WARNING] : Missing "on'+t+'" handler.')},hC(e,ov[t],i._domHandlers_[t]),J1[t]&&hC(e,J1[t],i._domHandlers_[t]),i};am.prototype.unbindEvt=function(e,t){var i=this;return i._domHandlers_=i._domHandlers_||{},Zj(e,ov[t],i._domHandlers_[t]),J1[t]&&Zj(e,J1[t],i._domHandlers_[t]),delete i._domHandlers_[t],this};var Lk=am;function Vn(e,t){return this.identifier=t.identifier,this.position=t.position,this.frontPosition=t.frontPosition,this.collection=e,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:1,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(t),this.options.mode==="dynamic"&&(this.options.restOpacity=0),this.id=Vn.id,Vn.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}Vn.prototype=new Lk;Vn.constructor=Vn;Vn.id=0;Vn.prototype.buildEl=function(e){return this.ui={},this.options.dataOnly?this:(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front),this)};Vn.prototype.stylize=function(){if(this.options.dataOnly)return this;var e=this.options.fadeTime+"ms",t=LPe("borderRadius","50%"),i=Ik("transition","opacity",e),r={};return r.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},r.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:"rgba(255, 255, 255, .4)",border:"solid 2px rgba(0, 0, 0, .1)"},r.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:"rgba(255, 255, 255, .8)",border:"solid 2px rgba(0, 0, 0, .1)"},oR(r.el,i),this.options.shape==="circle"&&oR(r.back,t),oR(r.front,t),this.applyStyles(r),this};Vn.prototype.applyStyles=function(e){for(var t in this.ui)if(this.ui.hasOwnProperty(t))for(var i in e[t])this.ui[t].style[i]=e[t][i];return this};Vn.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)?this:(this.options.zone.appendChild(this.ui.el),this)};Vn.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)?this:(this.options.zone.removeChild(this.ui.el),this)};Vn.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()};Vn.prototype.show=function(e){var t=this;return t.options.dataOnly||(clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.addToDom(),t.restCallback(),setTimeout(function(){t.ui.el.style.opacity=1},0),t.showTimeout=setTimeout(function(){t.trigger("shown",t.instance),typeof e=="function"&&e.call(this)},t.options.fadeTime)),t};Vn.prototype.hide=function(e){var t=this;if(t.options.dataOnly)return t;if(t.ui.el.style.opacity=t.options.restOpacity,clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.removeTimeout=setTimeout(function(){var i=t.options.mode==="dynamic"?"none":"block";t.ui.el.style.display=i,typeof e=="function"&&e.call(t),t.trigger("hidden",t.instance)},t.options.fadeTime),t.options.restJoystick){let i=t.options.restJoystick,r={};r.x=i===!0||i.x!==!1?0:t.instance.frontPosition.x,r.y=i===!0||i.y!==!1?0:t.instance.frontPosition.y,t.setPosition(e,r)}return t};Vn.prototype.setPosition=function(e,t){var i=this;i.frontPosition={x:t.x,y:t.y};var r=i.options.fadeTime+"ms",n={};n.front=Ik("transition",["top","left"],r);var s={front:{}};s.front={left:i.frontPosition.x+"px",top:i.frontPosition.y+"px"},i.applyStyles(n),i.applyStyles(s),i.restTimeout=setTimeout(function(){typeof e=="function"&&e.call(i),i.restCallback()},i.options.fadeTime)};Vn.prototype.restCallback=function(){var e=this,t={};t.front=Ik("transition","none",""),e.applyStyles(t),e.trigger("rested",e.instance)};Vn.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}};Vn.prototype.computeDirection=function(e){var t=e.angle.radian,i=Math.PI/4,r=Math.PI/2,n,s,a;if(t>i&&t<i*3&&!e.lockX?n="up":t>-i&&t<=i&&!e.lockY?n="left":t>-i*3&&t<=-i&&!e.lockX?n="down":e.lockY||(n="right"),e.lockY||(t>-r&&t<r?s="left":s="right"),e.lockX||(t>0?a="up":a="down"),e.force>this.options.threshold){var o={},l;for(l in this.direction)this.direction.hasOwnProperty(l)&&(o[l]=this.direction[l]);var c={};this.direction={x:s,y:a,angle:n},e.direction=this.direction;for(l in o)o[l]===this.direction[l]&&(c[l]=!0);if(c.x&&c.y&&c.angle)return e;(!c.x||!c.y)&&this.trigger("plain",e),c.x||this.trigger("plain:"+s,e),c.y||this.trigger("plain:"+a,e),c.angle||this.trigger("dir dir:"+n,e)}else this.resetDirection();return e};var NPe=Vn;function un(e,t){var i=this;i.nipples=[],i.idles=[],i.actives=[],i.ids=[],i.pressureIntervals={},i.manager=e,i.id=un.id,un.id+=1,i.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:1,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},i.config(t),(i.options.mode==="static"||i.options.mode==="semi")&&(i.options.multitouch=!1),i.options.multitouch||(i.options.maxNumberOfNipples=1);let r=getComputedStyle(i.options.zone.parentElement);return r&&r.display==="flex"&&(i.parentIsFlex=!0),i.updateBox(),i.prepareNipples(),i.bindings(),i.begin(),i.nipples}un.prototype=new Lk;un.constructor=un;un.id=0;un.prototype.prepareNipples=function(){var e=this,t=e.nipples;t.on=e.on.bind(e),t.off=e.off.bind(e),t.options=e.options,t.destroy=e.destroy.bind(e),t.ids=e.ids,t.id=e.id,t.processOnMove=e.processOnMove.bind(e),t.processOnEnd=e.processOnEnd.bind(e),t.get=function(i){if(i===void 0)return t[0];for(var r=0,n=t.length;r<n;r+=1)if(t[r].identifier===i)return t[r];return!1}};un.prototype.bindings=function(){var e=this;e.bindEvt(e.options.zone,"start"),e.options.zone.style.touchAction="none",e.options.zone.style.msTouchAction="none"};un.prototype.begin=function(){var e=this,t=e.options;if(t.mode==="static"){var i=e.createNipple(t.position,e.manager.getIdentifier());i.add(),e.idles.push(i)}};un.prototype.createNipple=function(e,t){var i=this,r=i.manager.scroll,n={},s=i.options,a={x:i.parentIsFlex?r.x:r.x+i.box.left,y:i.parentIsFlex?r.y:r.y+i.box.top};if(e.x&&e.y)n={x:e.x-a.x,y:e.y-a.y};else if(e.top||e.right||e.bottom||e.left){var o=document.createElement("DIV");o.style.display="hidden",o.style.top=e.top,o.style.right=e.right,o.style.bottom=e.bottom,o.style.left=e.left,o.style.position="absolute",s.zone.appendChild(o);var l=o.getBoundingClientRect();s.zone.removeChild(o),n=e,e={x:l.left+r.x,y:l.top+r.y}}var c=new NPe(i,{color:s.color,size:s.size,threshold:s.threshold,fadeTime:s.fadeTime,dataOnly:s.dataOnly,restJoystick:s.restJoystick,restOpacity:s.restOpacity,mode:s.mode,identifier:t,position:e,zone:s.zone,frontPosition:{x:0,y:0},shape:s.shape});return s.dataOnly||(xz(c.ui.el,n),xz(c.ui.front,c.frontPosition)),i.nipples.push(c),i.trigger("added "+c.identifier+":added",c),i.manager.trigger("added "+c.identifier+":added",c),i.bindNipple(c),c};un.prototype.updateBox=function(){var e=this;e.box=e.options.zone.getBoundingClientRect()};un.prototype.bindNipple=function(e){var t=this,i,r=function(n,s){i=n.type+" "+s.id+":"+n.type,t.trigger(i,s)};e.on("destroyed",t.onDestroyed.bind(t)),e.on("shown hidden rested dir plain",r),e.on("dir:up dir:right dir:down dir:left",r),e.on("plain:up plain:right plain:down plain:left",r)};un.prototype.pressureFn=function(e,t,i){var r=this,n=0;clearInterval(r.pressureIntervals[i]),r.pressureIntervals[i]=setInterval((function(){var s=e.force||e.pressure||e.webkitForce||0;s!==n&&(t.trigger("pressure",s),r.trigger("pressure "+t.identifier+":pressure",s),n=s)}).bind(r),100)};un.prototype.onstart=function(e){var t=this,i=t.options,r=e;e=_$(e),t.updateBox();var n=function(s){t.actives.length<i.maxNumberOfNipples?t.processOnStart(s):r.type.match(/^touch/)&&(Object.keys(t.manager.ids).forEach(function(a){if(Object.values(r.touches).findIndex(function(l){return l.identifier===a})<0){var o=[e[0]];o.identifier=a,t.processOnEnd(o)}}),t.actives.length<i.maxNumberOfNipples&&t.processOnStart(s))};return wz(e,n),t.manager.bindDocument(),!1};un.prototype.processOnStart=function(e){var t=this,i=t.options,r,n=t.manager.getIdentifier(e),s=e.force||e.pressure||e.webkitForce||0,a={x:e.pageX,y:e.pageY},o=t.getOrCreate(n,a);o.identifier!==n&&t.manager.removeIdentifier(o.identifier),o.identifier=n;var l=function(u){u.trigger("start",u),t.trigger("start "+u.id+":start",u),u.show(),s>0&&t.pressureFn(e,u,u.identifier),t.processOnMove(e)};if((r=t.idles.indexOf(o))>=0&&t.idles.splice(r,1),t.actives.push(o),t.ids.push(o.identifier),i.mode!=="semi")l(o);else{var c=EE(a,o.position);if(c<=i.catchDistance)l(o);else{o.destroy(),t.processOnStart(e);return}}return o};un.prototype.getOrCreate=function(e,t){var i=this,r=i.options,n;return/(semi|static)/.test(r.mode)?(n=i.idles[0],n?(i.idles.splice(0,1),n):r.mode==="semi"?i.createNipple(t,e):(console.warn("Coudln't find the needed nipple."),!1)):(n=i.createNipple(t,e),n)};un.prototype.processOnMove=function(e){var t=this,i=t.options,r=t.manager.getIdentifier(e),n=t.nipples.get(r),s=t.manager.scroll;if(!IPe(e)){this.processOnEnd(e);return}if(!n){console.error("Found zombie joystick with ID "+r),t.manager.removeIdentifier(r);return}if(i.dynamicPage){var a=n.el.getBoundingClientRect();n.position={x:s.x+a.left,y:s.y+a.top}}n.identifier=r;var o=n.options.size/2,l={x:e.pageX,y:e.pageY};i.lockX&&(l.y=n.position.y),i.lockY&&(l.x=n.position.x);var c=EE(l,n.position),u=PPe(l,n.position),h=yz(u),d=c/o,p={distance:c,position:l},f,v;if(n.options.shape==="circle"?(f=Math.min(c,o),v=DPe(n.position,f,u)):(v=zPe(l,n.position,o),f=EE(v,n.position)),i.follow){if(c>o){let w=l.x-v.x,_=l.y-v.y;n.position.x+=w,n.position.y+=_,n.el.style.top=n.position.y-(t.box.top+s.y)+"px",n.el.style.left=n.position.x-(t.box.left+s.x)+"px",c=EE(l,n.position)}}else l=v,c=f;var g=l.x-n.position.x,m=l.y-n.position.y;n.frontPosition={x:g,y:m},i.dataOnly||xz(n.ui.front,n.frontPosition);var x={identifier:n.identifier,position:l,force:d,pressure:e.force||e.pressure||e.webkitForce||0,distance:c,angle:{radian:h,degree:u},vector:{x:g/o,y:-m/o},raw:p,instance:n,lockX:i.lockX,lockY:i.lockY};x=n.computeDirection(x),x.angle={radian:yz(180-u),degree:180-u},n.trigger("move",x),t.trigger("move "+n.id+":move",x)};un.prototype.processOnEnd=function(e){var t=this,i=t.options,r=t.manager.getIdentifier(e),n=t.nipples.get(r),s=t.manager.removeIdentifier(n.identifier);!n||(i.dataOnly||n.hide(function(){i.mode==="dynamic"&&(n.trigger("removed",n),t.trigger("removed "+n.id+":removed",n),t.manager.trigger("removed "+n.id+":removed",n),n.destroy())}),clearInterval(t.pressureIntervals[n.identifier]),n.resetDirection(),n.trigger("end",n),t.trigger("end "+n.id+":end",n),t.ids.indexOf(n.identifier)>=0&&t.ids.splice(t.ids.indexOf(n.identifier),1),t.actives.indexOf(n)>=0&&t.actives.splice(t.actives.indexOf(n),1),/(semi|static)/.test(i.mode)?t.idles.push(n):t.nipples.indexOf(n)>=0&&t.nipples.splice(t.nipples.indexOf(n),1),t.manager.unbindDocument(),/(semi|static)/.test(i.mode)&&(t.manager.ids[s.id]=s.identifier))};un.prototype.onDestroyed=function(e,t){var i=this;i.nipples.indexOf(t)>=0&&i.nipples.splice(i.nipples.indexOf(t),1),i.actives.indexOf(t)>=0&&i.actives.splice(i.actives.indexOf(t),1),i.idles.indexOf(t)>=0&&i.idles.splice(i.idles.indexOf(t),1),i.ids.indexOf(t.identifier)>=0&&i.ids.splice(i.ids.indexOf(t.identifier),1),i.manager.removeIdentifier(t.identifier),i.manager.unbindDocument()};un.prototype.destroy=function(){var e=this;e.unbindEvt(e.options.zone,"start"),e.nipples.forEach(function(i){i.destroy()});for(var t in e.pressureIntervals)e.pressureIntervals.hasOwnProperty(t)&&clearInterval(e.pressureIntervals[t]);e.trigger("destroyed",e.nipples),e.manager.unbindDocument(),e.off()};var BPe=un;function us(e){var t=this;t.ids={},t.index=0,t.collections=[],t.scroll=$j(),t.config(e),t.prepareCollections();var i=function(){var n;t.collections.forEach(function(s){s.forEach(function(a){n=a.el.getBoundingClientRect(),a.position={x:t.scroll.x+n.left,y:t.scroll.y+n.top}})})};if(typeof window>"u")return t.collections;hC(window,"resize",function(){Kj(i)});var r=function(){t.scroll=$j()};return hC(window,"scroll",function(){Kj(r)}),t.collections}us.prototype=new Lk;us.constructor=us;us.prototype.prepareCollections=function(){var e=this;e.collections.create=e.create.bind(e),e.collections.on=e.on.bind(e),e.collections.off=e.off.bind(e),e.collections.destroy=e.destroy.bind(e),e.collections.get=function(t){var i;return e.collections.every(function(r){return i=r.get(t),!i}),i}};us.prototype.create=function(e){return this.createCollection(e)};us.prototype.createCollection=function(e){var t=this,i=new BPe(t,e);return t.bindCollection(i),t.collections.push(i),i};us.prototype.bindCollection=function(e){var t=this,i,r=function(n,s){i=n.type+" "+s.id+":"+n.type,t.trigger(i,s)};e.on("destroyed",t.onDestroyed.bind(t)),e.on("shown hidden rested dir plain",r),e.on("dir:up dir:right dir:down dir:left",r),e.on("plain:up plain:right plain:down plain:left",r)};us.prototype.bindDocument=function(){var e=this;e.binded||(e.bindEvt(document,"move").bindEvt(document,"end"),e.binded=!0)};us.prototype.unbindDocument=function(e){var t=this;(!Object.keys(t.ids).length||e===!0)&&(t.unbindEvt(document,"move").unbindEvt(document,"end"),t.binded=!1)};us.prototype.getIdentifier=function(e){var t;return e?(t=e.identifier===void 0?e.pointerId:e.identifier,t===void 0&&(t=this.latest||0)):t=this.index,this.ids[t]===void 0&&(this.ids[t]=this.index,this.index+=1),this.latest=t,this.ids[t]};us.prototype.removeIdentifier=function(e){var t={};for(var i in this.ids)if(this.ids[i]===e){t.id=i,t.identifier=this.ids[i],delete this.ids[i];break}return t};us.prototype.onmove=function(e){var t=this;return t.onAny("move",e),!1};us.prototype.onend=function(e){var t=this;return t.onAny("end",e),!1};us.prototype.oncancel=function(e){var t=this;return t.onAny("end",e),!1};us.prototype.onAny=function(e,t){var i=this,r,n="processOn"+e.charAt(0).toUpperCase()+e.slice(1);t=_$(t);var s=function(o,l,c){c.ids.indexOf(l)>=0&&(c[n](o),o._found_=!0)},a=function(o){r=i.getIdentifier(o),wz(i.collections,s.bind(null,o,r)),o._found_||i.removeIdentifier(r)};return wz(t,a),!1};us.prototype.destroy=function(){var e=this;e.unbindDocument(!0),e.ids={},e.index=0,e.collections.forEach(function(t){t.destroy()}),e.off()};us.prototype.onDestroyed=function(e,t){var i=this;if(i.collections.indexOf(t)<0)return!1;i.collections.splice(i.collections.indexOf(t),1)};var kPe=us,Jj=new kPe,UPe={create:function(e){return Jj.create(e)},factory:Jj},C$=new Map,Zx=new Map,pf=class{constructor(e,t,i,r){this.data=t;let{audio:n,volume:s,delay:a,loop:o}=t;if(!n)throw new Error("Missing property");let l=typeof n=="string"?r.getAudio(n).src:n.data;this.audioPlayer=new Cx({src:l,volume:s,delay:a,loop:o}),Zx.has(i.uuid)?Zx.get(i.uuid).push(this):Zx.set(i.uuid,[this]),C$.set(e,this)}playByToggle(){this.data.toggle==="stop"?this.audioPlayer.status==="playing"?this.audioPlayer.stop():(this.audioPlayer.stop(),this.audioPlayer.play()):this.data.toggle==="pause"?this.audioPlayer.status==="playing"?this.audioPlayer.pause():this.audioPlayer.play():(this.audioPlayer.stop(),this.audioPlayer.play())}dispose(){this.audioPlayer.stop()}},bz=class{constructor(e){this.data=e}dispatch(){this.data.playAudio?this.pauseAudio(this.data.playAudio):this.data.object?this.pauseAllAudiosFromObject(this.data.object):this.pauseAllAudios()}pauseAudio(e){let t=C$.get(e);!t||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t.audioPlayer[this.data.interaction](),this.disposeDelay()},this.data.delay)):t.audioPlayer[this.data.interaction]())}pauseAllAudiosFromObject(e){let t=Zx.get(e);!(t!=null&&t.length)||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t.forEach(i=>i.audioPlayer[this.data.interaction]()),this.disposeDelay()},this.data.delay)):t.forEach(i=>i.audioPlayer[this.data.interaction]()))}pauseAllAudios(){let e=[...Zx.values()];!e.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{e.forEach(t=>{t.forEach(i=>{i.audioPlayer[this.data.interaction]()})}),this.disposeDelay()},this.data.delay)):e.forEach(t=>{t.forEach(i=>{i.audioPlayer[this.data.interaction]()})}))}disposeDelay(){clearTimeout(this.timeoutId),delete this.timeoutId}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},T$=class{constructor(e,t,i,r,n){if(this.data=t,this.shared=r,this.condition=n,t.interaction==="play")this.interaction=new pf(e,t,i,r);else if(t.interaction==="pause"||t.interaction==="stop")this.interaction=new bz(t);else throw new Error("Missing property")}dispatchBasic(){if(br(this.shared,this.condition)===!1)return!1;this.interaction instanceof pf?this.interaction.playByToggle():this.interaction.dispatch()}dispatchConditional(){if(br(this.shared,this.condition)===!1)return!1;this.interaction instanceof pf?this.interaction.audioPlayer.play():this.interaction.dispatch()}dispatchGameControl(e){if(br(this.shared,this.condition)===!1)return!1;this.interaction instanceof pf&&(e==="start"?this.interaction.audioPlayer.play():this.interaction.audioPlayer.stop())}dispose(){this.interaction.dispose()}},P$=class{constructor(e,t,i,r){this.data=e,this.page=t,this.shared=i,this.condition=r,this.delay=0,this.emission=e.emission,e.delay!==void 0&&(this.delay=e.delay),this.particleSystem=this.page.scene.find(this.data.emitterObjectId)}toggleEmitting(){this.particleSystem.started&&!this.particleSystem.stopped?this.stop(this.delay):this.start(this.delay)}toggleFroze(){this.particleSystem.started&&!this.particleSystem.isFrozen?this.freeze(this.delay):this.unFreeze(this.delay)}start(e=0){if(e){this.delayTimerId=window.setTimeout(()=>{this.start(0),this.clearDelay()},e);return}this.particleSystem.start()}stop(e=0){if(e){this.delayTimerId=window.setTimeout(()=>{this.stop(0),this.clearDelay()},e);return}this.particleSystem.stop()}freeze(e=0){if(e){this.delayTimerId=window.setTimeout(()=>{this.freeze(0),this.clearDelay()},e);return}this.particleSystem.froze()}unFreeze(e=0){if(e){this.delayTimerId=window.setTimeout(()=>{this.unFreeze(0),this.clearDelay()},e);return}this.particleSystem.unFroze()}reset(e=0){if(e){this.delayTimerId=window.setTimeout(()=>{this.reset(0),this.clearDelay()},e);return}this.particleSystem.reset()}reverseFromCurrent(){switch(this.emission){case"emitToggle":this.toggleEmitting();break;case"pauseToggle":this.toggleFroze();break}}dispatchBasic(){if(br(this.shared,this.condition)===!1||!this.particleSystem)return!1;switch(this.emission){case"start":this.start(this.delay);break;case"emitToggle":this.toggleEmitting();break;case"pause":this.freeze(this.delay);break;case"pauseToggle":this.toggleFroze();break;case"stop":this.stop(this.delay);break;case"reset":this.reset(this.delay);break}}dispatchConditional(){if(br(this.shared,this.condition)===!1||!this.particleSystem)return!1;switch(this.emission){case"start":this.start(this.delay);break;case"stop":this.stop(this.delay);break;case"reset":this.reset(this.delay);break}}dispatchGameControl(e){if(br(this.shared,this.condition)===!1||!this.particleSystem)return!1;e==="start"?this.start(this.delay):this.stop(this.delay)}dispose(){!this.particleSystem||(this.particleSystem.reset(),this.clearDelay())}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}},FPe="text/plain",VPe="us-ascii",eW=(e,t)=>t.some(i=>i instanceof RegExp?i.test(e):i===e),HPe=(e,{stripHash:t})=>{let i=/^data:(?<type>[^,]*?),(?<data>[^#]*?)(?:#(?<hash>.*))?$/.exec(e);if(!i)throw new Error(`Invalid URL: ${e}`);let{type:r,data:n,hash:s}=i.groups,a=r.split(";");s=t?"":s;let o=!1;a[a.length-1]==="base64"&&(a.pop(),o=!0);let l=(a.shift()||"").toLowerCase(),c=[...a.map(u=>{let[h,d=""]=u.split("=").map(p=>p.trim());return h==="charset"&&(d=d.toLowerCase(),d===VPe)?"":`${h}${d?`=${d}`:""}`}).filter(Boolean)];return o&&c.push("base64"),(c.length>0||l&&l!==FPe)&&c.unshift(l),`data:${c.join(";")},${o?n.trim():n}${s?`#${s}`:""}`};function GPe(e,t){if(t={defaultProtocol:"http:",normalizeProtocol:!0,forceHttp:!1,forceHttps:!1,stripAuthentication:!0,stripHash:!1,stripTextFragment:!0,stripWWW:!0,removeQueryParameters:[/^utm_\w+/i],removeTrailingSlash:!0,removeSingleSlash:!0,removeDirectoryIndex:!1,sortQueryParameters:!0,...t},e=e.trim(),/^data:/i.test(e))return HPe(e,t);if(/^view-source:/i.test(e))throw new Error("`view-source:` is not supported as it is a non-standard protocol");let i=e.startsWith("//");!i&&/^\.*\//.test(e)||(e=e.replace(/^(?!(?:\w+:)?\/\/)|^\/\//,t.defaultProtocol));let r=new URL(e);if(t.forceHttp&&t.forceHttps)throw new Error("The `forceHttp` and `forceHttps` options cannot be used together");if(t.forceHttp&&r.protocol==="https:"&&(r.protocol="http:"),t.forceHttps&&r.protocol==="http:"&&(r.protocol="https:"),t.stripAuthentication&&(r.username="",r.password=""),t.stripHash?r.hash="":t.stripTextFragment&&(r.hash=r.hash.replace(/#?:~:text.*?$/i,"")),r.pathname){let s=/\b[a-z][a-z\d+\-.]{1,50}:\/\//g,a=0,o="";for(;;){let c=s.exec(r.pathname);if(!c)break;let u=c[0],h=c.index,d=r.pathname.slice(a,h);o+=d.replace(/\/{2,}/g,"/"),o+=u,a=h+u.length}let l=r.pathname.slice(a,r.pathname.length);o+=l.replace(/\/{2,}/g,"/"),r.pathname=o}if(r.pathname)try{r.pathname=decodeURI(r.pathname)}catch{}if(t.removeDirectoryIndex===!0&&(t.removeDirectoryIndex=[/^index\.[a-z]+$/]),Array.isArray(t.removeDirectoryIndex)&&t.removeDirectoryIndex.length>0){let s=r.pathname.split("/"),a=s[s.length-1];eW(a,t.removeDirectoryIndex)&&(s=s.slice(0,-1),r.pathname=s.slice(1).join("/")+"/")}if(r.hostname&&(r.hostname=r.hostname.replace(/\.$/,""),t.stripWWW&&/^www\.(?!www\.)[a-z\-\d]{1,63}\.[a-z.\-\d]{2,63}$/.test(r.hostname)&&(r.hostname=r.hostname.replace(/^www\./,""))),Array.isArray(t.removeQueryParameters))for(let s of[...r.searchParams.keys()])eW(s,t.removeQueryParameters)&&r.searchParams.delete(s);if(t.removeQueryParameters===!0&&(r.search=""),t.sortQueryParameters){r.searchParams.sort();try{r.search=decodeURIComponent(r.search)}catch{}}t.removeTrailingSlash&&(r.pathname=r.pathname.replace(/\/$/,""));let n=e;return e=r.toString(),!t.removeSingleSlash&&r.pathname==="/"&&!n.endsWith("/")&&r.hash===""&&(e=e.replace(/\/$/,"")),(t.removeTrailingSlash||r.pathname==="/")&&r.hash===""&&t.removeSingleSlash&&(e=e.replace(/\/$/,"")),i&&!t.normalizeProtocol&&(e=e.replace(/^http:\/\//,"//")),t.stripProtocol&&(e=e.replace(/^(?:https?:)?\/\//,"")),e}var jPe=class{constructor({url:e,context:t},i,r,n){if(this.controlsManager=i,this.shared=r,this.condition=n,!e)throw new Error("Missing property");this.url=e.startsWith("mailto:")?e:GPe(e,{removeTrailingSlash:!1,removeSingleSlash:!1,stripWWW:!1}),this.context=t??"tab"}dispatch(){var e;if(br(this.shared,this.condition)===!1)return!1;Vw?window.location.assign(this.url):(this.context==="tab"||qQ&&this.context==="none"?window.open(this.url,"_blank"):this.context==="window"?window.open(this.url,"_blank",`width=${window.innerWidth}, height=${window.innerHeight}`):window.open(this.url,"_parent"),(e=this.controlsManager.orbitControls)==null||e.onPointerUp(Yt[0]),Iwe())}},D$=class{constructor(e,t,i,r,n){this.data=e,this.page=t,this.controlsManager=i,this.shared=r,this.condition=n,this.timeoutIdQueue=[],this.dispatchInner=()=>{this.objects.forEach(this.destroyCallback)},this.destroyCallback=s=>{var c,u;this.timeoutIdQueue.shift();let a=this.page.scene.find(s);if(a===void 0)return;let o=this.controlsManager.sharedGameControlGlobals.rapierWorld,l=o?(c=a.dataPatched.physics)==null?void 0:c.fusedBody:!0;if(a.cloner){for(let h of a.cloner.children)l?(h.playModeVisible=!1,h.rigidBody&&((u=a.dataPatched.physics)==null?void 0:u.rigidBody)==="positioned"&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(h.rigidBody.collider(0).handle),o.removeRigidBody(h.rigidBody),h.rigidBody=void 0),h.bvhGeometry&&(h.bvhGeometry=void 0)):this.clone===void 0||this.clone===h?(h.playModeVisible=!1,h.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(h.rigidBody.collider(0).handle),o.removeRigidBody(h.rigidBody),h.rigidBody=void 0)):h.playModeVisible===void 0&&(h.playModeVisible=!0);(l||this.clone===void 0||this.clone===!1)&&(a.visible=!1,a.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(a.rigidBody.collider(0).handle),o.removeRigidBody(a.rigidBody),a.rigidBody=void 0),a.bvhGeometry&&(a.bvhGeometry=void 0))}else a.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(a.rigidBody.collider(0).handle),o.removeRigidBody(a.rigidBody),a.rigidBody=void 0),a.bvhGeometry&&(a.bvhGeometry=void 0),a.visible=!1;o===void 0?this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim=this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.filter(h=>h.bvhGeometry!==void 0):this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim=this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.filter(h=>h.rigidBody!==void 0),a.destroyedInAction=!0,this.controlsManager.requestRender()},this.objects=[...e.objects]}dispatch(e){if(br(this.shared,this.condition)===!1)return!1;this.clone=e,this.data.delay?this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3)):this.dispatchInner()}dispatchFromStart(){if(br(this.shared,this.condition)===!1)return!1;this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3))}dispose(){this.timeoutIdQueue.forEach(e=>window.clearTimeout(e))}},R$=class{constructor(e,t,i,r,n){this.data=e,this.page=t,this.shared=i,this.eventManager=r,this.condition=n,this.shared=i}dispatch(){if(br(this.shared,this.condition)===!1)return!1;clearTimeout(this.timeoutId),delete this.timeoutId,this.timeoutId=window.setTimeout(()=>{var e;this.shared.reset(this.shared.data,!0),jk(this.page,this.shared,!0),this.eventManager.reset(),(e=this.eventManager.controlsManager.gameControl)==null||e.reset(!0),this.page.switchToPlayCamera(),this.eventManager.controlsManager.requestRender(),delete this.timeoutId},(this.data.delay??0)*1e3)}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},I$={update:null,begin:null,loopBegin:null,changeBegin:null,change:null,changeComplete:null,timelineChangeComplete:null,loopComplete:null,complete:null,loop:1,direction:"normal",autoplay:!0,timelineOffset:0,rewind:!0},Ok={duration:1e3,delay:0,endDelay:0,startOnceDelay:0,pingPongDelayCorrection:0,pingPongEndDelayCorrection:0,easing:"easeOutElastic(1, .5)",round:0},WPe=["translateX","translateY","translateZ","rotate","rotateX","rotateY","rotateZ","scale","scaleX","scaleY","scaleZ","skew","skewX","skewY","perspective","matrix","matrix3d"],dC={CSS:{},springs:{}};function Ol(e,t,i){return Math.min(Math.max(e,t),i)}function $x(e,t){return e.indexOf(t)>-1}function lR(e,t){return e.apply(null,t)}var Zt={arr:function(e){return Array.isArray(e)},obj:function(e){return $x(Object.prototype.toString.call(e),"Object")},pth:function(e){return Zt.obj(e)&&e.hasOwnProperty("totalLength")},svg:function(e){return e instanceof SVGElement},inp:function(e){return e instanceof HTMLInputElement},dom:function(e){return!("isNode"in e)&&(e.nodeType||Zt.svg(e))},str:function(e){return typeof e=="string"},fnc:function(e){return typeof e=="function"},und:function(e){return typeof e>"u"},hex:function(e){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(e)},rgb:function(e){return/^rgb/.test(e)},hsl:function(e){return/^hsl/.test(e)},col:function(e){return Zt.hex(e)||Zt.rgb(e)||Zt.hsl(e)},key:function(e){return!I$.hasOwnProperty(e)&&!Ok.hasOwnProperty(e)&&e!=="targets"&&e!=="keyframes"}};function L$(e){var t=/\(([^)]+)\)/.exec(e);return t?t[1].split(",").map(function(i){return parseFloat(i)}):[]}function O$(e,t){var i=L$(e),r=Ol(Zt.und(i[0])?1:i[0],.1,100),n=Ol(Zt.und(i[1])?100:i[1],.1,100),s=Ol(Zt.und(i[2])?10:i[2],.1,100),a=Ol(Zt.und(i[3])?0:i[3],.1,100),o=Math.sqrt(n/r),l=s/(2*Math.sqrt(n*r)),c=l<1?o*Math.sqrt(1-l*l):0,u=1,h=l<1?(l*o+-a)/c:-a+o;function d(f){var v=t?t*f/1e3:f;return l<1?v=Math.exp(-v*l*o)*(u*Math.cos(c*v)+h*Math.sin(c*v)):v=(u+h*v)*Math.exp(-v*o),f===0||f===1?f:1-v}function p(){var f=dC.springs[e];if(f)return f;for(var v=1/6,g=0,m=0;;)if(g+=v,d(g)===1){if(m++,m>=16)break}else m=0;var x=g*v*1e3;return dC.springs[e]=x,x}return t?d:p}function XPe(e){return e===void 0&&(e=10),function(t){return Math.ceil(Ol(t,1e-6,1)*e)*(1/e)}}var qPe=function(){var e=11,t=1/(e-1);function i(u,h){return 1-3*h+3*u}function r(u,h){return 3*h-6*u}function n(u){return 3*u}function s(u,h,d){return((i(h,d)*u+r(h,d))*u+n(h))*u}function a(u,h,d){return 3*i(h,d)*u*u+2*r(h,d)*u+n(h)}function o(u,h,d,p,f){var v,g,m=0;do g=h+(d-h)/2,v=s(g,p,f)-u,v>0?d=g:h=g;while(Math.abs(v)>1e-7&&++m<10);return g}function l(u,h,d,p){for(var f=0;f<4;++f){var v=a(h,d,p);if(v===0)return h;var g=s(h,d,p)-u;h-=g/v}return h}function c(u,h,d,p){if(!(0<=u&&u<=1&&0<=d&&d<=1))return;var f=new Float32Array(e);if(u!==h||d!==p)for(var v=0;v<e;++v)f[v]=s(v*t,u,d);function g(m){for(var x=0,w=1,_=e-1;w!==_&&f[w]<=m;++w)x+=t;--w;var M=(m-f[w])/(f[w+1]-f[w]),S=x+M*t,A=a(S,u,d);return A>=.001?l(m,S,u,d):A===0?S:o(m,x,x+t,u,d)}return function(m){return u===h&&d===p||m===0||m===1?m:s(g(m),h,p)}}return c}(),z$=function(){var e={linear:function(){return function(r){return r}}},t={Sine:function(){return function(r){return 1-Math.cos(r*Math.PI/2)}},Circ:function(){return function(r){return 1-Math.sqrt(1-r*r)}},Back:function(){return function(r){return r*r*(3*r-2)}},Bounce:function(){return function(r){for(var n,s=4;r<((n=Math.pow(2,--s))-1)/11;);return 1/Math.pow(4,3-s)-7.5625*Math.pow((n*3-2)/22-r,2)}},Elastic:function(r,n){r===void 0&&(r=1),n===void 0&&(n=.5);var s=Ol(r,1,10),a=Ol(n,.1,2);return function(o){return o===0||o===1?o:-s*Math.pow(2,10*(o-1))*Math.sin((o-1-a/(Math.PI*2)*Math.asin(1/s))*(Math.PI*2)/a)}}},i=["Quad","Cubic","Quart","Quint","Expo"];return i.forEach(function(r,n){t[r]=function(){return function(s){return Math.pow(s,n+2)}}}),Object.keys(t).forEach(function(r){var n=t[r];e["easeIn"+r]=n,e["easeOut"+r]=function(s,a){return function(o){return 1-n(s,a)(1-o)}},e["easeInOut"+r]=function(s,a){return function(o){return o<.5?n(s,a)(o*2)/2:1-n(s,a)(o*-2+2)/2}}}),e}();function zk(e,t){if(Zt.fnc(e))return e;var i=e.split("(")[0],r=z$[i],n=L$(e);switch(i){case"spring":return O$(e,t);case"cubicBezier":return lR(qPe,n);case"steps":return lR(XPe,n);default:return lR(r,n)}}function N$(e){try{var t=document.querySelectorAll(e);return t}catch{return}}function jT(e,t){for(var i=e.length,r=arguments.length>=2?arguments[1]:void 0,n=[],s=0;s<i;s++)if(s in e){var a=e[s];t.call(r,a,s,e)&&n.push(a)}return n}function WT(e){return e.reduce(function(t,i){return t.concat(Zt.arr(i)?WT(i):i)},[])}function tW(e){return Zt.arr(e)?e:(Zt.str(e)&&(e=N$(e)||e),e instanceof NodeList||e instanceof HTMLCollection?[].slice.call(e):[e])}function Nk(e,t){return e.some(function(i){return i===t})}function Bk(e){var t={};for(var i in e)t[i]=e[i];return t}function _z(e,t){var i=Bk(e);for(var r in e)i[r]=t.hasOwnProperty(r)?t[r]:e[r];return i}function XT(e,t){var i=Bk(e);for(var r in t)i[r]=Zt.und(e[r])?t[r]:e[r];return i}function YPe(e){var t=/rgb\((\d+,\s*[\d]+,\s*[\d]+)\)/g.exec(e);return t?"rgba("+t[1]+",1)":e}function QPe(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,i=e.replace(t,function(o,l,c,u){return l+l+c+c+u+u}),r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(i),n=parseInt(r[1],16),s=parseInt(r[2],16),a=parseInt(r[3],16);return"rgba("+n+","+s+","+a+",1)"}function KPe(e){var t=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(e)||/hsla\((\d+),\s*([\d.]+)%,\s*([\d.]+)%,\s*([\d.]+)\)/g.exec(e),i=parseInt(t[1],10)/360,r=parseInt(t[2],10)/100,n=parseInt(t[3],10)/100,s=t[4]||1;function a(d,p,f){return f<0&&(f+=1),f>1&&(f-=1),f<1/6?d+(p-d)*6*f:f<1/2?p:f<2/3?d+(p-d)*(2/3-f)*6:d}var o,l,c;if(r==0)o=l=c=n;else{var u=n<.5?n*(1+r):n+r-n*r,h=2*n-u;o=a(h,u,i+1/3),l=a(h,u,i),c=a(h,u,i-1/3)}return"rgba("+o*255+","+l*255+","+c*255+","+s+")"}function ZPe(e){if(Zt.rgb(e))return YPe(e);if(Zt.hex(e))return QPe(e);if(Zt.hsl(e))return KPe(e)}function rh(e){var t=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?(%|px|pt|em|rem|in|cm|mm|ex|ch|pc|vw|vh|vmin|vmax|deg|rad|turn)?$/.exec(e);if(t)return t[1]}function $Pe(e){if($x(e,"translate")||e==="perspective")return"px";if($x(e,"rotate")||$x(e,"skew"))return"deg"}function Sz(e,t){return Zt.fnc(e)?e(t.target,t.id,t.total):e}function Ic(e,t){return e.getAttribute(t)}function kk(e,t,i){var r=rh(t);if(Nk([i,"deg","rad","turn"],r))return t;var n=dC.CSS[t+i];if(!Zt.und(n))return n;var s=100,a=document.createElement(e.tagName),o=e.parentNode&&e.parentNode!==document?e.parentNode:document.body;o.appendChild(a),a.style.position="absolute",a.style.width=s+i;var l=s/a.offsetWidth;o.removeChild(a);var c=l*parseFloat(t);return dC.CSS[t+i]=c,c}function B$(e,t,i){if(t in e.style){var r=t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),n=e.style[t]||getComputedStyle(e).getPropertyValue(r)||"0";return i?kk(e,n,i):n}}function Uk(e,t){if(Zt.dom(e)&&!Zt.inp(e)&&(Ic(e,t)||Zt.svg(e)&&e[t]))return"attribute";if(Zt.dom(e)&&Nk(WPe,t))return"transform";if(Zt.dom(e)&&t!=="transform"&&B$(e,t))return"css";if(e[t]!=null)return"object"}function k$(e){if(Zt.dom(e)){for(var t=e.style.transform||"",i=/(\w+)\(([^)]*)\)/g,r=new Map,n;n=i.exec(t);)r.set(n[1],n[2]);return r}}function JPe(e,t,i,r){var n=$x(t,"scale")?1:0+$Pe(t),s=k$(e).get(t)||n;return i&&(i.transforms.list.set(t,s),i.transforms.last=t),r?kk(e,s,r):s}function Fk(e,t,i,r){switch(Uk(e,t)){case"transform":return JPe(e,t,r,i);case"css":return B$(e,t,i);case"attribute":return Ic(e,t);default:return e[t]||0}}function Vk(e,t){var i=/^(\*=|\+=|-=)/.exec(e);if(!i)return e;var r=rh(e)||0,n=parseFloat(t),s=parseFloat(e.replace(i[0],""));switch(i[0][0]){case"+":return n+s+r;case"-":return n-s+r;case"*":return n*s+r}}function U$(e,t){if(Zt.col(e))return ZPe(e);if(/\s/g.test(e))return e;var i=rh(e),r=i?e.substr(0,e.length-i.length):e;return t?r+t:r}function Hk(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function eDe(e){return Math.PI*2*Ic(e,"r")}function tDe(e){return Ic(e,"width")*2+Ic(e,"height")*2}function iDe(e){return Hk({x:Ic(e,"x1"),y:Ic(e,"y1")},{x:Ic(e,"x2"),y:Ic(e,"y2")})}function F$(e){for(var t=e.points,i=0,r,n=0;n<t.numberOfItems;n++){var s=t.getItem(n);n>0&&(i+=Hk(r,s)),r=s}return i}function rDe(e){var t=e.points;return F$(e)+Hk(t.getItem(t.numberOfItems-1),t.getItem(0))}function V$(e){if(e.getTotalLength)return e.getTotalLength();switch(e.tagName.toLowerCase()){case"circle":return eDe(e);case"rect":return tDe(e);case"line":return iDe(e);case"polyline":return F$(e);case"polygon":return rDe(e)}}function nDe(e){var t=V$(e);return e.setAttribute("stroke-dasharray",t),t}function sDe(e){for(var t=e.parentNode;Zt.svg(t)&&Zt.svg(t.parentNode);)t=t.parentNode;return t}function H$(e,t){var i=t||{},r=i.el||sDe(e),n=r.getBoundingClientRect(),s=Ic(r,"viewBox"),a=n.width,o=n.height,l=i.viewBox||(s?s.split(" "):[0,0,a,o]);return{el:r,viewBox:l,x:l[0]/1,y:l[1]/1,w:a/l[2],h:o/l[3]}}function aDe(e,t){var i=Zt.str(e)?N$(e)[0]:e,r=t||100;return function(n){return{property:n,el:i,svg:H$(i),totalLength:V$(i)*(r/100)}}}function oDe(e,t){function i(o){o===void 0&&(o=0);var l=t+o>=1?t+o:0;return e.el.getPointAtLength(l)}var r=H$(e.el,e.svg),n=i(),s=i(-1),a=i(1);switch(e.property){case"x":return(n.x-r.x)*r.w;case"y":return(n.y-r.y)*r.h;case"angle":return Math.atan2(a.y-s.y,a.x-s.x)*180/Math.PI}}function iW(e,t){var i=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?/g,r=U$(Zt.pth(e)?e.totalLength:e,t)+"";return{original:r,numbers:r.match(i)?r.match(i).map(Number):[0],strings:Zt.str(e)||t?r.split(i):[]}}function G$(e){var t=e?WT(Zt.arr(e)?e.map(tW):tW(e)):[];return jT(t,function(i,r,n){return n.indexOf(i)===r})}function j$(e){var t=G$(e);return t.map(function(i,r){return{target:i,id:r,total:t.length,transforms:{list:k$(i)}}})}function lDe(e,t){var i=Bk(t);if(/^spring/.test(i.easing)&&(i.duration=O$(i.easing)),Zt.arr(e)){var r=e.length,n=r===2&&!Zt.obj(e[0]);n?e={value:e}:Zt.fnc(t.duration)||(i.duration=t.duration/r)}var s=Zt.arr(e)?e:[e];return s.map(function(a,o){var l=Zt.obj(a)&&!Zt.pth(a)?a:{value:a};return Zt.und(l.delay)&&(l.delay=o?0:t.delay),Zt.und(l.endDelay)&&(l.endDelay=o===s.length-1?t.endDelay:0),l}).map(function(a){return XT(a,i)})}function cDe(e){for(var t=jT(WT(e.map(function(s){return Object.keys(s)})),function(s){return Zt.key(s)}).reduce(function(s,a){return s.indexOf(a)<0&&s.push(a),s},[]),i={},r=function(s){var a=t[s];i[a]=e.map(function(o){var l={};for(var c in o)Zt.key(c)?c==a&&(l.value=o[c]):l[c]=o[c];return l})},n=0;n<t.length;n++)r(n);return i}function uDe(e,t){var i=[],r=t.keyframes;r&&(t=XT(cDe(r),t));for(var n in t)Zt.key(n)&&i.push({name:n,tweens:lDe(t[n],e)});return i}function hDe(e,t){var i={};for(var r in e){var n=Sz(e[r],t);Zt.arr(n)&&(n=n.map(function(s){return Sz(s,t)}),n.length===1&&(n=n[0])),i[r]=n}return i.duration=parseFloat(i.duration),i.delay=parseFloat(i.delay),i}function dDe(e,t){var i;return e.tweens.map(function(r){var n=hDe(r,t),s=n.value,a=Zt.arr(s)?s[1]:s,o=rh(a),l=Fk(t.target,e.name,o,t),c=i?i.to.original:l,u=Zt.arr(s)?s[0]:c,h=rh(u)||rh(l),d=o||h;return Zt.und(a)&&(a=c),n.from=iW(u,d),n.to=iW(Vk(a,u),d),n.start=i?i.end:0,n.end=n.start+n.delay+n.duration+n.endDelay,n.easing=zk(n.easing,n.duration),n.isPath=Zt.pth(s),n.isColor=Zt.col(n.from.original),n.isColor&&(n.round=1),i=n,n})}var W$={css:function(e,t,i){return e.style[t]=i},attribute:function(e,t,i){return e.setAttribute(t,i)},object:function(e,t,i){return e[t]=i},transform:function(e,t,i,r,n){if(r.list.set(t,i),t===r.last||n){var s="";r.list.forEach(function(a,o){s+=o+"("+a+") "}),e.style.transform=s}}};function X$(e,t){var i=j$(e);i.forEach(function(r){for(var n in t){var s=Sz(t[n],r),a=r.target,o=rh(s),l=Fk(a,n,o,r),c=o||rh(l),u=Vk(U$(s,c),l),h=Uk(a,n);W$[h](a,n,u,r.transforms,!0)}})}function pDe(e,t){var i=Uk(e.target,t.name);if(i){var r=dDe(t,e),n=r[r.length-1];return{type:i,property:t.name,animatable:e,tweens:r,duration:n.end,delay:r[0].delay,endDelay:n.endDelay}}}function fDe(e,t){return jT(WT(e.map(function(i){return t.map(function(r){return pDe(i,r)})})),function(i){return!Zt.und(i)})}function q$(e,t){var i=e.length,r=function(s){return s.timelineOffset?s.timelineOffset:0},n={};return n.duration=i?Math.max.apply(Math,e.map(function(s){let a=s.startOnceDelay??0,o=s.pingPongDelayCorrection??0,l=s.pingPongEndDelayCorrection??0;return r(s)+a+o+l+s.duration*(s.loop??1)})):t.duration,n.delay=i?Math.min.apply(Math,e.map(function(s){let a=s.startOnceDelay??0,o=s.pingPongDelayCorrection??0;return r(s)+a+o+s.delay})):t.delay,n.endDelay=i?n.duration-Math.max.apply(Math,e.map(function(s){let a=s.startOnceDelay??0,o=s.pingPongDelayCorrection??0,l=s.pingPongEndDelayCorrection??0;return r(s)+a+o+s.duration*(s.loop??1)-s.endDelay-l})):t.endDelay,n}var rW=0;function mDe(e){var t=_z(I$,e),i=_z(Ok,e),r=uDe(i,e),n=j$(e.targets),s=fDe(n,r),a=q$(s,i),o=rW;return rW++,XT(t,{id:o,children:[],animatables:n,animations:s,duration:a.duration,delay:a.delay,endDelay:a.endDelay,startOnceDelay:i.startOnceDelay,pingPongDelayCorrection:i.pingPongDelayCorrection,pingPongEndDelayCorrection:i.pingPongEndDelayCorrection})}var el=[],nW=[],AE,gDe=function(){function e(){AE=requestAnimationFrame(t)}function t(i){var r=el.length;if(r){for(var n=0;n<r;){var s=el[n];s.paused?(el.splice(n,1),r-=1):(s.tick(i),n++)}e()}else AE=cancelAnimationFrame(AE)}return e}();function vDe(e){document.hidden?(el.forEach(function(t){return t.pause(e.timeStamp)}),nW=el.slice(0),ln.running=el=[]):nW.forEach(function(t){return t.play(e.timeStamp)})}typeof document<"u"&&document.addEventListener("visibilitychange",vDe);function ln(e){e===void 0&&(e={});var t=0,i=0,r=0,n,s,a=0,o=null;function l(S){var A=window.Promise&&new Promise(function(T){return o=T});return S.finished=A,A}var c=mDe(e);l(c);function u(){var S=c.direction;S!=="alternate"&&(c.direction=S!=="normal"?"normal":"reverse"),c.reversed=!c.reversed,s.forEach(function(A){(A.loop===1||A.loop%2===0)&&(A.reversed=c.reversed)})}function h(){c.direction="normal",c.reversed=!1,s.forEach(function(S){return S.reversed=!1})}function d(S){return c.reversed?c.duration-S:S}function p(){t=0,i=d(c.currentTime)*(1/ln.speed)}function f(S,A,T=!1){A&&(c.reversed?A.seek(A.duration*A.loop-(S-A.timelineOffset-A.pingPongDelayCorrection),T):A.seek(S-A.timelineOffset-A.startOnceDelay-A.pingPongDelayCorrection,T))}function v(S,A=!1){if(c.reversed)for(var T=a;T--;)f(S,s[T],A);else for(var E=0;E<a;E++)f(S,s[E],A)}function g(S){var de,be,we,_e,Me,X,ge,Oe,Ie,Pe;var A=0,T=c.animations,E=T.length;for(c.direction!=="alternate"&&((de=c.parent)==null?void 0:de.direction)==="alternate"?((be=c.parent)==null?void 0:be.rewind)===!1&&c.reversePlayback===!0&&c.rewind===!1&&((we=c.parent)!=null&&we.reversed&&c.direction==="alternate"?S=c.duration-c.delay+c.endDelay-S:S=c.duration+c.delay-c.endDelay-S):_(!1,(_e=c.parent)==null?void 0:_e.rewind,c.rewind,(Me=c.parent)==null?void 0:Me.reversePlayback,c.reversePlayback)&&((X=c.parent)!=null&&X.reversed&&c.direction==="alternate"?S=c.duration-c.delay+c.endDelay-S:S=c.duration+c.delay-c.endDelay-S);A<E;){var C=T[A],D=C.animatable,I=C.tweens,L=I.length-1,z=I[L];L&&(z=jT(I,function(ke){return S<ke.end})[0]||z);let Ye;(ge=c.parent)!=null&&ge.reversed&&c.direction==="alternate"?Ye=Ol(S-z.start-z.endDelay,0,z.duration)/z.duration:Ye=Ol(S-z.start-z.delay,0,z.duration)/z.duration;for(var F=isNaN(Ye)?1:z.easing(Ye),Q=z.to.strings,Y=z.round,O=[],j=z.to.numbers.length,V=void 0,W=0;W<j;W++){var J=void 0;let ke,Fe;c.direction!=="alternate"?((Oe=c.parent)==null?void 0:Oe.rewind)===!1&&c.reversePlayback===!0&&c.rewind===!1?(ke=z.to.numbers[W],Fe=z.from.numbers[W]||0):(Fe=z.to.numbers[W],ke=z.from.numbers[W]||0):_(!0,(Ie=c.parent)==null?void 0:Ie.rewind,c.rewind,(Pe=c.parent)==null?void 0:Pe.reversePlayback,c.reversePlayback)?(ke=z.to.numbers[W],Fe=z.from.numbers[W]||0):(Fe=z.to.numbers[W],ke=z.from.numbers[W]||0),z.isPath?J=oDe(z.value,F*Fe):J=ke+F*(Fe-ke),Y&&(z.isColor&&W>2||(J=Math.round(J*Y)/Y)),O.push(J)}var ce=Q.length;if(!ce)V=O[0];else{V=Q[0];for(var $=0;$<ce;$++){Q[$];var ne=Q[$+1],ie=O[$];isNaN(ie)||(ne?V+=ie+ne:V+=ie+" ")}}W$[C.type](D.target,C.property,V,D.transforms),C.currentValue=V,A++}}function m(S){c[S]&&!c.passThrough&&c[S](c)}function x(){c.remaining&&c.remaining!==!0&&c.remaining--}let w={0:!1,1:!0,2:!1,3:!0,4:!1,5:!1,6:!1,7:!1,8:!1,9:!0,10:!0,11:!1,12:!1,13:!1,14:!0,15:!0,16:!1,17:!0,18:!0,19:!1,20:!1,21:!1,22:!0,23:!0,24:!1,25:!0,26:!1,27:!0,28:!1,29:!1,30:!1,31:!1};function _(S,A,T,E,C){return w[S<<4|A<<3|T<<2|E<<1|C]}function M(S,A=!1){var I;var T=c.duration;let E=c.delay,C=T-c.endDelay;(I=c.parent)!=null&&I.reversed&&c.direction==="alternate"&&(E=c.endDelay,C=T-c.delay);var D=d(S);if(c.progress=Ol(D/T*100,0,100),A||(c.reversePlayback=D<c.currentTime),a&&v(D,A),!c.began&&c.currentTime>=0&&(c.began=!0,m("begin")),!c.loopBegan&&c.currentTime>0&&(c.loopBegan=!0,m("loopBegin")),(c.reversed||D>=0)&&D<=E&&c.currentTime!==0&&(g(0),m("change")),(D>=C&&c.currentTime!==T+c.pingPongDelayCorrection||!T)&&(g(T),m("change")),D>E&&D<C?(c.changeBegan||(c.changeBegan=!0,c.changeCompleted=!1,m("changeBegin")),g(D),m("change")):c.changeBegan?(c.changeCompleted=!0,c.changeBegan=!1,m("change"),a&&m("timelineChangeComplete")):c.began&&D>C&&m("changeComplete"),c.currentTime=Ol(D,0,T+c.pingPongDelayCorrection),c.began&&m("update"),S>=T)if(x(),!c.remaining)c.paused=!0,c.completed||(c.completed=!0,m("loopComplete"),m("complete"),!c.passThrough&&"Promise"in window&&(o(),l(c)));else{a?t+=c.duration/ln.speed:t+=c.duration;for(let L of s)L.setStartTime(0),L.remaining=L.loop;m("loopComplete"),c.loopBegan=!1,c.direction==="alternate"?u():a&&h()}}return c.reset=function(){var S=c.direction;c.passThrough=!1,c.currentTime=0,c.progress=0,c.paused=!0,c.began=!1,c.loopBegan=!1,c.changeBegan=!1,c.completed=!1,c.changeCompleted=!1,c.reversePlayback=!1,c.reversed=S==="reverse",c.remaining=c.loop,s=c.children,a=s.length;for(var A=a;A--;)c.children[A].reset();g(c.reversed?c.duration:0)},c.setStartTime=function(S){t=S},c.set=function(S,A){return X$(S,A),c},c.tick=function(S){r=S,t||(t=r),M((r+(i-t))*ln.speed)},c.seek=function(S,A=!1){M(S-t,A)},c.pause=function(S){c.paused=!0,a&&(n=S??performance.now())},c.play=function(S){!c.paused||(c.completed&&c.reset(),c.paused=!1,el.push(c),a&&n!==void 0&&(t+=(S??performance.now())-n),AE||gDe())},c.reverse=function(){u(),c.completed=!c.reversed,p()},c.restart=function(){c.reset(),c.play()},c.reset(),c.autoplay&&c.play(),c}function sW(e,t){for(var i=t.length;i--;)Nk(e,t[i].animatable.target)&&t.splice(i,1)}function yDe(e){for(var t=G$(e),i=el.length;i--;){var r=el[i],n=r.animations,s=r.children;sW(t,n);for(var a=s.length;a--;){var o=s[a],l=o.animations;sW(t,l),!l.length&&!o.children.length&&s.splice(a,1)}!n.length&&!s.length&&r.pause()}}function xDe(e,t){t===void 0&&(t={});var i=t.direction||"normal",r=t.easing?zk(t.easing):null,n=t.grid,s=t.axis,a=t.from||0,o=a==="first",l=a==="center",c=a==="last",u=Zt.arr(e),h=parseFloat(u?e[0]:e),d=u?parseFloat(e[1]):0,p=rh(u?e[1]:e)||0,f=t.start||0+(u?h:0),v=[],g=0;return function(m,x,w){if(o&&(a=0),l&&(a=(w-1)/2),c&&(a=w-1),!v.length){for(var _=0;_<w;_++){if(!n)v.push(Math.abs(a-_));else{var M=l?(n[0]-1)/2:a%n[0],S=l?(n[1]-1)/2:Math.floor(a/n[0]),A=_%n[0],T=Math.floor(_/n[0]),E=M-A,C=S-T,D=Math.sqrt(E*E+C*C);s==="x"&&(D=-E),s==="y"&&(D=-C),v.push(D)}g=Math.max.apply(Math,v)}r&&(v=v.map(function(L){return r(L/g)*g})),i==="reverse"&&(v=v.map(function(L){return s?L<0?L*-1:-L:Math.abs(g-L)}))}var I=u?(d-h)/g:h;return f+I*(Math.round(v[x]*100)/100)+p}}function wDe(e){e===void 0&&(e={});var t=ln(e);return t.duration=0,t.add=function(i,r){var n=el.indexOf(t),s=t.children;n>-1&&el.splice(n,1);function a(d){d.passThrough=!0}for(var o=0;o<s.length;o++)a(s[o]);var l=XT(i,_z(Ok,e));l.targets=l.targets||e.targets;var c=t.duration;l.autoplay=!1,l.timelineOffset=Zt.und(r)?c:Vk(r,c),a(t);var u=ln(l);a(u),s.push(u),u.parent=t;var h=q$(s,e);return t.delay=h.delay,t.endDelay=h.endDelay,t.duration=h.duration,u.loop===!0&&(t.duration=1/0),t.seek(0),t.reset(),t.autoplay&&t.play(),t},t}ln.version="3.2.0";ln.speed=1;ln.running=el;ln.remove=yDe;ln.get=Fk;ln.set=X$;ln.convertPx=kk;ln.path=aDe;ln.setDashoffset=nDe;ln.stagger=xDe;ln.timeline=wDe;ln.easing=zk;ln.penner=z$;ln.random=function(e,t){return Math.floor(Math.random()*(t-e+1))+e};var Y$=ln,aW=new B,oW=new B,lW=new ei;function bDe(e,t,i,r){if(r===0)return i.copy(e);if(r===1)return i.copy(t);let n=e.w*t.w+e.x*t.x+e.y*t.y+e.z*t.z;if(n>=1)return i.copy(e);let s=1-n*n;if(s<=Number.EPSILON){let u=1-r;return i.w=u*e.w+r*t.w,i.x=u*e.x+r*t.x,i.y=u*e.y+r*t.y,i.z=u*e.z+r*t.z,i.normalize(),i}let a=Math.sqrt(s),o=Math.atan2(a,n),l=Math.sin((1-r)*o)/a,c=Math.sin(r*o)/a;return i.w=e.w*l+t.w*c,i.x=e.x*l+t.x*c,i.y=e.y*l+t.y*c,i.z=e.z*l+t.z*c,i}function vs(e,t,i,r,n,s){let a=i[e]!==void 0?i[e]:void 0,o=r[e];if(o==null)return;let l=a!=null?typeof a=="string"?Number(n.getVariable(a)??0):a:t[e],c=typeof o=="string"?Number(n.getVariable(o)??0):o;if(l!==c)return{update:u=>{let h=Et.lerp(l,c,u);s?t[e]=Math.trunc(h):t[e]=h},start:()=>{t[e]=l},end:()=>{t[e]=c}}}function Gk(e,t,i,r,n,s){let a=i[e]?i[e]:void 0,o=r[e];if(!o)return;let l=t[e],c=[...a??l].map(h=>typeof h=="string"?Number(n.getVariable(h)??0):h),u=[...o].map(h=>typeof h=="string"?Number(n.getVariable(h)??0):h);if(!(c.length!==u.length||HB(c,u)))return{update:h=>{c.forEach((d,p)=>{let f=Et.lerp(d,u[p],h);t[e][p]=s?Math.trunc(f):f})},start:()=>{Object.assign(t[e],c)},end:()=>{Object.assign(t[e],u)}}}function pC(e,t,i){return t.forEach((r,n)=>{e.setComponent(n,typeof r=="string"?Number(i.getVariable(r)??0):r)}),e}function cW(e,t,i,r,n){let s=i[e]?i[e]:void 0,a=r[e];if(!a)return;let o=t[e],l=s?pC(new B,s,n):o.clone(),c=pC(new B,a,n);if(!l.equals(c))return{update:u=>{o.lerpVectors(l,c,u)},start:()=>{o.copy(l)},end:()=>{o.copy(c)}}}function uW(e,t,i){return t.forEach((r,n)=>{e.setComponent(n,typeof r=="string"?Number(i.getVariable(r)??0):r)}),e}function fC(e,t,i,r,n){let s=i[e]?i[e]:void 0,a=r[e];if(!a)return;let o=t[e],l=!(o instanceof ve),c=o instanceof ve?o:new ve().fromArray(o),u=s?uW(new ve,s,n):c.clone(),h=uW(new ve,a,n);if(!u.equals(h))return{update:d=>{c.lerpVectors(u,h,d),l&&(t[e]=c.toArray())},start:()=>{c.copy(u),l&&(t[e]=c.toArray())},end:()=>{c.copy(h),l&&(t[e]=c.toArray())}}}function _De(e,t,i,r){let n=i[e]?i[e]:void 0,s=r[e];if(!s)return;let a=t[e],o=n?new ht().fromArray(n):a.clone(),l=new B,c=new ei,u=new B;o.decompose(l,c,u);let h=new ht().fromArray(s),d=new B,p=new ei,f=new B;if(h.decompose(d,p,f),!o.equals(h))return{update:v=>{lW.slerpQuaternions(c,p,v),aW.lerpVectors(l,d,v),oW.lerpVectors(u,f,v),a.compose(aW,lW,oW)},start:()=>{a.compose(l,c,u)},end:()=>{a.compose(d,p,f)}}}function SDe(e,t,i,r,n){let s=i[e]?i[e]:void 0,a=r[e];if(!a)return;let o=t[e],l=s?typeof s=="string"?n.getColor(s).clone():new jt().setRGB(s.r,s.g,s.b):o.clone(),c=typeof a=="string"?n.getColor(a).clone():new jt().setRGB(a.r,a.g,a.b);if(l.equals(c))return;let u=o.clone();return t[e]=u,{update:h=>{u.lerpColors(l,c,h)},start:()=>{u.copy(l)},end:()=>{u.copy(c)}}}function VS(e,t,i,r,n){let s=i[e]?i[e]:void 0,a=r[e];if(!a)return;let o=t[e],l=new Es(o.r,o.g,o.b,o.a),c=s?typeof s=="string"?n.getColor(s).clone():new Es(s.r,s.g,s.b,s.a):l.clone(),u=typeof a=="string"?n.getColor(a).clone():new Es(a.r,a.g,a.b,a.a);if(!c.equals(u))return{update:h=>{l.lerpColors(c,u,h);let d=Et.lerp(c.a,u.a,h);l.a=d,t[e]={r:l.r,g:l.g,b:l.b,a:l.a}},start:()=>{l.copy(c)},end:()=>{l.copy(u)}}}function np(e,t,i,r,n){if(typeof t[e]=="number")return vs(e,t,i??{},r,n);if(Array.isArray(t[e]))return Gk(e,t,i??{},r,n)}function MDe(e,t,i,r){var o,l,c,u;let n=[],s=e.cameraType==="OrthographicCamera"?(o=t.orthographic)==null?void 0:o.zoom:(l=t.perspective)==null?void 0:l.zoom,a=e.cameraType==="OrthographicCamera"?(c=i.orthographic)==null?void 0:c.zoom:(u=i.perspective)==null?void 0:u.zoom;if(a!==void 0){let h=s??e.zoom,d=a;h!==d&&n.push({update:p=>{e.zoom=Et.lerp(h,d,p),e.updateProjectionMatrix()},start:()=>{e.zoom=h,e.updateProjectionMatrix()},end:()=>{e.zoom=d,e.updateProjectionMatrix()}})}if(i.targetOffset!==void 0){let h=vs("targetOffset",e,t,i,r);h&&n.push(h)}return n}function EDe(e,t,i,r){if(i.scaleBaked===void 0)return;let n=(t.scaleBaked??e.data.geometry.scaleBaked).map(o=>typeof o=="string"?Number(r.getVariable(o)??0):o),s=i.scaleBaked.map(o=>typeof o=="string"?Number(r.getVariable(o)??0):o);if(Af.isEqual(n,s))return;let a=[];return a.push({update:o=>{e.updateGeometryInteractions({scaleBaked:[Et.lerp(n[0],s[0],o),Et.lerp(n[1],s[1],o),Et.lerp(n[2],s[2],o)]},r),e.invalidateDownstreamBooleanData(),e.refreshAttachedClonersInteractions()},start:()=>{e.updateGeometryInteractions({scaleBaked:n},r),e.invalidateDownstreamBooleanData(),e.refreshAttachedClonersInteractions()},end:()=>{e.updateGeometryInteractions({scaleBaked:s},r),e.invalidateDownstreamBooleanData(),e.refreshAttachedClonersInteractions()}}),a}function ADe(e,t,i,r){if(!i.extrusion)return;let n=e.extrusion,s=t.extrusion??{},a=i.extrusion,o=[];return DK.forEach(l=>{let c=np(l,n,s,a,r);c&&o.push(c)}),o}function CDe(e,t,i,r){let n=[];if(!("geometry"in i))return n;let s=e.geometry.userData.parameters,a="geometry"in t?t.geometry:{},o=i.geometry;if(e instanceof $1){let l=EDe(e,a,o,r);l&&n.push(...l)}else{let l={};if(Object.assign(l,th(s,BG)),BG.forEach(c=>{let u=np(c,l,a,o,r);u&&n.push(u)}),e instanceof Ck){Object.assign(l,{extrusion:{...s.extrusion}});let c=ADe(l,a,o,r);c&&n.push(...c)}n.length&&n.push({update:c=>{e.updateGeometryInteractions(l,r),e.updateGeometryGroupsIfNeeded(),e.refreshAttachedClonersInteractions()},start:c=>{e.updateGeometryInteractions(l,r),e.updateGeometryGroupsIfNeeded(),e.refreshAttachedClonersInteractions()},end:c=>{e.updateGeometryInteractions(l,r),e.updateGeometryGroupsIfNeeded(),e.refreshAttachedClonersInteractions()}})}return n}function TDe(e,t,i,r){let n=[];if(i.intensity!==void 0){let s=vs("intensity",e,t,i,r);s&&n.push(s)}if(i.color!==void 0){let s=SDe("color",e,t,i,r);s&&n.push(s)}return n}function PDe(e,t,i,r){let n=[];if(Array.isArray(e.material)){if(!("materials"in i&&i.materials))return n;let s="materials"in t&&t.materials?t.materials:[],a=i.materials;e.material.forEach((o,l)=>{if(!a[l])return;let c=s[l]??{},u=a[l];typeof c=="string"||typeof u=="string"||n.push(...hW(o,c,u,r))})}else{if(!("material"in i&&i.material))return n;let s="material"in t&&t.material?t.material:{},a=i.material;if(typeof s=="string"||typeof a=="string")return n;n.push(...hW(e.material,s,a,r))}return n}function hW(e,t,i,r){var a;let n=[],s=av(i,r)||!!t.layers&&av(t,r);n.push(kDe(e,s));for(let o of e.layers){let l=(a=t.layers)==null?void 0:a.data(o.uuid),c=i.layers.data(o.uuid);if(!c||o.type!=="light"&&(!(o.visible??!0)||!(c.visible??!0)))continue;let u=o.getNames().filter(h=>!CK.some(d=>h.includes(d)));for(let h of u)try{let d=o.getValue(h),p;if(h==="colors")p=NDe(o,l,c,h);else if(Array.isArray(d))h==="steps"&&(p=zDe(o,l,c,h));else if(typeof d=="number")p=DDe(o,l,c,h,r);else{if(typeof d=="boolean")continue;d instanceof ve?p=RDe(o,l,c,h):d instanceof B?p=IDe(o,l,c,h,r):d instanceof Es?p=ODe(o,l,c,h,r):d instanceof jt?p=LDe(o,l,c,h,r):"isTexture"in d&&(p=BDe(o,l,c,h))}p&&(Array.isArray(p)?n.push(...p):n.push(p))}catch(d){console.error(`lerpMaterial: unexpected material layer for ${h}`,d)}}return n}function DDe(e,t,i,r,n){if(!e.hasValue(r)||!(r in i))return;let s=t?t[r]:e.getValue(r),a=i[r],o=typeof s=="string"?Number(n.getVariable(s)??0):s,l=typeof a=="string"?Number(n.getVariable(a)??0):a;if(o!==l)return{update:c=>{e.setValue(r,Et.lerp(o,l,c))},start:()=>{e.setValue(r,o)},end:()=>{e.setValue(r,l)}}}function RDe(e,t,i,r){if(!e.hasValue(r)||!(r in i))return;let n=e.getValue(r),s=t?new ve().fromArray(t[r]):n.clone(),a=new ve().fromArray(i[r]);if(!s.equals(a))return{update:o=>{n.lerpVectors(s,a,o)},start:()=>{n.copy(s)},end:()=>{n.copy(a)}}}function IDe(e,t,i,r,n){if(!e.hasValue(r)||!(r in i))return;let s=e.getValue(r),a=t?t[r]:void 0,o=i[r],l=a?pC(new B,a,n):s.clone(),c=pC(new B,o,n);if(!l.equals(c))return{update:u=>{s.lerpVectors(l,c,u)},start:()=>{s.copy(l)},end:()=>{s.copy(c)}}}function LDe(e,t,i,r,n){if(!e.hasValue(r)||!(r in i))return;let s=t?t[r]:void 0,a=i[r],o=e.getValue(r),l=s?typeof s=="string"?n.getColor(s).clone():new jt().setRGB(s.r,s.g,s.b):o.clone(),c=typeof a=="string"?n.getColor(a).clone():new jt().setRGB(a.r,a.g,a.b);if(l.equals(c))return;let u=o.clone();return{update:h=>{e.getValue(r)!==u&&e.setValue(r,u),u.lerpColors(l,c,h)},start:()=>{u.copy(l)},end:()=>{u.copy(c)}}}function ODe(e,t,i,r,n){if(!e.hasValue(r)||!(r in i))return;let s=t?t[r]:void 0,a=i[r],o=e.getValue(r),l=s?typeof s=="string"?n.getColor(s).clone():new jt().setRGB(s.r,s.g,s.b):o.clone(),c=typeof a=="string"?n.getColor(a).clone():new Es(a.r,a.g,a.b,a.a);if(l.equals(c))return;let u=o.clone();return{update:h=>{e.getValue(r)!==u&&e.setValue(r,u),u.lerpColors(l,c,h)},start:()=>{u.copy(l)},end:()=>{u.copy(c)}}}function zDe(e,t,i,r="steps"){if(!e.hasValue(r)||!(r in i))return;let n=[],s=e.getValue(r),a=t?t[r]:s,o=i[r];return HB(a,o)||n.push({update:l=>{let c=[...s];for(let u=0;u<s.length;++u){let h=a[u],d=o[u];c[u]=Et.lerp(h,d,l)}e.setValue(r,c)},start:()=>{e.setValue(r,a)},end:()=>{e.setValue(r,o)}}),n.length?n:void 0}function NDe(e,t,i,r="colors"){if(!e.hasValue(r)||!(r in i))return;let n=[],s=e.getValue(r),a=t?t[r]:s.map(l=>l.toArray()),o=i[r];for(let l=0;l<s.length;++l){let c=[...a[l]],u=[...o[l]];VA.isEqual(c,u)||n.push({update:h=>{s[l].fromArray(VA.lerp(c,u,h))},start:()=>{s[l].fromArray(c)},end:()=>{s[l].fromArray(u)}})}return n.length?n:void 0}function BDe(e,t,i,r="texture"){var g,m;if(!e.hasValue(r)||!(r in i))return;let n=e.getNode("rotation"),s=((g=t==null?void 0:t[r])==null?void 0:g.rotation)??0,a=((m=i[r])==null?void 0:m.rotation)??0;if(n&&s!==a)return{update:x=>{n.value=Et.lerp(s,a,x)*Et.DEG2RAD},start:()=>{n.value=s*Et.DEG2RAD},end:()=>{n.value=a*Et.DEG2RAD}};let o=e.getNode("mat");if(!o)return;let l=t?t[r]:o,c=i[r],u=[...l.repeat],h=[...l.offset],d=[...c.repeat],p=[...c.offset],f=l.rotation??0,v=c.rotation??0;if(!Ku.isEqual(u,d)||!Ku.isEqual(h,p)||f!==v)return{update:x=>{o.repeat=Ku.lerp(u,d,x),o.offset=Ku.lerp(h,p,x),o.rotation=Et.lerp(f,v,x),o.updateMatrix()},start:()=>{o.repeat=[...u],o.offset=[...h],o.rotation=f,o.updateMatrix()},end:()=>{o.repeat=[...d],o.offset=[...p],o.rotation=v,o.updateMatrix()}}}function kDe(e,t){return{update:()=>{e.transparent=t}}}var cR=new B,dW=new Nn;function UDe(e,t,i,r,n){var f,v,g,m,x,w;let s=[],a,o,l,c,u,h,d,p;if(e instanceof cs?(a=fC("position",e,t,i,n),a&&s.push(a),l=vs("rotation",e,t,i,n),l&&s.push(l),c=fC("shear",e,t,i,n),c&&s.push(c)):(p={slide:((f=t.pathSnapping)==null?void 0:f.slide)??((v=e.updatedPathSnapping)==null?void 0:v.slide)??((g=e.dataPatched.pathSnapping)==null?void 0:g.slide)??0,offset:((m=t.pathSnapping)==null?void 0:m.offset)??((x=e.updatedPathSnapping)==null?void 0:x.offset)??((w=e.dataPatched.pathSnapping)==null?void 0:w.offset)??0},h=vs("slide",p,t.pathSnapping??e.updatedPathSnapping??e.dataPatched.pathSnapping,i.pathSnapping??e.dataPatched.pathSnapping,n),h&&s.push(h),d=vs("offset",p,t.pathSnapping??e.updatedPathSnapping??e.dataPatched.pathSnapping,i.pathSnapping??e.dataPatched.pathSnapping,n),d&&s.push(d),!h&&!d&&(a=cW("position",e,t,i,n),a&&s.push(a),o=cW("scale",e,t,i,n),o&&s.push(o),l=FDe(e,t,i,r,n),l&&s.push(l),u=_De("hiddenMatrix",e,t,i),u&&s.push(u))),a||o||l||u||h||d){let _=e instanceof cs?()=>{e.updateWorldMatrix(!0)}:()=>{var M;e.updateMatrix(),e.hasNonUniformScale&&(e.updateMatrixWorld(),e.updateMatrixWorldSVD()),(M=e.parent)!=null&&M.matrixWorldFusedFalse&&(e.matrixWorld.multiplyMatrices(e.parent.matrixWorldFusedFalse,e.matrix),e.matrixWorldNeedsUpdate=!1),Pl(e)&&Zu(e.parent)&&e.invalidateDownstreamBooleanData(!0),e.updatePathSnapping(Object.assign({},t.pathSnapping,p))};s.push({update:_,start:_,end:_})}return s}function FDe(e,t,i,r,n){var u;let s=t!=null&&t.rotation?t.rotation.map(h=>(typeof h=="string"?Number(n.getVariable(h)??0):h)*Et.DEG2RAD):void 0,a=(u=i.rotation)==null?void 0:u.map(h=>(typeof h=="string"?Number(n.getVariable(h)??0):h)*Et.DEG2RAD);if(!a)return;let o=s?new B().fromArray(s):new B().setFromEuler(e.rotation),l=new B().fromArray(a);if(o.equals(l))return;let c=cR.subVectors(l,o);if(r&&c.toArray().every(h=>Math.abs(h)<2*Math.PI)){let h=new ei().setFromEuler(dW.setFromVector3(o)),d=new ei().setFromEuler(dW.setFromVector3(l));return{update:p=>{bDe(h,d,e.quaternion,p)},start:()=>{e.rotation.setFromVector3(o)},end:()=>{e.rotation.setFromVector3(l)}}}else return{update:h=>{cR.lerpVectors(o,l,h),e.rotation.setFromVector3(cR)},start:()=>{e.rotation.setFromVector3(o)},end:()=>{e.rotation.setFromVector3(l)}}}function VDe(e,t,i,r){let n=[];if(!("cloner"in i)||!e.cloner)return n;let s=e.cloner,a="cloner"in t?t.cloner:{},o=i.cloner;bK.forEach(p=>{let f;p==="count"?f=vs("count",s.parameters,a,o,r,!0):f=np(p,s.parameters,a??{},o,r),f&&n.push(f)});let l=HDe(s,a,o,r);l!=null&&l.length&&n.push(...l);let c=GDe(s,a,o,r);c!=null&&c.length&&n.push(...c);let u=jDe(s,a,o,r);u!=null&&u.length&&n.push(...u);let h=WDe(s,a,o,r);h!=null&&h.length&&n.push(...h);let d=XDe(s,a,o,r);return d!=null&&d.length&&n.push(...d),n.length&&n.push({update:()=>{s.update()}}),n}function HDe(e,t,i,r){if(e.parameters.type!=="radial")return;let n=t.radial,s=i.radial;if(!s)return;let a=e.parameters.radial,o=[];return _K.forEach(l=>{let c=np(l,a,n??{},s,r);c&&o.push(c)}),o}function GDe(e,t,i,r){if(e.parameters.type!=="linear")return;let n=t.linear,s=i.linear;if(!s)return;let a=[],o=e.parameters.linear;return SK.forEach(l=>{let c=np(l,o,n??{},s,r);c&&a.push(c)}),a}function jDe(e,t,i,r){if(e.parameters.type!=="grid")return;let n=t.grid,s=i.grid;if(!s)return;let a=[],o=e.parameters.grid;return MK.forEach(l=>{let c;l==="count"?c=Gk(l,o,n??{},s,r,!0):c=np(l,o,n??{},s,r),c&&a.push(c)}),a}function WDe(e,t,i,r){if(e.parameters.type!=="toObject")return;let n=t.toObject,s=i.toObject;if(!s)return;let a=[],o=e.parameters.toObject;return EK.forEach(l=>{let c;l==="count"?c=vs(l,o,n??{},s,r,!0):c=np(l,o,n??{},s,r),c&&a.push(c)}),a}function XDe(e,t,i,r){if(!e.parameters.randomness)return;let n=t.randomnessObject,s=i.randomnessObject;if(!s)return;let a=[],o=e.parameters.randomnessObject;return AK.forEach(l=>{let c=np(l,o,n??{},s,r);c&&a.push(c)}),a}function qDe(e,t){return{update:()=>{e instanceof ts&&(e.fill.enabled=t)}}}function YDe(e,t){return{update:()=>{e instanceof ts&&(e.stroke.enabled=t)}}}function QDe(e,t){return{update:()=>{e instanceof ts&&(e.dropShadow.enabled=t)}}}function KDe(e,t){return{update:()=>{e instanceof ts&&(e.innerShadow.enabled=t)}}}function ZDe(e,t){return{update:()=>{e instanceof ts&&(e.backgroundBlur.enabled=t)}}}function $De(e,t){return{update:()=>{e instanceof ts&&(e.layerBlur.enabled=t)}}}function JDe(e,t,i,r,n){let s=[],a,o,l,c,u,h,d,p,f,v,g,m,x,w,_;if("width"in e&&(a=vs("width",e,t,i,n),a&&s.push(a)),"height"in e&&(o=vs("height",e,t,i,n),o&&s.push(o)),e instanceof ts||e instanceof Vc){let M={...t.fill},S={...i.fill};M.enabled!==void 0&&M.enabled!==S.enabled&&(s.push(qDe(e,!0)),M.enabled||Object.assign(M,{enabled:!0,color:{...M.color,a:0}}),S.enabled||Object.assign(S,{enabled:!0,color:{...S.color,a:0}})),l=VS("color",e.fill,M,S,n),l&&s.push(l)}if(e instanceof ts){let M={...t.stroke},S={...i.stroke};(M.enabled||S.enabled)&&(s.push(YDe(e,!0)),M.enabled||Object.assign(M,{enabled:!0,color:{...M.color,a:0}}),S.enabled||Object.assign(S,{enabled:!0,color:{...S.color,a:0}})),c=VS("color",e.stroke,M,S,n),c&&s.push(c),u=vs("thickness",e.stroke,M,S,n),u&&s.push(u)}if(e instanceof ts){let M={...t.dropShadow},S={...i.dropShadow};(M.enabled||S.enabled)&&(s.push(QDe(e,!0)),M.enabled||Object.assign(M,{enabled:!0,color:{...M.color,a:0}}),S.enabled||Object.assign(S,{enabled:!0,color:{...S.color,a:0}})),h=VS("color",e.dropShadow,M,S,n),h&&s.push(h),d=vs("blurRadius",e.dropShadow,M,S,n),d&&s.push(d),f=vs("spread",e.dropShadow,M,S,n),f&&s.push(f),p=fC("offset",e.dropShadow,M,S,n),p&&s.push(p)}if(e instanceof ts){let M={...t.innerShadow},S={...i.innerShadow};(M.enabled||S.enabled)&&(s.push(KDe(e,!0)),M.enabled||Object.assign(M,{enabled:!0,color:{...M.color,a:0}}),S.enabled||Object.assign(S,{enabled:!0,color:{...S.color,a:0}})),v=VS("color",e.innerShadow,M,S,n),v&&s.push(v),g=vs("blurRadius",e.innerShadow,M,S,n),g&&s.push(g),x=vs("spread",e.innerShadow,M,S,n),x&&s.push(x),m=fC("offset",e.innerShadow,M,S,n),m&&s.push(m)}if(e instanceof ts||e instanceof Vc){let M={...t.backgroundBlur},S={...i.backgroundBlur};(M.enabled||S.enabled)&&(s.push(ZDe(e,!0)),M.enabled||Object.assign(M,{enabled:!0,radius:0}),S.enabled||Object.assign(S,{enabled:!0,radius:0})),w=vs("radius",e.backgroundBlur,M,S,n),w&&s.push(w)}if(e instanceof ts){let M={...t.layerBlur},S={...i.layerBlur};(M.enabled||S.enabled)&&(s.push($De(e,!0)),M.enabled||Object.assign(M,{enabled:!0,radius:0}),S.enabled||Object.assign(S,{enabled:!0,radius:0})),_=vs("radius",e.layerBlur,M,S,n),_&&s.push(_)}if(e instanceof Vc||e instanceof Yw){let M=Gk("cornerRadius",e,t,i,n);M&&s.push(M)}return s}function pW(e,t,i,r,n){let s=[];return e.data.visible&&s.push(...UDe(e,t,i,n,r)),e instanceof cs?s.push(...JDe(e,t,i,n,r)):(e.data.visible&&s.push(...VDe(e,t,i,r)),Pl(e)?(e instanceof qs&&e.data.visible&&s.push(...CDe(e,t,i,r)),e.data.visible&&s.push(...PDe(e,t,i,r))):WAe(e)?e.data.visible&&s.push(...TDe(e,t,i,r)):jAe(e)&&s.push(...MDe(e,t,i,r))),s.length?{update:a=>{s.forEach(o=>o.update(a))},start:a=>{s.forEach(o=>{var l;return(l=o.start)==null?void 0:l.call(o,a)})},end:a=>{s.forEach(o=>{var l;return(l=o.end)==null?void 0:l.call(o,a)})}}:void 0}var fW=new B;function jk(e,t,i=!1){var s;let r=[],n=a=>{let o=a.data;delete a.states,a.currentState=null,a.reversibleToState=null,a.currentTransitionEvent=null;for(let l of o.states){let c={...l.data};a.states||(a.states={}),a.states[l.id]=hf.patch(o,c)}gW(e.scene,a,null,t,o.events.find(l=>l.data.type==="Follow"||l.data.type==="LookAt")!==void 0),mW(e)};e.scene.traverse2D(n),e.traverseChildren(a=>{var u,h,d,p,f,v;if(i&&((u=a.rigidBody)==null||u.setTranslation(a.position0,!0),(h=a.rigidBody)==null||h.setRotation(a.rotation0,!0),(d=a.rigidBody)==null||d.setLinvel(fW,!0),(p=a.rigidBody)==null||p.setAngvel(fW,!0)),!Pi.is(a))return;let o=a.uuid,l=a.data;if(delete a.states,a.uuid===L0)return;let c=!1;r.some(g=>{var m;return(m=e.scene.find(o))==null?void 0:m.isDescendantOf(g)})?c=!0:((f=l.physics)==null?void 0:f.fusedBody)===!0&&l.physics.rigidBody==="dynamic"&&r.push(o),a.data=l,a.currentState=null,a.reversibleToState=null,a.currentTransitionEvent=null;for(let g of l.states){let m={...g.data};e.data.globalPhysics.usePhysics===!0&&l.physics&&(l.physics.rigidBody==="dynamic"||c)&&(g.data.position!==void 0&&delete m.position,g.data.rotation!==void 0&&delete m.rotation,g.data.hiddenMatrix!==void 0&&delete m.hiddenMatrix),a.states||(a.states={}),a.states[g.id]=lf.patch(l,m)}gW(e.scene,a,null,t,l.events.find(g=>g.data.type==="Follow"||g.data.type==="LookAt")!==void 0),mW(e),a instanceof js&&a.frame&&(a.frame.traverse(g=>n(g)),(v=a.uiCanvas)==null||v.applySize())}),e.frame&&(e.frame.traverse(a=>n(a)),(s=e.uiCanvas)==null||s.applySize())}function mW(e){e.traverseEntity(t=>{for(let i of t.data.events){let r=[];switch(i.data.type){case"Follow":case"MouseHover":case"Scroll":case"MouseDown":case"MouseUp":case"MousePress":case"KeyUp":case"KeyDown":case"KeyPress":case"Collision":r.push(...i.data.actions);break;case"GameControl":for(let n of Object.values(i.data.gameActions))r.push(...n);break;case"DragDrop":r.push(...i.data.dragDropActions.drag,...i.data.dragDropActions.drop);break;case"Conditional":r.push(...i.data.inActions,...i.data.outActions);break}for(let n of r)if(n.data.type==="Create"&&n.data.hideBase==="Yes"){let s=e.scene.find(n.data.object);s&&(s.visible=!1)}}})}function gW(e,t,i,r,n=!1){if(t instanceof qs&&t.removeInteractionGeometry(r),t instanceof cs?t.changeSelectedState(i,{shared:r},n):t.changeSelectedState(i,{scene:e,shared:r},n),t instanceof qs&&t.updateGeometryGroupsIfNeeded(),t instanceof Qs&&t.updateCameraState(t.dataPatched,{scene:e,shared:r}),!(t instanceof cs)){if(t.cloner)for(let s of t.cloner.children)s.playModeVisible=void 0;t.updateVisible()}}function Q$(e){let t;if(e.easing===5){let{control1:i,control2:r}=e;t=`cubicBezier(
			${i[0]}, ${i[1]}, ${r[0]}, ${r[1]}
		)`}else if(e.easing===6){let{mass:i,stiffness:r,damping:n,velocity:s}=e;t=`spring( ${i}, ${r}, ${n}, ${s} )`}else{let i;switch(e.easing){case 0:i=cd.linear;break;case 1:i=cd.ease;break;case 2:i=cd.easeIn;break;case 3:i=cd.easeOut;break;case 4:i=cd.easeInOut;break;default:i=cd.linear}let[r,n,s,a]=i;t=`cubicBezier( ${r}, ${n}, ${s}, ${a} )`}return{duration:Math.max(e.duration,1e-4),easing:t}}function Mz(e){let t={delay:0,loop:e.repeat===-1?!0:e.repeat+1};if(e.repeat===0)t.direction="normal",t.rewind=!1;else switch(e.direction){case"pingpong":t.direction="alternate",t.rewind=!1;break;case"pingpong-rewind":t.direction="alternate",t.rewind=!0;break;default:t.direction="normal",t.rewind=!1;break}switch(t.delay=0,t.endDelay=0,t.startOnceDelay=0,t.pingPongDelayCorrection=0,t.pingPongEndDelayCorrection=0,e.delayDirection){case"start-once":t.startOnceDelay=e.delay;break;case"start":t.delay=e.delay;break;case"end":t.endDelay=e.delay;break;case"start-end":case void 0:t.delay=e.delay,t.endDelay=e.delay;break}return t.direction==="alternate"&&(t.delay/=2,t.endDelay/=2,e.delayDirection==="start"?(t.pingPongDelayCorrection=t.delay,typeof t.loop=="number"&&t.loop%2===0&&(t.pingPongEndDelayCorrection=t.delay)):e.delayDirection==="end"?typeof t.loop=="number"&&t.loop%2!==0&&(t.pingPongEndDelayCorrection=t.endDelay):e.delayDirection==="start-end"&&(t.pingPongDelayCorrection=t.delay,t.pingPongEndDelayCorrection=t.endDelay)),t}var e3e={type:"beginState"},t3e={type:"completeState",isfromEntity:!1},vW=class{constructor(e,t,i,r,n,s){if(this.object=e,this.data=r,this.sharedAssets=n,this.allowSlerp=s,this.targets={t:0},this.firstLoop=!0,this._changeBegan=!1,this._changeCompleted=!0,this.onChange=()=>{this.callback&&(this.callback.update(this.targets.t),this.object.requestRender()),this.targets.t===0||this.targets.t===1?this._changeCompleted||(this._changeCompleted=!0,this._changeBegan=!1,this.onChangeComplete()):(this._changeCompleted&&(this._changeCompleted=!1),this._changeBegan||(this._changeBegan=!0,this.onChangeBegin()))},this.onChangeBegin=()=>{this.object.reversibleToState=this.to.id;let a=this.targets.t>.5?this.from.id:this.to.id;this.object.prevState!==this.object.currentState&&(this.object.prevState=this.object.currentState),this.object.currentState=a,this.object.dispatchEvent({type:"beginState",state:a}),this.object instanceof cs||this.object.traverseEntity(o=>{o!==this.object&&o instanceof Qs&&o.dispatchEvent(e3e)})},this.onChangeComplete=()=>{this.firstLoop&&(this.onFirstLoop(),this.firstLoop=!1),this.object.reversibleToState=this.to.id;let a=this.targets.t<.5?this.from.id:this.to.id;this.object.prevState!==this.object.currentState&&(this.object.prevState=this.object.currentState),this.object.currentState=a,this.object.dispatchEvent({type:"completeState",state:a}),this.object instanceof cs||this.object.traverseEntity(o=>{o!==this.object&&o instanceof Qs&&o.dispatchEvent(t3e)})},this.onFirstLoop=()=>{this.useCurrentState&&(this.callback=pW(this.object,this.from.data,this.to.data,this.sharedAssets,this.allowSlerp))},t===void 0){let a=CE(this.object,this.object.currentState===i?this.object.prevState:this.object.currentState);if(!a)throw new Error("Missing property");this.from=a}else{let a=CE(this.object,t);if(!a)throw new Error("Missing property");this.from=a}if(i===void 0)throw new Error("Missing property");{let a=CE(this.object,i);if(!a)throw new Error("Missing property");this.to=a}this.useCurrentState=t===void 0||i===void 0,this.params={targets:this.targets,t:1,autoplay:!1,...Mz(r),...Q$(r),change:this.onChange},this.callback=pW(this.object,t===void 0?{}:this.from.data,i===void 0?{}:this.to.data,this.sharedAssets,this.allowSlerp)}get changeBegan(){return this._changeBegan}get changeCompleted(){return this._changeCompleted}},K$=class extends Cs{constructor(e,t,i,r,n){var a;if(super(),this.eventType=e,this.data=t,this.page=i,this.shared=r,this.condition=n,this.toggleIsForward=!1,this.timelineNeedsRebuild=!1,this.hasPlayedOnce=!1,this.onTimelineChangeComplete=()=>{var o;this.data.tweens[0].data.direction!=="normal"&&(this.toggleIsForward=!this.toggleIsForward),this.timelineNeedsRebuild!==!1&&((o=this.timeline)==null||o.pause(),this.buildTimeline({isForward:this.toggleIsForward,needsRebuild:!1,isRebuild:!0}),this.timeline.play())},!t.object)throw new Error("Missing property");let s=this.page.scene.find(t.object)??((a=this.page.uiCanvas)==null?void 0:a.find(t.object))??this.page.scene.find2DInUIObjects(t.object);if(!s)throw new Error("Missing property");if(!s.states)throw new Error("Missing property");if(this.object=s,t.tweens.length<2)throw new Error("Missing property");this.tweens=Array(this.data.tweens.length-1),this.startOnceDelay=t.tweens[0].data.delayDirection==="start-once"?t.tweens[0].data.delay:0,this.init()}get playing(){var e;return((e=this.timeline)==null?void 0:e.paused)===!1}get changeBegan(){return this.tweens.some(e=>e.changeBegan)??!1}init(){this.initialCurrentState=CE(this.object,this.object.currentState).id,this.toggleIsForward=!1}get currentState(){return this.data.runMode==="Toggle"&&yG(this.eventType)?this.initialCurrentState:this.object.currentState}buildTimeline({isForward:e=!0,needsRebuild:t=!1,isRebuild:i=!1}={}){var r,n,s,a;try{let o=Mz(this.data.tweens[0].data);i&&typeof o.loop=="number"&&o.loop--,(r=this.timeline)==null||r.pause(),this.timeline=Y$.timeline({autoplay:!1,...o,...o.loop===!0||o.loop>1?{timelineChangeComplete:this.onTimelineChangeComplete}:{}});let l=this.tweens.findIndex(c=>c==null?void 0:c.changeBegan);if(t===!0&&(this.timelineNeedsRebuild=!0),e){let c=l===-1?0:l;for(let u=c;u<this.data.tweens.length-1;u++){let h=this.data.tweens[u],d=this.data.tweens[u+1],p;u===c&&(this.object.wasMovedByUser===!0||((n=this.object.previousAction)==null?void 0:n.changeBegan)===!0)?(p=void 0,this.object instanceof Qs&&(this.object.wasMovedByUser=!1)):p=h.data.state===void 0?this.currentState:h.data.state;let f=new vW(this.object,p,d.data.state===void 0?this.currentState:d.data.state,d.data,this.shared,this.data.allowSlerp??!1);l!==-1&&u===c&&Object.assign(f.params,{startOnceDelay:0}),this.tweens[u]=f,this.timeline.add(f.params,this.timeline.duration+(u===c?o.delay:0))}this.timeline.duration+=o.endDelay}else{let c=l===-1?this.data.tweens.length-1:l+1;for(let u=c;u>0;u--){let h=this.data.tweens[u],d=this.data.tweens[u-1],p;u===c&&(this.object.wasMovedByUser===!0||((s=this.object.previousAction)==null?void 0:s.changeBegan)===!0)?(p=void 0,this.object instanceof Qs&&(this.object.wasMovedByUser=!1)):p=h.data.state===void 0?this.currentState:h.data.state;let f=new vW(this.object,p,d.data.state===void 0?this.currentState:d.data.state,h.data,this.shared,this.data.allowSlerp??!1);l!==-1&&u===c&&Object.assign(f.params,{startOnceDelay:0}),this.tweens[u-1]=f,this.timeline.add(f.params,this.timeline.duration+(u===c?o.endDelay:0))}this.timeline.duration+=o.delay}}catch(o){o instanceof Error&&console.error(o.message)}((a=this.object.previousAction)==null?void 0:a.playing)===!0&&this.object.previousAction.pause(),this.object.previousAction=this}play(){if(br(this.shared,this.condition)===!1||yG(this.eventType)&&this.data.runMode==="Once"&&this.hasPlayedOnce||(this.hasPlayedOnce=!0,this.playing))return!1;clearTimeout(this.timeoutId);let e=Mz(this.data.tweens[0].data).pingPongDelayCorrection;this.timeoutId=window.setTimeout(()=>{try{this.buildTimeline(),this.timeline.play()}catch(t){t instanceof Error&&console.error(t.message)}},this.startOnceDelay+e)}pause(){var e;(e=this.timeline)==null||e.pause(),clearTimeout(this.timeoutId),this.tweens=Array(this.data.tweens.length-1),delete this.timeoutId}stop(){this.pause();let e=this.data.tweens[0].data.state===void 0?this.initialCurrentState:this.data.tweens[0].data.state;this.object instanceof cs?this.object.changeSelectedState(e,{shared:this.shared}):this.object.changeSelectedState(e,{scene:this.page.scene,shared:this.shared}),this.object.currentState=e}seek(e){var t;if(br(this.shared,this.condition)===!1)return!1;this.timeline===void 0&&this.buildTimeline(),(t=this.timeline)==null||t.seek(e*this.timeline.duration,!0)}toggle(e){var t;if(br(this.shared,this.condition)===!1)return!1;clearTimeout(this.timeoutId),this.toggleIsForward=e??!this.toggleIsForward,this.playing?((t=this.timeline)==null||t.pause(),this.buildTimeline({isForward:this.toggleIsForward,needsRebuild:!0}),this.timeline.play()):this.timeoutId=window.setTimeout(()=>{var i;(i=this.timeline)==null||i.pause(),this.buildTimeline({isForward:this.toggleIsForward}),this.timeline.play()},this.startOnceDelay)}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){this.pause()}};function CE(e,t){var n;let i,r;if(typeof t=="string"?(i=t,r=(n=e.states)==null?void 0:n[i]):t===null&&(i=null,r=e.data),!(i===void 0||r===void 0))return{id:i,data:r}}var i3e={type:"beginState"},yW={type:"completeState",isfromEntity:!1},xW={type:"requestRender"},Z$=class extends Cs{constructor(e,t,i,r){super(),this.data=e,this.page=t,this.shared=i,this.condition=r,this.toggleIsForward=!1,this.posStart=new B,this.posEnd=new B,this.qStart=new ei,this.qEnd=new ei,this.zoomStart=1,this.zoomEnd=1}init(){}get playing(){return this.animation&&this.animation.began&&!this.animation.completed}buildAnimation(e=!1){if(!this.data.animate)return;let t=this.page.scene.find(this.data.targetCamera);if(!t||!t.visible)throw new ReferenceError("Target camera not founded or not visible");let i={t:0};this.posStart.copy(this.page.activeCamera.position),this.qStart.copy(this.page.activeCamera.quaternion),this.zoomStart=this.page.activeCamera.zoom,this.animation=Y$({targets:i,t:1,...Q$(this.data),update:()=>{i.t===0&&(this.data.runMode==="Toggle"&&!this.toggleIsForward?this.fromCamera&&(this.posEnd.copy(this.fromCamera.position),this.qEnd.copy(this.fromCamera.quaternion),this.zoomEnd=this.fromCamera.zoom,this.switchCamera(this.fromCamera.uuid)):(this.posEnd.copy(t.position),this.qEnd.copy(t.quaternion),this.zoomEnd=t.zoom,this.fromCamera=this.page.activeCamera,this.switchCamera(t.uuid)),this.page.activeCamera.dispatchEvent(i3e));let r=this.page.activeCamera;r.position.lerpVectors(this.posStart,this.posEnd,i.t),r.quaternion.slerpQuaternions(this.qStart,this.qEnd,i.t),r.zoom=this.zoomStart+(this.zoomEnd-this.zoomStart)*i.t,r.wasMovedBySwitchCameraAction=!0,r.updateMatrix(),r.updateMatrixWorld(),r.updateProjectionMatrix(),r.dispatchEvent(xW),i.t===1&&r.dispatchEvent(yW)}})}switchCamera(e){let t=this.page.activeCamera,i=this.page.scene.find(e);if(!i||!i.visible)throw new ReferenceError("Target camera not founded or not visible");this.page.switchActiveCamera(i),t.dispatchEvent({type:"cameraChange",camera:i})}play(){if(br(this.shared,this.condition)===!1)return!1;if(!this.playing&&this.page.activeCamera.uuid!==this.data.targetCamera)try{clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{var e;delete this.timeoutId,this.data.animate?(this.buildAnimation(),(e=this.animation)==null||e.play()):this.switchCamera(this.data.targetCamera)},this.data.delay*1e3)}catch{}}pause(){var e;(e=this.animation)==null||e.pause(),clearTimeout(this.timeoutId),delete this.timeoutId}toggle(e){var t,i;if(br(this.shared,this.condition)===!1)return!1;if(window.clearTimeout(this.timeoutId),delete this.timeoutId,e!==this.toggleIsForward)try{this.playing?((t=this.animation)==null||t.pause(),this.toggleIsForward=e??!this.toggleIsForward,this.buildAnimation(!0),(i=this.animation)==null||i.play()):this.timeoutId=window.setTimeout(()=>{var r,n;this.toggleIsForward=e??!this.toggleIsForward,this.data.animate?((r=this.animation)==null||r.pause(),this.buildAnimation(),(n=this.animation)==null||n.play()):(this.toggleIsForward?(this.fromCamera=this.page.activeCamera,this.switchCamera(this.data.targetCamera)):this.fromCamera&&this.switchCamera(this.fromCamera.uuid),this.page.activeCamera.dispatchEvent(yW),this.page.activeCamera.dispatchEvent(xW))},this.data.delay*1e3)}catch{}}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){this.pause(),this.toggleIsForward=!1}};function $$(e){let t=e==null?void 0:e.tracks.filter(i=>i.ValueTypeName==="vector"||i.ValueTypeName==="quaternion").map(i=>i.times.length);if(t!=null&&t.length){let i=iwe(t);return i&&i>2?i:2}return 2}var J$=class extends Cs{constructor(e,t,i,r,n){var l,c,u;super(),this.data=e,this.page=t,this.animationControls=i,this.shared=r,this.condition=n,this.startOnceDelay=0,this.toggleIsForward=!1;let s=e.object,a=t.scene.find(e.object);a&&Array.isArray(a.identity)&&(s=a.identity[0]),this.data={...e,object:s};let o=this.animationControls.clipIdToAction[e.clipId+"/"+s];if(this.duration=((l=o==null?void 0:o.getClip())==null?void 0:l.duration)??1,this.data.crop2){let h=$$(o==null?void 0:o.getClip());this.leftFrameTime=this.data.crop2[0]/(h-1)*this.duration,this.rightFrameTime=this.data.crop2[1]/(h-1)*this.duration}else{let h=(u=(c=o==null?void 0:o.getClip())==null?void 0:c.tracks[0])==null?void 0:u.times.length;h&&h>1?(this.leftFrameTime=this.data.crop[0]/h*this.duration,this.rightFrameTime=this.data.crop[1]/h*this.duration):(this.leftFrameTime=0,this.rightFrameTime=this.duration)}this.startOnceDelay=e.delay}get playing(){var e;return((e=this.threeAnimAction)==null?void 0:e.isRunning())??!1}play(e=!1){if(br(this.shared,this.condition)===!1)return!1;window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{var i;if(this.threeAnimAction=this.animationControls.play(this.data),!this.threeAnimAction)return;this.threeAnimAction.reset(),this.threeAnimAction.time=this.leftFrameTime,this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime;let t=this.data.object;Object.entries(this.animationControls.clipIdToAction).forEach(([r,n])=>{let s=r.split("/")[1];this.threeAnimAction!==n&&s===t&&n.isRunning()&&(e?n.fadeOut(.2):n.stop())}),e&&((i=this.threeAnimAction)==null||i.fadeIn(.2))},this.startOnceDelay)}pause(){this.threeAnimAction&&(this.threeAnimAction.paused=!0),window.clearTimeout(this.timeoutId),delete this.timeoutId}stop(){var e;(e=this.threeAnimAction)==null||e.fadeOut(.2)}seek(e){this.threeAnimAction=this.animationControls.play(this.data),this.threeAnimAction&&(this.threeAnimAction.paused=!0,this.threeAnimAction.time=Et.clamp(this.threeAnimAction.time+1/60*e,this.leftFrameTime,this.rightFrameTime-16e-5),this.animationControls.needsUpdate=!0,this.animationControls.requestRender())}toggle(e,t=!1){if(br(this.shared,this.condition)===!1)return!1;this.toggleIsForward=e??!this.toggleIsForward,this.threeAnimAction&&(this.threeAnimAction._loopCount=0),this.playing?this.threeAnimAction&&(this.threeAnimAction.timeScale=this.toggleIsForward?1:-1,this.toggleIsForward?(this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime):(this.threeAnimAction._clip.start=this.rightFrameTime,this.threeAnimAction._clip.duration=this.leftFrameTime)):this.timeoutId=window.setTimeout(()=>{var i;if(this.threeAnimAction=this.animationControls.play(this.data),this.threeAnimAction){this.toggleIsForward?(this.threeAnimAction.time=this.leftFrameTime,this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime):(this.threeAnimAction.time=this.rightFrameTime,this.threeAnimAction._clip.start=this.rightFrameTime,this.threeAnimAction._clip.duration=this.leftFrameTime),this.threeAnimAction.paused=!1,this.threeAnimAction.timeScale=this.toggleIsForward?1:-1;let r=this.data.clipId.split("/")[1];Object.entries(this.animationControls.clipIdToAction).forEach(([n,s])=>{let a=n.split("/")[1];this.threeAnimAction!==s&&a===r&&s.isRunning()&&(t?s.fadeOut(.2):s.stop())}),t&&((i=this.threeAnimAction)==null||i.fadeIn(.2))}},this.startOnceDelay)}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){var t;let e=(t=this.animationControls.clipIdToAction[this.data.clipId+"/"+this.data.object])==null?void 0:t.getClip();e&&(e.duration=this.duration),this.pause()}},eJ=class{constructor(e,t,i,r,n){this.data=e,this.page=t,this.eventManager=i,this.shared=r,this.condition=n,this.timeOutId=-1,this.scene=t.scene}dispatch(){if(br(this.shared,this.condition)===!1)return!1;this.data.target!==this.page.uuid&&(window.clearTimeout(this.timeOutId),this.timeOutId=window.setTimeout(()=>{this.play()},this.data.delay*1e3))}dispose(){window.clearTimeout(this.timeOutId)}play(){if(this.scene.children.every(t=>t.uuid!==this.data.target))return;this.data.transition==="fade"&&this.data.duration>0&&this.eventManager.eventContext.renderer.renderFromSceneForSceneTransitionPass(this.scene,this.scene.activeCamera,this.data.duration*1e3),this.eventManager.deactivate(),this.eventManager.controlsManager.deactivate();let e=this.scene.activeCamera;this.scene.updatePage(this.data.target),this.scene.traverseVisibleEntity(t=>{t.type==="ParticleSystem"&&(t.sleep(),t.wakeUp(),t.data.autoPlay?t.start():t.stop())}),this.scene.activePage.switchToPlayCamera(),this.scene.activeCamera.copyViewPlaneSize(e),jk(this.scene.activePage,this.shared),this.eventManager.activate(),this.eventManager.controlsManager.activate(this.eventManager)}},tJ=class{constructor(e,t,i,r){this.data=e,this.page=t,this.shared=i,this.condition=r,this.evaluatedCondition=!1}checkConditions(){this.evaluatedCondition=br(this.shared,this.condition)}dispatch(){if(this.evaluatedCondition===!1)return!1;let e=this.shared.getVariable(this.data.variableId),t=nZ(this.data.expression,this.shared,Ss.typeOfVariable(e));t!==void 0&&this.shared.updateVariable(this.data.variableId,typeof t=="string"?{textValue:t}:t)}dispose(){}},iJ=class{constructor(e,t,i,r){this.data=e,this.page=t,this.shared=i,this.condition=r,this.timeoutId=null}dispatchInner(){if(br(this.shared,this.condition)===!1)return!1;let e=this.shared.getDynamicVariablePlayState(this.data.variableId);if(this.data.mode==="PlayPause")this.shared.getDynamicVariableToggleIsForward(this.data.variableId)===void 0&&this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!0),this.shared.setDynamicVariablePlayState(this.data.variableId,e==="Playing"?"Paused":"Playing");else if(this.data.mode==="Play"&&e!=="Playing")this.shared.getDynamicVariableToggleIsForward(this.data.variableId)===void 0&&this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!0),this.shared.setDynamicVariablePlayState(this.data.variableId,"Playing");else if(this.data.mode==="Stop"&&e!=="Stopped")this.shared.setDynamicVariablePlayState(this.data.variableId,"Stopped");else if(this.data.mode==="Pause"&&e!=="Paused")this.shared.setDynamicVariablePlayState(this.data.variableId,"Paused");else if(this.data.mode==="Restart")this.shared.setDynamicVariablePlayState(this.data.variableId,"Restarted");else if(this.data.mode==="Toggle"){let t=this.shared.getDynamicVariableToggleIsForward(this.data.variableId);e==="Playing"?this.shared.setDynamicVariableToggleIsForward(this.data.variableId,t===void 0?!1:!t):(this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!t),this.shared.setDynamicVariablePlayState(this.data.variableId,"Playing"))}}dispatch(){let e=this.data.delay,t=this.shared.getDynamicVariablePlayState(this.data.variableId);this.data.mode==="PlayPause"&&t==="Playing"&&(e=this.data.pauseDelay),e!==0?(this.timeoutId&&window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{this.timeoutId=null,this.dispatchInner()},e)):this.dispatchInner()}dispose(){this.timeoutId&&window.clearTimeout(this.timeoutId)}},r3e=class{constructor(e,t,i,r){this.data=e,this.page=t,this.shared=i,this.condition=r}dispatch(){if(br(this.shared,this.condition)===!1)return!1;(this.data.target==="single"?this.data.variableId?[this.data.variableId]:[]:Object.keys(this.shared.getVariables())).forEach(e=>{var i;this.shared.getVariable(e);let t=(i=this.shared.data.variables.data(e))==null?void 0:i.value;t!==void 0&&this.shared.updateVariable(e,t),this.shared.enableLocalStorageForPersistentVariables&&localStorage.removeItem(iz(e))})}dispose(){}},n3e=class{constructor(e,t,i,r){this.data=e,this.page=t,this.shared=i,this.condition=r}dispatch(){var e;if(br(this.shared,this.condition)===!1)return!1;this.data.userAPIId&&((e=this.shared.getUserAPI(this.data.userAPIId))==null||e.callUserAPI(this.shared))}dispose(){}};function br(e,t){if(t===void 0)return!0;if(t.expression.length===0)return!1;let i=nZ(t.expression,e,"boolean");return t.negate?!i:!!i}function hs(e,t,i,r,n,s){let a={Audio:[],Video:[],Particles:[],Link:[],Destroy:[],Create:[],Reset:[],Transition:[],SwitchCamera:[],Animation:[],SceneTransition:[],SetVariable:[],DynamicVariablePlay:[],ClearLocalStorage:[],UserAPI:[]},o=l=>({id:c,data:u})=>{try{u.type==="Audio"?Bs[e.type].includes("Audio")&&a.Audio.push(new T$(c,u,s,r,l)):u.type==="Video"&&!(s instanceof cs)?Bs[e.type].includes("Video")&&a.Video.push(new nJ(c,u,s,r,l)):u.type==="Particles"?Bs[e.type].includes("Particles")&&a.Particles.push(new P$(u,i,r,l)):u.type==="Link"?Bs[e.type].includes("Link")&&a.Link.push(new jPe(u,n.controlsManager,r,l)):u.type==="Create"?Bs[e.type].includes("Create")&&a.Create.push(new sJ(u,i,n.controlsManager,r,l)):u.type==="Destroy"?Bs[e.type].includes("Destroy")&&a.Destroy.push(new D$(u,i,n.controlsManager,r,l)):u.type==="Reset"?Bs[e.type].includes("Reset")&&a.Reset.push(new R$(u,i,r,n,l)):u.type==="Transition"?Bs[e.type].includes("Transition")&&a.Transition.push(new K$(e.type,u,i,r,l)):u.type==="SwitchCamera"?Bs[e.type].includes("SwitchCamera")&&a.SwitchCamera.push(new Z$(u,i,r,l)):u.type==="SceneTransition"?Bs[e.type].includes("SceneTransition")&&a.SceneTransition.push(new eJ(u,i,n,r,l)):u.type==="Animation"?Bs[e.type].includes("Animation")&&a.Animation.push(new J$(u,i,n.animationControls,r,l)):u.type==="SetVariable"?Bs[e.type].includes("SetVariable")&&a.SetVariable.push(new tJ(u,i,r,l)):u.type==="DynamicVariablePlay"?Bs[e.type].includes("DynamicVariablePlay")&&a.DynamicVariablePlay.push(new iJ(u,i,r,l)):u.type==="Conditional"?Bs[e.type].includes("Conditional")&&(u.ifActions.forEach(o({expression:u.condition,negate:!1})),u.elseActions.forEach(o({expression:u.condition,negate:!0}))):u.type==="ClearLocalStorage"?Bs[e.type].includes("ClearLocalStorage")&&a.ClearLocalStorage.push(new r3e(u,i,r,l)):u.type==="UserAPI"&&Bs[e.type].includes("UserAPI")&&a.UserAPI.push(new n3e(u,i,r,l))}catch{}};return t.forEach(o()),a}function as(e){Object.values(e).forEach(t=>{t.forEach(i=>{(i instanceof T$||i instanceof nJ||i instanceof P$||i instanceof J$||i instanceof K$||i instanceof sJ||i instanceof D$||i instanceof Z$||i instanceof eJ||i instanceof R$||i instanceof tJ||i instanceof iJ)&&i.dispose()})})}function s3e(e,t){let i;if("material"in e){let r=e.material;Array.isArray(r)?i=e.material[0].layers.find(n=>n.uuid===t):i=e.material.layers.find(n=>n.uuid===t)}if(i)return i.color.texture.image.img instanceof HTMLVideoElement?i.color.texture.image.img:void 0}var rJ=new Map,Jx=new Map,Lv=class{constructor(e,t,i){this.data=t,this.delay=0,this.status="stopped";let{layerId:r,loop:n,volume:s,delay:a}=t;if(this.object=i,r===void 0)throw new Error("Missing property");let o=s3e(i,r);o&&(this.videoElement=o,this.videoElement.loop=n===1/0,Vw&&(this.videoElement.autoplay=!0),s!==void 0&&(this.videoElement.volume=s)),a!==void 0&&(this.delay=a),Jx.has(i.uuid)?Jx.get(i.uuid).push(this):Jx.set(i.uuid,[this]),rJ.set(e,this),this.pause()}mute(){!this.videoElement||(this.videoElement.muted=!0)}unMute(){!this.videoElement||(this.videoElement.muted=!1)}play(e){if(!this.videoElement)return;let t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);e?(this.mute(),this.delay+=150):t?(this.mute(),window.setTimeout(()=>{this.unMute()},100)):this.unMute(),this.delayTimerId=window.setTimeout(()=>{if(!this.videoElement)return;let i=this.videoElement.play();i!==void 0&&i.then(r=>{}).catch(r=>{this.play()}),this.clearDelay()},this.delay),this.status="playing"}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}pause(){!this.videoElement||(this.videoElement.pause(),this.status="paused")}stop(){!this.videoElement||(this.videoElement.pause(),this.videoElement.currentTime=0,this.status="stopped",this.clearDelay())}playByToggle(){this.data.toggle==="stop"?this.status==="playing"?this.stop():(this.stop(),this.play()):this.data.toggle==="pause"?this.status==="playing"?this.pause():this.play():(this.stop(),this.play())}dispose(){!this.videoElement||(this.stop(),this.videoElement.muted=!0)}},Ez=class{constructor(e){this.data=e}dispatch(){this.data.playVideo?this.pauseVideo(this.data.playVideo):this.data.object?this.pauseAllVideosFromObject(this.data.object):this.pauseAllVideos()}pauseVideo(e){let t=rJ.get(e);!t||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t[this.data.interaction](),this.disposeDelay()},this.data.delay)):t[this.data.interaction]())}pauseAllVideosFromObject(e){let t=Jx.get(e);!(t!=null&&t.length)||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t.forEach(i=>i[this.data.interaction]()),this.disposeDelay()},this.data.delay)):t.forEach(i=>i[this.data.interaction]()))}pauseAllVideos(){let e=[...Jx.values()];!e.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{e.forEach(t=>{t.forEach(i=>{i[this.data.interaction]()})}),this.disposeDelay()},this.data.delay)):e.forEach(t=>{t.forEach(i=>{i[this.data.interaction]()})}))}disposeDelay(){clearTimeout(this.timeoutId),delete this.timeoutId}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},nJ=class{constructor(e,t,i,r,n){if(this.data=t,this.shared=r,this.condition=n,t.interaction==="play")this.interaction=new Lv(e,t,i);else if(t.interaction==="pause"||t.interaction==="stop")this.interaction=new Ez(t);else throw new Error("Missing property")}dispatchBasic(){if(br(this.shared,this.condition)===!1)return!1;this.interaction instanceof Lv?this.interaction.playByToggle():this.interaction.dispatch()}dispatchConditional(){if(br(this.shared,this.condition)===!1)return!1;this.interaction instanceof Lv?this.interaction.play():this.interaction.dispatch()}dispose(){this.interaction.dispose()}},wW=(()=>{let e,t,i,r;function n(o){!e&&!bW()&&(t==null?void 0:t.sharedGameControlGlobals.createdObjects.length)>0&&(e=requestAnimationFrame(s)),o&&(t=o,r=o.requestRender)}function s(o){let l=i?o-i:0,c=t.sharedGameControlGlobals.createdObjects,u=t.sharedGameControlGlobals.nCreatedPerAction,h=c.length,d=0;for(;d<h;){let p=c[d];p.userData.createdTime===void 0&&(p.userData.createdTime=o),p.userData.lifetime===void 0&&p.userData.quantity===void 0||p.userData.lifetime&&o-p.userData.createdTime<p.userData.lifetime||p.userData.quantity&&u[p.userData.actionId]<=p.userData.quantity?(p.userData.velocity&&(p.position.addScaledVector(p.userData.velocity,l/1e3),p.updateMatrix(),r()),d++):(u[p.userData.actionId]>p.userData.quantity&&u[p.userData.actionId]--,c.splice(d,1),p.removeFromParent(),t.sharedGameControlGlobals.rapierWorld&&p.rigidBody?(t.sharedGameControlGlobals.colliderToEntity.delete(p.rigidBody.collider(0).handle),t.sharedGameControlGlobals.rapierWorld.removeRigidBody(p.rigidBody)):(p.bvhGeometry=void 0,t.sharedGameControlGlobals.entitiesWithTransformAnim=t.sharedGameControlGlobals.entitiesWithTransformAnim.filter(f=>f.bvhGeometry!==void 0)),h--,r())}e=d>0?requestAnimationFrame(s):void 0,i=d>0?o:void 0}function a(){bW()?e&&(cancelAnimationFrame(e),e=void 0,i=void 0):n()}return typeof document<"u"&&document.addEventListener("visibilitychange",a),n})();function bW(){return!!document&&document.hidden}var _W=new ei,a3e=new B,o3e=new B,sJ=class{constructor(e,t,i,r,n){this.data=e,this.page=t,this.controlsManager=i,this.shared=r,this.condition=n,this.intervalId=null,this.timeoutIdQueue=[],this.uniqueId=Et.generateUUID(),this.dispatch=()=>{if(br(this.shared,this.condition)===!1)return!1;this.data.delay?this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3)):this.dispatchInner()},this.dispatchFromStart=()=>{if(br(this.shared,this.condition)===!1)return!1;this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3))},this.dispatchThrottled=wwe(this.dispatch,1e3/this.data.creationSpeed),this.dispatchStart=()=>{this.intervalId===null&&(this.intervalId=window.setInterval(this.dispatch,1e3/this.data.creationSpeed))},this.dispatchStop=()=>{this.intervalId!==null&&(window.clearInterval(this.intervalId),this.intervalId=null)},this.dispatchInner=()=>{this.timeoutIdQueue.shift();let a=new Xs(this.object);if(a.playModeVisible=!0,a.expand(),this.data.coordinateSystem!=="world"){let l=this.data.coordinateSystem,c=this.page.scene.find(l);c&&(c.updateMatrixWorldSVD(),a.hiddenMatrix.copy(c.matrixWorldRigid))}a.scale.copy(this.object.scale),a.position.fromArray(this.data.position),a.rotation.fromArray(this.data.rotation),a.updateMatrix(),this.page.add(a);let o=this.controlsManager.sharedGameControlGlobals;o.createdObjects.push(a),o.nCreatedPerAction[this.uniqueId]===void 0?o.nCreatedPerAction[this.uniqueId]=1:o.nCreatedPerAction[this.uniqueId]++,a.updateWorldMatrix(!0,!0),a.traverseObject(this.traverseObjectCB),wW(),this.controlsManager.requestRender()},this.traverseObjectCB=a=>{var u,h,d,p;a.hasNonUniformScale&&a.updateMatrixWorldSVD();let o;if(this.controlsManager.sharedGameControlGlobals.rapierWorld){if(a instanceof Ll)if(a.objectForSample){if(a.objectForSample.dataPatched.physics.fusedBody)return;o=a.object}else return a.object.dataPatched.physics.fusedBody===!0&&a.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(a instanceof Xs)o=a.object;else if(o=a,(u=o.dataPatched.cloner)==null?void 0:u.hideBase)return!0}else{if(a instanceof Ll)return;a instanceof Xs?o=a.object:o=a}this.data.destroy==="Time"?a.userData.lifetime=this.data.lifetime*1e3:this.data.destroy==="Quantity"&&(a.userData.quantity=this.data.destroyAfterQuantity,a.userData.actionId=this.uniqueId);let l=new B().fromArray(this.data.velocity),c=o.dataPatched;if(!(c.physics.enabled==="visibility"?!c.visible:!c.physics.enabled)&&(this.controlsManager.sharedGameControlGlobals.rapierWorld?(this.controlsManager.addRigidBody(a,o,{fromCreate:!0,dynamic:this.data.dynamic}),this.data.destroy==="Collision"&&((h=a.rigidBody)==null||h.collider(0).setActiveEvents(1),a.userData.hasCollisionDestroy=!0),a.matrixWorld.decompose(a3e,_W,o3e),l.applyQuaternion(_W),this.data.velocity.some(f=>f!==0)&&this.data.dynamic&&((d=a.rigidBody)==null||d.setLinvel(l.divideScalar(this.controlsManager.pixelsPerMeter),!0))):("geometry"in a.object&&this.controlsManager.addBoundsTree(a),this.data.velocity.some(f=>f!==0)&&this.data.dynamic&&(a.userData.velocity=l)),((p=o.dataPatched.physics)==null?void 0:p.fusedBody)===!0))return!0};let s=this.page.scene.find(this.data.object);if(!s)throw new Error("Missing Property");if(this.object=s,this.data.coordinateSystem!=="world"&&!this.page.scene.find(this.data.coordinateSystem))throw new Error("Missing Property");wW(i)}dispose(){this.intervalId!==null&&(window.clearInterval(this.intervalId),this.intervalId=null),this.timeoutIdQueue.forEach(e=>window.clearTimeout(e)),this.dispatchThrottled.cancel(),this.page.remove(...this.controlsManager.sharedGameControlGlobals.createdObjects),this.controlsManager.sharedGameControlGlobals.createdObjects=[]}},aJ=200,uR=.02,hR=.3,l3e=65;new B;var SW=new B,MW=new B,c3e=new B,aa=new B,Ta=new B,Xh=new B,dR=new ht,EW=new ht,u3e=new ht;new ht;var vl=new ei,mu=new ei,dc=new Nn(0,0,0,"YXZ"),h3e=new B(1,0,0),yl=new B(0,1,0),d3e=new B(0,0,1),AW=new B(1,1,1);new ja;var p3e=1,f3e=.025,m3e=16e-6,CW=12,g3e=20,Yn=new Jo,Oo=new cn,v3e={type:"requestRender"},y3e={type:"updateMatrix"},TW=Math.PI/6,Az=class extends Cs{constructor(e,t,i,r,n,s,a,o,l){var f;super(),this.object=e,this.domElement=t,this.data=i,this.gloabalPhysics=r,this.controlsManager=n,this.cameraFollow=s,this.camera=a,this.page=o,this.sharedAssets=l,this.enableDamping=!0,this.hiddenMatrix0=new ht,this.target0=new B,this.zoom0=1,this.rotForce=1,this.moveForce=1,this.pixelsPerMeter=aJ,this.euler0=new Nn(0,0,0,"YXZ"),this.position0Cam=new B,this.quat0Cam=new ei,this.scale0Cam=new B,this.hiddenMatrix0Cam=new ht,this.threshEndTranslate=.01,this.threshEndRotate=1e-8,this.threshEndRotVel=.005,this.collider={type:"capsule",radius:40,segment:new Jo(new B(0,-40,0),new B(0,40,0)),matrix:new ht,position:new B,rotation:new ei},this.euler=new Nn(0,0,0,"YXZ"),this.eulerDelta=new B,this.lastPosition=new B,this.lastCameraQuaternion=new ei,this.lastCameraPosition=new B,this.PI_2=Math.PI/2,this.prevMouse=new ve,this.velocityTarget=new B,this.velocity=new B,this.directionXZ=new B,this.rotVelocityStick=new B,this.rotVelocityTarget=new B,this.rotVelocity=new B,this.rotDirection=new B,this.nonColliderRotOffset=new ht,this.nonColliderPosOffset=new ht,this.firstPointerId=-1,this.rot=new B,this.path=[],this.movementState={moveNegZ:0,movePosZ:0,moveNegX:0,movePosX:0,moveNegY:0,movePosY:0,rotPosX:0,rotNegX:0,rotPosY:0,rotNegY:0,jump:0,run:0},this.vrEulerYOffset=0,this.onObject=!1,this.actionState={},this.keyAssignments=[["moveNegZ","W"],["moveNegX","A"],["movePosZ","S"],["movePosX","D"],["rotPosX","ArrowUp"],["rotPosY","ArrowLeft"],["rotNegX","ArrowDown"],["rotNegY","ArrowRight"],["jump"," "]],this.collisionEnabled=!0,this.offsetMatrix=new ht,this.objectToTarget=new B,this.objectToTarget0=new B,this.objectToCamXZ=new B,this.objectToCamXZ0=new B,this.targetToCamera=new B,this.targetToCamera0=new B,this.cameraPolarAxis0=new B,this.targetPos=new B,this.targetQuat=new ei,this.lerpFactorPos=new B().setScalar(.3),this.lerpFactorPosStart=.3,this.lerpFactorPosEnd=.3,this.lerpFactorRotStart=.3,this.lerpFactorRotEnd=.3,this.lerpFactorPosCamera=.3,this.lerpFactorRotCamera=.3,this.objXZQuat=new ei,this.objXZQuatInv=new ei,this.objXZRotMat=new ht,this.isFirstPerson=!1,this.didHit=!1,this.groundVelocity=new B,this.pushedVelocity=new B,this.groundYRotation=0,this.objectRealQuat=new ei,this.colliderWorldQuat=new ei,this.groundNormal=new B,this.groundTilt=new ei,this.groundTiltInv=new ei,this.lastHitObj=null,this.isFirstFrame=!0,this.rotationAccumWhenOrientWithCamera=0,this.navMeshPathDest=null,this.position=new B,this.quaternion=new ei,this.scale=new B,this.initialAction=!0,this.onPointerDown=v=>{var g;!(v.target===this.domElement||v.target instanceof HTMLElement&&v.target.tagName==="SPLINE-VIEWER"&&((g=v.target.shadowRoot)!=null&&g.contains(this.domElement)))||this.firstPointerId!==-1||(this.firstPointerId=v.pointerId,this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp),this.rotBy!=="keys"&&!uo&&!rG&&this.domElement.requestPointerLock(),this.prevMouse.set(v.clientX,v.clientY))},this.onPointerUp=v=>{this.firstPointerId=-1,this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this.onPointerUp),v.pointerType==="mouse"&&this.domElement.ownerDocument.exitPointerLock()},this.onPointerMove=v=>{if(v.pointerId!==this.firstPointerId)return;let g=v.clientX-this.prevMouse.x,m=v.clientY-this.prevMouse.y;this.prevMouse.set(v.clientX,v.clientY),v.pointerType==="mouse"&&this.rotBy!=="keys"&&(rG&&Dwe<15.5&&!uo?(this.eulerDelta.y=-g*this.mouseOrbitSensitivity,this.eulerDelta.x=-m*this.mouseOrbitSensitivity):(this.eulerDelta.y=-v.movementX*this.mouseOrbitSensitivity,this.eulerDelta.x=-v.movementY*this.mouseOrbitSensitivity)),v.pointerType!=="mouse"&&this.rotByTouch==="drag"&&(this.eulerDelta.y=-g*this.mouseOrbitSensitivity*5,this.eulerDelta.x=-m*this.mouseOrbitSensitivity*5),this.controlsManager.requestRender()},this.onPointerlockChange=v=>{this.domElement.ownerDocument.pointerLockElement===this.domElement?Az.isLocked=!0:Az.isLocked=!1},this.onPointerlockError=()=>{console.error("SPE.GameControls: Unable to use Pointer Lock API")},this.handleVisibilityChange=()=>{if(document!=null&&document.hidden)for(let v in this.movementState)this.movementState[v]=0},this.onKeyDown=v=>{!(v.target instanceof HTMLInputElement)&&(v.code==="ArrowLeft"||v.code==="ArrowUp"||v.code==="ArrowRight"||v.code==="ArrowDown"||v.code==="Space")&&v.preventDefault();for(let g of this.keyAssignments)if(v.key.toUpperCase()===g[1]||v.key===g[1]){this.movementState[g[0]]=1;break}this.controlsManager.requestRender()},this.onKeyUp=v=>{for(let g of this.keyAssignments)if(v.key.toUpperCase()===g[1]||v.key===g[1]||v.code.slice(3,v.code.length).toUpperCase()===g[1]){this.movementState[g[0]]=0;break}},this.copyVRGamePadValues=(v,g)=>{for(let m=2;m<4;m++){let x=v.axes[m];g===0?m===2?this.movementState.movePosX=x:this.movementState.movePosZ=x:(v.buttons[3].pressed?this.movementState.jump=1:this.movementState.jump=0,m===2?(Math.abs(this.movementState.rotPosY)<.3&&Math.abs(x)>=.3&&(this.vrEulerYOffset+=x<0?1:-1),this.movementState.rotPosY=x):this.moveMode==="fly"&&(this.movementState.moveNegY=x))}},this.sharedGameControlGlobals=n.sharedGameControlGlobals,e===a&&(this.isFirstPerson=!0),this.hiddenMatrix0.copy(this.object.hiddenMatrix),this.object.parent?this.object.hiddenMatrix.copy(this.object.parent.matrixWorld).invert():this.object.hiddenMatrix.identity(),this.object.matrix.copy(this.object.matrixWorld),this.object.matrix.decompose(this.position,this.quaternion,this.scale),this.euler0.setFromQuaternion(this.quaternion,"YXZ");let c=this.euler0.clone(),u=c.y;if(this.objectRealQuat.copy(this.quaternion),c.y=0,this.quaternion.setFromEuler(c),this.objXZQuat.copy(this.quaternion),this.objXZQuatInv.copy(this.objXZQuat).invert(),this.objXZRotMat.makeRotationFromQuaternion(this.quaternion),c.set(0,u,0),this.quaternion.setFromEuler(c),this.rot.setFromEuler(c),this.object.matrixAutoUpdate=!1,(this.isFirstPerson||this.cameraFollow===!0)&&(this.target0.copy(this.camera.getTarget()),this.zoom0=this.camera.zoom),this.cameraFollow===!0){this.position0Cam.copy(this.camera.position),this.quat0Cam.copy(this.camera.quaternion),this.scale0Cam.copy(this.camera.scale),this.hiddenMatrix0Cam.copy(this.camera.hiddenMatrix),this.camera.parent?(this.camera.hiddenMatrix.copy((f=this.camera)==null?void 0:f.parent.matrixWorld),this.camera.matrix.copy(this.camera.matrixWorld)):this.camera.hiddenMatrix.identity(),this.camera.matrix.copy(this.camera.matrixWorld),this.camera.matrix.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.matrixAutoUpdate=!1,this.offsetMatrix.copy(this.object.matrix).invert().multiply(this.camera.matrix);let v=new B(0,0,-1).applyQuaternion(this.camera.quaternion),g=new B().subVectors(this.position,this.camera.position);this.objectToCamXZ.copy(g),this.objectToCamXZ.y=0,this.objectToCamXZ0.copy(this.objectToCamXZ);let m,x;Math.abs(v.y)<1e-6?(g.y=0,v.y=0,x=g.projectOnVector(v)):g.y/v.y>0?x=v.multiplyScalar(g.y/v.y):x=v.multiplyScalar(g.length()),this.targetToCamera0.copy(x).negate(),m=this.camera.position.clone().add(x),this.objectToTarget0.subVectors(m,this.position);let w=new Nn().setFromQuaternion(this.camera.quaternion,"YXZ");this.cameraPolarOffset=-w.x,w.x=0,w.z=0,w.y-=Math.PI/2,this.cameraPolarAxis0.set(0,0,-1).applyEuler(w)}if(this.object instanceof Qs&&(this.object.matrixAutoUpdate=!1),this.euler.setFromQuaternion(this.quaternion,"YXZ"),this.rotByTouch=i.rotByTouch??"joystick",this.rotBy=i.rotBy??"keys",this.rotationMode=i.rotationMode??"normal",this.moveMode=i.moveMode??"walk",this.collisionEnabled=i.collisionEnabled,this.speedTranslate=(i.speedTranslate??250)*p3e,this.speedOrbit=(i.speedRotate??100)*f3e,this.mouseOrbitSensitivity=(i.speedRotate??100)*m3e,this.keyAssignments=i.keyAssignments.map(v=>{let g=[v[0],v[1]];return g[1]===""?g[1]="ArrowUp":g[1]===""?g[1]="ArrowLeft":g[1]===""?g[1]="ArrowDown":g[1]===""?g[1]="ArrowRight":g[1]===""?g[1]="Shift":g[1]===""?g[1]="Enter":g[1]==="Space"?g[1]=" ":g[1]===""?g[1]="Meta":g[1]==="Ctrl"?g[1]="Control":g[1]==="Esc"&&(g[1]="Escape"),g}),i.rotBy==="mouse"){let v;v=this.keyAssignments.findIndex(g=>g[0]==="rotNegX"),v!==-1&&(this.keyAssignments[v][1]=""),v=this.keyAssignments.findIndex(g=>g[0]==="rotPosX"),v!==-1&&(this.keyAssignments[v][1]=""),v=this.keyAssignments.findIndex(g=>g[0]==="rotPosY"),v!==-1&&(this.keyAssignments[v][1]=""),v=this.keyAssignments.findIndex(g=>g[0]==="rotNegY"),v!==-1&&(this.keyAssignments[v][1]="")}this.lerpFactorPosStart=1-.02**(1/((i.delayPos[0]??.3)*60)),this.lerpFactorPosEnd=1-.02**(1/((i.delayPos[1]??.3)*60)),this.lerpFactorPos.setScalar(this.lerpFactorPosStart),this.lerpFactorRotStart=1-.02**(1/((i.delayRot[0]??.3)*60)),this.lerpFactorRotEnd=1-.02**(1/((i.delayRot[1]??.3)*60)),this.lerpFactorPosCamera=1-.02**(1/((i.delayPosCamera??.3)*60)),this.lerpFactorRotCamera=1-.02**(1/((i.delayRotCamera??.3)*60)),this.gravity=(this.gloabalPhysics.gravity??e0.defaultData.gravity)*CW,this.usePhysics=this.gloabalPhysics.usePhysics??e0.defaultData.usePhysics,this.jumpPower=i.jumpPower*g3e,this.resetYPosition=this.position.y+Math.abs(i.resetYPosition)*(this.gravity>0?1:-1),this.alignToGround=i.alignToGround??!1,this.orientMode=i.autoOrientMove?i.orientMode:"none",this.orientWith=i.orientWith??ZA.defaultDataThirdPerson.orientWith,this.slopeThresh=l3e*Math.PI/180,i.collider.type==="capsule"?(this.collider.radius=i.collider.radius,this.collider.segment.start.y=i.collider.height/2-i.collider.radius,this.collider.segment.end.y=-this.collider.segment.start.y,this.offset=i.collider.height*uR/this.pixelsPerMeter,this.stepThresh=i.collider.height*hR/this.pixelsPerMeter,this.colliderHeight=i.collider.height):i.collider.type==="sphere"?(this.collider.radius=i.collider.radius,this.collider.segment.start.y=0,this.collider.segment.end.y=0,this.offset=2*i.collider.radius*uR/this.pixelsPerMeter,this.stepThresh=2*i.collider.radius*hR/this.pixelsPerMeter,this.colliderHeight=i.collider.radius*2):(this.offset=i.collider.height*uR/this.pixelsPerMeter,this.stepThresh=i.collider.height*hR/this.pixelsPerMeter,this.colliderHeight=i.collider.height),this.collider.type=i.collider.type;let h=new B().fromArray(i.collider.position),d=new ei().setFromEuler(new Nn().fromArray([...i.collider.rotation,"XYZ"]));this.collider.position.copy(h).multiply(this.scale),this.collider.rotation.copy(d),this.collider.matrix.compose(h,d,AW),i.cameraXAxis!==void 0&&(this.cameraXAxis=i.cameraXAxis,this.cameraYAxis=i.cameraYAxis,this.minPolarAngle=i.cameraRotXLimits[0],this.maxPolarAngle=i.cameraRotXLimits[1],this.minAzimuthAngleRel=i.cameraRotYLimits[0],this.maxAzimuthAngleRel=i.cameraRotYLimits[1]),this.forwardDir=i.forwardDirection??"-z",this.isFirstPerson&&(this.forwardDir="-z"),this.runMultiplier=i.runMultiplier??2;let p=i.navmesh.destinationHelperRadius*2;if(p>0){let v=new Nt;v.push({fi:0,data:{...Zn.defaultData("light","phong"),alpha:0},id:"layer1"}),v.push({fi:0,data:{...Zn.defaultData("color"),color:i.navmesh.destinationHelperColor,alpha:i.navmesh.destinationHelperColor.a},id:"layer2"});let g=new mk({layers:v},{scene:this.page.scene,shared:this.sharedAssets});this.navMeshPathDest=new zr(UK.create({parameters:{width:p,height:p/10,hollow:.7}}),g),this.navMeshPathDest.material.userData.opacity0=i.navmesh.destinationHelperColor.a}this.activate()}reset(e=!1){if(this.object.hiddenMatrix.copy(this.hiddenMatrix0),e){this.object.updateMatrix(),this.object.updateMatrixWorld(),this.object.matrix.copy(this.object.matrixWorld),this.object.matrix.decompose(this.position,this.quaternion,this.scale),this.object.parent?this.object.hiddenMatrix.copy(this.object.parent.matrixWorld).invert():this.object.hiddenMatrix.identity();let t=new Nn().setFromQuaternion(this.quaternion,"YXZ"),i=t.y;this.objectRealQuat.copy(this.quaternion),t.y=0,this.quaternion.setFromEuler(t),this.objXZQuat.copy(this.quaternion),this.objXZQuatInv.copy(this.objXZQuat).invert(),this.objXZRotMat.makeRotationFromQuaternion(this.quaternion),t.set(0,i,0),this.quaternion.setFromEuler(t),this.rot.setFromEuler(t),this.euler.setFromQuaternion(this.quaternion,"YXZ"),this.velocityTarget.set(0,0,0),this.velocity.set(0,0,0)}else this.object instanceof Qs?this.object.matrixAutoUpdate=!0:this.object.updateMatrix();this.cameraFollow===!0&&(this.camera.quaternion.copy(this.quat0Cam),this.camera.position.copy(this.position0Cam),this.camera.scale.copy(this.scale0Cam),this.camera.hiddenMatrix.copy(this.hiddenMatrix0Cam),this.camera.matrixAutoUpdate=!0),this.controlsManager.requestRender()}activate(){this.instantiateActions(),this.domElement.ownerDocument.addEventListener("pointerdown",this.onPointerDown),this.domElement.ownerDocument.addEventListener("keydown",this.onKeyDown),this.domElement.ownerDocument.addEventListener("keyup",this.onKeyUp),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError),this.domElement.ownerDocument.addEventListener("visibilitychange",this.handleVisibilityChange)}deactivate(){this.disposeActions(),this.domElement.ownerDocument.removeEventListener("pointerdown",this.onPointerDown),this.domElement.ownerDocument.removeEventListener("keydown",this.onKeyDown),this.domElement.ownerDocument.removeEventListener("keyup",this.onKeyUp),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError),this.domElement.ownerDocument.removeEventListener("visibilitychange",this.handleVisibilityChange)}dispose(){var e;this.deactivate(),(e=this.navMeshPathDest)!=null&&e.parent&&this.page.remove(this.navMeshPathDest)}instantiateActions(){let e=this.data,t=this.sharedAssets;e.gameActions!==void 0&&(this.actions={},KA.list.forEach(i=>{this.actions[i]=hs({...e,disabled:!1,type:"GameControl"},e.gameActions[i],this.page,t,this.controlsManager.eventManager,this.object)})),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),this.dispatchStartEvent("idle"),this.initialAction&&(this.initialAction=!1)}disposeActions(){this.initialAction=!1,this.dispatchStopEvent("idle"),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),as(this.actions.idle),as(this.actions.move),as(this.actions.run),as(this.actions.jump)}dispatchStartEvent(e){this.actions[e]!==void 0&&(this.actionState[e]||(this.actionState[e]=!0,this.actions[e].Transition.forEach(t=>{t.play()}),this.actions[e].Animation.forEach(t=>{t.play(this.initialAction===!1)}),this.actions[e].Create.forEach(t=>{t.dispatchStart()}),this.actions[e].Audio.forEach(t=>{t.dispatchGameControl("start")}),this.actions[e].Particles.forEach(t=>{t.dispatchGameControl("start")})))}dispatchStopEvent(e){this.actions[e]!==void 0&&(!this.actionState[e]||(this.actionState[e]=!1,this.actions[e].Transition.forEach(t=>{t.stop(),t.object.currentState!==null&&t.object.changeSelectedState(null,{scene:this.page.scene,shared:this.sharedAssets})}),this.actions[e].Create.forEach(t=>{t.dispatchStop()}),this.actions[e].Audio.forEach(t=>{t.dispatchGameControl("stop")}),this.actions[e].Particles.forEach(t=>{t.dispatchGameControl("stop")})))}get colliderWorldPosition(){return aa.copy(this.collider.position).applyQuaternion(this.objectRealQuat).add(this.position)}update(e,t,i){var o,l,c,u,h,d,p,f,v;if(this.gravity<0?this.position.y<this.resetYPosition:this.position.y>this.resetYPosition)return this.reset(!0),!0;this.sharedGameControlGlobals.gamePads.forEach(this.copyVRGamePadValues);let r=(this.isFirstFrame?16.6:e)/1e3;this.isFirstFrame&&(this.isFirstFrame=!1);let n=r*60,s=!1;if(this.usePhysics&&this.collisionEnabled){let g=Ta.set(0,(this.velocity.y===0?this.pixelsPerMeter*Math.max(Math.abs(this.gravity)/(10*CW),1)*(this.gravity>0?1:-1):this.velocity.y)*r,0).divideScalar(this.pixelsPerMeter),m=this.sharedGameControlGlobals.rapierWorld.castShape(this.colliderWorldPosition.divideScalar(this.pixelsPerMeter),this.colliderWorldQuat,g,(o=this.object.rigidBody)==null?void 0:o.collider(0).shape,1,!1,16,void 0,void 0,this.object.rigidBody);if(m){this.onObject=!0,this.groundNormal.set(m.normal2.x,m.normal2.y,m.normal2.z).applyQuaternion(this.colliderWorldQuat).negate(),this.alignToGround&&this.groundTiltAdjustment(this.groundNormal),Math.acos(this.groundNormal.y)<this.slopeThresh&&(s=!0),((l=m.collider.parent())==null?void 0:l.bodyType())===0&&Math.acos(this.groundNormal.y)*(180/Math.PI)>45&&(this.onObject=!1);let x=m.collider.parent();this.groundYRotation=0,this.groundVelocity.set(0,0,0);for(let w of this.sharedGameControlGlobals.entitiesWithTransformAnim)if(w.rigidBody===x&&w.userData.isFollowingObj!==this.object.uuid){(w.hasNonUniformScale?w.matrixWorldRigid:w.matrixWorld).decompose(aa,mu,Ta),this.groundVelocity.subVectors(aa,w.prevT),this.object.getWorldPosition(Ta).add(this.collider.position).sub(aa),this.groundYRotation=dc.setFromQuaternion(mu).y-w.prevR.y,Xh.copy(Ta).applyAxisAngle(yl,this.groundYRotation),this.groundVelocity.add(Xh.sub(Ta)).divideScalar(r);break}}else this.onObject=!1}if(this.moveMode==="walk"&&this.collisionEnabled&&(this.movementState.jump===1&&this.onObject&&(this.velocityTarget.y=this.jumpPower,this.movementState.jump=0,this.dispatchStopEvent("idle"),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),this.dispatchStartEvent("jump"),this.onObject=!1),this.onObject?this.velocityTarget.y/=2:this.velocityTarget.y+=this.gravity*n),this.moveMode==="fly"&&(this.velocityTarget.y=(this.movementState.movePosY-this.movementState.moveNegY)*this.speedTranslate),this.directionXZ.z=this.movementState.movePosZ-this.movementState.moveNegZ,this.directionXZ.x=this.movementState.movePosX-this.movementState.moveNegX,this.forwardDir==="+z"&&this.directionXZ.multiplyScalar(-1),this.directionXZ.manhattanLength()>0&&(this.path=[]),this.navMeshPathDest){let g=this.navMeshPathDest.material;if(this.moveMode==="walk"&&this.path.length>1){this.navMeshPathDest.position.copy(this.path[this.path.length-1]),this.navMeshPathDest.parent||this.page.add(this.navMeshPathDest);let m=aa.subVectors(this.path[1],this.position),x=Ta.subVectors(this.path[1],this.path[0]);m.dot(x)<0?this.path.shift():(this.directionXZ.x=x.x,this.directionXZ.z=x.z),g.opacity=g.userData.opacity0}else g.opacity-=.05*g.userData.opacity0,this.navMeshPathDest.material.opacity<=0&&this.navMeshPathDest.parent&&this.page.remove(this.navMeshPathDest)}this.directionXZ.normalize(),this.movementState.run?this.moveForce=this.runMultiplier:this.moveForce=1,this.velocityTarget.z=this.directionXZ.z*this.speedTranslate*this.moveForce,this.velocityTarget.x=this.directionXZ.x*this.speedTranslate*this.moveForce,(this.moveMode==="walk"?this.velocityTarget.x+this.velocityTarget.z===0:this.velocityTarget.manhattanLength()===0)?this.lerpFactorPos.setScalar(this.lerpFactorPosEnd):this.lerpFactorPos.setScalar(this.lerpFactorPosStart),this.moveMode==="walk"&&(this.lerpFactorPos.y=1),this.didHit===!1&&this.pushedVelocity.manhattanLength()===0||this.usePhysics===!1?(this.velocity.x+=(this.velocityTarget.x-this.velocity.x)*(1-(1-this.lerpFactorPos.x)**n),this.velocity.y+=(this.velocityTarget.y-this.velocity.y)*(1-(1-this.lerpFactorPos.y)**n),this.velocity.z+=(this.velocityTarget.z-this.velocity.z)*(1-(1-this.lerpFactorPos.z)**n)):this.velocity.copy(this.velocityTarget),(this.moveMode==="walk"?this.velocity.x**2+this.velocity.z**2<this.speedTranslate:this.velocity.lengthSq()<this.speedTranslate)?(this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.onObject&&(this.dispatchStopEvent("jump"),this.dispatchStartEvent("idle"))):(this.dispatchStopEvent("idle"),this.onObject&&(this.dispatchStopEvent("jump"),this.movementState.run?(this.dispatchStopEvent("move"),this.dispatchStartEvent("run")):(this.dispatchStopEvent("run"),this.dispatchStartEvent("move"))));let a=c3e.copy(this.velocity);if(this.orientMode!=="none"&&this.isFirstPerson===!1){let g=Ta.copy(a);g.y=0,a.set(0,a.y,g.length()*(this.forwardDir==="+z"?1:-1))}if(this.directionXZ.manhattanLength()>0&&this.orientMode!=="none"&&this.isFirstPerson===!1)if(this.orientWith==="camera"&&this.path.length<=1){let g=aa;this.camera.getWorldDirection(g);let m=Xh.copy(yl).multiplyScalar(g.dot(yl));g.sub(m);let x=Ta.copy(this.directionXZ);x.x*=-1,this.rot.y=g.angleTo(x)*(g.cross(x).y>0?-1:1)+this.rotationAccumWhenOrientWithCamera}else this.rot.y=(this.path.length>1?0:this.euler.y)+Math.atan2(-this.directionXZ.z,this.directionXZ.x)+Math.PI/2*(this.forwardDir==="+z"?1:-1);if(dc.setFromVector3(this.rot),this.moveMode==="walk"&&(dc.x=0),a.applyEuler(dc),s&&(mu.setFromUnitVectors(yl,this.groundNormal),a.applyQuaternion(mu)),i){let g=dc.set(0,this.vrEulerYOffset*TW,0);i.applyEuler(g),a.x+=i.x,a.z+=i.z,this.nonColliderPosOffset.elements[13]+=i.y*r}if(this.usePhysics===!0){let g=Ta;this.pushedVelocity.set(0,0,0);for(let m of this.sharedGameControlGlobals.entitiesWithTransformAnim){let x=Xh.setFromMatrixPosition(m.matrixWorld).sub(m.prevT).divideScalar(r).divideScalar(this.pixelsPerMeter),w=m.rigidBody.collider(0).castCollider(x,this.object.rigidBody.collider(0),aa.copy(a).divideScalar(this.pixelsPerMeter),r,!1);x.multiplyScalar(this.pixelsPerMeter);let _=Pi.is(m)?m:m.object;if(w!==null&&this.lastHitObj!==_){let M;m instanceof Xs&&(M=m);let S=this.sharedGameControlGlobals.entityToCollisionEvents[_.uuid];if(S)for(let A of S)A.data.target==="character"&&(A.dispatch(M),_.dispatchEvent(Tz));this.lastHitObj=_}if(w!==null){this.pushedVelocity.copy(x),g.copy(w.normal1).applyQuaternion(m.quaternion);break}}if(this.pushedVelocity.manhattanLength()!==0){let m=g.dot(a);m<0&&a.addScaledVector(g,-m),a.add(this.pushedVelocity)}else a.add(this.groundVelocity)}if(this.rotDirection.y=Number(this.movementState.rotPosY)-Number(this.movementState.rotNegY),this.rotDirection.x=Number(this.movementState.rotPosX)-Number(this.movementState.rotNegX),this.rotDirection.normalize(),this.rotationMode==="normal"&&(this.movementState.rotPosX||this.movementState.rotNegX)||this.rotationMode==="steer"&&(this.movementState.rotPosX||this.movementState.rotNegX)&&(this.movementState.movePosZ||this.movementState.moveNegZ||this.moveMode==="walk")?this.rotVelocityStick.x=-this.rotDirection.x*this.speedOrbit*this.rotForce:this.rotVelocityStick.x=0,this.rotationMode==="normal"&&(this.movementState.rotPosY||this.movementState.rotNegY)||this.rotationMode==="steer"&&(this.movementState.rotPosY||this.movementState.rotNegY)&&(this.movementState.movePosZ||this.movementState.moveNegZ)?this.rotVelocityStick.y=-this.rotDirection.y*this.speedOrbit*this.rotForce:this.rotVelocityStick.y=0,this.rotVelocityTarget.subVectors(this.eulerDelta.divideScalar(r),this.rotVelocityStick),this.rotVelocityTarget.manhattanLength()===0?this.rotVelocity.lerp(this.rotVelocityTarget,1-(1-this.lerpFactorRotEnd)**n):this.rotVelocity.lerp(this.rotVelocityTarget,1-(1-this.lerpFactorRotStart)**n),this.euler.x+=this.rotVelocity.x*r,this.euler.y+=this.rotVelocity.y*r+this.groundYRotation,this.rotVelocityTarget.y===0&&this.directionXZ.manhattanLength()===0?this.rotationAccumWhenOrientWithCamera=0:(this.cameraFollow===!1||this.cameraYAxis==="Locked")&&(this.rotationAccumWhenOrientWithCamera+=this.rotVelocity.y*r),this.isFirstPerson===!1&&this.orientMode!=="none"&&this.directionXZ.manhattanLength()>0){if(this.orientMode==="radial"){this.objectToCamXZ.copy(this.objectToCamXZ0).applyAxisAngle(yl,this.euler.y-this.euler0.y);let g=Ta.copy(this.objectToCamXZ).normalize(),m=Xh.copy(a).multiplyScalar(r);m.y=0;let x=m.sub(aa.copy(g).multiplyScalar(m.dot(g))).cross(g).y;this.euler.y-=Math.atan2(x,this.objectToCamXZ.length())}}else this.rot.y+=this.rotVelocity.y*r+this.groundYRotation,this.rotVelocityTarget.y!==0&&(this.cameraFollow===!1||this.cameraYAxis==="Locked")&&(this.euler.y=this.rot.y);if(this.cameraFollow===!0&&(this.moveMode==="walk"?this.cameraXAxis==="Limit"?this.euler.x=Et.clamp(this.euler.x,-this.maxPolarAngle+this.cameraPolarOffset+1e-6,-this.minPolarAngle+this.cameraPolarOffset-1e-6):this.euler.x=Et.clamp(this.euler.x,-this.PI_2+this.cameraPolarOffset,this.PI_2+this.cameraPolarOffset):this.cameraXAxis==="Limit"&&(this.euler.x=Et.clamp(this.euler.x,-this.PI_2,this.PI_2))),this.moveMode==="fly"?this.rot.x=this.euler.x:this.isFirstPerson&&(t?(dc.copy(t),dc.y=0):(dc.copy(this.euler),dc.y=0),this.nonColliderRotOffset.makeRotationFromEuler(dc)),t&&(this.moveMode==="walk"?(this.rot.y=t.y,this.rot.x=0,this.rot.z=0):this.rot.setFromEuler(t),this.rot.y+=this.vrEulerYOffset*TW),vl.setFromAxisAngle(h3e,this.rot.x),mu.setFromAxisAngle(yl,this.rot.y),mu.multiply(vl),vl.setFromAxisAngle(d3e,this.rot.z),mu.multiply(vl),this.quaternion.copy(mu),this.objectRealQuat.multiplyQuaternions(this.quaternion,this.objXZQuat),this.colliderWorldQuat.copy(this.objectRealQuat).multiply(this.collider.rotation),this.collisionEnabled)if(this.usePhysics){let g=Ta.copy(a).multiplyScalar(r/this.pixelsPerMeter),m=null;this.didHit=!1;let x=new B;for(let w=0;w<5;w++){let _=g.length(),M=Xh.copy(g).normalize();if(m=this.sharedGameControlGlobals.rapierWorld.castShape(this.colliderWorldPosition.divideScalar(this.pixelsPerMeter).add(x),this.colliderWorldQuat,M,(c=this.object.rigidBody)==null?void 0:c.collider(0).shape,_,!1,24,void 0,void 0,this.object.rigidBody),m!==null){this.didHit=!0;let S=this.sharedGameControlGlobals.colliderToEntity.get(m.collider.handle);if(S!==this.lastHitObj&&w===0){this.lastHitObj=S;let C=this.sharedGameControlGlobals.entityToCollisionEvents[S==null?void 0:S.uuid];if(C){for(let D of C)if(D.data.target==="character"){let I=((u=this.sharedGameControlGlobals.rapierWorld)==null?void 0:u.getCollider(m.collider.handle))._parent,L;if(S.cloner){for(let z of S.cloner.children)if(z.rigidBody===I){L=z;break}}D.dispatch(L),S.dispatchEvent(Tz)}}}let A=SW.set(m.normal2.x,m.normal2.y,m.normal2.z).applyQuaternion(this.colliderWorldQuat),T=MW.copy(M).multiplyScalar(m.toi).dot(A),E=m.toi;if(E===0&&(this.position.y+=this.offset*this.pixelsPerMeter),T>this.offset&&(E=m.toi*(T-this.offset)/T,x.addScaledVector(M,E)),g.copy(M).multiplyScalar(_-E),Math.acos(-A.y)>this.slopeThresh){let C=this.colliderWorldPosition.divideScalar(this.pixelsPerMeter).add(x),D=Xh.copy(m.witness2).applyQuaternion(this.colliderWorldQuat);D.y=0;let I=C.add(D);I.y+=this.stepThresh;let L=this.sharedGameControlGlobals.rapierWorld.castShape(I,this.colliderWorldQuat,g,(h=this.object.rigidBody)==null?void 0:h.collider(0).shape,1,!1,24,void 0,void 0,this.object.rigidBody);L!==null&&L.toi===0&&(A.y=0,A.normalize())}g.addScaledVector(A,-g.dot(A))}else{w===0&&this.directionXZ.manhattanLength()!==0&&(this.lastHitObj=null),x.add(g);break}}this.position.addScaledVector(x,this.pixelsPerMeter),(d=this.object.rigidBody)==null||d.setTranslation(aa.copy(this.position).divideScalar(this.pixelsPerMeter),!0),(p=this.object.rigidBody)==null||p.setRotation(vl.copy(this.quaternion).premultiply(this.groundTilt).multiply(this.objXZQuat),!0)}else{let g=this.onObject?1:5,m=a.multiplyScalar(r/g);for(let x=0;x<g;x++)this.position.add(m),this.collisionAdjustment(r/g)}else this.position.addScaledVector(a,r);if(this.moveMode==="walk"&&this.onObject&&(this.velocityTarget.y=0,this.velocity.y=0),this.quaternion.premultiply(this.groundTilt).multiply(this.objXZQuat),this.object.matrix.compose(this.position,this.quaternion,this.scale),this.object.matrixWorldNeedsUpdate=!0,this.object.matrix.multiply(this.nonColliderPosOffset).multiply(this.nonColliderRotOffset),this.quaternion.premultiply(this.groundTiltInv).multiply(this.objXZQuatInv),this.cameraFollow===!0){this.updateFollowArms();let g=this.objectToTarget.add(this.position),m=this.targetToCamera.add(g);dR.lookAt(m,g,yl).setPosition(m),dR.decompose(this.targetPos,this.targetQuat,aa),this.camera.quaternion.slerp(this.targetQuat,1-(1-this.lerpFactorRotCamera)**n),this.camera.position.lerp(this.targetPos,1-(1-this.lerpFactorPosCamera)**n),this.camera.updateMatrix(),this.camera.updateMatrixWorld(),this.cameraYAxis==="Limit"&&this.orientMode==="cartesian"&&(this.euler.y=Et.clamp(this.euler.y,this.minAzimuthAngleRel,this.maxAzimuthAngleRel)),this.euler.x=Et.clamp(this.euler.x,-this.PI_2+(this.cameraPolarOffset<0?this.cameraPolarOffset:0),this.PI_2+(this.cameraPolarOffset>0?this.cameraPolarOffset:0))}return this.eulerDelta.set(0,0,0),this.object.dispatchEvent(y3e),this.path.length<2&&this.lastPosition.distanceToSquared(this.position)<this.threshEndTranslate&&Math.abs(this.rotVelocity.x)<this.threshEndRotVel&&Math.abs(this.rotVelocity.y)<this.threshEndRotVel&&(this.camera===void 0||this.isFirstPerson||this.lastCameraPosition.distanceToSquared(this.camera.position)<this.threshEndTranslate&&8*(1-this.lastCameraQuaternion.dot(this.camera.quaternion))<this.threshEndRotate)&&(this.moveMode==="fly"||this.onObject===!0||this.collisionEnabled===!1)&&(this.navMeshPathDest===null||this.navMeshPathDest.material.opacity<-.04*((v=(f=this.navMeshPathDest)==null?void 0:f.material)==null?void 0:v.userData.opacity0))?!1:(this.camera&&(this.lastCameraPosition.copy(this.camera.position),this.lastCameraQuaternion.copy(this.camera.quaternion)),this.lastPosition.copy(this.position),this.object.dispatchEvent(v3e),!0)}updateFollowArms(){this.objectToTarget.copy(this.objectToTarget0),this.targetToCamera.copy(this.targetToCamera0);let e=vl.setFromAxisAngle(yl,this.cameraYAxis==="Limit"&&this.orientMode!=="radial"?Et.clamp(this.euler.y-this.euler0.y,this.minAzimuthAngleRel,this.maxAzimuthAngleRel):this.euler.y-this.euler0.y);(this.cameraYAxis!=="Locked"||this.orientMode==="radial")&&this.objectToTarget.applyQuaternion(e);let t;this.cameraXAxis==="Limit"?t=Et.clamp(this.euler.x,-this.maxPolarAngle+this.cameraPolarOffset+1e-6,-this.minPolarAngle+this.cameraPolarOffset-1e-6):t=Et.clamp(this.euler.x,-this.PI_2+this.cameraPolarOffset+1e-6,this.PI_2+this.cameraPolarOffset-1e-6);let i=aa.copy(this.cameraPolarAxis0);(this.cameraYAxis!=="Locked"||this.orientMode==="radial")&&i.applyQuaternion(e);let r=mu.setFromAxisAngle(i,t);this.cameraYAxis!=="Locked"&&this.targetToCamera.applyQuaternion(e),this.cameraXAxis!=="Locked"&&this.targetToCamera.applyQuaternion(r)}groundTiltAdjustment(e){yl.angleTo(e)*180/Math.PI<15||yl.angleTo(e)*180/Math.PI>85?vl.identity():vl.setFromUnitVectors(yl,e),this.groundTilt.slerp(vl,.06),this.groundTiltInv.copy(this.groundTilt).invert()}collisionAdjustment(e){var n;let t=MW.set(0,0,0);this.object.matrix.compose(this.position,this.quaternion,this.scale);let i=dR.multiplyMatrices(this.object.matrix,this.objXZRotMat).multiply(this.collider.matrix).decompose(aa,vl,Ta).compose(aa,vl,AW);this.sharedGameControlGlobals.entitiesWithTransformAnim.forEach(s=>{if(s===this.object||s.isDescendantOf(this.object))return;Oo.makeEmpty(),s.updateMatrixWorldSVD();let a=s.matrixWorldRigid,o=EW.copy(a).invert(),l=u3e.copy(EW).multiply(i);Yn.copy(this.collider.segment),Yn.start.applyMatrix4(l),Yn.end.applyMatrix4(l);let c=SW.copy(this.position).applyMatrix4(o);Oo.expandByPoint(Yn.start),Oo.expandByPoint(Yn.end),Oo.min.addScalar(-this.collider.radius),Oo.max.addScalar(this.collider.radius),s.bvhGeometry.boundsTree.shapecast({traverseBoundsOrder(u){return u.distanceToPoint(Yn.end)},intersectsBounds:u=>u.intersectsBox(Oo),intersectsTriangle:u=>{let h=aa,d=Ta,p=u.closestPointToSegment(Yn,h,d);if(p<this.collider.radius){let f=this.collider.radius-p,v=d.sub(h).normalize(),g=Xh.copy(c);g.addScaledVector(v,f);let m=g.applyMatrix4(a).sub(this.position);t.add(m),Yn.start.addScaledVector(v,f),Yn.end.addScaledVector(v,f)}}})}),Oo.makeEmpty(),Yn.copy(this.collider.segment),Yn.start.applyMatrix4(i),Yn.end.applyMatrix4(i),Oo.expandByPoint(Yn.start),Oo.expandByPoint(Yn.end),Oo.min.addScalar(-this.collider.radius),Oo.max.addScalar(this.collider.radius),(n=this.sharedGameControlGlobals.staticMeshBVH)==null||n.shapecast({traverseBoundsOrder(s){return s.distanceToPoint(Yn.end)},intersectsBounds:s=>s.intersectsBox(Oo),intersectsTriangle:s=>{let a=aa,o=Ta,l=s.closestPointToSegment(Yn,a,o);if(l<this.collider.radius){let c=this.collider.radius-l,u=o.sub(a).normalize();this.alignToGround&&this.groundTiltAdjustment(u),t.addScaledVector(u,c),Yn.start.addScaledVector(u,c),Yn.end.addScaledVector(u,c)}}}),this.onObject=Math.abs(t.y)>Math.abs(e*this.velocity.y*.25),this.onObject&&this.dispatchStopEvent("jump");let r=Math.max(0,t.length()-1e-5);t.normalize().multiplyScalar(r),this.position.add(t)}},oJ=Az;oJ.isLocked=!1;var x3e=Sh(gY());function Nu(e,t){let i=new Bt;if(!e.getAttribute("position"))return i.setAttribute("position",new St([],3)),i.setIndex([]),i;let{positions:r,triIndices:n}=FT(e.getAttribute("position"),e.getIndex());return i.setAttribute("position",new St(r,3)),i.setIndex(n),t&&i.applyMatrix4(t),i}var w3e=new ht,b3e=new ht,pc=[[0,0,0],[0,0,0],[0,0,0]];function lJ(e){let t=e.elements;pc[0][0]=t[0],pc[0][1]=t[4],pc[0][2]=t[8],pc[1][0]=t[1],pc[1][1]=t[5],pc[1][2]=t[9],pc[2][0]=t[2],pc[2][1]=t[6],pc[2][2]=t[10];let{u:i,v:r}=(0,x3e.SVD)(pc),n=w3e.set(i[0][0],i[0][1],i[0][2],0,i[1][0],i[1][1],i[1][2],0,i[2][0],i[2][1],i[2][2],0,0,0,0,1),s=b3e.set(r[0][0],r[0][1],r[0][2],0,r[1][0],r[1][1],r[1][2],0,r[2][0],r[2][1],r[2][2],0,0,0,0,1);return n.multiply(s.transpose())}var _3e=class extends lQ{constructor(){super(),this.layers.enable(3),this.layers.enable(8)}setFromCamera(e,t){t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,-1).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):t.isPerspectiveCamera?(this.ray.origin.set(e.x,e.y,-1).unproject(t),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):console.error("Raycaster: Unsupported camera type.")}intersectVisibleObjects(e,t=!0,i=[]){return e.forEach(r=>{r.visible&&this.intersectObject(r,t,i)}),i}createRaycastLineHelper(){let e=new rp({color:65280,linewidth:10}),t=new B(this.ray.origin.x,this.ray.origin.y,this.ray.origin.z),i=new B(this.ray.direction.x,this.ray.direction.y,this.ray.direction.z),r=this.camera.far-this.camera.near,n=new B().addVectors(t,i.multiplyScalar(r)),s=new Bt;return s.setFromPoints([t,n]),new wA(s,e)}},cJ=e=>e instanceof Rv||e instanceof Iv;function S3e(e,t){return e.distance-t.distance}function uJ(e,t,i){if(!(!zu(t)||!t.visible)){Pl(t)&&t.raycast(e,i);for(let r of t.children)uJ(e,r,i)}}function TE(e,t,i,r=!1){if(!r&&!i.some(s=>mC(e,s)!==void 0))return[];let n=[];return t.children.forEach(s=>uJ(e,s,n)),n.sort(S3e),n}function Cz(e){let t=[];if(e.length){let i=e[0].object;zu(i)&&t.push(i);let r=i.parent;for(;r;)cJ(r)&&t.push(r),r=r.parent}return t}function Bu(e,t,i,r){let n=e.frame;if(n){let s=t[0]*n.width,a=(1-t[1])*n.height;for(let o of i){let l=o===n.uuid?n:n.find(o);if(l!=null&&l.intersects(s,a))return r(l),!0}}return!1}function mC(e,t){if(Pl(t)){if(t.visible){let i=[];return t.raycast(e,i),i.length?i[0]:void 0}}else if(cJ(t))return hJ(e,t)}function hJ(e,t){if(!(!zu(t)||!t.visible)){if(Pl(t)){let i=[];if(t.raycast(e,i),i.length)return i[0]}for(let i of t.children){let r=hJ(e,i);if(r)return r}}}function M3e(e,t,i){return{x:(e-(i.left+window.scrollX))/i.width*2-1,y:-((t-(i.top+window.scrollY))/i.height)*2+1}}function E3e(e,t,i){return{x:(e-(i.left+window.scrollX))/i.width,y:1-(t-(i.top+window.scrollY))/i.height}}var A3e=class{constructor(e,t,i,r,n,s,a,o){this.renderer=e,this.publish=t,this.scene=i,this.getCamera=r,this.sharedAssets=n,this.requestRender=s,this.isExport=a,this.frame=o,this.raycaster=new _3e,this._useWindowEvents=!1,this.pointerWorld={x:0,y:0},this.pointerScreen={x:0,y:0},this._useWindowEvents=t.mouseEventTarget==="window",this.domElement=e.domElement,this.eventElement=this._useWindowEvents?window:e.domElement,this._domRect=this.domElement.getBoundingClientRect()}get stopRaycast(){return this.publish.stopRaycast}get page(){return this.scene.activePage}set useWindowEvents(e){this._useWindowEvents=e,this.eventElement=e?window:this.renderer.domElement}get useWindowEvents(){return this._useWindowEvents}set domRect(e){this._domRect=e}get domRect(){return this._domRect}updateRaycaster(e){var r;let{pageX:t,pageY:i}=((r=e.touches)==null?void 0:r.length)>0?e.touches[0]:e;this.pointerWorld=M3e(t,i,this._domRect),this.pointerScreen=E3e(t,i,this._domRect),this.raycaster.setFromCamera(this.pointerWorld,this.getCamera())}},qa=class{constructor(e){this.eventContext=e,this.domEventsNeeded=new Set,this.hasVideoAction=!1}connect(){}disconnect(){}},Wk=[["start","Start"],["keyDown","KeyDown"],["keyUp","KeyUp"],["mouseDown","MouseDown"],["mouseUp","MouseUp"],["mouseHover","MouseHover"],["collision","Collision"],["lookAt","LookAt"],["follow","Follow"],["scroll","Scroll"]],dJ=e=>{var t;return(t=Wk.find(([i,r])=>r===e))==null?void 0:t[0]},Qw=e=>{var t;return(t=Wk.find(([i])=>i===e))==null?void 0:t[1]},C3e=(e,t)=>{let i=dJ(e);if(i){let r=new CustomEvent(i,{bubbles:!0});return Object.defineProperty(r,"target",{writable:!1,value:t}),r}},T3e=class extends qa{constructor(){super(...arguments),this.objectsPerEvents=new Map,this.splineEvents={},this.onBeginEvent=e=>{var r;if(!e.eventName||!e.target||e.eventName==="Scroll")return;let t=(r=this.splineEvents[dJ(e.eventName)])==null?void 0:r[e.target.uuid];if(!t)return;e.eventName==="Scroll"&&e.deltaY!==void 0&&Object.assign(t,{deltaY:e.deltaY});let{domElement:i}=this.eventContext;i.dispatchEvent(t)}}connect(){let{page:e}=this.eventContext;e.traverseEntity(t=>{var i,r;if((i=t.data)!=null&&i.events.length){for(let[n,s]of Wk)if(t.data.events.some(a=>a.data.type===s&&!a.data.disabled)){this.objectsPerEvents.has(n)?(r=this.objectsPerEvents.get(n))==null||r.push(t):this.objectsPerEvents.set(n,[t]);let a={id:t.uuid,name:t.name},o=C3e(s,a),l=this.splineEvents[n];l?l[t.uuid]=o:this.splineEvents[n]={[t.uuid]:o}}}}),this.objectsPerEvents.forEach(t=>{t.forEach(i=>{i.addEventListener("beginEvent",this.onBeginEvent)})})}disconnect(){this.objectsPerEvents.forEach(e=>{e.forEach(t=>{t.removeEventListener("beginEvent",this.onBeginEvent)})})}},P3e=class{constructor(e,t,i,r,n,s){if(this.id=e,this.data=t,this.object=i,this.entered=!1,(t.type==="KeyDown"||t.type==="KeyUp"||t.type==="KeyPress")&&!t.key)throw new Error("Missing property");this.actions=hs(t,t.actions,r,n,s,i)}disconnect(){as(this.actions)}dispatchHeld(e){this.actions.Create.forEach(t=>{e&&t.dispatchThrottled.cancel(),t.dispatchThrottled()})}dispatch(e=!1){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),this.data.type==="MousePress"||this.data.type==="KeyPress"?this.entered||(this.entered=!0,this.actions.Transition.forEach(t=>t.playFromCurrent()),this.actions.Animation.forEach(t=>t.playFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.playFromCurrent()),this.actions.Create.forEach(t=>t.dispatchStart())):(this.actions.Transition.some(t=>t.playing&&t.data.runMode!=="Toggle")||this.actions.Transition.forEach(t=>{t.data.runMode==="Toggle"?t.toggle():t.play()}),this.actions.SwitchCamera.some(t=>t.playing&&t.data.runMode!=="Toggle")||this.actions.SwitchCamera.forEach(t=>{t.data.runMode==="Toggle"?t.toggle():t.play()}),this.actions.Animation.forEach(t=>{t.data.runMode==="Toggle"?t.toggle():t.play()})),this.actions.Link.forEach(t=>{t.dispatch()}),this.actions.SceneTransition.forEach(t=>{t.dispatch()}),e===!1&&this.actions.Create.forEach(t=>{t.dispatch()}),this.actions.Destroy.forEach(t=>{t.dispatch()}),this.actions.Reset.forEach(t=>{t.dispatch()}),this.actions.Audio.forEach(t=>{t.dispatchBasic()}),this.actions.Video.forEach(t=>{t.dispatchBasic()}),this.actions.Particles.forEach(t=>{t.dispatchBasic()}),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch())}dispatchRelease(){this.entered&&(this.entered=!1,this.actions.Transition.forEach(e=>e.reverseFromCurrent()),this.actions.Particles.forEach(e=>e.reverseFromCurrent()),this.actions.Animation.forEach(e=>e.reverseFromCurrent()),this.actions.SwitchCamera.forEach(e=>e.reverseFromCurrent()),this.actions.Create.forEach(e=>e.dispatchStop()))}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>t.playFromCurrent()),this.actions.Animation.forEach(t=>t.playFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.playFromCurrent())),this.actions.Link.forEach(t=>{t.dispatch()}),this.actions.SceneTransition.forEach(t=>{t.dispatch()}),this.actions.Create.forEach(t=>{t.dispatch()}),this.actions.Destroy.forEach(t=>{t.dispatch()}),this.actions.Reset.forEach(t=>{t.dispatch()}),this.actions.Audio.forEach(t=>{t.dispatchBasic()}),this.actions.Video.forEach(t=>{t.dispatchBasic()}),this.actions.Particles.forEach(t=>{t.dispatchBasic()}),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch())}},D3e=class extends qa{constructor(e,t,i){super(e),this.eventManager=t,this.useForRaycastProperty=i,this.objectsPerTypes={MouseDown:[],MouseUp:[],MousePress:[],KeyDown:[],KeyUp:[],KeyPress:[]},this.canvasMouseEvents=[],this.eventsPerObjects={MouseDown:{},MouseUp:{},MousePress:{},KeyDown:{},KeyUp:{},KeyPress:{}},this.heldKeys={},this.heldKeysPress={},this._prevObjects=[],this.sceneInterects=null,this.onCanvasRaycast=r=>{if(this.useForRaycastProperty===!0&&this.sceneInterects===null){this.eventContext.updateRaycaster(r);let{raycaster:n,page:s}=this.eventContext,a=TE(n,s,[],!0);this.sceneInterects=a,a.length&&(this.eventContext.sharedAssets.raycastProperty={x:a[0].point.x,y:a[0].point.y,z:a[0].point.z,objX:a[0].object.matrixWorld.elements[12],objY:a[0].object.matrixWorld.elements[13],objZ:a[0].object.matrixWorld.elements[14]})}},this.onCanvasMouseDown=r=>{(r.target===this.eventContext.domElement||r.target.tagName==="SPLINE-VIEWER")&&this.canvasMouseEvents.forEach(n=>{(n.data.type==="MouseDown"||n.data.type==="MousePress")&&(this.onCanvasRaycast(r),n.dispatch())})},this.onCanvasMouseUp=r=>{(r.target===this.eventContext.domElement||r.target.tagName==="SPLINE-VIEWER")&&this.canvasMouseEvents.forEach(n=>{n.data.type==="MouseUp"?(this.onCanvasRaycast(r),n.dispatch()):n.data.type==="MousePress"&&n.dispatchRelease()})},this.onMouseDown=r=>{Yt.length>1||(this.eventContext.updateRaycaster(r),this.handleMouseEvent("MouseDown"))},this.onMouseUp=r=>{Yt.length>1||(this.eventContext.updateRaycaster(r),this.handleMouseEvent("MouseUp"))},this.onMousePressDown=r=>{Yt.length>1||(this.eventContext.updateRaycaster(r),this.handleMousePressEvent())},this.onMousePressRelease=r=>{Yt.length>1||(this.eventContext.updateRaycaster(r),this.handleMousePressEvent(!0))},this.onKeyDown=r=>{this.heldKeys[r.key]||(this.handleKeyEvent(r,"KeyDown"),this.handleKeyEventHeld(r,"KeyDown",!0)),this.heldKeys[r.key]=!0},this.onKeyUp=r=>{this.handleKeyEvent(r,"KeyUp"),this.handleKeyEventHeld(r,"KeyUp",!0)},this.onKeyPressDown=r=>{this.heldKeysPress[r.key]?this.handleKeyEventHeld(r,"KeyPress"):(this.handleKeyEvent(r,"KeyPress"),this.handleKeyEventHeld(r,"KeyPress",!0)),this.heldKeysPress[r.key]=!0},this.onKeyPressUp=r=>{this.handleKeyEvent(r,"KeyPress",!0)},this.releaseHeldKey=r=>{delete this.heldKeys[r.key]},this.releaseHeldKeyPress=r=>{delete this.heldKeysPress[r.key]},this._onUserEvent=({eventName:r,target:n,reverse:s})=>{var o,l,c,u;if(!r||!n)return;let a=Qw(r);a&&(a==="MouseDown"||a==="MouseUp"||a==="MousePress"?(n.dispatchEvent({type:"beginEvent",eventName:a}),(l=(o=this.eventsPerObjects[a])==null?void 0:o[n.uuid])==null||l.forEach(h=>{h.dispatchUserEvent(s)})):(a==="KeyDown"||a==="KeyUp"||a==="KeyPress")&&(n.dispatchEvent({type:"beginEvent",eventName:a}),(u=(c=this.eventsPerObjects[a])==null?void 0:c[n.uuid])==null||u.forEach(h=>{h.dispatchUserEvent()})))}}connect(){var n,s,a,o,l,c;let{page:e,sharedAssets:t,domElement:i}=this.eventContext,r=(u,h)=>{var p,f;if(!((p=u.data)!=null&&p.events.length))return;let d=["MouseDown","MouseUp","MousePress","KeyDown","KeyUp","KeyPress"];for(let v of d){let g=this.eventsPerObjects[v];u.data.events.filter(({data:m})=>m.type===v&&m.disabled!==!0).forEach(({id:m,data:x})=>{try{let w=new P3e(m,x,u,e,t,this.eventManager);w.actions.Video.length&&(this.hasVideoAction=!0),(x.type==="MouseDown"||x.type==="MouseUp"||x.type==="MousePress")&&(x.mode==="Canvas"||x.mode==="Window")?this.canvasMouseEvents.push(w):g[u.uuid]?g[u.uuid].some(_=>_.id===w.id)||g[u.uuid].push(w):g[u.uuid]=[w]}catch{}}),(f=g[u.uuid])!=null&&f.length&&this.objectsPerTypes[v].push(u instanceof cs&&(v==="MouseDown"||v==="MouseUp"||v==="MousePress")?h:u)}};e.traverseEntity(u=>{var h;(u instanceof js||u instanceof es)&&((h=u.frame)==null||h.traverse(d=>{r(d,u)})),r(u)}),this.heldKeys={},this.heldKeysPress={},this.domEventsNeeded.clear(),i.addEventListener("pointerdown",this.onCanvasMouseDown),i.addEventListener("pointerup",this.onCanvasMouseUp),((n=this.objectsPerTypes.MouseDown)!=null&&n.length||this.useForRaycastProperty)&&(this.domEventsNeeded.add("pointerdown"),i.addEventListener("pointerdown",this.onMouseDown)),(s=this.objectsPerTypes.MouseUp)!=null&&s.length&&(this.domEventsNeeded.add("pointerup"),i.addEventListener("pointerup",this.onMouseUp)),(a=this.objectsPerTypes.MousePress)!=null&&a.length&&(this.domEventsNeeded.add("pointerdown"),i.addEventListener("pointerdown",this.onMousePressDown),this.domEventsNeeded.add("pointerup"),i.addEventListener("pointerup",this.onMousePressRelease)),(o=this.objectsPerTypes.KeyDown)!=null&&o.length&&(this.domEventsNeeded.add("keydown"),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.releaseHeldKey)),(l=this.objectsPerTypes.KeyUp)!=null&&l.length&&(this.domEventsNeeded.add("keyup"),document.addEventListener("keyup",this.onKeyUp)),(c=this.objectsPerTypes.KeyPress)!=null&&c.length&&(this.domEventsNeeded.add("keydown"),document.addEventListener("keydown",this.onKeyPressDown),document.addEventListener("keyup",this.releaseHeldKeyPress),this.domEventsNeeded.add("keyup"),document.addEventListener("keyup",this.onKeyPressUp)),Object.entries(this.objectsPerTypes).forEach(([u,h])=>{h.forEach(d=>{d.addEventListener("userEvent",this._onUserEvent)})})}disconnect(){let{domElement:e}=this.eventContext;this.domEventsNeeded.clear(),this.heldKeys={},this.heldKeysPress={},e.removeEventListener("pointerdown",this.onCanvasMouseDown),e.removeEventListener("pointerup",this.onCanvasMouseUp),e.removeEventListener("pointerdown",this.onMouseDown),e.removeEventListener("pointerdown",this.onMousePressDown),e.removeEventListener("pointerup",this.onMouseUp),e.removeEventListener("pointerup",this.onMousePressRelease),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp),document.removeEventListener("keydown",this.onKeyPressDown),document.removeEventListener("keyup",this.onKeyPressUp),document.removeEventListener("keyup",this.releaseHeldKey),Object.values(this.eventsPerObjects).forEach(t=>{Object.values(t).forEach(i=>{i.forEach(r=>{r.disconnect()})})}),this.canvasMouseEvents.forEach(t=>{t.disconnect()}),Object.entries(this.objectsPerTypes).forEach(([t,i])=>{i.forEach(r=>{r.removeEventListener("userEvent",this._onUserEvent)})})}handleMouseEvent(e){var o,l,c,u;let{stopRaycast:t,raycaster:i,page:r,pointerScreen:n}=this.eventContext,s=this.objectsPerTypes[e],a=s.filter(h=>!(h instanceof cs));if(!(!s.length&&!this.useForRaycastProperty)&&!(r.uiCanvas&&Bu(r,[n.x,n.y],Object.keys(this.eventsPerObjects[e]),h=>{this.handleObjectMouseEventDispatch(h,e)}))){if(t||this.useForRaycastProperty){let h;if(this.sceneInterects===null?h=TE(i,r,a,this.useForRaycastProperty):(h=this.sceneInterects,this.sceneInterects=null),this.useForRaycastProperty&&h.length&&(this.eventContext.sharedAssets.raycastProperty={x:h[0].point.x,y:h[0].point.y,z:h[0].point.z,objX:h[0].object.matrixWorld.elements[12],objY:h[0].object.matrixWorld.elements[13],objZ:h[0].object.matrixWorld.elements[14]}),t){let d=[((l=(o=h[0])==null?void 0:o.uv)==null?void 0:l.x)??0,((u=(c=h[0])==null?void 0:c.uv)==null?void 0:u.y)??0];Cz(h).forEach(p=>{p instanceof js&&Bu(p,d,Object.keys(this.eventsPerObjects[e]),f=>{this.handleObjectMouseEventDispatch(f,e)}),this.eventsPerObjects[e][p.uuid]&&this.handleObjectMouseEventDispatch(p,e)})}}t||a.forEach(h=>{var p,f;let d=mC(i,h);d&&(this.handleObjectMouseEventDispatch(h,e),h instanceof js&&Bu(h,[((p=d==null?void 0:d.uv)==null?void 0:p.x)??0,((f=d==null?void 0:d.uv)==null?void 0:f.y)??0],Object.keys(this.eventsPerObjects[e]),v=>{this.handleObjectMouseEventDispatch(v,e)}))})}}handleMousePressEvent(e=!1){let t="MousePress",i=this.objectsPerTypes[t],r=i.filter(s=>!(s instanceof cs)),n=[];if(i.length){if(!e){let{stopRaycast:s,raycaster:a,page:o,pointerScreen:l}=this.eventContext,c=!1;if(o.uiCanvas&&(c=Bu(o,[l.x,l.y],Object.keys(this.eventsPerObjects[t]),u=>{n.push(u)})),s&&!c){let u=TE(a,o,r);n=Cz(u),u.forEach(h=>{var d,p;h.object instanceof js&&Bu(h.object,[((d=h==null?void 0:h.uv)==null?void 0:d.x)??0,((p=h==null?void 0:h.uv)==null?void 0:p.y)??0],Object.keys(this.eventsPerObjects[t]),f=>{n.push(f)})})}else r.forEach(u=>{var d,p;let h=mC(a,u);h&&(n.push(u),u instanceof js&&Bu(u,[((d=h==null?void 0:h.uv)==null?void 0:d.x)??0,((p=h==null?void 0:h.uv)==null?void 0:p.y)??0],Object.keys(this.eventsPerObjects[t]),f=>{n.push(f)}))})}this._prevObjects.length&&this._prevObjects.forEach(s=>{n.includes(s)||this.handleObjectMouseEventDispatchRelease(s,t)}),n.length&&n.forEach(s=>{this.handleObjectMouseEventDispatch(s,t)}),this._prevObjects=n}}handleObjectMouseEventDispatch(e,t){var i,r;e.dispatchEvent({type:"beginEvent",eventName:t}),(r=(i=this.eventsPerObjects[t])==null?void 0:i[e.uuid])==null||r.forEach(n=>{n.dispatch()})}handleObjectMouseEventDispatchRelease(e,t){var i,r;e.dispatchEvent({type:"beginEvent",eventName:t}),(r=(i=this.eventsPerObjects[t])==null?void 0:i[e.uuid])==null||r.forEach(n=>{n.dispatchRelease()})}handleKeyEvent(e,t,i=!1){this.objectsPerTypes[t].forEach(r=>{let n=this.eventsPerObjects[t][r.uuid];n.some(({data:s})=>"key"in s&&s.key===e.key)&&r.dispatchEvent({type:"beginEvent",eventName:t}),n.forEach(s=>{"key"in s.data&&s.data.key===e.key&&(i?s.dispatchRelease():s.dispatch(!0))})})}handleKeyEventHeld(e,t,i=!1){this.objectsPerTypes[t].forEach(r=>{this.eventsPerObjects[t][r.uuid].forEach(n=>{"key"in n.data&&n.data.key===e.key&&n.dispatchHeld(i)})})}},R3e=new B,I3e=new B,pJ=class{constructor(e,t,i,r,n){this.actionsIn=hs(e,e.inActions,i,r,n,t),this.actionsOut=hs(e,e.outActions,i,r,n,t)}disconnect(){as(this.actionsIn),as(this.actionsOut)}},L3e=class extends pJ{constructor(e,t,i,r,n,s){super(t,i,r,n,s),this.id=e,this.data=t,this.object=i,this.stage="out",this.objects=[],this.onUpdateMatrixWorld=()=>{for(let d of this.objects)if(!d.visible)return;let c=R3e.setFromMatrixPosition(this.objects[0].matrixWorld),u=I3e.setFromMatrixPosition(this.objects[1].matrixWorld),h=c.distanceTo(u)<=this.distance?"in":"out";if(this.stage!==h){this.stage=h;let d=h==="in"?this.actionsIn:this.actionsOut;d.Audio.forEach(p=>p.dispatchConditional()),d.Particles.forEach(p=>p.dispatchConditional()),d.Video.forEach(p=>p.dispatchConditional()),d.Link.forEach(p=>p.dispatch()),d.Create.forEach(p=>p.dispatch()),d.Destroy.forEach(p=>p.dispatch()),d.Reset.forEach(p=>p.dispatch()),d.Transition.forEach(p=>{p.object.currentTransitionEvent!==this&&(p.object.currentTransitionEvent=this),p.init()}),d.Transition.forEach(p=>p.play()),d.Animation.forEach(p=>p.play()),d.SwitchCamera.forEach(p=>p.play()),d.SceneTransition.forEach(p=>p.dispatch()),d.SetVariable.forEach(p=>p.checkConditions()),d.SetVariable.forEach(p=>p.dispatch()),d.DynamicVariablePlay.forEach(p=>p.dispatch()),d.ClearLocalStorage.forEach(p=>p.dispatch()),d.UserAPI.forEach(p=>p.dispatch())}};let{distance:a,fromObject:o,toObject:l}=t.condition;this.distance=a;for(let c of[o,l]){if(!c)throw new Error("Missing property");let u=r.find(c);if(!u)throw new Error("Missing property");this.objects.push(u)}}connect(){window.setTimeout(()=>{this.objects.forEach(e=>{e.addEventListener("updateMatrixWorld",this.onUpdateMatrixWorld)}),this.onUpdateMatrixWorld()},0)}disconnect(){super.disconnect(),this.stage="out",this.objects.forEach(e=>{e.removeEventListener("updateMatrixWorld",this.onUpdateMatrixWorld)})}},O3e=class extends pJ{constructor(e,t,i,r,n,s){var l;super(t,i,r,n,s),this.id=e,this.data=t,this.object=i,this.onBegin=({target:c,state:u})=>{this.toState!==u&&(this.actionsOut.Audio.forEach(h=>h.dispatchConditional()),this.actionsOut.Particles.forEach(h=>h.dispatchConditional()),this.actionsOut.Video.forEach(h=>h.dispatchConditional()),this.actionsOut.Link.forEach(h=>h.dispatch()),this.actionsOut.Create.forEach(h=>h.dispatch()),this.actionsOut.Destroy.forEach(h=>h.dispatch()),this.actionsOut.Reset.forEach(h=>h.dispatch()),this.actionsIn.Transition.forEach(h=>h.pause()),this.object.currentTransitionEvent=this,this.actionsOut.Transition.forEach(h=>h.play()),this.actionsOut.Animation.forEach(h=>h.play()),this.actionsIn.SwitchCamera.forEach(h=>h.pause()),this.actionsOut.SwitchCamera.forEach(h=>h.play()),this.actionsOut.SceneTransition.forEach(h=>h.dispatch()),this.actionsOut.SetVariable.forEach(h=>h.checkConditions()),this.actionsOut.SetVariable.forEach(h=>h.dispatch()),this.actionsOut.DynamicVariablePlay.forEach(h=>h.dispatch()),this.actionsOut.ClearLocalStorage.forEach(h=>h.dispatch()),this.actionsOut.UserAPI.forEach(h=>h.dispatch()))},this.onComplete=({target:c,state:u})=>{this.toState===u&&(this.actionsIn.Audio.forEach(h=>h.dispatchConditional()),this.actionsIn.Particles.forEach(h=>h.dispatchConditional()),this.actionsIn.Video.forEach(h=>h.dispatchConditional()),this.actionsIn.Link.forEach(h=>h.dispatch()),this.actionsIn.Create.forEach(h=>h.dispatch()),this.actionsIn.Destroy.forEach(h=>h.dispatch()),this.actionsIn.Reset.forEach(h=>h.dispatch()),this.actionsOut.Transition.forEach(h=>h.pause()),this.actionsOut.Transition.forEach(h=>h.pause()),this.object.currentTransitionEvent=this,this.actionsIn.Transition.forEach(h=>h.play()),this.actionsIn.Animation.forEach(h=>h.play()),this.actionsOut.SwitchCamera.forEach(h=>h.pause()),this.actionsIn.SwitchCamera.forEach(h=>h.play()),this.actionsIn.SceneTransition.forEach(h=>h.dispatch()),this.actionsIn.SetVariable.forEach(h=>h.checkConditions()),this.actionsIn.SetVariable.forEach(h=>h.dispatch()),this.actionsIn.DynamicVariablePlay.forEach(h=>h.dispatch()),this.actionsOut.ClearLocalStorage.forEach(h=>h.dispatch()),this.actionsOut.UserAPI.forEach(h=>h.dispatch()))};let{condition:a}=t;if(!a.object)throw new Error("Missing property");let o=r.find(a.object)??r.scene.find2D(a.object);if(!o)throw new Error("Missing property");if(this.toObject=o,a.state&&!((l=this.toObject.states)!=null&&l[a.state]))throw new Error("Missing property");this.toState=a.state}connect(){sf(this.actionsOut).forEach(e=>{var t;(t=this.actionsOut[e])!=null&&t.length&&this.toObject.addEventListener("beginState",this.onBegin)}),sf(this.actionsIn).forEach(e=>{var t;(t=this.actionsIn[e])!=null&&t.length&&this.toObject.addEventListener("completeState",this.onComplete)})}disconnect(){super.disconnect(),sf(this.actionsOut).forEach(e=>{var t;(t=this.actionsIn[e])!=null&&t.length&&this.toObject.removeEventListener("beginState",this.onBegin)}),sf(this.actionsIn).forEach(e=>{var t;(t=this.actionsIn[e])!=null&&t.length&&this.toObject.removeEventListener("completeState",this.onComplete)})}},z3e=class extends qa{constructor(e,t){super(e),this.eventManager=t,this.eventsPerConditions={Comparison:[],Distance:[],State:[]},this.hasVideoAction=!1}connect(){super.connect();let{page:e,sharedAssets:t}=this.eventContext;e.traverseEntity(i=>{var r;if((r=i.data)!=null&&r.events.length){for(let{id:n,data:s}of i.data.events)if(!s.disabled&&s.type==="Conditional")try{let a;s.condition.type==="Comparison"||(s.condition.type==="Distance"?a=new L3e(n,s,i,e,t,this.eventManager):s.condition.type==="State"&&(a=new O3e(n,s,i,e,t,this.eventManager))),a&&(this.eventsPerConditions[s.condition.type].push(a),(a.actionsIn.Video.length||a.actionsOut.Video.length)&&(this.hasVideoAction=!0))}catch{}}}),Object.values(this.eventsPerConditions).forEach(i=>i.forEach(r=>r.connect()))}disconnect(){super.disconnect(),Object.values(this.eventsPerConditions).forEach(e=>e.forEach(t=>t.disconnect()))}},jy=new B,qh=new B,Sp=new B,PW=new Ia,N3e=.01,Xi=new B,Ln=new B,DW=new B,ff=new ei,pR=new Nn,B3e=new ht,fR=new Mn,Jm=new B,fc=new B,eg=.2;function mR(e,t){!t||(t[0]<t[1]&&(e.x=Math.min(Math.max(e.x,t[0]),t[1])),t[2]<t[3]&&(e.y=Math.min(Math.max(e.y,t[2]),t[3])),t[4]<t[5]&&(e.z=Math.min(Math.max(e.z,t[4]),t[5])))}var k3e=function(){let e=new ht;return(t,i,r)=>{let n=t.obj;e.copy(n.hiddenMatrix),n.parent!==null&&e.premultiply(n.parent.matrixWorld),e.invert(),n.position.copy(i),t.reference==="global"&&mR(n.position,t.limits),n.position.applyMatrix4(e),t.reference==="parent"?mR(n.position,t.limits):t.reference==="local"&&(ff.copy(t.quat0).invert(),n.position.sub(t.position0),n.position.applyQuaternion(ff),mR(n.position,t.limits),ff.invert(),n.position.applyQuaternion(ff),n.position.add(t.position0)),e.multiply(r??n.matrixWorld).decompose(Xi,n.quaternion,Ln),n.updateMatrix(),n.hasNonUniformScale&&(n.updateMatrixWorld(),n.updateMatrixWorldSVD()),n instanceof wa&&Zu(n.parent)&&n.invalidateDownstreamBooleanData(!0)}}(),U3e=class{constructor(e,t,i,r,n,s,a){this.object=e,this.id=t,this.data=i,this.dropDestIds=[],this.activeIdx=null,this.wasDragEventTriggered=!1,this.resetDampingFactor=this.data.resetSpeed===0?1:8/this.data.resetSpeed+1,this.snapDampingFactor=this.data.snapSpeed===0?1:8/this.data.snapSpeed+1,this.actionsDrag=hs(i,i.dragDropActions.drag,r,n,s,this.object),this.actionsDrop=hs(i,i.dragDropActions.drop,r,n,s,this.object);let o=[];this.data.objects.forEach(l=>{let c=r.find(l);!c||c.data.visible!==!1&&(o.push(c),a[c.uuid]&&a[c.uuid].forEach(u=>{let h=r.find(u);!h||h.data.visible!==!1&&o.push(h)}))}),this.data.dropDestinations.forEach(l=>{let c=r.find(l);!c||c.data.visible!==!1&&(this.dropDestIds.push(c.uuid),a[c.uuid]&&a[c.uuid].forEach(u=>{let h=r.find(u);!h||h.data.visible!==!1&&this.dropDestIds.push(h.uuid)}))}),this.dragItems=o.map(l=>(this.data.planeMode==="locked"&&(l.userData.lockedPlane=!0),l.userData.worldPosition0=new B().setFromMatrixPosition(l.matrixWorld),{obj:l,fromPosition:new B().setFromMatrixPosition(l.matrixWorld),pointStart:new B,pointEnd:new B,paused:!0,currentDampingFactor:this.data.dampingFactor,reset:!1,position0:new B().copy(l.position),quat0:new ei().copy(l.quaternion),snapped:!1,orientationMatrix:new ht,limits:this.data.limits,reference:this.data.referenceFrame}))}get activeDragItem(){return this.activeIdx!==null?this.dragItems[this.activeIdx]:null}dispose(){as(this.actionsDrag),as(this.actionsDrop),this.dragItems.forEach(e=>{e.fromPosition.copy(e.obj.userData.worldPosition0),e.pointStart.copy(e.fromPosition),e.pointEnd.copy(e.pointStart),e.obj.recursiveBBoxNeedsUpdate=!0,e.obj.userData.lockedPlane=void 0,e.obj.position.copy(e.position0),e.obj.quaternion.copy(e.quat0),e.obj.updateMatrix()})}},F3e=class extends qa{constructor(e,t){super(e),this.eventManager=t,this.events=[],this.lastDropDestination=null,this.dragTimeout=null,this.onPointerDown=i=>{var a;if(Yt.length>1)return;this.eventContext.updateRaycaster(i);let{raycaster:r,page:n}=this.eventContext,s=n.raycastWithClones(r);if(this.lastDropDestination=null,s.length===0){this.activeEvent=null;return}for(let o of this.events){let l=0;for(let{obj:c,pointEnd:u,pointStart:h}of o.dragItems){if(c===s[0].object||c===s[0].object.object||Pi.is(c)&&c.isAncestorOf(s[0].object.uuid)){if(o.activeIdx=l,o.activeDragItem.reset=!1,o.activeDragItem.currentDampingFactor=o.data.dampingFactor,o.activeDragItem.snapped=!1,o.data.cursor==="hand"&&this.setCursor("grabbing"),this.eventManager.controlsManager.usePhysics){o.activeDragItem.obj.rigidBody&&o.activeDragItem.obj.rigidBody.setBodyType(2,!0);let d=o.activeDragItem.obj;c.hasNonUniformScale&&c.updateMatrixWorldSVD(),(d.hasNonUniformScale?d.matrixWorldRigid:d.matrixWorld).decompose(Xi,ff,Ln),pR.setFromQuaternion(ff),d.prevR===void 0?(d.prevR=pR.clone(),d.prevT=Xi.clone()):(d.prevR.copy(pR),d.prevT.copy(Xi)),this.eventManager.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.push(o.activeDragItem.obj)}this.calcPlaneIntersectPos(c,h,o.data.plane,o.data.referenceFrame),u.copy(h),(this.eventManager.controlsManager.usePhysics&&((a=c.data.physics)==null?void 0:a.rigidBody)==="dynamic"||o.data.drop===!1||o.data.resetOnSnapFail===!1)&&o.activeDragItem.fromPosition.setFromMatrixPosition(o.activeDragItem.obj.matrixWorld),this.activeEvent=o,this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!1);return}l++}}this.activeEvent=null},this.onPointerMove=i=>{var a,o,l,c;if(Yt.length>1)return;this.eventContext.updateRaycaster(i);let{raycaster:r,page:n}=this.eventContext,s=n.raycastWithClones(r);if(Yt.length===0){let u=!1;for(let h of this.events){for(let{obj:d}of h.dragItems)if(d===((a=s[0])==null?void 0:a.object)||d===((l=(o=s[0])==null?void 0:o.object)==null?void 0:l.object)||Pi.is(d)&&d.isAncestorOf((c=s[0])==null?void 0:c.object.uuid)){switch(u=!0,h.data.cursor){case"hand":this.setCursor("grab");break;case"move":this.setCursor("move");break}break}if(u)break}u||this.setCursor("default");return}if(this.activeEvent&&this.activeEvent.activeDragItem){let u=this.activeEvent.activeDragItem;u.snapped=!1;let h;if(this.activeEvent.data.drop&&(h=s.filter(d=>u.obj!==d.object&&!u.obj.isAncestorOf(d.object.uuid)&&!(d.object instanceof Rv)&&(this.activeEvent.data.dropOn==="all"||this.activeEvent.dropDestIds.some(p=>p===d.object.uuid||n.scene.find(p).isAncestorOf(d.object.uuid))))[0]),h){let d=DW.copy(h.face.normal).applyMatrix3(fR.getNormalMatrix(h.object.matrixWorld));if(this.activeEvent.data.snapTo==="center")u.fromPosition.setFromMatrixPosition(h.object.matrixWorld);else if(this.activeEvent.data.snapTo==="surface"){if(u.fromPosition.copy(h.point),this.activeEvent.data.snapSurfaceMode==="bbox"){Xi.copy(d).applyMatrix3(fR.setFromMatrix4(u.obj.matrixWorld).transpose());let p=u.obj;Xi.x>eg?Ln.x=-p.recursiveBBox.min.x:Xi.x<-eg&&(Ln.x=-p.recursiveBBox.max.x),Xi.y>eg?Ln.y=-p.recursiveBBox.min.y:Xi.y<-eg&&(Ln.y=-p.recursiveBBox.max.y),Xi.z>eg?Ln.z=-p.recursiveBBox.min.z:Xi.z<-eg&&(Ln.z=-p.recursiveBBox.max.z),Ln.applyMatrix3(fR.invert())}else Ln.copy(d).multiplyScalar(this.activeEvent.data.snapSurfaceOffset);u.fromPosition.add(Ln)}this.activeEvent.data.autoOrient&&(Xi.set(0,1,0).cross(d),Xi.length()<1e-4&&Xi.set(-1,0,0).cross(d),Ln.crossVectors(DW,Xi),u.orientationMatrix.makeBasis(Xi,Ln,d)),u.pointStart.copy(u.fromPosition),u.pointEnd.copy(u.pointStart),u.currentDampingFactor=this.activeEvent.snapDampingFactor,u.snapped=!0,this.lastDropDestination!==h.object&&(this.lastDropDestination=h.object,this.activeEvent.actionsDrop.Transition.forEach(p=>{p.play()}),this.activeEvent.actionsDrop.Animation.forEach(p=>{p.play()}),this.activeEvent.actionsDrop.Audio.forEach(p=>{p.dispatchGameControl("start")}),this.activeEvent.actionsDrop.Particles.forEach(p=>{p.dispatchGameControl("start")}),this.activeEvent.actionsDrop.Create.forEach(p=>{p.dispatchThrottled()}))}else u.orientationMatrix.makeRotationFromQuaternion(u.quat0),this.lastDropDestination=null,u.currentDampingFactor=this.activeEvent.data.dampingFactor,this.calcPlaneIntersectPos(u.obj,u.pointEnd,this.activeEvent.data.plane,this.activeEvent.data.referenceFrame),this.activeEvent.actionsDrop.Transition.forEach(d=>{d.stop(),d.object.currentState!==null&&d.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})}),this.activeEvent.actionsDrop.Animation.forEach(d=>{d.stop()}),this.activeEvent.actionsDrop.Audio.forEach(d=>{d.dispatchGameControl("stop")}),this.activeEvent.actionsDrop.Particles.forEach(d=>{d.dispatchGameControl("stop")});this.activeEvent.actionsDrag.Create.forEach(d=>{d.dispatchThrottled()}),this.activeEvent.actionsDrag.SetVariable.forEach(d=>d.checkConditions()),this.activeEvent.actionsDrag.SetVariable.forEach(d=>d.dispatch()),this.activeEvent.actionsDrag.DynamicVariablePlay.forEach(d=>d.dispatch()),this.activeEvent.actionsDrag.ClearLocalStorage.forEach(d=>d.dispatch()),this.activeEvent.actionsDrag.UserAPI.forEach(d=>d.dispatch()),this.activeEvent.wasDragEventTriggered===!1&&(this.activeEvent.wasDragEventTriggered=!0,this.activeEvent.actionsDrag.Transition.forEach(d=>{d.play()}),this.activeEvent.actionsDrag.Animation.forEach(d=>{d.play()}),this.activeEvent.actionsDrag.Audio.forEach(d=>{d.dispatchGameControl("start")}),this.activeEvent.actionsDrag.Particles.forEach(d=>{d.dispatchGameControl("start")})),this.dragTimeout&&window.clearTimeout(this.dragTimeout),this.dragTimeout=window.setTimeout(()=>{!this.activeEvent||(this.activeEvent.wasDragEventTriggered=!1,this.activeEvent.actionsDrag.Audio.forEach(d=>{d.dispatchGameControl("stop")}),this.activeEvent.actionsDrag.Particles.forEach(d=>{d.dispatchGameControl("stop")}),this.activeEvent.actionsDrag.Transition.forEach(d=>{d.stop(),d.object.currentState!==null&&d.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})}),this.activeEvent.actionsDrag.Animation.forEach(d=>{d.stop()}))},500),this.updateDragItem(u),u.obj.dispatchEvent({type:"requestRender"})}},this.onPointerUp=i=>{var r;if(this.activeEvent&&this.activeEvent.activeDragItem){this.activeEvent.data.cursor==="hand"&&this.setCursor("grab");let n=((r=this.activeEvent.activeDragItem.obj.data.physics)==null?void 0:r.rigidBody)==="dynamic";this.activeEvent.activeDragItem.snapped===!1&&this.activeEvent.data.drop&&this.activeEvent.data.resetOnSnapFail&&(this.eventManager.controlsManager.usePhysics===!1||!n)&&(this.activeEvent.activeDragItem.reset=this.activeEvent.data.resetOnSnapFail,this.activeEvent.activeDragItem.paused=!1,this.activeEvent.activeDragItem.currentDampingFactor=this.activeEvent.resetDampingFactor),this.eventManager.controlsManager.usePhysics&&n&&(this.eventManager.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.pop(),this.activeEvent.activeDragItem.obj.rigidBody.setBodyType(0,!0),this.activeEvent.activeDragItem.paused=!0),this.activeEvent.wasDragEventTriggered===!0&&(this.activeEvent.wasDragEventTriggered=!1,this.activeEvent.actionsDrag.Transition.forEach(s=>{s.stop(),s.object.currentState!==null&&s.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})}),this.activeEvent.actionsDrag.Animation.forEach(s=>{s.stop()}),this.activeEvent.actionsDrag.Audio.forEach(s=>{s.dispatchGameControl("stop")}),this.activeEvent.actionsDrag.Particles.forEach(s=>{s.dispatchGameControl("stop")}),this.activeEvent.actionsDrop.SetVariable.forEach(s=>s.checkConditions()),this.activeEvent.actionsDrop.SetVariable.forEach(s=>s.dispatch()),this.activeEvent.actionsDrop.DynamicVariablePlay.forEach(s=>s.dispatch()),this.activeEvent.actionsDrop.ClearLocalStorage.forEach(s=>s.dispatch()),this.activeEvent.actionsDrop.UserAPI.forEach(s=>s.dispatch())),this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!0)}}}connect(){let e={};if(this.eventContext.page.traverseEntity(i=>{i.component&&(e[i.component.uuid]?e[i.component.uuid].push(i.uuid):e[i.component.uuid]=[i.uuid])}),this.eventContext.page.traverseEntity(i=>{var r;(r=i.data)==null||r.events.filter(n=>n.data.type==="DragDrop"&&!n.data.disabled).forEach(n=>{this.events.push(new U3e(i,n.id,n.data,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager,e))})}),!this.events.length)return;this.domEventsNeeded.clear(),this.domEventsNeeded.add("pointerdown");let t=this.eventContext.domElement;t.addEventListener("pointerdown",this.onPointerDown),t.addEventListener("pointermove",this.onPointerMove),t.addEventListener("pointerup",this.onPointerUp),this.domEventsNeeded.add("pointermove")}disconnect(){if(!this.events.length)return;this.domEventsNeeded.clear();let e=this.eventContext.domElement;e.removeEventListener("pointerdown",this.onPointerDown),e.removeEventListener("pointermove",this.onPointerMove),e.removeEventListener("pointerup",this.onPointerUp),this.events.forEach(t=>t.dispose())}setCursor(e){this.eventContext.domElement.style.cursor=e}onAnimationFrameDamping(){for(let e of this.events)for(let t of e.dragItems)t.paused||this.updateDragItem(t,!0)}calcPlaneIntersectPos(e,t,i,r){let{getCamera:n,raycaster:s}=this.eventContext;n().getWorldDirection(qh),qh.negate();let a=ff.identity();switch(r==="parent"?B3e.multiplyMatrices(e.parent.matrixWorld,e.hiddenMatrix).decompose(Xi,a,Ln):r==="local"&&e.matrixWorld.decompose(Xi,a,Ln),i){case"x":Xi.set(1,0,0).applyQuaternion(a),Jm.copy(qh).cross(Xi),fc.copy(Xi).cross(Jm);break;case"y":Xi.set(0,1,0).applyQuaternion(a),Jm.copy(qh).cross(Xi),fc.copy(Xi).cross(Jm);break;case"z":Xi.set(0,0,1).applyQuaternion(a),Jm.copy(qh).cross(Xi),fc.copy(Xi).cross(Jm);break;case"xy":fc.set(0,0,1).applyQuaternion(a);break;case"yz":fc.set(1,0,0).applyQuaternion(a);break;case"xz":fc.set(0,1,0).applyQuaternion(a);break;case"adaptive":qh.angleTo(Ln.set(0,1,0))>Math.PI/6?(Xi.crossVectors(Ln.set(0,1,0),qh),fc.crossVectors(Xi,Ln)):fc.set(0,1,0);break;default:fc.copy(qh);break}Sp.setFromMatrixPosition(e.matrixWorld);let o=e.userData.lockedPlane?e.userData.worldPosition0:Sp;if(PW.setFromNormalAndCoplanarPoint(fc,o),!!s.ray.intersectPlane(PW,t)&&(i==="x"||i==="y"||i==="z")){let l=Ln.subVectors(t,o).dot(Xi);t.copy(o).addScaledVector(Xi,l)}}updateDragItem(e,t=!1){var i,r;Sp.setFromMatrixPosition(e.obj.matrixWorld),e.reset==="current"?jy.subVectors(e.fromPosition,Sp).divideScalar(e.currentDampingFactor):e.reset==="original"?(jy.subVectors(e.obj.userData.worldPosition0,Sp).divideScalar(e.currentDampingFactor),e.fromPosition.copy(e.obj.userData.worldPosition0),e.pointStart.copy(e.fromPosition),e.pointEnd.copy(e.pointStart)):jy.subVectors(e.pointEnd,e.pointStart).add(e.fromPosition).sub(Sp).divideScalar(e.currentDampingFactor),e.paused=e.currentDampingFactor>1?jy.length()<N3e:!0,(this.activeEvent&&this.activeEvent.data.dampingFactor===1||t)&&k3e(e,jy.add(Sp),(i=this.activeEvent)!=null&&i.data.drop&&((r=this.activeEvent)!=null&&r.data.autoOrient)?e.orientationMatrix:null),e.obj.dispatchEvent({type:"beginEvent",eventName:"DragDrop"}),this.eventManager.requestRender()}},tg=new B,gR=new B,gu=new B,vu=new B,RW=new Ia,V3e=.01,H3e={type:"requestRender"},G3e=function(){let e=new B,t=new B;return(i,r,n)=>n>0?(e.subVectors(i,r),e.length()<=n?i:t.copy(r).add(e.normalize().multiplyScalar(n))):r}(),IW=function(){let e=new ht;return(t,i)=>{t.position.copy(i),t.parent!==null&&(e.copy(t.parent.matrixWorld).invert(),t.position.applyMatrix4(e)),e.copy(t.hiddenMatrix).invert(),t.position.applyMatrix4(e),t.updateMatrix(),t.hasNonUniformScale&&(t.updateMatrixWorld(),t.updateMatrixWorldSVD()),t instanceof wa&&Zu(t.parent)&&t.invalidateDownstreamBooleanData(!0)}}(),j3e=class{constructor(e,t,i,r,n,s){this.data=e,this.id=t,this.object=i,this.paused=!1,this.currentDampingFactor=1,this.snapComplete=!1,this.isReset=!1,this.worldPosition0=new B,this.timeoutId=null,this.delayFinished=!0,this.wasOutside=!1,this.data={...nO.defaultData,...e,...e.resetOnPointerLeave===void 0&&{resetOnPointerLeave:!1}},e.target===void 0||e.target==="cursor"||(this.target=r.find(e.target)),this.data.dampingFactor&&(this.currentDampingFactor=this.data.dampingFactor),this.resetDampingFactor=80/this.data.resetSpeed+1,this.object.getWorldPosition(this.worldPosition0),this.actions=hs(e,e.actions,r,n,s,i)}},W3e=class extends qa{constructor(e,t){super(e),this.eventManager=t,this.events=[],this.pairOfEventListeners=[],this.onMouseMove=i=>{if(!(Yt.length>1)){this.eventContext.updateRaycaster(i);for(let r of this.events)r.target===void 0&&this.updateSingleEvent(r)}},this.onMouseEnter=i=>{for(let r of this.events)r.target===void 0&&(r.isReset=!1,r.currentDampingFactor=r.data.dampingFactor)},this.onMouseLeave=i=>{for(let r of this.events)r.target===void 0&&(r.data.resetOnPointerLeave&&(r.isReset=!0,r.currentDampingFactor=r.resetDampingFactor),this.updateSingleEvent(r))},this.onTargetChange=i=>()=>{this.updateSingleEvent(i)}}connect(){let{page:e}=this.eventContext;if(e.traverseEntity(r=>{var s,a;let n=(s=r.data)==null?void 0:s.events.find(o=>o.data.type==="Follow"&&!o.data.disabled);n&&(!e.data.globalPhysics.usePhysics||((a=r.dataPatched.physics)==null?void 0:a.rigidBody)!=="dynamic")&&this.events.push(new j3e(n.data,n.id,r,e,this.eventContext.sharedAssets,this.eventManager))}),!this.events.length)return;let{domElement:t,eventElement:i}=this.eventContext;this.domEventsNeeded.clear(),uo&&(this.domEventsNeeded.add("pointerdown"),t.addEventListener("pointerdown",this.onMouseMove)),this.domEventsNeeded.add("pointermove"),i.addEventListener("pointermove",this.onMouseMove),this.eventContext.useWindowEvents||(t.addEventListener("pointerenter",this.onMouseEnter),t.addEventListener("pointerleave",this.onMouseLeave));for(let r of this.events)if(r.target!==void 0){let n=r.target,s=this.onTargetChange(r);this.pairOfEventListeners.push([n,s]),n.addEventListener("requestRender",s)}}disconnect(){if(!this.events.length)return;let{domElement:e,eventElement:t}=this.eventContext;this.domEventsNeeded.clear(),uo&&e.removeEventListener("pointerdown",this.onMouseMove),t.removeEventListener("pointermove",this.onMouseMove),e.removeEventListener("pointerenter",this.onMouseEnter),e.removeEventListener("pointerleave",this.onMouseLeave);for(let[i,r]of this.pairOfEventListeners)i.removeEventListener("requestRender",r);for(let i of this.events)i.paused=!0,i.isReset=!1,as(i.actions)}onAnimationFrameDamping(){for(let e of this.events)e.paused||this.updateSingleEvent(e,!0)}updateSingleEvent(e,t=!1){var a;this.events.forEach(o=>{o.actions.Create.forEach(l=>{l.dispatchThrottled()})});let{plane:i,limitDistance:r,limitDistanceEnabled:n}=e.data;if(e.object.getWorldPosition(gu),e.isReset)vu.copy(e.worldPosition0);else if(e.target)e.target.getWorldPosition(vu);else{let{getCamera:o,raycaster:l}=this.eventContext;if(i==="custom"?(o().getWorldDirection(gR),gR.negate(),tg.copy(gR)):i==="xy"?tg.set(0,0,1):i==="xz"?tg.set(0,1,0):i==="yz"&&tg.set(1,0,0),RW.setFromNormalAndCoplanarPoint(tg,gu),!l.ray.intersectPlane(RW,vu))return}if(!e.isReset){if(vu.distanceTo(e.worldPosition0)>r&&n&&e.target)if(e.snapComplete=!1,e.data.snapDelay&&(e.delayFinished=!1,typeof window<"u"&&e.timeoutId!==null&&(window.clearTimeout(e.timeoutId),e.timeoutId=null)),e.wasOutside=!0,e.data.resetAfterDistanceLimit)vu.copy(e.worldPosition0),e.currentDampingFactor=e.resetDampingFactor;else return;else if(e.wasOutside&&(e.data.snapDelay&&typeof window<"u"&&(e.timeoutId=window.setTimeout(()=>{e.delayFinished=!0,e.paused=!1,this.updateSingleEvent(e)},e.data.snapDelay*1e3)),e.currentDampingFactor=e.data.dampingFactor,e.wasOutside=!1),e.delayFinished===!1)return}e.data.enabledTranslation[0]===!1&&(vu.x=gu.x),e.data.enabledTranslation[1]===!1&&(vu.y=gu.y),e.data.enabledTranslation[2]===!1&&(vu.z=gu.z);let s=G3e(gu,vu,e.wasOutside?0:e.data.maxDelta);if(e.currentDampingFactor>1){let o=tg.subVectors(s,gu).divideScalar(e.currentDampingFactor);gu.add(o),t&&IW(e.object,gu),e.paused=o.length()<V3e}else IW(e.object,s),e.paused=!0;(a=e.object)==null||a.dispatchEvent({type:"beginEvent",eventName:"Follow"}),e.object.dispatchEvent(H3e)}},Wy=new B,HS=new B,Xy=new ht,ig=new ei,Yh=new ei,qy=new B,Yy=new B,Mp=new B,yu=new B,vR=new Ia,X3e=1e-6,q3e={type:"requestRender"},Y3e={type:"changeRotation"},LW=function(){let e=new ht;return function(t,i){t.parent!==null?e.multiplyMatrices(t.parent.matrixWorld,t.hiddenMatrix):e.copy(t.hiddenMatrix),i.premultiply(lJ(e).invert()),t.rotation.setFromRotationMatrix(i),t.updateMatrix(),t instanceof wa&&Zu(t.parent)&&t.invalidateDownstreamBooleanData(!0)}}(),Q3e=class{constructor(e,t,i,r){this.id=t,this.object=i,this.paused=!1,this.currentDampingFactor=1,this.isReset=!1,this.worldQuaternion0=new ei,this.timeoutId=null,this.delayFinished=!0,this.wasOutside=!1,this.data={...sO.defaultData,...e,...e.resetOnPointerLeave===void 0&&{resetOnPointerLeave:!1}},e.target===void 0||e.target==="cursor"||(this.target=r.find(e.target)),this.data.dampingFactor&&(this.currentDampingFactor=this.data.dampingFactor),this.object.getWorldQuaternion(this.worldQuaternion0),this.resetDampingFactor=80/this.data.resetSpeed+1}},K3e=class extends qa{constructor(){super(...arguments),this.events=[],this.pairOfEventListeners=[],this.pairOfUserEventListeners=[],this.onMouseMove=e=>{if(!(Yt.length>1)){this._lastMouseEvent=e,this.eventContext.updateRaycaster(e);for(let t of this.events)t.target===void 0&&this.updateSingleEvent(t)}},this.onMouseEnter=e=>{for(let t of this.events)t.target===void 0&&(t.isReset=!1,t.currentDampingFactor=t.data.dampingFactor)},this.onMouseLeave=e=>{for(let t of this.events)t.target===void 0&&(t.data.resetOnPointerLeave&&(t.isReset=!0,t.currentDampingFactor=t.resetDampingFactor),this.updateSingleEvent(t))},this.onScroll=e=>{if(this._lastMouseEvent){let t=new PointerEvent("pointermove",{clientX:this._lastMouseEvent.clientX,clientY:this._lastMouseEvent.clientY,bubbles:!0,cancelable:!0,view:window});this.eventContext.eventElement.dispatchEvent(t)}},this.onTargetChange=e=>()=>{this.updateSingleEvent(e)},this.createUserEventListener=e=>({eventName:t,target:i})=>{if(!t||!i)return;let r=Qw(t);r&&r==="LookAt"&&this.updateSingleEvent(e)}}connect(){let{page:e}=this.eventContext;if(e.traverseEntity(r=>{var s,a;let n=(s=r.data)==null?void 0:s.events.find(o=>o.data.type==="LookAt"&&!o.data.disabled);n&&(!e.data.globalPhysics.usePhysics||((a=r.dataPatched.physics)==null?void 0:a.rigidBody)!=="dynamic")&&this.events.push(new Q3e(n.data,n.id,r,e))}),!this.events.length)return;let{domElement:t,eventElement:i}=this.eventContext;this.domEventsNeeded.clear(),uo&&(this.domEventsNeeded.add("pointerdown"),t.addEventListener("pointerdown",this.onMouseMove)),this.domEventsNeeded.add("pointermove"),i.addEventListener("pointermove",this.onMouseMove),this.eventContext.useWindowEvents?i.addEventListener("scroll",this.onScroll):(t.addEventListener("pointerenter",this.onMouseEnter),t.addEventListener("pointerleave",this.onMouseLeave));for(let r of this.events){if(r.target!==void 0){let a=this.onTargetChange(r),o=r.target;this.pairOfEventListeners.push([o,a]),o.addEventListener("requestRender",a)}let n=this.createUserEventListener(r),s=r.object;this.pairOfUserEventListeners.push([s,n]),s.addEventListener("userEvent",n)}}disconnect(){if(!this.events.length)return;let{domElement:e,eventElement:t}=this.eventContext;this.domEventsNeeded.clear(),uo&&e.removeEventListener("pointerdown",this.onMouseMove),t.removeEventListener("pointermove",this.onMouseMove),e.removeEventListener("pointerenter",this.onMouseEnter),e.removeEventListener("pointerleave",this.onMouseLeave),t.removeEventListener("scroll",this.onScroll);for(let[i,r]of this.pairOfEventListeners)i.removeEventListener("requestRender",r);for(let[i,r]of this.pairOfUserEventListeners)i.removeEventListener("userEvent",r);for(let i of this.events)i.paused=!0,i.isReset=!1}onAnimationFrameDamping(){for(let e of this.events)e.paused||this.updateSingleEvent(e)}updateSingleEvent(e){var d;let{tilt:t,axis:i,distance:r,plane:n,limitDistance:s,enabledRotation:a,limitDistanceEnabled:o}=e.data,{getCamera:l,raycaster:c}=this.eventContext,{object:u,target:h}=e;if(u.getWorldPosition(qy),!e.isReset)if(e.target)e.target.getWorldPosition(Yy);else{if(n==="custom"?(l().getWorldDirection(HS),HS.negate(),vR.setFromNormalAndCoplanarPoint(HS,qy)):(n==="xy"?Wy.set(0,0,1):n==="xz"?Wy.set(0,1,0):n==="yz"&&Wy.set(1,0,0),vR.setFromNormalAndCoplanarPoint(Wy,qy)),!c.ray.intersectPlane(vR,Yy))return;r>0&&(n==="custom"||n===void 0)&&Yy.addScaledVector(HS,r)}if(e.isReset||(h?t==="target"?Mp.copy(h.up).applyMatrix4(Xy.extractRotation(h.matrixWorld)).normalize():a.some(p=>p===!1)?(i==="x"?(yu.set(0,0,1),a[2]===!1&&yu.set(0,1,0)):i==="y"?(yu.set(1,0,0),a[0]===!1&&yu.set(0,0,1)):(yu.set(0,1,0),a[1]===!1&&yu.set(1,0,0)),Mp.copy(yu).applyQuaternion(e.worldQuaternion0).normalize()):Mp.set(0,1,0):n==="custom"?Mp.set(0,1,0):Mp.copy(Wy)),e.isReset)Yh.copy(e.worldQuaternion0);else if(qy.distanceTo(Yy)>s&&o&&h)if(e.data.snapDelay&&(e.delayFinished=!1,typeof window<"u"&&e.timeoutId!==null&&(window.clearTimeout(e.timeoutId),e.timeoutId=null)),e.wasOutside=!0,e.data.resetAfterDistanceLimit)Yh.copy(e.worldQuaternion0),e.currentDampingFactor=e.resetDampingFactor;else return;else{if(e.wasOutside&&(e.data.snapDelay&&typeof window<"u"&&(e.timeoutId=window.setTimeout(()=>{e.delayFinished=!0,e.paused=!1,this.updateSingleEvent(e)},e.data.snapDelay*1e3)),e.currentDampingFactor=e.data.dampingFactor,e.wasOutside=!1),e.delayFinished===!1)return;Z3e(Xy,Yy,qy,Mp,i,yu),Yh.setFromRotationMatrix(Xy),ig.setFromUnitVectors(yu.applyQuaternion(Yh),Mp),a.some(p=>p===!1)&&t!=="target"&&Yh.premultiply(ig).normalize()}e.currentDampingFactor>1?(u.updateWorldMatrix(!0,!1),ig.setFromRotationMatrix(lJ(u.matrixWorld)),ig.slerp(Yh,1/e.currentDampingFactor),LW(u,Xy.makeRotationFromQuaternion(ig)),e.paused=8*(1-ig.dot(Yh))<X3e):(LW(u,Xy.makeRotationFromQuaternion(Yh)),e.paused=!0),(d=e.object)==null||d.dispatchEvent({type:"beginEvent",eventName:"LookAt"}),u.dispatchEvent(q3e),u.dispatchEvent(Y3e)}},zo=new B,In=new B,nn=new B;function Z3e(e,t,i,r,n,s){let a=e.elements;nn.subVectors(t,i),nn.lengthSq()===0&&(nn.z=1),nn.normalize(),In.crossVectors(r,nn),In.lengthSq()===0&&(Math.abs(r.z)===1?nn.x+=1e-4:nn.z+=1e-4,nn.normalize(),In.crossVectors(r,nn)),In.normalize(),zo.crossVectors(nn,In),n==="x"?s.z===1?[In,zo,nn]=[nn,In,zo]:(In.negate(),[In,nn]=[nn,In]):n==="y"?s.x===1?[In,zo,nn]=[zo,nn,In]:(In.negate(),[zo,nn]=[nn,zo]):s.x===1&&(In.negate(),[In,zo]=[zo,In]),a[0]=In.x,a[4]=zo.x,a[8]=nn.x,a[1]=In.y,a[5]=zo.y,a[9]=nn.y,a[2]=In.z,a[6]=zo.z,a[10]=nn.z}var $3e=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.entered=!1,this.actions=hs(t,t.actions,r,n,s,i)}disconnect(){as(this.actions)}dispatchEnter(){this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),this.entered||(this.entered=!0,this.actions.Transition.forEach(e=>e.playFromCurrent()),this.actions.Animation.forEach(e=>e.play()),this.actions.Create.forEach(e=>e.dispatchStart()),this.actions.Particles.forEach(e=>e.dispatchBasic()),this.actions.Destroy.forEach(e=>e.dispatch()),this.actions.SwitchCamera.forEach(e=>e.playFromCurrent()),this.actions.SceneTransition.forEach(e=>e.dispatch()),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.ClearLocalStorage.forEach(e=>e.dispatch()),this.actions.UserAPI.forEach(e=>e.dispatch()))}dispatchLeave(){this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),this.entered&&(this.entered=!1,this.actions.Create.forEach(e=>e.dispatchStop()),this.actions.Transition.forEach(e=>e.reverseFromCurrent()),this.actions.Particles.forEach(e=>e.reverseFromCurrent()),this.actions.SwitchCamera.forEach(e=>e.reverseFromCurrent()))}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Particles.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>t.playFromCurrent()),this.actions.Animation.forEach(t=>t.playFromCurrent()),this.actions.Create.forEach(t=>t.dispatch()),this.actions.Particles.forEach(t=>t.dispatchBasic()),this.actions.Destroy.forEach(t=>t.dispatch()),this.actions.SwitchCamera.forEach(t=>t.playFromCurrent())),this.actions.SceneTransition.forEach(t=>t.dispatch()),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch())}},J3e=class extends qa{constructor(e,t){super(e),this.eventManager=t,this.eventsPerObjects={},this.objects=[],this.objects2D=[],this._prevObjects=[],this.onMouseDown=i=>{Yt.length>1||(this.eventContext.updateRaycaster(i),this.handleMouseHoverEvent())},this.onMouseUp=i=>{Yt.length>1||this.handleMouseHoverEvent(!0)},this.onMouseMove=i=>{Yt.length>1||(this.eventContext.updateRaycaster(i),this.handleMouseHoverEvent())},this.onUserEvent=({eventName:i,target:r,reverse:n})=>{var a;if(!i||!r)return;let s=Qw(i);s&&s==="MouseHover"&&(r.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),(a=this.eventsPerObjects[r.uuid])==null||a.forEach(o=>o.dispatchUserEvent(n)))}}connect(){let{page:e,sharedAssets:t}=this.eventContext,i=(n,s)=>{var a,o;if(!(!n.visible||!((a=n.data)!=null&&a.events.length))){for(let{id:l,data:c}of n.data.events)if(!c.disabled&&c.type==="MouseHover")try{let u=new $3e(l,c,n,e,t,this.eventManager);this.eventsPerObjects[n.uuid]?this.eventsPerObjects[n.uuid].push(u):this.eventsPerObjects[n.uuid]=[u]}catch{}(o=this.eventsPerObjects[n.uuid])!=null&&o.length&&this.objects.push(n instanceof cs?s:n)}};if(e.traverseEntity(n=>{var s;(n instanceof js||n instanceof es)&&((s=n.frame)==null||s.traverse(a=>{i(a,n)})),i(n)}),!this.objects.length)return;let{domElement:r}=this.eventContext;this.domEventsNeeded.clear(),uo&&(this.domEventsNeeded.add("pointerdown"),r.addEventListener("pointerdown",this.onMouseDown),this.domEventsNeeded.add("pointerup"),r.addEventListener("pointerup",this.onMouseUp)),this.domEventsNeeded.add("pointermove"),r.addEventListener("pointermove",this.onMouseMove),this.objects.forEach(n=>{n.addEventListener("userEvent",this.onUserEvent)})}disconnect(){if(!this.objects.length)return;let{domElement:e}=this.eventContext;this.domEventsNeeded.clear(),uo&&(e.removeEventListener("pointerdown",this.onMouseDown),e.removeEventListener("pointerup",this.onMouseUp)),e.removeEventListener("pointermove",this.onMouseMove),Object.values(this.eventsPerObjects).forEach(t=>{t.forEach(i=>{i.disconnect()})}),this.objects.forEach(t=>{t.removeEventListener("userEvent",this.onUserEvent)})}handleMouseHoverEvent(e=!1){let t=[];if(!e){let{stopRaycast:i,raycaster:r,page:n,pointerScreen:s}=this.eventContext,a=!1;if(n.uiCanvas&&(a=Bu(n,[s.x,s.y],Object.keys(this.eventsPerObjects),o=>{t.push(o)})),i&&!a){let o=TE(r,n,this.objects);t=Cz(o),o.forEach(l=>{var c,u;l.object instanceof js&&Bu(l.object,[((c=l==null?void 0:l.uv)==null?void 0:c.x)??0,((u=l==null?void 0:l.uv)==null?void 0:u.y)??0],Object.keys(this.eventsPerObjects),h=>{t.push(h)})})}else this.objects.forEach(o=>{var c,u;let l=mC(r,o);l&&(t.push(o),o instanceof js&&Bu(o,[((c=l==null?void 0:l.uv)==null?void 0:c.x)??0,((u=l==null?void 0:l.uv)==null?void 0:u.y)??0],Object.keys(this.eventsPerObjects),h=>{t.push(h)}))})}this._prevObjects.length&&this._prevObjects.forEach(i=>{var r;t.includes(i)||(i.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),(r=this.eventsPerObjects[i.uuid])==null||r.forEach(n=>n.dispatchLeave()))}),t.length&&t.forEach(i=>{var r;i.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),(r=this.eventsPerObjects[i.uuid])==null||r.forEach(n=>n.dispatchEnter())}),this._prevObjects=t}},eRe=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.scrollCounter=0,this.actions=hs(t,t.actions,r,n,s,i)}connect(){this.scrollCounter=0}disconnect(){as(this.actions)}dispatch(e){this.actions.Transition.forEach(r=>{r.object.currentTransitionEvent!==this&&(r.object.currentTransitionEvent=this,r.init())});let t=e>0?1:-1;this.scrollCounter+=t,this.scrollCounter=Math.min(Math.max(this.scrollCounter,0),this.data.steps);let i=this.scrollCounter/this.data.steps;this.actions.Transition.forEach(r=>r.seek(i)),this.actions.Animation.forEach(r=>r.seek(t)),this.actions.Create.forEach(r=>r.dispatchThrottled()),this.actions.SetVariable.forEach(r=>r.checkConditions()),this.actions.SetVariable.forEach(r=>r.dispatch()),this.actions.DynamicVariablePlay.forEach(r=>r.dispatch()),this.actions.ClearLocalStorage.forEach(r=>r.dispatch()),this.actions.UserAPI.forEach(r=>r.dispatch())}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>{t.playFromCurrent()}),this.actions.Animation.forEach(t=>{t.playFromCurrent()})),this.actions.Create.forEach(t=>t.dispatchThrottled()),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch())}},tRe=class{constructor(e,t,i,r,n,s,a){this.id=e,this.data=t,this.object=i,this.domElement=s,this.eventManager=a,this.scrollStart=0,this.scrollEnd=0,this.actions=hs(t,t.actions,r,n,a,i)}getStickyParentElement(){let e=this.domElement;for(;e;){if(window.getComputedStyle(e).position==="sticky")return e;e=e.parentElement}return null}computeScrollBounds(){let e=this.getStickyParentElement(),t=e==null?void 0:e.parentElement,i=this.domElement.getBoundingClientRect(),r={top:i.top,bottom:i.bottom,left:i.left,right:i.right,width:i.width,height:i.height};if(t){let c=t.getBoundingClientRect(),u=window.getComputedStyle(e),h=parseFloat(u.marginTop)+parseFloat(u.marginBottom),d=parseFloat(u.top),p=parseFloat(u.bottom),f=c.height-h;if(!isNaN(d))i.top===d?(r.top+=c.top-d,r.bottom+=c.top-d):i.top<0&&(r.top-=f-i.height,r.bottom-=f-i.height);else if(!isNaN(p)){let v=document.body.clientHeight??window.innerHeight,g=window.innerWidth-(document.documentElement.clientWidth??window.innerWidth);i.bottom===v-p?(r.top+=c.top-i.height+p+g,r.bottom+=c.top-i.height+p+g):i.bottom<v-p&&(r.top-=f-i.height,r.bottom-=f-i.height)}}let n=document.body,s=document.documentElement,a=window.pageYOffset||s.scrollTop||n.scrollTop,o=s.clientTop||n.clientTop||0,l=Math.round(r.top+a-o);if(this.data.startFrom==="enter"){let c=window.innerHeight,u=r.height,h=this.data.enterAnchor,d=h==="top"?c:h==="bottom"?c-u:c-u*.5;this.scrollStart=l-d}else this.scrollStart=0;this.scrollStart+=this.data.startOffset??0,this.scrollEnd=this.scrollStart+(this.data.endAfter??400),this.box=r,this.computeScroll({x:window.scrollX,y:window.scrollY})}connect(){this.computeScrollBounds()}disconnect(){as(this.actions)}handleResize(){this.computeScrollBounds()}get isInvalidBox(){return this.box===void 0||this.box.width===0&&this.box.height===0&&this.box.top===0&&this.box.bottom===0}computeScroll({x:e,y:t}){this.actions.Transition.forEach(n=>{n.object.currentTransitionEvent!==this&&(n.object.currentTransitionEvent=this,n.init())});let i=this.scrollEnd-this.scrollStart,r=Math.min(1,Math.max(0,(t-this.scrollStart)/i));this.actions.Transition.forEach(n=>n.seek(r)),this.actions.Animation.forEach(n=>n.seek(r)),this.actions.Create.forEach(n=>n.dispatchThrottled()),this.actions.SetVariable.forEach(n=>n.checkConditions()),this.actions.SetVariable.forEach(n=>n.dispatch()),this.actions.DynamicVariablePlay.forEach(n=>n.dispatch()),this.actions.ClearLocalStorage.forEach(n=>n.dispatch()),this.actions.UserAPI.forEach(n=>n.dispatch())}dispatch(e){this.isInvalidBox&&this.computeScrollBounds(),this.computeScroll(e)}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>{t.playFromCurrent()}),this.actions.Animation.forEach(t=>{t.playFromCurrent()})),this.actions.Create.forEach(t=>t.dispatchThrottled()),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch())}},iRe=class extends qa{constructor(t,i){super(t),this.managers=i,this.wheelEventsPerObject=new Map,this.scrollEventsPerObject=new Map,this.isInview=!0,this.handleResize=()=>{[...this.scrollEventsPerObject.entries()].forEach(([r,n])=>{n.forEach(s=>s.handleResize())})},this.onScroll=r=>{if(!this.isInview)return;let n={y:window.scrollY,x:window.scrollX};[...this.scrollEventsPerObject.entries()].forEach(([s,a])=>{s.dispatchEvent({type:"beginEvent",eventName:"Scroll",scroll:n}),a.forEach(o=>o.dispatch(n))})},this.onWheel=r=>{!this.isInview||r.ctrlKey||[...this.wheelEventsPerObject.entries()].forEach(([n,s])=>{n.dispatchEvent({type:"beginEvent",eventName:"Scroll",deltaY:r.deltaY}),s.forEach(a=>a.dispatch(r.deltaY))})},this.onUserEvent=({eventName:r,target:n,reverse:s})=>{var o;if(!r||!n)return;let a=Qw(r);a&&a==="Scroll"&&(n.dispatchEvent({type:"beginEvent",eventName:"Scroll"}),(o=this.wheelEventsPerObject.get(n))==null||o.forEach(l=>{l.dispatchUserEvent(s)}))}}connect(){let{page:t,sharedAssets:i,domElement:r,isExport:n}=this.eventContext,s=a=>{var o,l,c;if((o=a.data)!=null&&o.events.length){for(let{id:u,data:h}of a.data.events)if(!h.disabled&&h.type==="Scroll")if(h.trigger==="load"||!n){let d=new eRe(u,h,a,t,i,this.managers);this.wheelEventsPerObject.has(a)?(l=this.wheelEventsPerObject.get(a))==null||l.push(d):this.wheelEventsPerObject.set(a,[d])}else{let d=new tRe(u,h,a,t,i,r,this.managers);this.scrollEventsPerObject.has(a)?(c=this.scrollEventsPerObject.get(a))==null||c.push(d):this.scrollEventsPerObject.set(a,[d])}}};t.traverseEntity(a=>{var o;(a instanceof js||a instanceof es)&&((o=a.frame)==null||o.traverse(l=>{s(l)})),s(a)}),this.intersectionObserver=new IntersectionObserver(a=>{let o=a[0];o&&(this.isInview=o.isIntersecting)},{root:null}),this.intersectionObserver.observe(this.eventContext.domElement),[...this.wheelEventsPerObject.entries()].forEach(([a,o])=>{o.forEach(l=>l.connect()),a.addEventListener("userEvent",this.onUserEvent)}),[...this.scrollEventsPerObject.entries()].forEach(([a,o])=>{o.forEach(l=>l.connect()),a.addEventListener("userEvent",this.onUserEvent)}),[...this.wheelEventsPerObject.values()].some(a=>a.length)&&(this.domEventsNeeded.add("wheel"),window.addEventListener("wheel",this.onWheel)),[...this.scrollEventsPerObject.values()].some(a=>a.length)&&(this.domEventsNeeded.add("scroll"),window.addEventListener("scroll",this.onScroll),window.addEventListener("resize",this.handleResize))}disconnect(){window.removeEventListener("wheel",this.onWheel),window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.handleResize),this.intersectionObserver.unobserve(this.eventContext.domElement),this.domEventsNeeded.clear(),[...this.wheelEventsPerObject.entries()].forEach(([t,i])=>{i.forEach(r=>r.disconnect()),t.removeEventListener("userEvent",this.onUserEvent)}),[...this.scrollEventsPerObject.entries()].forEach(([t,i])=>{i.forEach(r=>r.disconnect()),t.removeEventListener("userEvent",this.onUserEvent)})}},rRe=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.actions=hs(t,t.actions,r,n,s,i)}disconnect(){as(this.actions)}dispatch(){this.actions.Transition.forEach(e=>{e.play()}),this.actions.Animation.forEach(e=>{e.play()}),this.actions.SwitchCamera.forEach(e=>{e.play()}),this.actions.SceneTransition.forEach(e=>{e.dispatch()}),this.actions.Reset.forEach(e=>e.dispatch()),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.ClearLocalStorage.forEach(e=>e.dispatch()),this.actions.UserAPI.forEach(e=>e.dispatch()),this.actions.Create.forEach(e=>{e.dispatchFromStart()}),this.actions.Destroy.forEach(e=>{e.dispatchFromStart()})}dispatchAfter(e){this.actions.Audio.forEach(t=>{(t.interaction.data.triggerAfter??"any")===e&&(t.interaction instanceof pf?t.interaction.audioPlayer.play():t.interaction instanceof bz&&t.interaction.dispatch())}),this.actions.Video.forEach(t=>{let i=t.interaction.data.triggerAfter??"autoplay";i===e&&(t.interaction instanceof Lv?t.interaction.play(i==="autoplay"):t.interaction instanceof Ez&&t.interaction.dispatch())}),this.actions.Particles.forEach(t=>{(t.data.triggerAfter??"any")===e&&t.dispatchBasic()})}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>t.playFromCurrent()),this.actions.Animation.forEach(t=>t.playFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.playFromCurrent())),this.actions.SceneTransition.forEach(t=>t.dispatch()),this.actions.Reset.forEach(t=>t.dispatch()),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch()),this.actions.Create.forEach(t=>{t.dispatch()}),this.actions.Destroy.forEach(t=>{t.dispatch()}),this.actions.Audio.forEach(t=>{t.interaction instanceof pf?t.interaction.audioPlayer.play():t.interaction instanceof bz&&t.interaction.dispatch()}),this.actions.Video.forEach(t=>{t.interaction instanceof Lv?t.interaction.play():t.interaction instanceof Ez&&t.interaction.dispatch()}),this.actions.Particles.forEach(t=>{t.dispatchBasic()})}},nRe=class extends qa{constructor(e,t){super(e),this.eventManager=t,this.eventsPerObject=new Map,this.eventsAfterPerObject=new Map,this.onMouseDown=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,r])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),r.forEach(n=>{n.dispatchAfter("mouseDown")})})},this.onKeyDown=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,r])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),r.forEach(n=>{n.dispatchAfter("keyDown")})})},this.onAny=()=>{let{domElement:i,isExport:r}=this.eventContext,n=r?document:i;n.removeEventListener("pointerdown",this.onAny),n.removeEventListener("mousedown",this.onAny),document.removeEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach(([s,a])=>{s.dispatchEvent({type:"beginEvent",eventName:"Start"}),a.forEach(o=>{o.dispatchAfter("any")})})},this.onSceneTransitionAudioVideoPlay=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,r])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),r.forEach(n=>{n.actions.Audio.forEach(s=>{s.interaction instanceof pf&&s.interaction.audioPlayer.play()}),n.actions.Video.forEach(s=>{let a=s.interaction.data.triggerAfter??"autoplay";s.interaction instanceof Lv&&s.interaction.play(a==="autoplay")}),n.actions.Particles.forEach(s=>{s.dispatchBasic()})})})},this.onPlay=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,r])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),r.forEach(n=>{n.dispatchAfter("autoplay")})})},this.onUserEvent=({eventName:i,target:r,reverse:n})=>{var a,o;if(!i||!r)return;let s=Qw(i);s&&s==="Start"&&(r instanceof cs||r.dispatchEvent({type:"beginEvent",eventName:"Start"}),(a=this.eventsPerObject.get(r))==null||a.forEach(l=>{l.dispatchUserEvent(n)}),(o=this.eventsAfterPerObject.get(r))==null||o.forEach(l=>{l.dispatchUserEvent(n)}))}}connect(){let{sharedAssets:e,page:t}=this.eventContext,i=r=>{var n,s,a,o,l;if((n=r.data)!=null&&n.events.length)for(let{id:c,data:u}of r.data.events){if(u.disabled||u.type!=="Start")continue;let h=new rRe(c,u,r,t,e,this.eventManager);(h.actions.Transition.length||h.actions.Animation.length||h.actions.SwitchCamera.length||h.actions.Create.length||h.actions.Destroy.length||h.actions.SceneTransition.length||h.actions.Reset.length||h.actions.SetVariable.length||h.actions.DynamicVariablePlay.length||h.actions.ClearLocalStorage.length||h.actions.UserAPI.length)&&(this.eventsPerObject.has(r)?(s=this.eventsPerObject.get(r))==null||s.push(h):this.eventsPerObject.set(r,[h])),h.actions.Audio.length&&(this.eventsAfterPerObject.has(r)?(a=this.eventsAfterPerObject.get(r))==null||a.push(h):this.eventsAfterPerObject.set(r,[h])),h.actions.Video.length&&(this.hasVideoAction=!0,this.eventsAfterPerObject.has(r)?(o=this.eventsAfterPerObject.get(r))==null||o.push(h):this.eventsAfterPerObject.set(r,[h])),h.actions.Particles.length&&(this.eventsAfterPerObject.has(r)?(l=this.eventsAfterPerObject.get(r))==null||l.push(h):this.eventsAfterPerObject.set(r,[h]))}};if(t.traverseEntity(r=>{var n;(r instanceof js||r instanceof es)&&((n=r.frame)==null||n.traverse(s=>{i(s)})),i(r)}),[...this.eventsAfterPerObject.values()].some(r=>r.length)){if(this.eventManager.activateCount===0){let{domElement:r,isExport:n}=this.eventContext,s=n?document:r;s.addEventListener("pointerdown",this.onMouseDown,{once:!0}),s.addEventListener("mousedown",this.onMouseDown,{once:!0}),document.addEventListener("keydown",this.onKeyDown,{once:!0}),s.addEventListener("pointerdown",this.onAny),s.addEventListener("mousedown",this.onAny),document.addEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach(([a,o])=>{a.addEventListener("userEvent",this.onUserEvent)})}else this.onSceneTransitionAudioVideoPlay();this.onPlay()}[...this.eventsPerObject.entries()].forEach(([r,n])=>{r.dispatchEvent({type:"beginEvent",eventName:"Start"}),n.forEach(s=>s.dispatch()),r.addEventListener("userEvent",this.onUserEvent)})}disconnect(){if([...this.eventsAfterPerObject.values()].some(e=>e.length)){let{domElement:e,isExport:t}=this.eventContext,i=t?document:e;i.removeEventListener("pointerdown",this.onMouseDown),i.removeEventListener("mousedown",this.onMouseDown),document.removeEventListener("keydown",this.onKeyDown),i.removeEventListener("pointerdown",this.onAny),i.removeEventListener("mousedown",this.onAny),document.removeEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach(([r,n])=>{r.removeEventListener("userEvent",this.onUserEvent),n.forEach(s=>s.disconnect())})}[...this.eventsPerObject.entries()].forEach(([e,t])=>{e.removeEventListener("userEvent",this.onUserEvent),t.forEach(i=>i.disconnect())}),this.eventsPerObject.clear(),this.eventsAfterPerObject.clear()}},sRe=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.initialDisabled=!1,this.actions=hs(t,t.actions,r,n,s,i),this.target=t.target}disconnect(){as(this.actions)}dispatch(e){this.initialDisabled||(this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),this.object.dispatchEvent({type:"beginEvent",eventName:"Collision"}),this.actions.Transition.forEach(t=>{t.data.runMode==="Toggle"?t.toggle():t.play()}),this.actions.Animation.forEach(t=>{t.data.runMode==="Toggle"?t.toggle():t.play()}),this.actions.Reset.forEach(t=>{t.dispatch()}),this.actions.Link.forEach(t=>{t.dispatch()}),this.actions.Reset.forEach(t=>{t.dispatch()}),this.actions.Create.forEach(t=>{t.dispatch()}),this.actions.Destroy.forEach(t=>{t.dispatch(e??!1)}),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.Audio.forEach(t=>{t.dispatchBasic()}),this.actions.Particles.forEach(t=>{t.dispatchBasic()}),this.actions.Video.forEach(t=>{t.dispatchBasic()}),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch()))}},aRe=class extends qa{constructor(e,t,i,r,n){super(e),this.sharedVariables=t,this.eventManager=i,this.needsMouse=r,this.needsRaycast=n,this.dynamicVars=[],this.variablesToWatch=[],this.prevMouseProperty=null,this.prevRaycastProperty=null,this.pauseTime=0,this.isOutOfFocus=!1,this.events=[],this.onFrame=s=>{let a=this.eventContext.sharedAssets;if(this.rafId=window.requestAnimationFrame(this.onFrame),this.isOutOfFocus)return;let o=new Date,l=[],c=[];for(let d=0;d<this.propertiesToWatch.length;d++){let{objectId:p,property:f,prevValue:v}=this.propertiesToWatch[d],g=this.eventContext.scene.find(p),m=oO.propertyPaths[f];if(m[0]==="width"||m[0]==="height"||m[0]==="depth")g=g.geometry.userData.parameters[m[0]];else for(let x=0;x<m.length;x++)g=g[m[x]];v===null?this.propertiesToWatch[d].prevValue=g instanceof B?g.clone():g:(g instanceof B?!g.equals(v):v!==g)&&(c.push({objId:p,property:f}),g instanceof B?this.propertiesToWatch[d].prevValue.copy(g):this.propertiesToWatch[d].prevValue=g)}for(let d=0;d<this.variablesToWatch.length;d++){let{id:p,prevValue:f}=this.variablesToWatch[d],v=a.getVariable(p);v!==f&&(l.push(p),this.variablesToWatch[d].prevValue=v)}for(let d=0;d<this.dynamicVars.length;d++){let{id:p,expectedTime:f,last:v,data:g,timerSeconds:m,startValue:x}=this.dynamicVars[d],w=1e3;if((g.dynamicVariableType==="timer"||g.dynamicVariableType==="stopwatch")&&g.format==="number3decimal"?w=1:g.dynamicVariableType==="counter"?w=g.updateInterval:g.dynamicVariableType==="random"&&(w=g.isStatic?1/0:g.updateInterval),f===-1){this.dynamicVars[d].last=s,this.dynamicVars[d].expectedTime=s+w;continue}if(!((a.getDynamicVariablePlayState(p)==="Stopped"||a.getDynamicVariablePlayState(p)==="Restarted")&&(this.dynamicVars[d].last=s,this.dynamicVars[d].expectedTime=s+w,g.dynamicVariableType==="counter"&&a.getVariable(p)!==x&&(a.updateVariable(p,x),this.eventManager.requestRender()),(g.dynamicVariableType==="timer"||g.dynamicVariableType==="stopwatch")&&this.dynamicVars[d].timerSeconds!==x&&(this.dynamicVars[d].timerSeconds=x,a.updateVariable(p,Fo.getFormattedTimerTime(x,g)),this.eventManager.requestRender()),a.getDynamicVariablePlayState(p)==="Restarted"&&a.setDynamicVariablePlayState(p,"Playing"),a.getDynamicVariablePlayState(p)==="Stopped"))){if(a.getDynamicVariablePlayState(p)==="Paused"){this.dynamicVars[d].deltaToExpectedTime===void 0&&(this.dynamicVars[d].deltaToExpectedTime=Math.max(this.dynamicVars[d].expectedTime-s,0)),this.dynamicVars[d].last=s-(w-this.dynamicVars[d].deltaToExpectedTime),this.dynamicVars[d].expectedTime=s+this.dynamicVars[d].deltaToExpectedTime;continue}else this.dynamicVars[d].deltaToExpectedTime=void 0;if(s>=f)if(this.dynamicVars[d].last=s,this.dynamicVars[d].expectedTime+=w,g.dynamicVariableType==="random"){let _=g.min+Math.random()*(g.max-g.min),M=g.decimals;_=Math.round(_*Math.pow(10,M))/Math.pow(10,M),a.updateVariable(p,_),l.push(p),this.eventManager.requestRender()}else if(g.dynamicVariableType==="counter"){let _=a.getVariable(p),M=a.getDynamicVariableToggleIsForward(p)??!0,S=a.getVariable(p)+g.increment*(M?1:-1);g.hasEnd&&(S=g.increment>0?Et.clamp(S,x,g.endValue):Et.clamp(S,g.endValue,x),S===x&&a.setDynamicVariableToggleIsForward(p,void 0),g.repeat?S===g.endValue&&(S=x):(S===x||S===g.endValue)&&a.setDynamicVariablePlayState(p,"Paused")),S!==_&&(l.push(p),a.updateVariable(p,S),this.eventManager.requestRender())}else if(g.dynamicVariableType==="time"){let _=a.getVariable(p),M=Z6(o,g);if(typeof _=="object"&&"textValue"in _&&typeof M=="object"&&"textValue"in M){if(Array.isArray(_.textValue)&&Array.isArray(M.textValue)){if(_.textValue.every((S,A)=>S===M.textValue[A]))continue}else if(_.textValue===M.textValue)continue}else if(_===M)continue;a.updateVariable(p,M),l.push(p),this.eventManager.requestRender()}else{let _=Ss.isTextValue(g.endValue)?OW(g.endValue.textValue):g.endValue,M=a.getDynamicVariableToggleIsForward(p)??!0,S=m+(s-v)/1e3*(g.dynamicVariableType==="timer"?-1:1)*(M?1:-1);S=Math.max(S,0),g.hasEnd&&(S=g.dynamicVariableType==="stopwatch"?Et.clamp(S,x,_):Et.clamp(S,_,x),S===x&&a.setDynamicVariableToggleIsForward(p,void 0),g.repeat?Math.abs(S-_)<(g.format==="number3decimal"?1e-4:.1)&&(S=x):(Math.abs(S-x)<(g.format==="number3decimal"?1e-4:.1)||Math.abs(S-_)<(g.format==="number3decimal"?1e-4:.1))&&a.setDynamicVariablePlayState(p,"Paused")),S!==m&&(l.push(p),this.dynamicVars[d].timerSeconds=S,a.updateVariable(p,Fo.getFormattedTimerTime(S,g)),this.eventManager.requestRender())}}}let u=!1;a.mouseProperty!==this.prevMouseProperty&&(this.prevMouseProperty=a.mouseProperty,u=!0);let h=!1;a.raycastProperty!==this.prevRaycastProperty&&(this.prevRaycastProperty=a.raycastProperty,h=!0),this.events.forEach(d=>{(l.includes(d.data.variableId)||c.find(p=>p.objId===d.data.objectId&&p.property===d.data.property)||d.data.variableId==="mouseProperty"&&u||d.data.variableId==="raycastProperty"&&h)&&(d.dispatch(),this.eventManager.requestRender())})},this.onBlur=()=>{this.pause()},this.onFocus=()=>{this.resume()}}pause(){this.isOutOfFocus||(this.isOutOfFocus=!0,this.pauseTime=Date.now())}resume(){if(!this.isOutOfFocus)return;this.isOutOfFocus=!1;let e=Date.now()-this.pauseTime;for(let t=0;t<this.dynamicVars.length;t++)this.dynamicVars[t].last+=e,this.dynamicVars[t].expectedTime+=e}connect(){this.eventContext.page.traverseEntity(t=>{var i;(i=t.data)==null||i.events.filter(r=>r.data.type==="VariableChange"&&!r.data.disabled).forEach(r=>{this.events.push(new oRe(r.id,r.data,t,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))})}),this.propertiesToWatch=this.events.filter(t=>t.data.variableId==="objectProperty"&&t.data.objectId!==null).map(t=>({objectId:t.data.objectId,property:t.data.property,prevValue:null}));let e=this.eventContext.sharedAssets;this.sharedVariables.forEach(({id:t,data:i})=>{if(!("dynamicVariableType"in i)){this.events.find(n=>n.data.variableId===t)&&this.variablesToWatch.push({id:t,prevValue:e.getVariable(t)});return}let r;if(i.dynamicVariableType==="timer"||i.dynamicVariableType==="stopwatch"){let n;if(Ss.isTextValue(i.value)&&Array.isArray(i.value.textValue)){let s=i.value.textValue;s.length===3?n=s[2]+s[1]*60+s[0]*3600:n=s[1]+s[0]*60}else n=i.value;r=n,this.dynamicVars.push({id:t,last:-1,expectedTime:-1,data:i,timerSeconds:n,startValue:r})}else i.dynamicVariableType==="time"&&e.updateVariable(t,Z6(new Date,i)),i.dynamicVariableType==="counter"&&(r=Ss.isTextValue(i.value)?OW(i.value.textValue):i.value),this.dynamicVars.push({id:t,last:-1,expectedTime:-1,data:i,startValue:r})}),this.rafId=window.requestAnimationFrame(this.onFrame),window.addEventListener("blur",this.onBlur),window.addEventListener("focus",this.onFocus)}disconnect(){window.removeEventListener("blur",this.onBlur),window.removeEventListener("focus",this.onFocus),this.rafId&&(window.cancelAnimationFrame(this.rafId),this.rafId=void 0),this.events.forEach(e=>e.dispose())}},oRe=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.actions=hs(t,t.actions,r,n,s,i)}dispatch(){let e=this.actions;e.Audio.forEach(t=>t.dispatchConditional()),e.Particles.forEach(t=>t.dispatchConditional()),e.Video.forEach(t=>t.dispatchConditional()),e.Create.forEach(t=>t.dispatch()),e.Destroy.forEach(t=>t.dispatch()),e.Reset.forEach(t=>t.dispatch()),e.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this),t.init()}),e.Transition.forEach(t=>t.play()),e.Animation.forEach(t=>t.play()),e.SwitchCamera.forEach(t=>t.play()),e.SceneTransition.forEach(t=>t.dispatch()),e.SetVariable.forEach(t=>t.checkConditions()),e.SetVariable.forEach(t=>t.dispatch()),e.DynamicVariablePlay.forEach(t=>t.dispatch()),e.ClearLocalStorage.forEach(t=>t.dispatch()),e.UserAPI.forEach(t=>t.dispatch())}dispose(){as(this.actions)}};function OW(e){return e.length===3?e[2]+e[1]*60+e[0]*3600:e[1]+e[0]*60}var lRe="https://unpkg.com/@splinetool/runtime@1.9.25/build/",cRe="https://unpkg.com/@splinetool/navmesh-wasm@1.9.25/build/",uRe=`
(async function() {
	const [wasmImport, wasmBinary] = await Promise.all([
		import('${lRe}' + 'navmesh.js'),
		fetch('${cRe}' + 'navmesh.wasm').then((res) => res.arrayBuffer()),
	]);
	const wasmModule = wasmImport.default;
	self.module = await wasmModule({ wasmBinary });
	postMessage('ready');
})();
`,hRe=`
(async function() {
	const [wasmImport, wasmBinary] = await Promise.all([
		import(self.location.origin + '/_libraries/navmesh.js'),
		fetch(self.location.origin + '/_libraries/navmesh.wasm').then((res) => res.arrayBuffer()),
	]);
	const wasmModule = wasmImport.default;
	self.module = await wasmModule({ wasmBinary });
	postMessage('ready');
})();
`,dRe=`

onmessage = function(messageEvent) {
	const meshData = messageEvent.data;
	const positions = meshData[0];
	const offset = meshData[1];
	const indices = meshData[2];
	const indicesLength = meshData[3];
	const parameters = meshData[4];

	const module = self.module;
	const rc = new module.rcConfig();
	rc.cs = parameters.cs;
	rc.ch = parameters.ch;
	rc.borderSize = parameters.borderSize ? parameters.borderSize : 0;
	rc.tileSize = parameters.tileSize ? parameters.tileSize : 0;
	rc.walkableSlopeAngle = parameters.walkableSlopeAngle;
	rc.walkableHeight = parameters.walkableHeight;
	rc.walkableClimb = parameters.walkableClimb;
	rc.walkableRadius = parameters.walkableRadius;
	rc.maxEdgeLen = parameters.maxEdgeLen;
	rc.maxSimplificationError = parameters.maxSimplificationError;
	rc.minRegionArea = parameters.minRegionArea;
	rc.mergeRegionArea = parameters.mergeRegionArea;
	rc.maxVertsPerPoly = parameters.maxVertsPerPoly;
	rc.detailSampleDist = parameters.detailSampleDist;
	rc.detailSampleMaxError = parameters.detailSampleMaxError;

	if (!self.navMesh) {
		self.navMesh = new module.NavMesh();
	}
	self.navMesh.build(positions, offset, indices, indicesLength, rc);

	const navmeshData = navMesh.getNavmeshData();
	const arrView = new Uint8Array(module.HEAPU8.buffer, navmeshData.dataPointer, navmeshData.size);
	const ret = new Uint8Array(navmeshData.size);
	ret.set(arrView);
	navMesh.freeNavmeshData(navmeshData);

	postMessage(ret);
}
`,pRe=.001,fRe={cs:6,ch:2,walkableSlopeAngle:90,walkableHeight:20,walkableClimb:5,walkableRadius:0,maxEdgeLen:12,maxSimplificationError:1.3,minRegionArea:8,mergeRegionArea:20,maxVertsPerPoly:6,detailSampleDist:6,detailSampleMaxError:1},fJ,Ai,fs;zwe.then(e=>{fJ=e,Ai=new e.Vec3,fs=new e.Vec3});var mRe=new B,gRe=class{constructor(e=!1,t=!1){this.usePhysics=e,this.isExport=t,this.onPointerDown=i=>{if(Yt.length!==1)return;let{raycaster:r,page:n}=this.eventContext;this.eventContext.updateRaycaster(i);let s=n.raycastWithClones(r);if(s.length!==0){if(this.gameControl){let a=mRe.copy(this.gameControl.colliderWorldPosition);a.y-=this.gameControl.colliderHeight/2,this.gameControl.path=this.computePath(a,s[0].point)}this.eventContext.requestRender()}},this.traverseWithPhysics=(i,r)=>n=>{var d,p,f,v,g,m,x;let s;if(n instanceof Ll)if(n.objectForSample){if(n.objectForSample.dataPatched.physics.fusedBody)return;s=n.object}else return n.object.dataPatched.physics.fusedBody===!0&&n.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(n instanceof Xs)s=n.object;else if(s=n,((d=s.dataPatched.cloner)==null?void 0:d.disabled)===!1&&((p=s.dataPatched.cloner)==null?void 0:p.hideBase)&&((f=s.dataPatched.physics)==null?void 0:f.fusedBody)!==!0)return!0;if(r&&!s.userData.navmesh)return;let a=s.dataPatched;if(!a.visible&&((v=a.physics)==null?void 0:v.enabled)!==!0)return!0;n.updateMatrixWorldSVD();let o=gC(a),l=s.userData.hasDestroy,c=s.userData.hasDrag,u=!1,h=!1;for(let w of a.events)w.data.disabled!==!0&&(w.data.type==="GameControl"?u=!0:w.data.type==="Follow"&&(h=!0));if(u||o||h||l||c)return!0;if(this.usePhysics&&((g=a.physics)==null?void 0:g.rigidBody)==="dynamic"){if(this.usePhysics&&((m=a.physics)!=null&&m.fusedBody))return!0}else if("geometry"in n&&n.geometry&&i.push(Nu(n.geometry,n.matrixWorld)),this.usePhysics&&((x=a.physics)==null?void 0:x.fusedBody))return n.traverseObject((w,_)=>{var A,T;if(_===0)return;let M;if(w instanceof Ll)if(w.objectForSample){if(w.objectForSample.dataPatched.physics.fusedBody)return;M=w.object}else return w.object.dataPatched.physics.fusedBody===!0&&w.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(w instanceof Xs)M=w.object;else if(M=w,(A=w.dataPatched.cloner)==null?void 0:A.hideBase)return!0;let S=M.dataPatched;if(!S.visible&&((T=S.physics)==null?void 0:T.enabled)!==!0)return!0;"geometry"in w&&w.geometry&&i.push(Nu(w.geometry,w.matrixWorld))}),!0},this.traverseNoPhysics=(i,r)=>n=>{let s;if(n instanceof Ll)return;n instanceof Xs?s=n.object:s=n;let a=s.dataPatched;if(a.physics.enabled==="visibility"?!a.visible:!a.physics.enabled)return!0;if(r&&!s.userData.navmesh)return;let o=n.geometry,l=s.userData.hasDestroy===!0,c=s.userData.hasDrag===!0;if(gC(a)||l||c||s.dataPatched.events.some(u=>u.data.disabled!==!0&&u.data.type==="GameControl"))return!0;o&&i.push(Nu(o,n.matrixWorld))},this.navmeshWasm=fJ,this.navMesh=new this.navmeshWasm.NavMesh,this._workerURL=URL.createObjectURL(new Blob([(t?uRe:hRe)+dRe])),this._worker=new Worker(this._workerURL)}init(e,t,i){this.gameControl=t,this.eventContext=i,this.setDefaultQueryExtent(new B().setScalar(e.ch*e.walkableRadius*1.2)),this._worker.onmessage=()=>{this.createNavMesh(i.page,e,r=>{this.buildFromNavmeshData(r.data)})},this.eventContext.renderer.domElement.addEventListener("pointerdown",this.onPointerDown)}createNavMesh(e,t,i){t.objects.forEach(l=>{var u;let c=e.scene.find(l);c.traverseEntity(h=>{h.userData.navmesh=!0}),(u=c.cloner)==null||u.traverseObject(h=>{h.userData.navmesh=!0})});let r=[],n=(this.usePhysics?this.traverseWithPhysics:this.traverseNoPhysics)(r,t.zones==="custom");if(e.traverseChildren(n),t.objects.forEach(l=>{var u;let c=e.scene.find(l);c.traverseEntity(h=>{h.userData.navmesh=void 0}),(u=c.cloner)==null||u.traverseObject(h=>{h.userData.navmesh=void 0})}),r.length===0)return!1;let s=df(r),{positions:a,triIndices:o}=FT(s.getAttribute("position"),s.getIndex());return this._worker.postMessage([a,a.length/3,o,o.length,{...fRe,...t}]),this._worker.onmessage=i,!0}createDebugNavGeometry(){let e,t,i=this.navMesh.getDebugNavMesh(),r=i.getTriangleCount(),n=new Uint32Array(r*3),s=new Float32Array(r*3*3);for(e=0;e<r*3;e++)n[e]=e;for(e=0;e<r;e++)for(t=0;t<3;t++){let o=i.getTriangle(e).getPoint(t);s[e*9+t*3+0]=o.x,s[e*9+t*3+1]=o.y,s[e*9+t*3+2]=o.z}let a=new Bt;return a.setIndex(new $t(n,1)),a.setAttribute("position",new $t(s,3)),a}getClosestPoint(e){return Ai.x=e.x,Ai.y=e.y,Ai.z=e.z,this.navMesh.getClosestPoint(Ai)}getClosestPointToRef(e,t){Ai.x=e.x,Ai.y=e.y,Ai.z=e.z;let i=this.navMesh.getClosestPoint(Ai);t.set(i.x,i.y,i.z)}getRandomPointAround(e,t){return Ai.x=e.x,Ai.y=e.y,Ai.z=e.z,this.navMesh.getRandomPointAround(Ai,t)}getRandomPointAroundToRef(e,t,i){Ai.x=e.x,Ai.y=e.y,Ai.z=e.z;let r=this.navMesh.getRandomPointAround(Ai,t);i.set(r.x,r.y,r.z)}moveAlong(e,t){return Ai.x=e.x,Ai.y=e.y,Ai.z=e.z,fs.x=t.x,fs.y=t.y,fs.z=t.z,this.navMesh.moveAlong(Ai,fs)}moveAlongToRef(e,t,i){return Ai.x=e.x,Ai.y=e.y,Ai.z=e.z,fs.x=t.x,fs.y=t.y,fs.z=t.z,this.navMesh.moveAlong(Ai,fs)}computePath(e,t){let i=this.getClosestPoint(t);if(fs.x=i.x,fs.y=i.y,fs.z=i.z,Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)+Math.pow(t.z-i.z,2))>this.getDefaultQueryExtent().y)return[];this.getClosestPoint(e);let r=this.navMesh.computePath(Ai,fs),n=r.getPointCount(),s=[];for(let a=0;a<n;a++){let o=r.getPoint(a);s.push(new B(o.x,o.y,o.z))}return s}createCrowd(e,t){return new vRe(this,e,t)}setDefaultQueryExtent(e){Ai.x=e.x,Ai.y=e.y,Ai.z=e.z,this.navMesh.setDefaultQueryExtent(Ai)}getDefaultQueryExtent(){return this.navMesh.getDefaultQueryExtent()}buildFromNavmeshData(e){let t=e.length*e.BYTES_PER_ELEMENT,i=this.navmeshWasm._malloc(t),r=new Uint8Array(this.navmeshWasm.HEAPU8.buffer,i,t);r.set(e);let n=new this.navmeshWasm.NavmeshData;n.dataPointer=r.byteOffset,n.size=e.length,this.navMesh.buildFromNavmeshData(n),this.navmeshWasm._free(r.byteOffset)}getNavmeshData(){let e=this.navMesh.getNavmeshData(),t=new Uint8Array(this.navmeshWasm.HEAPU8.buffer,e.dataPointer,e.size),i=new Uint8Array(e.size);return i.set(t),this.navMesh.freeNavmeshData(e),i}getDefaultQueryExtentToRef(e){let t=this.navMesh.getDefaultQueryExtent();e.set(t.x,t.y,t.z)}dispose(){var e;this.navMesh.destroy(),this._worker.terminate(),URL.revokeObjectURL(this._workerURL),(e=this.eventContext)==null||e.renderer.domElement.removeEventListener("pointerdown",this.onPointerDown)}addCylinderObstacle(e,t,i){return Ai.x=e.x,Ai.y=e.y,Ai.z=e.z,this.navMesh.addCylinderObstacle(Ai,t,i)}addBoxObstacle(e,t,i){return Ai.x=e.x,Ai.y=e.y,Ai.z=e.z,fs.x=t.x,fs.y=t.y,fs.z=t.z,this.navMesh.addBoxObstacle(Ai,fs,i)}removeObstacle(e){this.navMesh.removeObstacle(e)}isSupported(){return this.navmeshWasm!==void 0}},vRe=class{constructor(e,t,i){this.navmeshWasmWrapper=e,this.transforms=[],this.agents=new Array,this.reachRadii=new Array,this._agentDestinationArmed=new Array,this._agentDestination=new Array,this.crowd=new this.navmeshWasmWrapper.navmeshWasm.Crowd(t,i,this.navmeshWasmWrapper.navMesh.getNavMesh())}onReachTarget(e,t){}addAgent(e,t,i){let r=new this.navmeshWasmWrapper.navmeshWasm.dtCrowdAgentParams;r.radius=t.radius,r.height=t.height,r.maxAcceleration=t.maxAcceleration,r.maxSpeed=t.maxSpeed,r.collisionQueryRange=t.collisionQueryRange,r.pathOptimizationRange=t.pathOptimizationRange,r.separationWeight=t.separationWeight,r.updateFlags=7,r.obstacleAvoidanceType=0,r.queryFilterType=0,r.userData=0;let n=this.crowd.addAgent(new this.navmeshWasmWrapper.navmeshWasm.Vec3(e.x,e.y,e.z),r);return this.transforms.push(i),this.agents.push(n),this.reachRadii.push(t.reachRadius?t.reachRadius:t.radius),this._agentDestinationArmed.push(!1),this._agentDestination.push(new B(0,0,0)),n}getAgentPosition(e){return this.crowd.getAgentPosition(e)}getAgentPositionToRef(e,t){let i=this.crowd.getAgentPosition(e);t.set(i.x,i.y,i.z)}getAgentVelocity(e){return this.crowd.getAgentVelocity(e)}getAgentVelocityToRef(e,t){let i=this.crowd.getAgentVelocity(e);t.set(i.x,i.y,i.z)}getAgentNextTargetPath(e){return this.crowd.getAgentNextTargetPath(e)}getAgentNextTargetPathToRef(e,t){let i=this.crowd.getAgentNextTargetPath(e);t.set(i.x,i.y,i.z)}getAgentState(e){return this.crowd.getAgentState(e)}overOffmeshConnection(e){return this.crowd.overOffmeshConnection(e)}agentGoto(e,t){this.crowd.agentGoto(e,new this.navmeshWasmWrapper.navmeshWasm.Vec3(t.x,t.y,t.z));let i=this.agents.indexOf(e);i>-1&&(this._agentDestinationArmed[i]=!0,this._agentDestination[i].set(t.x,t.y,t.z))}agentTeleport(e,t){this.crowd.agentTeleport(e,new this.navmeshWasmWrapper.navmeshWasm.Vec3(t.x,t.y,t.z))}updateAgentParameters(e,t){let i=this.crowd.getAgentParameters(e);t.radius!==void 0&&(i.radius=t.radius),t.height!==void 0&&(i.height=t.height),t.maxAcceleration!==void 0&&(i.maxAcceleration=t.maxAcceleration),t.maxSpeed!==void 0&&(i.maxSpeed=t.maxSpeed),t.collisionQueryRange!==void 0&&(i.collisionQueryRange=t.collisionQueryRange),t.pathOptimizationRange!==void 0&&(i.pathOptimizationRange=t.pathOptimizationRange),t.separationWeight!==void 0&&(i.separationWeight=t.separationWeight),this.crowd.setAgentParameters(e,i)}removeAgent(e){this.crowd.removeAgent(e);let t=this.agents.indexOf(e);t>-1&&(this.agents.splice(t,1),this.transforms.splice(t,1),this.reachRadii.splice(t,1),this._agentDestinationArmed.splice(t,1),this._agentDestination.splice(t,1))}getAgents(){return this.agents}update(e){if(this.navmeshWasmWrapper.navMesh.update(),e<=pRe)return;let t=1/60,i=10;{let r=Math.floor(e/t);r>i&&(r=i),r<1&&(r=1);let n=e/r;for(let s=0;s<r;s++)this.crowd.update(n)}for(let r=0;r<this.agents.length;r++){let n=this.agents[r],s=this.getAgentPosition(n);if(this.transforms[r].copy(s),this._agentDestinationArmed[r]){let a=s.x-this._agentDestination[r].x,o=s.z-this._agentDestination[r].z,l=this.reachRadii[r],c=this._agentDestination[r].y-this.reachRadii[r],u=this._agentDestination[r].y+this.reachRadii[r],h=a*a+o*o;s.y>c&&s.y<u&&h<l*l&&(this.onReachTarget(n,this._agentDestination[r]),this._agentDestinationArmed[r]=!1)}}}setDefaultQueryExtent(e){let t=new this.navmeshWasmWrapper.navmeshWasm.Vec3(e.x,e.y,e.z);this.crowd.setDefaultQueryExtent(t)}getDefaultQueryExtent(){return this.crowd.getDefaultQueryExtent()}getDefaultQueryExtentToRef(e){let t=this.crowd.getDefaultQueryExtent();e.set(t.x,t.y,t.z)}getCorners(e){let t,i=this.crowd.getCorners(e),r=i.getPointCount(),n=[];for(t=0;t<r;t++){let s=i.getPoint(t);n.push(new B(s.x,s.y,s.z))}return n}dispose(){this.crowd.destroy()}};function yRe(e){let t=!1;return e.scene.objects.forEach(i=>{i.data.type==="Page"&&!t&&i.data.publish.gameControlObject&&j1.traverseModuleInstances(e,i.id,(r,n,s)=>{for(let a of s)a.data.type==="GameControl"&&a.data.navmesh.enabled&&(t=!0)})}),t}var xRe={type:"change"},zW={type:"changeZoom"},wRe={type:"changePan"},Ep={type:"start"},Ap={type:"end",changed:!0},bRe={type:"end",changed:!1},yR=new ei,NW=new ve,_Re=2*Math.PI,SRe=1e-8,MRe=.01,xR=new B,GS=new ve,wR=new B,jS=new ei,BW=new ht,ERe={type:"requestRender"},mJ=class extends Cs{constructor(e,t,i={isPlayMode:!1,isExport:!1}){super(),this.object=e,this.domElement=t,this.options=i,this.enabled=!0,this.useKeyEvents=!0,this.enableDamping=!1,this.enableZoom=!0,this.enableRotate=!0,this.enablePan=!0,this.autoRotate=!1,this.rotationLimitsMode=0,this.panLimitsMode=0,this.rotationSoftLimit=2,this.panSoftLimit=2,this.hoverRotatePanMode=0,this.zoomLimitsEnabled=!1,this.mouseButtons=[0,5],this.mouseButtonsPlay=[3,4,5],this.touches=[null,Do.DOLLY_ROTATE,Do.PAN],this.offset=new B,this.eye=new B,this.lastPosition=new B,this.lastQuaternion=new ei,this.current=new ve,this.overShoot=new ve,this.overRatio=new ve,this.spherical=new mH,this.sphericalDelta=new mH,this.panOffset=new B,this.panLeftV=new B,this.panUpV=new B,this.panV=new B,this.rotateStart=new ve,this.rotateEnd=new ve,this.rotateDelta=new ve,this.panStart=new ve,this.panEnd=new ve,this.panDelta=new ve,this.dollyStart=new ve,this.dollyEnd=new ve,this.dollyDelta=new ve,this.rotationRangeFactor=new ve,this.panRangeFactor=new ve,this.state=-1,this.zoomChanged=!1,this.isPointerDown=!1,this.isThetaFlipped=!1,this.prevScale=0,this.scale=1,this.gesture=!1,this.timer=-1,this.timerHover=-1,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPhi=0,this.maxPhi=Math.PI,this.minTheta=-1/0,this.maxTheta=1/0,this.minH=0,this.maxH=Math.PI,this.minV=-1/0,this.maxV=1/0,this.autoRotateClockwise=!0,this.isPanOverShoot=!1,this.isRotateOverShoot=!1,this.resetHoverEffectOnPointerLeave=!1,this.hasChange=!1,this.useWindowEvents=!1,this.isTouchZoom=!0,this.autoRotateSpeed=2,this.dampingFactor=.125,this.zoomSpeed=2,this.rotateSpeed=1,this.panSpeed=1,this.hoverRotatePanStrength=.1,this.hoverRotateDamping=this.dampingFactor,this.thetaIsFree=!1,this.phiIsFree=!1,this.needsUpdate=!0,this.onCameraChange=r=>{this.object.removeEventListener("beginState",this.onBeginState),this.object.removeEventListener("completeState",this.onCompleteState),this.object.removeEventListener("cameraChange",this.onCameraChange),this.object=r.camera,this.object.addEventListener("beginState",this.onBeginState),this.object.addEventListener("completeState",this.onCompleteState),this.object.addEventListener("cameraChange",this.onCameraChange)},this.update=()=>{this.object.updateWorldMatrix(!0,!1),this.object.matrixWorld.decompose(wR,jS,xR),this.offset.copy(wR).sub(this.target),this.spherical.setFromVector3(this.offset),this.object.isUpVectorFlipped&&(this.spherical.phi*=-1,this.spherical.theta-=Math.PI),this.autoRotate&&this.state===-1&&this.rotateLeft((this.autoRotateClockwise===!0?1:-1)*this.getAutoRotationAngle()),this.rotationLimitsMode!==0&&this.applyLimits(this.sphericalDelta,this.rotationLimitsMode,this.rotationSoftLimit,this.maxTheta,this.minTheta,this.maxPhi,this.minPhi,this.rotationRangeFactor),this.rotationLimitsMode!==2&&(this.spherical.phi+=this.sphericalDelta.phi),(this.rotationLimitsMode!==1||this.autoRotate===!0)&&(this.spherical.theta+=this.sphericalDelta.theta),this.spherical.radius*=this.scale,this.zoomLimitsEnabled&&this.object.isPerspectiveCamera&&(this.spherical.radius=Math.max(this.minDistance,Math.min(this.maxDistance,this.spherical.radius))),this.panLimitsMode!==0&&(this.target.applyQuaternion(yR.copy(jS).invert()),this.panOffset.applyQuaternion(yR),this.applyLimits(this.panOffset,this.panLimitsMode,this.panSoftLimit,this.maxH,this.minH,this.maxV,this.minV,this.panRangeFactor),this.target.applyQuaternion(jS),this.panOffset.applyQuaternion(jS)),this.panLimitsMode===2&&(this.panOffset.y=0),this.panLimitsMode===1&&(this.panOffset.x=0),this.state===-1&&!this.gesture?(this.panOffset.multiplyScalar(1-this.dampingFactor),this.target.add(this.panOffset)):(this.target.add(this.panOffset),this.panOffset.set(0,0,0)),this.offset.setFromSpherical(this.spherical),wR.copy(this.target).add(this.offset),this.object.position.copy(this.target).add(this.offset),this.object.parent&&(BW.copy(this.object.parent.matrixWorld).invert(),this.object.position.applyMatrix4(BW));let r=this.spherical.phi%_Re;if(this.eye.copy(this.offset).normalize(),this.object.up.copy(ir.DEFAULT_UP).applyAxisAngle(this.eye,this.object.angleOffsetFromUp),r>0&&r>Math.PI||r<0&&r>-Math.PI?(this.object.up.negate(),this.object.lookAt(this.target),this.object.isUpVectorFlipped=!0):(this.object.lookAt(this.target),this.object.isUpVectorFlipped=!1),this.state===-1||this.enableDamping===!0){let n=this.hoverRotatePanMode===1?this.hoverRotateDamping:this.dampingFactor;this.sphericalDelta.theta*=1-n,this.sphericalDelta.phi*=1-n}else this.sphericalDelta.set(0,0,0);return this.scale=1,this.zoomChanged||this.lastPosition.distanceToSquared(this.object.position)>MRe||8*(1-this.lastQuaternion.dot(this.object.quaternion))>SRe?(this.dispatchEvent(xRe),this.object.dispatchEvent(ERe),this.lastPosition.copy(this.object.position),this.lastQuaternion.copy(this.object.quaternion),this.zoomChanged=!1,!0):(this.isPanOverShoot=!1,this.isRotateOverShoot=!1,this.object.wasMovedBySwitchCameraAction=!1,this.sphericalDelta.set(0,0,0),this.panOffset.set(0,0,0),!1)},this.onPointerDown=r=>{this.enabled!==!1&&(r.pointerType==="touch"||r.pointerType==="pen"&&uo?this.onPointerDownTouch(r):this.onPointerDownMouse(r),this.state!==-1&&(this.isPointerDown=!0,this.dispatchEvent(Ep),this.domElement.addEventListener("pointermove",this.onPointerMove),this.domElement.addEventListener("pointerup",this.onPointerUp),r.stopPropagation(),r.pointerType==="touch"||r.pointerType==="pen"&&uo||this.domElement.setPointerCapture(r.pointerId)))},this.onPointerLeave=r=>{this.resetHoverEffectOnPointerLeave&&!this.useWindowEvents?(this.hoverRotatePanMode===1?(this.sphericalDelta.theta=-this.spherical.theta,this.sphericalDelta.phi=-this.spherical.phi,xR.subVectors(this.position0,this.target0),this.spherical.setFromVector3(xR),this.sphericalDelta.theta+=this.spherical.theta,this.sphericalDelta.phi+=this.spherical.phi,this.sphericalDelta.theta/=8,this.sphericalDelta.phi/=8):this.hoverRotatePanMode===2&&this.panOffset.subVectors(this.target0,this.target).divideScalar(8),this.update()):this.pointerLeaveEvent=r},this.onPointerEnter=r=>{this.resetHoverEffectOnPointerLeave||this.pointerLeaveEvent===void 0?GS.set(r.clientX-this.domElement.clientWidth/2,r.clientY-this.domElement.clientHeight/2):GS.set(r.clientX-this.pointerLeaveEvent.clientX,r.clientY-this.pointerLeaveEvent.clientY),this.hoverRotatePanMode===1?(this.rotateDelta.copy(GS).multiplyScalar(this.rotateSpeed*this.hoverRotatePanStrength).rotateAround(NW,-this.object.angleOffsetFromUp),this.rotateLeft(2*Math.PI*this.rotateDelta.x/this.domElement.clientHeight),this.rotateUp(2*Math.PI*this.rotateDelta.y/this.domElement.clientHeight),this.rotateStart.set(r.clientX,r.clientY)):this.hoverRotatePanMode===2&&(this.panDelta.copy(GS).multiplyScalar(this.panSpeed*this.hoverRotatePanStrength),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.set(r.clientX,r.clientY)),this.update()},this.onPointerMove=r=>{this.enabled!==!1&&(this.checkRaycastLock()||(r.pointerType==="touch"||r.pointerType==="pen"&&uo?this.onPointerMoveTouch(r):this.onPointerMoveMouse(r),r.stopPropagation()))},this.onPointerUp=r=>{this.isPointerDown=!1,Yt.length===0&&(this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)),Yt.length>1&&r.preventDefault(),this.hasChange?this.dispatchEvent(Ap):this.dispatchEvent(bRe),this.state=-1,r&&(r.stopPropagation(),r.pointerType==="touch"||r.pointerType==="pen"&&uo||this.domElement.releasePointerCapture(r.pointerId))},this.onPointerDownMouse=r=>{let n;switch(this.useKeyEvents?n=this.mouseButtons[r.button]:n=this.mouseButtonsPlay[r.button],n){case 0:if(r.altKey===!0&&!r.shiftKey&&!tS(r)){if(this.enableRotate===!1)return;this.handleMouseDownRotate(r),this.state=0}else if(this.key===" "){if(this.enablePan===!1)return;this.handleMouseDownPan(r),this.state=2}break;case 4:if(this.enablePan===!1)return;this.handleMouseDownPan(r),this.state=2;break;case 3:if(tS(r)||r.shiftKey){if(this.enablePan===!1)return;this.handleMouseDownPan(r),this.state=2}else{if(this.enableRotate===!1)return;this.handleMouseDownRotate(r),this.state=0}break;case 5:if(tS(r)||r.shiftKey){if(this.enableRotate===!1)return;this.handleMouseDownRotate(r),this.state=0}else{if(this.enablePan===!1)return;this.handleMouseDownPan(r),this.state=2}break;default:this.state=-1}},this.onPointerMoveMouse=r=>{switch(this.state){case 0:if(this.enableRotate===!1)return;this.handleMouseMoveRotate(r);break;case 1:if(this.enableZoom===!1)return;this.handleMouseMoveDolly(r);break;case 2:if(this.enablePan===!1)return;this.handleMouseMovePan(r);break}this.object.wasMovedByUser=!0},this.onPointerDownTouch=r=>{switch(Yt.length>1&&r.preventDefault(),this.touches[Yt.length-1]){case Do.ROTATE:if(this.enableRotate===!1){this.state=-1;return}this.handleTouchStartRotate(),this.state=3;break;case Do.PAN:if(this.enablePan===!1){this.state=-1;return}this.handleTouchStartPan(),this.state=4;break;case Do.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this.handleTouchStartDollyPan(),this.state=5;break;case Do.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this.handleTouchStartDollyRotate(),this.state=6;break;default:this.state=-1}},this.onPointerMoveTouch=r=>{switch(Yt.length>1&&r.preventDefault(),this.state){case 3:if(this.enableRotate===!1)return;this.handleTouchMoveRotate(r),this.update();break;case 4:if(this.enablePan===!1)return;this.handleTouchMovePan(r),this.update();break;case 5:if(this.enableZoom===!1&&this.enablePan===!1)return;this.handleTouchMoveDollyPan(r),this.update();break;case 6:if(this.enableZoom===!1&&this.enableRotate===!1)return;this.handleTouchMoveDollyRotate(r),this.update();break;default:this.state=-1}this.object.wasMovedByUser=!0},this.dispatchEndDebounced=VB(()=>this.dispatchEvent(Ap),33),this.onMouseWheel=r=>{this.enabled===!1||this.enableZoom===!1&&this.enablePan===!1||this.checkRaycastLock()||(!this.options.isExport&&this.domElement.clientHeight===document.body.clientHeight&&this.domElement.clientWidth===document.body.clientWidth&&r.preventDefault(),this.dispatchEvent(Ep),this.handleMouseWheel(r),this.dispatchEndDebounced(),this.object.wasMovedByUser=!0)},this.onGesture=r=>{if(r.preventDefault(),this.enabled!==!1&&!this.checkRaycastLock()&&!Vw)if(r.type==="gesturechange"){if(this.enableZoom===!1||this.isTouchZoom===!1)return;this.dispatchEvent(Ep),r.scale>this.prevScale?this.dollyIn(this.getZoomScale()):r.scale<this.prevScale&&this.dollyOut(this.getZoomScale()),this.prevScale=r.scale,this.update(),this.object.wasMovedByUser=!0}else this.dispatchEvent(Ap)},this.onContextMenu=r=>{r.preventDefault()},this.onTouchEnd=r=>{r.preventDefault()},this.onKeyDown=r=>{this.enabled!==!1&&(this.key=r.key,r.key===" "&&this.dispatchEvent(Ep))},this.onKeyUp=r=>{this.enabled!==!1&&(this.key=void 0,this.state!==-1&&r.key==="Alt"&&this.onPointerUp(Yt[0]),r.key===" "&&this.dispatchEvent(Ap))},this.onPointerHover=r=>{r.pointerType!=="mouse"||this.enabled===!1||this.state!==-1||this.hoverRotatePanMode===2&&this.isPanOverShoot||this.hoverRotatePanMode===1&&this.isRotateOverShoot||(this.isPointerDown=!0,this.hoverRotatePanMode===2?this.handleMouseMovePan(r,this.hoverRotatePanStrength):this.hoverRotatePanMode===1&&this.handleMouseMoveRotate(r,this.hoverRotatePanStrength))},this.onBeginState=()=>{this.enabled=!1,this.needsUpdate=!1},this.onCompleteState=r=>{r.isfromEntity&&this.options.isPlayMode||(this.enabled=!0,this.needsUpdate=!0,this.object.updateUp(),this.object.getTarget(this.target))},this.target=this.object.getTarget(),this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.quat0=this.object.quaternion.clone(),this.isUpVectorFlipped0=this.object.isUpVectorFlipped,this.offset.copy(this.object.position).sub(this.target),this.spherical.setFromVector3(this.offset),this.object.isUpVectorFlipped&&(this.spherical.phi*=-1,this.spherical.theta-=Math.PI),this.initialSphericalRadius=this.spherical.radius,this.addEventListenersToCamera()}dispatchEvent(e){e.type==="start"?this.hasChange=!1:this.hasChange=!0,super.dispatchEvent(e)}addEventListenersToCamera(){this.object.addEventListener("beginState",this.onBeginState),this.object.addEventListener("completeState",this.onCompleteState),this.object.addEventListener("cameraChange",this.onCameraChange)}removeEventListenersFromCamera(){this.object.removeEventListener("beginState",this.onBeginState),this.object.removeEventListener("completeState",this.onCompleteState),this.object.removeEventListener("cameraChange",this.onCameraChange)}updateUseWindowEvents(e){if(window.removeEventListener("pointermove",this.onPointerHover),this.domElement.removeEventListener("pointermove",this.onPointerHover),this.useWindowEvents=e,this.hoverRotatePanMode!==0&&(this.useWindowEvents?window.addEventListener("pointermove",this.onPointerHover):this.domElement.addEventListener("pointermove",this.onPointerHover)),this.domElement.removeEventListener("pointerleave",this.onPointerLeave),this.domElement.removeEventListener("pointerenter",this.onPointerEnter),window.removeEventListener("pointerleave",this.onPointerLeave),window.removeEventListener("pointerenter",this.onPointerEnter),this.hoverRotatePanMode!==0&&!this.useWindowEvents){let t=this.useWindowEvents?window:this.domElement;t.addEventListener("pointerleave",this.onPointerLeave),t.addEventListener("pointerenter",this.onPointerEnter)}}fromJSON(e,t){this.setEnableDampingSpeed(e.enableDamping),this.enablePan=e.enablePan,this.enableZoom=e.enableZoom,this.enableRotate=e.enableRotate,this.rotationLimitsMode=e.rotationLimitsMode,this.thetaIsFree=e.rotationHorizontalOffset.min===e.rotationHorizontalOffset.max&&e.rotationHorizontalOffset.min===Math.PI,this.phiIsFree=e.rotationVerticalOffset.min===e.rotationVerticalOffset.max&&e.rotationVerticalOffset.min===Math.PI,this.panLimitsMode=e.panLimitsMode,this.panSoftLimit=e.panSoftLimit,this.rotationSoftLimit=e.rotationSoftLimit,this.hoverRotatePanMode=e.hoverRotatePanMode,this.hoverRotateDamping=e.hoverRotateDamping??this.dampingFactor,this.useWindowEvents=t==="window",this.hoverRotatePanMode!==0&&(this.useWindowEvents?window.addEventListener("pointermove",this.onPointerHover):this.domElement.addEventListener("pointermove",this.onPointerHover));let i=e.hoverRotatePanStrength/100;this.hoverRotatePanStrength=i**2,this.zoomLimitsEnabled=e.zoomLimitsEnabled,this.minZoom=e.zoomLimits.min,this.maxZoom=Math.max(e.zoomLimits.min,e.zoomLimits.max),this.minDistance=1e3/e.zoomLimits.max,this.maxDistance=Math.max(this.minDistance,1e3/e.zoomLimits.min),this.autoRotate=e.autoRotate,this.autoRotateSpeed=e.autoRotateSpeed,this.autoRotateClockwise=e.autoRotateClockwise;let r=this.object.getTarget().applyQuaternion(yR.copy(this.object.quaternion).invert());this.minV=-e.panVerticalOffset.min+r.y,this.maxV=e.panVerticalOffset.max+r.y,this.minH=-e.panHorizontalOffset.min+r.x,this.maxH=e.panHorizontalOffset.max+r.x,this.panRangeFactor.set(this.maxH-this.minH,this.maxV-this.minV).divideScalar(2),this.rotationRangeFactor.setScalar(Math.PI).divideScalar(4),this.minPhi=mc(this.spherical.phi-e.rotationVerticalOffset.min),this.maxPhi=mc(this.spherical.phi+e.rotationVerticalOffset.max),this.minTheta=mc(mc(this.spherical.theta)-e.rotationHorizontalOffset.min),this.maxTheta=mc(mc(this.spherical.theta)+e.rotationHorizontalOffset.max),this.isThetaFlipped=this.minTheta>this.maxTheta,e.orbitTouches===1&&(this.touches[0]=Do.ROTATE),e.panTouches===1&&(this.touches[0]=Do.PAN),e.orbitTouches===2&&(this.touches[1]=Do.DOLLY_ROTATE),e.panTouches===2&&(this.touches[1]=Do.DOLLY_PAN),e.orbitTouches===3&&(this.touches[2]=Do.ROTATE),e.panTouches===3&&(this.touches[2]=Do.PAN),this.isTouchZoom=e.isTouchZoom,this.resetHoverEffectOnPointerLeave=e.resetHoverEffectOnPointerLeave??!1}connect(){if(this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("wheel",this.onMouseWheel),window.addEventListener("keydown",this.onKeyDown,!1),window.addEventListener("keyup",this.onKeyUp,!1),this.domElement.addEventListener("gesturestart",this.onGesture),this.domElement.addEventListener("gesturechange",this.onGesture),this.domElement.addEventListener("gestureend",this.onGesture),this.domElement.addEventListener("touchend",this.onTouchEnd),this.hoverRotatePanMode!==0&&!this.useWindowEvents){let e=this.useWindowEvents?window:this.domElement;e.addEventListener("pointerleave",this.onPointerLeave),e.addEventListener("pointerenter",this.onPointerEnter)}this.pointerLeaveEvent=void 0}dispose(){this.removeEventListenersFromCamera(),this.domElement.removeEventListener("contextmenu",this.onContextMenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("wheel",this.onMouseWheel),window.removeEventListener("keydown",this.onKeyDown,!1),window.removeEventListener("keyup",this.onKeyUp,!1),this.domElement.removeEventListener("pointermove",this.onPointerHover),window.removeEventListener("pointermove",this.onPointerHover),this.domElement.removeEventListener("gesturestart",this.onGesture),this.domElement.removeEventListener("gesturechange",this.onGesture),this.domElement.removeEventListener("gestureend",this.onGesture),this.domElement.removeEventListener("touchend",this.onTouchEnd),this.domElement.removeEventListener("pointerleave",this.onPointerLeave),this.domElement.removeEventListener("pointerenter",this.onPointerEnter),window.removeEventListener("pointerleave",this.onPointerLeave),window.removeEventListener("pointerenter",this.onPointerEnter),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)}applyLimits(e,t,i,r,n,s,a,o){this.overShoot.set(0,0);let l,c,u;e instanceof B?(l=e.x,c=e.y,this.current.set(this.target.x,this.target.y),u=!0):(l=e.theta,c=e.phi,this.current.set(mc(this.spherical.theta),mc(this.spherical.phi)),u=!1),i===0&&(this.current.x+=l,this.current.y+=c),(t===3||t===2)&&(!u&&this.isThetaFlipped?this.current.x>r&&this.current.x<0?this.overShoot.x=r-this.current.x:this.current.x<n&&this.current.x>0&&(this.overShoot.x=n-this.current.x):this.current.x>r?this.overShoot.x=r-this.current.x:this.current.x<n&&(this.overShoot.x=n-this.current.x)),(t===3||t===1)&&(this.current.y>s?this.overShoot.y=s-this.current.y:this.current.y<a&&(this.overShoot.y=a-this.current.y)),u||(this.overShoot.x=mc(this.overShoot.x),this.overShoot.y=mc(this.overShoot.y)),i!==0?(this.overRatio.copy(this.overShoot).divide(o),this.overRatio.x=Math.min(Math.abs(this.overRatio.x),1),this.overRatio.y=Math.min(Math.abs(this.overRatio.y),1),i===1&&(this.overRatio.x=kW(Math.abs(this.overRatio.x)),this.overRatio.y=kW(Math.abs(this.overRatio.y))),this.isPointerDown||i===1?i===2&&(this.overRatio.x>.9&&!this.thetaIsFree||this.overRatio.y>.9&&!this.phiIsFree)?this.isPointerDown=!1:(l*this.overShoot.x<0&&!this.thetaIsFree&&(l*=1-this.overRatio.x),c*this.overShoot.y<0&&!this.phiIsFree&&(c*=1-this.overRatio.y)):i===2&&(!u&&(this.overRatio.x>.002&&!this.thetaIsFree||this.overRatio.y>.002&&!this.phiIsFree)||u&&(Math.abs(this.overShoot.x)>2||Math.abs(this.overShoot.y)>2)?(this.thetaIsFree||(l=this.overShoot.x*.05),this.phiIsFree||(c=this.overShoot.y*.05),u?this.isPanOverShoot=!0:this.isRotateOverShoot=!0):u?this.isPanOverShoot=!1:this.isRotateOverShoot=!1)):(l+=this.overShoot.x,c+=this.overShoot.y),e instanceof B?(e.x=l,e.y=c):(this.thetaIsFree||(e.theta=l),this.phiIsFree||(e.phi=c))}setEnableDampingSpeed(e){this.enableDamping=e,this.rotateSpeed=e===!0?.2:1}stopDamping(){this.sphericalDelta.theta=0,this.sphericalDelta.phi=0}getAutoRotationAngle(){return 2*Math.PI/60/60*this.autoRotateSpeed}getZoomScale(){return Math.pow(.95,this.zoomSpeed)}rotateLeft(e){this.sphericalDelta.theta-=e}rotateUp(e){this.sphericalDelta.phi-=e}panLeft(e,t){this.panLeftV.setFromMatrixColumn(t,0),this.panLeftV.multiplyScalar(-e),this.panOffset.add(this.panLeftV)}panUp(e,t){this.panUpV.setFromMatrixColumn(t,1),this.panUpV.multiplyScalar(e),this.panOffset.add(this.panUpV)}pan(e,t){let i=this.domElement;if(i&&this.object.isPerspectiveCamera){let r=this.object.position;this.panV.copy(r).sub(this.target);let n=this.panV.length();n*=Math.tan(this.object.fov/2*Math.PI/180),this.panLeft(2*e*n/i.clientHeight,this.object.matrixWorld),this.panUp(2*t*n/i.clientHeight,this.object.matrixWorld)}else i&&this.object.isOrthographicCamera&&(this.panLeft(e*(this.object.right-this.object.left)/this.object.zoom/i.clientWidth,this.object.matrixWorld),this.panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/i.clientHeight,this.object.matrixWorld));this.dispatchEvent(wRe)}dollyOut(e){this.object.isPerspectiveCamera?this.scale/=e:this.object.isOrthographicCamera&&(this.object.zoom*=e,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0),this.dispatchEvent(zW)}dollyIn(e){this.object.isPerspectiveCamera?this.scale*=e:this.object.isOrthographicCamera&&(this.object.zoom/=e,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0),this.dispatchEvent(zW)}zoomOut(e=this.getZoomScale()){this.dispatchEvent(Ep),this.dollyOut(e),this.dispatchEvent(Ap)}zoomIn(e=this.getZoomScale()){this.dispatchEvent(Ep),this.dollyIn(e),this.dispatchEvent(Ap)}setZoom(e){if(this.dispatchEvent(Ep),this.object.isPerspectiveCamera){let t=this.initialSphericalRadius/e/this.spherical.radius;this.scale=t}else this.object.isOrthographicCamera&&(this.object.zoom=e,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0);this.dispatchEvent(Ap)}handleMouseDownRotate(e){this.rotateStart.set(e.clientX,e.clientY)}handleMouseDownDolly(e){this.dollyStart.set(e.clientX,e.clientY)}handleMouseDownPan(e){this.panStart.set(e.clientX,e.clientY)}handleMouseMoveRotate(e,t=1){e.movementX!==void 0?this.rotateDelta.set(e.movementX,e.movementY):(this.rotateEnd.set(e.clientX,e.clientY),this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart),this.rotateStart.copy(this.rotateEnd)),this.rotateDelta.multiplyScalar(this.rotateSpeed*t).rotateAround(NW,-this.object.angleOffsetFromUp);let i=this.domElement,r=this.useWindowEvents?window.innerHeight:i.clientHeight,n=2*Math.PI*this.rotateDelta.x/r,s=2*Math.PI*this.rotateDelta.y/r;this.rotateLeft(n),this.rotateUp(s),this.update()}handleMouseMoveDolly(e){this.dollyEnd.set(e.clientX,e.clientY),this.dollyDelta.subVectors(this.dollyEnd,this.dollyStart),this.dollyDelta.y>0?this.dollyOut(this.getZoomScale()):this.dollyDelta.y<0&&this.dollyIn(this.getZoomScale()),this.dollyStart.copy(this.dollyEnd),this.update()}handleMouseMovePan(e,t=1){e.movementX!==void 0?this.panDelta.set(e.movementX,e.movementY):(this.panEnd.set(e.clientX,e.clientY),this.panDelta.subVectors(this.panEnd,this.panStart),this.panStart.copy(this.panEnd)),this.panDelta.multiplyScalar(this.panSpeed*t),this.pan(this.panDelta.x,this.panDelta.y),this.update()}handleMouseWheel(e){if(Pwe===!1&&tS(e)===!1&&Rwe(e)===!0){if(this.enablePan===!1)return;this.gesture?(this.panDelta.set(-e.deltaX,-e.deltaY).multiplyScalar(this.panSpeed),this.panDelta.x=Math.min(Math.abs(this.panDelta.x),100)*(this.panDelta.x<0?-1:1),this.panDelta.y=Math.min(Math.abs(this.panDelta.y),100)*(this.panDelta.y<0?-1:1),e.altKey?this.pan(0,this.panDelta.y):e.shiftKey?this.pan(this.panDelta.x,0):this.pan(this.panDelta.x,this.panDelta.y),this.update()):(this.gesture=!0,this.isPointerDown=!0),window.clearTimeout(this.timer),this.timer=window.setTimeout(()=>{this.gesture=!1,this.isPointerDown=!1},30)}else{if(this.enableZoom===!1||this.gesture)return;e.deltaY===0?e.deltaX<0?this.dollyIn(this.getZoomScale()):e.deltaX>0&&this.dollyOut(this.getZoomScale()):e.deltaY<0?this.dollyIn(this.getZoomScale()):e.deltaY>0&&this.dollyOut(this.getZoomScale()),this.update(),this.gesture=!1,this.isPointerDown=!1}}handleTouchStartRotate(){if(Yt.length===2){let e=.5*(Yt[0].pageX+Yt[1].pageX),t=.5*(Yt[0].pageY+Yt[1].pageY);this.rotateStart.set(e,t)}else this.rotateStart.set(Yt[0].pageX,Yt[0].pageY)}handleTouchStartPan(){if(Yt.length===2){let e=.5*(Yt[0].pageX+Yt[1].pageX),t=.5*(Yt[0].pageY+Yt[1].pageY);this.panStart.set(e,t)}else this.panStart.set(Yt[0].pageX,Yt[0].pageY)}handleTouchStartDolly(){let e=Yt[0].pageX-Yt[1].pageX,t=Yt[0].pageY-Yt[1].pageY,i=Math.sqrt(e*e+t*t);this.dollyStart.set(0,i)}handleTouchStartDollyPan(){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchStartDolly(),this.enablePan&&this.handleTouchStartPan()}handleTouchStartDollyRotate(){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchStartDolly(),this.enableRotate&&this.handleTouchStartRotate()}handleTouchMoveRotate(e){if(Yt.length===2){let i=c3(e),r=.5*(e.pageX+i.x),n=.5*(e.pageY+i.y);this.rotateEnd.set(r,n)}else{if(e.pointerId!==Yt[0].pointerId)return;this.rotateEnd.set(e.pageX,e.pageY)}this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart).multiplyScalar(this.rotateSpeed);let t=this.domElement;t&&(this.rotateLeft(2*Math.PI*this.rotateDelta.x/t.clientHeight),this.rotateUp(2*Math.PI*this.rotateDelta.y/t.clientHeight)),this.rotateStart.copy(this.rotateEnd)}handleTouchMovePan(e){if(Yt.length===2){let t=c3(e),i=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);this.panEnd.set(i,r)}else{if(e.pointerId!==Yt[0].pointerId)return;this.panEnd.set(e.pageX,e.pageY)}this.panDelta.subVectors(this.panEnd,this.panStart).multiplyScalar(this.panSpeed),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.copy(this.panEnd)}handleTouchMoveDolly(e){let t=c3(e),i=e.pageX-t.x,r=e.pageY-t.y,n=Math.sqrt(i*i+r*r);this.dollyEnd.set(0,n),this.dollyDelta.set(0,Math.pow(this.dollyEnd.y/this.dollyStart.y,this.zoomSpeed)),this.dollyOut(this.dollyDelta.y),this.dollyStart.copy(this.dollyEnd)}handleTouchMoveDollyPan(e){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchMoveDolly(e),this.enablePan&&this.handleTouchMovePan(e)}handleTouchMoveDollyRotate(e){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchMoveDolly(e),this.enableRotate&&this.handleTouchMoveRotate(e)}checkRaycastLock(){var e;if(this.object.data.raycastLock){if(this.options.isPlayMode)return!1;{let t=(e=this.options)==null?void 0:e.showCameraLock;return t&&t(),!0}}else return!1}};function mc(e){let t=Math.PI*2;for(;e<=-Math.PI;)e+=t;for(;e>Math.PI;)e-=t;return e}function kW(e){return 1-Math.pow(1-e,4)}var UW=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.page=r,this.currentIntersectedObjects=[],this.actions=hs(t,t.actions,r,n,s,i),this.target=t.target,this.triggeringObjects=[];for(let a of t.triggeringObjects){let o=r.scene.find(a);o&&this.triggeringObjects.push(o)}}isValidTriggeringObject(e){return this.target==="all"?!0:this.triggeringObjects.some(t=>t===e||t.isAncestorOf(e.uuid)||e.isAncestorOf(t.uuid))}disconnect(){as(this.actions)}dispatch(){this.object.destroyedInAction||(this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),this.object.dispatchEvent({type:"beginEvent",eventName:"Trigger"}),this.actions.Transition.forEach(e=>{e.data.runMode==="Toggle"?e.toggle():e.play()}),this.actions.SwitchCamera.forEach(e=>{e.data.runMode==="Toggle"?e.toggle():e.play()}),this.actions.Link.forEach(e=>{e.dispatch()}),this.actions.Reset.forEach(e=>{e.dispatch()}),this.actions.Create.forEach(e=>{e.dispatch()}),this.actions.Destroy.forEach(e=>{e.dispatch(!1)}),this.actions.Audio.forEach(e=>{e.dispatchBasic()}),this.actions.Particles.forEach(e=>{e.dispatchBasic()}),this.actions.Video.forEach(e=>{e.dispatchBasic()}),this.actions.SceneTransition.forEach(e=>{e.dispatch()}),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.ClearLocalStorage.forEach(e=>e.dispatch()),this.actions.UserAPI.forEach(e=>e.dispatch()))}},Di;Bwe.then(e=>Di=e);var mn=new B,xl=new ei,Qh=new B,bR=new Nn(0,0,0,"YXZ"),FW=new Nn(0,0,0,"XYZ"),wl=new B,_R=new B,SR=new B(1,1,1),rg=new ei,WS=new ht,VW=new ht,ARe={type:"updateMatrix"},HW=new ei,MR=new ja,Tz={type:"beginEvent",eventName:"Collision"},CRe={type:"beginEvent",eventName:"Trigger"};function TRe(e){if(j1.physicsEnabled(e.scene.objects))return!0;let t=!1;return e.scene.objects.traverse((i,r)=>{if(r.events){if(Array.isArray(r.events)){for(let n of r.events)if(n.data.disabled!==!0&&n.data.type==="GameControl"&&n.data.collisionEnabled){t=!0;break}}else for(let n of Object.values(r.events))if(n.disabled!==!0&&n.type==="GameControl"&&n.collisionEnabled){t=!0;break}}}),t}var gC=e=>e.states.some(t=>t.data.position!==void 0||t.data.rotation!==void 0||t.data.hiddenMatrix!==void 0||t.data.cloner!==void 0||t.data.pathSnapping!==void 0),PRe=class{constructor(e){this.eventContext=e,this.isEnabled=!1,this.gameControl=null,this.joysticks=[],this.joystickToGameControls=[],this.sharedGameControlGlobals={entitiesWithTransformAnim:[],entityToCollisionEvents:{},colliderToEntity:new Map,triggers:[],gamePads:[],createdObjects:[],nCreatedPerAction:{}},this.sensorToTriggerEvent={},this.eventManager=void 0,this.needsCollisionDetection=!1,this.initializationCounter=-1,this.rigidBodyToMesh=new Map,this.nActiveRigidBodies=0,this.collisionEvents=[],this.isExport=!1,this.processRigidBody=t=>{if(t.bodyType()!==Di.RigidBodyType.Dynamic)return;t.isSleeping()||this.nActiveRigidBodies++;let[i,r,n]=this.rigidBodyToMesh.get(t.handle);if(mn.copy(t.translation()).multiplyScalar(this.pixelsPerMeter),xl.copy(t.rotation()),i.matrixWorld.compose(mn,xl,r),i.hasNonUniformScale&&i.matrixWorld.multiply(i.shearScale),i.dispatchEvent(ARe),n){let s=i.cloner;if(s&&s.objectForSample===void 0){s.matrixWorld.copy(i.matrixWorld);for(let a of s.children)a.updateMatrixWorld(!0)}for(let a of i.children)a.updateMatrixWorld(!0)}},this.accumulator=0,this.handleCollisionEvents=(t,i,r)=>{var a,o,l,c;if(r===!1)return;let n,s;if(this.sensorToTriggerEvent[t]?(n=this.sensorToTriggerEvent[t],s=this.sharedGameControlGlobals.colliderToEntity.get(i)):this.sensorToTriggerEvent[i]&&(n=this.sensorToTriggerEvent[i],s=this.sharedGameControlGlobals.colliderToEntity.get(t)),n&&s&&n.isValidTriggeringObject(s)){n.dispatch();return}for(let u=this.sharedGameControlGlobals.createdObjects.length-1;u>=0;u--){let h=this.sharedGameControlGlobals.createdObjects[u];if(h.userData.hasCollisionDestroy&&(((a=h.rigidBody)==null?void 0:a.collider(0).handle)===t||((o=h.rigidBody)==null?void 0:o.collider(0).handle)===i)){this.sharedGameControlGlobals.createdObjects.splice(u,1),h.removeFromParent(),requestAnimationFrame(()=>{var d;return(d=this.sharedGameControlGlobals.rapierWorld)==null?void 0:d.removeRigidBody(h.rigidBody)});break}}if(((l=this.gameControl)==null?void 0:l.object)!==void 0&&this.gameControl.object===this.sharedGameControlGlobals.colliderToEntity.get(t)){let u=this.sharedGameControlGlobals.colliderToEntity.get(i),h=this.sharedGameControlGlobals.entityToCollisionEvents[u.uuid];if(h===void 0)return;for(let d of h)d.data.target==="character"&&this.dispatchCollisionEvent(d,u,i)}else if(((c=this.gameControl)==null?void 0:c.object)!==void 0&&this.gameControl.object===this.sharedGameControlGlobals.colliderToEntity.get(i)){let u=this.sharedGameControlGlobals.colliderToEntity.get(t),h=this.sharedGameControlGlobals.entityToCollisionEvents[u.uuid];if(h===void 0)return;for(let d of h)d.data.target==="character"&&this.dispatchCollisionEvent(d,u,t)}else{let u=this.sharedGameControlGlobals.colliderToEntity.get(t),h=this.sharedGameControlGlobals.entityToCollisionEvents[u.uuid];if(h!==void 0)for(let f of h)f.data.target==="scene"&&this.dispatchCollisionEvent(f,u,t);let d=this.sharedGameControlGlobals.colliderToEntity.get(i),p=this.sharedGameControlGlobals.entityToCollisionEvents[d==null?void 0:d.uuid];if(p!==void 0)for(let f of p)f.data.target==="scene"&&this.dispatchCollisionEvent(f,d,i)}},this.isExport=e.isExport,this.sharedAssets=e.sharedAssets,this.renderer=e.renderer,this.requestRender=e.requestRender,this.domElement=this.renderer.domElement,this.pixelsPerMeter=aJ,this.gravity=this.page.data.globalPhysics.gravity}get page(){return this.eventContext.page}attachVRControllers(e){e.forEach(t=>{t.addEventListener("connected",i=>{"gamepad"in i.data&&"axes"in i.data.gamepad&&this.sharedGameControlGlobals.gamePads.push(i.data.gamepad)})})}markIsDestroyTarget(){this.page.traverseVisibleEntity(e=>{var i,r;let t=e.dataPatched;for(let n of t.events){if(n.data.disabled===!0)continue;let s=(r=(i=n.data.actions)==null?void 0:i.find(a=>a.data.type==="Destroy"))==null?void 0:r.data;if(s)for(let a of s.objects){let o=this.page.scene.find(a);o&&(o.userData.hasDestroy=!0)}}})}markIsDragObject(){this.page.traverseVisibleEntity(e=>{let t=e.dataPatched;for(let i of t.events)if(!(i.data.disabled===!0||i.data.type!=="DragDrop"))for(let r of i.data.objects){let n=this.page.scene.find(r);n&&(n.userData.hasDrag=!0)}})}initBVH(){let e=[];if(this.page.traverseChildren(t=>{var c,u;let i,r=t instanceof bE,n=t instanceof SE;if(t instanceof Ll||r||n)return;t instanceof Xs?i=t.object:i=t;let s=i.dataPatched;if(((c=s.physics)==null?void 0:c.enabled)==="visibility"?!s.visible:!((u=s.physics)!=null&&u.enabled))return!0;let a=t.geometry,o=i.userData.hasDestroy===!0,l=i.userData.hasDrag===!0;if(gC(s)||o||l||i.dataPatched.events.some(h=>h.data.disabled!==!0&&h.data.type==="GameControl"))return t.updateMatrixWorldSVD(),this.addBoundsTree(t),!0;a&&e.push(Nu(a,t.matrixWorld))}),e.length>0){let t=df(e,!1);this.sharedGameControlGlobals.staticMeshBVH=new Qx(t)}}addRigidBody(e,t,i){let r=[],n="geometry"in e?e.geometry:void 0,s=t.dataPatched;if((n==null?void 0:n.getAttribute("position"))!==void 0&&r.push(Nu(n,e.shearScale)),s.physics.fusedBody){let a=this.gatherChildrenGeom(e,r);e.traverseObject(a),e.children.forEach(l=>l.updateMatrixWorld(!0));let o=e.cloner;o&&o.objectForSample===void 0&&s.physics.rigidBody==="dynamic"&&(o.traverseObject(a),o.children.forEach(l=>l.updateMatrixWorld(!0)))}if(r.length>0){let a,o=!i.fromCreate&&s.physics.rigidBody==="dynamic"||i.fromCreate&&i.dynamic;o?(a=Di.RigidBodyDesc.dynamic(),a.setLinearDamping(s.physics.damping).setAngularDamping(s.physics.damping).setAdditionalMass(1e-9).setGravityScale(s.physics.gravityScale).enabledRotations(...s.physics.enabledRotation).enabledTranslations(...s.physics.enabledTranslation)):(i.hasTransformAnim||i.hasFollow||i.hasDrag)&&!i.fromCreate?(a=Di.RigidBodyDesc.kinematicPositionBased(),this.sharedGameControlGlobals.entitiesWithTransformAnim.push(e)):a=Di.RigidBodyDesc.fixed();let l=df(r);(e.hasNonUniformScale?e.matrixWorldRigid:e.matrixWorld).decompose(mn,xl,Qh),e.position0=mn.clone().divideScalar(this.pixelsPerMeter),e.rotation0=xl.clone(),mn.divideScalar(this.pixelsPerMeter),a.setTranslation(mn.x,mn.y,mn.z).setRotation(xl),n?l==null||l.scale(1/this.pixelsPerMeter,1/this.pixelsPerMeter,1/this.pixelsPerMeter):l==null||l.scale(Qh.x/this.pixelsPerMeter,Qh.y/this.pixelsPerMeter,Qh.z/this.pixelsPerMeter);let c=this.sharedGameControlGlobals.rapierWorld.createRigidBody(a);o&&this.rigidBodyToMesh.set(c.handle,[e,Qh.clone(),s.physics.fusedBody]);let u=!(s.geometry===void 0||s.geometry.type==="SubdivGeometry"||s.geometry.type==="NonParametricGeometry"||s.geometry.type==="BooleanGeometry"||s.geometry.type==="VectorGeometry"||s.geometry.type==="StarGeometry"||s.geometry.type==="RectangleGeometry"||s.geometry.type==="EllipseGeometry"||s.geometry.type==="TriangleGeometry"||s.geometry.type==="TorusGeometry"||s.geometry.type==="HelixGeometry");try{this.addCollider(c,s.physics,l,t,u)}catch{try{this.addCollider(c,s.physics,l,t,!1)}catch(h){console.error(h)}}e.rigidBody=c}}addBoundsTree(e){var i,r;let t=[];if(((i=e.geometry)==null?void 0:i.getAttribute("position"))!==void 0&&((r=e.geometry)==null?void 0:r.getAttribute("position").count)>0&&t.push(Nu(e.geometry,e.shearScale)),e.traverseObject(this.gatherChildrenGeom(e,t)),e.children.forEach(n=>n.updateMatrixWorld(!0)),t.length>0){let n=df(t,!1);e.bvhGeometry=n,n.getAttribute("position").count>0&&(e.bvhGeometry.boundsTree=new Qx(n),this.sharedGameControlGlobals.entitiesWithTransformAnim.push(e))}}addCollider(e,t,i,r,n=!0){var o,l;if((i==null?void 0:i.getAttribute("position").count)===0||((o=i==null?void 0:i.getIndex())==null?void 0:o.count)===0)return;let s;i&&(t.colliderType==="trimesh"?s=Di.ColliderDesc.trimesh(i.getAttribute("position").array,i.getIndex().array):s=Di.ColliderDesc.convexMesh(i.getAttribute("position").array,n?i.getIndex().array:void 0)),s.setFrictionCombineRule(Di.CoefficientCombineRule.Average).setRestitutionCombineRule(Di.CoefficientCombineRule.Average).setDensity(t.density).setFriction(t.friction).setRestitution(t.restitution);let a=this.sharedGameControlGlobals.rapierWorld.createCollider(s,e);this.sharedGameControlGlobals.colliderToEntity.set(a.handle,r),(l=this.sharedGameControlGlobals.entityToCollisionEvents[r.uuid])!=null&&l.some(c=>c.target==="scene")&&a.setActiveEvents(Di.ActiveEvents.COLLISION_EVENTS)}gatherChildrenGeom(e,t){return(i,r)=>{var o;if(r===0)return;let n;if(i instanceof Ll)if(i.objectForSample){if(i.objectForSample.dataPatched.physics.fusedBody)return;n=i.object}else return i.object.dataPatched.physics.fusedBody===!0&&i.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(i instanceof Xs)n=i.object;else if(n=i,(o=n.dataPatched.cloner)==null?void 0:o.hideBase)return!0;let s=n.dataPatched;if(s.physics.enabled==="visibility"?!s.visible:!s.physics.enabled)return!0;r===1?e.hasNonUniformScale?i.matrixWorld.multiplyMatrices(e.shearScale,i.hiddenMatrix):i.matrixWorld.copy(i.hiddenMatrix):i.matrixWorld.multiplyMatrices(i.parent.matrixWorld,i.hiddenMatrix),i.matrixWorld.multiply(i.matrix);let a=i.geometry;(a==null?void 0:a.getAttribute("position"))!==void 0&&t.push(Nu(a,i.matrixWorld))}}activate(e){var d,p;if(this.isEnabled)return;this.isEnabled=!0,this.eventManager=e,this.usePhysics=this.page.data.globalPhysics.usePhysics;let t=this.page.playCamera,i=!1,r=5,n=8,s=9,a="drag",o=this.page.data.publish.gameControlObject,l=o!==null?this.page.find(o):null,c=null;if(l)for(let f of l.data.events){if(f.data.disabled||f.data.type!=="GameControl")continue;let v=l;for(;this.usePhysics&&((d=v=v.parent)==null?void 0:d.parent)!==null;)(p=v.data.physics)==null||p.fusedBody;f.data.collisionEnabled&&(this.needsCollisionDetection=!0),c===null&&(c=f.data)}if(this.page.traverseEntity(f=>{for(let v of f.dataPatched.events)if(v.data.disabled===!1&&v.data.type==="Trigger")return this.needsCollisionDetection=!0,!0}),l&&c&&(l.data.visible===!0||l.data.physics.enabled===!0)){i=i||c.camera===t.uuid||l.uuid===t.uuid;let f=new oJ(l,this.renderer.domElement,c,this.eventContext.page.data.globalPhysics,this,l.uuid!==t.uuid&&c.camera===t.uuid,t,this.page,this.sharedAssets);this.gameControl=f,r=c.joystickPosLoc,n=c.joystickRotLoc,s=c.jumpTouchButtonLoc,a=c.rotByTouch,uo&&c.touchControl&&(this.joystickToGameControls[r]="pos",c.moveMode==="walk"&&(this.joystickToGameControls[s]="jmp"),a==="joystick"&&(this.joystickToGameControls[n]="rot"))}if(this.gameControl&&this.gameControl.data.navmesh.enabled){let f=this.gameControl.data;if(!this.navigationMeshWrapper){this.navigationMeshWrapper=new gRe(this.usePhysics,this.isExport);let v;f.collider.type==="sphere"?v=f.collider.radius*2:v=f.collider.height,v=Math.floor(v/f.navmesh.ch-1),this.navigationMeshWrapper.init({...f.navmesh,walkableHeight:v},this.gameControl,this.eventContext)}}if(i===!1){let{enableRotate:f,enablePan:v,enableZoom:g,autoRotate:m,hoverRotatePanMode:x}=this.eventManager.publish.orbitControls;(f||v||g||m||x!==0)&&(this.orbitControls=new mJ(t,this.renderer.domElement,{isExport:this.isExport,isPlayMode:!0}),this.orbitControls.addEventListener("change",this.requestRender),this.orbitControls.addEventListener("end",this.requestRender),this.orbitControls.addEventListener("start",this.requestRender),this.orbitControls.fromJSON(this.eventManager.publish.orbitControls,this.eventManager.publish.mouseEventTarget),this.orbitControls.useKeyEvents=!1,this.orbitControls.addEventListenersToCamera(),this.orbitControls.connect(),this.orbitControls.update())}let u=this.renderer.domElement.width/this.renderer.getPixelRatio(),h=this.renderer.domElement.height/this.renderer.getPixelRatio();this.joystickToGameControls.forEach((f,v)=>{let g=document.body.appendChild(document.createElement("div")),[m,x,w]=this.eventManager.eventContext.publish.joystickSizeAndXYOffset[v],_=(u-5*m)/4+m,M={},S=f==="jmp",A=S?0:m;v<10?(v<5?M.top=A/2:M.bottom=A/2,M.left=A/2+v%5*_):v===10?(M.left=A/2,M.top=h/2):(M.right=A/2,M.top=h/2),M.top?M.top-=x[1]:M.bottom+=x[1],M.left?M.left+=x[0]:M.right-=x[0];for(let C in M)M[C]+="px";if(S){let C=g.appendChild(document.createElement("div"));Object.assign(C.style,M,{position:"absolute",width:m+"px",height:m+"px",backgroundColor:`rgba(255,255,255,${w==="show"?.4:0})`,zIndex:"9999",borderRadius:m+"px",border:w==="show"?"solid 2px rgba(0, 0, 0, .1)":"none",display:"flex",alignItems:"center",justifyContent:"center",touchAction:"none"});let D=m/16*16*.4;w==="show"&&(C.innerHTML=`
						<svg width="${D}" height="${m*.4}" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
							<path d="M2 10L8 4L14 10" stroke="black" stroke-opacity="40%" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
						</svg>
					`),C.addEventListener("pointerdown",()=>{this.gameControl.movementState.jump=1,this.requestRender()}),C.addEventListener("touchend",I=>I.preventDefault()),this.joysticks[v]=[void 0,g];return}let T={zone:g,mode:"static",position:M,size:m};w==="hide"&&(T.restOpacity=0);let E=UPe.create(T);E.on("move",(C,D)=>{let I=this.gameControl;f==="pos"?D.force<.2?I.moveForce=0:(I.movementState.movePosZ=Math.sin(-D.angle.radian),I.movementState.movePosX=Math.cos(-D.angle.radian),D.force>1.2?I.movementState.run=1:I.movementState.run=0,D.force<.3?I.moveForce=(D.force-.2)/.1:I.moveForce=1):f==="rot"&&(D.force<.2?I.rotForce=0:(I.movementState.rotPosX=D.vector.y,I.movementState.rotPosY=-D.vector.x,D.force<.3?I.rotForce=(D.force-.2)/.1:I.rotForce=1)),this.requestRender()}),E.on("end",(C,D)=>{let I=this.gameControl;f==="pos"?(I.movementState.movePosZ=0,I.movementState.movePosX=0,I.moveForce=1):f==="rot"&&(I.movementState.rotPosX=0,I.movementState.rotPosY=0,I.rotForce=1)}),this.joysticks[v]=[E,g]}),this.markIsDestroyTarget(),this.markIsDragObject(),this.rebuildBVH(),this.initializationCounter++,window.setTimeout(()=>{this.collisionEvents.forEach(f=>f.initialDisabled=!1)},80)}initPhysics(){var a;(a=this.sharedGameControlGlobals.rapierWorld)==null||a.free(),this.sharedGameControlGlobals.rapierWorld=new Di.World(new Di.Vector3(0,this.gravity,0)),this.events=new Di.EventQueue(!0);let e=[],t=[];if(this.page.traverseChildren(o=>{var m,x,w,_;let l;if(o instanceof Ll)if(o.objectForSample){if(o.objectForSample.dataPatched.physics.fusedBody)return;l=o.object}else return o.object.dataPatched.physics.fusedBody===!0&&o.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(o instanceof Xs)l=o.object;else{if(o instanceof SE||o instanceof bE)return;if(l=o,((m=l.dataPatched.cloner)==null?void 0:m.disabled)===!1&&((x=l.dataPatched.cloner)==null?void 0:x.hideBase)&&((w=l.dataPatched.physics)==null?void 0:w.fusedBody)!==!0)return!0}let c=l.dataPatched,u;for(let M of c.events)M.data.disabled!==!0&&M.data.type==="GameControl"&&(u=M.data);if(!c.physics||(c.physics.enabled==="visibility"?!c.visible:!c.physics.enabled))return!0;o.updateMatrixWorldSVD();let h=gC(c),d=!1,p=l.userData.hasDestroy,f=l.userData.hasDrag,v=!1;for(let M of c.events)if(M.data.disabled!==!0){if(M.data.type==="Collision"){d=!0;let S=new sRe(M.id,M.data,l,this.page,this.sharedAssets,this.eventManager);S.initialDisabled=!0,this.collisionEvents.push(S),this.sharedGameControlGlobals.entityToCollisionEvents[l.uuid]&&this.sharedGameControlGlobals.entityToCollisionEvents[l.uuid].every(A=>A.id!==M.id)?this.sharedGameControlGlobals.entityToCollisionEvents[l.uuid].push(S):this.sharedGameControlGlobals.entityToCollisionEvents[l.uuid]=[S]}else if(M.data.type==="Follow"){v=!0;let S=M.data.target;o.traverseVisible(A=>{A.userData.isFollowingObj=S})}}c.physics.rigidBody==="dynamic"&&c.physics.fusedBody===!1&&(o.matrixWorldFusedFalse=o.matrixWorld.clone());let g=o.geometry;if(u!==void 0){let M=Di.RigidBodyDesc.kinematicPositionBased();(o.hasNonUniformScale?o.matrixWorldRigid:o.matrixWorld).decompose(mn,xl,Qh),o.position0=mn.clone().divideScalar(this.pixelsPerMeter),o.rotation0=xl.clone(),mn.divideScalar(this.pixelsPerMeter),M.setTranslation(mn.x,mn.y,mn.z).setRotation(xl);let S=this.sharedGameControlGlobals.rapierWorld.createRigidBody(M);o.rigidBody=S;let A;u.collider.type==="sphere"?A=Di.ColliderDesc.ball(u.collider.radius/this.pixelsPerMeter):u.collider.type==="capsule"?A=Di.ColliderDesc.capsule((u.collider.height/2-u.collider.radius)/this.pixelsPerMeter,u.collider.radius/this.pixelsPerMeter):A=Di.ColliderDesc.cuboid(u.collider.width/this.pixelsPerMeter/2,u.collider.height/this.pixelsPerMeter/2,u.collider.depth/this.pixelsPerMeter/2),A.setFrictionCombineRule(Di.CoefficientCombineRule.Average).setRestitutionCombineRule(Di.CoefficientCombineRule.Average).setDensity(c.physics.density).setFriction(c.physics.friction).setRestitution(c.physics.restitution);let T=this.sharedGameControlGlobals.rapierWorld.createCollider(A,S);this.sharedGameControlGlobals.colliderToEntity.set(T.handle,l),mn.fromArray(u.collider.position).multiply(Qh.setFromMatrixScale(l.matrixWorld)).divideScalar(this.pixelsPerMeter),T.setTranslationWrtParent(mn);let E=new ei().setFromEuler(new Nn().setFromVector3(new B().fromArray(u.collider.rotation)));T.setRotationWrtParent(E),T.setActiveEvents(Di.ActiveEvents.COLLISION_EVENTS),this.generateSensorColliderDescs(l,!0)}else c.physics.rigidBody==="dynamic"||h||v||p||f||d?(this.addRigidBody(o,l,{hasFollow:v,hasTransformAnim:h,hasDrag:f}),this.generateSensorColliderDescs(l,c.physics.fusedBody)):(g&&e.push(Nu(g,o.matrixWorld)),c.physics.fusedBody&&o.traverseObject((M,S)=>{var C;if(S===0)return;let A;if(M instanceof Ll)if(M.objectForSample){if(M.objectForSample.dataPatched.physics.fusedBody)return;A=M.object}else return M.object.dataPatched.physics.fusedBody===!0&&M.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else{if(M instanceof SE||M instanceof bE)return;if(M instanceof Xs)A=M.object;else if(A=M,(C=A.dataPatched.cloner)==null?void 0:C.hideBase)return!0}let T=A.dataPatched;if(T.physics.enabled==="visibility"?!T.visible:!T.physics.enabled)return!0;let E=M.geometry;(E==null?void 0:E.getAttribute("position"))!==void 0&&e.push(Nu(E,M.matrixWorld))}),this.generateSensorColliderDescs(l,c.physics.fusedBody,t));if(((_=c.physics)==null?void 0:_.fusedBody)===!0||u)return!0}),e.length===0)return;let i=df(e);i.scale(1/this.pixelsPerMeter,1/this.pixelsPerMeter,1/this.pixelsPerMeter);let r=Di.RigidBodyDesc.fixed(),n=this.sharedGameControlGlobals.rapierWorld.createRigidBody(r),s=Di.ColliderDesc.trimesh(i.getAttribute("position").array,i.getIndex().array).setFrictionCombineRule(Di.CoefficientCombineRule.Multiply).setRestitutionCombineRule(Di.CoefficientCombineRule.Multiply).setFriction(1).setRestitution(1);this.sharedGameControlGlobals.rapierWorld.createCollider(s,n);for(let[o,l]of t){let c=this.sharedGameControlGlobals.rapierWorld.createCollider(o,n);this.sensorToTriggerEvent[c.handle]=l}}updatePositions(){return this.nActiveRigidBodies=0,this.sharedGameControlGlobals.rapierWorld.forEachRigidBody(this.processRigidBody),this.nActiveRigidBodies>0}rebuildBVH(){this.usePhysics?this.initPhysics():(this.page.traverseEntity(e=>{for(let t of e.dataPatched.events)if(t.data.type==="Trigger"&&t.data.disabled!==!0){let i=new UW(t.id,t.data,e,this.page,this.sharedAssets,this.eventManager),r=new ht().compose(wl.fromArray(t.data.position),rg.setFromEuler(FW.fromArray(t.data.rotation)),SR);if(t.data.triggerZone==="box"){let n=new cn;n.min.fromArray(t.data.size).multiplyScalar(-.5),n.max.fromArray(t.data.size).multiplyScalar(.5),this.sharedGameControlGlobals.triggers.push([n,r,e,i])}else this.sharedGameControlGlobals.triggers.push([t.data.radius,r,e,i])}}),this.needsCollisionDetection&&this.initBVH())}disconnectEvents(){this.collisionEvents.forEach(e=>e.disconnect()),this.sharedGameControlGlobals.triggers.forEach(e=>e[3].disconnect()),this.sharedGameControlGlobals.triggers.length=0}deactivate(){var e,t,i,r;if(this.isEnabled){this.isEnabled=!1,this.page.traverse(n=>{let s=n;s.matrixWorldFusedFalse&&(s.matrixWorldFusedFalse=void 0),s.rigidBody&&(s.rigidBody=void 0),s.position0&&(s.position0=void 0),s.rotation0&&(s.rotation0=void 0)}),(e=this.sharedGameControlGlobals.rapierWorld)==null||e.free(),this.sharedGameControlGlobals.rapierWorld=void 0,this.sharedGameControlGlobals.staticMeshBVH=void 0,this.accumulator=0,this.sharedGameControlGlobals.entitiesWithTransformAnim=[],this.disconnectEvents(),(t=this.gameControl)==null||t.reset(),(i=this.gameControl)==null||i.dispose(),this.gameControl=null,this.initializationCounter=-1,this.joysticks.forEach(([n,s])=>{n==null||n.destroy(),s.remove()}),this.joystickToGameControls=[],this.joysticks=[],this.orbitControls&&(this.orbitControls.dispose(),this.orbitControls=void 0),(r=this.navigationMeshWrapper)==null||r.dispose(),this.navigationMeshWrapper=void 0;for(let n of Object.values(this.sharedGameControlGlobals.entityToCollisionEvents))n.forEach(s=>s.disconnect());this.sharedGameControlGlobals.entityToCollisionEvents={},this.page.updateMatrixWorld(!0)}}update(e,t,i){if(!this.isEnabled)return!0;let r=!0;if(this.orbitControls!==void 0&&this.orbitControls.needsUpdate&&(r=!this.orbitControls.update()),this.initializationCounter>=0&&this.initializationCounter<2?(this.initializationCounter++,r=!1):this.initializationCounter===2&&this.gameControl&&(r=!this.gameControl.update(e,t,i)&&r),this.usePhysics===!1&&this.checkTrigger(),this.usePhysics){let n=.016666666666666666;if(e===0)r=this.stepPhysics()&&r;else{let s=e/1e3;s<n&&s>n*.55&&(s=n),this.accumulator+=s;let a=performance.now(),o=0,l=6;for(;this.accumulator>=n&&o<l&&(r=this.stepPhysics()&&r,this.accumulator-=n,o++,!(performance.now()-a>n*1e3)););this.accumulator=this.accumulator%n}}return r}stepPhysics(){var e;for(let t of this.sharedGameControlGlobals.entitiesWithTransformAnim){(t.hasNonUniformScale?t.matrixWorldRigid:t.matrixWorld).decompose(mn,xl,Qh),bR.setFromQuaternion(xl);let i=t;i.prevR===void 0?(i.prevR=bR.clone(),i.prevT=mn.clone()):(i.prevR.copy(bR),i.prevT.copy(mn)),t.rigidBody&&(t.rigidBody.setNextKinematicTranslation(mn.divideScalar(this.pixelsPerMeter)),t.rigidBody.setNextKinematicRotation(xl))}return this.sharedGameControlGlobals.rapierWorld.step(this.events),(e=this.events)==null||e.drainCollisionEvents(this.handleCollisionEvents),!this.updatePositions()}dispatchCollisionEvent(e,t,i){var s;let r=((s=this.sharedGameControlGlobals.rapierWorld)==null?void 0:s.getCollider(i))._parent,n;if(t.cloner){for(let a of t.cloner.children)if(a.rigidBody===r){n=a;break}}e.dispatch(n),t.dispatchEvent(Tz)}updateUseWindowEvents(e){var t;(t=this.orbitControls)==null||t.updateUseWindowEvents(e)}generateSensorColliderDescs(e,t,i){let r=VW.copy(e.matrixWorld).invert();e.traverseEntity((n,s)=>{if(t===!1&&s===1)return!0;for(let a of n.dataPatched.events)if(a.data.type==="Trigger"&&a.data.disabled!==!0){let o=new UW(a.id,a.data,n,this.page,this.sharedAssets,this.eventManager),l;if(a.data.triggerZone==="box"?l=Di.ColliderDesc.cuboid(...a.data.size.map(c=>c/(2*this.pixelsPerMeter))):l=Di.ColliderDesc.ball(a.data.radius/this.pixelsPerMeter),l.setDensity(0).setSensor(!0).setActiveEvents(Di.ActiveEvents.COLLISION_EVENTS),wl.fromArray(a.data.position),rg.setFromEuler(FW.fromArray(a.data.rotation)),WS.compose(wl,rg,SR).premultiply(n.matrixWorld),i?(WS.decompose(wl,rg,_R),l.setActiveCollisionTypes(Di.ActiveCollisionTypes.KINEMATIC_FIXED|Di.ActiveCollisionTypes.DYNAMIC_FIXED)):(WS.premultiply(r).decompose(wl,rg,_R),e.rigidBody.bodyType()===Di.RigidBodyType.Dynamic||(e.rigidBody.bodyType()===Di.RigidBodyType.Fixed?l.setActiveCollisionTypes(Di.ActiveCollisionTypes.KINEMATIC_FIXED|Di.ActiveCollisionTypes.DYNAMIC_FIXED):l.setActiveCollisionTypes(Di.ActiveCollisionTypes.KINEMATIC_KINEMATIC|Di.ActiveCollisionTypes.DYNAMIC_KINEMATIC))),wl.divideScalar(this.pixelsPerMeter),l.setTranslation(wl.x,wl.y,wl.z),l.setRotation(rg),i)i.push([l,o]);else{let c=this.sharedGameControlGlobals.rapierWorld.createCollider(l,e.rigidBody);this.sensorToTriggerEvent[c.handle]=o}}})}checkTrigger(){let e;for(let t=0;t<this.sharedGameControlGlobals.triggers.length;t++){let[i,r,n,s]=this.sharedGameControlGlobals.triggers[t];for(let a=0;a<this.sharedGameControlGlobals.entitiesWithTransformAnim.length;a++){let o=this.sharedGameControlGlobals.entitiesWithTransformAnim[a];if(n===o||s.isValidTriggeringObject(Pi.is(o)?o:o.object)===!1)continue;let l=VW.copy(n.matrixWorld).decompose(wl,HW,_R).compose(wl,HW,SR).multiply(r),c=WS.copy(o.matrixWorld).invert().multiply(l);i instanceof cn?e=o.bvhGeometry.boundsTree.intersectsBox(i,c):(MR.radius=i,MR.center.setFromMatrixPosition(c),e=o.bvhGeometry.boundsTree.intersectsSphere(MR)),e?s.currentIntersectedObjects.indexOf(o)===-1&&(s.currentIntersectedObjects.push(o),s.dispatch(),n.dispatchEvent(CRe)):s.currentIntersectedObjects=s.currentIntersectedObjects.filter(u=>u!==o)}}}};function DRe(e){let t=this._clip.duration,i=this._clip.start??0,r=this.loop,n=this.time+e,s=this._loopCount,a=r===cB;if(e===0)return s===-1?n:a&&(s&1)===1?t-(n-i):n;if(r===MY){s===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(n>=t)n=t;else if(n<0)n=0;else{this.time=n;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(s===-1&&(e>=0?(s=0,this._setEndings(!0,this.repetitions===0,a)):this._setEndings(this.repetitions===0,!0,a)),n>=t||n<i){let o=Math.floor((n-i)/(t-i));n-=(t-i)*o,s+=Math.abs(o);let l=this.repetitions-s;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,a||(n=e>0?t:i,this.repetitions===1&&(n=t)),this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(l===1){let c=e<0;this._setEndings(c,!c,a)}else this._setEndings(!1,!1,a);this._loopCount=s,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=n;if(a&&(s&1)===1)return t-(n-i)}return n}var GW=!1,RRe=class{constructor(e,t,i,r){this.scene=e,this.requestRender=t,this.updateDisplayProgress=i,this.animationInspectorState=r,this.clipIdToAction={},this.activeClip=null,this.needsUpdate=!1,this.addClip=n=>{n.data.type==="Empty"&&n.data.animations&&n.data.animations.forEach((s,a)=>{let o=s[0]+"/";if(Array.isArray(n.identity)?o+=n.identity[0]:o+=n.uuid,this.clipIdToAction[o])return;let l=FL.parse(JSON.parse(s[2]));n.animations[a]=l;let c=this.mixer.clipAction(l,n);GW===!1&&(Object.getPrototypeOf(c)._updateTime=DRe,GW=!0),c.clampWhenFinished=!0,this.clipIdToAction[o]=c})},this.mixer=new Ype(e),this.scene.traverseEntity(this.addClip)}deleteClip(e,t){let i=this.scene.find(t);if(!i)return;let r=i.animations.find(s=>s.uuid===e);if(!r)return;let n=this.clipIdToAction[e];!n||(n.stop(),this.mixer.uncacheClip(r),delete this.clipIdToAction[e],i.animations=i.animations.filter(s=>s.uuid!==e))}get isPlaying(){return Object.values(this.clipIdToAction).some(e=>e.isRunning())}playFromInspector(e){this.mixer.stopAllAction();let t=this.clipIdToAction[e];!t||(t.play(),this.activeClip=t.getClip(),this.requestRender())}onExitPlayMode(){Object.values(this.clipIdToAction).forEach(e=>{e.repetitions=1/0,e.loop=EY}),this.mixer.stopAllAction(),this.requestRender()}play(e){let t=e.clipId+"/"+e.object,i=this.clipIdToAction[t];if(i)return e&&(e.repeat>=0&&(i.repetitions=e.repeat+1),e.direction==="pingpong"&&e.repeat!==0&&(i.loop=cB)),i.play(),i.paused=!1,this.requestRender(),i}resumeFromInspector(e){let t=this.clipIdToAction[e];!t||(t.play(),t.paused=!1,this.requestRender())}pauseFromInspector(e){let t=this.clipIdToAction[e];!t||(t.paused=!0)}stop(){this.mixer.stopAllAction(),this.requestRender()}update(e){var t;if(this.needsUpdate)this.needsUpdate=!1;else if(this.isPlaying===!1||(t=this.animationInspectorState)!=null&&t.isScrubbing)return;this.mixer.update(e/1e3),this.activeClip&&this.updateDisplayProgress(Math.round(this.mixer.time/this.activeClip.duration*(this.maxFrames-1)%(this.maxFrames-1))),this.requestRender()}get maxFrames(){return $$(this.activeClip??void 0)}setProgressFromInspector(e,t){if(!this.clipIdToAction[t])return;this.activeClip!==this.clipIdToAction[t].getClip()&&this.playFromInspector(t);let i=this.clipIdToAction[t].paused;this.clipIdToAction[t].paused=!1,this.mixer.setTime(Math.min(e/(this.maxFrames-1),.9999)*this.activeClip.duration),this.requestRender(),i&&(this.clipIdToAction[t].paused=!0)}},ER=new WeakMap,IRe=class extends Bw{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,i,r){let n=new VL(this.manager);n.setPath(this.path),n.setResponseType("arraybuffer"),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials),n.load(e,s=>{this.decodeDracoFile(s,t).catch(r)},i,r)}decodeDracoFile(e,t,i,r){let n={attributeIDs:i||this.defaultAttributeIDs,attributeTypes:r||this.defaultAttributeTypes,useUniqueIDs:!!i};return this.decodeGeometry(e,n).then(t)}decodeGeometry(e,t){let i=JSON.stringify(t);if(ER.has(e)){let o=ER.get(e);if(o.key===i)return o.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let r,n=this.workerNextTaskID++,s=e.byteLength,a=this._getWorker(n,s).then(o=>(r=o,new Promise((l,c)=>{r._callbacks[n]={resolve:l,reject:c},r.postMessage({type:"decode",id:n,taskConfig:t,buffer:e},[e])}))).then(o=>this._createGeometry(o.geometry));return a.catch(()=>!0).then(()=>{r&&n&&this._releaseTask(r,n)}),ER.set(e,{key:i,promise:a}),a}_createGeometry(e){let t=new Bt;e.index&&t.setIndex(new $t(e.index.array,1));for(let i=0;i<e.attributes.length;i++){let r=e.attributes[i],n=r.name,s=r.array,a=r.itemSize;t.setAttribute(n,new $t(s,a))}return t}_loadLibrary(e,t){let i=new VL(this.manager);return i.setPath(this.decoderPath),i.setResponseType(t),i.setWithCredentials(this.withCredentials),new Promise((r,n)=>{i.load(e,r,void 0,n)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;let e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(i=>{let r=i[0];e||(this.decoderConfig.wasmBinary=i[1]);let n=LRe.toString(),s=["/* draco decoder */",r,"","/* worker */",n.substring(n.indexOf("{")+1,n.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([s]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){let r=new Worker(this.workerSourceURL);r._callbacks={},r._taskCosts={},r._taskLoad=0,r.postMessage({type:"init",decoderConfig:this.decoderConfig}),r.onmessage=function(n){let s=n.data;switch(s.type){case"decode":r._callbacks[s.id].resolve(s);break;case"error":r._callbacks[s.id].reject(s);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+s.type+'"')}},this.workerPool.push(r)}else this.workerPool.sort(function(r,n){return r._taskLoad>n._taskLoad?-1:1});let i=this.workerPool[this.workerPool.length-1];return i._taskCosts[e]=t,i._taskLoad+=t,i})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}};function LRe(){let e,t;onmessage=function(a){let o=a.data;switch(o.type){case"init":e=o.decoderConfig,t=new Promise(function(u){e.onModuleLoaded=function(h){u({draco:h})},DracoDecoderModule(e)});break;case"decode":let l=o.buffer,c=o.taskConfig;t.then(u=>{let h=u.draco,d=new h.Decoder,p=new h.DecoderBuffer;p.Init(new Int8Array(l),l.byteLength);try{let f=i(h,d,p,c),v=f.attributes.map(g=>g.array.buffer);f.index&&v.push(f.index.array.buffer),self.postMessage({type:"decode",id:o.id,geometry:f},v)}catch(f){console.error(f),self.postMessage({type:"error",id:o.id,error:f.message})}finally{h.destroy(p),h.destroy(d)}});break}};function i(a,o,l,c){let u=c.attributeIDs,h=c.attributeTypes,d,p,f=o.GetEncodedGeometryType(l);if(f===a.TRIANGULAR_MESH)d=new a.Mesh,p=o.DecodeBufferToMesh(l,d);else if(f===a.POINT_CLOUD)d=new a.PointCloud,p=o.DecodeBufferToPointCloud(l,d);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!p.ok()||d.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+p.error_msg());let v={index:null,attributes:[]};for(let g in u){let m=self[h[g]],x,w;if(c.useUniqueIDs)w=u[g],x=o.GetAttributeByUniqueId(d,w);else{if(w=o.GetAttributeId(d,a[u[g]]),w===-1)continue;x=o.GetAttribute(d,w)}v.attributes.push(n(a,o,d,g,m,x))}return f===a.TRIANGULAR_MESH&&(v.index=r(a,o,d)),a.destroy(d),v}function r(a,o,l){let c=l.num_faces()*3,u=c*4,h=a._malloc(u);o.GetTrianglesUInt32Array(l,u,h);let d=new Uint32Array(a.HEAPF32.buffer,h,c).slice();return a._free(h),{array:d,itemSize:1}}function n(a,o,l,c,u,h){let d=h.num_components(),p=l.num_points()*d,f=p*u.BYTES_PER_ELEMENT,v=s(a,u),g=a._malloc(f);o.GetAttributeDataArrayForAllPoints(l,h,v,f,g);let m=new u(a.HEAPF32.buffer,g,p).slice();return a._free(g),{name:c,array:m,itemSize:d}}function s(a,o){switch(o){case Float32Array:return a.DT_FLOAT32;case Int8Array:return a.DT_INT8;case Int16Array:return a.DT_INT16;case Int32Array:return a.DT_INT32;case Uint8Array:return a.DT_UINT8;case Uint16Array:return a.DT_UINT16;case Uint32Array:return a.DT_UINT32}}}var Pd;function ORe(){return Pd||(Pd=new IRe,Pd.setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.2/").preload()),Pd.decoderPending}async function zRe(e){if(Pd){let t={attributeIDs:Pd.defaultAttributeIDs,attributeTypes:Pd.defaultAttributeTypes,useUniqueIDs:!1},i;try{i=await Pd.decodeGeometry(new Int8Array(e).buffer,t)}catch(r){console.error(r)}if(i)return{index:i.index?{array:i.index.array}:void 0,attributes:Object.entries(i.attributes).map(([r,n])=>({name:r,itemSize:n.itemSize,array:n.array}))}}return null}async function NRe(e,t){let[i,r]=lK(iO.deserialize(new Uint8Array(e)));return LK(i),r.result().data}function BRe(e){let t=[];return e.scene.objects.traverse((i,r)=>{r.type==="Mesh"&&r.geometry.type==="NonParametricGeometry"&&r.geometry.data.draco!==void 0&&t.push(r)}),t}async function kRe(e){for(let t of e){let i=await zRe(t.geometry.data.draco);if(i){let r=t.geometry.data;i.index&&(r.index={array:i.index.array,itemSize:1,normalized:!1,type:"Uint32Array"});let n={};i.attributes.forEach(({name:s,array:a,itemSize:o})=>{n[s]={array:a,itemSize:o,type:"Float32Array",normalized:!1}}),r.attributes=n,r.draco=void 0}}}var URe=class{constructor(){this._clickCount=0,this._lastTime=0,this._lastPosition=[0,0],this._delay=500,this._distance=2,this._onMouseDown=e=>{let t=[e.clientX,e.clientY],i=new Date().getTime();if(this._clickCount>0){let r=t[0]-this._lastPosition[0],n=t[1]-this._lastPosition[1];Math.sqrt(r*r+n*n)>this._distance&&(this._clickCount=0)}this._lastPosition=t,this._clickCount=i-this._lastTime>this._delay?1:this._clickCount+1,this._lastTime=i},this._onMouseUp=e=>{}}start(e,t=500,i=2){this._target&&this.stop(),this.reset(),this._delay=t,this._distance=i,this._target=e,this._target.addEventListener("pointerdown",this._onMouseDown,!1),this._target.addEventListener("pointerup",this._onMouseUp,!1)}stop(){this._target&&(this._target.removeEventListener("pointerdown",this._onMouseDown,!1),this._target.removeEventListener("pointerup",this._onMouseUp,!1),this._target=void 0)}get clickCount(){return this._clickCount}reset(){this._clickCount=0,this._lastTime=0,this._lastPosition=[0,0]}},FRe=class{constructor(e,t,i,r,n,s,a,o){this.eventId=e,this.id=t,this.data=i,this.dataEvent=r,this.object=n,this.stage=!1,this.actions=hs(r,i.actions,s,a,o,n)}disconnect(){as(this.actions)}dispatchIn(){this.actions.Audio.forEach(e=>e.dispatchBasic()),this.actions.Particles.forEach(e=>e.dispatchBasic()),this.actions.Video.forEach(e=>e.dispatchBasic()),this.actions.Create.forEach(e=>e.dispatch()),this.actions.Destroy.forEach(e=>e.dispatch()),this.actions.Reset.forEach(e=>e.dispatch()),this.actions.Link.forEach(e=>e.dispatch()),this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),this.actions.Transition.forEach(e=>e.toggle()),this.actions.Animation.forEach(e=>e.play()),this.actions.SwitchCamera.forEach(e=>e.play()),this.actions.SceneTransition.forEach(e=>e.dispatch()),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.ClearLocalStorage.forEach(e=>e.dispatch()),this.actions.UserAPI.forEach(e=>e.dispatch())}dispatchOut(){this.actions.Transition.forEach(e=>{e.toggle()})}},VRe=class extends qa{constructor(e,t){super(e),this.eventManager=t,this.breakpoints=[],this.resize=(i,r)=>{this.breakpoints.forEach(n=>{let s=aO.deviceToSize(n.data.size),a=n.dataEvent.orientation==="horizontal"?i:r,o;switch(n.data.operator){case"<":o=a<s[0];break;case">":o=a>s[0];break;case"<>":o=a>s[0]&&a<s[1];break}n.stage!==o&&(n.stage=o,n.stage?n.dispatchIn():n.dispatchOut())})},this.onResizeObserver=new ResizeObserver(i=>{for(let r of i){let{width:n,height:s}=r.contentRect;this.resize(n,s)}})}connect(){let{page:e,sharedAssets:t,domElement:i}=this.eventContext;this.onResizeObserver.observe(i);let r=n=>{var s;if(!(!n.visible||!((s=n.data)!=null&&s.events.length)))for(let{data:a,id:o}of n.data.events)a.disabled||a.type==="Resize"&&a.breakpoints.forEach(({data:l,id:c})=>{try{let u=new FRe(o,c,l,a,n,e,t,this.eventManager);this.breakpoints.push(u)}catch{}})};e.traverseEntity(n=>{var s;(n instanceof js||n instanceof es)&&((s=n.frame)==null||s.traverse(a=>{r(a)})),r(n)})}disconnect(){this.onResizeObserver.disconnect(),this.breakpoints.forEach(e=>{e.disconnect()}),this.breakpoints=[]}},HRe=class extends qa{constructor(e,t){super(e),this.eventManager=t,this.userAPIs={},this.events=[],this.onSuccess=({userAPIId:i})=>{this.events.forEach(r=>{r.data.userAPIId===i&&r.dispatchSuccess()})},this.onError=({userAPIId:i})=>{this.events.forEach(r=>{r.data.userAPIId===i&&r.dispatchError()})},this.userAPIs=e.sharedAssets.getUserAPIs()}connect(){this.eventContext.page.traverseEntity(e=>{var t;(t=e.data)==null||t.events.filter(i=>i.data.type==="API"&&!i.data.disabled).forEach(i=>{this.events.push(new GRe(i.id,i.data,e,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))})}),Object.entries(this.userAPIs).forEach(([e,t])=>{t.on("success",this.onSuccess),t.on("error",this.onError),t.autostart&&t.callUserAPI(this.eventContext.sharedAssets)})}disconnect(){Object.entries(this.userAPIs).forEach(([e,t])=>{t.off("success",this.onSuccess),t.off("error",this.onError)})}},GRe=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.successActions=hs(t,t.successActions,r,n,s,i),this.errorActions=hs(t,t.errorActions,r,n,s,i)}dispatchSuccess(){this.dispatchActions(this.successActions)}dispatchError(){this.dispatchActions(this.errorActions)}dispatchActions(e){e.Audio.forEach(t=>t.dispatchConditional()),e.Particles.forEach(t=>t.dispatchConditional()),e.Video.forEach(t=>t.dispatchConditional()),e.Create.forEach(t=>t.dispatch()),e.Destroy.forEach(t=>t.dispatch()),e.Reset.forEach(t=>t.dispatch()),e.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this),t.init()}),e.Transition.forEach(t=>t.play()),e.Animation.forEach(t=>t.play()),e.SwitchCamera.forEach(t=>t.play()),e.SceneTransition.forEach(t=>t.dispatch()),e.SetVariable.forEach(t=>t.checkConditions()),e.SetVariable.forEach(t=>t.dispatch()),e.DynamicVariablePlay.forEach(t=>t.dispatch()),e.ClearLocalStorage.forEach(t=>t.dispatch()),e.UserAPI.forEach(t=>t.dispatch())}},jRe=class extends qa{constructor(e,t){super(e),this.eventManager=t,this.userWebhooks={},this.events=[],this.onMessage=({userWebhookId:i})=>{this.events.forEach(r=>{r.data.userWebhookId===i&&r.dispatch()})},this.userWebhooks=e.sharedAssets.getUserWebhooks()}connect(){this.eventContext.page.traverseEntity(e=>{var t;(t=e.data)==null||t.events.filter(i=>i.data.type==="WEBHOOK"&&!i.data.disabled).forEach(i=>{this.events.push(new WRe(i.id,i.data,e,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))})}),Object.entries(this.userWebhooks).forEach(([e,t])=>{t.connect(),t.on("message",this.onMessage)})}disconnect(){Object.entries(this.userWebhooks).forEach(([e,t])=>{t.off("message",this.onMessage),t.disconnect()})}},WRe=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.actions=hs(t,t.actions,r,n,s,i)}dispatch(){let e=this.actions;e.Audio.forEach(t=>t.dispatchConditional()),e.Particles.forEach(t=>t.dispatchConditional()),e.Video.forEach(t=>t.dispatchConditional()),e.Create.forEach(t=>t.dispatch()),e.Destroy.forEach(t=>t.dispatch()),e.Reset.forEach(t=>t.dispatch()),e.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this),t.init()}),e.Transition.forEach(t=>t.play()),e.Animation.forEach(t=>t.play()),e.SwitchCamera.forEach(t=>t.play()),e.SceneTransition.forEach(t=>t.dispatch()),e.SetVariable.forEach(t=>t.checkConditions()),e.SetVariable.forEach(t=>t.dispatch()),e.DynamicVariablePlay.forEach(t=>t.dispatch()),e.ClearLocalStorage.forEach(t=>t.dispatch()),e.UserAPI.forEach(t=>t.dispatch())}};function XRe(){let e=document.createElement("textarea");return e.style.position="fixed",e.style.top="200px",e.style.left="400px",e.style.zIndex="-1",e.style.border="1px solid rgba(255,0,0,0.5)",e.style.width="10px",e.style.height="500px",e.style.color="white",e.style.opacity="0.5",e.style.background="transparent",e.style.display="none",e.style.margin="0px",e.style.padding="0px",e.style.boxSizing="content-box",e.style.pointerEvents="none",e}var qRe=new B(0,0,1),jW=new B,WW=new B,XW=new Mn,YRe=class{constructor(e,t,i,r,n){this.containerScene=e,this.raycaster=t,this.sharedAssets=i,this.requestRender=r,this.onExit=n,this.htmlInput=null,this.virtualInput=null,this.helper=new a$,this.doubleClickHandler=new URe,this.isDragging=!1,this.plane=new Ia,this.caretInterval=0,this.planeIntersection=new B,this.projected=new ve,this._lastIndex=0,this._isFirstDragMove=!1,this.selectionOnDragStart=0,this.onTextMaterialChanged=()=>{var a;let s=(a=this.virtualInput)==null?void 0:a.data;if(this.virtualInput!==void 0&&s){let o=s.material,l=typeof o=="string"?this.sharedAssets.data.materials[o]:o,c=l2e(l,this.sharedAssets);this.helper.setCaretColor(c)}},this.stopAnimateTextCursor=()=>{clearInterval(this.caretInterval),this.helper&&(this.helper.caretMesh.visible=!1)},this.startAnimateTextCursor=()=>{this.stopAnimateTextCursor(),this.helper&&(this.helper.caretMesh.visible=!0,this.caretInterval=setInterval(()=>{this.helper&&(this.helper.caretMesh.visible=!this.helper.caretMesh.visible),this.requestRender()},600))},this.handleCaretUpdate=s=>{if(!this.htmlInput||!this.virtualInput)return;let a=this.helper,o=(s==null?void 0:s.key)==="ArrowLeft"||(s==null?void 0:s.key)==="ArrowRight",l=(s==null?void 0:s.key)==="ArrowUp"||(s==null?void 0:s.key)==="ArrowDown";this.htmlInput.selectionStart===this.htmlInput.selectionEnd?(a.setCaretPosition(this.htmlInput.selectionStart,{horizontalKeyMove:o,verticalKeyMove:l}),this.startAnimateTextCursor()):a.setSelection(this.htmlInput.selectionStart,this.htmlInput.selectionEnd),this.requestRender()},this.containerScene.add(this.helper)}createInput(){return this.htmlInput=XRe(),this.htmlInput}connect(){}disconnect(){var e;this.stopAnimateTextCursor(),this.helper.hide(),(e=this.htmlInput)==null||e.remove(),this.doubleClickHandler.stop()}handleMouseDown(){var s;if(!this.htmlInput||!this.virtualInput)return!0;this.getPointOnPlane();let e=this.doubleClickHandler.clickCount,{index:t,lineIndex:i,characterIndex:r}=this.helper.getSelectionFromPosition(this.projected.x,this.projected.y,e>1?"inside":"previous")??{index:0,lineIndex:0,characterIndex:0};((s=this.virtualInput)==null?void 0:s.wrappedText[i][Math.max(0,r-1)])===`
`&&(t--,r--),this._lastIndex=t,this._isFirstDragMove=!0;let n=this.checkClickedObject();if(e===1){if(n===null)return this.onExit(this.virtualInput),!0;this.selectionOnDragStart=t,this.isDragging=!0,this.setInputSelection(t)}else n===this.virtualInput&&(e===2?this.selectClosestWord(i,r):e>2&&(this.setInputSelection(0,this.htmlInput.value.length),this.doubleClickHandler.reset()))}handleMouseUp(){this.applyRangeToTextInput(),this.isDragging=!1,this._isFirstDragMove=!1}handleMouseMove(){!this.virtualInput||(this._isFirstDragMove&&this.doubleClickHandler.clickCount>1&&(this.selectionOnDragStart=this._lastIndex,this.isDragging=!0,this.setInputSelection(this._lastIndex)),this._isFirstDragMove=!1,this.getPointOnPlane(),this.applyRangeToTextInput())}focus(e){var t;if(this.virtualInput=e,this.updateTextInputStyles(),this.htmlInput)if(e){let i=(t=this.data)==null?void 0:t.geometry.text;this.htmlInput.value=typeof i=="string"?"":(i==null?void 0:i.textValue.toString())??""}else this.htmlInput.value=""}blur(){}get data(){let{virtualInput:e}=this;if(e)return e.dataPatched}applyRangeToTextInput(){var n;if(!this.isDragging||!this.virtualInput||!this.htmlInput)return;let e=this.selectionOnDragStart,{index:t,lineIndex:i,characterIndex:r}=this.helper.getSelectionFromPosition(this.projected.x,this.projected.y,this.doubleClickHandler.clickCount>2?"inside":"previous")??{index:0};i!==void 0&&r!==void 0&&((n=this.virtualInput)==null?void 0:n.wrappedText[i][r-1])===`
`&&t--,this.htmlInput.setSelectionRange(Math.min(e,t),Math.max(e,t))}checkClickedObject(){if(this.virtualInput){let e=this.raycaster.intersectObject(this.virtualInput,!1);if(e.length>0){let t=e[0];if(t.object instanceof Tk)return t.object}}return null}selectClosestWord(e,t){if(!this.virtualInput)return;let i=this.virtualInput.wrappedText,r=i[e],n=t+1,s=t;r[t]!==" "&&(n=this.findNextCharOccurence(r,t,"forward"," "),s=this.findNextCharOccurence(r,t,"backward"," "),s>0&&s++,n>=r.length-1&&e===i.length-1&&n++);let a=this.helper,o=a.getGlobalIndexFromLineAndCharIndexes(i,e,s),l=a.getGlobalIndexFromLineAndCharIndexes(i,e,n);this.setInputSelection(o,l)}findNextCharOccurence(e,t,i,r=" "){let n=Math.max(0,e.length-1),s=i==="forward"?n:0,a=i==="forward"?1:-1,o=Math.max(Math.min(t,n),0);for(;o!==s;)if(o+=a,e.charAt(o)===r)return o;return s}getPointOnPlane(){var t;let e=(t=this.virtualInput)==null?void 0:t.data;if(!(!this.virtualInput||!e)&&this.raycaster.ray.intersectsPlane(this.plane)){this.planeIntersection===null&&(this.planeIntersection=new B);let i=this.raycaster.ray.intersectPlane(this.plane,this.planeIntersection);if(i){this.planeIntersection.copy(this.virtualInput.worldToLocal(i));let r=typeof e.geometry.width=="number"?e.geometry.width:1,n=typeof e.geometry.height=="number"?e.geometry.height:1;this.projected.set(i.x+r*.5,i.y-n*.5)}}}updatePlane(){var t;let e=(t=this.virtualInput)==null?void 0:t.data;this.virtualInput&&e&&(XW.getNormalMatrix(this.virtualInput.matrixWorld),jW.copy(qRe).applyMatrix3(XW).normalize(),this.virtualInput.localToWorld(WW.set(0,0,e.geometry.depth)),this.plane.setFromNormalAndCoplanarPoint(jW,WW))}setInputSelection(e,t=e){var i;(i=this.htmlInput)==null||i.setSelectionRange(e,t),setTimeout(()=>{var r;(r=this.htmlInput)==null||r.focus()})}updateTextInputStyles(){var t;let e=(t=this.virtualInput)==null?void 0:t.data;this.virtualInput&&e&&this.htmlInput&&(this.htmlInput.style.fontSize=e.geometry.fontSize+"px",this.htmlInput.style.letterSpacing=e.geometry.letterSpacing*e.geometry.fontSize+"px",this.htmlInput.style.lineHeight=e.geometry.fontSize*e.geometry.lineHeight+"px",this.htmlInput.style.width=e.geometry.width+"px",this.htmlInput.style.height=e.geometry.height+"px",this.htmlInput.style.textAlign=QRe(e.geometry.horizontalAlign))}};function QRe(e){return e===4?"justify":e===2?"right":e===3?"center":"left"}var gJ=(e,t)=>{if(typeof e=="string"){let i=t.data(e);if(i)return gJ(i.value,t)}return Ss.getDisplayedValue(e)};function qW(e,t){let i=e.text,r="";if(typeof i=="string"){let n=t.variables.data(r);n&&(r=gJ(n.value,t.variables))}else r=i.textValue.toString();return r}var KRe=class extends qa{constructor(e,t){super(e),this.eventManager=t,this._textInputs=[],this.sceneHelpers=new Uc,this.helper=new a$,this._onMouseDownFocusIn=i=>{if(Yt.length>1)return;this.eventContext.updateRaycaster(i);let r=null;if(this.eventContext.raycaster){for(let n of this._textInputs)if(this.eventContext.raycaster.intersectObject(n,!0).length>0){r=n;break}}this.focusOnTextInput(r),this._onCaretUpdate(),this._onMouseUp(),this.textInputManager.doubleClickHandler.start(this.eventContext.domElement),this.textInputManager.doubleClickHandler._onMouseDown(i),this._onMouseDown(i)},this.onExit=()=>{let{virtualInput:i}=this.textInputManager;if(i===null)return;let r=this.textInputManager.htmlInput;this.helper.hide(),r==null||r.setSelectionRange(r.value.length,r.value.length),this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!0);let{domElement:n}=this.eventContext;n.removeEventListener("pointerdown",this._onMouseDown,!1),n.removeEventListener("pointerup",this._onMouseUp,!1),n.removeEventListener("pointermove",this._onMouseMove,!1),window.removeEventListener("keydown",this._onKeyPress),this.textInputManager.doubleClickHandler.reset(),n.addEventListener("pointerdown",this._onMouseDownFocusIn),this.eventContext.renderer.sceneHelpersOnTop=void 0,this.eventContext.renderer.pipeline.disableHelpers()},this._onMouseDown=i=>{this.eventContext.updateRaycaster(i),this.textInputManager.handleMouseDown(),this.textInputManager.virtualInput&&this.eventContext.raycaster.intersectObject(this.textInputManager.virtualInput,!0).length>0&&this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!1)},this._onMouseUp=()=>{this.textInputManager.handleMouseUp(),this.eventManager.controlsManager.orbitControls&&!this.eventManager.controlsManager.orbitControls.enabled&&(this.eventManager.controlsManager.orbitControls.enabled=!0)},this._onMouseMove=i=>{this.eventContext.updateRaycaster(i),this.textInputManager.handleMouseMove()},this._onTextEdit=i=>{let{htmlInput:r,virtualInput:n,helper:s}=this.textInputManager;if(!r||!n)return;let a=r.value;n.textGeometry.setText(a).then(()=>{this.eventContext.requestRender()});let o=n.data;s.update();let l=o.geometry.text;if(typeof l=="string"){let c=l;this.eventContext.sharedAssets.updateVariable(c,{textValue:a})}this.textInputManager.updateTextInputStyles(),this._onCaretUpdate()},this._onCaretUpdate=i=>{this.textInputManager.handleCaretUpdate(i)},this._onKeyPress=i=>{i.key==="Escape"&&this.onExit()},this.textInputManager=new YRe(this.sceneHelpers,e.raycaster,e.sharedAssets,e.requestRender,this.onExit)}connect(){let e=[];if(this.eventContext.scene.traverseEntity(r=>{r instanceof Tk&&e.push(r)}),this._textInputs=e,e.length===0)return;let{domElement:t}=this.eventContext;t.addEventListener("pointerdown",this._onMouseDownFocusIn),this.textInputManager.connect();let i=this.textInputManager.createInput();document.body.appendChild(i),i.style.display="none",i.addEventListener("keyup",this._onCaretUpdate),i.addEventListener("keydown",this._onCaretUpdate),i.addEventListener("beforeinput",this._onCaretUpdate),i.addEventListener("paste",this._onCaretUpdate),i.addEventListener("cut",this._onCaretUpdate),i.addEventListener("select",this._onCaretUpdate),i.addEventListener("selectstart",this._onCaretUpdate)}disconnect(){let e=this.textInputManager.htmlInput,{domElement:t}=this.eventContext;t.removeEventListener("pointerdown",this._onMouseDownFocusIn),e==null||e.removeEventListener("keyup",this._onCaretUpdate),e==null||e.removeEventListener("keydown",this._onCaretUpdate),e==null||e.removeEventListener("beforeinput",this._onCaretUpdate),e==null||e.removeEventListener("paste",this._onCaretUpdate),e==null||e.removeEventListener("cut",this._onCaretUpdate),e==null||e.removeEventListener("select",this._onCaretUpdate),e==null||e.removeEventListener("selectstart",this._onCaretUpdate),this._textInputs.forEach(i=>{let r=qW(i.data.geometry,this.eventContext.sharedAssets.data);i.textGeometry.setText(r)}),t.removeEventListener("pointerdown",this._onMouseDown,!1),t.removeEventListener("pointerup",this._onMouseUp,!1),t.removeEventListener("pointermove",this._onMouseMove,!1),window.addEventListener("keydown",this._onKeyPress),this.eventContext.renderer.sceneHelpersOnTop=void 0,this.eventContext.renderer.pipeline.disableHelpers(),this.textInputManager.disconnect()}focusOnTextInput(e){this.textInputManager.focus(e),this.textInputManager.onTextMaterialChanged();let t=this.textInputManager.htmlInput;if(!t||e===null)return;this.textInputManager.updateTextInputStyles(),this.eventContext.renderer.sceneHelpersOnTop=this.sceneHelpers,this.eventContext.renderer.pipeline.enableHelpers(),this.textInputManager.isDragging=!1;let i=qW(e.textGeometry.userData.parameters,this.eventContext.sharedAssets.data);t.value=i,t.setSelectionRange(0,0),this.textInputManager.helper.show(e),t.style.display="block",t.addEventListener("input",this._onTextEdit),this.textInputManager.updatePlane();let{domElement:r}=this.eventContext;r.removeEventListener("pointerdown",this._onMouseDownFocusIn),r.addEventListener("pointerdown",this._onMouseDown,!1),r.addEventListener("pointerup",this._onMouseUp,!1),r.addEventListener("pointermove",this._onMouseMove,!1),window.addEventListener("keydown",this._onKeyPress)}},ZRe=class{constructor(e,t,i,r,n){this.publish=e,this.controlsManager=t,this.animationControls=i,this.eventContext=r,this.sharedVariables=n,this.isEnabled=!1,this.activateCount=0,this.needsMouse=!1,this.needsRaycast=!1,this.onTouchMovePreventScroll=s=>{let a=window.parent!==window,o=document.documentElement.scrollHeight>document.documentElement.clientHeight||document.documentElement.scrollWidth>document.documentElement.clientWidth;(s.touches.length>1||this.preventTouchScroll||a===!1&&o===!1)&&s.preventDefault()},this.onMouseWheelPreventScroll=s=>{this.preventScroll&&s.preventDefault()},this.onMouseMove=s=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(s),pressed:s.buttons>0}},this.onMouseDown=s=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(s),pressed:!0}},this.onMouseUp=s=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(s),pressed:!1}},this.getMousePosition=s=>{var c;let{domRect:a}=this.eventContext,{pageX:o,pageY:l}=((c=s.touches)==null?void 0:c.length)>0?s.touches[0]:s;return{x:o-(a.left+window.scrollX),y:l-(a.top+window.scrollY)}},this.stopRaycast=e.stopRaycast,this.preventScroll=e.preventScroll,this.preventTouchScroll=e.preventTouchScroll,this.hideCursor=e.hideCursor,this.requestRender=r.requestRender}activate(){if(this.isEnabled)return;this.isEnabled=!0,this.initializeActionsDependentStates(),this.needsMouse&&(this.eventContext.domElement.addEventListener("pointermove",this.onMouseMove),this.eventContext.domElement.addEventListener("pointerdown",this.onMouseDown)),this.handlers={Spline:new T3e(this.eventContext),VariableChange:new aRe(this.eventContext,this.sharedVariables,this,this.needsMouse,this.needsRaycast),API:new HRe(this.eventContext,this),WEBHOOK:new jRe(this.eventContext,this),Conditional:new z3e(this.eventContext,this),Start:new nRe(this.eventContext,this),Basic:new D3e(this.eventContext,this,this.needsRaycast),MouseHover:new J3e(this.eventContext,this),Scroll:new iRe(this.eventContext,this),Follow:new W3e(this.eventContext,this),DragDrop:new F3e(this.eventContext,this),LookAt:new K3e(this.eventContext),Resize:new VRe(this.eventContext,this),Textfields:new KRe(this.eventContext,this)};let{page:e,domElement:t}=this.eventContext;this.hideCursor&&(t.style.cursor="none"),e.traverseEntity(i=>{i.addEventListener("requestRender",this.requestRender)}),Object.values(this.handlers).forEach(i=>i.connect()),t.addEventListener("wheel",this.onMouseWheelPreventScroll),t.addEventListener("touchmove",this.onTouchMovePreventScroll),this.activateCount++}deactivate(){var i;if(!this.isEnabled)return;this.isEnabled=!1,this.eventContext.domElement.removeEventListener("pointermove",this.onMouseMove),this.eventContext.domElement.removeEventListener("pointerdown",this.onMouseDown),this.eventContext.domElement.removeEventListener("pointerup",this.onMouseUp),this.eventContext.sharedAssets.mouseProperty=null,this.eventContext.sharedAssets.raycastProperty=null;let{page:e,domElement:t}=this.eventContext;t.style.cursor="",Object.values(this.handlers).forEach(r=>r.disconnect()),(i=this.controlsManager.gameControl)==null||i.disposeActions(),this.controlsManager.disconnectEvents(),e.traverseEntity(r=>{r.removeEventListener("requestRender",this.requestRender),r.destroyedInAction=!1}),t.removeEventListener("touchmove",this.onTouchMovePreventScroll),t.removeEventListener("wheel",this.onMouseWheelPreventScroll),this.animationControls.onExitPlayMode()}get isPaused(){return this.isEnabled}pause(){this.deactivate()}resume(){this.activate()}reset(){this.deactivate(),this.activate(),this.controlsManager.page.updateMatrixWorld(!0),this.controlsManager.rebuildBVH()}updateUseWindowEvents(e){let t=this.isEnabled;t&&this.deactivate(),this.eventContext.useWindowEvents=e,t&&this.activate()}initializeActionsDependentStates(){let e=this.eventContext.sharedAssets;e.resetDynamicVariablePlayState();let t=i=>{if(i.data.type==="Conditional"&&(i.data.ifActions.forEach(t),i.data.elseActions.forEach(t)),i.data.type==="Conditional"||i.data.type==="SetVariable")for(let r of i.data.type==="Conditional"?i.data.condition:i.data.expression)"id"in r&&Array.isArray(r.id)&&(r.id[0]==="mouse"&&(this.needsMouse=!0),r.id[0]==="raycast"&&(this.needsRaycast=!0));i.data.type==="DynamicVariablePlay"&&i.data.variableId!==""&&(i.data.mode==="Play"||i.data.mode==="PlayPause"||i.data.mode==="Toggle")&&e.setDynamicVariablePlayState(i.data.variableId,"Stopped")};this.eventContext.page.traverseEntity(i=>{var r;if((r=i.data)!=null&&r.events.length)for(let n of i.data.events)if(n.data.type==="VariableChange"&&(n.data.variableId==="mouseProperty"&&(this.needsMouse=!0),n.data.variableId==="raycastProperty"&&(this.needsRaycast=!0)),n.data.type==="Conditional")for(let s of["inActions","outActions"])n.data[s].forEach(t);else if(n.data.type==="DragDrop")for(let s of["drag","drop"])n.data.dragDropActions[s].forEach(t);else if(n.data.type==="GameControl")for(let s of["idle","move","jump","run"])n.data.gameActions[s].forEach(t);else if(n.data.type==="Resize")for(let s of n.data.breakpoints)s.data.actions.forEach(t);else n.data.type==="LookAt"||n.data.type==="API"||n.data.actions.forEach(t)})}},$Re=class{constructor(e,t,i,r,n){this._aspect=1,this.enableResponsive=!1,this._renderer=e,this._camera=t,this._frameSize=new ve().copy(i),this._editorSize=new ve().copy(r),this._aspect=t.aspect,this._fov=n??t.fov}set frameSize(e){this._frameSize.copy(e)}updateRenderer(){!this._renderer||this._renderer.setSize(this._frameSize.x,this._frameSize.y)}updateViewport(){if(!this._renderer||!this._camera||this._camera.cameraType!=="PerspectiveCamera")return;let e=this._frameSize.x,t=this._frameSize.y,i=this._editorSize.y;this._aspect=e/t,t<=i&&(this._camera.zoom*=i/t),this._renderer.setViewport(0,0,e,t)}updateCamera(e=!0){if(this._camera)if(this._camera.cameraType==="PerspectiveCamera"){let t=this._frameSize.y,i=this._editorSize.y,r=this._fov;if(e&&t>i){let n=JRe(t,1080,2160,1,15)/100;r*=t/i,r*=1-n}this._camera.aspect=this._aspect,this._camera.fov=r,this._camera.updateProjectionMatrix()}else this._camera.setViewplaneSize(this._frameSize.x,this._frameSize.y,this.enableResponsive)}setCamera(e){this._camera=e,this._aspect=e.aspect,this._fov=e.fov}revert(){let e=window.innerWidth,t=window.innerHeight;this._renderer&&(this._renderer.setViewport(0,0,e,t),this._renderer.setSize(e,t)),this._camera&&(this._camera.aspect=e/t,this._camera.fov=this._fov,this._camera.setViewplaneSize(e,t,this.enableResponsive),this._camera.updateProjectionMatrix())}};function JRe(e,t,i,r,n){return(e-t)/(i-t)*(n-r)+r}var eIe=class{get sharedAssets(){return this.shared}constructor(e,t={},i=!0){this.shared=new vk(e.shared,t,!0,i),this.scene=new Rk(e.scene,this.sharedAssets),this.shared.setEntityOpContext({scene:this.scene,shared:this.shared})}reset(e,t){this.scene.clearScene(),this.sharedAssets.reset(e.shared),this.scene.resetAfterClear(e.scene,this.sharedAssets)}resetPersonalCameraFromDocumentData(){for(let e of this.scene.children)e instanceof es&&!e.uiScene&&e.personalCamera.updateState(e.data.camera,{scene:this.scene,shared:this.shared})}dispose(){this.scene.dispose(),this.shared.dispose()}gc(){this.shared.geometryCache.startGc(),this.shared.geometryCache2.startGc(),this.scene.traverseEntity(e=>{e instanceof qs&&e.markGeometryAsReachable(this.shared)}),this.shared.geometryCache.endGc(),this.shared.geometryCache2.endGc()}},tIe=class{constructor({x:e=10,y:t=10}){this._startTime=0;let i=document.getElementById("spe-perfs");i?this.element=i:(this.element=document.createElement("div"),document.body.appendChild(this.element),this.element.style.position="absolute",this.element.style.zIndex="10000",this.element.style.fontFamily="monospace",this.element.style.background="black",this.element.style.color="white",this.element.style.padding="10px",this.element.style.opacity="0.5",this.element.style.fontSize="11px",this.element.setAttribute("id","spe-perfs")),this.element.style.left=`${e}px`,this.element.style.top=`${t}px`}dispose(){var e;(e=this.element.parentElement)==null||e.removeChild(this.element)}start(){this._startTime=performance.now()}end(){let e=performance.now()-this._startTime;this.element.innerHTML=e.toFixed(3)+" ms"}};function iIe(e){let t;if(e.index)for(let i=0;i<e.index.array.length;i+=3)t=e.index.array[i],e.index.array[i]=e.index.array[i+2],e.index.array[i+2]=t}function e1(e){return e instanceof $1?"SubdivObject":e.geometry.type==="NonParametricGeometry"?"NonParametric":"Mesh"}function rIe(e,t){let i={};return e.traverseEntity(r=>{var l;if(!r.visible||!(r instanceof wa)||r.type!=="Mesh"||Array.isArray(r.material)||r.states&&Object.keys(r.states).length)return;let n=r.parent;for(;n;){if(n instanceof wa&&r.states&&Object.keys(r.states).length)return;n=n.parent}let s=r.material.uuid,a=t.shared.materials[s];if(a){if(!_s.isMergable(a))return}else{let c=(l=t.scene.objects.get(r.uuid))==null?void 0:l.data;if(c&&"material"in c&&typeof c.material!="string"){if(!_s.isMergable(c.material))return;s=_s.getHash(c.material)}}i[s]||(i[s]={});let o=i[s][e1(r)];if(o){if(o.push(r),r.cloner)for(let c of r.cloner.children)o.push(c)}else if(i[s][e1(r)]=[r],r.cloner)for(let c of r.cloner.children)i[s][e1(r)].push(c)}),i}function nIe(e){let t=0;return Object.values(e).forEach(i=>{Object.values(i).forEach(r=>{let n=r.length;n>t&&(t=n)})}),t}function sIe(e,t){let i=rIe(t,e),r=nIe(i),n=new Array(r),s=0,a=new Array(r),o=0,l=new Array(r),c=0,u=new Array(r),h=0;for(let[d,p]of Object.entries(i))for(let f of Object.values(p)){if(o=0,c=0,f.forEach(g=>{g instanceof wa&&(a[o++]=g.geometry.clone(),l[c++]=g)}),c<2)continue;for(let g=0;g<c;g++)l[g].updateWorldMatrix(!0,!1),a[g].applyMatrix4(l[g].matrixWorld),l[g].matrixWorld.determinant()<0&&iIe(a[g]);let v=df(a.slice(0,o),!1);if(v){let g;switch(d){case"SubdivObject":{console.warn("Turning subdiv object into mesh"),g=new zr(v,l[0].material);break}default:{g=new zr(v,l[0].material);break}}g.castShadow=l[0].castShadow,g.receiveShadow=l[0].receiveShadow,t.add(g);let m=x=>{h=0;for(let w of x)w.children&&m(w.children),w instanceof wa&&(Array.isArray(w.material)||i[w.material.uuid]&&i[w.material.uuid][e1(w)]&&i[w.material.uuid][e1(w)].length>1||(u[h++]=w));for(let w=0;w<h;w++)t.attach(u[w])};for(let x=0;x<c;x++){let w=l[x];m(w.children),n[s++]=w}}}for(let d=0;d<s;d++)n[d].removeFromParent()}var aIe=Sh(Iae(),1),oIe=new ve;function lIe(e){let t="The Spline Runtime only accepts .splinecode files that are generated from Spline export panel.";e.endsWith(".spline")?console.warn(t+" The .spline files are only meant to be used by the Editor."):e.endsWith(".splinecode")||console.warn(t)}var cIe=class{constructor(e,{renderOnDemand:t,renderMode:i="auto"}={}){this._viewportMode=1,this._viewportWidth=window.innerWidth,this._viewportHeight=window.innerHeight,this._proxyObjectCache=new Map,this._variablesCache=new Map,this._isPaused=!1,this._renderRequested=!1,this._skipRender=!1,this.time=performance.now(),this.dt=0,this.currentTAAFrame=0,this.disposed=!1,this._requestRenderAutoMode=()=>{this._skipRender=!1},this.requestRender=()=>{this._renderRequested=!0},this.render=r=>{var n,s,a,o,l,c,u,h,d,p,f,v,g;if(this.time=r,this._lastTime&&(this.dt=this.time-this._lastTime),this._lastTime=this.time,(n=this._perfs)==null||n.start(),!this._renderer){(s=this._perfs)==null||s.end();return}if(!this._isPaused&&(this.renderMode==="manual"&&!this._renderRequested||this.renderMode==="auto"&&this._skipRender)){(a=this._perfs)==null||a.end();return}if(this._renderRequested=!1,this._skipRender=!0,this._controls&&(this._skipRender=this._controls.update(this.dt)),this._eventManager&&((o=this._eventManager.handlers)!=null&&o.Start.hasVideoAction||(l=this._eventManager.handlers)!=null&&l.Basic.hasVideoAction||(c=this._eventManager.handlers)!=null&&c.Conditional.hasVideoAction)&&(this._skipRender=!1),(u=this._animationControls)==null||u.update(this.dt),this._skipRender?(this.currentTAAFrame++,this.currentTAAFrame<32?this._skipRender=!1:this.currentTAAFrame=0):this.currentTAAFrame=0,(h=this._scene)==null||h.traverseVisibleEntity(m=>{m.type==="ParticleSystem"&&(m.update(this.dt),this._skipRender=!1)}),this._scene&&this._scene.activeCamera!==this._camera&&(this._camera=this._scene.activeCamera),(d=this._eventManager)!=null&&d.isEnabled&&(((p=this._eventManager.handlers)==null?void 0:p.Follow).onAnimationFrameDamping(),((f=this._eventManager.handlers)==null?void 0:f.LookAt).onAnimationFrameDamping(),((v=this._eventManager.handlers)==null?void 0:v.DragDrop).onAnimationFrameDamping()),this._scene&&this._camera){if(this._scene.pathConstraints.applyConstraints(this._scene),this._renderer.sceneTransitionTimeRemaining>0){this._renderer.sceneTransitionTimeRemaining-=this.dt;let m=1-this._renderer.sceneTransitionTimeRemaining/this._renderer.sceneTransitionDuration;this._renderer.pipeline.sceneTransitionPass.uniforms.mixRatio.value=m,this._skipRender=!1}else this._renderer.pipeline.sceneTransitionFromTexture=null;this._renderer.renderSplineScene(this._scene,this._camera)}this.canvas.dispatchEvent(this._renderedEvent),(g=this._perfs)==null||g.end()},this._resize=r=>{var n,s,a,o,l,c,u,h,d,p;if(this._renderer){if(this._viewportMode===1&&this._frameView&&(this._frameView.frameSize=oIe.set(this._viewportWidth,this._viewportHeight)),r){let f=this._viewportWidth,v=this._viewportHeight;this._renderer.setSize(f-1,v-1,!1),this._renderer.setSize(f,v,!1)}else this._renderer.setSize(this._viewportWidth,this._viewportHeight,!1);if(this._camera=(n=this._scene)==null?void 0:n.activeCamera,(u=this._scene)==null||u.updateViewPlaneSize(((a=(s=this._frameView)==null?void 0:s.frameSize)==null?void 0:a.x)??this._viewportWidth,((l=(o=this._frameView)==null?void 0:o.frameSize)==null?void 0:l.y)??this._viewportHeight,((c=this._frameView)==null?void 0:c.enableResponsive)??!1),this._camera){let f=Object.values(((h=this._data)==null?void 0:h.frames)??{})[0].preset??"fullscreen";(d=this._frameView)==null||d.setCamera(this._camera),(p=this._frameView)==null||p.updateCamera(f!=="fullscreen"),this._camera.cameraType==="PerspectiveCamera"&&(this._camera.aspect=this._viewportWidth/this._viewportHeight),this._camera.updateProjectionMatrix()}this.eventManager&&(this.eventManager.eventContext.domRect=this.canvas.getBoundingClientRect()),this._requestRenderAutoMode()}},this._debouncedResize=VB(this._resize,10),this._onScroll=r=>{this.eventManager&&(this.eventManager.eventContext.domRect=this.canvas.getBoundingClientRect())},this.canvas=e,this.renderMode=t?"auto":i,this._renderedEvent=new CustomEvent("rendered",{bubbles:!0}),Object.defineProperty(this._renderedEvent,"target",{writable:!1,value:this}),window.location.search.includes("perfs")&&(this._perfs=new tIe({x:10,y:10})),Lwe(e)}async load(e,t,i){lIe(e),this.disposed=!1;let r=await(await fetch(e,i)).arrayBuffer();await this.start(r,{variables:t})}async start(e,{interactive:t=!0,variables:i}={}){var l,c,u,h;if(this.disposed)return;let r=await NRe(e);this._data=r;let n=BRe(r);r.version&&(0,aIe.default)(r.version,"1.9.25")>0&&console.warn("Your .splinecode file is more recent than the library. Please upgrade @splinetool/runtime to the latest version."),await Promise.all([n.length&&ORe(),vj(r)&&xMe(),SAe(r)&&mMe(),j1.physicsEnabled(r.scene.objects)&&kwe(),pj(r)&&eAe(),qj(r)&&CPe(),$Ee(r)&&ZEe(),kj(r)&&w2e(),yRe(r)&&Nwe()].filter(Boolean)),n.length&&await kRe(n),(l=this._eventManager)==null||l.deactivate(),(c=this._controls)==null||c.deactivate(),(u=this._scene)==null||u.dispose();let s=new eIe(r);if(s.resetPersonalCameraFromDocumentData(),this._scene=s.scene,this._sharedAssetsManager=s.sharedAssets,this._camera=this._scene.activeCamera,window.location.search.includes("merge-geometries")){let d=performance.now();sIe(r,s.scene);let p=performance.now();console.log("Merged geometries in ",p-d," ms")}vj(r)&&this._scene.traverse(d=>{Zu(d)&&d.recomputeBoolean()}),this._sharedAssetsManager.setRequestRender(()=>{var d;this._requestRenderAutoMode(),(d=this._scene)==null||d.traverse(p=>{p instanceof Ll&&p.pendingMediaLoad&&p.update()})}),(h=this._scene)==null||h.traverse(d=>{d.type==="ParticleSystem"&&(d.wakeUp(),d.data.autoPlay?d.start():d.stop())});let a=Object.keys(r.shared.fonts).map(d=>this._sharedAssetsManager.getFont(d).loadingPromise);if(Promise.all(a).then(()=>{s.scene.markNeedsUpdateRendererDirty(),this._requestRenderAutoMode()}),pj(r)&&TRe(r)&&await Promise.all(a),kj(r)){let d=[];this._scene.traverseEntity(p=>{(p instanceof js||p instanceof es)&&p.uiCanvas&&d.push(p.uiCanvas)}),await Promise.all(d.map(p=>p.promise))}if(this._scene.rewriteEventsBeforeGoToPlayMode(),jk(this._scene.activePage,this._sharedAssetsManager),!this._renderer&&(this._renderer=new a2e({canvas:this.canvas,antialias:!1,alpha:!0,stencil:!1,depth:!1,powerPreference:"high-performance"}),this._renderer.hdTransmission=r.scene.publish.hdTransmission===!0,this._renderer.setPixelRatio(window.devicePixelRatio),this._renderer.pipeline.enableUIOverlay(),this._renderer.pipeline.addEventListener("smaaloaded",this._requestRenderAutoMode),r.shared.images.SplineWatermark)){let d=this._sharedAssetsManager.getImage("SplineWatermark");await d.loadPromise;let p=d.getTexture(1001);this._renderer.pipeline.setWatermark(p)}qj(r)&&this._scene.initializeSplatViewer(),r.scene.blueNoiseTextureData!==void 0&&this._renderer.pipeline.updateBlueNoiseTexture(r.scene.blueNoiseTextureData);let o=Object.values(r.frames)[0];if(this._frameView?this._frameView.setCamera(this._camera):(o.preset==="fullscreen"?(this._viewportMode=1,this.canvas.style.display="block",this.canvas.parentElement&&(this._viewportWidth=this.canvas.parentElement.clientWidth||300,this.canvas.style.width="100%"),this.canvas.parentElement&&(this._viewportHeight=this.canvas.parentElement.clientHeight||150,this.canvas.style.height="100%")):(this._viewportMode=2,this._viewportWidth=o.size[0],this._viewportHeight=o.size[1],this.canvas.style.width=`${this._viewportWidth}px`,this.canvas.style.height=`${this._viewportHeight}px`),this._renderer.setSize(this._viewportWidth,this._viewportHeight,!1),this._frameView=new $Re(this._renderer,this._camera,new ve(this._viewportWidth,this._viewportHeight),new ve(window.innerWidth,window.innerHeight)),this._frameView.enableResponsive=(o.allowResponsive??!1)&&o.preset==="fullscreen"),t){let d=new A3e(this._renderer,this.data.scene.publish,this._scene,()=>this._scene.activeCamera,this._sharedAssetsManager,this._requestRenderAutoMode,!0,o);this._scene.updateMatrixWorld(!0),this._controls=new PRe(d),this._animationControls=new RRe(this._scene,this._requestRenderAutoMode),this._eventManager=new ZRe(r.scene.publish,this._controls,this._animationControls,d,r.shared.variables),this._eventManager.activate(),this._controls.activate(this._eventManager)}this._resize(),this._scene.activePage.data.postprocessing.depthOfField.enabled&&Promise.all(this._sharedAssetsManager.getImageLoadPromises()).then(()=>{this._resize(!0)}),i!==void 0&&this.setVariables(i),this.dt===0&&(this.render(performance.now()),setTimeout(()=>{var d;(d=this._renderer)==null||d.setAnimationLoop(this.render)},0)),this._resizeObserverTimeout=setTimeout(()=>{!this._resizeObserver&&this.canvas.parentElement&&(this._resizeObserver=new ResizeObserver(()=>{this._viewportWidth=this.canvas.clientWidth,this._viewportHeight=this.canvas.clientHeight,this._debouncedResize()}),this._resizeObserver.observe(this.canvas.parentElement))},300),document.addEventListener("scroll",this._onScroll)}setVariables(e){if(this._data!==void 0){let t=Object.entries(e);for(let[i,r]of t)this.setVariable(i,r)}}setVariable(e,t){var r;let i=this._getVariableByName(e);if(i&&!("dynamicVariableType"in i.data)){let n=t;typeof i.data.value=="number"?n=typeof t=="number"?t:typeof t=="boolean"?t===!0?1:0:parseFloat(t):typeof i.data.value=="boolean"?n=typeof t=="number"?!!t:typeof t=="boolean"?t:t.toLocaleLowerCase()==="false"?!1:!!t:typeof i.data.value!="string"&&i.data.value.textValue!==void 0&&(n=t.toString());let s=typeof n=="string"?{textValue:n}:n;(r=this._sharedAssetsManager)==null||r.updateVariable(i.id,s),this.requestRender(),this._requestRenderAutoMode()}else i===void 0?console.warn(`No variable named ${e} was found in your Spline file. Make sure to create it from Spline editor.`):"dynamicVariableType"in i.data&&console.warn(`Dynamic variables like ${e} cannot be updated from code.`)}getVariables(){let e={};return this._data&&this._data.shared.variables.forEach(t=>{e[t.data.name]===void 0&&(e[t.data.name]=this._getVariableValue(this._sharedAssetsManager.getVariable(t.id)))}),e}getVariable(e){let t=this._getVariableByName(e);if(t){let i=this._sharedAssetsManager.getVariable(t.id);return this._getVariableValue(i)}}_getVariableValue(e){return typeof e!="string"&&Ss.isTextValue(e)?Ss.getDisplayedValue(e):e}_getVariableByName(e){if(this._data){if(this._variablesCache.has(e))return this._variablesCache.get(e);let t=this._data.shared.variables.find(i=>i.data.name===e);return t&&this._variablesCache.set(e,t),t}}findObjectById(e){var i;let t=(i=this._scene)==null?void 0:i.getObjectByProperty("uuid",e);return this._createProxyObject(t)}findObjectByName(e){var i;let t=(i=this._scene)==null?void 0:i.getObjectByName(e);return this._createProxyObject(t)}getAllObjects(){var t;let e=[];return(t=this._scene)==null||t.traverseEntity(i=>{if(i.uuid!==L0&&!this._scene.isInvisibleObjects(i)&&!(i instanceof es)){let r=this._createProxyObject(i);r&&e.push(r)}}),e}getSplineEvents(){var e,t;return((t=(e=this._eventManager)==null?void 0:e.handlers)==null?void 0:t.Spline).splineEvents}emitEvent(e,t){var i;(i=this.findObjectById(t)||this.findObjectByName(t))==null||i.emitEvent(e)}emitEventReverse(e,t){var i;(i=this.findObjectById(t)||this.findObjectByName(t))==null||i.emitEventReverse(e)}addEventListener(e,t){this.canvas.addEventListener(e,t)}removeEventListener(e,t){this.canvas.removeEventListener(e,t)}setZoom(e){var t,i;((t=this._controls)==null?void 0:t.orbitControls)instanceof mJ&&((i=this._controls)==null||i.orbitControls.setZoom(e))}get eventManager(){return this._eventManager}get controls(){return this._controls}setSize(e,t){this._viewportWidth=e,this._viewportHeight=t,this._viewportMode=2,this._resize()}setBackgroundColor(e){var a;let{r:t,g:i,b:r,a:n}={r:0,g:0,b:0,a:1},s=new Es(t,i,r,n);try{s.setStyle(e)}catch{console.error("This is not a valid css color",e)}(a=this._scene)==null||a.activePage.setBackgroundColor(s),this._requestRenderAutoMode()}dispose(){var e,t,i,r,n,s,a;this.disposed=!0,(e=this._eventManager)==null||e.deactivate(),(t=this._scene)==null||t.dispose(),(i=this._sharedAssetsManager)==null||i.dispose(),this._proxyObjectCache.forEach(o=>{EH.unsubscribe(o)}),this._variablesCache.clear(),(r=this._renderer)==null||r.setAnimationLoop(null),(n=this._renderer)==null||n.dispose(),this._renderer=void 0,(s=this._sharedAssetsManager)==null||s.dispose(),this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=void 0),this._resizeObserverTimeout!==void 0&&clearTimeout(this._resizeObserverTimeout),this.canvas.style.width="",this.canvas.style.height="",this.canvas.removeAttribute("width"),this.canvas.removeAttribute("height"),this._frameView&&(this._frameView=void 0),(a=this._controls)==null||a.deactivate(),this.dt=0,Owe(this.canvas),document.removeEventListener("scroll",this._onScroll)}get isStopped(){return this._isPaused}stop(){var e,t,i;this._isPaused||((e=this._renderer)==null||e.setAnimationLoop(null),this._isPaused=!0,(t=this._eventManager)==null||t.pause(),(i=this._controls)!=null&&i.orbitControls&&(this._controls.orbitControls.enabled=!1))}play(){var e,t,i;!this._isPaused||(this._isPaused=!1,(e=this._eventManager)==null||e.resume(),(t=this._controls)!=null&&t.orbitControls&&(this._controls.orbitControls.enabled=!0),(i=this._renderer)==null||i.setAnimationLoop(this.render))}setGlobalEvents(e){var t;(t=this._eventManager)==null||t.updateUseWindowEvents(e)}get data(){return this._data}_createProxyObject(e){var n;if(e==null)return;if(this._proxyObjectCache.has(e.uuid))return this._proxyObjectCache.get(e.uuid);let t;e.traverseAncestors(s=>{s instanceof es&&(t=s.name)});let i={name:e.name,uuid:e.uuid,visible:e.visible,intensity:e.intensity,position:e.position,rotation:e.rotation,scale:e.scale,type:e.data.type,page:t,parentUuid:e.parent instanceof es||e instanceof Rk||(n=e.parent)==null?void 0:n.uuid,emitEvent(s){e.dispatchEvent({type:"userEvent",eventName:s})},emitEventReverse(s){e.dispatchEvent({type:"userEvent",eventName:s,reverse:!0})}},r=EH(i,(s,a)=>{var o;typeof e[s]!="object"&&((o=Object.getOwnPropertyDescriptor(e,s))!=null&&o.writable)&&(e[s]=a),this._requestRenderAutoMode(),e.updateMatrix()});return this._proxyObjectCache.set(e.uuid,r),r}setUIWasmUrl(e){kZ.skiaWasmUrl=e}},uIe="Expected a function",YW=NaN,hIe="[object Symbol]",dIe=/^\s+|\s+$/g,pIe=/^[-+]0x[0-9a-f]+$/i,fIe=/^0b[01]+$/i,mIe=/^0o[0-7]+$/i,gIe=parseInt,vIe=typeof yd=="object"&&yd&&yd.Object===Object&&yd,yIe=typeof self=="object"&&self&&self.Object===Object&&self,xIe=vIe||yIe||Function("return this")(),wIe=Object.prototype,bIe=wIe.toString,_Ie=Math.max,SIe=Math.min,AR=function(){return xIe.Date.now()};function MIe(e,t,i){var r,n,s,a,o,l,c=0,u=!1,h=!1,d=!0;if(typeof e!="function")throw new TypeError(uIe);t=QW(t)||0,Pz(i)&&(u=!!i.leading,h="maxWait"in i,s=h?_Ie(QW(i.maxWait)||0,t):s,d="trailing"in i?!!i.trailing:d);function p(S){var A=r,T=n;return r=n=void 0,c=S,a=e.apply(T,A),a}function f(S){return c=S,o=setTimeout(m,t),u?p(S):a}function v(S){var A=S-l,T=S-c,E=t-A;return h?SIe(E,s-T):E}function g(S){var A=S-l,T=S-c;return l===void 0||A>=t||A<0||h&&T>=s}function m(){var S=AR();if(g(S))return x(S);o=setTimeout(m,v(S))}function x(S){return o=void 0,d&&r?p(S):(r=n=void 0,a)}function w(){o!==void 0&&clearTimeout(o),c=0,r=l=n=o=void 0}function _(){return o===void 0?a:x(AR())}function M(){var S=AR(),A=g(S);if(r=arguments,n=this,l=S,A){if(o===void 0)return f(l);if(h)return o=setTimeout(m,t),p(l)}return o===void 0&&(o=setTimeout(m,t)),a}return M.cancel=w,M.flush=_,M}function Pz(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function EIe(e){return!!e&&typeof e=="object"}function AIe(e){return typeof e=="symbol"||EIe(e)&&bIe.call(e)==hIe}function QW(e){if(typeof e=="number")return e;if(AIe(e))return YW;if(Pz(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=Pz(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=e.replace(dIe,"");var i=fIe.test(e);return i||mIe.test(e)?gIe(e.slice(2),i?2:8):pIe.test(e)?YW:+e}var CIe=MIe;const TIe=v0(CIe);function PIe(e){return t=>{e.forEach(i=>{typeof i=="function"?i(t):i!=null&&(i.current=t)})}}const DIe=[],RIe={width:"100%",height:"100%"},IIe=qe.forwardRef(function({className:e,children:t,debounceTime:i=300,ignoreDimensions:r=DIe,parentSizeStyles:n,enableDebounceLeadingCall:s=!0,resizeObserverPolyfill:a,...o},l){const c=qe.useRef(null),u=qe.useRef(0),[h,d]=qe.useState({width:0,height:0,top:0,left:0}),p=qe.useMemo(()=>{const f=Array.isArray(r)?r:[r];return TIe(v=>{d(g=>Object.keys(g).filter(m=>g[m]!==v[m]).every(m=>f.includes(m))?g:v)},i,{leading:s})},[i,s,r]);return qe.useEffect(()=>{const f=a||window.ResizeObserver,v=new f(g=>{g.forEach(m=>{const{left:x,top:w,width:_,height:M}=(m==null?void 0:m.contentRect)??{};u.current=window.requestAnimationFrame(()=>{p({width:_,height:M,top:w,left:x})})})});return c.current&&v.observe(c.current),()=>{window.cancelAnimationFrame(u.current),v.disconnect(),p.cancel()}},[p,a]),rt.jsx("div",{style:{...RIe,...n},ref:PIe([l,c]),className:e,...o,children:t({...h,ref:c.current,resize:p})})}),LIe=qe.forwardRef(({scene:e,style:t,onSplineMouseDown:i,onSplineMouseUp:r,onSplineMouseHover:n,onSplineKeyDown:s,onSplineKeyUp:a,onSplineStart:o,onSplineLookAt:l,onSplineFollow:c,onSplineScroll:u,onLoad:h,renderOnDemand:d=!0,children:p,...f},v)=>{const g=qe.useRef(null),[m,x]=qe.useState(!0),[w,_]=qe.useState();if(w)throw w;return qe.useEffect(()=>{x(!0);let M;const S=[{name:"mouseDown",cb:i},{name:"mouseUp",cb:r},{name:"mouseHover",cb:n},{name:"keyDown",cb:s},{name:"keyUp",cb:a},{name:"start",cb:o},{name:"lookAt",cb:l},{name:"follow",cb:c},{name:"scroll",cb:u}];if(g.current){M=new cIe(g.current,{renderOnDemand:d});async function A(){await M.load(e);for(let T of S)T.cb&&M.addEventListener(T.name,T.cb);x(!1),h==null||h(M)}A().catch(T=>{_(T)})}return()=>{for(let A of S)A.cb&&M.removeEventListener(A.name,A.cb);M.dispose()}},[e]),rt.jsx(IIe,{ref:v,parentSizeStyles:{overflow:"hidden",...t},debounceTime:50,...f,children:()=>rt.jsxs(rt.Fragment,{children:[m&&p,rt.jsx("canvas",{ref:g,style:{display:m?"none":"block"}})]})})});/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const qT="167",Wp={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},Xp={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},vJ=0,Dz=1,yJ=2,OIe=3,xJ=0,YT=1,t1=2,El=3,gh=0,va=1,Dc=2,nh=0,Pf=1,Rz=2,Iz=3,Lz=4,wJ=5,vd=100,bJ=101,_J=102,SJ=103,MJ=104,EJ=200,AJ=201,CJ=202,TJ=203,vC=204,yC=205,PJ=206,DJ=207,RJ=208,IJ=209,LJ=210,OJ=211,zJ=212,NJ=213,BJ=214,kJ=0,UJ=1,FJ=2,ew=3,VJ=4,HJ=5,GJ=6,jJ=7,Kw=0,WJ=1,XJ=2,Hc=0,qJ=1,YJ=2,QJ=3,Xk=4,KJ=5,ZJ=6,$J=7,Oz="attached",JJ="detached",QT=300,vh=301,Kd=302,tw=303,iw=304,k0=306,rw=1e3,Qo=1001,nw=1002,os=1003,qk=1004,zIe=1004,lv=1005,NIe=1005,_n=1006,i1=1007,BIe=1007,Lc=1008,kIe=1008,jl=1009,Yk=1010,Qk=1011,a0=1012,KT=1013,yh=1014,Ua=1015,U0=1016,ZT=1017,$T=1018,Yf=1020,Kk=35902,Zk=1021,$k=1022,Ys=1023,Jk=1024,eU=1025,Df=1026,Qf=1027,JT=1028,Zw=1029,tU=1030,e2=1031,UIe=1032,t2=1033,r1=33776,n1=33777,s1=33778,a1=33779,xC=35840,wC=35841,bC=35842,_C=35843,SC=36196,MC=37492,EC=37496,AC=37808,CC=37809,TC=37810,PC=37811,DC=37812,RC=37813,IC=37814,LC=37815,OC=37816,zC=37817,NC=37818,BC=37819,kC=37820,UC=37821,o1=36492,FC=36494,VC=36495,iU=36283,HC=36284,GC=36285,jC=36286,eee=2200,tee=2201,iee=2202,sw=2300,WC=2301,PE=2302,mf=2400,gf=2401,aw=2402,i2=2500,rU=2501,FIe=0,VIe=1,HIe=2,ree=3200,nee=3201,GIe=3202,jIe=3203,sp=0,see=1,Vu="",Vo="srgb",Ah="srgb-linear",r2="display-p3",$w="display-p3-linear",ow="linear",yr="srgb",lw="rec709",cw="p3",WIe=0,qp=7680,XIe=7681,qIe=7682,YIe=7683,QIe=34055,KIe=34056,ZIe=5386,$Ie=512,JIe=513,eLe=514,tLe=515,iLe=516,rLe=517,nLe=518,zz=519,aee=512,oee=513,lee=514,nU=515,cee=516,uee=517,hee=518,dee=519,uw=35044,sLe=35048,aLe=35040,oLe=35045,lLe=35049,cLe=35041,uLe=35046,hLe=35050,dLe=35042,pLe="100",Nz="300 es",Oc=2e3,hw=2001;class $c{addEventListener(t,i){this._listeners===void 0&&(this._listeners={});const r=this._listeners;r[t]===void 0&&(r[t]=[]),r[t].indexOf(i)===-1&&r[t].push(i)}hasEventListener(t,i){if(this._listeners===void 0)return!1;const r=this._listeners;return r[t]!==void 0&&r[t].indexOf(i)!==-1}removeEventListener(t,i){if(this._listeners===void 0)return;const n=this._listeners[t];if(n!==void 0){const s=n.indexOf(i);s!==-1&&n.splice(s,1)}}dispatchEvent(t){if(this._listeners===void 0)return;const r=this._listeners[t.type];if(r!==void 0){t.target=this;const n=r.slice(0);for(let s=0,a=n.length;s<a;s++)n[s].call(this,t);t.target=null}}}const ks=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let KW=1234567;const Rf=Math.PI/180,o0=180/Math.PI;function po(){const e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(ks[e&255]+ks[e>>8&255]+ks[e>>16&255]+ks[e>>24&255]+"-"+ks[t&255]+ks[t>>8&255]+"-"+ks[t>>16&15|64]+ks[t>>24&255]+"-"+ks[i&63|128]+ks[i>>8&255]+"-"+ks[i>>16&255]+ks[i>>24&255]+ks[r&255]+ks[r>>8&255]+ks[r>>16&255]+ks[r>>24&255]).toLowerCase()}function Qr(e,t,i){return Math.max(t,Math.min(i,e))}function sU(e,t){return(e%t+t)%t}function fLe(e,t,i,r,n){return r+(e-t)*(n-r)/(i-t)}function mLe(e,t,i){return e!==t?(i-e)/(t-e):0}function l1(e,t,i){return(1-i)*e+i*t}function gLe(e,t,i,r){return l1(e,t,1-Math.exp(-i*r))}function vLe(e,t=1){return t-Math.abs(sU(e,t*2)-t)}function yLe(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t),e*e*(3-2*e))}function xLe(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t),e*e*e*(e*(e*6-15)+10))}function wLe(e,t){return e+Math.floor(Math.random()*(t-e+1))}function bLe(e,t){return e+Math.random()*(t-e)}function _Le(e){return e*(.5-Math.random())}function SLe(e){e!==void 0&&(KW=e);let t=KW+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}function MLe(e){return e*Rf}function ELe(e){return e*o0}function ALe(e){return(e&e-1)===0&&e!==0}function CLe(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function TLe(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function PLe(e,t,i,r,n){const s=Math.cos,a=Math.sin,o=s(i/2),l=a(i/2),c=s((t+r)/2),u=a((t+r)/2),h=s((t-r)/2),d=a((t-r)/2),p=s((r-t)/2),f=a((r-t)/2);switch(n){case"XYX":e.set(o*u,l*h,l*d,o*c);break;case"YZY":e.set(l*d,o*u,l*h,o*c);break;case"ZXZ":e.set(l*h,l*d,o*u,o*c);break;case"XZX":e.set(o*u,l*f,l*p,o*c);break;case"YXY":e.set(l*p,o*u,l*f,o*c);break;case"ZYZ":e.set(l*f,l*p,o*u,o*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+n)}}function fa(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return e/4294967295;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int32Array:return Math.max(e/2147483647,-1);case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function yi(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return Math.round(e*4294967295);case Uint16Array:return Math.round(e*65535);case Uint8Array:return Math.round(e*255);case Int32Array:return Math.round(e*2147483647);case Int16Array:return Math.round(e*32767);case Int8Array:return Math.round(e*127);default:throw new Error("Invalid component type.")}}const Bz={DEG2RAD:Rf,RAD2DEG:o0,generateUUID:po,clamp:Qr,euclideanModulo:sU,mapLinear:fLe,inverseLerp:mLe,lerp:l1,damp:gLe,pingpong:vLe,smoothstep:yLe,smootherstep:xLe,randInt:wLe,randFloat:bLe,randFloatSpread:_Le,seededRandom:SLe,degToRad:MLe,radToDeg:ELe,isPowerOfTwo:ALe,ceilPowerOfTwo:CLe,floorPowerOfTwo:TLe,setQuaternionFromProperEuler:PLe,normalize:yi,denormalize:fa};class ot{constructor(t=0,i=0){ot.prototype.isVector2=!0,this.x=t,this.y=i}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,i){return this.x=t,this.y=i,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this}addScaledVector(t,i){return this.x+=t.x*i,this.y+=t.y*i,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const i=this.x,r=this.y,n=t.elements;return this.x=n[0]*i+n[3]*r+n[6],this.y=n[1]*i+n[4]*r+n[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this}clampScalar(t,i){return this.x=Math.max(t,Math.min(i,this.x)),this.y=Math.max(t,Math.min(i,this.y)),this}clampLength(t,i){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(i,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const i=Math.sqrt(this.lengthSq()*t.lengthSq());if(i===0)return Math.PI/2;const r=this.dot(t)/i;return Math.acos(Qr(r,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const i=this.x-t.x,r=this.y-t.y;return i*i+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this}lerpVectors(t,i,r){return this.x=t.x+(i.x-t.x)*r,this.y=t.y+(i.y-t.y)*r,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,i=0){return this.x=t[i],this.y=t[i+1],this}toArray(t=[],i=0){return t[i]=this.x,t[i+1]=this.y,t}fromBufferAttribute(t,i){return this.x=t.getX(i),this.y=t.getY(i),this}rotateAround(t,i){const r=Math.cos(i),n=Math.sin(i),s=this.x-t.x,a=this.y-t.y;return this.x=s*r-a*n+t.x,this.y=s*n+a*r+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class vi{constructor(t,i,r,n,s,a,o,l,c){vi.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,i,r,n,s,a,o,l,c)}set(t,i,r,n,s,a,o,l,c){const u=this.elements;return u[0]=t,u[1]=n,u[2]=o,u[3]=i,u[4]=s,u[5]=l,u[6]=r,u[7]=a,u[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const i=this.elements,r=t.elements;return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[8]=r[8],this}extractBasis(t,i,r){return t.setFromMatrix3Column(this,0),i.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const i=t.elements;return this.set(i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,i){const r=t.elements,n=i.elements,s=this.elements,a=r[0],o=r[3],l=r[6],c=r[1],u=r[4],h=r[7],d=r[2],p=r[5],f=r[8],v=n[0],g=n[3],m=n[6],x=n[1],w=n[4],_=n[7],M=n[2],S=n[5],A=n[8];return s[0]=a*v+o*x+l*M,s[3]=a*g+o*w+l*S,s[6]=a*m+o*_+l*A,s[1]=c*v+u*x+h*M,s[4]=c*g+u*w+h*S,s[7]=c*m+u*_+h*A,s[2]=d*v+p*x+f*M,s[5]=d*g+p*w+f*S,s[8]=d*m+p*_+f*A,this}multiplyScalar(t){const i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=t,i[4]*=t,i[7]*=t,i[2]*=t,i[5]*=t,i[8]*=t,this}determinant(){const t=this.elements,i=t[0],r=t[1],n=t[2],s=t[3],a=t[4],o=t[5],l=t[6],c=t[7],u=t[8];return i*a*u-i*o*c-r*s*u+r*o*l+n*s*c-n*a*l}invert(){const t=this.elements,i=t[0],r=t[1],n=t[2],s=t[3],a=t[4],o=t[5],l=t[6],c=t[7],u=t[8],h=u*a-o*c,d=o*l-u*s,p=c*s-a*l,f=i*h+r*d+n*p;if(f===0)return this.set(0,0,0,0,0,0,0,0,0);const v=1/f;return t[0]=h*v,t[1]=(n*c-u*r)*v,t[2]=(o*r-n*a)*v,t[3]=d*v,t[4]=(u*i-n*l)*v,t[5]=(n*s-o*i)*v,t[6]=p*v,t[7]=(r*l-c*i)*v,t[8]=(a*i-r*s)*v,this}transpose(){let t;const i=this.elements;return t=i[1],i[1]=i[3],i[3]=t,t=i[2],i[2]=i[6],i[6]=t,t=i[5],i[5]=i[7],i[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const i=this.elements;return t[0]=i[0],t[1]=i[3],t[2]=i[6],t[3]=i[1],t[4]=i[4],t[5]=i[7],t[6]=i[2],t[7]=i[5],t[8]=i[8],this}setUvTransform(t,i,r,n,s,a,o){const l=Math.cos(s),c=Math.sin(s);return this.set(r*l,r*c,-r*(l*a+c*o)+a+t,-n*c,n*l,-n*(-c*a+l*o)+o+i,0,0,1),this}scale(t,i){return this.premultiply(CR.makeScale(t,i)),this}rotate(t){return this.premultiply(CR.makeRotation(-t)),this}translate(t,i){return this.premultiply(CR.makeTranslation(t,i)),this}makeTranslation(t,i){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,i,0,0,1),this}makeRotation(t){const i=Math.cos(t),r=Math.sin(t);return this.set(i,-r,0,r,i,0,0,0,1),this}makeScale(t,i){return this.set(t,0,0,0,i,0,0,0,1),this}equals(t){const i=this.elements,r=t.elements;for(let n=0;n<9;n++)if(i[n]!==r[n])return!1;return!0}fromArray(t,i=0){for(let r=0;r<9;r++)this.elements[r]=t[r+i];return this}toArray(t=[],i=0){const r=this.elements;return t[i]=r[0],t[i+1]=r[1],t[i+2]=r[2],t[i+3]=r[3],t[i+4]=r[4],t[i+5]=r[5],t[i+6]=r[6],t[i+7]=r[7],t[i+8]=r[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const CR=new vi;function pee(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}const DLe={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function cv(e,t){return new DLe[e](t)}function dw(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function fee(){const e=dw("canvas");return e.style.display="block",e}const ZW={};function Ov(e){e in ZW||(ZW[e]=!0,console.warn(e))}function RLe(e,t,i){return new Promise(function(r,n){function s(){switch(e.clientWaitSync(t,e.SYNC_FLUSH_COMMANDS_BIT,0)){case e.WAIT_FAILED:n();break;case e.TIMEOUT_EXPIRED:setTimeout(s,i);break;default:r()}}setTimeout(s,i)})}const $W=new vi().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),JW=new vi().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),Qy={[Ah]:{transfer:ow,primaries:lw,luminanceCoefficients:[.2126,.7152,.0722],toReference:e=>e,fromReference:e=>e},[Vo]:{transfer:yr,primaries:lw,luminanceCoefficients:[.2126,.7152,.0722],toReference:e=>e.convertSRGBToLinear(),fromReference:e=>e.convertLinearToSRGB()},[$w]:{transfer:ow,primaries:cw,luminanceCoefficients:[.2289,.6917,.0793],toReference:e=>e.applyMatrix3(JW),fromReference:e=>e.applyMatrix3($W)},[r2]:{transfer:yr,primaries:cw,luminanceCoefficients:[.2289,.6917,.0793],toReference:e=>e.convertSRGBToLinear().applyMatrix3(JW),fromReference:e=>e.applyMatrix3($W).convertLinearToSRGB()}},ILe=new Set([Ah,$w]),Gi={enabled:!0,_workingColorSpace:Ah,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(e){if(!ILe.has(e))throw new Error(`Unsupported working color space, "${e}".`);this._workingColorSpace=e},convert:function(e,t,i){if(this.enabled===!1||t===i||!t||!i)return e;const r=Qy[t].toReference,n=Qy[i].fromReference;return n(r(e))},fromWorkingColorSpace:function(e,t){return this.convert(e,this._workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this._workingColorSpace)},getPrimaries:function(e){return Qy[e].primaries},getTransfer:function(e){return e===Vu?ow:Qy[e].transfer},getLuminanceCoefficients:function(e,t=this._workingColorSpace){return e.fromArray(Qy[t].luminanceCoefficients)}};function zv(e){return e<.04045?e*.0773993808:Math.pow(e*.9478672986+.0521327014,2.4)}function TR(e){return e<.0031308?e*12.92:1.055*Math.pow(e,.41666)-.055}let ng;class mee{static getDataURL(t){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement>"u")return t.src;let i;if(t instanceof HTMLCanvasElement)i=t;else{ng===void 0&&(ng=dw("canvas")),ng.width=t.width,ng.height=t.height;const r=ng.getContext("2d");t instanceof ImageData?r.putImageData(t,0,0):r.drawImage(t,0,0,t.width,t.height),i=ng}return i.width>2048||i.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),i.toDataURL("image/jpeg",.6)):i.toDataURL("image/png")}static sRGBToLinear(t){if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap){const i=dw("canvas");i.width=t.width,i.height=t.height;const r=i.getContext("2d");r.drawImage(t,0,0,t.width,t.height);const n=r.getImageData(0,0,t.width,t.height),s=n.data;for(let a=0;a<s.length;a++)s[a]=zv(s[a]/255)*255;return r.putImageData(n,0,0),i}else if(t.data){const i=t.data.slice(0);for(let r=0;r<i.length;r++)i instanceof Uint8Array||i instanceof Uint8ClampedArray?i[r]=Math.floor(zv(i[r]/255)*255):i[r]=zv(i[r]);return{data:i,width:t.width,height:t.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}let LLe=0;class vf{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:LLe++}),this.uuid=po(),this.data=t,this.dataReady=!0,this.version=0}set needsUpdate(t){t===!0&&this.version++}toJSON(t){const i=t===void 0||typeof t=="string";if(!i&&t.images[this.uuid]!==void 0)return t.images[this.uuid];const r={uuid:this.uuid,url:""},n=this.data;if(n!==null){let s;if(Array.isArray(n)){s=[];for(let a=0,o=n.length;a<o;a++)n[a].isDataTexture?s.push(PR(n[a].image)):s.push(PR(n[a]))}else s=PR(n);r.url=s}return i||(t.images[this.uuid]=r),r}}function PR(e){return typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap?mee.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let OLe=0;class kr extends $c{constructor(t=kr.DEFAULT_IMAGE,i=kr.DEFAULT_MAPPING,r=Qo,n=Qo,s=_n,a=Lc,o=Ys,l=jl,c=kr.DEFAULT_ANISOTROPY,u=Vu){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:OLe++}),this.uuid=po(),this.name="",this.source=new vf(t),this.mipmaps=[],this.mapping=i,this.channel=0,this.wrapS=r,this.wrapT=n,this.magFilter=s,this.minFilter=a,this.anisotropy=c,this.format=o,this.internalFormat=null,this.type=l,this.offset=new ot(0,0),this.repeat=new ot(1,1),this.center=new ot(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new vi,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=u,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const i=t===void 0||typeof t=="string";if(!i&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];const r={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),i||(t.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==QT)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case rw:t.x=t.x-Math.floor(t.x);break;case Qo:t.x=t.x<0?0:1;break;case nw:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case rw:t.y=t.y-Math.floor(t.y);break;case Qo:t.y=t.y<0?0:1;break;case nw:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){t===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(t){t===!0&&this.pmremVersion++}}kr.DEFAULT_IMAGE=null;kr.DEFAULT_MAPPING=QT;kr.DEFAULT_ANISOTROPY=1;class tr{constructor(t=0,i=0,r=0,n=1){tr.prototype.isVector4=!0,this.x=t,this.y=i,this.z=r,this.w=n}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,i,r,n){return this.x=t,this.y=i,this.z=r,this.w=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;case 3:this.w=i;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==void 0?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this.w=t.w+i.w,this}addScaledVector(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this.w+=t.w*i,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this.w=t.w-i.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const i=this.x,r=this.y,n=this.z,s=this.w,a=t.elements;return this.x=a[0]*i+a[4]*r+a[8]*n+a[12]*s,this.y=a[1]*i+a[5]*r+a[9]*n+a[13]*s,this.z=a[2]*i+a[6]*r+a[10]*n+a[14]*s,this.w=a[3]*i+a[7]*r+a[11]*n+a[15]*s,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const i=Math.sqrt(1-t.w*t.w);return i<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/i,this.y=t.y/i,this.z=t.z/i),this}setAxisAngleFromRotationMatrix(t){let i,r,n,s;const l=t.elements,c=l[0],u=l[4],h=l[8],d=l[1],p=l[5],f=l[9],v=l[2],g=l[6],m=l[10];if(Math.abs(u-d)<.01&&Math.abs(h-v)<.01&&Math.abs(f-g)<.01){if(Math.abs(u+d)<.1&&Math.abs(h+v)<.1&&Math.abs(f+g)<.1&&Math.abs(c+p+m-3)<.1)return this.set(1,0,0,0),this;i=Math.PI;const w=(c+1)/2,_=(p+1)/2,M=(m+1)/2,S=(u+d)/4,A=(h+v)/4,T=(f+g)/4;return w>_&&w>M?w<.01?(r=0,n=.707106781,s=.707106781):(r=Math.sqrt(w),n=S/r,s=A/r):_>M?_<.01?(r=.707106781,n=0,s=.707106781):(n=Math.sqrt(_),r=S/n,s=T/n):M<.01?(r=.707106781,n=.707106781,s=0):(s=Math.sqrt(M),r=A/s,n=T/s),this.set(r,n,s,i),this}let x=Math.sqrt((g-f)*(g-f)+(h-v)*(h-v)+(d-u)*(d-u));return Math.abs(x)<.001&&(x=1),this.x=(g-f)/x,this.y=(h-v)/x,this.z=(d-u)/x,this.w=Math.acos((c+p+m-1)/2),this}setFromMatrixPosition(t){const i=t.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this.w=i[15],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this.z=Math.max(t.z,Math.min(i.z,this.z)),this.w=Math.max(t.w,Math.min(i.w,this.w)),this}clampScalar(t,i){return this.x=Math.max(t,Math.min(i,this.x)),this.y=Math.max(t,Math.min(i,this.y)),this.z=Math.max(t,Math.min(i,this.z)),this.w=Math.max(t,Math.min(i,this.w)),this}clampLength(t,i){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(i,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this.w+=(t.w-this.w)*i,this}lerpVectors(t,i,r){return this.x=t.x+(i.x-t.x)*r,this.y=t.y+(i.y-t.y)*r,this.z=t.z+(i.z-t.z)*r,this.w=t.w+(i.w-t.w)*r,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,i=0){return this.x=t[i],this.y=t[i+1],this.z=t[i+2],this.w=t[i+3],this}toArray(t=[],i=0){return t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t[i+3]=this.w,t}fromBufferAttribute(t,i){return this.x=t.getX(i),this.y=t.getY(i),this.z=t.getZ(i),this.w=t.getW(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class gee extends $c{constructor(t=1,i=1,r={}){super(),this.isRenderTarget=!0,this.width=t,this.height=i,this.depth=1,this.scissor=new tr(0,0,t,i),this.scissorTest=!1,this.viewport=new tr(0,0,t,i);const n={width:t,height:i,depth:1};r=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:_n,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},r);const s=new kr(n,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.colorSpace);s.flipY=!1,s.generateMipmaps=r.generateMipmaps,s.internalFormat=r.internalFormat,this.textures=[];const a=r.count;for(let o=0;o<a;o++)this.textures[o]=s.clone(),this.textures[o].isRenderTargetTexture=!0;this.depthBuffer=r.depthBuffer,this.stencilBuffer=r.stencilBuffer,this.resolveDepthBuffer=r.resolveDepthBuffer,this.resolveStencilBuffer=r.resolveStencilBuffer,this.depthTexture=r.depthTexture,this.samples=r.samples}get texture(){return this.textures[0]}set texture(t){this.textures[0]=t}setSize(t,i,r=1){if(this.width!==t||this.height!==i||this.depth!==r){this.width=t,this.height=i,this.depth=r;for(let n=0,s=this.textures.length;n<s;n++)this.textures[n].image.width=t,this.textures[n].image.height=i,this.textures[n].image.depth=r;this.dispose()}this.viewport.set(0,0,t,i),this.scissor.set(0,0,t,i)}clone(){return new this.constructor().copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.scissor.copy(t.scissor),this.scissorTest=t.scissorTest,this.viewport.copy(t.viewport),this.textures.length=0;for(let r=0,n=t.textures.length;r<n;r++)this.textures[r]=t.textures[r].clone(),this.textures[r].isRenderTargetTexture=!0;const i=Object.assign({},t.texture.image);return this.texture.source=new vf(i),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.resolveDepthBuffer=t.resolveDepthBuffer,this.resolveStencilBuffer=t.resolveStencilBuffer,t.depthTexture!==null&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Wl extends gee{constructor(t=1,i=1,r={}){super(t,i,r),this.isWebGLRenderTarget=!0}}class n2 extends kr{constructor(t=null,i=1,r=1,n=1){super(null),this.isDataArrayTexture=!0,this.image={data:t,width:i,height:r,depth:n},this.magFilter=os,this.minFilter=os,this.wrapR=Qo,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(t){this.layerUpdates.add(t)}clearLayerUpdates(){this.layerUpdates.clear()}}class zLe extends Wl{constructor(t=1,i=1,r=1,n={}){super(t,i,n),this.isWebGLArrayRenderTarget=!0,this.depth=r,this.texture=new n2(null,t,i,r),this.texture.isRenderTargetTexture=!0}}class aU extends kr{constructor(t=null,i=1,r=1,n=1){super(null),this.isData3DTexture=!0,this.image={data:t,width:i,height:r,depth:n},this.magFilter=os,this.minFilter=os,this.wrapR=Qo,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class NLe extends Wl{constructor(t=1,i=1,r=1,n={}){super(t,i,n),this.isWebGL3DRenderTarget=!0,this.depth=r,this.texture=new aU(null,t,i,r),this.texture.isRenderTargetTexture=!0}}class Ks{constructor(t=0,i=0,r=0,n=1){this.isQuaternion=!0,this._x=t,this._y=i,this._z=r,this._w=n}static slerpFlat(t,i,r,n,s,a,o){let l=r[n+0],c=r[n+1],u=r[n+2],h=r[n+3];const d=s[a+0],p=s[a+1],f=s[a+2],v=s[a+3];if(o===0){t[i+0]=l,t[i+1]=c,t[i+2]=u,t[i+3]=h;return}if(o===1){t[i+0]=d,t[i+1]=p,t[i+2]=f,t[i+3]=v;return}if(h!==v||l!==d||c!==p||u!==f){let g=1-o;const m=l*d+c*p+u*f+h*v,x=m>=0?1:-1,w=1-m*m;if(w>Number.EPSILON){const M=Math.sqrt(w),S=Math.atan2(M,m*x);g=Math.sin(g*S)/M,o=Math.sin(o*S)/M}const _=o*x;if(l=l*g+d*_,c=c*g+p*_,u=u*g+f*_,h=h*g+v*_,g===1-o){const M=1/Math.sqrt(l*l+c*c+u*u+h*h);l*=M,c*=M,u*=M,h*=M}}t[i]=l,t[i+1]=c,t[i+2]=u,t[i+3]=h}static multiplyQuaternionsFlat(t,i,r,n,s,a){const o=r[n],l=r[n+1],c=r[n+2],u=r[n+3],h=s[a],d=s[a+1],p=s[a+2],f=s[a+3];return t[i]=o*f+u*h+l*p-c*d,t[i+1]=l*f+u*d+c*h-o*p,t[i+2]=c*f+u*p+o*d-l*h,t[i+3]=u*f-o*h-l*d-c*p,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,i,r,n){return this._x=t,this._y=i,this._z=r,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,i=!0){const r=t._x,n=t._y,s=t._z,a=t._order,o=Math.cos,l=Math.sin,c=o(r/2),u=o(n/2),h=o(s/2),d=l(r/2),p=l(n/2),f=l(s/2);switch(a){case"XYZ":this._x=d*u*h+c*p*f,this._y=c*p*h-d*u*f,this._z=c*u*f+d*p*h,this._w=c*u*h-d*p*f;break;case"YXZ":this._x=d*u*h+c*p*f,this._y=c*p*h-d*u*f,this._z=c*u*f-d*p*h,this._w=c*u*h+d*p*f;break;case"ZXY":this._x=d*u*h-c*p*f,this._y=c*p*h+d*u*f,this._z=c*u*f+d*p*h,this._w=c*u*h-d*p*f;break;case"ZYX":this._x=d*u*h-c*p*f,this._y=c*p*h+d*u*f,this._z=c*u*f-d*p*h,this._w=c*u*h+d*p*f;break;case"YZX":this._x=d*u*h+c*p*f,this._y=c*p*h+d*u*f,this._z=c*u*f-d*p*h,this._w=c*u*h-d*p*f;break;case"XZY":this._x=d*u*h-c*p*f,this._y=c*p*h-d*u*f,this._z=c*u*f+d*p*h,this._w=c*u*h+d*p*f;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return i===!0&&this._onChangeCallback(),this}setFromAxisAngle(t,i){const r=i/2,n=Math.sin(r);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(t){const i=t.elements,r=i[0],n=i[4],s=i[8],a=i[1],o=i[5],l=i[9],c=i[2],u=i[6],h=i[10],d=r+o+h;if(d>0){const p=.5/Math.sqrt(d+1);this._w=.25/p,this._x=(u-l)*p,this._y=(s-c)*p,this._z=(a-n)*p}else if(r>o&&r>h){const p=2*Math.sqrt(1+r-o-h);this._w=(u-l)/p,this._x=.25*p,this._y=(n+a)/p,this._z=(s+c)/p}else if(o>h){const p=2*Math.sqrt(1+o-r-h);this._w=(s-c)/p,this._x=(n+a)/p,this._y=.25*p,this._z=(l+u)/p}else{const p=2*Math.sqrt(1+h-r-o);this._w=(a-n)/p,this._x=(s+c)/p,this._y=(l+u)/p,this._z=.25*p}return this._onChangeCallback(),this}setFromUnitVectors(t,i){let r=t.dot(i)+1;return r<Number.EPSILON?(r=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=r):(this._x=0,this._y=-t.z,this._z=t.y,this._w=r)):(this._x=t.y*i.z-t.z*i.y,this._y=t.z*i.x-t.x*i.z,this._z=t.x*i.y-t.y*i.x,this._w=r),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(Qr(this.dot(t),-1,1)))}rotateTowards(t,i){const r=this.angleTo(t);if(r===0)return this;const n=Math.min(1,i/r);return this.slerp(t,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,i){const r=t._x,n=t._y,s=t._z,a=t._w,o=i._x,l=i._y,c=i._z,u=i._w;return this._x=r*u+a*o+n*c-s*l,this._y=n*u+a*l+s*o-r*c,this._z=s*u+a*c+r*l-n*o,this._w=a*u-r*o-n*l-s*c,this._onChangeCallback(),this}slerp(t,i){if(i===0)return this;if(i===1)return this.copy(t);const r=this._x,n=this._y,s=this._z,a=this._w;let o=a*t._w+r*t._x+n*t._y+s*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=a,this._x=r,this._y=n,this._z=s,this;const l=1-o*o;if(l<=Number.EPSILON){const p=1-i;return this._w=p*a+i*this._w,this._x=p*r+i*this._x,this._y=p*n+i*this._y,this._z=p*s+i*this._z,this.normalize(),this}const c=Math.sqrt(l),u=Math.atan2(c,o),h=Math.sin((1-i)*u)/c,d=Math.sin(i*u)/c;return this._w=a*h+this._w*d,this._x=r*h+this._x*d,this._y=n*h+this._y*d,this._z=s*h+this._z*d,this._onChangeCallback(),this}slerpQuaternions(t,i,r){return this.copy(t).slerp(i,r)}random(){const t=2*Math.PI*Math.random(),i=2*Math.PI*Math.random(),r=Math.random(),n=Math.sqrt(1-r),s=Math.sqrt(r);return this.set(n*Math.sin(t),n*Math.cos(t),s*Math.sin(i),s*Math.cos(i))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,i=0){return this._x=t[i],this._y=t[i+1],this._z=t[i+2],this._w=t[i+3],this._onChangeCallback(),this}toArray(t=[],i=0){return t[i]=this._x,t[i+1]=this._y,t[i+2]=this._z,t[i+3]=this._w,t}fromBufferAttribute(t,i){return this._x=t.getX(i),this._y=t.getY(i),this._z=t.getZ(i),this._w=t.getW(i),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class oe{constructor(t=0,i=0,r=0){oe.prototype.isVector3=!0,this.x=t,this.y=i,this.z=r}set(t,i,r){return r===void 0&&(r=this.z),this.x=t,this.y=i,this.z=r,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this}addScaledVector(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,i){return this.x=t.x*i.x,this.y=t.y*i.y,this.z=t.z*i.z,this}applyEuler(t){return this.applyQuaternion(e8.setFromEuler(t))}applyAxisAngle(t,i){return this.applyQuaternion(e8.setFromAxisAngle(t,i))}applyMatrix3(t){const i=this.x,r=this.y,n=this.z,s=t.elements;return this.x=s[0]*i+s[3]*r+s[6]*n,this.y=s[1]*i+s[4]*r+s[7]*n,this.z=s[2]*i+s[5]*r+s[8]*n,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const i=this.x,r=this.y,n=this.z,s=t.elements,a=1/(s[3]*i+s[7]*r+s[11]*n+s[15]);return this.x=(s[0]*i+s[4]*r+s[8]*n+s[12])*a,this.y=(s[1]*i+s[5]*r+s[9]*n+s[13])*a,this.z=(s[2]*i+s[6]*r+s[10]*n+s[14])*a,this}applyQuaternion(t){const i=this.x,r=this.y,n=this.z,s=t.x,a=t.y,o=t.z,l=t.w,c=2*(a*n-o*r),u=2*(o*i-s*n),h=2*(s*r-a*i);return this.x=i+l*c+a*h-o*u,this.y=r+l*u+o*c-s*h,this.z=n+l*h+s*u-a*c,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const i=this.x,r=this.y,n=this.z,s=t.elements;return this.x=s[0]*i+s[4]*r+s[8]*n,this.y=s[1]*i+s[5]*r+s[9]*n,this.z=s[2]*i+s[6]*r+s[10]*n,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this.z=Math.max(t.z,Math.min(i.z,this.z)),this}clampScalar(t,i){return this.x=Math.max(t,Math.min(i,this.x)),this.y=Math.max(t,Math.min(i,this.y)),this.z=Math.max(t,Math.min(i,this.z)),this}clampLength(t,i){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(i,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this}lerpVectors(t,i,r){return this.x=t.x+(i.x-t.x)*r,this.y=t.y+(i.y-t.y)*r,this.z=t.z+(i.z-t.z)*r,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,i){const r=t.x,n=t.y,s=t.z,a=i.x,o=i.y,l=i.z;return this.x=n*l-s*o,this.y=s*a-r*l,this.z=r*o-n*a,this}projectOnVector(t){const i=t.lengthSq();if(i===0)return this.set(0,0,0);const r=t.dot(this)/i;return this.copy(t).multiplyScalar(r)}projectOnPlane(t){return DR.copy(this).projectOnVector(t),this.sub(DR)}reflect(t){return this.sub(DR.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const i=Math.sqrt(this.lengthSq()*t.lengthSq());if(i===0)return Math.PI/2;const r=this.dot(t)/i;return Math.acos(Qr(r,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const i=this.x-t.x,r=this.y-t.y,n=this.z-t.z;return i*i+r*r+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,i,r){const n=Math.sin(i)*t;return this.x=n*Math.sin(r),this.y=Math.cos(i)*t,this.z=n*Math.cos(r),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,i,r){return this.x=t*Math.sin(i),this.y=r,this.z=t*Math.cos(i),this}setFromMatrixPosition(t){const i=t.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this}setFromMatrixScale(t){const i=this.setFromMatrixColumn(t,0).length(),r=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=i,this.y=r,this.z=n,this}setFromMatrixColumn(t,i){return this.fromArray(t.elements,i*4)}setFromMatrix3Column(t,i){return this.fromArray(t.elements,i*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,i=0){return this.x=t[i],this.y=t[i+1],this.z=t[i+2],this}toArray(t=[],i=0){return t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t}fromBufferAttribute(t,i){return this.x=t.getX(i),this.y=t.getY(i),this.z=t.getZ(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=Math.random()*Math.PI*2,i=Math.random()*2-1,r=Math.sqrt(1-i*i);return this.x=r*Math.cos(t),this.y=i,this.z=r*Math.sin(t),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const DR=new oe,e8=new Ks;class ya{constructor(t=new oe(1/0,1/0,1/0),i=new oe(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=i}set(t,i){return this.min.copy(t),this.max.copy(i),this}setFromArray(t){this.makeEmpty();for(let i=0,r=t.length;i<r;i+=3)this.expandByPoint(bl.fromArray(t,i));return this}setFromBufferAttribute(t){this.makeEmpty();for(let i=0,r=t.count;i<r;i++)this.expandByPoint(bl.fromBufferAttribute(t,i));return this}setFromPoints(t){this.makeEmpty();for(let i=0,r=t.length;i<r;i++)this.expandByPoint(t[i]);return this}setFromCenterAndSize(t,i){const r=bl.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}setFromObject(t,i=!1){return this.makeEmpty(),this.expandByObject(t,i)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,i=!1){t.updateWorldMatrix(!1,!1);const r=t.geometry;if(r!==void 0){const s=r.getAttribute("position");if(i===!0&&s!==void 0&&t.isInstancedMesh!==!0)for(let a=0,o=s.count;a<o;a++)t.isMesh===!0?t.getVertexPosition(a,bl):bl.fromBufferAttribute(s,a),bl.applyMatrix4(t.matrixWorld),this.expandByPoint(bl);else t.boundingBox!==void 0?(t.boundingBox===null&&t.computeBoundingBox(),XS.copy(t.boundingBox)):(r.boundingBox===null&&r.computeBoundingBox(),XS.copy(r.boundingBox)),XS.applyMatrix4(t.matrixWorld),this.union(XS)}const n=t.children;for(let s=0,a=n.length;s<a;s++)this.expandByObject(n[s],i);return this}containsPoint(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y&&t.z>=this.min.z&&t.z<=this.max.z}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,i){return i.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return t.max.x>=this.min.x&&t.min.x<=this.max.x&&t.max.y>=this.min.y&&t.min.y<=this.max.y&&t.max.z>=this.min.z&&t.min.z<=this.max.z}intersectsSphere(t){return this.clampPoint(t.center,bl),bl.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let i,r;return t.normal.x>0?(i=t.normal.x*this.min.x,r=t.normal.x*this.max.x):(i=t.normal.x*this.max.x,r=t.normal.x*this.min.x),t.normal.y>0?(i+=t.normal.y*this.min.y,r+=t.normal.y*this.max.y):(i+=t.normal.y*this.max.y,r+=t.normal.y*this.min.y),t.normal.z>0?(i+=t.normal.z*this.min.z,r+=t.normal.z*this.max.z):(i+=t.normal.z*this.max.z,r+=t.normal.z*this.min.z),i<=-t.constant&&r>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(Ky),qS.subVectors(this.max,Ky),sg.subVectors(t.a,Ky),ag.subVectors(t.b,Ky),og.subVectors(t.c,Ky),Kh.subVectors(ag,sg),Zh.subVectors(og,ag),Cp.subVectors(sg,og);let i=[0,-Kh.z,Kh.y,0,-Zh.z,Zh.y,0,-Cp.z,Cp.y,Kh.z,0,-Kh.x,Zh.z,0,-Zh.x,Cp.z,0,-Cp.x,-Kh.y,Kh.x,0,-Zh.y,Zh.x,0,-Cp.y,Cp.x,0];return!RR(i,sg,ag,og,qS)||(i=[1,0,0,0,1,0,0,0,1],!RR(i,sg,ag,og,qS))?!1:(YS.crossVectors(Kh,Zh),i=[YS.x,YS.y,YS.z],RR(i,sg,ag,og,qS))}clampPoint(t,i){return i.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,bl).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=this.getSize(bl).length()*.5),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(xu[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),xu[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),xu[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),xu[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),xu[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),xu[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),xu[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),xu[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(xu),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const xu=[new oe,new oe,new oe,new oe,new oe,new oe,new oe,new oe],bl=new oe,XS=new ya,sg=new oe,ag=new oe,og=new oe,Kh=new oe,Zh=new oe,Cp=new oe,Ky=new oe,qS=new oe,YS=new oe,Tp=new oe;function RR(e,t,i,r,n){for(let s=0,a=e.length-3;s<=a;s+=3){Tp.fromArray(e,s);const o=n.x*Math.abs(Tp.x)+n.y*Math.abs(Tp.y)+n.z*Math.abs(Tp.z),l=t.dot(Tp),c=i.dot(Tp),u=r.dot(Tp);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>o)return!1}return!0}const BLe=new ya,Zy=new oe,IR=new oe;class Zs{constructor(t=new oe,i=-1){this.isSphere=!0,this.center=t,this.radius=i}set(t,i){return this.center.copy(t),this.radius=i,this}setFromPoints(t,i){const r=this.center;i!==void 0?r.copy(i):BLe.setFromPoints(t).getCenter(r);let n=0;for(let s=0,a=t.length;s<a;s++)n=Math.max(n,r.distanceToSquared(t[s]));return this.radius=Math.sqrt(n),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const i=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=i*i}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,i){const r=this.center.distanceToSquared(t);return i.copy(t),r>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;Zy.subVectors(t,this.center);const i=Zy.lengthSq();if(i>this.radius*this.radius){const r=Math.sqrt(i),n=(r-this.radius)*.5;this.center.addScaledVector(Zy,n/r),this.radius+=n}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(this.center.equals(t.center)===!0?this.radius=Math.max(this.radius,t.radius):(IR.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(Zy.copy(t.center).add(IR)),this.expandByPoint(Zy.copy(t.center).sub(IR))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return new this.constructor().copy(this)}}const wu=new oe,LR=new oe,QS=new oe,$h=new oe,OR=new oe,KS=new oe,zR=new oe;class om{constructor(t=new oe,i=new oe(0,0,-1)){this.origin=t,this.direction=i}set(t,i){return this.origin.copy(t),this.direction.copy(i),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,i){return i.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,wu)),this}closestPointToPoint(t,i){i.subVectors(t,this.origin);const r=i.dot(this.direction);return r<0?i.copy(this.origin):i.copy(this.origin).addScaledVector(this.direction,r)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const i=wu.subVectors(t,this.origin).dot(this.direction);return i<0?this.origin.distanceToSquared(t):(wu.copy(this.origin).addScaledVector(this.direction,i),wu.distanceToSquared(t))}distanceSqToSegment(t,i,r,n){LR.copy(t).add(i).multiplyScalar(.5),QS.copy(i).sub(t).normalize(),$h.copy(this.origin).sub(LR);const s=t.distanceTo(i)*.5,a=-this.direction.dot(QS),o=$h.dot(this.direction),l=-$h.dot(QS),c=$h.lengthSq(),u=Math.abs(1-a*a);let h,d,p,f;if(u>0)if(h=a*l-o,d=a*o-l,f=s*u,h>=0)if(d>=-f)if(d<=f){const v=1/u;h*=v,d*=v,p=h*(h+a*d+2*o)+d*(a*h+d+2*l)+c}else d=s,h=Math.max(0,-(a*d+o)),p=-h*h+d*(d+2*l)+c;else d=-s,h=Math.max(0,-(a*d+o)),p=-h*h+d*(d+2*l)+c;else d<=-f?(h=Math.max(0,-(-a*s+o)),d=h>0?-s:Math.min(Math.max(-s,-l),s),p=-h*h+d*(d+2*l)+c):d<=f?(h=0,d=Math.min(Math.max(-s,-l),s),p=d*(d+2*l)+c):(h=Math.max(0,-(a*s+o)),d=h>0?s:Math.min(Math.max(-s,-l),s),p=-h*h+d*(d+2*l)+c);else d=a>0?-s:s,h=Math.max(0,-(a*d+o)),p=-h*h+d*(d+2*l)+c;return r&&r.copy(this.origin).addScaledVector(this.direction,h),n&&n.copy(LR).addScaledVector(QS,d),p}intersectSphere(t,i){wu.subVectors(t.center,this.origin);const r=wu.dot(this.direction),n=wu.dot(wu)-r*r,s=t.radius*t.radius;if(n>s)return null;const a=Math.sqrt(s-n),o=r-a,l=r+a;return l<0?null:o<0?this.at(l,i):this.at(o,i)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const i=t.normal.dot(this.direction);if(i===0)return t.distanceToPoint(this.origin)===0?0:null;const r=-(this.origin.dot(t.normal)+t.constant)/i;return r>=0?r:null}intersectPlane(t,i){const r=this.distanceToPlane(t);return r===null?null:this.at(r,i)}intersectsPlane(t){const i=t.distanceToPoint(this.origin);return i===0||t.normal.dot(this.direction)*i<0}intersectBox(t,i){let r,n,s,a,o,l;const c=1/this.direction.x,u=1/this.direction.y,h=1/this.direction.z,d=this.origin;return c>=0?(r=(t.min.x-d.x)*c,n=(t.max.x-d.x)*c):(r=(t.max.x-d.x)*c,n=(t.min.x-d.x)*c),u>=0?(s=(t.min.y-d.y)*u,a=(t.max.y-d.y)*u):(s=(t.max.y-d.y)*u,a=(t.min.y-d.y)*u),r>a||s>n||((s>r||isNaN(r))&&(r=s),(a<n||isNaN(n))&&(n=a),h>=0?(o=(t.min.z-d.z)*h,l=(t.max.z-d.z)*h):(o=(t.max.z-d.z)*h,l=(t.min.z-d.z)*h),r>l||o>n)||((o>r||r!==r)&&(r=o),(l<n||n!==n)&&(n=l),n<0)?null:this.at(r>=0?r:n,i)}intersectsBox(t){return this.intersectBox(t,wu)!==null}intersectTriangle(t,i,r,n,s){OR.subVectors(i,t),KS.subVectors(r,t),zR.crossVectors(OR,KS);let a=this.direction.dot(zR),o;if(a>0){if(n)return null;o=1}else if(a<0)o=-1,a=-a;else return null;$h.subVectors(this.origin,t);const l=o*this.direction.dot(KS.crossVectors($h,KS));if(l<0)return null;const c=o*this.direction.dot(OR.cross($h));if(c<0||l+c>a)return null;const u=-o*$h.dot(zR);return u<0?null:this.at(u/a,s)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class ii{constructor(t,i,r,n,s,a,o,l,c,u,h,d,p,f,v,g){ii.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t!==void 0&&this.set(t,i,r,n,s,a,o,l,c,u,h,d,p,f,v,g)}set(t,i,r,n,s,a,o,l,c,u,h,d,p,f,v,g){const m=this.elements;return m[0]=t,m[4]=i,m[8]=r,m[12]=n,m[1]=s,m[5]=a,m[9]=o,m[13]=l,m[2]=c,m[6]=u,m[10]=h,m[14]=d,m[3]=p,m[7]=f,m[11]=v,m[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new ii().fromArray(this.elements)}copy(t){const i=this.elements,r=t.elements;return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[8]=r[8],i[9]=r[9],i[10]=r[10],i[11]=r[11],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15],this}copyPosition(t){const i=this.elements,r=t.elements;return i[12]=r[12],i[13]=r[13],i[14]=r[14],this}setFromMatrix3(t){const i=t.elements;return this.set(i[0],i[3],i[6],0,i[1],i[4],i[7],0,i[2],i[5],i[8],0,0,0,0,1),this}extractBasis(t,i,r){return t.setFromMatrixColumn(this,0),i.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(t,i,r){return this.set(t.x,i.x,r.x,0,t.y,i.y,r.y,0,t.z,i.z,r.z,0,0,0,0,1),this}extractRotation(t){const i=this.elements,r=t.elements,n=1/lg.setFromMatrixColumn(t,0).length(),s=1/lg.setFromMatrixColumn(t,1).length(),a=1/lg.setFromMatrixColumn(t,2).length();return i[0]=r[0]*n,i[1]=r[1]*n,i[2]=r[2]*n,i[3]=0,i[4]=r[4]*s,i[5]=r[5]*s,i[6]=r[6]*s,i[7]=0,i[8]=r[8]*a,i[9]=r[9]*a,i[10]=r[10]*a,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromEuler(t){const i=this.elements,r=t.x,n=t.y,s=t.z,a=Math.cos(r),o=Math.sin(r),l=Math.cos(n),c=Math.sin(n),u=Math.cos(s),h=Math.sin(s);if(t.order==="XYZ"){const d=a*u,p=a*h,f=o*u,v=o*h;i[0]=l*u,i[4]=-l*h,i[8]=c,i[1]=p+f*c,i[5]=d-v*c,i[9]=-o*l,i[2]=v-d*c,i[6]=f+p*c,i[10]=a*l}else if(t.order==="YXZ"){const d=l*u,p=l*h,f=c*u,v=c*h;i[0]=d+v*o,i[4]=f*o-p,i[8]=a*c,i[1]=a*h,i[5]=a*u,i[9]=-o,i[2]=p*o-f,i[6]=v+d*o,i[10]=a*l}else if(t.order==="ZXY"){const d=l*u,p=l*h,f=c*u,v=c*h;i[0]=d-v*o,i[4]=-a*h,i[8]=f+p*o,i[1]=p+f*o,i[5]=a*u,i[9]=v-d*o,i[2]=-a*c,i[6]=o,i[10]=a*l}else if(t.order==="ZYX"){const d=a*u,p=a*h,f=o*u,v=o*h;i[0]=l*u,i[4]=f*c-p,i[8]=d*c+v,i[1]=l*h,i[5]=v*c+d,i[9]=p*c-f,i[2]=-c,i[6]=o*l,i[10]=a*l}else if(t.order==="YZX"){const d=a*l,p=a*c,f=o*l,v=o*c;i[0]=l*u,i[4]=v-d*h,i[8]=f*h+p,i[1]=h,i[5]=a*u,i[9]=-o*u,i[2]=-c*u,i[6]=p*h+f,i[10]=d-v*h}else if(t.order==="XZY"){const d=a*l,p=a*c,f=o*l,v=o*c;i[0]=l*u,i[4]=-h,i[8]=c*u,i[1]=d*h+v,i[5]=a*u,i[9]=p*h-f,i[2]=f*h-p,i[6]=o*u,i[10]=v*h+d}return i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromQuaternion(t){return this.compose(kLe,t,ULe)}lookAt(t,i,r){const n=this.elements;return io.subVectors(t,i),io.lengthSq()===0&&(io.z=1),io.normalize(),Jh.crossVectors(r,io),Jh.lengthSq()===0&&(Math.abs(r.z)===1?io.x+=1e-4:io.z+=1e-4,io.normalize(),Jh.crossVectors(r,io)),Jh.normalize(),ZS.crossVectors(io,Jh),n[0]=Jh.x,n[4]=ZS.x,n[8]=io.x,n[1]=Jh.y,n[5]=ZS.y,n[9]=io.y,n[2]=Jh.z,n[6]=ZS.z,n[10]=io.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,i){const r=t.elements,n=i.elements,s=this.elements,a=r[0],o=r[4],l=r[8],c=r[12],u=r[1],h=r[5],d=r[9],p=r[13],f=r[2],v=r[6],g=r[10],m=r[14],x=r[3],w=r[7],_=r[11],M=r[15],S=n[0],A=n[4],T=n[8],E=n[12],C=n[1],D=n[5],I=n[9],L=n[13],z=n[2],F=n[6],Q=n[10],Y=n[14],O=n[3],j=n[7],V=n[11],W=n[15];return s[0]=a*S+o*C+l*z+c*O,s[4]=a*A+o*D+l*F+c*j,s[8]=a*T+o*I+l*Q+c*V,s[12]=a*E+o*L+l*Y+c*W,s[1]=u*S+h*C+d*z+p*O,s[5]=u*A+h*D+d*F+p*j,s[9]=u*T+h*I+d*Q+p*V,s[13]=u*E+h*L+d*Y+p*W,s[2]=f*S+v*C+g*z+m*O,s[6]=f*A+v*D+g*F+m*j,s[10]=f*T+v*I+g*Q+m*V,s[14]=f*E+v*L+g*Y+m*W,s[3]=x*S+w*C+_*z+M*O,s[7]=x*A+w*D+_*F+M*j,s[11]=x*T+w*I+_*Q+M*V,s[15]=x*E+w*L+_*Y+M*W,this}multiplyScalar(t){const i=this.elements;return i[0]*=t,i[4]*=t,i[8]*=t,i[12]*=t,i[1]*=t,i[5]*=t,i[9]*=t,i[13]*=t,i[2]*=t,i[6]*=t,i[10]*=t,i[14]*=t,i[3]*=t,i[7]*=t,i[11]*=t,i[15]*=t,this}determinant(){const t=this.elements,i=t[0],r=t[4],n=t[8],s=t[12],a=t[1],o=t[5],l=t[9],c=t[13],u=t[2],h=t[6],d=t[10],p=t[14],f=t[3],v=t[7],g=t[11],m=t[15];return f*(+s*l*h-n*c*h-s*o*d+r*c*d+n*o*p-r*l*p)+v*(+i*l*p-i*c*d+s*a*d-n*a*p+n*c*u-s*l*u)+g*(+i*c*h-i*o*p-s*a*h+r*a*p+s*o*u-r*c*u)+m*(-n*o*u-i*l*h+i*o*d+n*a*h-r*a*d+r*l*u)}transpose(){const t=this.elements;let i;return i=t[1],t[1]=t[4],t[4]=i,i=t[2],t[2]=t[8],t[8]=i,i=t[6],t[6]=t[9],t[9]=i,i=t[3],t[3]=t[12],t[12]=i,i=t[7],t[7]=t[13],t[13]=i,i=t[11],t[11]=t[14],t[14]=i,this}setPosition(t,i,r){const n=this.elements;return t.isVector3?(n[12]=t.x,n[13]=t.y,n[14]=t.z):(n[12]=t,n[13]=i,n[14]=r),this}invert(){const t=this.elements,i=t[0],r=t[1],n=t[2],s=t[3],a=t[4],o=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],v=t[13],g=t[14],m=t[15],x=h*g*c-v*d*c+v*l*p-o*g*p-h*l*m+o*d*m,w=f*d*c-u*g*c-f*l*p+a*g*p+u*l*m-a*d*m,_=u*v*c-f*h*c+f*o*p-a*v*p-u*o*m+a*h*m,M=f*h*l-u*v*l-f*o*d+a*v*d+u*o*g-a*h*g,S=i*x+r*w+n*_+s*M;if(S===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const A=1/S;return t[0]=x*A,t[1]=(v*d*s-h*g*s-v*n*p+r*g*p+h*n*m-r*d*m)*A,t[2]=(o*g*s-v*l*s+v*n*c-r*g*c-o*n*m+r*l*m)*A,t[3]=(h*l*s-o*d*s-h*n*c+r*d*c+o*n*p-r*l*p)*A,t[4]=w*A,t[5]=(u*g*s-f*d*s+f*n*p-i*g*p-u*n*m+i*d*m)*A,t[6]=(f*l*s-a*g*s-f*n*c+i*g*c+a*n*m-i*l*m)*A,t[7]=(a*d*s-u*l*s+u*n*c-i*d*c-a*n*p+i*l*p)*A,t[8]=_*A,t[9]=(f*h*s-u*v*s-f*r*p+i*v*p+u*r*m-i*h*m)*A,t[10]=(a*v*s-f*o*s+f*r*c-i*v*c-a*r*m+i*o*m)*A,t[11]=(u*o*s-a*h*s-u*r*c+i*h*c+a*r*p-i*o*p)*A,t[12]=M*A,t[13]=(u*v*n-f*h*n+f*r*d-i*v*d-u*r*g+i*h*g)*A,t[14]=(f*o*n-a*v*n-f*r*l+i*v*l+a*r*g-i*o*g)*A,t[15]=(a*h*n-u*o*n+u*r*l-i*h*l-a*r*d+i*o*d)*A,this}scale(t){const i=this.elements,r=t.x,n=t.y,s=t.z;return i[0]*=r,i[4]*=n,i[8]*=s,i[1]*=r,i[5]*=n,i[9]*=s,i[2]*=r,i[6]*=n,i[10]*=s,i[3]*=r,i[7]*=n,i[11]*=s,this}getMaxScaleOnAxis(){const t=this.elements,i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],r=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(i,r,n))}makeTranslation(t,i,r){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,i,0,0,1,r,0,0,0,1),this}makeRotationX(t){const i=Math.cos(t),r=Math.sin(t);return this.set(1,0,0,0,0,i,-r,0,0,r,i,0,0,0,0,1),this}makeRotationY(t){const i=Math.cos(t),r=Math.sin(t);return this.set(i,0,r,0,0,1,0,0,-r,0,i,0,0,0,0,1),this}makeRotationZ(t){const i=Math.cos(t),r=Math.sin(t);return this.set(i,-r,0,0,r,i,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,i){const r=Math.cos(i),n=Math.sin(i),s=1-r,a=t.x,o=t.y,l=t.z,c=s*a,u=s*o;return this.set(c*a+r,c*o-n*l,c*l+n*o,0,c*o+n*l,u*o+r,u*l-n*a,0,c*l-n*o,u*l+n*a,s*l*l+r,0,0,0,0,1),this}makeScale(t,i,r){return this.set(t,0,0,0,0,i,0,0,0,0,r,0,0,0,0,1),this}makeShear(t,i,r,n,s,a){return this.set(1,r,s,0,t,1,a,0,i,n,1,0,0,0,0,1),this}compose(t,i,r){const n=this.elements,s=i._x,a=i._y,o=i._z,l=i._w,c=s+s,u=a+a,h=o+o,d=s*c,p=s*u,f=s*h,v=a*u,g=a*h,m=o*h,x=l*c,w=l*u,_=l*h,M=r.x,S=r.y,A=r.z;return n[0]=(1-(v+m))*M,n[1]=(p+_)*M,n[2]=(f-w)*M,n[3]=0,n[4]=(p-_)*S,n[5]=(1-(d+m))*S,n[6]=(g+x)*S,n[7]=0,n[8]=(f+w)*A,n[9]=(g-x)*A,n[10]=(1-(d+v))*A,n[11]=0,n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=1,this}decompose(t,i,r){const n=this.elements;let s=lg.set(n[0],n[1],n[2]).length();const a=lg.set(n[4],n[5],n[6]).length(),o=lg.set(n[8],n[9],n[10]).length();this.determinant()<0&&(s=-s),t.x=n[12],t.y=n[13],t.z=n[14],_l.copy(this);const c=1/s,u=1/a,h=1/o;return _l.elements[0]*=c,_l.elements[1]*=c,_l.elements[2]*=c,_l.elements[4]*=u,_l.elements[5]*=u,_l.elements[6]*=u,_l.elements[8]*=h,_l.elements[9]*=h,_l.elements[10]*=h,i.setFromRotationMatrix(_l),r.x=s,r.y=a,r.z=o,this}makePerspective(t,i,r,n,s,a,o=Oc){const l=this.elements,c=2*s/(i-t),u=2*s/(r-n),h=(i+t)/(i-t),d=(r+n)/(r-n);let p,f;if(o===Oc)p=-(a+s)/(a-s),f=-2*a*s/(a-s);else if(o===hw)p=-a/(a-s),f=-a*s/(a-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);return l[0]=c,l[4]=0,l[8]=h,l[12]=0,l[1]=0,l[5]=u,l[9]=d,l[13]=0,l[2]=0,l[6]=0,l[10]=p,l[14]=f,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(t,i,r,n,s,a,o=Oc){const l=this.elements,c=1/(i-t),u=1/(r-n),h=1/(a-s),d=(i+t)*c,p=(r+n)*u;let f,v;if(o===Oc)f=(a+s)*h,v=-2*h;else if(o===hw)f=s*h,v=-1*h;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);return l[0]=2*c,l[4]=0,l[8]=0,l[12]=-d,l[1]=0,l[5]=2*u,l[9]=0,l[13]=-p,l[2]=0,l[6]=0,l[10]=v,l[14]=-f,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(t){const i=this.elements,r=t.elements;for(let n=0;n<16;n++)if(i[n]!==r[n])return!1;return!0}fromArray(t,i=0){for(let r=0;r<16;r++)this.elements[r]=t[r+i];return this}toArray(t=[],i=0){const r=this.elements;return t[i]=r[0],t[i+1]=r[1],t[i+2]=r[2],t[i+3]=r[3],t[i+4]=r[4],t[i+5]=r[5],t[i+6]=r[6],t[i+7]=r[7],t[i+8]=r[8],t[i+9]=r[9],t[i+10]=r[10],t[i+11]=r[11],t[i+12]=r[12],t[i+13]=r[13],t[i+14]=r[14],t[i+15]=r[15],t}}const lg=new oe,_l=new ii,kLe=new oe(0,0,0),ULe=new oe(1,1,1),Jh=new oe,ZS=new oe,io=new oe,t8=new ii,i8=new Ks;class yo{constructor(t=0,i=0,r=0,n=yo.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=i,this._z=r,this._order=n}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,i,r,n=this._order){return this._x=t,this._y=i,this._z=r,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,i=this._order,r=!0){const n=t.elements,s=n[0],a=n[4],o=n[8],l=n[1],c=n[5],u=n[9],h=n[2],d=n[6],p=n[10];switch(i){case"XYZ":this._y=Math.asin(Qr(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-u,p),this._z=Math.atan2(-a,s)):(this._x=Math.atan2(d,c),this._z=0);break;case"YXZ":this._x=Math.asin(-Qr(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(o,p),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-h,s),this._z=0);break;case"ZXY":this._x=Math.asin(Qr(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-h,p),this._z=Math.atan2(-a,c)):(this._y=0,this._z=Math.atan2(l,s));break;case"ZYX":this._y=Math.asin(-Qr(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(d,p),this._z=Math.atan2(l,s)):(this._x=0,this._z=Math.atan2(-a,c));break;case"YZX":this._z=Math.asin(Qr(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-h,s)):(this._x=0,this._y=Math.atan2(o,p));break;case"XZY":this._z=Math.asin(-Qr(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(d,c),this._y=Math.atan2(o,s)):(this._x=Math.atan2(-u,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+i)}return this._order=i,r===!0&&this._onChangeCallback(),this}setFromQuaternion(t,i,r){return t8.makeRotationFromQuaternion(t),this.setFromRotationMatrix(t8,i,r)}setFromVector3(t,i=this._order){return this.set(t.x,t.y,t.z,i)}reorder(t){return i8.setFromEuler(this),this.setFromQuaternion(i8,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],i=0){return t[i]=this._x,t[i+1]=this._y,t[i+2]=this._z,t[i+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}yo.DEFAULT_ORDER="XYZ";class If{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return(this.mask&t.mask)!==0}isEnabled(t){return(this.mask&(1<<t|0))!==0}}let FLe=0;const r8=new oe,cg=new Ks,bu=new ii,$S=new oe,$y=new oe,VLe=new oe,HLe=new Ks,n8=new oe(1,0,0),s8=new oe(0,1,0),a8=new oe(0,0,1),o8={type:"added"},GLe={type:"removed"},ug={type:"childadded",child:null},NR={type:"childremoved",child:null};class ki extends $c{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:FLe++}),this.uuid=po(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=ki.DEFAULT_UP.clone();const t=new oe,i=new yo,r=new Ks,n=new oe(1,1,1);function s(){r.setFromEuler(i,!1)}function a(){i.setFromQuaternion(r,void 0,!1)}i._onChange(s),r._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new ii},normalMatrix:{value:new vi}}),this.matrix=new ii,this.matrixWorld=new ii,this.matrixAutoUpdate=ki.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=ki.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new If,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,i){this.quaternion.setFromAxisAngle(t,i)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,i){return cg.setFromAxisAngle(t,i),this.quaternion.multiply(cg),this}rotateOnWorldAxis(t,i){return cg.setFromAxisAngle(t,i),this.quaternion.premultiply(cg),this}rotateX(t){return this.rotateOnAxis(n8,t)}rotateY(t){return this.rotateOnAxis(s8,t)}rotateZ(t){return this.rotateOnAxis(a8,t)}translateOnAxis(t,i){return r8.copy(t).applyQuaternion(this.quaternion),this.position.add(r8.multiplyScalar(i)),this}translateX(t){return this.translateOnAxis(n8,t)}translateY(t){return this.translateOnAxis(s8,t)}translateZ(t){return this.translateOnAxis(a8,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(bu.copy(this.matrixWorld).invert())}lookAt(t,i,r){t.isVector3?$S.copy(t):$S.set(t,i,r);const n=this.parent;this.updateWorldMatrix(!0,!1),$y.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?bu.lookAt($y,$S,this.up):bu.lookAt($S,$y,this.up),this.quaternion.setFromRotationMatrix(bu),n&&(bu.extractRotation(n.matrixWorld),cg.setFromRotationMatrix(bu),this.quaternion.premultiply(cg.invert()))}add(t){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.add(arguments[i]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.removeFromParent(),t.parent=this,this.children.push(t),t.dispatchEvent(o8),ug.child=t,this.dispatchEvent(ug),ug.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}const i=this.children.indexOf(t);return i!==-1&&(t.parent=null,this.children.splice(i,1),t.dispatchEvent(GLe),NR.child=t,this.dispatchEvent(NR),NR.child=null),this}removeFromParent(){const t=this.parent;return t!==null&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),bu.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),bu.multiply(t.parent.matrixWorld)),t.applyMatrix4(bu),t.removeFromParent(),t.parent=this,this.children.push(t),t.updateWorldMatrix(!1,!0),t.dispatchEvent(o8),ug.child=t,this.dispatchEvent(ug),ug.child=null,this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,i){if(this[t]===i)return this;for(let r=0,n=this.children.length;r<n;r++){const a=this.children[r].getObjectByProperty(t,i);if(a!==void 0)return a}}getObjectsByProperty(t,i,r=[]){this[t]===i&&r.push(this);const n=this.children;for(let s=0,a=n.length;s<a;s++)n[s].getObjectsByProperty(t,i,r);return r}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose($y,t,VLe),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose($y,HLe,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const i=this.matrixWorld.elements;return t.set(i[8],i[9],i[10]).normalize()}raycast(){}traverse(t){t(this);const i=this.children;for(let r=0,n=i.length;r<n;r++)i[r].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);const i=this.children;for(let r=0,n=i.length;r<n;r++)i[r].traverseVisible(t)}traverseAncestors(t){const i=this.parent;i!==null&&(t(i),i.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);const i=this.children;for(let r=0,n=i.length;r<n;r++)i[r].updateMatrixWorld(t)}updateWorldMatrix(t,i){const r=this.parent;if(t===!0&&r!==null&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),i===!0){const n=this.children;for(let s=0,a=n.length;s<a;s++)n[s].updateWorldMatrix(!1,!0)}}toJSON(t){const i=t===void 0||typeof t=="string",r={};i&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const n={};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.castShadow===!0&&(n.castShadow=!0),this.receiveShadow===!0&&(n.receiveShadow=!0),this.visible===!1&&(n.visible=!1),this.frustumCulled===!1&&(n.frustumCulled=!1),this.renderOrder!==0&&(n.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),n.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(n.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(n.type="BatchedMesh",n.perObjectFrustumCulled=this.perObjectFrustumCulled,n.sortObjects=this.sortObjects,n.drawRanges=this._drawRanges,n.reservedRanges=this._reservedRanges,n.visibility=this._visibility,n.active=this._active,n.bounds=this._bounds.map(o=>({boxInitialized:o.boxInitialized,boxMin:o.box.min.toArray(),boxMax:o.box.max.toArray(),sphereInitialized:o.sphereInitialized,sphereRadius:o.sphere.radius,sphereCenter:o.sphere.center.toArray()})),n.maxInstanceCount=this._maxInstanceCount,n.maxVertexCount=this._maxVertexCount,n.maxIndexCount=this._maxIndexCount,n.geometryInitialized=this._geometryInitialized,n.geometryCount=this._geometryCount,n.matricesTexture=this._matricesTexture.toJSON(t),this._colorsTexture!==null&&(n.colorsTexture=this._colorsTexture.toJSON(t)),this.boundingSphere!==null&&(n.boundingSphere={center:n.boundingSphere.center.toArray(),radius:n.boundingSphere.radius}),this.boundingBox!==null&&(n.boundingBox={min:n.boundingBox.min.toArray(),max:n.boundingBox.max.toArray()}));function s(o,l){return o[l.uuid]===void 0&&(o[l.uuid]=l.toJSON(t)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(n.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=s(t.geometries,this.geometry);const o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){const l=o.shapes;if(Array.isArray(l))for(let c=0,u=l.length;c<u;c++){const h=l[c];s(t.shapes,h)}else s(t.shapes,l)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(t.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const o=[];for(let l=0,c=this.material.length;l<c;l++)o.push(s(t.materials,this.material[l]));n.material=o}else n.material=s(t.materials,this.material);if(this.children.length>0){n.children=[];for(let o=0;o<this.children.length;o++)n.children.push(this.children[o].toJSON(t).object)}if(this.animations.length>0){n.animations=[];for(let o=0;o<this.animations.length;o++){const l=this.animations[o];n.animations.push(s(t.animations,l))}}if(i){const o=a(t.geometries),l=a(t.materials),c=a(t.textures),u=a(t.images),h=a(t.shapes),d=a(t.skeletons),p=a(t.animations),f=a(t.nodes);o.length>0&&(r.geometries=o),l.length>0&&(r.materials=l),c.length>0&&(r.textures=c),u.length>0&&(r.images=u),h.length>0&&(r.shapes=h),d.length>0&&(r.skeletons=d),p.length>0&&(r.animations=p),f.length>0&&(r.nodes=f)}return r.object=n,r;function a(o){const l=[];for(const c in o){const u=o[c];delete u.metadata,l.push(u)}return l}}clone(t){return new this.constructor().copy(this,t)}copy(t,i=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),i===!0)for(let r=0;r<t.children.length;r++){const n=t.children[r];this.add(n.clone())}return this}}ki.DEFAULT_UP=new oe(0,1,0);ki.DEFAULT_MATRIX_AUTO_UPDATE=!0;ki.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Sl=new oe,_u=new oe,BR=new oe,Su=new oe,hg=new oe,dg=new oe,l8=new oe,kR=new oe,UR=new oe,FR=new oe;class oo{constructor(t=new oe,i=new oe,r=new oe){this.a=t,this.b=i,this.c=r}static getNormal(t,i,r,n){n.subVectors(r,i),Sl.subVectors(t,i),n.cross(Sl);const s=n.lengthSq();return s>0?n.multiplyScalar(1/Math.sqrt(s)):n.set(0,0,0)}static getBarycoord(t,i,r,n,s){Sl.subVectors(n,i),_u.subVectors(r,i),BR.subVectors(t,i);const a=Sl.dot(Sl),o=Sl.dot(_u),l=Sl.dot(BR),c=_u.dot(_u),u=_u.dot(BR),h=a*c-o*o;if(h===0)return s.set(0,0,0),null;const d=1/h,p=(c*l-o*u)*d,f=(a*u-o*l)*d;return s.set(1-p-f,f,p)}static containsPoint(t,i,r,n){return this.getBarycoord(t,i,r,n,Su)===null?!1:Su.x>=0&&Su.y>=0&&Su.x+Su.y<=1}static getInterpolation(t,i,r,n,s,a,o,l){return this.getBarycoord(t,i,r,n,Su)===null?(l.x=0,l.y=0,"z"in l&&(l.z=0),"w"in l&&(l.w=0),null):(l.setScalar(0),l.addScaledVector(s,Su.x),l.addScaledVector(a,Su.y),l.addScaledVector(o,Su.z),l)}static isFrontFacing(t,i,r,n){return Sl.subVectors(r,i),_u.subVectors(t,i),Sl.cross(_u).dot(n)<0}set(t,i,r){return this.a.copy(t),this.b.copy(i),this.c.copy(r),this}setFromPointsAndIndices(t,i,r,n){return this.a.copy(t[i]),this.b.copy(t[r]),this.c.copy(t[n]),this}setFromAttributeAndIndices(t,i,r,n){return this.a.fromBufferAttribute(t,i),this.b.fromBufferAttribute(t,r),this.c.fromBufferAttribute(t,n),this}clone(){return new this.constructor().copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return Sl.subVectors(this.c,this.b),_u.subVectors(this.a,this.b),Sl.cross(_u).length()*.5}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return oo.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,i){return oo.getBarycoord(t,this.a,this.b,this.c,i)}getInterpolation(t,i,r,n,s){return oo.getInterpolation(t,this.a,this.b,this.c,i,r,n,s)}containsPoint(t){return oo.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return oo.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,i){const r=this.a,n=this.b,s=this.c;let a,o;hg.subVectors(n,r),dg.subVectors(s,r),kR.subVectors(t,r);const l=hg.dot(kR),c=dg.dot(kR);if(l<=0&&c<=0)return i.copy(r);UR.subVectors(t,n);const u=hg.dot(UR),h=dg.dot(UR);if(u>=0&&h<=u)return i.copy(n);const d=l*h-u*c;if(d<=0&&l>=0&&u<=0)return a=l/(l-u),i.copy(r).addScaledVector(hg,a);FR.subVectors(t,s);const p=hg.dot(FR),f=dg.dot(FR);if(f>=0&&p<=f)return i.copy(s);const v=p*c-l*f;if(v<=0&&c>=0&&f<=0)return o=c/(c-f),i.copy(r).addScaledVector(dg,o);const g=u*f-p*h;if(g<=0&&h-u>=0&&p-f>=0)return l8.subVectors(s,n),o=(h-u)/(h-u+(p-f)),i.copy(n).addScaledVector(l8,o);const m=1/(g+v+d);return a=v*m,o=d*m,i.copy(r).addScaledVector(hg,a).addScaledVector(dg,o)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}const vee={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},ed={h:0,s:0,l:0},JS={h:0,s:0,l:0};function VR(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+(t-e)*6*i:i<1/2?t:i<2/3?e+(t-e)*6*(2/3-i):e}class Rt{constructor(t,i,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,i,r)}set(t,i,r){if(i===void 0&&r===void 0){const n=t;n&&n.isColor?this.copy(n):typeof n=="number"?this.setHex(n):typeof n=="string"&&this.setStyle(n)}else this.setRGB(t,i,r);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,i=Vo){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,Gi.toWorkingColorSpace(this,i),this}setRGB(t,i,r,n=Gi.workingColorSpace){return this.r=t,this.g=i,this.b=r,Gi.toWorkingColorSpace(this,n),this}setHSL(t,i,r,n=Gi.workingColorSpace){if(t=sU(t,1),i=Qr(i,0,1),r=Qr(r,0,1),i===0)this.r=this.g=this.b=r;else{const s=r<=.5?r*(1+i):r+i-r*i,a=2*r-s;this.r=VR(a,s,t+1/3),this.g=VR(a,s,t),this.b=VR(a,s,t-1/3)}return Gi.toWorkingColorSpace(this,n),this}setStyle(t,i=Vo){function r(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let n;if(n=/^(\w+)\(([^\)]*)\)/.exec(t)){let s;const a=n[1],o=n[2];switch(a){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,i);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,i);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,i);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(t)){const s=n[1],a=s.length;if(a===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,i);if(a===6)return this.setHex(parseInt(s,16),i);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,i);return this}setColorName(t,i=Vo){const r=vee[t.toLowerCase()];return r!==void 0?this.setHex(r,i):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=zv(t.r),this.g=zv(t.g),this.b=zv(t.b),this}copyLinearToSRGB(t){return this.r=TR(t.r),this.g=TR(t.g),this.b=TR(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=Vo){return Gi.fromWorkingColorSpace(Us.copy(this),t),Math.round(Qr(Us.r*255,0,255))*65536+Math.round(Qr(Us.g*255,0,255))*256+Math.round(Qr(Us.b*255,0,255))}getHexString(t=Vo){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,i=Gi.workingColorSpace){Gi.fromWorkingColorSpace(Us.copy(this),i);const r=Us.r,n=Us.g,s=Us.b,a=Math.max(r,n,s),o=Math.min(r,n,s);let l,c;const u=(o+a)/2;if(o===a)l=0,c=0;else{const h=a-o;switch(c=u<=.5?h/(a+o):h/(2-a-o),a){case r:l=(n-s)/h+(n<s?6:0);break;case n:l=(s-r)/h+2;break;case s:l=(r-n)/h+4;break}l/=6}return t.h=l,t.s=c,t.l=u,t}getRGB(t,i=Gi.workingColorSpace){return Gi.fromWorkingColorSpace(Us.copy(this),i),t.r=Us.r,t.g=Us.g,t.b=Us.b,t}getStyle(t=Vo){Gi.fromWorkingColorSpace(Us.copy(this),t);const i=Us.r,r=Us.g,n=Us.b;return t!==Vo?`color(${t} ${i.toFixed(3)} ${r.toFixed(3)} ${n.toFixed(3)})`:`rgb(${Math.round(i*255)},${Math.round(r*255)},${Math.round(n*255)})`}offsetHSL(t,i,r){return this.getHSL(ed),this.setHSL(ed.h+t,ed.s+i,ed.l+r)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,i){return this.r=t.r+i.r,this.g=t.g+i.g,this.b=t.b+i.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,i){return this.r+=(t.r-this.r)*i,this.g+=(t.g-this.g)*i,this.b+=(t.b-this.b)*i,this}lerpColors(t,i,r){return this.r=t.r+(i.r-t.r)*r,this.g=t.g+(i.g-t.g)*r,this.b=t.b+(i.b-t.b)*r,this}lerpHSL(t,i){this.getHSL(ed),t.getHSL(JS);const r=l1(ed.h,JS.h,i),n=l1(ed.s,JS.s,i),s=l1(ed.l,JS.l,i);return this.setHSL(r,n,s),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const i=this.r,r=this.g,n=this.b,s=t.elements;return this.r=s[0]*i+s[3]*r+s[6]*n,this.g=s[1]*i+s[4]*r+s[7]*n,this.b=s[2]*i+s[5]*r+s[8]*n,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,i=0){return this.r=t[i],this.g=t[i+1],this.b=t[i+2],this}toArray(t=[],i=0){return t[i]=this.r,t[i+1]=this.g,t[i+2]=this.b,t}fromBufferAttribute(t,i){return this.r=t.getX(i),this.g=t.getY(i),this.b=t.getZ(i),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Us=new Rt;Rt.NAMES=vee;let jLe=0;class Ts extends $c{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:jLe++}),this.uuid=po(),this.name="",this.type="Material",this.blending=Pf,this.side=gh,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=vC,this.blendDst=yC,this.blendEquation=vd,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Rt(0,0,0),this.blendAlpha=0,this.depthFunc=ew,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=zz,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=qp,this.stencilZFail=qp,this.stencilZPass=qp,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(t!==void 0)for(const i in t){const r=t[i];if(r===void 0){console.warn(`THREE.Material: parameter '${i}' has value of undefined.`);continue}const n=this[i];if(n===void 0){console.warn(`THREE.Material: '${i}' is not a property of THREE.${this.type}.`);continue}n&&n.isColor?n.set(r):n&&n.isVector3&&r&&r.isVector3?n.copy(r):this[i]=r}}toJSON(t){const i=t===void 0||typeof t=="string";i&&(t={textures:{},images:{}});const r={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),this.roughness!==void 0&&(r.roughness=this.roughness),this.metalness!==void 0&&(r.metalness=this.metalness),this.sheen!==void 0&&(r.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(r.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(r.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(r.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(r.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(r.shininess=this.shininess),this.clearcoat!==void 0&&(r.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(r.dispersion=this.dispersion),this.iridescence!==void 0&&(r.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(r.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(r.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(r.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(r.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),this.anisotropy!==void 0&&(r.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(r.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(r.anisotropyMap=this.anisotropyMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(t).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(t).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(t).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(t).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(t).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(r.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(r.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(t).uuid,this.combine!==void 0&&(r.combine=this.combine)),this.envMapRotation!==void 0&&(r.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(r.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(r.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(r.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(t).uuid),this.transmission!==void 0&&(r.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(r.transmissionMap=this.transmissionMap.toJSON(t).uuid),this.thickness!==void 0&&(r.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(r.thicknessMap=this.thicknessMap.toJSON(t).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(r.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(r.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(r.size=this.size),this.shadowSide!==null&&(r.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==Pf&&(r.blending=this.blending),this.side!==gh&&(r.side=this.side),this.vertexColors===!0&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),this.transparent===!0&&(r.transparent=!0),this.blendSrc!==vC&&(r.blendSrc=this.blendSrc),this.blendDst!==yC&&(r.blendDst=this.blendDst),this.blendEquation!==vd&&(r.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(r.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(r.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(r.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(r.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(r.blendAlpha=this.blendAlpha),this.depthFunc!==ew&&(r.depthFunc=this.depthFunc),this.depthTest===!1&&(r.depthTest=this.depthTest),this.depthWrite===!1&&(r.depthWrite=this.depthWrite),this.colorWrite===!1&&(r.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(r.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==zz&&(r.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(r.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(r.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==qp&&(r.stencilFail=this.stencilFail),this.stencilZFail!==qp&&(r.stencilZFail=this.stencilZFail),this.stencilZPass!==qp&&(r.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(r.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(r.rotation=this.rotation),this.polygonOffset===!0&&(r.polygonOffset=!0),this.polygonOffsetFactor!==0&&(r.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(r.linewidth=this.linewidth),this.dashSize!==void 0&&(r.dashSize=this.dashSize),this.gapSize!==void 0&&(r.gapSize=this.gapSize),this.scale!==void 0&&(r.scale=this.scale),this.dithering===!0&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),this.alphaHash===!0&&(r.alphaHash=!0),this.alphaToCoverage===!0&&(r.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(r.premultipliedAlpha=!0),this.forceSinglePass===!0&&(r.forceSinglePass=!0),this.wireframe===!0&&(r.wireframe=!0),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(r.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(r.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(r.flatShading=!0),this.visible===!1&&(r.visible=!1),this.toneMapped===!1&&(r.toneMapped=!1),this.fog===!1&&(r.fog=!1),Object.keys(this.userData).length>0&&(r.userData=this.userData);function n(s){const a=[];for(const o in s){const l=s[o];delete l.metadata,a.push(l)}return a}if(i){const s=n(t.textures),a=n(t.images);s.length>0&&(r.textures=s),a.length>0&&(r.images=a)}return r}clone(){return new this.constructor().copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.blendColor.copy(t.blendColor),this.blendAlpha=t.blendAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const i=t.clippingPlanes;let r=null;if(i!==null){const n=i.length;r=new Array(n);for(let s=0;s!==n;++s)r[s]=i[s].clone()}return this.clippingPlanes=r,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaHash=t.alphaHash,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){t===!0&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}onBeforeRender(){console.warn("Material: onBeforeRender() has been removed.")}}class ap extends Ts{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Rt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new yo,this.combine=Kw,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const Hu=WLe();function WLe(){const e=new ArrayBuffer(4),t=new Float32Array(e),i=new Uint32Array(e),r=new Uint32Array(512),n=new Uint32Array(512);for(let l=0;l<256;++l){const c=l-127;c<-27?(r[l]=0,r[l|256]=32768,n[l]=24,n[l|256]=24):c<-14?(r[l]=1024>>-c-14,r[l|256]=1024>>-c-14|32768,n[l]=-c-1,n[l|256]=-c-1):c<=15?(r[l]=c+15<<10,r[l|256]=c+15<<10|32768,n[l]=13,n[l|256]=13):c<128?(r[l]=31744,r[l|256]=64512,n[l]=24,n[l|256]=24):(r[l]=31744,r[l|256]=64512,n[l]=13,n[l|256]=13)}const s=new Uint32Array(2048),a=new Uint32Array(64),o=new Uint32Array(64);for(let l=1;l<1024;++l){let c=l<<13,u=0;for(;!(c&8388608);)c<<=1,u-=8388608;c&=-8388609,u+=947912704,s[l]=c|u}for(let l=1024;l<2048;++l)s[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)a[l]=l<<23;a[31]=1199570944,a[32]=2147483648;for(let l=33;l<63;++l)a[l]=2147483648+(l-32<<23);a[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(o[l]=1024);return{floatView:t,uint32View:i,baseTable:r,shiftTable:n,mantissaTable:s,exponentTable:a,offsetTable:o}}function Pa(e){Math.abs(e)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),e=Qr(e,-65504,65504),Hu.floatView[0]=e;const t=Hu.uint32View[0],i=t>>23&511;return Hu.baseTable[i]+((t&8388607)>>Hu.shiftTable[i])}function Tx(e){const t=e>>10;return Hu.uint32View[0]=Hu.mantissaTable[Hu.offsetTable[t]+(e&1023)]+Hu.exponentTable[t],Hu.floatView[0]}const XLe={toHalfFloat:Pa,fromHalfFloat:Tx},gn=new oe,eM=new ot;class dr{constructor(t,i,r=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=i,this.count=t!==void 0?t.length/i:0,this.normalized=r,this.usage=uw,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=Ua,this.version=0}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}get updateRange(){return Ov("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(t){return this.usage=t,this}addUpdateRange(t,i){this.updateRanges.push({start:t,count:i})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,i,r){t*=this.itemSize,r*=i.itemSize;for(let n=0,s=this.itemSize;n<s;n++)this.array[t+n]=i.array[r+n];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(this.itemSize===2)for(let i=0,r=this.count;i<r;i++)eM.fromBufferAttribute(this,i),eM.applyMatrix3(t),this.setXY(i,eM.x,eM.y);else if(this.itemSize===3)for(let i=0,r=this.count;i<r;i++)gn.fromBufferAttribute(this,i),gn.applyMatrix3(t),this.setXYZ(i,gn.x,gn.y,gn.z);return this}applyMatrix4(t){for(let i=0,r=this.count;i<r;i++)gn.fromBufferAttribute(this,i),gn.applyMatrix4(t),this.setXYZ(i,gn.x,gn.y,gn.z);return this}applyNormalMatrix(t){for(let i=0,r=this.count;i<r;i++)gn.fromBufferAttribute(this,i),gn.applyNormalMatrix(t),this.setXYZ(i,gn.x,gn.y,gn.z);return this}transformDirection(t){for(let i=0,r=this.count;i<r;i++)gn.fromBufferAttribute(this,i),gn.transformDirection(t),this.setXYZ(i,gn.x,gn.y,gn.z);return this}set(t,i=0){return this.array.set(t,i),this}getComponent(t,i){let r=this.array[t*this.itemSize+i];return this.normalized&&(r=fa(r,this.array)),r}setComponent(t,i,r){return this.normalized&&(r=yi(r,this.array)),this.array[t*this.itemSize+i]=r,this}getX(t){let i=this.array[t*this.itemSize];return this.normalized&&(i=fa(i,this.array)),i}setX(t,i){return this.normalized&&(i=yi(i,this.array)),this.array[t*this.itemSize]=i,this}getY(t){let i=this.array[t*this.itemSize+1];return this.normalized&&(i=fa(i,this.array)),i}setY(t,i){return this.normalized&&(i=yi(i,this.array)),this.array[t*this.itemSize+1]=i,this}getZ(t){let i=this.array[t*this.itemSize+2];return this.normalized&&(i=fa(i,this.array)),i}setZ(t,i){return this.normalized&&(i=yi(i,this.array)),this.array[t*this.itemSize+2]=i,this}getW(t){let i=this.array[t*this.itemSize+3];return this.normalized&&(i=fa(i,this.array)),i}setW(t,i){return this.normalized&&(i=yi(i,this.array)),this.array[t*this.itemSize+3]=i,this}setXY(t,i,r){return t*=this.itemSize,this.normalized&&(i=yi(i,this.array),r=yi(r,this.array)),this.array[t+0]=i,this.array[t+1]=r,this}setXYZ(t,i,r,n){return t*=this.itemSize,this.normalized&&(i=yi(i,this.array),r=yi(r,this.array),n=yi(n,this.array)),this.array[t+0]=i,this.array[t+1]=r,this.array[t+2]=n,this}setXYZW(t,i,r,n,s){return t*=this.itemSize,this.normalized&&(i=yi(i,this.array),r=yi(r,this.array),n=yi(n,this.array),s=yi(s,this.array)),this.array[t+0]=i,this.array[t+1]=r,this.array[t+2]=n,this.array[t+3]=s,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(t.name=this.name),this.usage!==uw&&(t.usage=this.usage),t}}class qLe extends dr{constructor(t,i,r){super(new Int8Array(t),i,r)}}class YLe extends dr{constructor(t,i,r){super(new Uint8Array(t),i,r)}}class QLe extends dr{constructor(t,i,r){super(new Uint8ClampedArray(t),i,r)}}class KLe extends dr{constructor(t,i,r){super(new Int16Array(t),i,r)}}class oU extends dr{constructor(t,i,r){super(new Uint16Array(t),i,r)}}class ZLe extends dr{constructor(t,i,r){super(new Int32Array(t),i,r)}}class lU extends dr{constructor(t,i,r){super(new Uint32Array(t),i,r)}}class $Le extends dr{constructor(t,i,r){super(new Uint16Array(t),i,r),this.isFloat16BufferAttribute=!0}getX(t){let i=Tx(this.array[t*this.itemSize]);return this.normalized&&(i=fa(i,this.array)),i}setX(t,i){return this.normalized&&(i=yi(i,this.array)),this.array[t*this.itemSize]=Pa(i),this}getY(t){let i=Tx(this.array[t*this.itemSize+1]);return this.normalized&&(i=fa(i,this.array)),i}setY(t,i){return this.normalized&&(i=yi(i,this.array)),this.array[t*this.itemSize+1]=Pa(i),this}getZ(t){let i=Tx(this.array[t*this.itemSize+2]);return this.normalized&&(i=fa(i,this.array)),i}setZ(t,i){return this.normalized&&(i=yi(i,this.array)),this.array[t*this.itemSize+2]=Pa(i),this}getW(t){let i=Tx(this.array[t*this.itemSize+3]);return this.normalized&&(i=fa(i,this.array)),i}setW(t,i){return this.normalized&&(i=yi(i,this.array)),this.array[t*this.itemSize+3]=Pa(i),this}setXY(t,i,r){return t*=this.itemSize,this.normalized&&(i=yi(i,this.array),r=yi(r,this.array)),this.array[t+0]=Pa(i),this.array[t+1]=Pa(r),this}setXYZ(t,i,r,n){return t*=this.itemSize,this.normalized&&(i=yi(i,this.array),r=yi(r,this.array),n=yi(n,this.array)),this.array[t+0]=Pa(i),this.array[t+1]=Pa(r),this.array[t+2]=Pa(n),this}setXYZW(t,i,r,n,s){return t*=this.itemSize,this.normalized&&(i=yi(i,this.array),r=yi(r,this.array),n=yi(n,this.array),s=yi(s,this.array)),this.array[t+0]=Pa(i),this.array[t+1]=Pa(r),this.array[t+2]=Pa(n),this.array[t+3]=Pa(s),this}}class kt extends dr{constructor(t,i,r){super(new Float32Array(t),i,r)}}let JLe=0;const No=new ii,HR=new ki,pg=new oe,ro=new ya,Jy=new ya,Qn=new oe;class wi extends $c{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:JLe++}),this.uuid=po(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(pee(t)?lU:oU)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,i){return this.attributes[t]=i,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return this.attributes[t]!==void 0}addGroup(t,i,r=0){this.groups.push({start:t,count:i,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(t,i){this.drawRange.start=t,this.drawRange.count=i}applyMatrix4(t){const i=this.attributes.position;i!==void 0&&(i.applyMatrix4(t),i.needsUpdate=!0);const r=this.attributes.normal;if(r!==void 0){const s=new vi().getNormalMatrix(t);r.applyNormalMatrix(s),r.needsUpdate=!0}const n=this.attributes.tangent;return n!==void 0&&(n.transformDirection(t),n.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(t){return No.makeRotationFromQuaternion(t),this.applyMatrix4(No),this}rotateX(t){return No.makeRotationX(t),this.applyMatrix4(No),this}rotateY(t){return No.makeRotationY(t),this.applyMatrix4(No),this}rotateZ(t){return No.makeRotationZ(t),this.applyMatrix4(No),this}translate(t,i,r){return No.makeTranslation(t,i,r),this.applyMatrix4(No),this}scale(t,i,r){return No.makeScale(t,i,r),this.applyMatrix4(No),this}lookAt(t){return HR.lookAt(t),HR.updateMatrix(),this.applyMatrix4(HR.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(pg).negate(),this.translate(pg.x,pg.y,pg.z),this}setFromPoints(t){const i=[];for(let r=0,n=t.length;r<n;r++){const s=t[r];i.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new kt(i,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new ya);const t=this.attributes.position,i=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new oe(-1/0,-1/0,-1/0),new oe(1/0,1/0,1/0));return}if(t!==void 0){if(this.boundingBox.setFromBufferAttribute(t),i)for(let r=0,n=i.length;r<n;r++){const s=i[r];ro.setFromBufferAttribute(s),this.morphTargetsRelative?(Qn.addVectors(this.boundingBox.min,ro.min),this.boundingBox.expandByPoint(Qn),Qn.addVectors(this.boundingBox.max,ro.max),this.boundingBox.expandByPoint(Qn)):(this.boundingBox.expandByPoint(ro.min),this.boundingBox.expandByPoint(ro.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Zs);const t=this.attributes.position,i=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new oe,1/0);return}if(t){const r=this.boundingSphere.center;if(ro.setFromBufferAttribute(t),i)for(let s=0,a=i.length;s<a;s++){const o=i[s];Jy.setFromBufferAttribute(o),this.morphTargetsRelative?(Qn.addVectors(ro.min,Jy.min),ro.expandByPoint(Qn),Qn.addVectors(ro.max,Jy.max),ro.expandByPoint(Qn)):(ro.expandByPoint(Jy.min),ro.expandByPoint(Jy.max))}ro.getCenter(r);let n=0;for(let s=0,a=t.count;s<a;s++)Qn.fromBufferAttribute(t,s),n=Math.max(n,r.distanceToSquared(Qn));if(i)for(let s=0,a=i.length;s<a;s++){const o=i[s],l=this.morphTargetsRelative;for(let c=0,u=o.count;c<u;c++)Qn.fromBufferAttribute(o,c),l&&(pg.fromBufferAttribute(t,c),Qn.add(pg)),n=Math.max(n,r.distanceToSquared(Qn))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,i=this.attributes;if(t===null||i.position===void 0||i.normal===void 0||i.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const r=i.position,n=i.normal,s=i.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new dr(new Float32Array(4*r.count),4));const a=this.getAttribute("tangent"),o=[],l=[];for(let T=0;T<r.count;T++)o[T]=new oe,l[T]=new oe;const c=new oe,u=new oe,h=new oe,d=new ot,p=new ot,f=new ot,v=new oe,g=new oe;function m(T,E,C){c.fromBufferAttribute(r,T),u.fromBufferAttribute(r,E),h.fromBufferAttribute(r,C),d.fromBufferAttribute(s,T),p.fromBufferAttribute(s,E),f.fromBufferAttribute(s,C),u.sub(c),h.sub(c),p.sub(d),f.sub(d);const D=1/(p.x*f.y-f.x*p.y);isFinite(D)&&(v.copy(u).multiplyScalar(f.y).addScaledVector(h,-p.y).multiplyScalar(D),g.copy(h).multiplyScalar(p.x).addScaledVector(u,-f.x).multiplyScalar(D),o[T].add(v),o[E].add(v),o[C].add(v),l[T].add(g),l[E].add(g),l[C].add(g))}let x=this.groups;x.length===0&&(x=[{start:0,count:t.count}]);for(let T=0,E=x.length;T<E;++T){const C=x[T],D=C.start,I=C.count;for(let L=D,z=D+I;L<z;L+=3)m(t.getX(L+0),t.getX(L+1),t.getX(L+2))}const w=new oe,_=new oe,M=new oe,S=new oe;function A(T){M.fromBufferAttribute(n,T),S.copy(M);const E=o[T];w.copy(E),w.sub(M.multiplyScalar(M.dot(E))).normalize(),_.crossVectors(S,E);const D=_.dot(l[T])<0?-1:1;a.setXYZW(T,w.x,w.y,w.z,D)}for(let T=0,E=x.length;T<E;++T){const C=x[T],D=C.start,I=C.count;for(let L=D,z=D+I;L<z;L+=3)A(t.getX(L+0)),A(t.getX(L+1)),A(t.getX(L+2))}}computeVertexNormals(){const t=this.index,i=this.getAttribute("position");if(i!==void 0){let r=this.getAttribute("normal");if(r===void 0)r=new dr(new Float32Array(i.count*3),3),this.setAttribute("normal",r);else for(let d=0,p=r.count;d<p;d++)r.setXYZ(d,0,0,0);const n=new oe,s=new oe,a=new oe,o=new oe,l=new oe,c=new oe,u=new oe,h=new oe;if(t)for(let d=0,p=t.count;d<p;d+=3){const f=t.getX(d+0),v=t.getX(d+1),g=t.getX(d+2);n.fromBufferAttribute(i,f),s.fromBufferAttribute(i,v),a.fromBufferAttribute(i,g),u.subVectors(a,s),h.subVectors(n,s),u.cross(h),o.fromBufferAttribute(r,f),l.fromBufferAttribute(r,v),c.fromBufferAttribute(r,g),o.add(u),l.add(u),c.add(u),r.setXYZ(f,o.x,o.y,o.z),r.setXYZ(v,l.x,l.y,l.z),r.setXYZ(g,c.x,c.y,c.z)}else for(let d=0,p=i.count;d<p;d+=3)n.fromBufferAttribute(i,d+0),s.fromBufferAttribute(i,d+1),a.fromBufferAttribute(i,d+2),u.subVectors(a,s),h.subVectors(n,s),u.cross(h),r.setXYZ(d+0,u.x,u.y,u.z),r.setXYZ(d+1,u.x,u.y,u.z),r.setXYZ(d+2,u.x,u.y,u.z);this.normalizeNormals(),r.needsUpdate=!0}}normalizeNormals(){const t=this.attributes.normal;for(let i=0,r=t.count;i<r;i++)Qn.fromBufferAttribute(t,i),Qn.normalize(),t.setXYZ(i,Qn.x,Qn.y,Qn.z)}toNonIndexed(){function t(o,l){const c=o.array,u=o.itemSize,h=o.normalized,d=new c.constructor(l.length*u);let p=0,f=0;for(let v=0,g=l.length;v<g;v++){o.isInterleavedBufferAttribute?p=l[v]*o.data.stride+o.offset:p=l[v]*u;for(let m=0;m<u;m++)d[f++]=c[p++]}return new dr(d,u,h)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const i=new wi,r=this.index.array,n=this.attributes;for(const o in n){const l=n[o],c=t(l,r);i.setAttribute(o,c)}const s=this.morphAttributes;for(const o in s){const l=[],c=s[o];for(let u=0,h=c.length;u<h;u++){const d=c[u],p=t(d,r);l.push(p)}i.morphAttributes[o]=l}i.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let o=0,l=a.length;o<l;o++){const c=a[o];i.addGroup(c.start,c.count,c.materialIndex)}return i}toJSON(){const t={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const c in l)l[c]!==void 0&&(t[c]=l[c]);return t}t.data={attributes:{}};const i=this.index;i!==null&&(t.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)});const r=this.attributes;for(const l in r){const c=r[l];t.data.attributes[l]=c.toJSON(t.data)}const n={};let s=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],u=[];for(let h=0,d=c.length;h<d;h++){const p=c[h];u.push(p.toJSON(t.data))}u.length>0&&(n[l]=u,s=!0)}s&&(t.data.morphAttributes=n,t.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(t.data.groups=JSON.parse(JSON.stringify(a)));const o=this.boundingSphere;return o!==null&&(t.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),t}clone(){return new this.constructor().copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const i={};this.name=t.name;const r=t.index;r!==null&&this.setIndex(r.clone(i));const n=t.attributes;for(const c in n){const u=n[c];this.setAttribute(c,u.clone(i))}const s=t.morphAttributes;for(const c in s){const u=[],h=s[c];for(let d=0,p=h.length;d<p;d++)u.push(h[d].clone(i));this.morphAttributes[c]=u}this.morphTargetsRelative=t.morphTargetsRelative;const a=t.groups;for(let c=0,u=a.length;c<u;c++){const h=a[c];this.addGroup(h.start,h.count,h.materialIndex)}const o=t.boundingBox;o!==null&&(this.boundingBox=o.clone());const l=t.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const c8=new ii,Pp=new om,tM=new Zs,u8=new oe,fg=new oe,mg=new oe,gg=new oe,GR=new oe,iM=new oe,rM=new ot,nM=new ot,sM=new ot,h8=new oe,d8=new oe,p8=new oe,aM=new oe,oM=new oe;class En extends ki{constructor(t=new wi,i=new ap){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=i,this.updateMorphTargets()}copy(t,i){return super.copy(t,i),t.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),t.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}updateMorphTargets(){const i=this.geometry.morphAttributes,r=Object.keys(i);if(r.length>0){const n=i[r[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=n.length;s<a;s++){const o=n[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}getVertexPosition(t,i){const r=this.geometry,n=r.attributes.position,s=r.morphAttributes.position,a=r.morphTargetsRelative;i.fromBufferAttribute(n,t);const o=this.morphTargetInfluences;if(s&&o){iM.set(0,0,0);for(let l=0,c=s.length;l<c;l++){const u=o[l],h=s[l];u!==0&&(GR.fromBufferAttribute(h,t),a?iM.addScaledVector(GR,u):iM.addScaledVector(GR.sub(i),u))}i.add(iM)}return i}raycast(t,i){const r=this.geometry,n=this.material,s=this.matrixWorld;n!==void 0&&(r.boundingSphere===null&&r.computeBoundingSphere(),tM.copy(r.boundingSphere),tM.applyMatrix4(s),Pp.copy(t.ray).recast(t.near),!(tM.containsPoint(Pp.origin)===!1&&(Pp.intersectSphere(tM,u8)===null||Pp.origin.distanceToSquared(u8)>(t.far-t.near)**2))&&(c8.copy(s).invert(),Pp.copy(t.ray).applyMatrix4(c8),!(r.boundingBox!==null&&Pp.intersectsBox(r.boundingBox)===!1)&&this._computeIntersections(t,i,Pp)))}_computeIntersections(t,i,r){let n;const s=this.geometry,a=this.material,o=s.index,l=s.attributes.position,c=s.attributes.uv,u=s.attributes.uv1,h=s.attributes.normal,d=s.groups,p=s.drawRange;if(o!==null)if(Array.isArray(a))for(let f=0,v=d.length;f<v;f++){const g=d[f],m=a[g.materialIndex],x=Math.max(g.start,p.start),w=Math.min(o.count,Math.min(g.start+g.count,p.start+p.count));for(let _=x,M=w;_<M;_+=3){const S=o.getX(_),A=o.getX(_+1),T=o.getX(_+2);n=lM(this,m,t,r,c,u,h,S,A,T),n&&(n.faceIndex=Math.floor(_/3),n.face.materialIndex=g.materialIndex,i.push(n))}}else{const f=Math.max(0,p.start),v=Math.min(o.count,p.start+p.count);for(let g=f,m=v;g<m;g+=3){const x=o.getX(g),w=o.getX(g+1),_=o.getX(g+2);n=lM(this,a,t,r,c,u,h,x,w,_),n&&(n.faceIndex=Math.floor(g/3),i.push(n))}}else if(l!==void 0)if(Array.isArray(a))for(let f=0,v=d.length;f<v;f++){const g=d[f],m=a[g.materialIndex],x=Math.max(g.start,p.start),w=Math.min(l.count,Math.min(g.start+g.count,p.start+p.count));for(let _=x,M=w;_<M;_+=3){const S=_,A=_+1,T=_+2;n=lM(this,m,t,r,c,u,h,S,A,T),n&&(n.faceIndex=Math.floor(_/3),n.face.materialIndex=g.materialIndex,i.push(n))}}else{const f=Math.max(0,p.start),v=Math.min(l.count,p.start+p.count);for(let g=f,m=v;g<m;g+=3){const x=g,w=g+1,_=g+2;n=lM(this,a,t,r,c,u,h,x,w,_),n&&(n.faceIndex=Math.floor(g/3),i.push(n))}}}}function eOe(e,t,i,r,n,s,a,o){let l;if(t.side===va?l=r.intersectTriangle(a,s,n,!0,o):l=r.intersectTriangle(n,s,a,t.side===gh,o),l===null)return null;oM.copy(o),oM.applyMatrix4(e.matrixWorld);const c=i.ray.origin.distanceTo(oM);return c<i.near||c>i.far?null:{distance:c,point:oM.clone(),object:e}}function lM(e,t,i,r,n,s,a,o,l,c){e.getVertexPosition(o,fg),e.getVertexPosition(l,mg),e.getVertexPosition(c,gg);const u=eOe(e,t,i,r,fg,mg,gg,aM);if(u){n&&(rM.fromBufferAttribute(n,o),nM.fromBufferAttribute(n,l),sM.fromBufferAttribute(n,c),u.uv=oo.getInterpolation(aM,fg,mg,gg,rM,nM,sM,new ot)),s&&(rM.fromBufferAttribute(s,o),nM.fromBufferAttribute(s,l),sM.fromBufferAttribute(s,c),u.uv1=oo.getInterpolation(aM,fg,mg,gg,rM,nM,sM,new ot)),a&&(h8.fromBufferAttribute(a,o),d8.fromBufferAttribute(a,l),p8.fromBufferAttribute(a,c),u.normal=oo.getInterpolation(aM,fg,mg,gg,h8,d8,p8,new oe),u.normal.dot(r.direction)>0&&u.normal.multiplyScalar(-1));const h={a:o,b:l,c,normal:new oe,materialIndex:0};oo.getNormal(fg,mg,gg,h.normal),u.face=h}return u}class lm extends wi{constructor(t=1,i=1,r=1,n=1,s=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:i,depth:r,widthSegments:n,heightSegments:s,depthSegments:a};const o=this;n=Math.floor(n),s=Math.floor(s),a=Math.floor(a);const l=[],c=[],u=[],h=[];let d=0,p=0;f("z","y","x",-1,-1,r,i,t,a,s,0),f("z","y","x",1,-1,r,i,-t,a,s,1),f("x","z","y",1,1,t,r,i,n,a,2),f("x","z","y",1,-1,t,r,-i,n,a,3),f("x","y","z",1,-1,t,i,r,n,s,4),f("x","y","z",-1,-1,t,i,-r,n,s,5),this.setIndex(l),this.setAttribute("position",new kt(c,3)),this.setAttribute("normal",new kt(u,3)),this.setAttribute("uv",new kt(h,2));function f(v,g,m,x,w,_,M,S,A,T,E){const C=_/A,D=M/T,I=_/2,L=M/2,z=S/2,F=A+1,Q=T+1;let Y=0,O=0;const j=new oe;for(let V=0;V<Q;V++){const W=V*D-L;for(let J=0;J<F;J++){const ce=J*C-I;j[v]=ce*x,j[g]=W*w,j[m]=z,c.push(j.x,j.y,j.z),j[v]=0,j[g]=0,j[m]=S>0?1:-1,u.push(j.x,j.y,j.z),h.push(J/A),h.push(1-V/T),Y+=1}}for(let V=0;V<T;V++)for(let W=0;W<A;W++){const J=d+W+F*V,ce=d+W+F*(V+1),$=d+(W+1)+F*(V+1),ne=d+(W+1)+F*V;l.push(J,ce,ne),l.push(ce,$,ne),O+=6}o.addGroup(p,O,E),p+=O,d+=Y}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new lm(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function l0(e){const t={};for(const i in e){t[i]={};for(const r in e[i]){const n=e[i][r];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture||n.isQuaternion)?n.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[i][r]=null):t[i][r]=n.clone():Array.isArray(n)?t[i][r]=n.slice():t[i][r]=n}}return t}function ca(e){const t={};for(let i=0;i<e.length;i++){const r=l0(e[i]);for(const n in r)t[n]=r[n]}return t}function tOe(e){const t=[];for(let i=0;i<e.length;i++)t.push(e[i].clone());return t}function yee(e){const t=e.getRenderTarget();return t===null?e.outputColorSpace:t.isXRRenderTarget===!0?t.texture.colorSpace:Gi.workingColorSpace}const xee={clone:l0,merge:ca};var iOe=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,rOe=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Xl extends Ts{constructor(t){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=iOe,this.fragmentShader=rOe,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,t!==void 0&&this.setValues(t)}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=l0(t.uniforms),this.uniformsGroups=tOe(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const i=super.toJSON(t);i.glslVersion=this.glslVersion,i.uniforms={};for(const n in this.uniforms){const a=this.uniforms[n].value;a&&a.isTexture?i.uniforms[n]={type:"t",value:a.toJSON(t).uuid}:a&&a.isColor?i.uniforms[n]={type:"c",value:a.getHex()}:a&&a.isVector2?i.uniforms[n]={type:"v2",value:a.toArray()}:a&&a.isVector3?i.uniforms[n]={type:"v3",value:a.toArray()}:a&&a.isVector4?i.uniforms[n]={type:"v4",value:a.toArray()}:a&&a.isMatrix3?i.uniforms[n]={type:"m3",value:a.toArray()}:a&&a.isMatrix4?i.uniforms[n]={type:"m4",value:a.toArray()}:i.uniforms[n]={value:a}}Object.keys(this.defines).length>0&&(i.defines=this.defines),i.vertexShader=this.vertexShader,i.fragmentShader=this.fragmentShader,i.lights=this.lights,i.clipping=this.clipping;const r={};for(const n in this.extensions)this.extensions[n]===!0&&(r[n]=!0);return Object.keys(r).length>0&&(i.extensions=r),i}}class Jw extends ki{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new ii,this.projectionMatrix=new ii,this.projectionMatrixInverse=new ii,this.coordinateSystem=Oc}copy(t,i){return super.copy(t,i),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this.coordinateSystem=t.coordinateSystem,this}getWorldDirection(t){return super.getWorldDirection(t).negate()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,i){super.updateWorldMatrix(t,i),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const td=new oe,f8=new ot,m8=new ot;class Kr extends Jw{constructor(t=50,i=1,r=.1,n=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=r,this.far=n,this.focus=10,this.aspect=i,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,i){return super.copy(t,i),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=t.view===null?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const i=.5*this.getFilmHeight()/t;this.fov=o0*2*Math.atan(i),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(Rf*.5*this.fov);return .5*this.getFilmHeight()/t}getEffectiveFOV(){return o0*2*Math.atan(Math.tan(Rf*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(t,i,r){td.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(td.x,td.y).multiplyScalar(-t/td.z),td.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),r.set(td.x,td.y).multiplyScalar(-t/td.z)}getViewSize(t,i){return this.getViewBounds(t,f8,m8),i.subVectors(m8,f8)}setViewOffset(t,i,r,n,s,a){this.aspect=t/i,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=i,this.view.offsetX=r,this.view.offsetY=n,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let i=t*Math.tan(Rf*.5*this.fov)/this.zoom,r=2*i,n=this.aspect*r,s=-.5*n;const a=this.view;if(this.view!==null&&this.view.enabled){const l=a.fullWidth,c=a.fullHeight;s+=a.offsetX*n/l,i-=a.offsetY*r/c,n*=a.width/l,r*=a.height/c}const o=this.filmOffset;o!==0&&(s+=t*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+n,i,i-r,t,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const i=super.toJSON(t);return i.object.fov=this.fov,i.object.zoom=this.zoom,i.object.near=this.near,i.object.far=this.far,i.object.focus=this.focus,i.object.aspect=this.aspect,this.view!==null&&(i.object.view=Object.assign({},this.view)),i.object.filmGauge=this.filmGauge,i.object.filmOffset=this.filmOffset,i}}const vg=-90,yg=1;class wee extends ki{constructor(t,i,r){super(),this.type="CubeCamera",this.renderTarget=r,this.coordinateSystem=null,this.activeMipmapLevel=0;const n=new Kr(vg,yg,t,i);n.layers=this.layers,this.add(n);const s=new Kr(vg,yg,t,i);s.layers=this.layers,this.add(s);const a=new Kr(vg,yg,t,i);a.layers=this.layers,this.add(a);const o=new Kr(vg,yg,t,i);o.layers=this.layers,this.add(o);const l=new Kr(vg,yg,t,i);l.layers=this.layers,this.add(l);const c=new Kr(vg,yg,t,i);c.layers=this.layers,this.add(c)}updateCoordinateSystem(){const t=this.coordinateSystem,i=this.children.concat(),[r,n,s,a,o,l]=i;for(const c of i)this.remove(c);if(t===Oc)r.up.set(0,1,0),r.lookAt(1,0,0),n.up.set(0,1,0),n.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(t===hw)r.up.set(0,-1,0),r.lookAt(-1,0,0),n.up.set(0,-1,0),n.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+t);for(const c of i)this.add(c),c.updateMatrixWorld()}update(t,i){this.parent===null&&this.updateMatrixWorld();const{renderTarget:r,activeMipmapLevel:n}=this;this.coordinateSystem!==t.coordinateSystem&&(this.coordinateSystem=t.coordinateSystem,this.updateCoordinateSystem());const[s,a,o,l,c,u]=this.children,h=t.getRenderTarget(),d=t.getActiveCubeFace(),p=t.getActiveMipmapLevel(),f=t.xr.enabled;t.xr.enabled=!1;const v=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,t.setRenderTarget(r,0,n),t.render(i,s),t.setRenderTarget(r,1,n),t.render(i,a),t.setRenderTarget(r,2,n),t.render(i,o),t.setRenderTarget(r,3,n),t.render(i,l),t.setRenderTarget(r,4,n),t.render(i,c),r.texture.generateMipmaps=v,t.setRenderTarget(r,5,n),t.render(i,u),t.setRenderTarget(h,d,p),t.xr.enabled=f,r.texture.needsPMREMUpdate=!0}}class eb extends kr{constructor(t,i,r,n,s,a,o,l,c,u){t=t!==void 0?t:[],i=i!==void 0?i:vh,super(t,i,r,n,s,a,o,l,c,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}class bee extends Wl{constructor(t=1,i={}){super(t,t,i),this.isWebGLCubeRenderTarget=!0;const r={width:t,height:t,depth:1},n=[r,r,r,r,r,r];this.texture=new eb(n,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:_n}fromEquirectangularTexture(t,i){this.texture.type=i.type,this.texture.colorSpace=i.colorSpace,this.texture.generateMipmaps=i.generateMipmaps,this.texture.minFilter=i.minFilter,this.texture.magFilter=i.magFilter;const r={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},n=new lm(5,5,5),s=new Xl({name:"CubemapFromEquirect",uniforms:l0(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:va,blending:nh});s.uniforms.tEquirect.value=i;const a=new En(n,s),o=i.minFilter;return i.minFilter===Lc&&(i.minFilter=_n),new wee(1,10,this).update(t,a),i.minFilter=o,a.geometry.dispose(),a.material.dispose(),this}clear(t,i,r,n){const s=t.getRenderTarget();for(let a=0;a<6;a++)t.setRenderTarget(this,a),t.clear(i,r,n);t.setRenderTarget(s)}}const jR=new oe,nOe=new oe,sOe=new vi;class ku{constructor(t=new oe(1,0,0),i=0){this.isPlane=!0,this.normal=t,this.constant=i}set(t,i){return this.normal.copy(t),this.constant=i,this}setComponents(t,i,r,n){return this.normal.set(t,i,r),this.constant=n,this}setFromNormalAndCoplanarPoint(t,i){return this.normal.copy(t),this.constant=-i.dot(this.normal),this}setFromCoplanarPoints(t,i,r){const n=jR.subVectors(r,i).cross(nOe.subVectors(t,i)).normalize();return this.setFromNormalAndCoplanarPoint(n,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,i){return i.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t))}intersectLine(t,i){const r=t.delta(jR),n=this.normal.dot(r);if(n===0)return this.distanceToPoint(t.start)===0?i.copy(t.start):null;const s=-(t.start.dot(this.normal)+this.constant)/n;return s<0||s>1?null:i.copy(t.start).addScaledVector(r,s)}intersectsLine(t){const i=this.distanceToPoint(t.start),r=this.distanceToPoint(t.end);return i<0&&r>0||r<0&&i>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,i){const r=i||sOe.getNormalMatrix(t),n=this.coplanarPoint(jR).applyMatrix4(t),s=this.normal.applyMatrix3(r).normalize();return this.constant=-n.dot(s),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Dp=new Zs,cM=new oe;class tb{constructor(t=new ku,i=new ku,r=new ku,n=new ku,s=new ku,a=new ku){this.planes=[t,i,r,n,s,a]}set(t,i,r,n,s,a){const o=this.planes;return o[0].copy(t),o[1].copy(i),o[2].copy(r),o[3].copy(n),o[4].copy(s),o[5].copy(a),this}copy(t){const i=this.planes;for(let r=0;r<6;r++)i[r].copy(t.planes[r]);return this}setFromProjectionMatrix(t,i=Oc){const r=this.planes,n=t.elements,s=n[0],a=n[1],o=n[2],l=n[3],c=n[4],u=n[5],h=n[6],d=n[7],p=n[8],f=n[9],v=n[10],g=n[11],m=n[12],x=n[13],w=n[14],_=n[15];if(r[0].setComponents(l-s,d-c,g-p,_-m).normalize(),r[1].setComponents(l+s,d+c,g+p,_+m).normalize(),r[2].setComponents(l+a,d+u,g+f,_+x).normalize(),r[3].setComponents(l-a,d-u,g-f,_-x).normalize(),r[4].setComponents(l-o,d-h,g-v,_-w).normalize(),i===Oc)r[5].setComponents(l+o,d+h,g+v,_+w).normalize();else if(i===hw)r[5].setComponents(o,h,v,w).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+i);return this}intersectsObject(t){if(t.boundingSphere!==void 0)t.boundingSphere===null&&t.computeBoundingSphere(),Dp.copy(t.boundingSphere).applyMatrix4(t.matrixWorld);else{const i=t.geometry;i.boundingSphere===null&&i.computeBoundingSphere(),Dp.copy(i.boundingSphere).applyMatrix4(t.matrixWorld)}return this.intersectsSphere(Dp)}intersectsSprite(t){return Dp.center.set(0,0,0),Dp.radius=.7071067811865476,Dp.applyMatrix4(t.matrixWorld),this.intersectsSphere(Dp)}intersectsSphere(t){const i=this.planes,r=t.center,n=-t.radius;for(let s=0;s<6;s++)if(i[s].distanceToPoint(r)<n)return!1;return!0}intersectsBox(t){const i=this.planes;for(let r=0;r<6;r++){const n=i[r];if(cM.x=n.normal.x>0?t.max.x:t.min.x,cM.y=n.normal.y>0?t.max.y:t.min.y,cM.z=n.normal.z>0?t.max.z:t.min.z,n.distanceToPoint(cM)<0)return!1}return!0}containsPoint(t){const i=this.planes;for(let r=0;r<6;r++)if(i[r].distanceToPoint(t)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function _ee(){let e=null,t=!1,i=null,r=null;function n(s,a){i(s,a),r=e.requestAnimationFrame(n)}return{start:function(){t!==!0&&i!==null&&(r=e.requestAnimationFrame(n),t=!0)},stop:function(){e.cancelAnimationFrame(r),t=!1},setAnimationLoop:function(s){i=s},setContext:function(s){e=s}}}function aOe(e){const t=new WeakMap;function i(o,l){const c=o.array,u=o.usage,h=c.byteLength,d=e.createBuffer();e.bindBuffer(l,d),e.bufferData(l,c,u),o.onUploadCallback();let p;if(c instanceof Float32Array)p=e.FLOAT;else if(c instanceof Uint16Array)o.isFloat16BufferAttribute?p=e.HALF_FLOAT:p=e.UNSIGNED_SHORT;else if(c instanceof Int16Array)p=e.SHORT;else if(c instanceof Uint32Array)p=e.UNSIGNED_INT;else if(c instanceof Int32Array)p=e.INT;else if(c instanceof Int8Array)p=e.BYTE;else if(c instanceof Uint8Array)p=e.UNSIGNED_BYTE;else if(c instanceof Uint8ClampedArray)p=e.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+c);return{buffer:d,type:p,bytesPerElement:c.BYTES_PER_ELEMENT,version:o.version,size:h}}function r(o,l,c){const u=l.array,h=l._updateRange,d=l.updateRanges;if(e.bindBuffer(c,o),h.count===-1&&d.length===0&&e.bufferSubData(c,0,u),d.length!==0){for(let p=0,f=d.length;p<f;p++){const v=d[p];e.bufferSubData(c,v.start*u.BYTES_PER_ELEMENT,u,v.start,v.count)}l.clearUpdateRanges()}h.count!==-1&&(e.bufferSubData(c,h.offset*u.BYTES_PER_ELEMENT,u,h.offset,h.count),h.count=-1),l.onUploadCallback()}function n(o){return o.isInterleavedBufferAttribute&&(o=o.data),t.get(o)}function s(o){o.isInterleavedBufferAttribute&&(o=o.data);const l=t.get(o);l&&(e.deleteBuffer(l.buffer),t.delete(o))}function a(o,l){if(o.isInterleavedBufferAttribute&&(o=o.data),o.isGLBufferAttribute){const u=t.get(o);(!u||u.version<o.version)&&t.set(o,{buffer:o.buffer,type:o.type,bytesPerElement:o.elementSize,version:o.version});return}const c=t.get(o);if(c===void 0)t.set(o,i(o,l));else if(c.version<o.version){if(c.size!==o.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");r(c.buffer,o,l),c.version=o.version}}return{get:n,remove:s,update:a}}class F0 extends wi{constructor(t=1,i=1,r=1,n=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:i,widthSegments:r,heightSegments:n};const s=t/2,a=i/2,o=Math.floor(r),l=Math.floor(n),c=o+1,u=l+1,h=t/o,d=i/l,p=[],f=[],v=[],g=[];for(let m=0;m<u;m++){const x=m*d-a;for(let w=0;w<c;w++){const _=w*h-s;f.push(_,-x,0),v.push(0,0,1),g.push(w/o),g.push(1-m/l)}}for(let m=0;m<l;m++)for(let x=0;x<o;x++){const w=x+c*m,_=x+c*(m+1),M=x+1+c*(m+1),S=x+1+c*m;p.push(w,_,S),p.push(_,M,S)}this.setIndex(p),this.setAttribute("position",new kt(f,3)),this.setAttribute("normal",new kt(v,3)),this.setAttribute("uv",new kt(g,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new F0(t.width,t.height,t.widthSegments,t.heightSegments)}}var oOe=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,lOe=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,cOe=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,uOe=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,hOe=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,dOe=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,pOe=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,fOe=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,mOe=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,gOe=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,vOe=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,yOe=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,xOe=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,wOe=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,bOe=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,_Oe=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,SOe=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,MOe=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,EOe=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,AOe=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,COe=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,TOe=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,POe=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,DOe=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,ROe=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,IOe=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,LOe=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,OOe=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,zOe=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,NOe=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,BOe="gl_FragColor = linearToOutputTexel( gl_FragColor );",kOe=`
const mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(
	vec3( 0.8224621, 0.177538, 0.0 ),
	vec3( 0.0331941, 0.9668058, 0.0 ),
	vec3( 0.0170827, 0.0723974, 0.9105199 )
);
const mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(
	vec3( 1.2249401, - 0.2249404, 0.0 ),
	vec3( - 0.0420569, 1.0420571, 0.0 ),
	vec3( - 0.0196376, - 0.0786361, 1.0982735 )
);
vec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {
	return vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );
}
vec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {
	return vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );
}
vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,UOe=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,FOe=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,VOe=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,HOe=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,GOe=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,jOe=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,WOe=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,XOe=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,qOe=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,YOe=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,QOe=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,KOe=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,ZOe=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,$Oe=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,JOe=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,eze=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,tze=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,ize=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,rze=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,nze=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,sze=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,aze=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,oze=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,lze=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,cze=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,uze=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,hze=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,dze=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,pze=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,fze=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,mze=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,gze=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,vze=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,yze=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,xze=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,wze=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,bze=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,_ze=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,Sze=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,Mze=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,Eze=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,Aze=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Cze=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Tze=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,Pze=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,Dze=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,Rze=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,Ize=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,Lze=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,Oze=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,zze=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,Nze=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,Bze=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,kze=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,Uze=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,Fze=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,Vze=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,Hze=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,Gze=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,jze=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,Wze=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,Xze=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,qze=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,Yze=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,Qze=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,Kze=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,Zze=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,$ze=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,Jze=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,eNe=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,tNe=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
		
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
		
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		
		#else
		
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,iNe=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,rNe=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,nNe=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,sNe=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const aNe=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,oNe=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,lNe=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,cNe=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,uNe=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,hNe=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,dNe=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,pNe=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,fNe=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,mNe=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,gNe=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,vNe=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,yNe=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,xNe=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,wNe=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,bNe=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,_Ne=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,SNe=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,MNe=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,ENe=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,ANe=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,CNe=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,TNe=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,PNe=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,DNe=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,RNe=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,INe=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,LNe=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,ONe=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,zNe=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,NNe=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,BNe=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,kNe=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,UNe=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,xi={alphahash_fragment:oOe,alphahash_pars_fragment:lOe,alphamap_fragment:cOe,alphamap_pars_fragment:uOe,alphatest_fragment:hOe,alphatest_pars_fragment:dOe,aomap_fragment:pOe,aomap_pars_fragment:fOe,batching_pars_vertex:mOe,batching_vertex:gOe,begin_vertex:vOe,beginnormal_vertex:yOe,bsdfs:xOe,iridescence_fragment:wOe,bumpmap_pars_fragment:bOe,clipping_planes_fragment:_Oe,clipping_planes_pars_fragment:SOe,clipping_planes_pars_vertex:MOe,clipping_planes_vertex:EOe,color_fragment:AOe,color_pars_fragment:COe,color_pars_vertex:TOe,color_vertex:POe,common:DOe,cube_uv_reflection_fragment:ROe,defaultnormal_vertex:IOe,displacementmap_pars_vertex:LOe,displacementmap_vertex:OOe,emissivemap_fragment:zOe,emissivemap_pars_fragment:NOe,colorspace_fragment:BOe,colorspace_pars_fragment:kOe,envmap_fragment:UOe,envmap_common_pars_fragment:FOe,envmap_pars_fragment:VOe,envmap_pars_vertex:HOe,envmap_physical_pars_fragment:JOe,envmap_vertex:GOe,fog_vertex:jOe,fog_pars_vertex:WOe,fog_fragment:XOe,fog_pars_fragment:qOe,gradientmap_pars_fragment:YOe,lightmap_pars_fragment:QOe,lights_lambert_fragment:KOe,lights_lambert_pars_fragment:ZOe,lights_pars_begin:$Oe,lights_toon_fragment:eze,lights_toon_pars_fragment:tze,lights_phong_fragment:ize,lights_phong_pars_fragment:rze,lights_physical_fragment:nze,lights_physical_pars_fragment:sze,lights_fragment_begin:aze,lights_fragment_maps:oze,lights_fragment_end:lze,logdepthbuf_fragment:cze,logdepthbuf_pars_fragment:uze,logdepthbuf_pars_vertex:hze,logdepthbuf_vertex:dze,map_fragment:pze,map_pars_fragment:fze,map_particle_fragment:mze,map_particle_pars_fragment:gze,metalnessmap_fragment:vze,metalnessmap_pars_fragment:yze,morphinstance_vertex:xze,morphcolor_vertex:wze,morphnormal_vertex:bze,morphtarget_pars_vertex:_ze,morphtarget_vertex:Sze,normal_fragment_begin:Mze,normal_fragment_maps:Eze,normal_pars_fragment:Aze,normal_pars_vertex:Cze,normal_vertex:Tze,normalmap_pars_fragment:Pze,clearcoat_normal_fragment_begin:Dze,clearcoat_normal_fragment_maps:Rze,clearcoat_pars_fragment:Ize,iridescence_pars_fragment:Lze,opaque_fragment:Oze,packing:zze,premultiplied_alpha_fragment:Nze,project_vertex:Bze,dithering_fragment:kze,dithering_pars_fragment:Uze,roughnessmap_fragment:Fze,roughnessmap_pars_fragment:Vze,shadowmap_pars_fragment:Hze,shadowmap_pars_vertex:Gze,shadowmap_vertex:jze,shadowmask_pars_fragment:Wze,skinbase_vertex:Xze,skinning_pars_vertex:qze,skinning_vertex:Yze,skinnormal_vertex:Qze,specularmap_fragment:Kze,specularmap_pars_fragment:Zze,tonemapping_fragment:$ze,tonemapping_pars_fragment:Jze,transmission_fragment:eNe,transmission_pars_fragment:tNe,uv_pars_fragment:iNe,uv_pars_vertex:rNe,uv_vertex:nNe,worldpos_vertex:sNe,background_vert:aNe,background_frag:oNe,backgroundCube_vert:lNe,backgroundCube_frag:cNe,cube_vert:uNe,cube_frag:hNe,depth_vert:dNe,depth_frag:pNe,distanceRGBA_vert:fNe,distanceRGBA_frag:mNe,equirect_vert:gNe,equirect_frag:vNe,linedashed_vert:yNe,linedashed_frag:xNe,meshbasic_vert:wNe,meshbasic_frag:bNe,meshlambert_vert:_Ne,meshlambert_frag:SNe,meshmatcap_vert:MNe,meshmatcap_frag:ENe,meshnormal_vert:ANe,meshnormal_frag:CNe,meshphong_vert:TNe,meshphong_frag:PNe,meshphysical_vert:DNe,meshphysical_frag:RNe,meshtoon_vert:INe,meshtoon_frag:LNe,points_vert:ONe,points_frag:zNe,shadow_vert:NNe,shadow_frag:BNe,sprite_vert:kNe,sprite_frag:UNe},Mt={common:{diffuse:{value:new Rt(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new vi},alphaMap:{value:null},alphaMapTransform:{value:new vi},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new vi}},envmap:{envMap:{value:null},envMapRotation:{value:new vi},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new vi}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new vi}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new vi},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new vi},normalScale:{value:new ot(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new vi},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new vi}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new vi}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new vi}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Rt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Rt(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new vi},alphaTest:{value:0},uvTransform:{value:new vi}},sprite:{diffuse:{value:new Rt(16777215)},opacity:{value:1},center:{value:new ot(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new vi},alphaMap:{value:null},alphaMapTransform:{value:new vi},alphaTest:{value:0}}},Tl={basic:{uniforms:ca([Mt.common,Mt.specularmap,Mt.envmap,Mt.aomap,Mt.lightmap,Mt.fog]),vertexShader:xi.meshbasic_vert,fragmentShader:xi.meshbasic_frag},lambert:{uniforms:ca([Mt.common,Mt.specularmap,Mt.envmap,Mt.aomap,Mt.lightmap,Mt.emissivemap,Mt.bumpmap,Mt.normalmap,Mt.displacementmap,Mt.fog,Mt.lights,{emissive:{value:new Rt(0)}}]),vertexShader:xi.meshlambert_vert,fragmentShader:xi.meshlambert_frag},phong:{uniforms:ca([Mt.common,Mt.specularmap,Mt.envmap,Mt.aomap,Mt.lightmap,Mt.emissivemap,Mt.bumpmap,Mt.normalmap,Mt.displacementmap,Mt.fog,Mt.lights,{emissive:{value:new Rt(0)},specular:{value:new Rt(1118481)},shininess:{value:30}}]),vertexShader:xi.meshphong_vert,fragmentShader:xi.meshphong_frag},standard:{uniforms:ca([Mt.common,Mt.envmap,Mt.aomap,Mt.lightmap,Mt.emissivemap,Mt.bumpmap,Mt.normalmap,Mt.displacementmap,Mt.roughnessmap,Mt.metalnessmap,Mt.fog,Mt.lights,{emissive:{value:new Rt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:xi.meshphysical_vert,fragmentShader:xi.meshphysical_frag},toon:{uniforms:ca([Mt.common,Mt.aomap,Mt.lightmap,Mt.emissivemap,Mt.bumpmap,Mt.normalmap,Mt.displacementmap,Mt.gradientmap,Mt.fog,Mt.lights,{emissive:{value:new Rt(0)}}]),vertexShader:xi.meshtoon_vert,fragmentShader:xi.meshtoon_frag},matcap:{uniforms:ca([Mt.common,Mt.bumpmap,Mt.normalmap,Mt.displacementmap,Mt.fog,{matcap:{value:null}}]),vertexShader:xi.meshmatcap_vert,fragmentShader:xi.meshmatcap_frag},points:{uniforms:ca([Mt.points,Mt.fog]),vertexShader:xi.points_vert,fragmentShader:xi.points_frag},dashed:{uniforms:ca([Mt.common,Mt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:xi.linedashed_vert,fragmentShader:xi.linedashed_frag},depth:{uniforms:ca([Mt.common,Mt.displacementmap]),vertexShader:xi.depth_vert,fragmentShader:xi.depth_frag},normal:{uniforms:ca([Mt.common,Mt.bumpmap,Mt.normalmap,Mt.displacementmap,{opacity:{value:1}}]),vertexShader:xi.meshnormal_vert,fragmentShader:xi.meshnormal_frag},sprite:{uniforms:ca([Mt.sprite,Mt.fog]),vertexShader:xi.sprite_vert,fragmentShader:xi.sprite_frag},background:{uniforms:{uvTransform:{value:new vi},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:xi.background_vert,fragmentShader:xi.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new vi}},vertexShader:xi.backgroundCube_vert,fragmentShader:xi.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:xi.cube_vert,fragmentShader:xi.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:xi.equirect_vert,fragmentShader:xi.equirect_frag},distanceRGBA:{uniforms:ca([Mt.common,Mt.displacementmap,{referencePosition:{value:new oe},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:xi.distanceRGBA_vert,fragmentShader:xi.distanceRGBA_frag},shadow:{uniforms:ca([Mt.lights,Mt.fog,{color:{value:new Rt(0)},opacity:{value:1}}]),vertexShader:xi.shadow_vert,fragmentShader:xi.shadow_frag}};Tl.physical={uniforms:ca([Tl.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new vi},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new vi},clearcoatNormalScale:{value:new ot(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new vi},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new vi},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new vi},sheen:{value:0},sheenColor:{value:new Rt(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new vi},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new vi},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new vi},transmissionSamplerSize:{value:new ot},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new vi},attenuationDistance:{value:0},attenuationColor:{value:new Rt(0)},specularColor:{value:new Rt(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new vi},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new vi},anisotropyVector:{value:new ot},anisotropyMap:{value:null},anisotropyMapTransform:{value:new vi}}]),vertexShader:xi.meshphysical_vert,fragmentShader:xi.meshphysical_frag};const uM={r:0,b:0,g:0},Rp=new yo,FNe=new ii;function VNe(e,t,i,r,n,s,a){const o=new Rt(0);let l=s===!0?0:1,c,u,h=null,d=0,p=null;function f(x){let w=x.isScene===!0?x.background:null;return w&&w.isTexture&&(w=(x.backgroundBlurriness>0?i:t).get(w)),w}function v(x){let w=!1;const _=f(x);_===null?m(o,l):_&&_.isColor&&(m(_,1),w=!0);const M=e.xr.getEnvironmentBlendMode();M==="additive"?r.buffers.color.setClear(0,0,0,1,a):M==="alpha-blend"&&r.buffers.color.setClear(0,0,0,0,a),(e.autoClear||w)&&(r.buffers.depth.setTest(!0),r.buffers.depth.setMask(!0),r.buffers.color.setMask(!0),e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil))}function g(x,w){const _=f(w);_&&(_.isCubeTexture||_.mapping===k0)?(u===void 0&&(u=new En(new lm(1,1,1),new Xl({name:"BackgroundCubeMaterial",uniforms:l0(Tl.backgroundCube.uniforms),vertexShader:Tl.backgroundCube.vertexShader,fragmentShader:Tl.backgroundCube.fragmentShader,side:va,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(M,S,A){this.matrixWorld.copyPosition(A.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(u)),Rp.copy(w.backgroundRotation),Rp.x*=-1,Rp.y*=-1,Rp.z*=-1,_.isCubeTexture&&_.isRenderTargetTexture===!1&&(Rp.y*=-1,Rp.z*=-1),u.material.uniforms.envMap.value=_,u.material.uniforms.flipEnvMap.value=_.isCubeTexture&&_.isRenderTargetTexture===!1?-1:1,u.material.uniforms.backgroundBlurriness.value=w.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=w.backgroundIntensity,u.material.uniforms.backgroundRotation.value.setFromMatrix4(FNe.makeRotationFromEuler(Rp)),u.material.toneMapped=Gi.getTransfer(_.colorSpace)!==yr,(h!==_||d!==_.version||p!==e.toneMapping)&&(u.material.needsUpdate=!0,h=_,d=_.version,p=e.toneMapping),u.layers.enableAll(),x.unshift(u,u.geometry,u.material,0,0,null)):_&&_.isTexture&&(c===void 0&&(c=new En(new F0(2,2),new Xl({name:"BackgroundMaterial",uniforms:l0(Tl.background.uniforms),vertexShader:Tl.background.vertexShader,fragmentShader:Tl.background.fragmentShader,side:gh,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(c)),c.material.uniforms.t2D.value=_,c.material.uniforms.backgroundIntensity.value=w.backgroundIntensity,c.material.toneMapped=Gi.getTransfer(_.colorSpace)!==yr,_.matrixAutoUpdate===!0&&_.updateMatrix(),c.material.uniforms.uvTransform.value.copy(_.matrix),(h!==_||d!==_.version||p!==e.toneMapping)&&(c.material.needsUpdate=!0,h=_,d=_.version,p=e.toneMapping),c.layers.enableAll(),x.unshift(c,c.geometry,c.material,0,0,null))}function m(x,w){x.getRGB(uM,yee(e)),r.buffers.color.setClear(uM.r,uM.g,uM.b,w,a)}return{getClearColor:function(){return o},setClearColor:function(x,w=1){o.set(x),l=w,m(o,l)},getClearAlpha:function(){return l},setClearAlpha:function(x){l=x,m(o,l)},render:v,addToRenderList:g}}function HNe(e,t){const i=e.getParameter(e.MAX_VERTEX_ATTRIBS),r={},n=d(null);let s=n,a=!1;function o(C,D,I,L,z){let F=!1;const Q=h(L,I,D);s!==Q&&(s=Q,c(s.object)),F=p(C,L,I,z),F&&f(C,L,I,z),z!==null&&t.update(z,e.ELEMENT_ARRAY_BUFFER),(F||a)&&(a=!1,_(C,D,I,L),z!==null&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t.get(z).buffer))}function l(){return e.createVertexArray()}function c(C){return e.bindVertexArray(C)}function u(C){return e.deleteVertexArray(C)}function h(C,D,I){const L=I.wireframe===!0;let z=r[C.id];z===void 0&&(z={},r[C.id]=z);let F=z[D.id];F===void 0&&(F={},z[D.id]=F);let Q=F[L];return Q===void 0&&(Q=d(l()),F[L]=Q),Q}function d(C){const D=[],I=[],L=[];for(let z=0;z<i;z++)D[z]=0,I[z]=0,L[z]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:D,enabledAttributes:I,attributeDivisors:L,object:C,attributes:{},index:null}}function p(C,D,I,L){const z=s.attributes,F=D.attributes;let Q=0;const Y=I.getAttributes();for(const O in Y)if(Y[O].location>=0){const V=z[O];let W=F[O];if(W===void 0&&(O==="instanceMatrix"&&C.instanceMatrix&&(W=C.instanceMatrix),O==="instanceColor"&&C.instanceColor&&(W=C.instanceColor)),V===void 0||V.attribute!==W||W&&V.data!==W.data)return!0;Q++}return s.attributesNum!==Q||s.index!==L}function f(C,D,I,L){const z={},F=D.attributes;let Q=0;const Y=I.getAttributes();for(const O in Y)if(Y[O].location>=0){let V=F[O];V===void 0&&(O==="instanceMatrix"&&C.instanceMatrix&&(V=C.instanceMatrix),O==="instanceColor"&&C.instanceColor&&(V=C.instanceColor));const W={};W.attribute=V,V&&V.data&&(W.data=V.data),z[O]=W,Q++}s.attributes=z,s.attributesNum=Q,s.index=L}function v(){const C=s.newAttributes;for(let D=0,I=C.length;D<I;D++)C[D]=0}function g(C){m(C,0)}function m(C,D){const I=s.newAttributes,L=s.enabledAttributes,z=s.attributeDivisors;I[C]=1,L[C]===0&&(e.enableVertexAttribArray(C),L[C]=1),z[C]!==D&&(e.vertexAttribDivisor(C,D),z[C]=D)}function x(){const C=s.newAttributes,D=s.enabledAttributes;for(let I=0,L=D.length;I<L;I++)D[I]!==C[I]&&(e.disableVertexAttribArray(I),D[I]=0)}function w(C,D,I,L,z,F,Q){Q===!0?e.vertexAttribIPointer(C,D,I,z,F):e.vertexAttribPointer(C,D,I,L,z,F)}function _(C,D,I,L){v();const z=L.attributes,F=I.getAttributes(),Q=D.defaultAttributeValues;for(const Y in F){const O=F[Y];if(O.location>=0){let j=z[Y];if(j===void 0&&(Y==="instanceMatrix"&&C.instanceMatrix&&(j=C.instanceMatrix),Y==="instanceColor"&&C.instanceColor&&(j=C.instanceColor)),j!==void 0){const V=j.normalized,W=j.itemSize,J=t.get(j);if(J===void 0)continue;const ce=J.buffer,$=J.type,ne=J.bytesPerElement,ie=$===e.INT||$===e.UNSIGNED_INT||j.gpuType===KT;if(j.isInterleavedBufferAttribute){const de=j.data,be=de.stride,we=j.offset;if(de.isInstancedInterleavedBuffer){for(let _e=0;_e<O.locationSize;_e++)m(O.location+_e,de.meshPerAttribute);C.isInstancedMesh!==!0&&L._maxInstanceCount===void 0&&(L._maxInstanceCount=de.meshPerAttribute*de.count)}else for(let _e=0;_e<O.locationSize;_e++)g(O.location+_e);e.bindBuffer(e.ARRAY_BUFFER,ce);for(let _e=0;_e<O.locationSize;_e++)w(O.location+_e,W/O.locationSize,$,V,be*ne,(we+W/O.locationSize*_e)*ne,ie)}else{if(j.isInstancedBufferAttribute){for(let de=0;de<O.locationSize;de++)m(O.location+de,j.meshPerAttribute);C.isInstancedMesh!==!0&&L._maxInstanceCount===void 0&&(L._maxInstanceCount=j.meshPerAttribute*j.count)}else for(let de=0;de<O.locationSize;de++)g(O.location+de);e.bindBuffer(e.ARRAY_BUFFER,ce);for(let de=0;de<O.locationSize;de++)w(O.location+de,W/O.locationSize,$,V,W*ne,W/O.locationSize*de*ne,ie)}}else if(Q!==void 0){const V=Q[Y];if(V!==void 0)switch(V.length){case 2:e.vertexAttrib2fv(O.location,V);break;case 3:e.vertexAttrib3fv(O.location,V);break;case 4:e.vertexAttrib4fv(O.location,V);break;default:e.vertexAttrib1fv(O.location,V)}}}}x()}function M(){T();for(const C in r){const D=r[C];for(const I in D){const L=D[I];for(const z in L)u(L[z].object),delete L[z];delete D[I]}delete r[C]}}function S(C){if(r[C.id]===void 0)return;const D=r[C.id];for(const I in D){const L=D[I];for(const z in L)u(L[z].object),delete L[z];delete D[I]}delete r[C.id]}function A(C){for(const D in r){const I=r[D];if(I[C.id]===void 0)continue;const L=I[C.id];for(const z in L)u(L[z].object),delete L[z];delete I[C.id]}}function T(){E(),a=!0,s!==n&&(s=n,c(s.object))}function E(){n.geometry=null,n.program=null,n.wireframe=!1}return{setup:o,reset:T,resetDefaultState:E,dispose:M,releaseStatesOfGeometry:S,releaseStatesOfProgram:A,initAttributes:v,enableAttribute:g,disableUnusedAttributes:x}}function GNe(e,t,i){let r;function n(c){r=c}function s(c,u){e.drawArrays(r,c,u),i.update(u,r,1)}function a(c,u,h){h!==0&&(e.drawArraysInstanced(r,c,u,h),i.update(u,r,h))}function o(c,u,h){if(h===0)return;t.get("WEBGL_multi_draw").multiDrawArraysWEBGL(r,c,0,u,0,h);let p=0;for(let f=0;f<h;f++)p+=u[f];i.update(p,r,1)}function l(c,u,h,d){if(h===0)return;const p=t.get("WEBGL_multi_draw");if(p===null)for(let f=0;f<c.length;f++)a(c[f],u[f],d[f]);else{p.multiDrawArraysInstancedWEBGL(r,c,0,u,0,d,0,h);let f=0;for(let v=0;v<h;v++)f+=u[v];for(let v=0;v<d.length;v++)i.update(f,r,d[v])}}this.setMode=n,this.render=s,this.renderInstances=a,this.renderMultiDraw=o,this.renderMultiDrawInstances=l}function jNe(e,t,i,r){let n;function s(){if(n!==void 0)return n;if(t.has("EXT_texture_filter_anisotropic")===!0){const S=t.get("EXT_texture_filter_anisotropic");n=e.getParameter(S.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n}function a(S){return!(S!==Ys&&r.convert(S)!==e.getParameter(e.IMPLEMENTATION_COLOR_READ_FORMAT))}function o(S){const A=S===U0&&(t.has("EXT_color_buffer_half_float")||t.has("EXT_color_buffer_float"));return!(S!==jl&&r.convert(S)!==e.getParameter(e.IMPLEMENTATION_COLOR_READ_TYPE)&&S!==Ua&&!A)}function l(S){if(S==="highp"){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";S="mediump"}return S==="mediump"&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let c=i.precision!==void 0?i.precision:"highp";const u=l(c);u!==c&&(console.warn("THREE.WebGLRenderer:",c,"not supported, using",u,"instead."),c=u);const h=i.logarithmicDepthBuffer===!0,d=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),p=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),f=e.getParameter(e.MAX_TEXTURE_SIZE),v=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),g=e.getParameter(e.MAX_VERTEX_ATTRIBS),m=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),x=e.getParameter(e.MAX_VARYING_VECTORS),w=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),_=p>0,M=e.getParameter(e.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:s,getMaxPrecision:l,textureFormatReadable:a,textureTypeReadable:o,precision:c,logarithmicDepthBuffer:h,maxTextures:d,maxVertexTextures:p,maxTextureSize:f,maxCubemapSize:v,maxAttributes:g,maxVertexUniforms:m,maxVaryings:x,maxFragmentUniforms:w,vertexTextures:_,maxSamples:M}}function WNe(e){const t=this;let i=null,r=0,n=!1,s=!1;const a=new ku,o=new vi,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(h,d){const p=h.length!==0||d||r!==0||n;return n=d,r=h.length,p},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(h,d){i=u(h,d,0)},this.setState=function(h,d,p){const f=h.clippingPlanes,v=h.clipIntersection,g=h.clipShadows,m=e.get(h);if(!n||f===null||f.length===0||s&&!g)s?u(null):c();else{const x=s?0:r,w=x*4;let _=m.clippingState||null;l.value=_,_=u(f,d,w,p);for(let M=0;M!==w;++M)_[M]=i[M];m.clippingState=_,this.numIntersection=v?this.numPlanes:0,this.numPlanes+=x}};function c(){l.value!==i&&(l.value=i,l.needsUpdate=r>0),t.numPlanes=r,t.numIntersection=0}function u(h,d,p,f){const v=h!==null?h.length:0;let g=null;if(v!==0){if(g=l.value,f!==!0||g===null){const m=p+v*4,x=d.matrixWorldInverse;o.getNormalMatrix(x),(g===null||g.length<m)&&(g=new Float32Array(m));for(let w=0,_=p;w!==v;++w,_+=4)a.copy(h[w]).applyMatrix4(x,o),a.normal.toArray(g,_),g[_+3]=a.constant}l.value=g,l.needsUpdate=!0}return t.numPlanes=v,t.numIntersection=0,g}}function XNe(e){let t=new WeakMap;function i(a,o){return o===tw?a.mapping=vh:o===iw&&(a.mapping=Kd),a}function r(a){if(a&&a.isTexture){const o=a.mapping;if(o===tw||o===iw)if(t.has(a)){const l=t.get(a).texture;return i(l,a.mapping)}else{const l=a.image;if(l&&l.height>0){const c=new bee(l.height);return c.fromEquirectangularTexture(e,a),t.set(a,c),a.addEventListener("dispose",n),i(c.texture,a.mapping)}else return null}}return a}function n(a){const o=a.target;o.removeEventListener("dispose",n);const l=t.get(o);l!==void 0&&(t.delete(o),l.dispose())}function s(){t=new WeakMap}return{get:r,dispose:s}}class $u extends Jw{constructor(t=-1,i=1,r=1,n=-1,s=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=i,this.top=r,this.bottom=n,this.near=s,this.far=a,this.updateProjectionMatrix()}copy(t,i){return super.copy(t,i),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=t.view===null?null:Object.assign({},t.view),this}setViewOffset(t,i,r,n,s,a){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=i,this.view.offsetX=r,this.view.offsetY=n,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),i=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,n=(this.top+this.bottom)/2;let s=r-t,a=r+t,o=n+i,l=n-i;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=c*this.view.offsetX,a=s+c*this.view.width,o-=u*this.view.offsetY,l=o-u*this.view.height}this.projectionMatrix.makeOrthographic(s,a,o,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const i=super.toJSON(t);return i.object.zoom=this.zoom,i.object.left=this.left,i.object.right=this.right,i.object.top=this.top,i.object.bottom=this.bottom,i.object.near=this.near,i.object.far=this.far,this.view!==null&&(i.object.view=Object.assign({},this.view)),i}}const uv=4,g8=[.125,.215,.35,.446,.526,.582],ef=20,WR=new $u,v8=new Rt;let XR=null,qR=0,YR=0,QR=!1;const Yp=(1+Math.sqrt(5))/2,xg=1/Yp,y8=[new oe(-Yp,xg,0),new oe(Yp,xg,0),new oe(-xg,0,Yp),new oe(xg,0,Yp),new oe(0,Yp,-xg),new oe(0,Yp,xg),new oe(-1,1,-1),new oe(1,1,-1),new oe(-1,1,1),new oe(1,1,1)];class kz{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t,i=0,r=.1,n=100){XR=this._renderer.getRenderTarget(),qR=this._renderer.getActiveCubeFace(),YR=this._renderer.getActiveMipmapLevel(),QR=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(t,r,n,s),i>0&&this._blur(s,0,0,i),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(t,i=null){return this._fromTexture(t,i)}fromCubemap(t,i=null){return this._fromTexture(t,i)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=b8(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=w8(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(XR,qR,YR),this._renderer.xr.enabled=QR,t.scissorTest=!1,hM(t,0,0,t.width,t.height)}_fromTexture(t,i){t.mapping===vh||t.mapping===Kd?this._setSize(t.image.length===0?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),XR=this._renderer.getRenderTarget(),qR=this._renderer.getActiveCubeFace(),YR=this._renderer.getActiveMipmapLevel(),QR=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const r=i||this._allocateTargets();return this._textureToCubeUV(t,r),this._applyPMREM(r),this._cleanup(r),r}_allocateTargets(){const t=3*Math.max(this._cubeSize,112),i=4*this._cubeSize,r={magFilter:_n,minFilter:_n,generateMipmaps:!1,type:U0,format:Ys,colorSpace:Ah,depthBuffer:!1},n=x8(t,i,r);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==t||this._pingPongRenderTarget.height!==i){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=x8(t,i,r);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=qNe(s)),this._blurMaterial=YNe(s,t,i)}return n}_compileMaterial(t){const i=new En(this._lodPlanes[0],t);this._renderer.compile(i,WR)}_sceneToCubeUV(t,i,r,n){const o=new Kr(90,1,i,r),l=[1,-1,1,1,1,1],c=[1,1,1,-1,-1,-1],u=this._renderer,h=u.autoClear,d=u.toneMapping;u.getClearColor(v8),u.toneMapping=Hc,u.autoClear=!1;const p=new ap({name:"PMREM.Background",side:va,depthWrite:!1,depthTest:!1}),f=new En(new lm,p);let v=!1;const g=t.background;g?g.isColor&&(p.color.copy(g),t.background=null,v=!0):(p.color.copy(v8),v=!0);for(let m=0;m<6;m++){const x=m%3;x===0?(o.up.set(0,l[m],0),o.lookAt(c[m],0,0)):x===1?(o.up.set(0,0,l[m]),o.lookAt(0,c[m],0)):(o.up.set(0,l[m],0),o.lookAt(0,0,c[m]));const w=this._cubeSize;hM(n,x*w,m>2?w:0,w,w),u.setRenderTarget(n),v&&u.render(f,o),u.render(t,o)}f.geometry.dispose(),f.material.dispose(),u.toneMapping=d,u.autoClear=h,t.background=g}_textureToCubeUV(t,i){const r=this._renderer,n=t.mapping===vh||t.mapping===Kd;n?(this._cubemapMaterial===null&&(this._cubemapMaterial=b8()),this._cubemapMaterial.uniforms.flipEnvMap.value=t.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=w8());const s=n?this._cubemapMaterial:this._equirectMaterial,a=new En(this._lodPlanes[0],s),o=s.uniforms;o.envMap.value=t;const l=this._cubeSize;hM(i,0,0,3*l,2*l),r.setRenderTarget(i),r.render(a,WR)}_applyPMREM(t){const i=this._renderer,r=i.autoClear;i.autoClear=!1;const n=this._lodPlanes.length;for(let s=1;s<n;s++){const a=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]),o=y8[(n-s-1)%y8.length];this._blur(t,s-1,s,a,o)}i.autoClear=r}_blur(t,i,r,n,s){const a=this._pingPongRenderTarget;this._halfBlur(t,a,i,r,n,"latitudinal",s),this._halfBlur(a,t,r,r,n,"longitudinal",s)}_halfBlur(t,i,r,n,s,a,o){const l=this._renderer,c=this._blurMaterial;a!=="latitudinal"&&a!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const u=3,h=new En(this._lodPlanes[n],c),d=c.uniforms,p=this._sizeLods[r]-1,f=isFinite(s)?Math.PI/(2*p):2*Math.PI/(2*ef-1),v=s/f,g=isFinite(s)?1+Math.floor(u*v):ef;g>ef&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${g} samples when the maximum is set to ${ef}`);const m=[];let x=0;for(let A=0;A<ef;++A){const T=A/v,E=Math.exp(-T*T/2);m.push(E),A===0?x+=E:A<g&&(x+=2*E)}for(let A=0;A<m.length;A++)m[A]=m[A]/x;d.envMap.value=t.texture,d.samples.value=g,d.weights.value=m,d.latitudinal.value=a==="latitudinal",o&&(d.poleAxis.value=o);const{_lodMax:w}=this;d.dTheta.value=f,d.mipInt.value=w-r;const _=this._sizeLods[n],M=3*_*(n>w-uv?n-w+uv:0),S=4*(this._cubeSize-_);hM(i,M,S,3*_,2*_),l.setRenderTarget(i),l.render(h,WR)}}function qNe(e){const t=[],i=[],r=[];let n=e;const s=e-uv+1+g8.length;for(let a=0;a<s;a++){const o=Math.pow(2,n);i.push(o);let l=1/o;a>e-uv?l=g8[a-e+uv-1]:a===0&&(l=0),r.push(l);const c=1/(o-2),u=-c,h=1+c,d=[u,u,h,u,h,h,u,u,h,h,u,h],p=6,f=6,v=3,g=2,m=1,x=new Float32Array(v*f*p),w=new Float32Array(g*f*p),_=new Float32Array(m*f*p);for(let S=0;S<p;S++){const A=S%3*2/3-1,T=S>2?0:-1,E=[A,T,0,A+2/3,T,0,A+2/3,T+1,0,A,T,0,A+2/3,T+1,0,A,T+1,0];x.set(E,v*f*S),w.set(d,g*f*S);const C=[S,S,S,S,S,S];_.set(C,m*f*S)}const M=new wi;M.setAttribute("position",new dr(x,v)),M.setAttribute("uv",new dr(w,g)),M.setAttribute("faceIndex",new dr(_,m)),t.push(M),n>uv&&n--}return{lodPlanes:t,sizeLods:i,sigmas:r}}function x8(e,t,i){const r=new Wl(e,t,i);return r.texture.mapping=k0,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function hM(e,t,i,r,n){e.viewport.set(t,i,r,n),e.scissor.set(t,i,r,n)}function YNe(e,t,i){const r=new Float32Array(ef),n=new oe(0,1,0);return new Xl({name:"SphericalGaussianBlur",defines:{n:ef,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n}},vertexShader:cU(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:nh,depthTest:!1,depthWrite:!1})}function w8(){return new Xl({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:cU(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:nh,depthTest:!1,depthWrite:!1})}function b8(){return new Xl({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:cU(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:nh,depthTest:!1,depthWrite:!1})}function cU(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function QNe(e){let t=new WeakMap,i=null;function r(o){if(o&&o.isTexture){const l=o.mapping,c=l===tw||l===iw,u=l===vh||l===Kd;if(c||u){let h=t.get(o);const d=h!==void 0?h.texture.pmremVersion:0;if(o.isRenderTargetTexture&&o.pmremVersion!==d)return i===null&&(i=new kz(e)),h=c?i.fromEquirectangular(o,h):i.fromCubemap(o,h),h.texture.pmremVersion=o.pmremVersion,t.set(o,h),h.texture;if(h!==void 0)return h.texture;{const p=o.image;return c&&p&&p.height>0||u&&p&&n(p)?(i===null&&(i=new kz(e)),h=c?i.fromEquirectangular(o):i.fromCubemap(o),h.texture.pmremVersion=o.pmremVersion,t.set(o,h),o.addEventListener("dispose",s),h.texture):null}}}return o}function n(o){let l=0;const c=6;for(let u=0;u<c;u++)o[u]!==void 0&&l++;return l===c}function s(o){const l=o.target;l.removeEventListener("dispose",s);const c=t.get(l);c!==void 0&&(t.delete(l),c.dispose())}function a(){t=new WeakMap,i!==null&&(i.dispose(),i=null)}return{get:r,dispose:a}}function KNe(e){const t={};function i(r){if(t[r]!==void 0)return t[r];let n;switch(r){case"WEBGL_depth_texture":n=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=e.getExtension(r)}return t[r]=n,n}return{has:function(r){return i(r)!==null},init:function(){i("EXT_color_buffer_float"),i("WEBGL_clip_cull_distance"),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture"),i("WEBGL_render_shared_exponent")},get:function(r){const n=i(r);return n===null&&Ov("THREE.WebGLRenderer: "+r+" extension not supported."),n}}}function ZNe(e,t,i,r){const n={},s=new WeakMap;function a(h){const d=h.target;d.index!==null&&t.remove(d.index);for(const f in d.attributes)t.remove(d.attributes[f]);for(const f in d.morphAttributes){const v=d.morphAttributes[f];for(let g=0,m=v.length;g<m;g++)t.remove(v[g])}d.removeEventListener("dispose",a),delete n[d.id];const p=s.get(d);p&&(t.remove(p),s.delete(d)),r.releaseStatesOfGeometry(d),d.isInstancedBufferGeometry===!0&&delete d._maxInstanceCount,i.memory.geometries--}function o(h,d){return n[d.id]===!0||(d.addEventListener("dispose",a),n[d.id]=!0,i.memory.geometries++),d}function l(h){const d=h.attributes;for(const f in d)t.update(d[f],e.ARRAY_BUFFER);const p=h.morphAttributes;for(const f in p){const v=p[f];for(let g=0,m=v.length;g<m;g++)t.update(v[g],e.ARRAY_BUFFER)}}function c(h){const d=[],p=h.index,f=h.attributes.position;let v=0;if(p!==null){const x=p.array;v=p.version;for(let w=0,_=x.length;w<_;w+=3){const M=x[w+0],S=x[w+1],A=x[w+2];d.push(M,S,S,A,A,M)}}else if(f!==void 0){const x=f.array;v=f.version;for(let w=0,_=x.length/3-1;w<_;w+=3){const M=w+0,S=w+1,A=w+2;d.push(M,S,S,A,A,M)}}else return;const g=new(pee(d)?lU:oU)(d,1);g.version=v;const m=s.get(h);m&&t.remove(m),s.set(h,g)}function u(h){const d=s.get(h);if(d){const p=h.index;p!==null&&d.version<p.version&&c(h)}else c(h);return s.get(h)}return{get:o,update:l,getWireframeAttribute:u}}function $Ne(e,t,i){let r;function n(d){r=d}let s,a;function o(d){s=d.type,a=d.bytesPerElement}function l(d,p){e.drawElements(r,p,s,d*a),i.update(p,r,1)}function c(d,p,f){f!==0&&(e.drawElementsInstanced(r,p,s,d*a,f),i.update(p,r,f))}function u(d,p,f){if(f===0)return;t.get("WEBGL_multi_draw").multiDrawElementsWEBGL(r,p,0,s,d,0,f);let g=0;for(let m=0;m<f;m++)g+=p[m];i.update(g,r,1)}function h(d,p,f,v){if(f===0)return;const g=t.get("WEBGL_multi_draw");if(g===null)for(let m=0;m<d.length;m++)c(d[m]/a,p[m],v[m]);else{g.multiDrawElementsInstancedWEBGL(r,p,0,s,d,0,v,0,f);let m=0;for(let x=0;x<f;x++)m+=p[x];for(let x=0;x<v.length;x++)i.update(m,r,v[x])}}this.setMode=n,this.setIndex=o,this.render=l,this.renderInstances=c,this.renderMultiDraw=u,this.renderMultiDrawInstances=h}function JNe(e){const t={geometries:0,textures:0},i={frame:0,calls:0,triangles:0,points:0,lines:0};function r(s,a,o){switch(i.calls++,a){case e.TRIANGLES:i.triangles+=o*(s/3);break;case e.LINES:i.lines+=o*(s/2);break;case e.LINE_STRIP:i.lines+=o*(s-1);break;case e.LINE_LOOP:i.lines+=o*s;break;case e.POINTS:i.points+=o*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",a);break}}function n(){i.calls=0,i.triangles=0,i.points=0,i.lines=0}return{memory:t,render:i,programs:null,autoReset:!0,reset:n,update:r}}function eBe(e,t,i){const r=new WeakMap,n=new tr;function s(a,o,l){const c=a.morphTargetInfluences,u=o.morphAttributes.position||o.morphAttributes.normal||o.morphAttributes.color,h=u!==void 0?u.length:0;let d=r.get(o);if(d===void 0||d.count!==h){let E=function(){A.dispose(),r.delete(o),o.removeEventListener("dispose",E)};d!==void 0&&d.texture.dispose();const p=o.morphAttributes.position!==void 0,f=o.morphAttributes.normal!==void 0,v=o.morphAttributes.color!==void 0,g=o.morphAttributes.position||[],m=o.morphAttributes.normal||[],x=o.morphAttributes.color||[];let w=0;p===!0&&(w=1),f===!0&&(w=2),v===!0&&(w=3);let _=o.attributes.position.count*w,M=1;_>t.maxTextureSize&&(M=Math.ceil(_/t.maxTextureSize),_=t.maxTextureSize);const S=new Float32Array(_*M*4*h),A=new n2(S,_,M,h);A.type=Ua,A.needsUpdate=!0;const T=w*4;for(let C=0;C<h;C++){const D=g[C],I=m[C],L=x[C],z=_*M*4*C;for(let F=0;F<D.count;F++){const Q=F*T;p===!0&&(n.fromBufferAttribute(D,F),S[z+Q+0]=n.x,S[z+Q+1]=n.y,S[z+Q+2]=n.z,S[z+Q+3]=0),f===!0&&(n.fromBufferAttribute(I,F),S[z+Q+4]=n.x,S[z+Q+5]=n.y,S[z+Q+6]=n.z,S[z+Q+7]=0),v===!0&&(n.fromBufferAttribute(L,F),S[z+Q+8]=n.x,S[z+Q+9]=n.y,S[z+Q+10]=n.z,S[z+Q+11]=L.itemSize===4?n.w:1)}}d={count:h,texture:A,size:new ot(_,M)},r.set(o,d),o.addEventListener("dispose",E)}if(a.isInstancedMesh===!0&&a.morphTexture!==null)l.getUniforms().setValue(e,"morphTexture",a.morphTexture,i);else{let p=0;for(let v=0;v<c.length;v++)p+=c[v];const f=o.morphTargetsRelative?1:1-p;l.getUniforms().setValue(e,"morphTargetBaseInfluence",f),l.getUniforms().setValue(e,"morphTargetInfluences",c)}l.getUniforms().setValue(e,"morphTargetsTexture",d.texture,i),l.getUniforms().setValue(e,"morphTargetsTextureSize",d.size)}return{update:s}}function tBe(e,t,i,r){let n=new WeakMap;function s(l){const c=r.render.frame,u=l.geometry,h=t.get(l,u);if(n.get(h)!==c&&(t.update(h),n.set(h,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",o)===!1&&l.addEventListener("dispose",o),n.get(l)!==c&&(i.update(l.instanceMatrix,e.ARRAY_BUFFER),l.instanceColor!==null&&i.update(l.instanceColor,e.ARRAY_BUFFER),n.set(l,c))),l.isSkinnedMesh){const d=l.skeleton;n.get(d)!==c&&(d.update(),n.set(d,c))}return h}function a(){n=new WeakMap}function o(l){const c=l.target;c.removeEventListener("dispose",o),i.remove(c.instanceMatrix),c.instanceColor!==null&&i.remove(c.instanceColor)}return{update:s,dispose:a}}class uU extends kr{constructor(t,i,r,n,s,a,o,l,c,u=Df){if(u!==Df&&u!==Qf)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");r===void 0&&u===Df&&(r=yh),r===void 0&&u===Qf&&(r=Yf),super(null,n,s,a,o,l,u,r,c),this.isDepthTexture=!0,this.image={width:t,height:i},this.magFilter=o!==void 0?o:os,this.minFilter=l!==void 0?l:os,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(t){return super.copy(t),this.compareFunction=t.compareFunction,this}toJSON(t){const i=super.toJSON(t);return this.compareFunction!==null&&(i.compareFunction=this.compareFunction),i}}const See=new kr,_8=new uU(1,1),Mee=new n2,Eee=new aU,Aee=new eb,S8=[],M8=[],E8=new Float32Array(16),A8=new Float32Array(9),C8=new Float32Array(4);function V0(e,t,i){const r=e[0];if(r<=0||r>0)return e;const n=t*i;let s=S8[n];if(s===void 0&&(s=new Float32Array(n),S8[n]=s),t!==0){r.toArray(s,0);for(let a=1,o=0;a!==t;++a)o+=i,e[a].toArray(s,o)}return s}function Hn(e,t){if(e.length!==t.length)return!1;for(let i=0,r=e.length;i<r;i++)if(e[i]!==t[i])return!1;return!0}function Gn(e,t){for(let i=0,r=t.length;i<r;i++)e[i]=t[i]}function s2(e,t){let i=M8[t];i===void 0&&(i=new Int32Array(t),M8[t]=i);for(let r=0;r!==t;++r)i[r]=e.allocateTextureUnit();return i}function iBe(e,t){const i=this.cache;i[0]!==t&&(e.uniform1f(this.addr,t),i[0]=t)}function rBe(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2f(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(Hn(i,t))return;e.uniform2fv(this.addr,t),Gn(i,t)}}function nBe(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3f(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else if(t.r!==void 0)(i[0]!==t.r||i[1]!==t.g||i[2]!==t.b)&&(e.uniform3f(this.addr,t.r,t.g,t.b),i[0]=t.r,i[1]=t.g,i[2]=t.b);else{if(Hn(i,t))return;e.uniform3fv(this.addr,t),Gn(i,t)}}function sBe(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(Hn(i,t))return;e.uniform4fv(this.addr,t),Gn(i,t)}}function aBe(e,t){const i=this.cache,r=t.elements;if(r===void 0){if(Hn(i,t))return;e.uniformMatrix2fv(this.addr,!1,t),Gn(i,t)}else{if(Hn(i,r))return;C8.set(r),e.uniformMatrix2fv(this.addr,!1,C8),Gn(i,r)}}function oBe(e,t){const i=this.cache,r=t.elements;if(r===void 0){if(Hn(i,t))return;e.uniformMatrix3fv(this.addr,!1,t),Gn(i,t)}else{if(Hn(i,r))return;A8.set(r),e.uniformMatrix3fv(this.addr,!1,A8),Gn(i,r)}}function lBe(e,t){const i=this.cache,r=t.elements;if(r===void 0){if(Hn(i,t))return;e.uniformMatrix4fv(this.addr,!1,t),Gn(i,t)}else{if(Hn(i,r))return;E8.set(r),e.uniformMatrix4fv(this.addr,!1,E8),Gn(i,r)}}function cBe(e,t){const i=this.cache;i[0]!==t&&(e.uniform1i(this.addr,t),i[0]=t)}function uBe(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2i(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(Hn(i,t))return;e.uniform2iv(this.addr,t),Gn(i,t)}}function hBe(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3i(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else{if(Hn(i,t))return;e.uniform3iv(this.addr,t),Gn(i,t)}}function dBe(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(Hn(i,t))return;e.uniform4iv(this.addr,t),Gn(i,t)}}function pBe(e,t){const i=this.cache;i[0]!==t&&(e.uniform1ui(this.addr,t),i[0]=t)}function fBe(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2ui(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(Hn(i,t))return;e.uniform2uiv(this.addr,t),Gn(i,t)}}function mBe(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3ui(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else{if(Hn(i,t))return;e.uniform3uiv(this.addr,t),Gn(i,t)}}function gBe(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(Hn(i,t))return;e.uniform4uiv(this.addr,t),Gn(i,t)}}function vBe(e,t,i){const r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n);let s;this.type===e.SAMPLER_2D_SHADOW?(_8.compareFunction=nU,s=_8):s=See,i.setTexture2D(t||s,n)}function yBe(e,t,i){const r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTexture3D(t||Eee,n)}function xBe(e,t,i){const r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTextureCube(t||Aee,n)}function wBe(e,t,i){const r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTexture2DArray(t||Mee,n)}function bBe(e){switch(e){case 5126:return iBe;case 35664:return rBe;case 35665:return nBe;case 35666:return sBe;case 35674:return aBe;case 35675:return oBe;case 35676:return lBe;case 5124:case 35670:return cBe;case 35667:case 35671:return uBe;case 35668:case 35672:return hBe;case 35669:case 35673:return dBe;case 5125:return pBe;case 36294:return fBe;case 36295:return mBe;case 36296:return gBe;case 35678:case 36198:case 36298:case 36306:case 35682:return vBe;case 35679:case 36299:case 36307:return yBe;case 35680:case 36300:case 36308:case 36293:return xBe;case 36289:case 36303:case 36311:case 36292:return wBe}}function _Be(e,t){e.uniform1fv(this.addr,t)}function SBe(e,t){const i=V0(t,this.size,2);e.uniform2fv(this.addr,i)}function MBe(e,t){const i=V0(t,this.size,3);e.uniform3fv(this.addr,i)}function EBe(e,t){const i=V0(t,this.size,4);e.uniform4fv(this.addr,i)}function ABe(e,t){const i=V0(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,i)}function CBe(e,t){const i=V0(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,i)}function TBe(e,t){const i=V0(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,i)}function PBe(e,t){e.uniform1iv(this.addr,t)}function DBe(e,t){e.uniform2iv(this.addr,t)}function RBe(e,t){e.uniform3iv(this.addr,t)}function IBe(e,t){e.uniform4iv(this.addr,t)}function LBe(e,t){e.uniform1uiv(this.addr,t)}function OBe(e,t){e.uniform2uiv(this.addr,t)}function zBe(e,t){e.uniform3uiv(this.addr,t)}function NBe(e,t){e.uniform4uiv(this.addr,t)}function BBe(e,t,i){const r=this.cache,n=t.length,s=s2(i,n);Hn(r,s)||(e.uniform1iv(this.addr,s),Gn(r,s));for(let a=0;a!==n;++a)i.setTexture2D(t[a]||See,s[a])}function kBe(e,t,i){const r=this.cache,n=t.length,s=s2(i,n);Hn(r,s)||(e.uniform1iv(this.addr,s),Gn(r,s));for(let a=0;a!==n;++a)i.setTexture3D(t[a]||Eee,s[a])}function UBe(e,t,i){const r=this.cache,n=t.length,s=s2(i,n);Hn(r,s)||(e.uniform1iv(this.addr,s),Gn(r,s));for(let a=0;a!==n;++a)i.setTextureCube(t[a]||Aee,s[a])}function FBe(e,t,i){const r=this.cache,n=t.length,s=s2(i,n);Hn(r,s)||(e.uniform1iv(this.addr,s),Gn(r,s));for(let a=0;a!==n;++a)i.setTexture2DArray(t[a]||Mee,s[a])}function VBe(e){switch(e){case 5126:return _Be;case 35664:return SBe;case 35665:return MBe;case 35666:return EBe;case 35674:return ABe;case 35675:return CBe;case 35676:return TBe;case 5124:case 35670:return PBe;case 35667:case 35671:return DBe;case 35668:case 35672:return RBe;case 35669:case 35673:return IBe;case 5125:return LBe;case 36294:return OBe;case 36295:return zBe;case 36296:return NBe;case 35678:case 36198:case 36298:case 36306:case 35682:return BBe;case 35679:case 36299:case 36307:return kBe;case 35680:case 36300:case 36308:case 36293:return UBe;case 36289:case 36303:case 36311:case 36292:return FBe}}class HBe{constructor(t,i,r){this.id=t,this.addr=r,this.cache=[],this.type=i.type,this.setValue=bBe(i.type)}}class GBe{constructor(t,i,r){this.id=t,this.addr=r,this.cache=[],this.type=i.type,this.size=i.size,this.setValue=VBe(i.type)}}class jBe{constructor(t){this.id=t,this.seq=[],this.map={}}setValue(t,i,r){const n=this.seq;for(let s=0,a=n.length;s!==a;++s){const o=n[s];o.setValue(t,i[o.id],r)}}}const KR=/(\w+)(\])?(\[|\.)?/g;function T8(e,t){e.seq.push(t),e.map[t.id]=t}function WBe(e,t,i){const r=e.name,n=r.length;for(KR.lastIndex=0;;){const s=KR.exec(r),a=KR.lastIndex;let o=s[1];const l=s[2]==="]",c=s[3];if(l&&(o=o|0),c===void 0||c==="["&&a+2===n){T8(i,c===void 0?new HBe(o,e,t):new GBe(o,e,t));break}else{let h=i.map[o];h===void 0&&(h=new jBe(o),T8(i,h)),i=h}}}class DE{constructor(t,i){this.seq=[],this.map={};const r=t.getProgramParameter(i,t.ACTIVE_UNIFORMS);for(let n=0;n<r;++n){const s=t.getActiveUniform(i,n),a=t.getUniformLocation(i,s.name);WBe(s,a,this)}}setValue(t,i,r,n){const s=this.map[i];s!==void 0&&s.setValue(t,r,n)}setOptional(t,i,r){const n=i[r];n!==void 0&&this.setValue(t,r,n)}static upload(t,i,r,n){for(let s=0,a=i.length;s!==a;++s){const o=i[s],l=r[o.id];l.needsUpdate!==!1&&o.setValue(t,l.value,n)}}static seqWithValue(t,i){const r=[];for(let n=0,s=t.length;n!==s;++n){const a=t[n];a.id in i&&r.push(a)}return r}}function P8(e,t,i){const r=e.createShader(t);return e.shaderSource(r,i),e.compileShader(r),r}const XBe=37297;let qBe=0;function YBe(e,t){const i=e.split(`
`),r=[],n=Math.max(t-6,0),s=Math.min(t+6,i.length);for(let a=n;a<s;a++){const o=a+1;r.push(`${o===t?">":" "} ${o}: ${i[a]}`)}return r.join(`
`)}function QBe(e){const t=Gi.getPrimaries(Gi.workingColorSpace),i=Gi.getPrimaries(e);let r;switch(t===i?r="":t===cw&&i===lw?r="LinearDisplayP3ToLinearSRGB":t===lw&&i===cw&&(r="LinearSRGBToLinearDisplayP3"),e){case Ah:case $w:return[r,"LinearTransferOETF"];case Vo:case r2:return[r,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",e),[r,"LinearTransferOETF"]}}function D8(e,t,i){const r=e.getShaderParameter(t,e.COMPILE_STATUS),n=e.getShaderInfoLog(t).trim();if(r&&n==="")return"";const s=/ERROR: 0:(\d+)/.exec(n);if(s){const a=parseInt(s[1]);return i.toUpperCase()+`

`+n+`

`+YBe(e.getShaderSource(t),a)}else return n}function KBe(e,t){const i=QBe(t);return`vec4 ${e}( vec4 value ) { return ${i[0]}( ${i[1]}( value ) ); }`}function ZBe(e,t){let i;switch(t){case qJ:i="Linear";break;case YJ:i="Reinhard";break;case QJ:i="OptimizedCineon";break;case Xk:i="ACESFilmic";break;case ZJ:i="AgX";break;case $J:i="Neutral";break;case KJ:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),i="Linear"}return"vec3 "+e+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}const dM=new oe;function $Be(){Gi.getLuminanceCoefficients(dM);const e=dM.x.toFixed(4),t=dM.y.toFixed(4),i=dM.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${e}, ${t}, ${i} );`,"	return dot( weights, rgb );","}"].join(`
`)}function JBe(e){return[e.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",e.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(Px).join(`
`)}function eke(e){const t=[];for(const i in e){const r=e[i];r!==!1&&t.push("#define "+i+" "+r)}return t.join(`
`)}function tke(e,t){const i={},r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let n=0;n<r;n++){const s=e.getActiveAttrib(t,n),a=s.name;let o=1;s.type===e.FLOAT_MAT2&&(o=2),s.type===e.FLOAT_MAT3&&(o=3),s.type===e.FLOAT_MAT4&&(o=4),i[a]={type:s.type,location:e.getAttribLocation(t,a),locationSize:o}}return i}function Px(e){return e!==""}function R8(e,t){const i=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,i).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function I8(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const ike=/^[ \t]*#include +<([\w\d./]+)>/gm;function Uz(e){return e.replace(ike,nke)}const rke=new Map;function nke(e,t){let i=xi[t];if(i===void 0){const r=rke.get(t);if(r!==void 0)i=xi[r],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',t,r);else throw new Error("Can not resolve #include <"+t+">")}return Uz(i)}const ske=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function L8(e){return e.replace(ske,ake)}function ake(e,t,i,r){let n="";for(let s=parseInt(t);s<parseInt(i);s++)n+=r.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return n}function O8(e){let t=`precision ${e.precision} float;
	precision ${e.precision} int;
	precision ${e.precision} sampler2D;
	precision ${e.precision} samplerCube;
	precision ${e.precision} sampler3D;
	precision ${e.precision} sampler2DArray;
	precision ${e.precision} sampler2DShadow;
	precision ${e.precision} samplerCubeShadow;
	precision ${e.precision} sampler2DArrayShadow;
	precision ${e.precision} isampler2D;
	precision ${e.precision} isampler3D;
	precision ${e.precision} isamplerCube;
	precision ${e.precision} isampler2DArray;
	precision ${e.precision} usampler2D;
	precision ${e.precision} usampler3D;
	precision ${e.precision} usamplerCube;
	precision ${e.precision} usampler2DArray;
	`;return e.precision==="highp"?t+=`
#define HIGH_PRECISION`:e.precision==="mediump"?t+=`
#define MEDIUM_PRECISION`:e.precision==="lowp"&&(t+=`
#define LOW_PRECISION`),t}function oke(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===YT?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===t1?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===El&&(t="SHADOWMAP_TYPE_VSM"),t}function lke(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case vh:case Kd:t="ENVMAP_TYPE_CUBE";break;case k0:t="ENVMAP_TYPE_CUBE_UV";break}return t}function cke(e){let t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case Kd:t="ENVMAP_MODE_REFRACTION";break}return t}function uke(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case Kw:t="ENVMAP_BLENDING_MULTIPLY";break;case WJ:t="ENVMAP_BLENDING_MIX";break;case XJ:t="ENVMAP_BLENDING_ADD";break}return t}function hke(e){const t=e.envMapCubeUVHeight;if(t===null)return null;const i=Math.log2(t)-2,r=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,i),7*16)),texelHeight:r,maxMip:i}}function dke(e,t,i,r){const n=e.getContext(),s=i.defines;let a=i.vertexShader,o=i.fragmentShader;const l=oke(i),c=lke(i),u=cke(i),h=uke(i),d=hke(i),p=JBe(i),f=eke(s),v=n.createProgram();let g,m,x=i.glslVersion?"#version "+i.glslVersion+`
`:"";i.isRawShaderMaterial?(g=["#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,f].filter(Px).join(`
`),g.length>0&&(g+=`
`),m=["#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,f].filter(Px).join(`
`),m.length>0&&(m+=`
`)):(g=[O8(i),"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,f,i.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",i.batching?"#define USE_BATCHING":"",i.batchingColor?"#define USE_BATCHING_COLOR":"",i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.instancingMorph?"#define USE_INSTANCING_MORPH":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+u:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",i.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",i.displacementMap?"#define USE_DISPLACEMENTMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.anisotropy?"#define USE_ANISOTROPY":"",i.anisotropyMap?"#define USE_ANISOTROPYMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",i.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaHash?"#define USE_ALPHAHASH":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",i.mapUv?"#define MAP_UV "+i.mapUv:"",i.alphaMapUv?"#define ALPHAMAP_UV "+i.alphaMapUv:"",i.lightMapUv?"#define LIGHTMAP_UV "+i.lightMapUv:"",i.aoMapUv?"#define AOMAP_UV "+i.aoMapUv:"",i.emissiveMapUv?"#define EMISSIVEMAP_UV "+i.emissiveMapUv:"",i.bumpMapUv?"#define BUMPMAP_UV "+i.bumpMapUv:"",i.normalMapUv?"#define NORMALMAP_UV "+i.normalMapUv:"",i.displacementMapUv?"#define DISPLACEMENTMAP_UV "+i.displacementMapUv:"",i.metalnessMapUv?"#define METALNESSMAP_UV "+i.metalnessMapUv:"",i.roughnessMapUv?"#define ROUGHNESSMAP_UV "+i.roughnessMapUv:"",i.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+i.anisotropyMapUv:"",i.clearcoatMapUv?"#define CLEARCOATMAP_UV "+i.clearcoatMapUv:"",i.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+i.clearcoatNormalMapUv:"",i.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+i.clearcoatRoughnessMapUv:"",i.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+i.iridescenceMapUv:"",i.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+i.iridescenceThicknessMapUv:"",i.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+i.sheenColorMapUv:"",i.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+i.sheenRoughnessMapUv:"",i.specularMapUv?"#define SPECULARMAP_UV "+i.specularMapUv:"",i.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+i.specularColorMapUv:"",i.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+i.specularIntensityMapUv:"",i.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+i.transmissionMapUv:"",i.thicknessMapUv?"#define THICKNESSMAP_UV "+i.thicknessMapUv:"",i.vertexTangents&&i.flatShading===!1?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUv1s?"#define USE_UV1":"",i.vertexUv2s?"#define USE_UV2":"",i.vertexUv3s?"#define USE_UV3":"",i.pointsUvs?"#define USE_POINTS_UV":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&i.flatShading===!1?"#define USE_MORPHNORMALS":"",i.morphColors?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.numLightProbes>0?"#define USE_LIGHT_PROBES":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Px).join(`
`),m=[O8(i),"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,f,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+c:"",i.envMap?"#define "+u:"",i.envMap?"#define "+h:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",i.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.anisotropy?"#define USE_ANISOTROPY":"",i.anisotropyMap?"#define USE_ANISOTROPYMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.dispersion?"#define USE_DISPERSION":"",i.iridescence?"#define USE_IRIDESCENCE":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",i.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.alphaHash?"#define USE_ALPHAHASH":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.vertexTangents&&i.flatShading===!1?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor||i.batchingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUv1s?"#define USE_UV1":"",i.vertexUv2s?"#define USE_UV2":"",i.vertexUv3s?"#define USE_UV3":"",i.pointsUvs?"#define USE_POINTS_UV":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.numLightProbes>0?"#define USE_LIGHT_PROBES":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==Hc?"#define TONE_MAPPING":"",i.toneMapping!==Hc?xi.tonemapping_pars_fragment:"",i.toneMapping!==Hc?ZBe("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",xi.colorspace_pars_fragment,KBe("linearToOutputTexel",i.outputColorSpace),$Be(),i.useDepthPacking?"#define DEPTH_PACKING "+i.depthPacking:"",`
`].filter(Px).join(`
`)),a=Uz(a),a=R8(a,i),a=I8(a,i),o=Uz(o),o=R8(o,i),o=I8(o,i),a=L8(a),o=L8(o),i.isRawShaderMaterial!==!0&&(x=`#version 300 es
`,g=[p,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+g,m=["#define varying in",i.glslVersion===Nz?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===Nz?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+m);const w=x+g+a,_=x+m+o,M=P8(n,n.VERTEX_SHADER,w),S=P8(n,n.FRAGMENT_SHADER,_);n.attachShader(v,M),n.attachShader(v,S),i.index0AttributeName!==void 0?n.bindAttribLocation(v,0,i.index0AttributeName):i.morphTargets===!0&&n.bindAttribLocation(v,0,"position"),n.linkProgram(v);function A(D){if(e.debug.checkShaderErrors){const I=n.getProgramInfoLog(v).trim(),L=n.getShaderInfoLog(M).trim(),z=n.getShaderInfoLog(S).trim();let F=!0,Q=!0;if(n.getProgramParameter(v,n.LINK_STATUS)===!1)if(F=!1,typeof e.debug.onShaderError=="function")e.debug.onShaderError(n,v,M,S);else{const Y=D8(n,M,"vertex"),O=D8(n,S,"fragment");console.error("THREE.WebGLProgram: Shader Error "+n.getError()+" - VALIDATE_STATUS "+n.getProgramParameter(v,n.VALIDATE_STATUS)+`

Material Name: `+D.name+`
Material Type: `+D.type+`

Program Info Log: `+I+`
`+Y+`
`+O)}else I!==""?console.warn("THREE.WebGLProgram: Program Info Log:",I):(L===""||z==="")&&(Q=!1);Q&&(D.diagnostics={runnable:F,programLog:I,vertexShader:{log:L,prefix:g},fragmentShader:{log:z,prefix:m}})}n.deleteShader(M),n.deleteShader(S),T=new DE(n,v),E=tke(n,v)}let T;this.getUniforms=function(){return T===void 0&&A(this),T};let E;this.getAttributes=function(){return E===void 0&&A(this),E};let C=i.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return C===!1&&(C=n.getProgramParameter(v,XBe)),C},this.destroy=function(){r.releaseStatesOfProgram(this),n.deleteProgram(v),this.program=void 0},this.type=i.shaderType,this.name=i.shaderName,this.id=qBe++,this.cacheKey=t,this.usedTimes=1,this.program=v,this.vertexShader=M,this.fragmentShader=S,this}let pke=0;class fke{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){const i=t.vertexShader,r=t.fragmentShader,n=this._getShaderStage(i),s=this._getShaderStage(r),a=this._getShaderCacheForMaterial(t);return a.has(n)===!1&&(a.add(n),n.usedTimes++),a.has(s)===!1&&(a.add(s),s.usedTimes++),this}remove(t){const i=this.materialCache.get(t);for(const r of i)r.usedTimes--,r.usedTimes===0&&this.shaderCache.delete(r.code);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){const i=this.materialCache;let r=i.get(t);return r===void 0&&(r=new Set,i.set(t,r)),r}_getShaderStage(t){const i=this.shaderCache;let r=i.get(t);return r===void 0&&(r=new mke(t),i.set(t,r)),r}}class mke{constructor(t){this.id=pke++,this.code=t,this.usedTimes=0}}function gke(e,t,i,r,n,s,a){const o=new If,l=new fke,c=new Set,u=[],h=n.logarithmicDepthBuffer,d=n.vertexTextures;let p=n.precision;const f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function v(E){return c.add(E),E===0?"uv":`uv${E}`}function g(E,C,D,I,L){const z=I.fog,F=L.geometry,Q=E.isMeshStandardMaterial?I.environment:null,Y=(E.isMeshStandardMaterial?i:t).get(E.envMap||Q),O=Y&&Y.mapping===k0?Y.image.height:null,j=f[E.type];E.precision!==null&&(p=n.getMaxPrecision(E.precision),p!==E.precision&&console.warn("THREE.WebGLProgram.getParameters:",E.precision,"not supported, using",p,"instead."));const V=F.morphAttributes.position||F.morphAttributes.normal||F.morphAttributes.color,W=V!==void 0?V.length:0;let J=0;F.morphAttributes.position!==void 0&&(J=1),F.morphAttributes.normal!==void 0&&(J=2),F.morphAttributes.color!==void 0&&(J=3);let ce,$,ne,ie;if(j){const Jt=Tl[j];ce=Jt.vertexShader,$=Jt.fragmentShader}else ce=E.vertexShader,$=E.fragmentShader,l.update(E),ne=l.getVertexShaderID(E),ie=l.getFragmentShaderID(E);const de=e.getRenderTarget(),be=L.isInstancedMesh===!0,we=L.isBatchedMesh===!0,_e=!!E.map,Me=!!E.matcap,X=!!Y,ge=!!E.aoMap,Oe=!!E.lightMap,Ie=!!E.bumpMap,Pe=!!E.normalMap,Ye=!!E.displacementMap,ke=!!E.emissiveMap,Fe=!!E.metalnessMap,se=!!E.roughnessMap,Z=E.anisotropy>0,K=E.clearcoat>0,k=E.dispersion>0,re=E.iridescence>0,he=E.sheen>0,G=E.transmission>0,Te=Z&&!!E.anisotropyMap,ze=K&&!!E.clearcoatMap,Qe=K&&!!E.clearcoatNormalMap,ye=K&&!!E.clearcoatRoughnessMap,je=re&&!!E.iridescenceMap,nt=re&&!!E.iridescenceThicknessMap,ct=he&&!!E.sheenColorMap,tt=he&&!!E.sheenRoughnessMap,ue=!!E.specularMap,Ue=!!E.specularColorMap,dt=!!E.specularIntensityMap,xe=G&&!!E.transmissionMap,ae=G&&!!E.thicknessMap,fe=!!E.gradientMap,Se=!!E.alphaMap,Ne=E.alphaTest>0,st=!!E.alphaHash,vt=!!E.extensions;let Ut=Hc;E.toneMapped&&(de===null||de.isXRRenderTarget===!0)&&(Ut=e.toneMapping);const Wt={shaderID:j,shaderType:E.type,shaderName:E.name,vertexShader:ce,fragmentShader:$,defines:E.defines,customVertexShaderID:ne,customFragmentShaderID:ie,isRawShaderMaterial:E.isRawShaderMaterial===!0,glslVersion:E.glslVersion,precision:p,batching:we,batchingColor:we&&L._colorsTexture!==null,instancing:be,instancingColor:be&&L.instanceColor!==null,instancingMorph:be&&L.morphTexture!==null,supportsVertexTextures:d,outputColorSpace:de===null?e.outputColorSpace:de.isXRRenderTarget===!0?de.texture.colorSpace:Ah,alphaToCoverage:!!E.alphaToCoverage,map:_e,matcap:Me,envMap:X,envMapMode:X&&Y.mapping,envMapCubeUVHeight:O,aoMap:ge,lightMap:Oe,bumpMap:Ie,normalMap:Pe,displacementMap:d&&Ye,emissiveMap:ke,normalMapObjectSpace:Pe&&E.normalMapType===see,normalMapTangentSpace:Pe&&E.normalMapType===sp,metalnessMap:Fe,roughnessMap:se,anisotropy:Z,anisotropyMap:Te,clearcoat:K,clearcoatMap:ze,clearcoatNormalMap:Qe,clearcoatRoughnessMap:ye,dispersion:k,iridescence:re,iridescenceMap:je,iridescenceThicknessMap:nt,sheen:he,sheenColorMap:ct,sheenRoughnessMap:tt,specularMap:ue,specularColorMap:Ue,specularIntensityMap:dt,transmission:G,transmissionMap:xe,thicknessMap:ae,gradientMap:fe,opaque:E.transparent===!1&&E.blending===Pf&&E.alphaToCoverage===!1,alphaMap:Se,alphaTest:Ne,alphaHash:st,combine:E.combine,mapUv:_e&&v(E.map.channel),aoMapUv:ge&&v(E.aoMap.channel),lightMapUv:Oe&&v(E.lightMap.channel),bumpMapUv:Ie&&v(E.bumpMap.channel),normalMapUv:Pe&&v(E.normalMap.channel),displacementMapUv:Ye&&v(E.displacementMap.channel),emissiveMapUv:ke&&v(E.emissiveMap.channel),metalnessMapUv:Fe&&v(E.metalnessMap.channel),roughnessMapUv:se&&v(E.roughnessMap.channel),anisotropyMapUv:Te&&v(E.anisotropyMap.channel),clearcoatMapUv:ze&&v(E.clearcoatMap.channel),clearcoatNormalMapUv:Qe&&v(E.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:ye&&v(E.clearcoatRoughnessMap.channel),iridescenceMapUv:je&&v(E.iridescenceMap.channel),iridescenceThicknessMapUv:nt&&v(E.iridescenceThicknessMap.channel),sheenColorMapUv:ct&&v(E.sheenColorMap.channel),sheenRoughnessMapUv:tt&&v(E.sheenRoughnessMap.channel),specularMapUv:ue&&v(E.specularMap.channel),specularColorMapUv:Ue&&v(E.specularColorMap.channel),specularIntensityMapUv:dt&&v(E.specularIntensityMap.channel),transmissionMapUv:xe&&v(E.transmissionMap.channel),thicknessMapUv:ae&&v(E.thicknessMap.channel),alphaMapUv:Se&&v(E.alphaMap.channel),vertexTangents:!!F.attributes.tangent&&(Pe||Z),vertexColors:E.vertexColors,vertexAlphas:E.vertexColors===!0&&!!F.attributes.color&&F.attributes.color.itemSize===4,pointsUvs:L.isPoints===!0&&!!F.attributes.uv&&(_e||Se),fog:!!z,useFog:E.fog===!0,fogExp2:!!z&&z.isFogExp2,flatShading:E.flatShading===!0,sizeAttenuation:E.sizeAttenuation===!0,logarithmicDepthBuffer:h,skinning:L.isSkinnedMesh===!0,morphTargets:F.morphAttributes.position!==void 0,morphNormals:F.morphAttributes.normal!==void 0,morphColors:F.morphAttributes.color!==void 0,morphTargetsCount:W,morphTextureStride:J,numDirLights:C.directional.length,numPointLights:C.point.length,numSpotLights:C.spot.length,numSpotLightMaps:C.spotLightMap.length,numRectAreaLights:C.rectArea.length,numHemiLights:C.hemi.length,numDirLightShadows:C.directionalShadowMap.length,numPointLightShadows:C.pointShadowMap.length,numSpotLightShadows:C.spotShadowMap.length,numSpotLightShadowsWithMaps:C.numSpotLightShadowsWithMaps,numLightProbes:C.numLightProbes,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:E.dithering,shadowMapEnabled:e.shadowMap.enabled&&D.length>0,shadowMapType:e.shadowMap.type,toneMapping:Ut,decodeVideoTexture:_e&&E.map.isVideoTexture===!0&&Gi.getTransfer(E.map.colorSpace)===yr,premultipliedAlpha:E.premultipliedAlpha,doubleSided:E.side===Dc,flipSided:E.side===va,useDepthPacking:E.depthPacking>=0,depthPacking:E.depthPacking||0,index0AttributeName:E.index0AttributeName,extensionClipCullDistance:vt&&E.extensions.clipCullDistance===!0&&r.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(vt&&E.extensions.multiDraw===!0||we)&&r.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:r.has("KHR_parallel_shader_compile"),customProgramCacheKey:E.customProgramCacheKey()};return Wt.vertexUv1s=c.has(1),Wt.vertexUv2s=c.has(2),Wt.vertexUv3s=c.has(3),c.clear(),Wt}function m(E){const C=[];if(E.shaderID?C.push(E.shaderID):(C.push(E.customVertexShaderID),C.push(E.customFragmentShaderID)),E.defines!==void 0)for(const D in E.defines)C.push(D),C.push(E.defines[D]);return E.isRawShaderMaterial===!1&&(x(C,E),w(C,E),C.push(e.outputColorSpace)),C.push(E.customProgramCacheKey),C.join()}function x(E,C){E.push(C.precision),E.push(C.outputColorSpace),E.push(C.envMapMode),E.push(C.envMapCubeUVHeight),E.push(C.mapUv),E.push(C.alphaMapUv),E.push(C.lightMapUv),E.push(C.aoMapUv),E.push(C.bumpMapUv),E.push(C.normalMapUv),E.push(C.displacementMapUv),E.push(C.emissiveMapUv),E.push(C.metalnessMapUv),E.push(C.roughnessMapUv),E.push(C.anisotropyMapUv),E.push(C.clearcoatMapUv),E.push(C.clearcoatNormalMapUv),E.push(C.clearcoatRoughnessMapUv),E.push(C.iridescenceMapUv),E.push(C.iridescenceThicknessMapUv),E.push(C.sheenColorMapUv),E.push(C.sheenRoughnessMapUv),E.push(C.specularMapUv),E.push(C.specularColorMapUv),E.push(C.specularIntensityMapUv),E.push(C.transmissionMapUv),E.push(C.thicknessMapUv),E.push(C.combine),E.push(C.fogExp2),E.push(C.sizeAttenuation),E.push(C.morphTargetsCount),E.push(C.morphAttributeCount),E.push(C.numDirLights),E.push(C.numPointLights),E.push(C.numSpotLights),E.push(C.numSpotLightMaps),E.push(C.numHemiLights),E.push(C.numRectAreaLights),E.push(C.numDirLightShadows),E.push(C.numPointLightShadows),E.push(C.numSpotLightShadows),E.push(C.numSpotLightShadowsWithMaps),E.push(C.numLightProbes),E.push(C.shadowMapType),E.push(C.toneMapping),E.push(C.numClippingPlanes),E.push(C.numClipIntersection),E.push(C.depthPacking)}function w(E,C){o.disableAll(),C.supportsVertexTextures&&o.enable(0),C.instancing&&o.enable(1),C.instancingColor&&o.enable(2),C.instancingMorph&&o.enable(3),C.matcap&&o.enable(4),C.envMap&&o.enable(5),C.normalMapObjectSpace&&o.enable(6),C.normalMapTangentSpace&&o.enable(7),C.clearcoat&&o.enable(8),C.iridescence&&o.enable(9),C.alphaTest&&o.enable(10),C.vertexColors&&o.enable(11),C.vertexAlphas&&o.enable(12),C.vertexUv1s&&o.enable(13),C.vertexUv2s&&o.enable(14),C.vertexUv3s&&o.enable(15),C.vertexTangents&&o.enable(16),C.anisotropy&&o.enable(17),C.alphaHash&&o.enable(18),C.batching&&o.enable(19),C.dispersion&&o.enable(20),C.batchingColor&&o.enable(21),E.push(o.mask),o.disableAll(),C.fog&&o.enable(0),C.useFog&&o.enable(1),C.flatShading&&o.enable(2),C.logarithmicDepthBuffer&&o.enable(3),C.skinning&&o.enable(4),C.morphTargets&&o.enable(5),C.morphNormals&&o.enable(6),C.morphColors&&o.enable(7),C.premultipliedAlpha&&o.enable(8),C.shadowMapEnabled&&o.enable(9),C.doubleSided&&o.enable(10),C.flipSided&&o.enable(11),C.useDepthPacking&&o.enable(12),C.dithering&&o.enable(13),C.transmission&&o.enable(14),C.sheen&&o.enable(15),C.opaque&&o.enable(16),C.pointsUvs&&o.enable(17),C.decodeVideoTexture&&o.enable(18),C.alphaToCoverage&&o.enable(19),E.push(o.mask)}function _(E){const C=f[E.type];let D;if(C){const I=Tl[C];D=xee.clone(I.uniforms)}else D=E.uniforms;return D}function M(E,C){let D;for(let I=0,L=u.length;I<L;I++){const z=u[I];if(z.cacheKey===C){D=z,++D.usedTimes;break}}return D===void 0&&(D=new dke(e,C,E,s),u.push(D)),D}function S(E){if(--E.usedTimes===0){const C=u.indexOf(E);u[C]=u[u.length-1],u.pop(),E.destroy()}}function A(E){l.remove(E)}function T(){l.dispose()}return{getParameters:g,getProgramCacheKey:m,getUniforms:_,acquireProgram:M,releaseProgram:S,releaseShaderCache:A,programs:u,dispose:T}}function vke(){let e=new WeakMap;function t(s){let a=e.get(s);return a===void 0&&(a={},e.set(s,a)),a}function i(s){e.delete(s)}function r(s,a,o){e.get(s)[a]=o}function n(){e=new WeakMap}return{get:t,remove:i,update:r,dispose:n}}function yke(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function z8(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function N8(){const e=[];let t=0;const i=[],r=[],n=[];function s(){t=0,i.length=0,r.length=0,n.length=0}function a(h,d,p,f,v,g){let m=e[t];return m===void 0?(m={id:h.id,object:h,geometry:d,material:p,groupOrder:f,renderOrder:h.renderOrder,z:v,group:g},e[t]=m):(m.id=h.id,m.object=h,m.geometry=d,m.material=p,m.groupOrder=f,m.renderOrder=h.renderOrder,m.z=v,m.group=g),t++,m}function o(h,d,p,f,v,g){const m=a(h,d,p,f,v,g);p.transmission>0?r.push(m):p.transparent===!0?n.push(m):i.push(m)}function l(h,d,p,f,v,g){const m=a(h,d,p,f,v,g);p.transmission>0?r.unshift(m):p.transparent===!0?n.unshift(m):i.unshift(m)}function c(h,d){i.length>1&&i.sort(h||yke),r.length>1&&r.sort(d||z8),n.length>1&&n.sort(d||z8)}function u(){for(let h=t,d=e.length;h<d;h++){const p=e[h];if(p.id===null)break;p.id=null,p.object=null,p.geometry=null,p.material=null,p.group=null}}return{opaque:i,transmissive:r,transparent:n,init:s,push:o,unshift:l,finish:u,sort:c}}function xke(){let e=new WeakMap;function t(r,n){const s=e.get(r);let a;return s===void 0?(a=new N8,e.set(r,[a])):n>=s.length?(a=new N8,s.push(a)):a=s[n],a}function i(){e=new WeakMap}return{get:t,dispose:i}}function wke(){const e={};return{get:function(t){if(e[t.id]!==void 0)return e[t.id];let i;switch(t.type){case"DirectionalLight":i={direction:new oe,color:new Rt};break;case"SpotLight":i={position:new oe,direction:new oe,color:new Rt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new oe,color:new Rt,distance:0,decay:0};break;case"HemisphereLight":i={direction:new oe,skyColor:new Rt,groundColor:new Rt};break;case"RectAreaLight":i={color:new Rt,position:new oe,halfWidth:new oe,halfHeight:new oe};break}return e[t.id]=i,i}}}function bke(){const e={};return{get:function(t){if(e[t.id]!==void 0)return e[t.id];let i;switch(t.type){case"DirectionalLight":i={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ot};break;case"SpotLight":i={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ot};break;case"PointLight":i={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ot,shadowCameraNear:1,shadowCameraFar:1e3};break}return e[t.id]=i,i}}}let _ke=0;function Ske(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function Mke(e){const t=new wke,i=bke(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let c=0;c<9;c++)r.probe.push(new oe);const n=new oe,s=new ii,a=new ii;function o(c){let u=0,h=0,d=0;for(let E=0;E<9;E++)r.probe[E].set(0,0,0);let p=0,f=0,v=0,g=0,m=0,x=0,w=0,_=0,M=0,S=0,A=0;c.sort(Ske);for(let E=0,C=c.length;E<C;E++){const D=c[E],I=D.color,L=D.intensity,z=D.distance,F=D.shadow&&D.shadow.map?D.shadow.map.texture:null;if(D.isAmbientLight)u+=I.r*L,h+=I.g*L,d+=I.b*L;else if(D.isLightProbe){for(let Q=0;Q<9;Q++)r.probe[Q].addScaledVector(D.sh.coefficients[Q],L);A++}else if(D.isDirectionalLight){const Q=t.get(D);if(Q.color.copy(D.color).multiplyScalar(D.intensity),D.castShadow){const Y=D.shadow,O=i.get(D);O.shadowIntensity=Y.intensity,O.shadowBias=Y.bias,O.shadowNormalBias=Y.normalBias,O.shadowRadius=Y.radius,O.shadowMapSize=Y.mapSize,r.directionalShadow[p]=O,r.directionalShadowMap[p]=F,r.directionalShadowMatrix[p]=D.shadow.matrix,x++}r.directional[p]=Q,p++}else if(D.isSpotLight){const Q=t.get(D);Q.position.setFromMatrixPosition(D.matrixWorld),Q.color.copy(I).multiplyScalar(L),Q.distance=z,Q.coneCos=Math.cos(D.angle),Q.penumbraCos=Math.cos(D.angle*(1-D.penumbra)),Q.decay=D.decay,r.spot[v]=Q;const Y=D.shadow;if(D.map&&(r.spotLightMap[M]=D.map,M++,Y.updateMatrices(D),D.castShadow&&S++),r.spotLightMatrix[v]=Y.matrix,D.castShadow){const O=i.get(D);O.shadowIntensity=Y.intensity,O.shadowBias=Y.bias,O.shadowNormalBias=Y.normalBias,O.shadowRadius=Y.radius,O.shadowMapSize=Y.mapSize,r.spotShadow[v]=O,r.spotShadowMap[v]=F,_++}v++}else if(D.isRectAreaLight){const Q=t.get(D);Q.color.copy(I).multiplyScalar(L),Q.halfWidth.set(D.width*.5,0,0),Q.halfHeight.set(0,D.height*.5,0),r.rectArea[g]=Q,g++}else if(D.isPointLight){const Q=t.get(D);if(Q.color.copy(D.color).multiplyScalar(D.intensity),Q.distance=D.distance,Q.decay=D.decay,D.castShadow){const Y=D.shadow,O=i.get(D);O.shadowIntensity=Y.intensity,O.shadowBias=Y.bias,O.shadowNormalBias=Y.normalBias,O.shadowRadius=Y.radius,O.shadowMapSize=Y.mapSize,O.shadowCameraNear=Y.camera.near,O.shadowCameraFar=Y.camera.far,r.pointShadow[f]=O,r.pointShadowMap[f]=F,r.pointShadowMatrix[f]=D.shadow.matrix,w++}r.point[f]=Q,f++}else if(D.isHemisphereLight){const Q=t.get(D);Q.skyColor.copy(D.color).multiplyScalar(L),Q.groundColor.copy(D.groundColor).multiplyScalar(L),r.hemi[m]=Q,m++}}g>0&&(e.has("OES_texture_float_linear")===!0?(r.rectAreaLTC1=Mt.LTC_FLOAT_1,r.rectAreaLTC2=Mt.LTC_FLOAT_2):(r.rectAreaLTC1=Mt.LTC_HALF_1,r.rectAreaLTC2=Mt.LTC_HALF_2)),r.ambient[0]=u,r.ambient[1]=h,r.ambient[2]=d;const T=r.hash;(T.directionalLength!==p||T.pointLength!==f||T.spotLength!==v||T.rectAreaLength!==g||T.hemiLength!==m||T.numDirectionalShadows!==x||T.numPointShadows!==w||T.numSpotShadows!==_||T.numSpotMaps!==M||T.numLightProbes!==A)&&(r.directional.length=p,r.spot.length=v,r.rectArea.length=g,r.point.length=f,r.hemi.length=m,r.directionalShadow.length=x,r.directionalShadowMap.length=x,r.pointShadow.length=w,r.pointShadowMap.length=w,r.spotShadow.length=_,r.spotShadowMap.length=_,r.directionalShadowMatrix.length=x,r.pointShadowMatrix.length=w,r.spotLightMatrix.length=_+M-S,r.spotLightMap.length=M,r.numSpotLightShadowsWithMaps=S,r.numLightProbes=A,T.directionalLength=p,T.pointLength=f,T.spotLength=v,T.rectAreaLength=g,T.hemiLength=m,T.numDirectionalShadows=x,T.numPointShadows=w,T.numSpotShadows=_,T.numSpotMaps=M,T.numLightProbes=A,r.version=_ke++)}function l(c,u){let h=0,d=0,p=0,f=0,v=0;const g=u.matrixWorldInverse;for(let m=0,x=c.length;m<x;m++){const w=c[m];if(w.isDirectionalLight){const _=r.directional[h];_.direction.setFromMatrixPosition(w.matrixWorld),n.setFromMatrixPosition(w.target.matrixWorld),_.direction.sub(n),_.direction.transformDirection(g),h++}else if(w.isSpotLight){const _=r.spot[p];_.position.setFromMatrixPosition(w.matrixWorld),_.position.applyMatrix4(g),_.direction.setFromMatrixPosition(w.matrixWorld),n.setFromMatrixPosition(w.target.matrixWorld),_.direction.sub(n),_.direction.transformDirection(g),p++}else if(w.isRectAreaLight){const _=r.rectArea[f];_.position.setFromMatrixPosition(w.matrixWorld),_.position.applyMatrix4(g),a.identity(),s.copy(w.matrixWorld),s.premultiply(g),a.extractRotation(s),_.halfWidth.set(w.width*.5,0,0),_.halfHeight.set(0,w.height*.5,0),_.halfWidth.applyMatrix4(a),_.halfHeight.applyMatrix4(a),f++}else if(w.isPointLight){const _=r.point[d];_.position.setFromMatrixPosition(w.matrixWorld),_.position.applyMatrix4(g),d++}else if(w.isHemisphereLight){const _=r.hemi[v];_.direction.setFromMatrixPosition(w.matrixWorld),_.direction.transformDirection(g),v++}}}return{setup:o,setupView:l,state:r}}function B8(e){const t=new Mke(e),i=[],r=[];function n(u){c.camera=u,i.length=0,r.length=0}function s(u){i.push(u)}function a(u){r.push(u)}function o(){t.setup(i)}function l(u){t.setupView(i,u)}const c={lightsArray:i,shadowsArray:r,camera:null,lights:t,transmissionRenderTarget:{}};return{init:n,state:c,setupLights:o,setupLightsView:l,pushLight:s,pushShadow:a}}function Eke(e){let t=new WeakMap;function i(n,s=0){const a=t.get(n);let o;return a===void 0?(o=new B8(e),t.set(n,[o])):s>=a.length?(o=new B8(e),a.push(o)):o=a[s],o}function r(){t=new WeakMap}return{get:i,dispose:r}}class hU extends Ts{constructor(t){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=ree,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}class dU extends Ts{constructor(t){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(t)}copy(t){return super.copy(t),this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}const Ake=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,Cke=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function Tke(e,t,i){let r=new tb;const n=new ot,s=new ot,a=new tr,o=new hU({depthPacking:nee}),l=new dU,c={},u=i.maxTextureSize,h={[gh]:va,[va]:gh,[Dc]:Dc},d=new Xl({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new ot},radius:{value:4}},vertexShader:Ake,fragmentShader:Cke}),p=d.clone();p.defines.HORIZONTAL_PASS=1;const f=new wi;f.setAttribute("position",new dr(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const v=new En(f,d),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=YT;let m=this.type;this.render=function(S,A,T){if(g.enabled===!1||g.autoUpdate===!1&&g.needsUpdate===!1||S.length===0)return;const E=e.getRenderTarget(),C=e.getActiveCubeFace(),D=e.getActiveMipmapLevel(),I=e.state;I.setBlending(nh),I.buffers.color.setClear(1,1,1,1),I.buffers.depth.setTest(!0),I.setScissorTest(!1);const L=m!==El&&this.type===El,z=m===El&&this.type!==El;for(let F=0,Q=S.length;F<Q;F++){const Y=S[F],O=Y.shadow;if(O===void 0){console.warn("THREE.WebGLShadowMap:",Y,"has no shadow.");continue}if(O.autoUpdate===!1&&O.needsUpdate===!1)continue;n.copy(O.mapSize);const j=O.getFrameExtents();if(n.multiply(j),s.copy(O.mapSize),(n.x>u||n.y>u)&&(n.x>u&&(s.x=Math.floor(u/j.x),n.x=s.x*j.x,O.mapSize.x=s.x),n.y>u&&(s.y=Math.floor(u/j.y),n.y=s.y*j.y,O.mapSize.y=s.y)),O.map===null||L===!0||z===!0){const W=this.type!==El?{minFilter:os,magFilter:os}:{};O.map!==null&&O.map.dispose(),O.map=new Wl(n.x,n.y,W),O.map.texture.name=Y.name+".shadowMap",O.camera.updateProjectionMatrix()}e.setRenderTarget(O.map),e.clear();const V=O.getViewportCount();for(let W=0;W<V;W++){const J=O.getViewport(W);a.set(s.x*J.x,s.y*J.y,s.x*J.z,s.y*J.w),I.viewport(a),O.updateMatrices(Y,W),r=O.getFrustum(),_(A,T,O.camera,Y,this.type)}O.isPointLightShadow!==!0&&this.type===El&&x(O,T),O.needsUpdate=!1}m=this.type,g.needsUpdate=!1,e.setRenderTarget(E,C,D)};function x(S,A){const T=t.update(v);d.defines.VSM_SAMPLES!==S.blurSamples&&(d.defines.VSM_SAMPLES=S.blurSamples,p.defines.VSM_SAMPLES=S.blurSamples,d.needsUpdate=!0,p.needsUpdate=!0),S.mapPass===null&&(S.mapPass=new Wl(n.x,n.y)),d.uniforms.shadow_pass.value=S.map.texture,d.uniforms.resolution.value=S.mapSize,d.uniforms.radius.value=S.radius,e.setRenderTarget(S.mapPass),e.clear(),e.renderBufferDirect(A,null,T,d,v,null),p.uniforms.shadow_pass.value=S.mapPass.texture,p.uniforms.resolution.value=S.mapSize,p.uniforms.radius.value=S.radius,e.setRenderTarget(S.map),e.clear(),e.renderBufferDirect(A,null,T,p,v,null)}function w(S,A,T,E){let C=null;const D=T.isPointLight===!0?S.customDistanceMaterial:S.customDepthMaterial;if(D!==void 0)C=D;else if(C=T.isPointLight===!0?l:o,e.localClippingEnabled&&A.clipShadows===!0&&Array.isArray(A.clippingPlanes)&&A.clippingPlanes.length!==0||A.displacementMap&&A.displacementScale!==0||A.alphaMap&&A.alphaTest>0||A.map&&A.alphaTest>0){const I=C.uuid,L=A.uuid;let z=c[I];z===void 0&&(z={},c[I]=z);let F=z[L];F===void 0&&(F=C.clone(),z[L]=F,A.addEventListener("dispose",M)),C=F}if(C.visible=A.visible,C.wireframe=A.wireframe,E===El?C.side=A.shadowSide!==null?A.shadowSide:A.side:C.side=A.shadowSide!==null?A.shadowSide:h[A.side],C.alphaMap=A.alphaMap,C.alphaTest=A.alphaTest,C.map=A.map,C.clipShadows=A.clipShadows,C.clippingPlanes=A.clippingPlanes,C.clipIntersection=A.clipIntersection,C.displacementMap=A.displacementMap,C.displacementScale=A.displacementScale,C.displacementBias=A.displacementBias,C.wireframeLinewidth=A.wireframeLinewidth,C.linewidth=A.linewidth,T.isPointLight===!0&&C.isMeshDistanceMaterial===!0){const I=e.properties.get(C);I.light=T}return C}function _(S,A,T,E,C){if(S.visible===!1)return;if(S.layers.test(A.layers)&&(S.isMesh||S.isLine||S.isPoints)&&(S.castShadow||S.receiveShadow&&C===El)&&(!S.frustumCulled||r.intersectsObject(S))){S.modelViewMatrix.multiplyMatrices(T.matrixWorldInverse,S.matrixWorld);const L=t.update(S),z=S.material;if(Array.isArray(z)){const F=L.groups;for(let Q=0,Y=F.length;Q<Y;Q++){const O=F[Q],j=z[O.materialIndex];if(j&&j.visible){const V=w(S,j,E,C);S.onBeforeShadow(e,S,A,T,L,V,O),e.renderBufferDirect(T,null,L,V,S,O),S.onAfterShadow(e,S,A,T,L,V,O)}}}else if(z.visible){const F=w(S,z,E,C);S.onBeforeShadow(e,S,A,T,L,F,null),e.renderBufferDirect(T,null,L,F,S,null),S.onAfterShadow(e,S,A,T,L,F,null)}}const I=S.children;for(let L=0,z=I.length;L<z;L++)_(I[L],A,T,E,C)}function M(S){S.target.removeEventListener("dispose",M);for(const T in c){const E=c[T],C=S.target.uuid;C in E&&(E[C].dispose(),delete E[C])}}}function Pke(e){function t(){let xe=!1;const ae=new tr;let fe=null;const Se=new tr(0,0,0,0);return{setMask:function(Ne){fe!==Ne&&!xe&&(e.colorMask(Ne,Ne,Ne,Ne),fe=Ne)},setLocked:function(Ne){xe=Ne},setClear:function(Ne,st,vt,Ut,Wt){Wt===!0&&(Ne*=Ut,st*=Ut,vt*=Ut),ae.set(Ne,st,vt,Ut),Se.equals(ae)===!1&&(e.clearColor(Ne,st,vt,Ut),Se.copy(ae))},reset:function(){xe=!1,fe=null,Se.set(-1,0,0,0)}}}function i(){let xe=!1,ae=null,fe=null,Se=null;return{setTest:function(Ne){Ne?ie(e.DEPTH_TEST):de(e.DEPTH_TEST)},setMask:function(Ne){ae!==Ne&&!xe&&(e.depthMask(Ne),ae=Ne)},setFunc:function(Ne){if(fe!==Ne){switch(Ne){case kJ:e.depthFunc(e.NEVER);break;case UJ:e.depthFunc(e.ALWAYS);break;case FJ:e.depthFunc(e.LESS);break;case ew:e.depthFunc(e.LEQUAL);break;case VJ:e.depthFunc(e.EQUAL);break;case HJ:e.depthFunc(e.GEQUAL);break;case GJ:e.depthFunc(e.GREATER);break;case jJ:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}fe=Ne}},setLocked:function(Ne){xe=Ne},setClear:function(Ne){Se!==Ne&&(e.clearDepth(Ne),Se=Ne)},reset:function(){xe=!1,ae=null,fe=null,Se=null}}}function r(){let xe=!1,ae=null,fe=null,Se=null,Ne=null,st=null,vt=null,Ut=null,Wt=null;return{setTest:function(Jt){xe||(Jt?ie(e.STENCIL_TEST):de(e.STENCIL_TEST))},setMask:function(Jt){ae!==Jt&&!xe&&(e.stencilMask(Jt),ae=Jt)},setFunc:function(Jt,ci,Ki){(fe!==Jt||Se!==ci||Ne!==Ki)&&(e.stencilFunc(Jt,ci,Ki),fe=Jt,Se=ci,Ne=Ki)},setOp:function(Jt,ci,Ki){(st!==Jt||vt!==ci||Ut!==Ki)&&(e.stencilOp(Jt,ci,Ki),st=Jt,vt=ci,Ut=Ki)},setLocked:function(Jt){xe=Jt},setClear:function(Jt){Wt!==Jt&&(e.clearStencil(Jt),Wt=Jt)},reset:function(){xe=!1,ae=null,fe=null,Se=null,Ne=null,st=null,vt=null,Ut=null,Wt=null}}}const n=new t,s=new i,a=new r,o=new WeakMap,l=new WeakMap;let c={},u={},h=new WeakMap,d=[],p=null,f=!1,v=null,g=null,m=null,x=null,w=null,_=null,M=null,S=new Rt(0,0,0),A=0,T=!1,E=null,C=null,D=null,I=null,L=null;const z=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let F=!1,Q=0;const Y=e.getParameter(e.VERSION);Y.indexOf("WebGL")!==-1?(Q=parseFloat(/^WebGL (\d)/.exec(Y)[1]),F=Q>=1):Y.indexOf("OpenGL ES")!==-1&&(Q=parseFloat(/^OpenGL ES (\d)/.exec(Y)[1]),F=Q>=2);let O=null,j={};const V=e.getParameter(e.SCISSOR_BOX),W=e.getParameter(e.VIEWPORT),J=new tr().fromArray(V),ce=new tr().fromArray(W);function $(xe,ae,fe,Se){const Ne=new Uint8Array(4),st=e.createTexture();e.bindTexture(xe,st),e.texParameteri(xe,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(xe,e.TEXTURE_MAG_FILTER,e.NEAREST);for(let vt=0;vt<fe;vt++)xe===e.TEXTURE_3D||xe===e.TEXTURE_2D_ARRAY?e.texImage3D(ae,0,e.RGBA,1,1,Se,0,e.RGBA,e.UNSIGNED_BYTE,Ne):e.texImage2D(ae+vt,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,Ne);return st}const ne={};ne[e.TEXTURE_2D]=$(e.TEXTURE_2D,e.TEXTURE_2D,1),ne[e.TEXTURE_CUBE_MAP]=$(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),ne[e.TEXTURE_2D_ARRAY]=$(e.TEXTURE_2D_ARRAY,e.TEXTURE_2D_ARRAY,1,1),ne[e.TEXTURE_3D]=$(e.TEXTURE_3D,e.TEXTURE_3D,1,1),n.setClear(0,0,0,1),s.setClear(1),a.setClear(0),ie(e.DEPTH_TEST),s.setFunc(ew),Ie(!1),Pe(Dz),ie(e.CULL_FACE),ge(nh);function ie(xe){c[xe]!==!0&&(e.enable(xe),c[xe]=!0)}function de(xe){c[xe]!==!1&&(e.disable(xe),c[xe]=!1)}function be(xe,ae){return u[xe]!==ae?(e.bindFramebuffer(xe,ae),u[xe]=ae,xe===e.DRAW_FRAMEBUFFER&&(u[e.FRAMEBUFFER]=ae),xe===e.FRAMEBUFFER&&(u[e.DRAW_FRAMEBUFFER]=ae),!0):!1}function we(xe,ae){let fe=d,Se=!1;if(xe){fe=h.get(ae),fe===void 0&&(fe=[],h.set(ae,fe));const Ne=xe.textures;if(fe.length!==Ne.length||fe[0]!==e.COLOR_ATTACHMENT0){for(let st=0,vt=Ne.length;st<vt;st++)fe[st]=e.COLOR_ATTACHMENT0+st;fe.length=Ne.length,Se=!0}}else fe[0]!==e.BACK&&(fe[0]=e.BACK,Se=!0);Se&&e.drawBuffers(fe)}function _e(xe){return p!==xe?(e.useProgram(xe),p=xe,!0):!1}const Me={[vd]:e.FUNC_ADD,[bJ]:e.FUNC_SUBTRACT,[_J]:e.FUNC_REVERSE_SUBTRACT};Me[SJ]=e.MIN,Me[MJ]=e.MAX;const X={[EJ]:e.ZERO,[AJ]:e.ONE,[CJ]:e.SRC_COLOR,[vC]:e.SRC_ALPHA,[LJ]:e.SRC_ALPHA_SATURATE,[RJ]:e.DST_COLOR,[PJ]:e.DST_ALPHA,[TJ]:e.ONE_MINUS_SRC_COLOR,[yC]:e.ONE_MINUS_SRC_ALPHA,[IJ]:e.ONE_MINUS_DST_COLOR,[DJ]:e.ONE_MINUS_DST_ALPHA,[OJ]:e.CONSTANT_COLOR,[zJ]:e.ONE_MINUS_CONSTANT_COLOR,[NJ]:e.CONSTANT_ALPHA,[BJ]:e.ONE_MINUS_CONSTANT_ALPHA};function ge(xe,ae,fe,Se,Ne,st,vt,Ut,Wt,Jt){if(xe===nh){f===!0&&(de(e.BLEND),f=!1);return}if(f===!1&&(ie(e.BLEND),f=!0),xe!==wJ){if(xe!==v||Jt!==T){if((g!==vd||w!==vd)&&(e.blendEquation(e.FUNC_ADD),g=vd,w=vd),Jt)switch(xe){case Pf:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case Rz:e.blendFunc(e.ONE,e.ONE);break;case Iz:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case Lz:e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",xe);break}else switch(xe){case Pf:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case Rz:e.blendFunc(e.SRC_ALPHA,e.ONE);break;case Iz:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case Lz:e.blendFunc(e.ZERO,e.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",xe);break}m=null,x=null,_=null,M=null,S.set(0,0,0),A=0,v=xe,T=Jt}return}Ne=Ne||ae,st=st||fe,vt=vt||Se,(ae!==g||Ne!==w)&&(e.blendEquationSeparate(Me[ae],Me[Ne]),g=ae,w=Ne),(fe!==m||Se!==x||st!==_||vt!==M)&&(e.blendFuncSeparate(X[fe],X[Se],X[st],X[vt]),m=fe,x=Se,_=st,M=vt),(Ut.equals(S)===!1||Wt!==A)&&(e.blendColor(Ut.r,Ut.g,Ut.b,Wt),S.copy(Ut),A=Wt),v=xe,T=!1}function Oe(xe,ae){xe.side===Dc?de(e.CULL_FACE):ie(e.CULL_FACE);let fe=xe.side===va;ae&&(fe=!fe),Ie(fe),xe.blending===Pf&&xe.transparent===!1?ge(nh):ge(xe.blending,xe.blendEquation,xe.blendSrc,xe.blendDst,xe.blendEquationAlpha,xe.blendSrcAlpha,xe.blendDstAlpha,xe.blendColor,xe.blendAlpha,xe.premultipliedAlpha),s.setFunc(xe.depthFunc),s.setTest(xe.depthTest),s.setMask(xe.depthWrite),n.setMask(xe.colorWrite);const Se=xe.stencilWrite;a.setTest(Se),Se&&(a.setMask(xe.stencilWriteMask),a.setFunc(xe.stencilFunc,xe.stencilRef,xe.stencilFuncMask),a.setOp(xe.stencilFail,xe.stencilZFail,xe.stencilZPass)),ke(xe.polygonOffset,xe.polygonOffsetFactor,xe.polygonOffsetUnits),xe.alphaToCoverage===!0?ie(e.SAMPLE_ALPHA_TO_COVERAGE):de(e.SAMPLE_ALPHA_TO_COVERAGE)}function Ie(xe){E!==xe&&(xe?e.frontFace(e.CW):e.frontFace(e.CCW),E=xe)}function Pe(xe){xe!==vJ?(ie(e.CULL_FACE),xe!==C&&(xe===Dz?e.cullFace(e.BACK):xe===yJ?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):de(e.CULL_FACE),C=xe}function Ye(xe){xe!==D&&(F&&e.lineWidth(xe),D=xe)}function ke(xe,ae,fe){xe?(ie(e.POLYGON_OFFSET_FILL),(I!==ae||L!==fe)&&(e.polygonOffset(ae,fe),I=ae,L=fe)):de(e.POLYGON_OFFSET_FILL)}function Fe(xe){xe?ie(e.SCISSOR_TEST):de(e.SCISSOR_TEST)}function se(xe){xe===void 0&&(xe=e.TEXTURE0+z-1),O!==xe&&(e.activeTexture(xe),O=xe)}function Z(xe,ae,fe){fe===void 0&&(O===null?fe=e.TEXTURE0+z-1:fe=O);let Se=j[fe];Se===void 0&&(Se={type:void 0,texture:void 0},j[fe]=Se),(Se.type!==xe||Se.texture!==ae)&&(O!==fe&&(e.activeTexture(fe),O=fe),e.bindTexture(xe,ae||ne[xe]),Se.type=xe,Se.texture=ae)}function K(){const xe=j[O];xe!==void 0&&xe.type!==void 0&&(e.bindTexture(xe.type,null),xe.type=void 0,xe.texture=void 0)}function k(){try{e.compressedTexImage2D.apply(e,arguments)}catch(xe){console.error("THREE.WebGLState:",xe)}}function re(){try{e.compressedTexImage3D.apply(e,arguments)}catch(xe){console.error("THREE.WebGLState:",xe)}}function he(){try{e.texSubImage2D.apply(e,arguments)}catch(xe){console.error("THREE.WebGLState:",xe)}}function G(){try{e.texSubImage3D.apply(e,arguments)}catch(xe){console.error("THREE.WebGLState:",xe)}}function Te(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(xe){console.error("THREE.WebGLState:",xe)}}function ze(){try{e.compressedTexSubImage3D.apply(e,arguments)}catch(xe){console.error("THREE.WebGLState:",xe)}}function Qe(){try{e.texStorage2D.apply(e,arguments)}catch(xe){console.error("THREE.WebGLState:",xe)}}function ye(){try{e.texStorage3D.apply(e,arguments)}catch(xe){console.error("THREE.WebGLState:",xe)}}function je(){try{e.texImage2D.apply(e,arguments)}catch(xe){console.error("THREE.WebGLState:",xe)}}function nt(){try{e.texImage3D.apply(e,arguments)}catch(xe){console.error("THREE.WebGLState:",xe)}}function ct(xe){J.equals(xe)===!1&&(e.scissor(xe.x,xe.y,xe.z,xe.w),J.copy(xe))}function tt(xe){ce.equals(xe)===!1&&(e.viewport(xe.x,xe.y,xe.z,xe.w),ce.copy(xe))}function ue(xe,ae){let fe=l.get(ae);fe===void 0&&(fe=new WeakMap,l.set(ae,fe));let Se=fe.get(xe);Se===void 0&&(Se=e.getUniformBlockIndex(ae,xe.name),fe.set(xe,Se))}function Ue(xe,ae){const Se=l.get(ae).get(xe);o.get(ae)!==Se&&(e.uniformBlockBinding(ae,Se,xe.__bindingPointIndex),o.set(ae,Se))}function dt(){e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.blendFuncSeparate(e.ONE,e.ZERO,e.ONE,e.ZERO),e.blendColor(0,0,0,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(e.LESS),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.clearStencil(0),e.cullFace(e.BACK),e.frontFace(e.CCW),e.polygonOffset(0,0),e.activeTexture(e.TEXTURE0),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),e.bindFramebuffer(e.READ_FRAMEBUFFER,null),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),c={},O=null,j={},u={},h=new WeakMap,d=[],p=null,f=!1,v=null,g=null,m=null,x=null,w=null,_=null,M=null,S=new Rt(0,0,0),A=0,T=!1,E=null,C=null,D=null,I=null,L=null,J.set(0,0,e.canvas.width,e.canvas.height),ce.set(0,0,e.canvas.width,e.canvas.height),n.reset(),s.reset(),a.reset()}return{buffers:{color:n,depth:s,stencil:a},enable:ie,disable:de,bindFramebuffer:be,drawBuffers:we,useProgram:_e,setBlending:ge,setMaterial:Oe,setFlipSided:Ie,setCullFace:Pe,setLineWidth:Ye,setPolygonOffset:ke,setScissorTest:Fe,activeTexture:se,bindTexture:Z,unbindTexture:K,compressedTexImage2D:k,compressedTexImage3D:re,texImage2D:je,texImage3D:nt,updateUBOMapping:ue,uniformBlockBinding:Ue,texStorage2D:Qe,texStorage3D:ye,texSubImage2D:he,texSubImage3D:G,compressedTexSubImage2D:Te,compressedTexSubImage3D:ze,scissor:ct,viewport:tt,reset:dt}}function Dke(e,t){const i=e.image&&e.image.width?e.image.width/e.image.height:1;return i>t?(e.repeat.x=1,e.repeat.y=i/t,e.offset.x=0,e.offset.y=(1-e.repeat.y)/2):(e.repeat.x=t/i,e.repeat.y=1,e.offset.x=(1-e.repeat.x)/2,e.offset.y=0),e}function Rke(e,t){const i=e.image&&e.image.width?e.image.width/e.image.height:1;return i>t?(e.repeat.x=t/i,e.repeat.y=1,e.offset.x=(1-e.repeat.x)/2,e.offset.y=0):(e.repeat.x=1,e.repeat.y=i/t,e.offset.x=0,e.offset.y=(1-e.repeat.y)/2),e}function Ike(e){return e.repeat.x=1,e.repeat.y=1,e.offset.x=0,e.offset.y=0,e}function Fz(e,t,i,r){const n=Lke(r);switch(i){case Zk:return e*t;case Jk:return e*t;case eU:return e*t*2;case JT:return e*t/n.components*n.byteLength;case Zw:return e*t/n.components*n.byteLength;case tU:return e*t*2/n.components*n.byteLength;case e2:return e*t*2/n.components*n.byteLength;case $k:return e*t*3/n.components*n.byteLength;case Ys:return e*t*4/n.components*n.byteLength;case t2:return e*t*4/n.components*n.byteLength;case r1:case n1:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*8;case s1:case a1:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*16;case wC:case _C:return Math.max(e,16)*Math.max(t,8)/4;case xC:case bC:return Math.max(e,8)*Math.max(t,8)/2;case SC:case MC:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*8;case EC:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*16;case AC:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*16;case CC:return Math.floor((e+4)/5)*Math.floor((t+3)/4)*16;case TC:return Math.floor((e+4)/5)*Math.floor((t+4)/5)*16;case PC:return Math.floor((e+5)/6)*Math.floor((t+4)/5)*16;case DC:return Math.floor((e+5)/6)*Math.floor((t+5)/6)*16;case RC:return Math.floor((e+7)/8)*Math.floor((t+4)/5)*16;case IC:return Math.floor((e+7)/8)*Math.floor((t+5)/6)*16;case LC:return Math.floor((e+7)/8)*Math.floor((t+7)/8)*16;case OC:return Math.floor((e+9)/10)*Math.floor((t+4)/5)*16;case zC:return Math.floor((e+9)/10)*Math.floor((t+5)/6)*16;case NC:return Math.floor((e+9)/10)*Math.floor((t+7)/8)*16;case BC:return Math.floor((e+9)/10)*Math.floor((t+9)/10)*16;case kC:return Math.floor((e+11)/12)*Math.floor((t+9)/10)*16;case UC:return Math.floor((e+11)/12)*Math.floor((t+11)/12)*16;case o1:case FC:case VC:return Math.ceil(e/4)*Math.ceil(t/4)*16;case iU:case HC:return Math.ceil(e/4)*Math.ceil(t/4)*8;case GC:case jC:return Math.ceil(e/4)*Math.ceil(t/4)*16}throw new Error(`Unable to determine texture byte length for ${i} format.`)}function Lke(e){switch(e){case jl:case Yk:return{byteLength:1,components:1};case a0:case Qk:case U0:return{byteLength:2,components:1};case ZT:case $T:return{byteLength:2,components:4};case yh:case KT:case Ua:return{byteLength:4,components:1};case Kk:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${e}.`)}const Oke={contain:Dke,cover:Rke,fill:Ike,getByteLength:Fz};function zke(e,t,i,r,n,s,a){const o=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,l=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),c=new ot,u=new WeakMap;let h;const d=new WeakMap;let p=!1;try{p=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function f(se,Z){return p?new OffscreenCanvas(se,Z):dw("canvas")}function v(se,Z,K){let k=1;const re=Fe(se);if((re.width>K||re.height>K)&&(k=K/Math.max(re.width,re.height)),k<1)if(typeof HTMLImageElement<"u"&&se instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&se instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&se instanceof ImageBitmap||typeof VideoFrame<"u"&&se instanceof VideoFrame){const he=Math.floor(k*re.width),G=Math.floor(k*re.height);h===void 0&&(h=f(he,G));const Te=Z?f(he,G):h;return Te.width=he,Te.height=G,Te.getContext("2d").drawImage(se,0,0,he,G),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+re.width+"x"+re.height+") to ("+he+"x"+G+")."),Te}else return"data"in se&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+re.width+"x"+re.height+")."),se;return se}function g(se){return se.generateMipmaps&&se.minFilter!==os&&se.minFilter!==_n}function m(se){e.generateMipmap(se)}function x(se,Z,K,k,re=!1){if(se!==null){if(e[se]!==void 0)return e[se];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+se+"'")}let he=Z;if(Z===e.RED&&(K===e.FLOAT&&(he=e.R32F),K===e.HALF_FLOAT&&(he=e.R16F),K===e.UNSIGNED_BYTE&&(he=e.R8)),Z===e.RED_INTEGER&&(K===e.UNSIGNED_BYTE&&(he=e.R8UI),K===e.UNSIGNED_SHORT&&(he=e.R16UI),K===e.UNSIGNED_INT&&(he=e.R32UI),K===e.BYTE&&(he=e.R8I),K===e.SHORT&&(he=e.R16I),K===e.INT&&(he=e.R32I)),Z===e.RG&&(K===e.FLOAT&&(he=e.RG32F),K===e.HALF_FLOAT&&(he=e.RG16F),K===e.UNSIGNED_BYTE&&(he=e.RG8)),Z===e.RG_INTEGER&&(K===e.UNSIGNED_BYTE&&(he=e.RG8UI),K===e.UNSIGNED_SHORT&&(he=e.RG16UI),K===e.UNSIGNED_INT&&(he=e.RG32UI),K===e.BYTE&&(he=e.RG8I),K===e.SHORT&&(he=e.RG16I),K===e.INT&&(he=e.RG32I)),Z===e.RGB&&K===e.UNSIGNED_INT_5_9_9_9_REV&&(he=e.RGB9_E5),Z===e.RGBA){const G=re?ow:Gi.getTransfer(k);K===e.FLOAT&&(he=e.RGBA32F),K===e.HALF_FLOAT&&(he=e.RGBA16F),K===e.UNSIGNED_BYTE&&(he=G===yr?e.SRGB8_ALPHA8:e.RGBA8),K===e.UNSIGNED_SHORT_4_4_4_4&&(he=e.RGBA4),K===e.UNSIGNED_SHORT_5_5_5_1&&(he=e.RGB5_A1)}return(he===e.R16F||he===e.R32F||he===e.RG16F||he===e.RG32F||he===e.RGBA16F||he===e.RGBA32F)&&t.get("EXT_color_buffer_float"),he}function w(se,Z){let K;return se?Z===null||Z===yh||Z===Yf?K=e.DEPTH24_STENCIL8:Z===Ua?K=e.DEPTH32F_STENCIL8:Z===a0&&(K=e.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):Z===null||Z===yh||Z===Yf?K=e.DEPTH_COMPONENT24:Z===Ua?K=e.DEPTH_COMPONENT32F:Z===a0&&(K=e.DEPTH_COMPONENT16),K}function _(se,Z){return g(se)===!0||se.isFramebufferTexture&&se.minFilter!==os&&se.minFilter!==_n?Math.log2(Math.max(Z.width,Z.height))+1:se.mipmaps!==void 0&&se.mipmaps.length>0?se.mipmaps.length:se.isCompressedTexture&&Array.isArray(se.image)?Z.mipmaps.length:1}function M(se){const Z=se.target;Z.removeEventListener("dispose",M),A(Z),Z.isVideoTexture&&u.delete(Z)}function S(se){const Z=se.target;Z.removeEventListener("dispose",S),E(Z)}function A(se){const Z=r.get(se);if(Z.__webglInit===void 0)return;const K=se.source,k=d.get(K);if(k){const re=k[Z.__cacheKey];re.usedTimes--,re.usedTimes===0&&T(se),Object.keys(k).length===0&&d.delete(K)}r.remove(se)}function T(se){const Z=r.get(se);e.deleteTexture(Z.__webglTexture);const K=se.source,k=d.get(K);delete k[Z.__cacheKey],a.memory.textures--}function E(se){const Z=r.get(se);if(se.depthTexture&&se.depthTexture.dispose(),se.isWebGLCubeRenderTarget)for(let k=0;k<6;k++){if(Array.isArray(Z.__webglFramebuffer[k]))for(let re=0;re<Z.__webglFramebuffer[k].length;re++)e.deleteFramebuffer(Z.__webglFramebuffer[k][re]);else e.deleteFramebuffer(Z.__webglFramebuffer[k]);Z.__webglDepthbuffer&&e.deleteRenderbuffer(Z.__webglDepthbuffer[k])}else{if(Array.isArray(Z.__webglFramebuffer))for(let k=0;k<Z.__webglFramebuffer.length;k++)e.deleteFramebuffer(Z.__webglFramebuffer[k]);else e.deleteFramebuffer(Z.__webglFramebuffer);if(Z.__webglDepthbuffer&&e.deleteRenderbuffer(Z.__webglDepthbuffer),Z.__webglMultisampledFramebuffer&&e.deleteFramebuffer(Z.__webglMultisampledFramebuffer),Z.__webglColorRenderbuffer)for(let k=0;k<Z.__webglColorRenderbuffer.length;k++)Z.__webglColorRenderbuffer[k]&&e.deleteRenderbuffer(Z.__webglColorRenderbuffer[k]);Z.__webglDepthRenderbuffer&&e.deleteRenderbuffer(Z.__webglDepthRenderbuffer)}const K=se.textures;for(let k=0,re=K.length;k<re;k++){const he=r.get(K[k]);he.__webglTexture&&(e.deleteTexture(he.__webglTexture),a.memory.textures--),r.remove(K[k])}r.remove(se)}let C=0;function D(){C=0}function I(){const se=C;return se>=n.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+se+" texture units while this GPU supports only "+n.maxTextures),C+=1,se}function L(se){const Z=[];return Z.push(se.wrapS),Z.push(se.wrapT),Z.push(se.wrapR||0),Z.push(se.magFilter),Z.push(se.minFilter),Z.push(se.anisotropy),Z.push(se.internalFormat),Z.push(se.format),Z.push(se.type),Z.push(se.generateMipmaps),Z.push(se.premultiplyAlpha),Z.push(se.flipY),Z.push(se.unpackAlignment),Z.push(se.colorSpace),Z.join()}function z(se,Z){const K=r.get(se);if(se.isVideoTexture&&Ye(se),se.isRenderTargetTexture===!1&&se.version>0&&K.__version!==se.version){const k=se.image;if(k===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(k.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{ce(K,se,Z);return}}i.bindTexture(e.TEXTURE_2D,K.__webglTexture,e.TEXTURE0+Z)}function F(se,Z){const K=r.get(se);if(se.version>0&&K.__version!==se.version){ce(K,se,Z);return}i.bindTexture(e.TEXTURE_2D_ARRAY,K.__webglTexture,e.TEXTURE0+Z)}function Q(se,Z){const K=r.get(se);if(se.version>0&&K.__version!==se.version){ce(K,se,Z);return}i.bindTexture(e.TEXTURE_3D,K.__webglTexture,e.TEXTURE0+Z)}function Y(se,Z){const K=r.get(se);if(se.version>0&&K.__version!==se.version){$(K,se,Z);return}i.bindTexture(e.TEXTURE_CUBE_MAP,K.__webglTexture,e.TEXTURE0+Z)}const O={[rw]:e.REPEAT,[Qo]:e.CLAMP_TO_EDGE,[nw]:e.MIRRORED_REPEAT},j={[os]:e.NEAREST,[qk]:e.NEAREST_MIPMAP_NEAREST,[lv]:e.NEAREST_MIPMAP_LINEAR,[_n]:e.LINEAR,[i1]:e.LINEAR_MIPMAP_NEAREST,[Lc]:e.LINEAR_MIPMAP_LINEAR},V={[aee]:e.NEVER,[dee]:e.ALWAYS,[oee]:e.LESS,[nU]:e.LEQUAL,[lee]:e.EQUAL,[hee]:e.GEQUAL,[cee]:e.GREATER,[uee]:e.NOTEQUAL};function W(se,Z){if(Z.type===Ua&&t.has("OES_texture_float_linear")===!1&&(Z.magFilter===_n||Z.magFilter===i1||Z.magFilter===lv||Z.magFilter===Lc||Z.minFilter===_n||Z.minFilter===i1||Z.minFilter===lv||Z.minFilter===Lc)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),e.texParameteri(se,e.TEXTURE_WRAP_S,O[Z.wrapS]),e.texParameteri(se,e.TEXTURE_WRAP_T,O[Z.wrapT]),(se===e.TEXTURE_3D||se===e.TEXTURE_2D_ARRAY)&&e.texParameteri(se,e.TEXTURE_WRAP_R,O[Z.wrapR]),e.texParameteri(se,e.TEXTURE_MAG_FILTER,j[Z.magFilter]),e.texParameteri(se,e.TEXTURE_MIN_FILTER,j[Z.minFilter]),Z.compareFunction&&(e.texParameteri(se,e.TEXTURE_COMPARE_MODE,e.COMPARE_REF_TO_TEXTURE),e.texParameteri(se,e.TEXTURE_COMPARE_FUNC,V[Z.compareFunction])),t.has("EXT_texture_filter_anisotropic")===!0){if(Z.magFilter===os||Z.minFilter!==lv&&Z.minFilter!==Lc||Z.type===Ua&&t.has("OES_texture_float_linear")===!1)return;if(Z.anisotropy>1||r.get(Z).__currentAnisotropy){const K=t.get("EXT_texture_filter_anisotropic");e.texParameterf(se,K.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(Z.anisotropy,n.getMaxAnisotropy())),r.get(Z).__currentAnisotropy=Z.anisotropy}}}function J(se,Z){let K=!1;se.__webglInit===void 0&&(se.__webglInit=!0,Z.addEventListener("dispose",M));const k=Z.source;let re=d.get(k);re===void 0&&(re={},d.set(k,re));const he=L(Z);if(he!==se.__cacheKey){re[he]===void 0&&(re[he]={texture:e.createTexture(),usedTimes:0},a.memory.textures++,K=!0),re[he].usedTimes++;const G=re[se.__cacheKey];G!==void 0&&(re[se.__cacheKey].usedTimes--,G.usedTimes===0&&T(Z)),se.__cacheKey=he,se.__webglTexture=re[he].texture}return K}function ce(se,Z,K){let k=e.TEXTURE_2D;(Z.isDataArrayTexture||Z.isCompressedArrayTexture)&&(k=e.TEXTURE_2D_ARRAY),Z.isData3DTexture&&(k=e.TEXTURE_3D);const re=J(se,Z),he=Z.source;i.bindTexture(k,se.__webglTexture,e.TEXTURE0+K);const G=r.get(he);if(he.version!==G.__version||re===!0){i.activeTexture(e.TEXTURE0+K);const Te=Gi.getPrimaries(Gi.workingColorSpace),ze=Z.colorSpace===Vu?null:Gi.getPrimaries(Z.colorSpace),Qe=Z.colorSpace===Vu||Te===ze?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,Z.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Z.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,Z.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,Qe);let ye=v(Z.image,!1,n.maxTextureSize);ye=ke(Z,ye);const je=s.convert(Z.format,Z.colorSpace),nt=s.convert(Z.type);let ct=x(Z.internalFormat,je,nt,Z.colorSpace,Z.isVideoTexture);W(k,Z);let tt;const ue=Z.mipmaps,Ue=Z.isVideoTexture!==!0,dt=G.__version===void 0||re===!0,xe=he.dataReady,ae=_(Z,ye);if(Z.isDepthTexture)ct=w(Z.format===Qf,Z.type),dt&&(Ue?i.texStorage2D(e.TEXTURE_2D,1,ct,ye.width,ye.height):i.texImage2D(e.TEXTURE_2D,0,ct,ye.width,ye.height,0,je,nt,null));else if(Z.isDataTexture)if(ue.length>0){Ue&&dt&&i.texStorage2D(e.TEXTURE_2D,ae,ct,ue[0].width,ue[0].height);for(let fe=0,Se=ue.length;fe<Se;fe++)tt=ue[fe],Ue?xe&&i.texSubImage2D(e.TEXTURE_2D,fe,0,0,tt.width,tt.height,je,nt,tt.data):i.texImage2D(e.TEXTURE_2D,fe,ct,tt.width,tt.height,0,je,nt,tt.data);Z.generateMipmaps=!1}else Ue?(dt&&i.texStorage2D(e.TEXTURE_2D,ae,ct,ye.width,ye.height),xe&&i.texSubImage2D(e.TEXTURE_2D,0,0,0,ye.width,ye.height,je,nt,ye.data)):i.texImage2D(e.TEXTURE_2D,0,ct,ye.width,ye.height,0,je,nt,ye.data);else if(Z.isCompressedTexture)if(Z.isCompressedArrayTexture){Ue&&dt&&i.texStorage3D(e.TEXTURE_2D_ARRAY,ae,ct,ue[0].width,ue[0].height,ye.depth);for(let fe=0,Se=ue.length;fe<Se;fe++)if(tt=ue[fe],Z.format!==Ys)if(je!==null)if(Ue){if(xe)if(Z.layerUpdates.size>0){const Ne=Fz(tt.width,tt.height,Z.format,Z.type);for(const st of Z.layerUpdates){const vt=tt.data.subarray(st*Ne/tt.data.BYTES_PER_ELEMENT,(st+1)*Ne/tt.data.BYTES_PER_ELEMENT);i.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,fe,0,0,st,tt.width,tt.height,1,je,vt,0,0)}Z.clearLayerUpdates()}else i.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,fe,0,0,0,tt.width,tt.height,ye.depth,je,tt.data,0,0)}else i.compressedTexImage3D(e.TEXTURE_2D_ARRAY,fe,ct,tt.width,tt.height,ye.depth,0,tt.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else Ue?xe&&i.texSubImage3D(e.TEXTURE_2D_ARRAY,fe,0,0,0,tt.width,tt.height,ye.depth,je,nt,tt.data):i.texImage3D(e.TEXTURE_2D_ARRAY,fe,ct,tt.width,tt.height,ye.depth,0,je,nt,tt.data)}else{Ue&&dt&&i.texStorage2D(e.TEXTURE_2D,ae,ct,ue[0].width,ue[0].height);for(let fe=0,Se=ue.length;fe<Se;fe++)tt=ue[fe],Z.format!==Ys?je!==null?Ue?xe&&i.compressedTexSubImage2D(e.TEXTURE_2D,fe,0,0,tt.width,tt.height,je,tt.data):i.compressedTexImage2D(e.TEXTURE_2D,fe,ct,tt.width,tt.height,0,tt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Ue?xe&&i.texSubImage2D(e.TEXTURE_2D,fe,0,0,tt.width,tt.height,je,nt,tt.data):i.texImage2D(e.TEXTURE_2D,fe,ct,tt.width,tt.height,0,je,nt,tt.data)}else if(Z.isDataArrayTexture)if(Ue){if(dt&&i.texStorage3D(e.TEXTURE_2D_ARRAY,ae,ct,ye.width,ye.height,ye.depth),xe)if(Z.layerUpdates.size>0){const fe=Fz(ye.width,ye.height,Z.format,Z.type);for(const Se of Z.layerUpdates){const Ne=ye.data.subarray(Se*fe/ye.data.BYTES_PER_ELEMENT,(Se+1)*fe/ye.data.BYTES_PER_ELEMENT);i.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,Se,ye.width,ye.height,1,je,nt,Ne)}Z.clearLayerUpdates()}else i.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,0,ye.width,ye.height,ye.depth,je,nt,ye.data)}else i.texImage3D(e.TEXTURE_2D_ARRAY,0,ct,ye.width,ye.height,ye.depth,0,je,nt,ye.data);else if(Z.isData3DTexture)Ue?(dt&&i.texStorage3D(e.TEXTURE_3D,ae,ct,ye.width,ye.height,ye.depth),xe&&i.texSubImage3D(e.TEXTURE_3D,0,0,0,0,ye.width,ye.height,ye.depth,je,nt,ye.data)):i.texImage3D(e.TEXTURE_3D,0,ct,ye.width,ye.height,ye.depth,0,je,nt,ye.data);else if(Z.isFramebufferTexture){if(dt)if(Ue)i.texStorage2D(e.TEXTURE_2D,ae,ct,ye.width,ye.height);else{let fe=ye.width,Se=ye.height;for(let Ne=0;Ne<ae;Ne++)i.texImage2D(e.TEXTURE_2D,Ne,ct,fe,Se,0,je,nt,null),fe>>=1,Se>>=1}}else if(ue.length>0){if(Ue&&dt){const fe=Fe(ue[0]);i.texStorage2D(e.TEXTURE_2D,ae,ct,fe.width,fe.height)}for(let fe=0,Se=ue.length;fe<Se;fe++)tt=ue[fe],Ue?xe&&i.texSubImage2D(e.TEXTURE_2D,fe,0,0,je,nt,tt):i.texImage2D(e.TEXTURE_2D,fe,ct,je,nt,tt);Z.generateMipmaps=!1}else if(Ue){if(dt){const fe=Fe(ye);i.texStorage2D(e.TEXTURE_2D,ae,ct,fe.width,fe.height)}xe&&i.texSubImage2D(e.TEXTURE_2D,0,0,0,je,nt,ye)}else i.texImage2D(e.TEXTURE_2D,0,ct,je,nt,ye);g(Z)&&m(k),G.__version=he.version,Z.onUpdate&&Z.onUpdate(Z)}se.__version=Z.version}function $(se,Z,K){if(Z.image.length!==6)return;const k=J(se,Z),re=Z.source;i.bindTexture(e.TEXTURE_CUBE_MAP,se.__webglTexture,e.TEXTURE0+K);const he=r.get(re);if(re.version!==he.__version||k===!0){i.activeTexture(e.TEXTURE0+K);const G=Gi.getPrimaries(Gi.workingColorSpace),Te=Z.colorSpace===Vu?null:Gi.getPrimaries(Z.colorSpace),ze=Z.colorSpace===Vu||G===Te?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,Z.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Z.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,Z.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,ze);const Qe=Z.isCompressedTexture||Z.image[0].isCompressedTexture,ye=Z.image[0]&&Z.image[0].isDataTexture,je=[];for(let Se=0;Se<6;Se++)!Qe&&!ye?je[Se]=v(Z.image[Se],!0,n.maxCubemapSize):je[Se]=ye?Z.image[Se].image:Z.image[Se],je[Se]=ke(Z,je[Se]);const nt=je[0],ct=s.convert(Z.format,Z.colorSpace),tt=s.convert(Z.type),ue=x(Z.internalFormat,ct,tt,Z.colorSpace),Ue=Z.isVideoTexture!==!0,dt=he.__version===void 0||k===!0,xe=re.dataReady;let ae=_(Z,nt);W(e.TEXTURE_CUBE_MAP,Z);let fe;if(Qe){Ue&&dt&&i.texStorage2D(e.TEXTURE_CUBE_MAP,ae,ue,nt.width,nt.height);for(let Se=0;Se<6;Se++){fe=je[Se].mipmaps;for(let Ne=0;Ne<fe.length;Ne++){const st=fe[Ne];Z.format!==Ys?ct!==null?Ue?xe&&i.compressedTexSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+Se,Ne,0,0,st.width,st.height,ct,st.data):i.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+Se,Ne,ue,st.width,st.height,0,st.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Ue?xe&&i.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+Se,Ne,0,0,st.width,st.height,ct,tt,st.data):i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+Se,Ne,ue,st.width,st.height,0,ct,tt,st.data)}}}else{if(fe=Z.mipmaps,Ue&&dt){fe.length>0&&ae++;const Se=Fe(je[0]);i.texStorage2D(e.TEXTURE_CUBE_MAP,ae,ue,Se.width,Se.height)}for(let Se=0;Se<6;Se++)if(ye){Ue?xe&&i.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+Se,0,0,0,je[Se].width,je[Se].height,ct,tt,je[Se].data):i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+Se,0,ue,je[Se].width,je[Se].height,0,ct,tt,je[Se].data);for(let Ne=0;Ne<fe.length;Ne++){const vt=fe[Ne].image[Se].image;Ue?xe&&i.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+Se,Ne+1,0,0,vt.width,vt.height,ct,tt,vt.data):i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+Se,Ne+1,ue,vt.width,vt.height,0,ct,tt,vt.data)}}else{Ue?xe&&i.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+Se,0,0,0,ct,tt,je[Se]):i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+Se,0,ue,ct,tt,je[Se]);for(let Ne=0;Ne<fe.length;Ne++){const st=fe[Ne];Ue?xe&&i.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+Se,Ne+1,0,0,ct,tt,st.image[Se]):i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+Se,Ne+1,ue,ct,tt,st.image[Se])}}}g(Z)&&m(e.TEXTURE_CUBE_MAP),he.__version=re.version,Z.onUpdate&&Z.onUpdate(Z)}se.__version=Z.version}function ne(se,Z,K,k,re,he){const G=s.convert(K.format,K.colorSpace),Te=s.convert(K.type),ze=x(K.internalFormat,G,Te,K.colorSpace);if(!r.get(Z).__hasExternalTextures){const ye=Math.max(1,Z.width>>he),je=Math.max(1,Z.height>>he);re===e.TEXTURE_3D||re===e.TEXTURE_2D_ARRAY?i.texImage3D(re,he,ze,ye,je,Z.depth,0,G,Te,null):i.texImage2D(re,he,ze,ye,je,0,G,Te,null)}i.bindFramebuffer(e.FRAMEBUFFER,se),Pe(Z)?o.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,k,re,r.get(K).__webglTexture,0,Ie(Z)):(re===e.TEXTURE_2D||re>=e.TEXTURE_CUBE_MAP_POSITIVE_X&&re<=e.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&e.framebufferTexture2D(e.FRAMEBUFFER,k,re,r.get(K).__webglTexture,he),i.bindFramebuffer(e.FRAMEBUFFER,null)}function ie(se,Z,K){if(e.bindRenderbuffer(e.RENDERBUFFER,se),Z.depthBuffer){const k=Z.depthTexture,re=k&&k.isDepthTexture?k.type:null,he=w(Z.stencilBuffer,re),G=Z.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,Te=Ie(Z);Pe(Z)?o.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,Te,he,Z.width,Z.height):K?e.renderbufferStorageMultisample(e.RENDERBUFFER,Te,he,Z.width,Z.height):e.renderbufferStorage(e.RENDERBUFFER,he,Z.width,Z.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,G,e.RENDERBUFFER,se)}else{const k=Z.textures;for(let re=0;re<k.length;re++){const he=k[re],G=s.convert(he.format,he.colorSpace),Te=s.convert(he.type),ze=x(he.internalFormat,G,Te,he.colorSpace),Qe=Ie(Z);K&&Pe(Z)===!1?e.renderbufferStorageMultisample(e.RENDERBUFFER,Qe,ze,Z.width,Z.height):Pe(Z)?o.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,Qe,ze,Z.width,Z.height):e.renderbufferStorage(e.RENDERBUFFER,ze,Z.width,Z.height)}}e.bindRenderbuffer(e.RENDERBUFFER,null)}function de(se,Z){if(Z&&Z.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(e.FRAMEBUFFER,se),!(Z.depthTexture&&Z.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!r.get(Z.depthTexture).__webglTexture||Z.depthTexture.image.width!==Z.width||Z.depthTexture.image.height!==Z.height)&&(Z.depthTexture.image.width=Z.width,Z.depthTexture.image.height=Z.height,Z.depthTexture.needsUpdate=!0),z(Z.depthTexture,0);const k=r.get(Z.depthTexture).__webglTexture,re=Ie(Z);if(Z.depthTexture.format===Df)Pe(Z)?o.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,k,0,re):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,k,0);else if(Z.depthTexture.format===Qf)Pe(Z)?o.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,k,0,re):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,k,0);else throw new Error("Unknown depthTexture format")}function be(se){const Z=r.get(se),K=se.isWebGLCubeRenderTarget===!0;if(se.depthTexture&&!Z.__autoAllocateDepthBuffer){if(K)throw new Error("target.depthTexture not supported in Cube render targets");de(Z.__webglFramebuffer,se)}else if(K){Z.__webglDepthbuffer=[];for(let k=0;k<6;k++)i.bindFramebuffer(e.FRAMEBUFFER,Z.__webglFramebuffer[k]),Z.__webglDepthbuffer[k]=e.createRenderbuffer(),ie(Z.__webglDepthbuffer[k],se,!1)}else i.bindFramebuffer(e.FRAMEBUFFER,Z.__webglFramebuffer),Z.__webglDepthbuffer=e.createRenderbuffer(),ie(Z.__webglDepthbuffer,se,!1);i.bindFramebuffer(e.FRAMEBUFFER,null)}function we(se,Z,K){const k=r.get(se);Z!==void 0&&ne(k.__webglFramebuffer,se,se.texture,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,0),K!==void 0&&be(se)}function _e(se){const Z=se.texture,K=r.get(se),k=r.get(Z);se.addEventListener("dispose",S);const re=se.textures,he=se.isWebGLCubeRenderTarget===!0,G=re.length>1;if(G||(k.__webglTexture===void 0&&(k.__webglTexture=e.createTexture()),k.__version=Z.version,a.memory.textures++),he){K.__webglFramebuffer=[];for(let Te=0;Te<6;Te++)if(Z.mipmaps&&Z.mipmaps.length>0){K.__webglFramebuffer[Te]=[];for(let ze=0;ze<Z.mipmaps.length;ze++)K.__webglFramebuffer[Te][ze]=e.createFramebuffer()}else K.__webglFramebuffer[Te]=e.createFramebuffer()}else{if(Z.mipmaps&&Z.mipmaps.length>0){K.__webglFramebuffer=[];for(let Te=0;Te<Z.mipmaps.length;Te++)K.__webglFramebuffer[Te]=e.createFramebuffer()}else K.__webglFramebuffer=e.createFramebuffer();if(G)for(let Te=0,ze=re.length;Te<ze;Te++){const Qe=r.get(re[Te]);Qe.__webglTexture===void 0&&(Qe.__webglTexture=e.createTexture(),a.memory.textures++)}if(se.samples>0&&Pe(se)===!1){K.__webglMultisampledFramebuffer=e.createFramebuffer(),K.__webglColorRenderbuffer=[],i.bindFramebuffer(e.FRAMEBUFFER,K.__webglMultisampledFramebuffer);for(let Te=0;Te<re.length;Te++){const ze=re[Te];K.__webglColorRenderbuffer[Te]=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,K.__webglColorRenderbuffer[Te]);const Qe=s.convert(ze.format,ze.colorSpace),ye=s.convert(ze.type),je=x(ze.internalFormat,Qe,ye,ze.colorSpace,se.isXRRenderTarget===!0),nt=Ie(se);e.renderbufferStorageMultisample(e.RENDERBUFFER,nt,je,se.width,se.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+Te,e.RENDERBUFFER,K.__webglColorRenderbuffer[Te])}e.bindRenderbuffer(e.RENDERBUFFER,null),se.depthBuffer&&(K.__webglDepthRenderbuffer=e.createRenderbuffer(),ie(K.__webglDepthRenderbuffer,se,!0)),i.bindFramebuffer(e.FRAMEBUFFER,null)}}if(he){i.bindTexture(e.TEXTURE_CUBE_MAP,k.__webglTexture),W(e.TEXTURE_CUBE_MAP,Z);for(let Te=0;Te<6;Te++)if(Z.mipmaps&&Z.mipmaps.length>0)for(let ze=0;ze<Z.mipmaps.length;ze++)ne(K.__webglFramebuffer[Te][ze],se,Z,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+Te,ze);else ne(K.__webglFramebuffer[Te],se,Z,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+Te,0);g(Z)&&m(e.TEXTURE_CUBE_MAP),i.unbindTexture()}else if(G){for(let Te=0,ze=re.length;Te<ze;Te++){const Qe=re[Te],ye=r.get(Qe);i.bindTexture(e.TEXTURE_2D,ye.__webglTexture),W(e.TEXTURE_2D,Qe),ne(K.__webglFramebuffer,se,Qe,e.COLOR_ATTACHMENT0+Te,e.TEXTURE_2D,0),g(Qe)&&m(e.TEXTURE_2D)}i.unbindTexture()}else{let Te=e.TEXTURE_2D;if((se.isWebGL3DRenderTarget||se.isWebGLArrayRenderTarget)&&(Te=se.isWebGL3DRenderTarget?e.TEXTURE_3D:e.TEXTURE_2D_ARRAY),i.bindTexture(Te,k.__webglTexture),W(Te,Z),Z.mipmaps&&Z.mipmaps.length>0)for(let ze=0;ze<Z.mipmaps.length;ze++)ne(K.__webglFramebuffer[ze],se,Z,e.COLOR_ATTACHMENT0,Te,ze);else ne(K.__webglFramebuffer,se,Z,e.COLOR_ATTACHMENT0,Te,0);g(Z)&&m(Te),i.unbindTexture()}se.depthBuffer&&be(se)}function Me(se){const Z=se.textures;for(let K=0,k=Z.length;K<k;K++){const re=Z[K];if(g(re)){const he=se.isWebGLCubeRenderTarget?e.TEXTURE_CUBE_MAP:e.TEXTURE_2D,G=r.get(re).__webglTexture;i.bindTexture(he,G),m(he),i.unbindTexture()}}}const X=[],ge=[];function Oe(se){if(se.samples>0){if(Pe(se)===!1){const Z=se.textures,K=se.width,k=se.height;let re=e.COLOR_BUFFER_BIT;const he=se.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,G=r.get(se),Te=Z.length>1;if(Te)for(let ze=0;ze<Z.length;ze++)i.bindFramebuffer(e.FRAMEBUFFER,G.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+ze,e.RENDERBUFFER,null),i.bindFramebuffer(e.FRAMEBUFFER,G.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+ze,e.TEXTURE_2D,null,0);i.bindFramebuffer(e.READ_FRAMEBUFFER,G.__webglMultisampledFramebuffer),i.bindFramebuffer(e.DRAW_FRAMEBUFFER,G.__webglFramebuffer);for(let ze=0;ze<Z.length;ze++){if(se.resolveDepthBuffer&&(se.depthBuffer&&(re|=e.DEPTH_BUFFER_BIT),se.stencilBuffer&&se.resolveStencilBuffer&&(re|=e.STENCIL_BUFFER_BIT)),Te){e.framebufferRenderbuffer(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,G.__webglColorRenderbuffer[ze]);const Qe=r.get(Z[ze]).__webglTexture;e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,Qe,0)}e.blitFramebuffer(0,0,K,k,0,0,K,k,re,e.NEAREST),l===!0&&(X.length=0,ge.length=0,X.push(e.COLOR_ATTACHMENT0+ze),se.depthBuffer&&se.resolveDepthBuffer===!1&&(X.push(he),ge.push(he),e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,ge)),e.invalidateFramebuffer(e.READ_FRAMEBUFFER,X))}if(i.bindFramebuffer(e.READ_FRAMEBUFFER,null),i.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),Te)for(let ze=0;ze<Z.length;ze++){i.bindFramebuffer(e.FRAMEBUFFER,G.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+ze,e.RENDERBUFFER,G.__webglColorRenderbuffer[ze]);const Qe=r.get(Z[ze]).__webglTexture;i.bindFramebuffer(e.FRAMEBUFFER,G.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+ze,e.TEXTURE_2D,Qe,0)}i.bindFramebuffer(e.DRAW_FRAMEBUFFER,G.__webglMultisampledFramebuffer)}else if(se.depthBuffer&&se.resolveDepthBuffer===!1&&l){const Z=se.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT;e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,[Z])}}}function Ie(se){return Math.min(n.maxSamples,se.samples)}function Pe(se){const Z=r.get(se);return se.samples>0&&t.has("WEBGL_multisampled_render_to_texture")===!0&&Z.__useRenderToTexture!==!1}function Ye(se){const Z=a.render.frame;u.get(se)!==Z&&(u.set(se,Z),se.update())}function ke(se,Z){const K=se.colorSpace,k=se.format,re=se.type;return se.isCompressedTexture===!0||se.isVideoTexture===!0||K!==Ah&&K!==Vu&&(Gi.getTransfer(K)===yr?(k!==Ys||re!==jl)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",K)),Z}function Fe(se){return typeof HTMLImageElement<"u"&&se instanceof HTMLImageElement?(c.width=se.naturalWidth||se.width,c.height=se.naturalHeight||se.height):typeof VideoFrame<"u"&&se instanceof VideoFrame?(c.width=se.displayWidth,c.height=se.displayHeight):(c.width=se.width,c.height=se.height),c}this.allocateTextureUnit=I,this.resetTextureUnits=D,this.setTexture2D=z,this.setTexture2DArray=F,this.setTexture3D=Q,this.setTextureCube=Y,this.rebindTextures=we,this.setupRenderTarget=_e,this.updateRenderTargetMipmap=Me,this.updateMultisampleRenderTarget=Oe,this.setupDepthRenderbuffer=be,this.setupFrameBufferTexture=ne,this.useMultisampledRTT=Pe}function Cee(e,t){function i(r,n=Vu){let s;const a=Gi.getTransfer(n);if(r===jl)return e.UNSIGNED_BYTE;if(r===ZT)return e.UNSIGNED_SHORT_4_4_4_4;if(r===$T)return e.UNSIGNED_SHORT_5_5_5_1;if(r===Kk)return e.UNSIGNED_INT_5_9_9_9_REV;if(r===Yk)return e.BYTE;if(r===Qk)return e.SHORT;if(r===a0)return e.UNSIGNED_SHORT;if(r===KT)return e.INT;if(r===yh)return e.UNSIGNED_INT;if(r===Ua)return e.FLOAT;if(r===U0)return e.HALF_FLOAT;if(r===Zk)return e.ALPHA;if(r===$k)return e.RGB;if(r===Ys)return e.RGBA;if(r===Jk)return e.LUMINANCE;if(r===eU)return e.LUMINANCE_ALPHA;if(r===Df)return e.DEPTH_COMPONENT;if(r===Qf)return e.DEPTH_STENCIL;if(r===JT)return e.RED;if(r===Zw)return e.RED_INTEGER;if(r===tU)return e.RG;if(r===e2)return e.RG_INTEGER;if(r===t2)return e.RGBA_INTEGER;if(r===r1||r===n1||r===s1||r===a1)if(a===yr)if(s=t.get("WEBGL_compressed_texture_s3tc_srgb"),s!==null){if(r===r1)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(r===n1)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(r===s1)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(r===a1)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(s=t.get("WEBGL_compressed_texture_s3tc"),s!==null){if(r===r1)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===n1)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===s1)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===a1)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(r===xC||r===wC||r===bC||r===_C)if(s=t.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(r===xC)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===wC)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===bC)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===_C)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(r===SC||r===MC||r===EC)if(s=t.get("WEBGL_compressed_texture_etc"),s!==null){if(r===SC||r===MC)return a===yr?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(r===EC)return a===yr?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(r===AC||r===CC||r===TC||r===PC||r===DC||r===RC||r===IC||r===LC||r===OC||r===zC||r===NC||r===BC||r===kC||r===UC)if(s=t.get("WEBGL_compressed_texture_astc"),s!==null){if(r===AC)return a===yr?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(r===CC)return a===yr?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(r===TC)return a===yr?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(r===PC)return a===yr?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(r===DC)return a===yr?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(r===RC)return a===yr?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(r===IC)return a===yr?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(r===LC)return a===yr?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(r===OC)return a===yr?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(r===zC)return a===yr?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(r===NC)return a===yr?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(r===BC)return a===yr?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(r===kC)return a===yr?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(r===UC)return a===yr?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(r===o1||r===FC||r===VC)if(s=t.get("EXT_texture_compression_bptc"),s!==null){if(r===o1)return a===yr?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(r===FC)return s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(r===VC)return s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(r===iU||r===HC||r===GC||r===jC)if(s=t.get("EXT_texture_compression_rgtc"),s!==null){if(r===o1)return s.COMPRESSED_RED_RGTC1_EXT;if(r===HC)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(r===GC)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(r===jC)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return r===Yf?e.UNSIGNED_INT_24_8:e[r]!==void 0?e[r]:null}return{convert:i}}class Tee extends Kr{constructor(t=[]){super(),this.isArrayCamera=!0,this.cameras=t}}class hv extends ki{constructor(){super(),this.isGroup=!0,this.type="Group"}}const Nke={type:"move"};class ZR{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new hv,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new hv,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new oe,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new oe),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new hv,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new oe,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new oe),this._grip}dispatchEvent(t){return this._targetRay!==null&&this._targetRay.dispatchEvent(t),this._grip!==null&&this._grip.dispatchEvent(t),this._hand!==null&&this._hand.dispatchEvent(t),this}connect(t){if(t&&t.hand){const i=this._hand;if(i)for(const r of t.hand.values())this._getHandJoint(i,r)}return this.dispatchEvent({type:"connected",data:t}),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(t,i,r){let n=null,s=null,a=null;const o=this._targetRay,l=this._grip,c=this._hand;if(t&&i.session.visibilityState!=="visible-blurred"){if(c&&t.hand){a=!0;for(const v of t.hand.values()){const g=i.getJointPose(v,r),m=this._getHandJoint(c,v);g!==null&&(m.matrix.fromArray(g.transform.matrix),m.matrix.decompose(m.position,m.rotation,m.scale),m.matrixWorldNeedsUpdate=!0,m.jointRadius=g.radius),m.visible=g!==null}const u=c.joints["index-finger-tip"],h=c.joints["thumb-tip"],d=u.position.distanceTo(h.position),p=.02,f=.005;c.inputState.pinching&&d>p+f?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!c.inputState.pinching&&d<=p-f&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else l!==null&&t.gripSpace&&(s=i.getPose(t.gripSpace,r),s!==null&&(l.matrix.fromArray(s.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,s.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(s.linearVelocity)):l.hasLinearVelocity=!1,s.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(s.angularVelocity)):l.hasAngularVelocity=!1));o!==null&&(n=i.getPose(t.targetRaySpace,r),n===null&&s!==null&&(n=s),n!==null&&(o.matrix.fromArray(n.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,n.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(n.linearVelocity)):o.hasLinearVelocity=!1,n.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(n.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(Nke)))}return o!==null&&(o.visible=n!==null),l!==null&&(l.visible=s!==null),c!==null&&(c.visible=a!==null),this}_getHandJoint(t,i){if(t.joints[i.jointName]===void 0){const r=new hv;r.matrixAutoUpdate=!1,r.visible=!1,t.joints[i.jointName]=r,t.add(r)}return t.joints[i.jointName]}}const Bke=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,kke=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class Uke{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(t,i,r){if(this.texture===null){const n=new kr,s=t.properties.get(n);s.__webglTexture=i.texture,(i.depthNear!=r.depthNear||i.depthFar!=r.depthFar)&&(this.depthNear=i.depthNear,this.depthFar=i.depthFar),this.texture=n}}getMesh(t){if(this.texture!==null&&this.mesh===null){const i=t.cameras[0].viewport,r=new Xl({vertexShader:Bke,fragmentShader:kke,uniforms:{depthColor:{value:this.texture},depthWidth:{value:i.z},depthHeight:{value:i.w}}});this.mesh=new En(new F0(20,20),r)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class Fke extends $c{constructor(t,i){super();const r=this;let n=null,s=1,a=null,o="local-floor",l=1,c=null,u=null,h=null,d=null,p=null,f=null;const v=new Uke,g=i.getContextAttributes();let m=null,x=null;const w=[],_=[],M=new ot;let S=null;const A=new Kr;A.layers.enable(1),A.viewport=new tr;const T=new Kr;T.layers.enable(2),T.viewport=new tr;const E=[A,T],C=new Tee;C.layers.enable(1),C.layers.enable(2);let D=null,I=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function($){let ne=w[$];return ne===void 0&&(ne=new ZR,w[$]=ne),ne.getTargetRaySpace()},this.getControllerGrip=function($){let ne=w[$];return ne===void 0&&(ne=new ZR,w[$]=ne),ne.getGripSpace()},this.getHand=function($){let ne=w[$];return ne===void 0&&(ne=new ZR,w[$]=ne),ne.getHandSpace()};function L($){const ne=_.indexOf($.inputSource);if(ne===-1)return;const ie=w[ne];ie!==void 0&&(ie.update($.inputSource,$.frame,c||a),ie.dispatchEvent({type:$.type,data:$.inputSource}))}function z(){n.removeEventListener("select",L),n.removeEventListener("selectstart",L),n.removeEventListener("selectend",L),n.removeEventListener("squeeze",L),n.removeEventListener("squeezestart",L),n.removeEventListener("squeezeend",L),n.removeEventListener("end",z),n.removeEventListener("inputsourceschange",F);for(let $=0;$<w.length;$++){const ne=_[$];ne!==null&&(_[$]=null,w[$].disconnect(ne))}D=null,I=null,v.reset(),t.setRenderTarget(m),p=null,d=null,h=null,n=null,x=null,ce.stop(),r.isPresenting=!1,t.setPixelRatio(S),t.setSize(M.width,M.height,!1),r.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function($){s=$,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function($){o=$,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return c||a},this.setReferenceSpace=function($){c=$},this.getBaseLayer=function(){return d!==null?d:p},this.getBinding=function(){return h},this.getFrame=function(){return f},this.getSession=function(){return n},this.setSession=async function($){if(n=$,n!==null){if(m=t.getRenderTarget(),n.addEventListener("select",L),n.addEventListener("selectstart",L),n.addEventListener("selectend",L),n.addEventListener("squeeze",L),n.addEventListener("squeezestart",L),n.addEventListener("squeezeend",L),n.addEventListener("end",z),n.addEventListener("inputsourceschange",F),g.xrCompatible!==!0&&await i.makeXRCompatible(),S=t.getPixelRatio(),t.getSize(M),n.renderState.layers===void 0){const ne={antialias:g.antialias,alpha:!0,depth:g.depth,stencil:g.stencil,framebufferScaleFactor:s};p=new XRWebGLLayer(n,i,ne),n.updateRenderState({baseLayer:p}),t.setPixelRatio(1),t.setSize(p.framebufferWidth,p.framebufferHeight,!1),x=new Wl(p.framebufferWidth,p.framebufferHeight,{format:Ys,type:jl,colorSpace:t.outputColorSpace,stencilBuffer:g.stencil})}else{let ne=null,ie=null,de=null;g.depth&&(de=g.stencil?i.DEPTH24_STENCIL8:i.DEPTH_COMPONENT24,ne=g.stencil?Qf:Df,ie=g.stencil?Yf:yh);const be={colorFormat:i.RGBA8,depthFormat:de,scaleFactor:s};h=new XRWebGLBinding(n,i),d=h.createProjectionLayer(be),n.updateRenderState({layers:[d]}),t.setPixelRatio(1),t.setSize(d.textureWidth,d.textureHeight,!1),x=new Wl(d.textureWidth,d.textureHeight,{format:Ys,type:jl,depthTexture:new uU(d.textureWidth,d.textureHeight,ie,void 0,void 0,void 0,void 0,void 0,void 0,ne),stencilBuffer:g.stencil,colorSpace:t.outputColorSpace,samples:g.antialias?4:0,resolveDepthBuffer:d.ignoreDepthValues===!1})}x.isXRRenderTarget=!0,this.setFoveation(l),c=null,a=await n.requestReferenceSpace(o),ce.setContext(n),ce.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(n!==null)return n.environmentBlendMode},this.getDepthTexture=function(){return v.getDepthTexture()};function F($){for(let ne=0;ne<$.removed.length;ne++){const ie=$.removed[ne],de=_.indexOf(ie);de>=0&&(_[de]=null,w[de].disconnect(ie))}for(let ne=0;ne<$.added.length;ne++){const ie=$.added[ne];let de=_.indexOf(ie);if(de===-1){for(let we=0;we<w.length;we++)if(we>=_.length){_.push(ie),de=we;break}else if(_[we]===null){_[we]=ie,de=we;break}if(de===-1)break}const be=w[de];be&&be.connect(ie)}}const Q=new oe,Y=new oe;function O($,ne,ie){Q.setFromMatrixPosition(ne.matrixWorld),Y.setFromMatrixPosition(ie.matrixWorld);const de=Q.distanceTo(Y),be=ne.projectionMatrix.elements,we=ie.projectionMatrix.elements,_e=be[14]/(be[10]-1),Me=be[14]/(be[10]+1),X=(be[9]+1)/be[5],ge=(be[9]-1)/be[5],Oe=(be[8]-1)/be[0],Ie=(we[8]+1)/we[0],Pe=_e*Oe,Ye=_e*Ie,ke=de/(-Oe+Ie),Fe=ke*-Oe;ne.matrixWorld.decompose($.position,$.quaternion,$.scale),$.translateX(Fe),$.translateZ(ke),$.matrixWorld.compose($.position,$.quaternion,$.scale),$.matrixWorldInverse.copy($.matrixWorld).invert();const se=_e+ke,Z=Me+ke,K=Pe-Fe,k=Ye+(de-Fe),re=X*Me/Z*se,he=ge*Me/Z*se;$.projectionMatrix.makePerspective(K,k,re,he,se,Z),$.projectionMatrixInverse.copy($.projectionMatrix).invert()}function j($,ne){ne===null?$.matrixWorld.copy($.matrix):$.matrixWorld.multiplyMatrices(ne.matrixWorld,$.matrix),$.matrixWorldInverse.copy($.matrixWorld).invert()}this.updateCamera=function($){if(n===null)return;v.texture!==null&&($.near=v.depthNear,$.far=v.depthFar),C.near=T.near=A.near=$.near,C.far=T.far=A.far=$.far,(D!==C.near||I!==C.far)&&(n.updateRenderState({depthNear:C.near,depthFar:C.far}),D=C.near,I=C.far,A.near=D,A.far=I,T.near=D,T.far=I,A.updateProjectionMatrix(),T.updateProjectionMatrix(),$.updateProjectionMatrix());const ne=$.parent,ie=C.cameras;j(C,ne);for(let de=0;de<ie.length;de++)j(ie[de],ne);ie.length===2?O(C,A,T):C.projectionMatrix.copy(A.projectionMatrix),V($,C,ne)};function V($,ne,ie){ie===null?$.matrix.copy(ne.matrixWorld):($.matrix.copy(ie.matrixWorld),$.matrix.invert(),$.matrix.multiply(ne.matrixWorld)),$.matrix.decompose($.position,$.quaternion,$.scale),$.updateMatrixWorld(!0),$.projectionMatrix.copy(ne.projectionMatrix),$.projectionMatrixInverse.copy(ne.projectionMatrixInverse),$.isPerspectiveCamera&&($.fov=o0*2*Math.atan(1/$.projectionMatrix.elements[5]),$.zoom=1)}this.getCamera=function(){return C},this.getFoveation=function(){if(!(d===null&&p===null))return l},this.setFoveation=function($){l=$,d!==null&&(d.fixedFoveation=$),p!==null&&p.fixedFoveation!==void 0&&(p.fixedFoveation=$)},this.hasDepthSensing=function(){return v.texture!==null},this.getDepthSensingMesh=function(){return v.getMesh(C)};let W=null;function J($,ne){if(u=ne.getViewerPose(c||a),f=ne,u!==null){const ie=u.views;p!==null&&(t.setRenderTargetFramebuffer(x,p.framebuffer),t.setRenderTarget(x));let de=!1;ie.length!==C.cameras.length&&(C.cameras.length=0,de=!0);for(let we=0;we<ie.length;we++){const _e=ie[we];let Me=null;if(p!==null)Me=p.getViewport(_e);else{const ge=h.getViewSubImage(d,_e);Me=ge.viewport,we===0&&(t.setRenderTargetTextures(x,ge.colorTexture,d.ignoreDepthValues?void 0:ge.depthStencilTexture),t.setRenderTarget(x))}let X=E[we];X===void 0&&(X=new Kr,X.layers.enable(we),X.viewport=new tr,E[we]=X),X.matrix.fromArray(_e.transform.matrix),X.matrix.decompose(X.position,X.quaternion,X.scale),X.projectionMatrix.fromArray(_e.projectionMatrix),X.projectionMatrixInverse.copy(X.projectionMatrix).invert(),X.viewport.set(Me.x,Me.y,Me.width,Me.height),we===0&&(C.matrix.copy(X.matrix),C.matrix.decompose(C.position,C.quaternion,C.scale)),de===!0&&C.cameras.push(X)}const be=n.enabledFeatures;if(be&&be.includes("depth-sensing")){const we=h.getDepthInformation(ie[0]);we&&we.isValid&&we.texture&&v.init(t,we,n.renderState)}}for(let ie=0;ie<w.length;ie++){const de=_[ie],be=w[ie];de!==null&&be!==void 0&&be.update(de,ne,c||a)}W&&W($,ne),ne.detectedPlanes&&r.dispatchEvent({type:"planesdetected",data:ne}),f=null}const ce=new _ee;ce.setAnimationLoop(J),this.setAnimationLoop=function($){W=$},this.dispose=function(){}}}const Ip=new yo,Vke=new ii;function Hke(e,t){function i(g,m){g.matrixAutoUpdate===!0&&g.updateMatrix(),m.value.copy(g.matrix)}function r(g,m){m.color.getRGB(g.fogColor.value,yee(e)),m.isFog?(g.fogNear.value=m.near,g.fogFar.value=m.far):m.isFogExp2&&(g.fogDensity.value=m.density)}function n(g,m,x,w,_){m.isMeshBasicMaterial||m.isMeshLambertMaterial?s(g,m):m.isMeshToonMaterial?(s(g,m),h(g,m)):m.isMeshPhongMaterial?(s(g,m),u(g,m)):m.isMeshStandardMaterial?(s(g,m),d(g,m),m.isMeshPhysicalMaterial&&p(g,m,_)):m.isMeshMatcapMaterial?(s(g,m),f(g,m)):m.isMeshDepthMaterial?s(g,m):m.isMeshDistanceMaterial?(s(g,m),v(g,m)):m.isMeshNormalMaterial?s(g,m):m.isLineBasicMaterial?(a(g,m),m.isLineDashedMaterial&&o(g,m)):m.isPointsMaterial?l(g,m,x,w):m.isSpriteMaterial?c(g,m):m.isShadowMaterial?(g.color.value.copy(m.color),g.opacity.value=m.opacity):m.isShaderMaterial&&(m.uniformsNeedUpdate=!1)}function s(g,m){g.opacity.value=m.opacity,m.color&&g.diffuse.value.copy(m.color),m.emissive&&g.emissive.value.copy(m.emissive).multiplyScalar(m.emissiveIntensity),m.map&&(g.map.value=m.map,i(m.map,g.mapTransform)),m.alphaMap&&(g.alphaMap.value=m.alphaMap,i(m.alphaMap,g.alphaMapTransform)),m.bumpMap&&(g.bumpMap.value=m.bumpMap,i(m.bumpMap,g.bumpMapTransform),g.bumpScale.value=m.bumpScale,m.side===va&&(g.bumpScale.value*=-1)),m.normalMap&&(g.normalMap.value=m.normalMap,i(m.normalMap,g.normalMapTransform),g.normalScale.value.copy(m.normalScale),m.side===va&&g.normalScale.value.negate()),m.displacementMap&&(g.displacementMap.value=m.displacementMap,i(m.displacementMap,g.displacementMapTransform),g.displacementScale.value=m.displacementScale,g.displacementBias.value=m.displacementBias),m.emissiveMap&&(g.emissiveMap.value=m.emissiveMap,i(m.emissiveMap,g.emissiveMapTransform)),m.specularMap&&(g.specularMap.value=m.specularMap,i(m.specularMap,g.specularMapTransform)),m.alphaTest>0&&(g.alphaTest.value=m.alphaTest);const x=t.get(m),w=x.envMap,_=x.envMapRotation;w&&(g.envMap.value=w,Ip.copy(_),Ip.x*=-1,Ip.y*=-1,Ip.z*=-1,w.isCubeTexture&&w.isRenderTargetTexture===!1&&(Ip.y*=-1,Ip.z*=-1),g.envMapRotation.value.setFromMatrix4(Vke.makeRotationFromEuler(Ip)),g.flipEnvMap.value=w.isCubeTexture&&w.isRenderTargetTexture===!1?-1:1,g.reflectivity.value=m.reflectivity,g.ior.value=m.ior,g.refractionRatio.value=m.refractionRatio),m.lightMap&&(g.lightMap.value=m.lightMap,g.lightMapIntensity.value=m.lightMapIntensity,i(m.lightMap,g.lightMapTransform)),m.aoMap&&(g.aoMap.value=m.aoMap,g.aoMapIntensity.value=m.aoMapIntensity,i(m.aoMap,g.aoMapTransform))}function a(g,m){g.diffuse.value.copy(m.color),g.opacity.value=m.opacity,m.map&&(g.map.value=m.map,i(m.map,g.mapTransform))}function o(g,m){g.dashSize.value=m.dashSize,g.totalSize.value=m.dashSize+m.gapSize,g.scale.value=m.scale}function l(g,m,x,w){g.diffuse.value.copy(m.color),g.opacity.value=m.opacity,g.size.value=m.size*x,g.scale.value=w*.5,m.map&&(g.map.value=m.map,i(m.map,g.uvTransform)),m.alphaMap&&(g.alphaMap.value=m.alphaMap,i(m.alphaMap,g.alphaMapTransform)),m.alphaTest>0&&(g.alphaTest.value=m.alphaTest)}function c(g,m){g.diffuse.value.copy(m.color),g.opacity.value=m.opacity,g.rotation.value=m.rotation,m.map&&(g.map.value=m.map,i(m.map,g.mapTransform)),m.alphaMap&&(g.alphaMap.value=m.alphaMap,i(m.alphaMap,g.alphaMapTransform)),m.alphaTest>0&&(g.alphaTest.value=m.alphaTest)}function u(g,m){g.specular.value.copy(m.specular),g.shininess.value=Math.max(m.shininess,1e-4)}function h(g,m){m.gradientMap&&(g.gradientMap.value=m.gradientMap)}function d(g,m){g.metalness.value=m.metalness,m.metalnessMap&&(g.metalnessMap.value=m.metalnessMap,i(m.metalnessMap,g.metalnessMapTransform)),g.roughness.value=m.roughness,m.roughnessMap&&(g.roughnessMap.value=m.roughnessMap,i(m.roughnessMap,g.roughnessMapTransform)),m.envMap&&(g.envMapIntensity.value=m.envMapIntensity)}function p(g,m,x){g.ior.value=m.ior,m.sheen>0&&(g.sheenColor.value.copy(m.sheenColor).multiplyScalar(m.sheen),g.sheenRoughness.value=m.sheenRoughness,m.sheenColorMap&&(g.sheenColorMap.value=m.sheenColorMap,i(m.sheenColorMap,g.sheenColorMapTransform)),m.sheenRoughnessMap&&(g.sheenRoughnessMap.value=m.sheenRoughnessMap,i(m.sheenRoughnessMap,g.sheenRoughnessMapTransform))),m.clearcoat>0&&(g.clearcoat.value=m.clearcoat,g.clearcoatRoughness.value=m.clearcoatRoughness,m.clearcoatMap&&(g.clearcoatMap.value=m.clearcoatMap,i(m.clearcoatMap,g.clearcoatMapTransform)),m.clearcoatRoughnessMap&&(g.clearcoatRoughnessMap.value=m.clearcoatRoughnessMap,i(m.clearcoatRoughnessMap,g.clearcoatRoughnessMapTransform)),m.clearcoatNormalMap&&(g.clearcoatNormalMap.value=m.clearcoatNormalMap,i(m.clearcoatNormalMap,g.clearcoatNormalMapTransform),g.clearcoatNormalScale.value.copy(m.clearcoatNormalScale),m.side===va&&g.clearcoatNormalScale.value.negate())),m.dispersion>0&&(g.dispersion.value=m.dispersion),m.iridescence>0&&(g.iridescence.value=m.iridescence,g.iridescenceIOR.value=m.iridescenceIOR,g.iridescenceThicknessMinimum.value=m.iridescenceThicknessRange[0],g.iridescenceThicknessMaximum.value=m.iridescenceThicknessRange[1],m.iridescenceMap&&(g.iridescenceMap.value=m.iridescenceMap,i(m.iridescenceMap,g.iridescenceMapTransform)),m.iridescenceThicknessMap&&(g.iridescenceThicknessMap.value=m.iridescenceThicknessMap,i(m.iridescenceThicknessMap,g.iridescenceThicknessMapTransform))),m.transmission>0&&(g.transmission.value=m.transmission,g.transmissionSamplerMap.value=x.texture,g.transmissionSamplerSize.value.set(x.width,x.height),m.transmissionMap&&(g.transmissionMap.value=m.transmissionMap,i(m.transmissionMap,g.transmissionMapTransform)),g.thickness.value=m.thickness,m.thicknessMap&&(g.thicknessMap.value=m.thicknessMap,i(m.thicknessMap,g.thicknessMapTransform)),g.attenuationDistance.value=m.attenuationDistance,g.attenuationColor.value.copy(m.attenuationColor)),m.anisotropy>0&&(g.anisotropyVector.value.set(m.anisotropy*Math.cos(m.anisotropyRotation),m.anisotropy*Math.sin(m.anisotropyRotation)),m.anisotropyMap&&(g.anisotropyMap.value=m.anisotropyMap,i(m.anisotropyMap,g.anisotropyMapTransform))),g.specularIntensity.value=m.specularIntensity,g.specularColor.value.copy(m.specularColor),m.specularColorMap&&(g.specularColorMap.value=m.specularColorMap,i(m.specularColorMap,g.specularColorMapTransform)),m.specularIntensityMap&&(g.specularIntensityMap.value=m.specularIntensityMap,i(m.specularIntensityMap,g.specularIntensityMapTransform))}function f(g,m){m.matcap&&(g.matcap.value=m.matcap)}function v(g,m){const x=t.get(m).light;g.referencePosition.value.setFromMatrixPosition(x.matrixWorld),g.nearDistance.value=x.shadow.camera.near,g.farDistance.value=x.shadow.camera.far}return{refreshFogUniforms:r,refreshMaterialUniforms:n}}function Gke(e,t,i,r){let n={},s={},a=[];const o=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS);function l(x,w){const _=w.program;r.uniformBlockBinding(x,_)}function c(x,w){let _=n[x.id];_===void 0&&(f(x),_=u(x),n[x.id]=_,x.addEventListener("dispose",g));const M=w.program;r.updateUBOMapping(x,M);const S=t.render.frame;s[x.id]!==S&&(d(x),s[x.id]=S)}function u(x){const w=h();x.__bindingPointIndex=w;const _=e.createBuffer(),M=x.__size,S=x.usage;return e.bindBuffer(e.UNIFORM_BUFFER,_),e.bufferData(e.UNIFORM_BUFFER,M,S),e.bindBuffer(e.UNIFORM_BUFFER,null),e.bindBufferBase(e.UNIFORM_BUFFER,w,_),_}function h(){for(let x=0;x<o;x++)if(a.indexOf(x)===-1)return a.push(x),x;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function d(x){const w=n[x.id],_=x.uniforms,M=x.__cache;e.bindBuffer(e.UNIFORM_BUFFER,w);for(let S=0,A=_.length;S<A;S++){const T=Array.isArray(_[S])?_[S]:[_[S]];for(let E=0,C=T.length;E<C;E++){const D=T[E];if(p(D,S,E,M)===!0){const I=D.__offset,L=Array.isArray(D.value)?D.value:[D.value];let z=0;for(let F=0;F<L.length;F++){const Q=L[F],Y=v(Q);typeof Q=="number"||typeof Q=="boolean"?(D.__data[0]=Q,e.bufferSubData(e.UNIFORM_BUFFER,I+z,D.__data)):Q.isMatrix3?(D.__data[0]=Q.elements[0],D.__data[1]=Q.elements[1],D.__data[2]=Q.elements[2],D.__data[3]=0,D.__data[4]=Q.elements[3],D.__data[5]=Q.elements[4],D.__data[6]=Q.elements[5],D.__data[7]=0,D.__data[8]=Q.elements[6],D.__data[9]=Q.elements[7],D.__data[10]=Q.elements[8],D.__data[11]=0):(Q.toArray(D.__data,z),z+=Y.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(e.UNIFORM_BUFFER,I,D.__data)}}}e.bindBuffer(e.UNIFORM_BUFFER,null)}function p(x,w,_,M){const S=x.value,A=w+"_"+_;if(M[A]===void 0)return typeof S=="number"||typeof S=="boolean"?M[A]=S:M[A]=S.clone(),!0;{const T=M[A];if(typeof S=="number"||typeof S=="boolean"){if(T!==S)return M[A]=S,!0}else if(T.equals(S)===!1)return T.copy(S),!0}return!1}function f(x){const w=x.uniforms;let _=0;const M=16;for(let A=0,T=w.length;A<T;A++){const E=Array.isArray(w[A])?w[A]:[w[A]];for(let C=0,D=E.length;C<D;C++){const I=E[C],L=Array.isArray(I.value)?I.value:[I.value];for(let z=0,F=L.length;z<F;z++){const Q=L[z],Y=v(Q),O=_%M,j=O%Y.boundary,V=O+j;_+=j,V!==0&&M-V<Y.storage&&(_+=M-V),I.__data=new Float32Array(Y.storage/Float32Array.BYTES_PER_ELEMENT),I.__offset=_,_+=Y.storage}}}const S=_%M;return S>0&&(_+=M-S),x.__size=_,x.__cache={},this}function v(x){const w={boundary:0,storage:0};return typeof x=="number"||typeof x=="boolean"?(w.boundary=4,w.storage=4):x.isVector2?(w.boundary=8,w.storage=8):x.isVector3||x.isColor?(w.boundary=16,w.storage=12):x.isVector4?(w.boundary=16,w.storage=16):x.isMatrix3?(w.boundary=48,w.storage=48):x.isMatrix4?(w.boundary=64,w.storage=64):x.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",x),w}function g(x){const w=x.target;w.removeEventListener("dispose",g);const _=a.indexOf(w.__bindingPointIndex);a.splice(_,1),e.deleteBuffer(n[w.id]),delete n[w.id],delete s[w.id]}function m(){for(const x in n)e.deleteBuffer(n[x]);a=[],n={},s={}}return{bind:l,update:c,dispose:m}}class Pee{constructor(t={}){const{canvas:i=fee(),context:r=null,depth:n=!0,stencil:s=!1,alpha:a=!1,antialias:o=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:c=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:h=!1}=t;this.isWebGLRenderer=!0;let d;if(r!==null){if(typeof WebGLRenderingContext<"u"&&r instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");d=r.getContextAttributes().alpha}else d=a;const p=new Uint32Array(4),f=new Int32Array(4);let v=null,g=null;const m=[],x=[];this.domElement=i,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=Vo,this.toneMapping=Hc,this.toneMappingExposure=1;const w=this;let _=!1,M=0,S=0,A=null,T=-1,E=null;const C=new tr,D=new tr;let I=null;const L=new Rt(0);let z=0,F=i.width,Q=i.height,Y=1,O=null,j=null;const V=new tr(0,0,F,Q),W=new tr(0,0,F,Q);let J=!1;const ce=new tb;let $=!1,ne=!1;const ie=new ii,de=new oe,be=new tr,we={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let _e=!1;function Me(){return A===null?Y:1}let X=r;function ge(ee,Ce){return i.getContext(ee,Ce)}try{const ee={alpha:!0,depth:n,stencil:s,antialias:o,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:u,failIfMajorPerformanceCaveat:h};if("setAttribute"in i&&i.setAttribute("data-engine",`three.js r${qT}`),i.addEventListener("webglcontextlost",fe,!1),i.addEventListener("webglcontextrestored",Se,!1),i.addEventListener("webglcontextcreationerror",Ne,!1),X===null){const Ce="webgl2";if(X=ge(Ce,ee),X===null)throw ge(Ce)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(ee){throw console.error("THREE.WebGLRenderer: "+ee.message),ee}let Oe,Ie,Pe,Ye,ke,Fe,se,Z,K,k,re,he,G,Te,ze,Qe,ye,je,nt,ct,tt,ue,Ue,dt;function xe(){Oe=new KNe(X),Oe.init(),ue=new Cee(X,Oe),Ie=new jNe(X,Oe,t,ue),Pe=new Pke(X),Ye=new JNe(X),ke=new vke,Fe=new zke(X,Oe,Pe,ke,Ie,ue,Ye),se=new XNe(w),Z=new QNe(w),K=new aOe(X),Ue=new HNe(X,K),k=new ZNe(X,K,Ye,Ue),re=new tBe(X,k,K,Ye),nt=new eBe(X,Ie,Fe),Qe=new WNe(ke),he=new gke(w,se,Z,Oe,Ie,Ue,Qe),G=new Hke(w,ke),Te=new xke,ze=new Eke(Oe),je=new VNe(w,se,Z,Pe,re,d,l),ye=new Tke(w,re,Ie),dt=new Gke(X,Ye,Ie,Pe),ct=new GNe(X,Oe,Ye),tt=new $Ne(X,Oe,Ye),Ye.programs=he.programs,w.capabilities=Ie,w.extensions=Oe,w.properties=ke,w.renderLists=Te,w.shadowMap=ye,w.state=Pe,w.info=Ye}xe();const ae=new Fke(w,X);this.xr=ae,this.getContext=function(){return X},this.getContextAttributes=function(){return X.getContextAttributes()},this.forceContextLoss=function(){const ee=Oe.get("WEBGL_lose_context");ee&&ee.loseContext()},this.forceContextRestore=function(){const ee=Oe.get("WEBGL_lose_context");ee&&ee.restoreContext()},this.getPixelRatio=function(){return Y},this.setPixelRatio=function(ee){ee!==void 0&&(Y=ee,this.setSize(F,Q,!1))},this.getSize=function(ee){return ee.set(F,Q)},this.setSize=function(ee,Ce,De=!0){if(ae.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}F=ee,Q=Ce,i.width=Math.floor(ee*Y),i.height=Math.floor(Ce*Y),De===!0&&(i.style.width=ee+"px",i.style.height=Ce+"px"),this.setViewport(0,0,ee,Ce)},this.getDrawingBufferSize=function(ee){return ee.set(F*Y,Q*Y).floor()},this.setDrawingBufferSize=function(ee,Ce,De){F=ee,Q=Ce,Y=De,i.width=Math.floor(ee*De),i.height=Math.floor(Ce*De),this.setViewport(0,0,ee,Ce)},this.getCurrentViewport=function(ee){return ee.copy(C)},this.getViewport=function(ee){return ee.copy(V)},this.setViewport=function(ee,Ce,De,Le){ee.isVector4?V.set(ee.x,ee.y,ee.z,ee.w):V.set(ee,Ce,De,Le),Pe.viewport(C.copy(V).multiplyScalar(Y).round())},this.getScissor=function(ee){return ee.copy(W)},this.setScissor=function(ee,Ce,De,Le){ee.isVector4?W.set(ee.x,ee.y,ee.z,ee.w):W.set(ee,Ce,De,Le),Pe.scissor(D.copy(W).multiplyScalar(Y).round())},this.getScissorTest=function(){return J},this.setScissorTest=function(ee){Pe.setScissorTest(J=ee)},this.setOpaqueSort=function(ee){O=ee},this.setTransparentSort=function(ee){j=ee},this.getClearColor=function(ee){return ee.copy(je.getClearColor())},this.setClearColor=function(){je.setClearColor.apply(je,arguments)},this.getClearAlpha=function(){return je.getClearAlpha()},this.setClearAlpha=function(){je.setClearAlpha.apply(je,arguments)},this.clear=function(ee=!0,Ce=!0,De=!0){let Le=0;if(ee){let Ee=!1;if(A!==null){const pt=A.texture.format;Ee=pt===t2||pt===e2||pt===Zw}if(Ee){const pt=A.texture.type,bt=pt===jl||pt===yh||pt===a0||pt===Yf||pt===ZT||pt===$T,Ct=je.getClearColor(),yt=je.getClearAlpha(),gt=Ct.r,zt=Ct.g,ft=Ct.b;bt?(p[0]=gt,p[1]=zt,p[2]=ft,p[3]=yt,X.clearBufferuiv(X.COLOR,0,p)):(f[0]=gt,f[1]=zt,f[2]=ft,f[3]=yt,X.clearBufferiv(X.COLOR,0,f))}else Le|=X.COLOR_BUFFER_BIT}Ce&&(Le|=X.DEPTH_BUFFER_BIT),De&&(Le|=X.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),X.clear(Le)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){i.removeEventListener("webglcontextlost",fe,!1),i.removeEventListener("webglcontextrestored",Se,!1),i.removeEventListener("webglcontextcreationerror",Ne,!1),Te.dispose(),ze.dispose(),ke.dispose(),se.dispose(),Z.dispose(),re.dispose(),Ue.dispose(),dt.dispose(),he.dispose(),ae.dispose(),ae.removeEventListener("sessionstart",Ki),ae.removeEventListener("sessionend",Tn),Ps.stop()};function fe(ee){ee.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),_=!0}function Se(){console.log("THREE.WebGLRenderer: Context Restored."),_=!1;const ee=Ye.autoReset,Ce=ye.enabled,De=ye.autoUpdate,Le=ye.needsUpdate,Ee=ye.type;xe(),Ye.autoReset=ee,ye.enabled=Ce,ye.autoUpdate=De,ye.needsUpdate=Le,ye.type=Ee}function Ne(ee){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",ee.statusMessage)}function st(ee){const Ce=ee.target;Ce.removeEventListener("dispose",st),vt(Ce)}function vt(ee){Ut(ee),ke.remove(ee)}function Ut(ee){const Ce=ke.get(ee).programs;Ce!==void 0&&(Ce.forEach(function(De){he.releaseProgram(De)}),ee.isShaderMaterial&&he.releaseShaderCache(ee))}this.renderBufferDirect=function(ee,Ce,De,Le,Ee,pt){Ce===null&&(Ce=we);const bt=Ee.isMesh&&Ee.matrixWorld.determinant()<0,Ct=Ot(ee,Ce,De,Le,Ee);Pe.setMaterial(Le,bt);let yt=De.index,gt=1;if(Le.wireframe===!0){if(yt=k.getWireframeAttribute(De),yt===void 0)return;gt=2}const zt=De.drawRange,ft=De.attributes.position;let gi=zt.start*gt,Ii=(zt.start+zt.count)*gt;pt!==null&&(gi=Math.max(gi,pt.start*gt),Ii=Math.min(Ii,(pt.start+pt.count)*gt)),yt!==null?(gi=Math.max(gi,0),Ii=Math.min(Ii,yt.count)):ft!=null&&(gi=Math.max(gi,0),Ii=Math.min(Ii,ft.count));const Ei=Ii-gi;if(Ei<0||Ei===1/0)return;Ue.setup(Ee,Le,Ct,De,yt);let zi,H=ct;if(yt!==null&&(zi=K.get(yt),H=tt,H.setIndex(zi)),Ee.isMesh)Le.wireframe===!0?(Pe.setLineWidth(Le.wireframeLinewidth*Me()),H.setMode(X.LINES)):H.setMode(X.TRIANGLES);else if(Ee.isLine){let q=Le.linewidth;q===void 0&&(q=1),Pe.setLineWidth(q*Me()),Ee.isLineSegments?H.setMode(X.LINES):Ee.isLineLoop?H.setMode(X.LINE_LOOP):H.setMode(X.LINE_STRIP)}else Ee.isPoints?H.setMode(X.POINTS):Ee.isSprite&&H.setMode(X.TRIANGLES);if(Ee.isBatchedMesh)if(Ee._multiDrawInstances!==null)H.renderMultiDrawInstances(Ee._multiDrawStarts,Ee._multiDrawCounts,Ee._multiDrawCount,Ee._multiDrawInstances);else if(Oe.get("WEBGL_multi_draw"))H.renderMultiDraw(Ee._multiDrawStarts,Ee._multiDrawCounts,Ee._multiDrawCount);else{const q=Ee._multiDrawStarts,me=Ee._multiDrawCounts,te=Ee._multiDrawCount,Ae=yt?K.get(yt).bytesPerElement:1,ut=ke.get(Le).currentProgram.getUniforms();for(let Zi=0;Zi<te;Zi++)ut.setValue(X,"_gl_DrawID",Zi),H.render(q[Zi]/Ae,me[Zi])}else if(Ee.isInstancedMesh)H.renderInstances(gi,Ei,Ee.count);else if(De.isInstancedBufferGeometry){const q=De._maxInstanceCount!==void 0?De._maxInstanceCount:1/0,me=Math.min(De.instanceCount,q);H.renderInstances(gi,Ei,me)}else H.render(gi,Ei)};function Wt(ee,Ce,De){ee.transparent===!0&&ee.side===Dc&&ee.forceSinglePass===!1?(ee.side=va,ee.needsUpdate=!0,$e(ee,Ce,De),ee.side=gh,ee.needsUpdate=!0,$e(ee,Ce,De),ee.side=Dc):$e(ee,Ce,De)}this.compile=function(ee,Ce,De=null){De===null&&(De=ee),g=ze.get(De),g.init(Ce),x.push(g),De.traverseVisible(function(Ee){Ee.isLight&&Ee.layers.test(Ce.layers)&&(g.pushLight(Ee),Ee.castShadow&&g.pushShadow(Ee))}),ee!==De&&ee.traverseVisible(function(Ee){Ee.isLight&&Ee.layers.test(Ce.layers)&&(g.pushLight(Ee),Ee.castShadow&&g.pushShadow(Ee))}),g.setupLights();const Le=new Set;return ee.traverse(function(Ee){const pt=Ee.material;if(pt)if(Array.isArray(pt))for(let bt=0;bt<pt.length;bt++){const Ct=pt[bt];Wt(Ct,De,Ee),Le.add(Ct)}else Wt(pt,De,Ee),Le.add(pt)}),x.pop(),g=null,Le},this.compileAsync=function(ee,Ce,De=null){const Le=this.compile(ee,Ce,De);return new Promise(Ee=>{function pt(){if(Le.forEach(function(bt){ke.get(bt).currentProgram.isReady()&&Le.delete(bt)}),Le.size===0){Ee(ee);return}setTimeout(pt,10)}Oe.get("KHR_parallel_shader_compile")!==null?pt():setTimeout(pt,10)})};let Jt=null;function ci(ee){Jt&&Jt(ee)}function Ki(){Ps.stop()}function Tn(){Ps.start()}const Ps=new _ee;Ps.setAnimationLoop(ci),typeof self<"u"&&Ps.setContext(self),this.setAnimationLoop=function(ee){Jt=ee,ae.setAnimationLoop(ee),ee===null?Ps.stop():Ps.start()},ae.addEventListener("sessionstart",Ki),ae.addEventListener("sessionend",Tn),this.render=function(ee,Ce){if(Ce!==void 0&&Ce.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(_===!0)return;if(ee.matrixWorldAutoUpdate===!0&&ee.updateMatrixWorld(),Ce.parent===null&&Ce.matrixWorldAutoUpdate===!0&&Ce.updateMatrixWorld(),ae.enabled===!0&&ae.isPresenting===!0&&(ae.cameraAutoUpdate===!0&&ae.updateCamera(Ce),Ce=ae.getCamera()),ee.isScene===!0&&ee.onBeforeRender(w,ee,Ce,A),g=ze.get(ee,x.length),g.init(Ce),x.push(g),ie.multiplyMatrices(Ce.projectionMatrix,Ce.matrixWorldInverse),ce.setFromProjectionMatrix(ie),ne=this.localClippingEnabled,$=Qe.init(this.clippingPlanes,ne),v=Te.get(ee,m.length),v.init(),m.push(v),ae.enabled===!0&&ae.isPresenting===!0){const pt=w.xr.getDepthSensingMesh();pt!==null&&eu(pt,Ce,-1/0,w.sortObjects)}eu(ee,Ce,0,w.sortObjects),v.finish(),w.sortObjects===!0&&v.sort(O,j),_e=ae.enabled===!1||ae.isPresenting===!1||ae.hasDepthSensing()===!1,_e&&je.addToRenderList(v,ee),this.info.render.frame++,$===!0&&Qe.beginShadows();const De=g.state.shadowsArray;ye.render(De,ee,Ce),$===!0&&Qe.endShadows(),this.info.autoReset===!0&&this.info.reset();const Le=v.opaque,Ee=v.transmissive;if(g.setupLights(),Ce.isArrayCamera){const pt=Ce.cameras;if(Ee.length>0)for(let bt=0,Ct=pt.length;bt<Ct;bt++){const yt=pt[bt];bo(Le,Ee,ee,yt)}_e&&je.render(ee);for(let bt=0,Ct=pt.length;bt<Ct;bt++){const yt=pt[bt];tu(v,ee,yt,yt.viewport)}}else Ee.length>0&&bo(Le,Ee,ee,Ce),_e&&je.render(ee),tu(v,ee,Ce);A!==null&&(Fe.updateMultisampleRenderTarget(A),Fe.updateRenderTargetMipmap(A)),ee.isScene===!0&&ee.onAfterRender(w,ee,Ce),Ue.resetDefaultState(),T=-1,E=null,x.pop(),x.length>0?(g=x[x.length-1],$===!0&&Qe.setGlobalState(w.clippingPlanes,g.state.camera)):g=null,m.pop(),m.length>0?v=m[m.length-1]:v=null};function eu(ee,Ce,De,Le){if(ee.visible===!1)return;if(ee.layers.test(Ce.layers)){if(ee.isGroup)De=ee.renderOrder;else if(ee.isLOD)ee.autoUpdate===!0&&ee.update(Ce);else if(ee.isLight)g.pushLight(ee),ee.castShadow&&g.pushShadow(ee);else if(ee.isSprite){if(!ee.frustumCulled||ce.intersectsSprite(ee)){Le&&be.setFromMatrixPosition(ee.matrixWorld).applyMatrix4(ie);const bt=re.update(ee),Ct=ee.material;Ct.visible&&v.push(ee,bt,Ct,De,be.z,null)}}else if((ee.isMesh||ee.isLine||ee.isPoints)&&(!ee.frustumCulled||ce.intersectsObject(ee))){const bt=re.update(ee),Ct=ee.material;if(Le&&(ee.boundingSphere!==void 0?(ee.boundingSphere===null&&ee.computeBoundingSphere(),be.copy(ee.boundingSphere.center)):(bt.boundingSphere===null&&bt.computeBoundingSphere(),be.copy(bt.boundingSphere.center)),be.applyMatrix4(ee.matrixWorld).applyMatrix4(ie)),Array.isArray(Ct)){const yt=bt.groups;for(let gt=0,zt=yt.length;gt<zt;gt++){const ft=yt[gt],gi=Ct[ft.materialIndex];gi&&gi.visible&&v.push(ee,bt,gi,De,be.z,ft)}}else Ct.visible&&v.push(ee,bt,Ct,De,be.z,null)}}const pt=ee.children;for(let bt=0,Ct=pt.length;bt<Ct;bt++)eu(pt[bt],Ce,De,Le)}function tu(ee,Ce,De,Le){const Ee=ee.opaque,pt=ee.transmissive,bt=ee.transparent;g.setupLightsView(De),$===!0&&Qe.setGlobalState(w.clippingPlanes,De),Le&&Pe.viewport(C.copy(Le)),Ee.length>0&&le(Ee,Ce,De),pt.length>0&&le(pt,Ce,De),bt.length>0&&le(bt,Ce,De),Pe.buffers.depth.setTest(!0),Pe.buffers.depth.setMask(!0),Pe.buffers.color.setMask(!0),Pe.setPolygonOffset(!1)}function bo(ee,Ce,De,Le){if((De.isScene===!0?De.overrideMaterial:null)!==null)return;g.state.transmissionRenderTarget[Le.id]===void 0&&(g.state.transmissionRenderTarget[Le.id]=new Wl(1,1,{generateMipmaps:!0,type:Oe.has("EXT_color_buffer_half_float")||Oe.has("EXT_color_buffer_float")?U0:jl,minFilter:Lc,samples:4,stencilBuffer:s,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:Gi.workingColorSpace}));const pt=g.state.transmissionRenderTarget[Le.id],bt=Le.viewport||C;pt.setSize(bt.z,bt.w);const Ct=w.getRenderTarget();w.setRenderTarget(pt),w.getClearColor(L),z=w.getClearAlpha(),z<1&&w.setClearColor(16777215,.5),w.clear(),_e&&je.render(De);const yt=w.toneMapping;w.toneMapping=Hc;const gt=Le.viewport;if(Le.viewport!==void 0&&(Le.viewport=void 0),g.setupLightsView(Le),$===!0&&Qe.setGlobalState(w.clippingPlanes,Le),le(ee,De,Le),Fe.updateMultisampleRenderTarget(pt),Fe.updateRenderTargetMipmap(pt),Oe.has("WEBGL_multisampled_render_to_texture")===!1){let zt=!1;for(let ft=0,gi=Ce.length;ft<gi;ft++){const Ii=Ce[ft],Ei=Ii.object,zi=Ii.geometry,H=Ii.material,q=Ii.group;if(H.side===Dc&&Ei.layers.test(Le.layers)){const me=H.side;H.side=va,H.needsUpdate=!0,Ge(Ei,De,Le,zi,H,q),H.side=me,H.needsUpdate=!0,zt=!0}}zt===!0&&(Fe.updateMultisampleRenderTarget(pt),Fe.updateRenderTargetMipmap(pt))}w.setRenderTarget(Ct),w.setClearColor(L,z),gt!==void 0&&(Le.viewport=gt),w.toneMapping=yt}function le(ee,Ce,De){const Le=Ce.isScene===!0?Ce.overrideMaterial:null;for(let Ee=0,pt=ee.length;Ee<pt;Ee++){const bt=ee[Ee],Ct=bt.object,yt=bt.geometry,gt=Le===null?bt.material:Le,zt=bt.group;Ct.layers.test(De.layers)&&Ge(Ct,Ce,De,yt,gt,zt)}}function Ge(ee,Ce,De,Le,Ee,pt){ee.onBeforeRender(w,Ce,De,Le,Ee,pt),ee.modelViewMatrix.multiplyMatrices(De.matrixWorldInverse,ee.matrixWorld),ee.normalMatrix.getNormalMatrix(ee.modelViewMatrix),Ee.transparent===!0&&Ee.side===Dc&&Ee.forceSinglePass===!1?(Ee.side=va,Ee.needsUpdate=!0,w.renderBufferDirect(De,Ce,Le,Ee,ee,pt),Ee.side=gh,Ee.needsUpdate=!0,w.renderBufferDirect(De,Ce,Le,Ee,ee,pt),Ee.side=Dc):w.renderBufferDirect(De,Ce,Le,Ee,ee,pt),ee.onAfterRender(w,Ce,De,Le,Ee,pt)}function $e(ee,Ce,De){Ce.isScene!==!0&&(Ce=we);const Le=ke.get(ee),Ee=g.state.lights,pt=g.state.shadowsArray,bt=Ee.state.version,Ct=he.getParameters(ee,Ee.state,pt,Ce,De),yt=he.getProgramCacheKey(Ct);let gt=Le.programs;Le.environment=ee.isMeshStandardMaterial?Ce.environment:null,Le.fog=Ce.fog,Le.envMap=(ee.isMeshStandardMaterial?Z:se).get(ee.envMap||Le.environment),Le.envMapRotation=Le.environment!==null&&ee.envMap===null?Ce.environmentRotation:ee.envMapRotation,gt===void 0&&(ee.addEventListener("dispose",st),gt=new Map,Le.programs=gt);let zt=gt.get(yt);if(zt!==void 0){if(Le.currentProgram===zt&&Le.lightsStateVersion===bt)return et(ee,Ct),zt}else Ct.uniforms=he.getUniforms(ee),ee.onBeforeCompile(Ct,w),zt=he.acquireProgram(Ct,yt),gt.set(yt,zt),Le.uniforms=Ct.uniforms;const ft=Le.uniforms;return(!ee.isShaderMaterial&&!ee.isRawShaderMaterial||ee.clipping===!0)&&(ft.clippingPlanes=Qe.uniform),et(ee,Ct),Le.needsLights=oi(ee),Le.lightsStateVersion=bt,Le.needsLights&&(ft.ambientLightColor.value=Ee.state.ambient,ft.lightProbe.value=Ee.state.probe,ft.directionalLights.value=Ee.state.directional,ft.directionalLightShadows.value=Ee.state.directionalShadow,ft.spotLights.value=Ee.state.spot,ft.spotLightShadows.value=Ee.state.spotShadow,ft.rectAreaLights.value=Ee.state.rectArea,ft.ltc_1.value=Ee.state.rectAreaLTC1,ft.ltc_2.value=Ee.state.rectAreaLTC2,ft.pointLights.value=Ee.state.point,ft.pointLightShadows.value=Ee.state.pointShadow,ft.hemisphereLights.value=Ee.state.hemi,ft.directionalShadowMap.value=Ee.state.directionalShadowMap,ft.directionalShadowMatrix.value=Ee.state.directionalShadowMatrix,ft.spotShadowMap.value=Ee.state.spotShadowMap,ft.spotLightMatrix.value=Ee.state.spotLightMatrix,ft.spotLightMap.value=Ee.state.spotLightMap,ft.pointShadowMap.value=Ee.state.pointShadowMap,ft.pointShadowMatrix.value=Ee.state.pointShadowMatrix),Le.currentProgram=zt,Le.uniformsList=null,zt}function Ve(ee){if(ee.uniformsList===null){const Ce=ee.currentProgram.getUniforms();ee.uniformsList=DE.seqWithValue(Ce.seq,ee.uniforms)}return ee.uniformsList}function et(ee,Ce){const De=ke.get(ee);De.outputColorSpace=Ce.outputColorSpace,De.batching=Ce.batching,De.batchingColor=Ce.batchingColor,De.instancing=Ce.instancing,De.instancingColor=Ce.instancingColor,De.instancingMorph=Ce.instancingMorph,De.skinning=Ce.skinning,De.morphTargets=Ce.morphTargets,De.morphNormals=Ce.morphNormals,De.morphColors=Ce.morphColors,De.morphTargetsCount=Ce.morphTargetsCount,De.numClippingPlanes=Ce.numClippingPlanes,De.numIntersection=Ce.numClipIntersection,De.vertexAlphas=Ce.vertexAlphas,De.vertexTangents=Ce.vertexTangents,De.toneMapping=Ce.toneMapping}function Ot(ee,Ce,De,Le,Ee){Ce.isScene!==!0&&(Ce=we),Fe.resetTextureUnits();const pt=Ce.fog,bt=Le.isMeshStandardMaterial?Ce.environment:null,Ct=A===null?w.outputColorSpace:A.isXRRenderTarget===!0?A.texture.colorSpace:Ah,yt=(Le.isMeshStandardMaterial?Z:se).get(Le.envMap||bt),gt=Le.vertexColors===!0&&!!De.attributes.color&&De.attributes.color.itemSize===4,zt=!!De.attributes.tangent&&(!!Le.normalMap||Le.anisotropy>0),ft=!!De.morphAttributes.position,gi=!!De.morphAttributes.normal,Ii=!!De.morphAttributes.color;let Ei=Hc;Le.toneMapped&&(A===null||A.isXRRenderTarget===!0)&&(Ei=w.toneMapping);const zi=De.morphAttributes.position||De.morphAttributes.normal||De.morphAttributes.color,H=zi!==void 0?zi.length:0,q=ke.get(Le),me=g.state.lights;if($===!0&&(ne===!0||ee!==E)){const Jr=ee===E&&Le.id===T;Qe.setState(Le,ee,Jr)}let te=!1;Le.version===q.__version?(q.needsLights&&q.lightsStateVersion!==me.state.version||q.outputColorSpace!==Ct||Ee.isBatchedMesh&&q.batching===!1||!Ee.isBatchedMesh&&q.batching===!0||Ee.isBatchedMesh&&q.batchingColor===!0&&Ee.colorTexture===null||Ee.isBatchedMesh&&q.batchingColor===!1&&Ee.colorTexture!==null||Ee.isInstancedMesh&&q.instancing===!1||!Ee.isInstancedMesh&&q.instancing===!0||Ee.isSkinnedMesh&&q.skinning===!1||!Ee.isSkinnedMesh&&q.skinning===!0||Ee.isInstancedMesh&&q.instancingColor===!0&&Ee.instanceColor===null||Ee.isInstancedMesh&&q.instancingColor===!1&&Ee.instanceColor!==null||Ee.isInstancedMesh&&q.instancingMorph===!0&&Ee.morphTexture===null||Ee.isInstancedMesh&&q.instancingMorph===!1&&Ee.morphTexture!==null||q.envMap!==yt||Le.fog===!0&&q.fog!==pt||q.numClippingPlanes!==void 0&&(q.numClippingPlanes!==Qe.numPlanes||q.numIntersection!==Qe.numIntersection)||q.vertexAlphas!==gt||q.vertexTangents!==zt||q.morphTargets!==ft||q.morphNormals!==gi||q.morphColors!==Ii||q.toneMapping!==Ei||q.morphTargetsCount!==H)&&(te=!0):(te=!0,q.__version=Le.version);let Ae=q.currentProgram;te===!0&&(Ae=$e(Le,Ce,Ee));let ut=!1,Zi=!1,Fr=!1;const $i=Ae.getUniforms(),ea=q.uniforms;if(Pe.useProgram(Ae.program)&&(ut=!0,Zi=!0,Fr=!0),Le.id!==T&&(T=Le.id,Zi=!0),ut||E!==ee){$i.setValue(X,"projectionMatrix",ee.projectionMatrix),$i.setValue(X,"viewMatrix",ee.matrixWorldInverse);const Jr=$i.map.cameraPosition;Jr!==void 0&&Jr.setValue(X,de.setFromMatrixPosition(ee.matrixWorld)),Ie.logarithmicDepthBuffer&&$i.setValue(X,"logDepthBufFC",2/(Math.log(ee.far+1)/Math.LN2)),(Le.isMeshPhongMaterial||Le.isMeshToonMaterial||Le.isMeshLambertMaterial||Le.isMeshBasicMaterial||Le.isMeshStandardMaterial||Le.isShaderMaterial)&&$i.setValue(X,"isOrthographic",ee.isOrthographicCamera===!0),E!==ee&&(E=ee,Zi=!0,Fr=!0)}if(Ee.isSkinnedMesh){$i.setOptional(X,Ee,"bindMatrix"),$i.setOptional(X,Ee,"bindMatrixInverse");const Jr=Ee.skeleton;Jr&&(Jr.boneTexture===null&&Jr.computeBoneTexture(),$i.setValue(X,"boneTexture",Jr.boneTexture,Fe))}Ee.isBatchedMesh&&($i.setOptional(X,Ee,"batchingTexture"),$i.setValue(X,"batchingTexture",Ee._matricesTexture,Fe),$i.setOptional(X,Ee,"batchingIdTexture"),$i.setValue(X,"batchingIdTexture",Ee._indirectTexture,Fe),$i.setOptional(X,Ee,"batchingColorTexture"),Ee._colorsTexture!==null&&$i.setValue(X,"batchingColorTexture",Ee._colorsTexture,Fe));const ol=De.morphAttributes;if((ol.position!==void 0||ol.normal!==void 0||ol.color!==void 0)&&nt.update(Ee,De,Ae),(Zi||q.receiveShadow!==Ee.receiveShadow)&&(q.receiveShadow=Ee.receiveShadow,$i.setValue(X,"receiveShadow",Ee.receiveShadow)),Le.isMeshGouraudMaterial&&Le.envMap!==null&&(ea.envMap.value=yt,ea.flipEnvMap.value=yt.isCubeTexture&&yt.isRenderTargetTexture===!1?-1:1),Le.isMeshStandardMaterial&&Le.envMap===null&&Ce.environment!==null&&(ea.envMapIntensity.value=Ce.environmentIntensity),Zi&&($i.setValue(X,"toneMappingExposure",w.toneMappingExposure),q.needsLights&&ri(ea,Fr),pt&&Le.fog===!0&&G.refreshFogUniforms(ea,pt),G.refreshMaterialUniforms(ea,Le,Y,Q,g.state.transmissionRenderTarget[ee.id]),DE.upload(X,Ve(q),ea,Fe)),Le.isShaderMaterial&&Le.uniformsNeedUpdate===!0&&(DE.upload(X,Ve(q),ea,Fe),Le.uniformsNeedUpdate=!1),Le.isSpriteMaterial&&$i.setValue(X,"center",Ee.center),$i.setValue(X,"modelViewMatrix",Ee.modelViewMatrix),$i.setValue(X,"normalMatrix",Ee.normalMatrix),$i.setValue(X,"modelMatrix",Ee.matrixWorld),Le.isShaderMaterial||Le.isRawShaderMaterial){const Jr=Le.uniformsGroups;for(let pm=0,Qa=Jr.length;pm<Qa;pm++){const pb=Jr[pm];dt.update(pb,Ae),dt.bind(pb,Ae)}}return Ae}function ri(ee,Ce){ee.ambientLightColor.needsUpdate=Ce,ee.lightProbe.needsUpdate=Ce,ee.directionalLights.needsUpdate=Ce,ee.directionalLightShadows.needsUpdate=Ce,ee.pointLights.needsUpdate=Ce,ee.pointLightShadows.needsUpdate=Ce,ee.spotLights.needsUpdate=Ce,ee.spotLightShadows.needsUpdate=Ce,ee.rectAreaLights.needsUpdate=Ce,ee.hemisphereLights.needsUpdate=Ce}function oi(ee){return ee.isMeshLambertMaterial||ee.isMeshToonMaterial||ee.isMeshPhongMaterial||ee.isMeshStandardMaterial||ee.isShadowMaterial||ee.isShaderMaterial&&ee.lights===!0}this.getActiveCubeFace=function(){return M},this.getActiveMipmapLevel=function(){return S},this.getRenderTarget=function(){return A},this.setRenderTargetTextures=function(ee,Ce,De){ke.get(ee.texture).__webglTexture=Ce,ke.get(ee.depthTexture).__webglTexture=De;const Le=ke.get(ee);Le.__hasExternalTextures=!0,Le.__autoAllocateDepthBuffer=De===void 0,Le.__autoAllocateDepthBuffer||Oe.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Le.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(ee,Ce){const De=ke.get(ee);De.__webglFramebuffer=Ce,De.__useDefaultFramebuffer=Ce===void 0},this.setRenderTarget=function(ee,Ce=0,De=0){A=ee,M=Ce,S=De;let Le=!0,Ee=null,pt=!1,bt=!1;if(ee){const yt=ke.get(ee);yt.__useDefaultFramebuffer!==void 0?(Pe.bindFramebuffer(X.FRAMEBUFFER,null),Le=!1):yt.__webglFramebuffer===void 0?Fe.setupRenderTarget(ee):yt.__hasExternalTextures&&Fe.rebindTextures(ee,ke.get(ee.texture).__webglTexture,ke.get(ee.depthTexture).__webglTexture);const gt=ee.texture;(gt.isData3DTexture||gt.isDataArrayTexture||gt.isCompressedArrayTexture)&&(bt=!0);const zt=ke.get(ee).__webglFramebuffer;ee.isWebGLCubeRenderTarget?(Array.isArray(zt[Ce])?Ee=zt[Ce][De]:Ee=zt[Ce],pt=!0):ee.samples>0&&Fe.useMultisampledRTT(ee)===!1?Ee=ke.get(ee).__webglMultisampledFramebuffer:Array.isArray(zt)?Ee=zt[De]:Ee=zt,C.copy(ee.viewport),D.copy(ee.scissor),I=ee.scissorTest}else C.copy(V).multiplyScalar(Y).floor(),D.copy(W).multiplyScalar(Y).floor(),I=J;if(Pe.bindFramebuffer(X.FRAMEBUFFER,Ee)&&Le&&Pe.drawBuffers(ee,Ee),Pe.viewport(C),Pe.scissor(D),Pe.setScissorTest(I),pt){const yt=ke.get(ee.texture);X.framebufferTexture2D(X.FRAMEBUFFER,X.COLOR_ATTACHMENT0,X.TEXTURE_CUBE_MAP_POSITIVE_X+Ce,yt.__webglTexture,De)}else if(bt){const yt=ke.get(ee.texture),gt=Ce||0;X.framebufferTextureLayer(X.FRAMEBUFFER,X.COLOR_ATTACHMENT0,yt.__webglTexture,De||0,gt)}T=-1},this.readRenderTargetPixels=function(ee,Ce,De,Le,Ee,pt,bt){if(!(ee&&ee.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Ct=ke.get(ee).__webglFramebuffer;if(ee.isWebGLCubeRenderTarget&&bt!==void 0&&(Ct=Ct[bt]),Ct){Pe.bindFramebuffer(X.FRAMEBUFFER,Ct);try{const yt=ee.texture,gt=yt.format,zt=yt.type;if(!Ie.textureFormatReadable(gt)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!Ie.textureTypeReadable(zt)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}Ce>=0&&Ce<=ee.width-Le&&De>=0&&De<=ee.height-Ee&&X.readPixels(Ce,De,Le,Ee,ue.convert(gt),ue.convert(zt),pt)}finally{const yt=A!==null?ke.get(A).__webglFramebuffer:null;Pe.bindFramebuffer(X.FRAMEBUFFER,yt)}}},this.readRenderTargetPixelsAsync=async function(ee,Ce,De,Le,Ee,pt,bt){if(!(ee&&ee.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Ct=ke.get(ee).__webglFramebuffer;if(ee.isWebGLCubeRenderTarget&&bt!==void 0&&(Ct=Ct[bt]),Ct){Pe.bindFramebuffer(X.FRAMEBUFFER,Ct);try{const yt=ee.texture,gt=yt.format,zt=yt.type;if(!Ie.textureFormatReadable(gt))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!Ie.textureTypeReadable(zt))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(Ce>=0&&Ce<=ee.width-Le&&De>=0&&De<=ee.height-Ee){const ft=X.createBuffer();X.bindBuffer(X.PIXEL_PACK_BUFFER,ft),X.bufferData(X.PIXEL_PACK_BUFFER,pt.byteLength,X.STREAM_READ),X.readPixels(Ce,De,Le,Ee,ue.convert(gt),ue.convert(zt),0),X.flush();const gi=X.fenceSync(X.SYNC_GPU_COMMANDS_COMPLETE,0);await RLe(X,gi,4);try{X.bindBuffer(X.PIXEL_PACK_BUFFER,ft),X.getBufferSubData(X.PIXEL_PACK_BUFFER,0,pt)}finally{X.deleteBuffer(ft),X.deleteSync(gi)}return pt}}finally{const yt=A!==null?ke.get(A).__webglFramebuffer:null;Pe.bindFramebuffer(X.FRAMEBUFFER,yt)}}},this.copyFramebufferToTexture=function(ee,Ce=null,De=0){ee.isTexture!==!0&&(Ov("WebGLRenderer: copyFramebufferToTexture function signature has changed."),Ce=arguments[0]||null,ee=arguments[1]);const Le=Math.pow(2,-De),Ee=Math.floor(ee.image.width*Le),pt=Math.floor(ee.image.height*Le),bt=Ce!==null?Ce.x:0,Ct=Ce!==null?Ce.y:0;Fe.setTexture2D(ee,0),X.copyTexSubImage2D(X.TEXTURE_2D,De,0,0,bt,Ct,Ee,pt),Pe.unbindTexture()},this.copyTextureToTexture=function(ee,Ce,De=null,Le=null,Ee=0){ee.isTexture!==!0&&(Ov("WebGLRenderer: copyTextureToTexture function signature has changed."),Le=arguments[0]||null,ee=arguments[1],Ce=arguments[2],Ee=arguments[3]||0,De=null);let pt,bt,Ct,yt,gt,zt;De!==null?(pt=De.max.x-De.min.x,bt=De.max.y-De.min.y,Ct=De.min.x,yt=De.min.y):(pt=ee.image.width,bt=ee.image.height,Ct=0,yt=0),Le!==null?(gt=Le.x,zt=Le.y):(gt=0,zt=0);const ft=ue.convert(Ce.format),gi=ue.convert(Ce.type);Fe.setTexture2D(Ce,0),X.pixelStorei(X.UNPACK_FLIP_Y_WEBGL,Ce.flipY),X.pixelStorei(X.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Ce.premultiplyAlpha),X.pixelStorei(X.UNPACK_ALIGNMENT,Ce.unpackAlignment);const Ii=X.getParameter(X.UNPACK_ROW_LENGTH),Ei=X.getParameter(X.UNPACK_IMAGE_HEIGHT),zi=X.getParameter(X.UNPACK_SKIP_PIXELS),H=X.getParameter(X.UNPACK_SKIP_ROWS),q=X.getParameter(X.UNPACK_SKIP_IMAGES),me=ee.isCompressedTexture?ee.mipmaps[Ee]:ee.image;X.pixelStorei(X.UNPACK_ROW_LENGTH,me.width),X.pixelStorei(X.UNPACK_IMAGE_HEIGHT,me.height),X.pixelStorei(X.UNPACK_SKIP_PIXELS,Ct),X.pixelStorei(X.UNPACK_SKIP_ROWS,yt),ee.isDataTexture?X.texSubImage2D(X.TEXTURE_2D,Ee,gt,zt,pt,bt,ft,gi,me.data):ee.isCompressedTexture?X.compressedTexSubImage2D(X.TEXTURE_2D,Ee,gt,zt,me.width,me.height,ft,me.data):X.texSubImage2D(X.TEXTURE_2D,Ee,gt,zt,pt,bt,ft,gi,me),X.pixelStorei(X.UNPACK_ROW_LENGTH,Ii),X.pixelStorei(X.UNPACK_IMAGE_HEIGHT,Ei),X.pixelStorei(X.UNPACK_SKIP_PIXELS,zi),X.pixelStorei(X.UNPACK_SKIP_ROWS,H),X.pixelStorei(X.UNPACK_SKIP_IMAGES,q),Ee===0&&Ce.generateMipmaps&&X.generateMipmap(X.TEXTURE_2D),Pe.unbindTexture()},this.copyTextureToTexture3D=function(ee,Ce,De=null,Le=null,Ee=0){ee.isTexture!==!0&&(Ov("WebGLRenderer: copyTextureToTexture3D function signature has changed."),De=arguments[0]||null,Le=arguments[1]||null,ee=arguments[2],Ce=arguments[3],Ee=arguments[4]||0);let pt,bt,Ct,yt,gt,zt,ft,gi,Ii;const Ei=ee.isCompressedTexture?ee.mipmaps[Ee]:ee.image;De!==null?(pt=De.max.x-De.min.x,bt=De.max.y-De.min.y,Ct=De.max.z-De.min.z,yt=De.min.x,gt=De.min.y,zt=De.min.z):(pt=Ei.width,bt=Ei.height,Ct=Ei.depth,yt=0,gt=0,zt=0),Le!==null?(ft=Le.x,gi=Le.y,Ii=Le.z):(ft=0,gi=0,Ii=0);const zi=ue.convert(Ce.format),H=ue.convert(Ce.type);let q;if(Ce.isData3DTexture)Fe.setTexture3D(Ce,0),q=X.TEXTURE_3D;else if(Ce.isDataArrayTexture||Ce.isCompressedArrayTexture)Fe.setTexture2DArray(Ce,0),q=X.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}X.pixelStorei(X.UNPACK_FLIP_Y_WEBGL,Ce.flipY),X.pixelStorei(X.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Ce.premultiplyAlpha),X.pixelStorei(X.UNPACK_ALIGNMENT,Ce.unpackAlignment);const me=X.getParameter(X.UNPACK_ROW_LENGTH),te=X.getParameter(X.UNPACK_IMAGE_HEIGHT),Ae=X.getParameter(X.UNPACK_SKIP_PIXELS),ut=X.getParameter(X.UNPACK_SKIP_ROWS),Zi=X.getParameter(X.UNPACK_SKIP_IMAGES);X.pixelStorei(X.UNPACK_ROW_LENGTH,Ei.width),X.pixelStorei(X.UNPACK_IMAGE_HEIGHT,Ei.height),X.pixelStorei(X.UNPACK_SKIP_PIXELS,yt),X.pixelStorei(X.UNPACK_SKIP_ROWS,gt),X.pixelStorei(X.UNPACK_SKIP_IMAGES,zt),ee.isDataTexture||ee.isData3DTexture?X.texSubImage3D(q,Ee,ft,gi,Ii,pt,bt,Ct,zi,H,Ei.data):Ce.isCompressedArrayTexture?X.compressedTexSubImage3D(q,Ee,ft,gi,Ii,pt,bt,Ct,zi,Ei.data):X.texSubImage3D(q,Ee,ft,gi,Ii,pt,bt,Ct,zi,H,Ei),X.pixelStorei(X.UNPACK_ROW_LENGTH,me),X.pixelStorei(X.UNPACK_IMAGE_HEIGHT,te),X.pixelStorei(X.UNPACK_SKIP_PIXELS,Ae),X.pixelStorei(X.UNPACK_SKIP_ROWS,ut),X.pixelStorei(X.UNPACK_SKIP_IMAGES,Zi),Ee===0&&Ce.generateMipmaps&&X.generateMipmap(q),Pe.unbindTexture()},this.initRenderTarget=function(ee){ke.get(ee).__webglFramebuffer===void 0&&Fe.setupRenderTarget(ee)},this.initTexture=function(ee){ee.isCubeTexture?Fe.setTextureCube(ee,0):ee.isData3DTexture?Fe.setTexture3D(ee,0):ee.isDataArrayTexture||ee.isCompressedArrayTexture?Fe.setTexture2DArray(ee,0):Fe.setTexture2D(ee,0),Pe.unbindTexture()},this.resetState=function(){M=0,S=0,A=null,Pe.reset(),Ue.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Oc}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(t){this._outputColorSpace=t;const i=this.getContext();i.drawingBufferColorSpace=t===r2?"display-p3":"srgb",i.unpackColorSpace=Gi.workingColorSpace===$w?"display-p3":"srgb"}}class a2{constructor(t,i=25e-5){this.isFogExp2=!0,this.name="",this.color=new Rt(t),this.density=i}clone(){return new a2(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class o2{constructor(t,i=1,r=1e3){this.isFog=!0,this.name="",this.color=new Rt(t),this.near=i,this.far=r}clone(){return new o2(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class XC extends ki{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new yo,this.environmentIntensity=1,this.environmentRotation=new yo,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,i){return super.copy(t,i),t.background!==null&&(this.background=t.background.clone()),t.environment!==null&&(this.environment=t.environment.clone()),t.fog!==null&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,this.backgroundRotation.copy(t.backgroundRotation),this.environmentIntensity=t.environmentIntensity,this.environmentRotation.copy(t.environmentRotation),t.overrideMaterial!==null&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const i=super.toJSON(t);return this.fog!==null&&(i.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(i.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(i.object.backgroundIntensity=this.backgroundIntensity),i.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(i.object.environmentIntensity=this.environmentIntensity),i.object.environmentRotation=this.environmentRotation.toArray(),i}}class l2{constructor(t,i){this.isInterleavedBuffer=!0,this.array=t,this.stride=i,this.count=t!==void 0?t.length/i:0,this.usage=uw,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.version=0,this.uuid=po()}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}get updateRange(){return Ov("THREE.InterleavedBuffer: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(t){return this.usage=t,this}addUpdateRange(t,i){this.updateRanges.push({start:t,count:i})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,i,r){t*=this.stride,r*=i.stride;for(let n=0,s=this.stride;n<s;n++)this.array[t+n]=i.array[r+n];return this}set(t,i=0){return this.array.set(t,i),this}clone(t){t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=po()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const i=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),r=new this.constructor(i,this.stride);return r.setUsage(this.usage),r}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=po()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const oa=new oe;class Kf{constructor(t,i,r,n=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=i,this.offset=r,this.normalized=n}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let i=0,r=this.data.count;i<r;i++)oa.fromBufferAttribute(this,i),oa.applyMatrix4(t),this.setXYZ(i,oa.x,oa.y,oa.z);return this}applyNormalMatrix(t){for(let i=0,r=this.count;i<r;i++)oa.fromBufferAttribute(this,i),oa.applyNormalMatrix(t),this.setXYZ(i,oa.x,oa.y,oa.z);return this}transformDirection(t){for(let i=0,r=this.count;i<r;i++)oa.fromBufferAttribute(this,i),oa.transformDirection(t),this.setXYZ(i,oa.x,oa.y,oa.z);return this}getComponent(t,i){let r=this.array[t*this.data.stride+this.offset+i];return this.normalized&&(r=fa(r,this.array)),r}setComponent(t,i,r){return this.normalized&&(r=yi(r,this.array)),this.data.array[t*this.data.stride+this.offset+i]=r,this}setX(t,i){return this.normalized&&(i=yi(i,this.array)),this.data.array[t*this.data.stride+this.offset]=i,this}setY(t,i){return this.normalized&&(i=yi(i,this.array)),this.data.array[t*this.data.stride+this.offset+1]=i,this}setZ(t,i){return this.normalized&&(i=yi(i,this.array)),this.data.array[t*this.data.stride+this.offset+2]=i,this}setW(t,i){return this.normalized&&(i=yi(i,this.array)),this.data.array[t*this.data.stride+this.offset+3]=i,this}getX(t){let i=this.data.array[t*this.data.stride+this.offset];return this.normalized&&(i=fa(i,this.array)),i}getY(t){let i=this.data.array[t*this.data.stride+this.offset+1];return this.normalized&&(i=fa(i,this.array)),i}getZ(t){let i=this.data.array[t*this.data.stride+this.offset+2];return this.normalized&&(i=fa(i,this.array)),i}getW(t){let i=this.data.array[t*this.data.stride+this.offset+3];return this.normalized&&(i=fa(i,this.array)),i}setXY(t,i,r){return t=t*this.data.stride+this.offset,this.normalized&&(i=yi(i,this.array),r=yi(r,this.array)),this.data.array[t+0]=i,this.data.array[t+1]=r,this}setXYZ(t,i,r,n){return t=t*this.data.stride+this.offset,this.normalized&&(i=yi(i,this.array),r=yi(r,this.array),n=yi(n,this.array)),this.data.array[t+0]=i,this.data.array[t+1]=r,this.data.array[t+2]=n,this}setXYZW(t,i,r,n,s){return t=t*this.data.stride+this.offset,this.normalized&&(i=yi(i,this.array),r=yi(r,this.array),n=yi(n,this.array),s=yi(s,this.array)),this.data.array[t+0]=i,this.data.array[t+1]=r,this.data.array[t+2]=n,this.data.array[t+3]=s,this}clone(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const i=[];for(let r=0;r<this.count;r++){const n=r*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)i.push(this.data.array[n+s])}return new dr(new this.array.constructor(i),this.itemSize,this.normalized)}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new Kf(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const i=[];for(let r=0;r<this.count;r++){const n=r*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)i.push(this.data.array[n+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:i,normalized:this.normalized}}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class pU extends Ts{constructor(t){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Rt(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}let wg;const ex=new oe,bg=new oe,_g=new oe,Sg=new ot,tx=new ot,Dee=new ii,pM=new oe,ix=new oe,fM=new oe,k8=new ot,$R=new ot,U8=new ot;class Ree extends ki{constructor(t=new pU){if(super(),this.isSprite=!0,this.type="Sprite",wg===void 0){wg=new wi;const i=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),r=new l2(i,5);wg.setIndex([0,1,2,0,2,3]),wg.setAttribute("position",new Kf(r,3,0,!1)),wg.setAttribute("uv",new Kf(r,2,3,!1))}this.geometry=wg,this.material=t,this.center=new ot(.5,.5)}raycast(t,i){t.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),bg.setFromMatrixScale(this.matrixWorld),Dee.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),_g.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&bg.multiplyScalar(-_g.z);const r=this.material.rotation;let n,s;r!==0&&(s=Math.cos(r),n=Math.sin(r));const a=this.center;mM(pM.set(-.5,-.5,0),_g,a,bg,n,s),mM(ix.set(.5,-.5,0),_g,a,bg,n,s),mM(fM.set(.5,.5,0),_g,a,bg,n,s),k8.set(0,0),$R.set(1,0),U8.set(1,1);let o=t.ray.intersectTriangle(pM,ix,fM,!1,ex);if(o===null&&(mM(ix.set(-.5,.5,0),_g,a,bg,n,s),$R.set(0,1),o=t.ray.intersectTriangle(pM,fM,ix,!1,ex),o===null))return;const l=t.ray.origin.distanceTo(ex);l<t.near||l>t.far||i.push({distance:l,point:ex.clone(),uv:oo.getInterpolation(ex,pM,ix,fM,k8,$R,U8,new ot),face:null,object:this})}copy(t,i){return super.copy(t,i),t.center!==void 0&&this.center.copy(t.center),this.material=t.material,this}}function mM(e,t,i,r,n,s){Sg.subVectors(e,i).addScalar(.5).multiply(r),n!==void 0?(tx.x=s*Sg.x-n*Sg.y,tx.y=n*Sg.x+s*Sg.y):tx.copy(Sg),e.copy(t),e.x+=tx.x,e.y+=tx.y,e.applyMatrix4(Dee)}const gM=new oe,F8=new oe;class Iee extends ki{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(t){super.copy(t,!1);const i=t.levels;for(let r=0,n=i.length;r<n;r++){const s=i[r];this.addLevel(s.object.clone(),s.distance,s.hysteresis)}return this.autoUpdate=t.autoUpdate,this}addLevel(t,i=0,r=0){i=Math.abs(i);const n=this.levels;let s;for(s=0;s<n.length&&!(i<n[s].distance);s++);return n.splice(s,0,{distance:i,hysteresis:r,object:t}),this.add(t),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(t){const i=this.levels;if(i.length>0){let r,n;for(r=1,n=i.length;r<n;r++){let s=i[r].distance;if(i[r].object.visible&&(s-=s*i[r].hysteresis),t<s)break}return i[r-1].object}return null}raycast(t,i){if(this.levels.length>0){gM.setFromMatrixPosition(this.matrixWorld);const n=t.ray.origin.distanceTo(gM);this.getObjectForDistance(n).raycast(t,i)}}update(t){const i=this.levels;if(i.length>1){gM.setFromMatrixPosition(t.matrixWorld),F8.setFromMatrixPosition(this.matrixWorld);const r=gM.distanceTo(F8)/t.zoom;i[0].object.visible=!0;let n,s;for(n=1,s=i.length;n<s;n++){let a=i[n].distance;if(i[n].object.visible&&(a-=a*i[n].hysteresis),r>=a)i[n-1].object.visible=!1,i[n].object.visible=!0;else break}for(this._currentLevel=n-1;n<s;n++)i[n].object.visible=!1}}toJSON(t){const i=super.toJSON(t);this.autoUpdate===!1&&(i.object.autoUpdate=!1),i.object.levels=[];const r=this.levels;for(let n=0,s=r.length;n<s;n++){const a=r[n];i.object.levels.push({object:a.object.uuid,distance:a.distance,hysteresis:a.hysteresis})}return i}}const V8=new oe,H8=new tr,G8=new tr,jke=new oe,j8=new ii,vM=new oe,JR=new Zs,W8=new ii,eI=new om;class Lee extends En{constructor(t,i){super(t,i),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=Oz,this.bindMatrix=new ii,this.bindMatrixInverse=new ii,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const t=this.geometry;this.boundingBox===null&&(this.boundingBox=new ya),this.boundingBox.makeEmpty();const i=t.getAttribute("position");for(let r=0;r<i.count;r++)this.getVertexPosition(r,vM),this.boundingBox.expandByPoint(vM)}computeBoundingSphere(){const t=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Zs),this.boundingSphere.makeEmpty();const i=t.getAttribute("position");for(let r=0;r<i.count;r++)this.getVertexPosition(r,vM),this.boundingSphere.expandByPoint(vM)}copy(t,i){return super.copy(t,i),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone()),t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),this}raycast(t,i){const r=this.material,n=this.matrixWorld;r!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),JR.copy(this.boundingSphere),JR.applyMatrix4(n),t.ray.intersectsSphere(JR)!==!1&&(W8.copy(n).invert(),eI.copy(t.ray).applyMatrix4(W8),!(this.boundingBox!==null&&eI.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(t,i,eI)))}getVertexPosition(t,i){return super.getVertexPosition(t,i),this.applyBoneTransform(t,i),i}bind(t,i){this.skeleton=t,i===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),i=this.matrixWorld),this.bindMatrix.copy(i),this.bindMatrixInverse.copy(i).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new tr,i=this.geometry.attributes.skinWeight;for(let r=0,n=i.count;r<n;r++){t.fromBufferAttribute(i,r);const s=1/t.manhattanLength();s!==1/0?t.multiplyScalar(s):t.set(1,0,0,0),i.setXYZW(r,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),this.bindMode===Oz?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===JJ?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(t,i){const r=this.skeleton,n=this.geometry;H8.fromBufferAttribute(n.attributes.skinIndex,t),G8.fromBufferAttribute(n.attributes.skinWeight,t),V8.copy(i).applyMatrix4(this.bindMatrix),i.set(0,0,0);for(let s=0;s<4;s++){const a=G8.getComponent(s);if(a!==0){const o=H8.getComponent(s);j8.multiplyMatrices(r.bones[o].matrixWorld,r.boneInverses[o]),i.addScaledVector(jke.copy(V8).applyMatrix4(j8),a)}}return i.applyMatrix4(this.bindMatrixInverse)}}class fU extends ki{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Gc extends kr{constructor(t=null,i=1,r=1,n,s,a,o,l,c=os,u=os,h,d){super(null,a,o,l,c,u,n,s,h,d),this.isDataTexture=!0,this.image={data:t,width:i,height:r},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const X8=new ii,Wke=new ii;class c2{constructor(t=[],i=[]){this.uuid=po(),this.bones=t.slice(0),this.boneInverses=i,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const t=this.bones,i=this.boneInverses;if(this.boneMatrices=new Float32Array(t.length*16),i.length===0)this.calculateInverses();else if(t.length!==i.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let r=0,n=this.bones.length;r<n;r++)this.boneInverses.push(new ii)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,i=this.bones.length;t<i;t++){const r=new ii;this.bones[t]&&r.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(r)}}pose(){for(let t=0,i=this.bones.length;t<i;t++){const r=this.bones[t];r&&r.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,i=this.bones.length;t<i;t++){const r=this.bones[t];r&&(r.parent&&r.parent.isBone?(r.matrix.copy(r.parent.matrixWorld).invert(),r.matrix.multiply(r.matrixWorld)):r.matrix.copy(r.matrixWorld),r.matrix.decompose(r.position,r.quaternion,r.scale))}}update(){const t=this.bones,i=this.boneInverses,r=this.boneMatrices,n=this.boneTexture;for(let s=0,a=t.length;s<a;s++){const o=t[s]?t[s].matrixWorld:Wke;X8.multiplyMatrices(o,i[s]),X8.toArray(r,s*16)}n!==null&&(n.needsUpdate=!0)}clone(){return new c2(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(this.bones.length*4);t=Math.ceil(t/4)*4,t=Math.max(t,4);const i=new Float32Array(t*t*4);i.set(this.boneMatrices);const r=new Gc(i,t,t,Ys,Ua);return r.needsUpdate=!0,this.boneMatrices=i,this.boneTexture=r,this}getBoneByName(t){for(let i=0,r=this.bones.length;i<r;i++){const n=this.bones[i];if(n.name===t)return n}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,i){this.uuid=t.uuid;for(let r=0,n=t.bones.length;r<n;r++){const s=t.bones[r];let a=i[s];a===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",s),a=new fU),this.bones.push(a),this.boneInverses.push(new ii().fromArray(t.boneInverses[r]))}return this.init(),this}toJSON(){const t={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;const i=this.bones,r=this.boneInverses;for(let n=0,s=i.length;n<s;n++){const a=i[n];t.bones.push(a.uuid);const o=r[n];t.boneInverses.push(o.toArray())}return t}}class c0 extends dr{constructor(t,i,r,n=1){super(t,i,r),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=n}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}const Mg=new ii,q8=new ii,yM=[],Y8=new ya,Xke=new ii,rx=new En,nx=new Zs;class Oee extends En{constructor(t,i,r){super(t,i),this.isInstancedMesh=!0,this.instanceMatrix=new c0(new Float32Array(r*16),16),this.instanceColor=null,this.morphTexture=null,this.count=r,this.boundingBox=null,this.boundingSphere=null;for(let n=0;n<r;n++)this.setMatrixAt(n,Xke)}computeBoundingBox(){const t=this.geometry,i=this.count;this.boundingBox===null&&(this.boundingBox=new ya),t.boundingBox===null&&t.computeBoundingBox(),this.boundingBox.makeEmpty();for(let r=0;r<i;r++)this.getMatrixAt(r,Mg),Y8.copy(t.boundingBox).applyMatrix4(Mg),this.boundingBox.union(Y8)}computeBoundingSphere(){const t=this.geometry,i=this.count;this.boundingSphere===null&&(this.boundingSphere=new Zs),t.boundingSphere===null&&t.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let r=0;r<i;r++)this.getMatrixAt(r,Mg),nx.copy(t.boundingSphere).applyMatrix4(Mg),this.boundingSphere.union(nx)}copy(t,i){return super.copy(t,i),this.instanceMatrix.copy(t.instanceMatrix),t.morphTexture!==null&&(this.morphTexture=t.morphTexture.clone()),t.instanceColor!==null&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone()),t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),this}getColorAt(t,i){i.fromArray(this.instanceColor.array,t*3)}getMatrixAt(t,i){i.fromArray(this.instanceMatrix.array,t*16)}getMorphAt(t,i){const r=i.morphTargetInfluences,n=this.morphTexture.source.data.data,s=r.length+1,a=t*s+1;for(let o=0;o<r.length;o++)r[o]=n[a+o]}raycast(t,i){const r=this.matrixWorld,n=this.count;if(rx.geometry=this.geometry,rx.material=this.material,rx.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),nx.copy(this.boundingSphere),nx.applyMatrix4(r),t.ray.intersectsSphere(nx)!==!1))for(let s=0;s<n;s++){this.getMatrixAt(s,Mg),q8.multiplyMatrices(r,Mg),rx.matrixWorld=q8,rx.raycast(t,yM);for(let a=0,o=yM.length;a<o;a++){const l=yM[a];l.instanceId=s,l.object=this,i.push(l)}yM.length=0}}setColorAt(t,i){this.instanceColor===null&&(this.instanceColor=new c0(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),i.toArray(this.instanceColor.array,t*3)}setMatrixAt(t,i){i.toArray(this.instanceMatrix.array,t*16)}setMorphAt(t,i){const r=i.morphTargetInfluences,n=r.length+1;this.morphTexture===null&&(this.morphTexture=new Gc(new Float32Array(n*this.count),n,this.count,JT,Ua));const s=this.morphTexture.source.data.data;let a=0;for(let c=0;c<r.length;c++)a+=r[c];const o=this.geometry.morphTargetsRelative?1:1-a,l=n*t;s[l]=o,s.set(r,l+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null),this}}function qke(e,t){return e.z-t.z}function Yke(e,t){return t.z-e.z}class Qke{constructor(){this.index=0,this.pool=[],this.list=[]}push(t,i,r){const n=this.pool,s=this.list;this.index>=n.length&&n.push({start:-1,count:-1,z:-1,index:-1});const a=n[this.index];s.push(a),this.index++,a.start=t.start,a.count=t.count,a.z=i,a.index=r}reset(){this.list.length=0,this.index=0}}const id=new ii,tI=new ii,Kke=new ii,Zke=new Rt(1,1,1),Q8=new ii,iI=new tb,xM=new ya,Lp=new Zs,sx=new oe,K8=new oe,$ke=new oe,rI=new Qke,Fs=new En,wM=[];function Jke(e,t,i=0){const r=t.itemSize;if(e.isInterleavedBufferAttribute||e.array.constructor!==t.array.constructor){const n=e.count;for(let s=0;s<n;s++)for(let a=0;a<r;a++)t.setComponent(s+i,a,e.getComponent(s,a))}else t.array.set(e.array,i*r);t.needsUpdate=!0}class zee extends En{get maxInstanceCount(){return this._maxInstanceCount}constructor(t,i,r=i*2,n){super(new wi,n),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._drawInfo=[],this._drawRanges=[],this._reservedRanges=[],this._bounds=[],this._maxInstanceCount=t,this._maxVertexCount=i,this._maxIndexCount=r,this._geometryInitialized=!1,this._geometryCount=0,this._multiDrawCounts=new Int32Array(t),this._multiDrawStarts=new Int32Array(t),this._multiDrawCount=0,this._multiDrawInstances=null,this._visibilityChanged=!0,this._matricesTexture=null,this._indirectTexture=null,this._colorsTexture=null,this._initMatricesTexture(),this._initIndirectTexture()}_initMatricesTexture(){let t=Math.sqrt(this._maxInstanceCount*4);t=Math.ceil(t/4)*4,t=Math.max(t,4);const i=new Float32Array(t*t*4),r=new Gc(i,t,t,Ys,Ua);this._matricesTexture=r}_initIndirectTexture(){let t=Math.sqrt(this._maxInstanceCount);t=Math.ceil(t);const i=new Uint32Array(t*t),r=new Gc(i,t,t,Zw,yh);this._indirectTexture=r}_initColorsTexture(){let t=Math.sqrt(this._maxIndexCount);t=Math.ceil(t);const i=new Float32Array(t*t*4).fill(1),r=new Gc(i,t,t,Ys,Ua);r.colorSpace=Gi.workingColorSpace,this._colorsTexture=r}_initializeGeometry(t){const i=this.geometry,r=this._maxVertexCount,n=this._maxIndexCount;if(this._geometryInitialized===!1){for(const s in t.attributes){const a=t.getAttribute(s),{array:o,itemSize:l,normalized:c}=a,u=new o.constructor(r*l),h=new dr(u,l,c);i.setAttribute(s,h)}if(t.getIndex()!==null){const s=r>65535?new Uint32Array(n):new Uint16Array(n);i.setIndex(new dr(s,1))}this._geometryInitialized=!0}}_validateGeometry(t){const i=this.geometry;if(!!t.getIndex()!=!!i.getIndex())throw new Error('BatchedMesh: All geometries must consistently have "index".');for(const r in i.attributes){if(!t.hasAttribute(r))throw new Error(`BatchedMesh: Added geometry missing "${r}". All geometries must have consistent attributes.`);const n=t.getAttribute(r),s=i.getAttribute(r);if(n.itemSize!==s.itemSize||n.normalized!==s.normalized)throw new Error("BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}setCustomSort(t){return this.customSort=t,this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new ya);const t=this._geometryCount,i=this.boundingBox,r=this._drawInfo;i.makeEmpty();for(let n=0;n<t;n++){if(r[n].active===!1)continue;const s=r[n].geometryIndex;this.getMatrixAt(n,id),this.getBoundingBoxAt(s,xM).applyMatrix4(id),i.union(xM)}}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Zs);const t=this.boundingSphere,i=this._drawInfo;t.makeEmpty();for(let r=0,n=i.length;r<n;r++){if(i[r].active===!1)continue;const s=i[r].geometryIndex;this.getMatrixAt(r,id),this.getBoundingSphereAt(s,Lp).applyMatrix4(id),t.union(Lp)}}addInstance(t){if(this._drawInfo.length>=this._maxInstanceCount)throw new Error("BatchedMesh: Maximum item count reached.");this._drawInfo.push({visible:!0,active:!0,geometryIndex:t});const i=this._drawInfo.length-1,r=this._matricesTexture,n=r.image.data;Kke.toArray(n,i*16),r.needsUpdate=!0;const s=this._colorsTexture;return s&&(Zke.toArray(s.image.data,i*4),s.needsUpdate=!0),i}addGeometry(t,i=-1,r=-1){if(this._initializeGeometry(t),this._validateGeometry(t),this._drawInfo.length>=this._maxInstanceCount)throw new Error("BatchedMesh: Maximum item count reached.");const n={vertexStart:-1,vertexCount:-1,indexStart:-1,indexCount:-1};let s=null;const a=this._reservedRanges,o=this._drawRanges,l=this._bounds;this._geometryCount!==0&&(s=a[a.length-1]),i===-1?n.vertexCount=t.getAttribute("position").count:n.vertexCount=i,s===null?n.vertexStart=0:n.vertexStart=s.vertexStart+s.vertexCount;const c=t.getIndex(),u=c!==null;if(u&&(r===-1?n.indexCount=c.count:n.indexCount=r,s===null?n.indexStart=0:n.indexStart=s.indexStart+s.indexCount),n.indexStart!==-1&&n.indexStart+n.indexCount>this._maxIndexCount||n.vertexStart+n.vertexCount>this._maxVertexCount)throw new Error("BatchedMesh: Reserved space request exceeds the maximum buffer size.");const h=this._geometryCount;return this._geometryCount++,a.push(n),o.push({start:u?n.indexStart:n.vertexStart,count:-1}),l.push({boxInitialized:!1,box:new ya,sphereInitialized:!1,sphere:new Zs}),this.setGeometryAt(h,t),h}setGeometryAt(t,i){if(t>=this._geometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");this._validateGeometry(i);const r=this.geometry,n=r.getIndex()!==null,s=r.getIndex(),a=i.getIndex(),o=this._reservedRanges[t];if(n&&a.count>o.indexCount||i.attributes.position.count>o.vertexCount)throw new Error("BatchedMesh: Reserved space not large enough for provided geometry.");const l=o.vertexStart,c=o.vertexCount;for(const p in r.attributes){const f=i.getAttribute(p),v=r.getAttribute(p);Jke(f,v,l);const g=f.itemSize;for(let m=f.count,x=c;m<x;m++){const w=l+m;for(let _=0;_<g;_++)v.setComponent(w,_,0)}v.needsUpdate=!0,v.addUpdateRange(l*g,c*g)}if(n){const p=o.indexStart;for(let f=0;f<a.count;f++)s.setX(p+f,l+a.getX(f));for(let f=a.count,v=o.indexCount;f<v;f++)s.setX(p+f,l);s.needsUpdate=!0,s.addUpdateRange(p,o.indexCount)}const u=this._bounds[t];i.boundingBox!==null?(u.box.copy(i.boundingBox),u.boxInitialized=!0):u.boxInitialized=!1,i.boundingSphere!==null?(u.sphere.copy(i.boundingSphere),u.sphereInitialized=!0):u.sphereInitialized=!1;const h=this._drawRanges[t],d=i.getAttribute("position");return h.count=n?a.count:d.count,this._visibilityChanged=!0,t}getBoundingBoxAt(t,i){if(t>=this._geometryCount)return null;const r=this._bounds[t],n=r.box,s=this.geometry;if(r.boxInitialized===!1){n.makeEmpty();const a=s.index,o=s.attributes.position,l=this._drawRanges[t];for(let c=l.start,u=l.start+l.count;c<u;c++){let h=c;a&&(h=a.getX(h)),n.expandByPoint(sx.fromBufferAttribute(o,h))}r.boxInitialized=!0}return i.copy(n),i}getBoundingSphereAt(t,i){if(t>=this._geometryCount)return null;const r=this._bounds[t],n=r.sphere,s=this.geometry;if(r.sphereInitialized===!1){n.makeEmpty(),this.getBoundingBoxAt(t,xM),xM.getCenter(n.center);const a=s.index,o=s.attributes.position,l=this._drawRanges[t];let c=0;for(let u=l.start,h=l.start+l.count;u<h;u++){let d=u;a&&(d=a.getX(d)),sx.fromBufferAttribute(o,d),c=Math.max(c,n.center.distanceToSquared(sx))}n.radius=Math.sqrt(c),r.sphereInitialized=!0}return i.copy(n),i}setMatrixAt(t,i){const r=this._drawInfo,n=this._matricesTexture,s=this._matricesTexture.image.data;return t>=r.length||r[t].active===!1?this:(i.toArray(s,t*16),n.needsUpdate=!0,this)}getMatrixAt(t,i){const r=this._drawInfo,n=this._matricesTexture.image.data;return t>=r.length||r[t].active===!1?null:i.fromArray(n,t*16)}setColorAt(t,i){this._colorsTexture===null&&this._initColorsTexture();const r=this._colorsTexture,n=this._colorsTexture.image.data,s=this._drawInfo;return t>=s.length||s[t].active===!1?this:(i.toArray(n,t*4),r.needsUpdate=!0,this)}getColorAt(t,i){const r=this._colorsTexture.image.data,n=this._drawInfo;return t>=n.length||n[t].active===!1?null:i.fromArray(r,t*4)}setVisibleAt(t,i){const r=this._drawInfo;return t>=r.length||r[t].active===!1||r[t].visible===i?this:(r[t].visible=i,this._visibilityChanged=!0,this)}getVisibleAt(t){const i=this._drawInfo;return t>=i.length||i[t].active===!1?!1:i[t].visible}raycast(t,i){const r=this._drawInfo,n=this._drawRanges,s=this.matrixWorld,a=this.geometry;Fs.material=this.material,Fs.geometry.index=a.index,Fs.geometry.attributes=a.attributes,Fs.geometry.boundingBox===null&&(Fs.geometry.boundingBox=new ya),Fs.geometry.boundingSphere===null&&(Fs.geometry.boundingSphere=new Zs);for(let o=0,l=r.length;o<l;o++){if(!r[o].visible||!r[o].active)continue;const c=r[o].geometryIndex,u=n[c];Fs.geometry.setDrawRange(u.start,u.count),this.getMatrixAt(o,Fs.matrixWorld).premultiply(s),this.getBoundingBoxAt(c,Fs.geometry.boundingBox),this.getBoundingSphereAt(c,Fs.geometry.boundingSphere),Fs.raycast(t,wM);for(let h=0,d=wM.length;h<d;h++){const p=wM[h];p.object=this,p.batchId=o,i.push(p)}wM.length=0}Fs.material=null,Fs.geometry.index=null,Fs.geometry.attributes={},Fs.geometry.setDrawRange(0,1/0)}copy(t){return super.copy(t),this.geometry=t.geometry.clone(),this.perObjectFrustumCulled=t.perObjectFrustumCulled,this.sortObjects=t.sortObjects,this.boundingBox=t.boundingBox!==null?t.boundingBox.clone():null,this.boundingSphere=t.boundingSphere!==null?t.boundingSphere.clone():null,this._drawRanges=t._drawRanges.map(i=>({...i})),this._reservedRanges=t._reservedRanges.map(i=>({...i})),this._drawInfo=t._drawInfo.map(i=>({...i})),this._bounds=t._bounds.map(i=>({boxInitialized:i.boxInitialized,box:i.box.clone(),sphereInitialized:i.sphereInitialized,sphere:i.sphere.clone()})),this._maxInstanceCount=t._maxInstanceCount,this._maxVertexCount=t._maxVertexCount,this._maxIndexCount=t._maxIndexCount,this._geometryInitialized=t._geometryInitialized,this._geometryCount=t._geometryCount,this._multiDrawCounts=t._multiDrawCounts.slice(),this._multiDrawStarts=t._multiDrawStarts.slice(),this._matricesTexture=t._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.data.slice(),this._colorsTexture!==null&&(this._colorsTexture=t._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.data.slice()),this}dispose(){return this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._indirectTexture.dispose(),this._indirectTexture=null,this._colorsTexture!==null&&(this._colorsTexture.dispose(),this._colorsTexture=null),this}onBeforeRender(t,i,r,n,s){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const a=n.getIndex(),o=a===null?1:a.array.BYTES_PER_ELEMENT,l=this._drawInfo,c=this._multiDrawStarts,u=this._multiDrawCounts,h=this._drawRanges,d=this.perObjectFrustumCulled,p=this._indirectTexture,f=p.image.data;d&&(Q8.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse).multiply(this.matrixWorld),iI.setFromProjectionMatrix(Q8,t.coordinateSystem));let v=0;if(this.sortObjects){tI.copy(this.matrixWorld).invert(),sx.setFromMatrixPosition(r.matrixWorld).applyMatrix4(tI),K8.set(0,0,-1).transformDirection(r.matrixWorld).transformDirection(tI);for(let x=0,w=l.length;x<w;x++)if(l[x].visible&&l[x].active){const _=l[x].geometryIndex;this.getMatrixAt(x,id),this.getBoundingSphereAt(_,Lp).applyMatrix4(id);let M=!1;if(d&&(M=!iI.intersectsSphere(Lp)),!M){const S=$ke.subVectors(Lp.center,sx).dot(K8);rI.push(h[_],S,x)}}const g=rI.list,m=this.customSort;m===null?g.sort(s.transparent?Yke:qke):m.call(this,g,r);for(let x=0,w=g.length;x<w;x++){const _=g[x];c[v]=_.start*o,u[v]=_.count,f[v]=_.index,v++}rI.reset()}else for(let g=0,m=l.length;g<m;g++)if(l[g].visible&&l[g].active){const x=l[g].geometryIndex;let w=!1;if(d&&(this.getMatrixAt(g,id),this.getBoundingSphereAt(x,Lp).applyMatrix4(id),w=!iI.intersectsSphere(Lp)),!w){const _=h[x];c[v]=_.start*o,u[v]=_.count,f[v]=g,v++}}p.needsUpdate=!0,this._multiDrawCount=v,this._visibilityChanged=!1}onBeforeShadow(t,i,r,n,s,a){this.onBeforeRender(t,null,n,s,a)}}class Ma extends Ts{constructor(t){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Rt(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}const qC=new oe,YC=new oe,Z8=new ii,ax=new om,bM=new Zs,nI=new oe,$8=new oe;class Zd extends ki{constructor(t=new wi,i=new Ma){super(),this.isLine=!0,this.type="Line",this.geometry=t,this.material=i,this.updateMorphTargets()}copy(t,i){return super.copy(t,i),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(t.index===null){const i=t.attributes.position,r=[0];for(let n=1,s=i.count;n<s;n++)qC.fromBufferAttribute(i,n-1),YC.fromBufferAttribute(i,n),r[n]=r[n-1],r[n]+=qC.distanceTo(YC);t.setAttribute("lineDistance",new kt(r,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(t,i){const r=this.geometry,n=this.matrixWorld,s=t.params.Line.threshold,a=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),bM.copy(r.boundingSphere),bM.applyMatrix4(n),bM.radius+=s,t.ray.intersectsSphere(bM)===!1)return;Z8.copy(n).invert(),ax.copy(t.ray).applyMatrix4(Z8);const o=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=o*o,c=this.isLineSegments?2:1,u=r.index,d=r.attributes.position;if(u!==null){const p=Math.max(0,a.start),f=Math.min(u.count,a.start+a.count);for(let v=p,g=f-1;v<g;v+=c){const m=u.getX(v),x=u.getX(v+1),w=_M(this,t,ax,l,m,x);w&&i.push(w)}if(this.isLineLoop){const v=u.getX(f-1),g=u.getX(p),m=_M(this,t,ax,l,v,g);m&&i.push(m)}}else{const p=Math.max(0,a.start),f=Math.min(d.count,a.start+a.count);for(let v=p,g=f-1;v<g;v+=c){const m=_M(this,t,ax,l,v,v+1);m&&i.push(m)}if(this.isLineLoop){const v=_M(this,t,ax,l,f-1,p);v&&i.push(v)}}}updateMorphTargets(){const i=this.geometry.morphAttributes,r=Object.keys(i);if(r.length>0){const n=i[r[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=n.length;s<a;s++){const o=n[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}}function _M(e,t,i,r,n,s){const a=e.geometry.attributes.position;if(qC.fromBufferAttribute(a,n),YC.fromBufferAttribute(a,s),i.distanceSqToSegment(qC,YC,nI,$8)>r)return;nI.applyMatrix4(e.matrixWorld);const l=t.ray.origin.distanceTo(nI);if(!(l<t.near||l>t.far))return{distance:l,point:$8.clone().applyMatrix4(e.matrixWorld),index:n,face:null,faceIndex:null,object:e}}const J8=new oe,e9=new oe;class Jc extends Zd{constructor(t,i){super(t,i),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(t.index===null){const i=t.attributes.position,r=[];for(let n=0,s=i.count;n<s;n+=2)J8.fromBufferAttribute(i,n),e9.fromBufferAttribute(i,n+1),r[n]=n===0?0:r[n-1],r[n+1]=r[n]+J8.distanceTo(e9);t.setAttribute("lineDistance",new kt(r,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class Nee extends Zd{constructor(t,i){super(t,i),this.isLineLoop=!0,this.type="LineLoop"}}class mU extends Ts{constructor(t){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Rt(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}const t9=new ii,Vz=new om,SM=new Zs,MM=new oe;class Bee extends ki{constructor(t=new wi,i=new mU){super(),this.isPoints=!0,this.type="Points",this.geometry=t,this.material=i,this.updateMorphTargets()}copy(t,i){return super.copy(t,i),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}raycast(t,i){const r=this.geometry,n=this.matrixWorld,s=t.params.Points.threshold,a=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),SM.copy(r.boundingSphere),SM.applyMatrix4(n),SM.radius+=s,t.ray.intersectsSphere(SM)===!1)return;t9.copy(n).invert(),Vz.copy(t.ray).applyMatrix4(t9);const o=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=o*o,c=r.index,h=r.attributes.position;if(c!==null){const d=Math.max(0,a.start),p=Math.min(c.count,a.start+a.count);for(let f=d,v=p;f<v;f++){const g=c.getX(f);MM.fromBufferAttribute(h,g),i9(MM,g,l,n,t,i,this)}}else{const d=Math.max(0,a.start),p=Math.min(h.count,a.start+a.count);for(let f=d,v=p;f<v;f++)MM.fromBufferAttribute(h,f),i9(MM,f,l,n,t,i,this)}}updateMorphTargets(){const i=this.geometry.morphAttributes,r=Object.keys(i);if(r.length>0){const n=i[r[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=n.length;s<a;s++){const o=n[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}}function i9(e,t,i,r,n,s,a){const o=Vz.distanceSqToPoint(e);if(o<i){const l=new oe;Vz.closestPointToPoint(e,l),l.applyMatrix4(r);const c=n.ray.origin.distanceTo(l);if(c<n.near||c>n.far)return;s.push({distance:c,distanceToRay:Math.sqrt(o),point:l,index:t,face:null,object:a})}}class eUe extends kr{constructor(t,i,r,n,s,a,o,l,c){super(t,i,r,n,s,a,o,l,c),this.isVideoTexture=!0,this.minFilter=a!==void 0?a:_n,this.magFilter=s!==void 0?s:_n,this.generateMipmaps=!1;const u=this;function h(){u.needsUpdate=!0,t.requestVideoFrameCallback(h)}"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback(h)}clone(){return new this.constructor(this.image).copy(this)}update(){const t=this.image;"requestVideoFrameCallback"in t===!1&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class tUe extends kr{constructor(t,i){super({width:t,height:i}),this.isFramebufferTexture=!0,this.magFilter=os,this.minFilter=os,this.generateMipmaps=!1,this.needsUpdate=!0}}class u2 extends kr{constructor(t,i,r,n,s,a,o,l,c,u,h,d){super(null,a,o,l,c,u,n,s,h,d),this.isCompressedTexture=!0,this.image={width:i,height:r},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}}class iUe extends u2{constructor(t,i,r,n,s,a){super(t,i,r,s,a),this.isCompressedArrayTexture=!0,this.image.depth=n,this.wrapR=Qo,this.layerUpdates=new Set}addLayerUpdate(t){this.layerUpdates.add(t)}clearLayerUpdates(){this.layerUpdates.clear()}}class rUe extends u2{constructor(t,i,r){super(void 0,t[0].width,t[0].height,i,r,vh),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=t}}class nUe extends kr{constructor(t,i,r,n,s,a,o,l,c){super(t,i,r,n,s,a,o,l,c),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Ql{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(t,i){const r=this.getUtoTmapping(t);return this.getPoint(r,i)}getPoints(t=5){const i=[];for(let r=0;r<=t;r++)i.push(this.getPoint(r/t));return i}getSpacedPoints(t=5){const i=[];for(let r=0;r<=t;r++)i.push(this.getPointAt(r/t));return i}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const i=[];let r,n=this.getPoint(0),s=0;i.push(0);for(let a=1;a<=t;a++)r=this.getPoint(a/t),s+=r.distanceTo(n),i.push(s),n=r;return this.cacheArcLengths=i,i}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,i){const r=this.getLengths();let n=0;const s=r.length;let a;i?a=i:a=t*r[s-1];let o=0,l=s-1,c;for(;o<=l;)if(n=Math.floor(o+(l-o)/2),c=r[n]-a,c<0)o=n+1;else if(c>0)l=n-1;else{l=n;break}if(n=l,r[n]===a)return n/(s-1);const u=r[n],d=r[n+1]-u,p=(a-u)/d;return(n+p)/(s-1)}getTangent(t,i){let n=t-1e-4,s=t+1e-4;n<0&&(n=0),s>1&&(s=1);const a=this.getPoint(n),o=this.getPoint(s),l=i||(a.isVector2?new ot:new oe);return l.copy(o).sub(a).normalize(),l}getTangentAt(t,i){const r=this.getUtoTmapping(t);return this.getTangent(r,i)}computeFrenetFrames(t,i){const r=new oe,n=[],s=[],a=[],o=new oe,l=new ii;for(let p=0;p<=t;p++){const f=p/t;n[p]=this.getTangentAt(f,new oe)}s[0]=new oe,a[0]=new oe;let c=Number.MAX_VALUE;const u=Math.abs(n[0].x),h=Math.abs(n[0].y),d=Math.abs(n[0].z);u<=c&&(c=u,r.set(1,0,0)),h<=c&&(c=h,r.set(0,1,0)),d<=c&&r.set(0,0,1),o.crossVectors(n[0],r).normalize(),s[0].crossVectors(n[0],o),a[0].crossVectors(n[0],s[0]);for(let p=1;p<=t;p++){if(s[p]=s[p-1].clone(),a[p]=a[p-1].clone(),o.crossVectors(n[p-1],n[p]),o.length()>Number.EPSILON){o.normalize();const f=Math.acos(Qr(n[p-1].dot(n[p]),-1,1));s[p].applyMatrix4(l.makeRotationAxis(o,f))}a[p].crossVectors(n[p],s[p])}if(i===!0){let p=Math.acos(Qr(s[0].dot(s[t]),-1,1));p/=t,n[0].dot(o.crossVectors(s[0],s[t]))>0&&(p=-p);for(let f=1;f<=t;f++)s[f].applyMatrix4(l.makeRotationAxis(n[f],p*f)),a[f].crossVectors(n[f],s[f])}return{tangents:n,normals:s,binormals:a}}clone(){return new this.constructor().copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class h2 extends Ql{constructor(t=0,i=0,r=1,n=1,s=0,a=Math.PI*2,o=!1,l=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=t,this.aY=i,this.xRadius=r,this.yRadius=n,this.aStartAngle=s,this.aEndAngle=a,this.aClockwise=o,this.aRotation=l}getPoint(t,i=new ot){const r=i,n=Math.PI*2;let s=this.aEndAngle-this.aStartAngle;const a=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=n;for(;s>n;)s-=n;s<Number.EPSILON&&(a?s=0:s=n),this.aClockwise===!0&&!a&&(s===n?s=-n:s=s-n);const o=this.aStartAngle+t*s;let l=this.aX+this.xRadius*Math.cos(o),c=this.aY+this.yRadius*Math.sin(o);if(this.aRotation!==0){const u=Math.cos(this.aRotation),h=Math.sin(this.aRotation),d=l-this.aX,p=c-this.aY;l=d*u-p*h+this.aX,c=d*h+p*u+this.aY}return r.set(l,c)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}class kee extends h2{constructor(t,i,r,n,s,a){super(t,i,r,r,n,s,a),this.isArcCurve=!0,this.type="ArcCurve"}}function gU(){let e=0,t=0,i=0,r=0;function n(s,a,o,l){e=s,t=o,i=-3*s+3*a-2*o-l,r=2*s-2*a+o+l}return{initCatmullRom:function(s,a,o,l,c){n(a,o,c*(o-s),c*(l-a))},initNonuniformCatmullRom:function(s,a,o,l,c,u,h){let d=(a-s)/c-(o-s)/(c+u)+(o-a)/u,p=(o-a)/u-(l-a)/(u+h)+(l-o)/h;d*=u,p*=u,n(a,o,d,p)},calc:function(s){const a=s*s,o=a*s;return e+t*s+i*a+r*o}}}const EM=new oe,sI=new gU,aI=new gU,oI=new gU;class Uee extends Ql{constructor(t=[],i=!1,r="centripetal",n=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=t,this.closed=i,this.curveType=r,this.tension=n}getPoint(t,i=new oe){const r=i,n=this.points,s=n.length,a=(s-(this.closed?0:1))*t;let o=Math.floor(a),l=a-o;this.closed?o+=o>0?0:(Math.floor(Math.abs(o)/s)+1)*s:l===0&&o===s-1&&(o=s-2,l=1);let c,u;this.closed||o>0?c=n[(o-1)%s]:(EM.subVectors(n[0],n[1]).add(n[0]),c=EM);const h=n[o%s],d=n[(o+1)%s];if(this.closed||o+2<s?u=n[(o+2)%s]:(EM.subVectors(n[s-1],n[s-2]).add(n[s-1]),u=EM),this.curveType==="centripetal"||this.curveType==="chordal"){const p=this.curveType==="chordal"?.5:.25;let f=Math.pow(c.distanceToSquared(h),p),v=Math.pow(h.distanceToSquared(d),p),g=Math.pow(d.distanceToSquared(u),p);v<1e-4&&(v=1),f<1e-4&&(f=v),g<1e-4&&(g=v),sI.initNonuniformCatmullRom(c.x,h.x,d.x,u.x,f,v,g),aI.initNonuniformCatmullRom(c.y,h.y,d.y,u.y,f,v,g),oI.initNonuniformCatmullRom(c.z,h.z,d.z,u.z,f,v,g)}else this.curveType==="catmullrom"&&(sI.initCatmullRom(c.x,h.x,d.x,u.x,this.tension),aI.initCatmullRom(c.y,h.y,d.y,u.y,this.tension),oI.initCatmullRom(c.z,h.z,d.z,u.z,this.tension));return r.set(sI.calc(l),aI.calc(l),oI.calc(l)),r}copy(t){super.copy(t),this.points=[];for(let i=0,r=t.points.length;i<r;i++){const n=t.points[i];this.points.push(n.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let i=0,r=this.points.length;i<r;i++){const n=this.points[i];t.points.push(n.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let i=0,r=t.points.length;i<r;i++){const n=t.points[i];this.points.push(new oe().fromArray(n))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}function r9(e,t,i,r,n){const s=(r-t)*.5,a=(n-i)*.5,o=e*e,l=e*o;return(2*i-2*r+s+a)*l+(-3*i+3*r-2*s-a)*o+s*e+i}function sUe(e,t){const i=1-e;return i*i*t}function aUe(e,t){return 2*(1-e)*e*t}function oUe(e,t){return e*e*t}function c1(e,t,i,r){return sUe(e,t)+aUe(e,i)+oUe(e,r)}function lUe(e,t){const i=1-e;return i*i*i*t}function cUe(e,t){const i=1-e;return 3*i*i*e*t}function uUe(e,t){return 3*(1-e)*e*e*t}function hUe(e,t){return e*e*e*t}function u1(e,t,i,r,n){return lUe(e,t)+cUe(e,i)+uUe(e,r)+hUe(e,n)}class vU extends Ql{constructor(t=new ot,i=new ot,r=new ot,n=new ot){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=t,this.v1=i,this.v2=r,this.v3=n}getPoint(t,i=new ot){const r=i,n=this.v0,s=this.v1,a=this.v2,o=this.v3;return r.set(u1(t,n.x,s.x,a.x,o.x),u1(t,n.y,s.y,a.y,o.y)),r}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class Fee extends Ql{constructor(t=new oe,i=new oe,r=new oe,n=new oe){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=t,this.v1=i,this.v2=r,this.v3=n}getPoint(t,i=new oe){const r=i,n=this.v0,s=this.v1,a=this.v2,o=this.v3;return r.set(u1(t,n.x,s.x,a.x,o.x),u1(t,n.y,s.y,a.y,o.y),u1(t,n.z,s.z,a.z,o.z)),r}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class yU extends Ql{constructor(t=new ot,i=new ot){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=t,this.v2=i}getPoint(t,i=new ot){const r=i;return t===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(t).add(this.v1)),r}getPointAt(t,i){return this.getPoint(t,i)}getTangent(t,i=new ot){return i.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,i){return this.getTangent(t,i)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class Vee extends Ql{constructor(t=new oe,i=new oe){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=t,this.v2=i}getPoint(t,i=new oe){const r=i;return t===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(t).add(this.v1)),r}getPointAt(t,i){return this.getPoint(t,i)}getTangent(t,i=new oe){return i.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,i){return this.getTangent(t,i)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class xU extends Ql{constructor(t=new ot,i=new ot,r=new ot){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=t,this.v1=i,this.v2=r}getPoint(t,i=new ot){const r=i,n=this.v0,s=this.v1,a=this.v2;return r.set(c1(t,n.x,s.x,a.x),c1(t,n.y,s.y,a.y)),r}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class wU extends Ql{constructor(t=new oe,i=new oe,r=new oe){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=t,this.v1=i,this.v2=r}getPoint(t,i=new oe){const r=i,n=this.v0,s=this.v1,a=this.v2;return r.set(c1(t,n.x,s.x,a.x),c1(t,n.y,s.y,a.y),c1(t,n.z,s.z,a.z)),r}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class bU extends Ql{constructor(t=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=t}getPoint(t,i=new ot){const r=i,n=this.points,s=(n.length-1)*t,a=Math.floor(s),o=s-a,l=n[a===0?a:a-1],c=n[a],u=n[a>n.length-2?n.length-1:a+1],h=n[a>n.length-3?n.length-1:a+2];return r.set(r9(o,l.x,c.x,u.x,h.x),r9(o,l.y,c.y,u.y,h.y)),r}copy(t){super.copy(t),this.points=[];for(let i=0,r=t.points.length;i<r;i++){const n=t.points[i];this.points.push(n.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let i=0,r=this.points.length;i<r;i++){const n=this.points[i];t.points.push(n.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let i=0,r=t.points.length;i<r;i++){const n=t.points[i];this.points.push(new ot().fromArray(n))}return this}}var QC=Object.freeze({__proto__:null,ArcCurve:kee,CatmullRomCurve3:Uee,CubicBezierCurve:vU,CubicBezierCurve3:Fee,EllipseCurve:h2,LineCurve:yU,LineCurve3:Vee,QuadraticBezierCurve:xU,QuadraticBezierCurve3:wU,SplineCurve:bU});class Hee extends Ql{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),i=this.curves[this.curves.length-1].getPoint(1);if(!t.equals(i)){const r=t.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new QC[r](i,t))}return this}getPoint(t,i){const r=t*this.getLength(),n=this.getCurveLengths();let s=0;for(;s<n.length;){if(n[s]>=r){const a=n[s]-r,o=this.curves[s],l=o.getLength(),c=l===0?0:1-a/l;return o.getPointAt(c,i)}s++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let i=0;for(let r=0,n=this.curves.length;r<n;r++)i+=this.curves[r].getLength(),t.push(i);return this.cacheLengths=t,t}getSpacedPoints(t=40){const i=[];for(let r=0;r<=t;r++)i.push(this.getPoint(r/t));return this.autoClose&&i.push(i[0]),i}getPoints(t=12){const i=[];let r;for(let n=0,s=this.curves;n<s.length;n++){const a=s[n],o=a.isEllipseCurve?t*2:a.isLineCurve||a.isLineCurve3?1:a.isSplineCurve?t*a.points.length:t,l=a.getPoints(o);for(let c=0;c<l.length;c++){const u=l[c];r&&r.equals(u)||(i.push(u),r=u)}}return this.autoClose&&i.length>1&&!i[i.length-1].equals(i[0])&&i.push(i[0]),i}copy(t){super.copy(t),this.curves=[];for(let i=0,r=t.curves.length;i<r;i++){const n=t.curves[i];this.curves.push(n.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let i=0,r=this.curves.length;i<r;i++){const n=this.curves[i];t.curves.push(n.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let i=0,r=t.curves.length;i<r;i++){const n=t.curves[i];this.curves.push(new QC[n.type]().fromJSON(n))}return this}}class pw extends Hee{constructor(t){super(),this.type="Path",this.currentPoint=new ot,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let i=1,r=t.length;i<r;i++)this.lineTo(t[i].x,t[i].y);return this}moveTo(t,i){return this.currentPoint.set(t,i),this}lineTo(t,i){const r=new yU(this.currentPoint.clone(),new ot(t,i));return this.curves.push(r),this.currentPoint.set(t,i),this}quadraticCurveTo(t,i,r,n){const s=new xU(this.currentPoint.clone(),new ot(t,i),new ot(r,n));return this.curves.push(s),this.currentPoint.set(r,n),this}bezierCurveTo(t,i,r,n,s,a){const o=new vU(this.currentPoint.clone(),new ot(t,i),new ot(r,n),new ot(s,a));return this.curves.push(o),this.currentPoint.set(s,a),this}splineThru(t){const i=[this.currentPoint.clone()].concat(t),r=new bU(i);return this.curves.push(r),this.currentPoint.copy(t[t.length-1]),this}arc(t,i,r,n,s,a){const o=this.currentPoint.x,l=this.currentPoint.y;return this.absarc(t+o,i+l,r,n,s,a),this}absarc(t,i,r,n,s,a){return this.absellipse(t,i,r,r,n,s,a),this}ellipse(t,i,r,n,s,a,o,l){const c=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(t+c,i+u,r,n,s,a,o,l),this}absellipse(t,i,r,n,s,a,o,l){const c=new h2(t,i,r,n,s,a,o,l);if(this.curves.length>0){const h=c.getPoint(0);h.equals(this.currentPoint)||this.lineTo(h.x,h.y)}this.curves.push(c);const u=c.getPoint(1);return this.currentPoint.copy(u),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}class ib extends wi{constructor(t=[new ot(0,-.5),new ot(.5,0),new ot(0,.5)],i=12,r=0,n=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:t,segments:i,phiStart:r,phiLength:n},i=Math.floor(i),n=Qr(n,0,Math.PI*2);const s=[],a=[],o=[],l=[],c=[],u=1/i,h=new oe,d=new ot,p=new oe,f=new oe,v=new oe;let g=0,m=0;for(let x=0;x<=t.length-1;x++)switch(x){case 0:g=t[x+1].x-t[x].x,m=t[x+1].y-t[x].y,p.x=m*1,p.y=-g,p.z=m*0,v.copy(p),p.normalize(),l.push(p.x,p.y,p.z);break;case t.length-1:l.push(v.x,v.y,v.z);break;default:g=t[x+1].x-t[x].x,m=t[x+1].y-t[x].y,p.x=m*1,p.y=-g,p.z=m*0,f.copy(p),p.x+=v.x,p.y+=v.y,p.z+=v.z,p.normalize(),l.push(p.x,p.y,p.z),v.copy(f)}for(let x=0;x<=i;x++){const w=r+x*u*n,_=Math.sin(w),M=Math.cos(w);for(let S=0;S<=t.length-1;S++){h.x=t[S].x*_,h.y=t[S].y,h.z=t[S].x*M,a.push(h.x,h.y,h.z),d.x=x/i,d.y=S/(t.length-1),o.push(d.x,d.y);const A=l[3*S+0]*_,T=l[3*S+1],E=l[3*S+0]*M;c.push(A,T,E)}}for(let x=0;x<i;x++)for(let w=0;w<t.length-1;w++){const _=w+x*t.length,M=_,S=_+t.length,A=_+t.length+1,T=_+1;s.push(M,S,T),s.push(A,T,S)}this.setIndex(s),this.setAttribute("position",new kt(a,3)),this.setAttribute("uv",new kt(o,2)),this.setAttribute("normal",new kt(c,3))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new ib(t.points,t.segments,t.phiStart,t.phiLength)}}class d2 extends ib{constructor(t=1,i=1,r=4,n=8){const s=new pw;s.absarc(0,-i/2,t,Math.PI*1.5,0),s.absarc(0,i/2,t,0,Math.PI*.5),super(s.getPoints(r),n),this.type="CapsuleGeometry",this.parameters={radius:t,length:i,capSegments:r,radialSegments:n}}static fromJSON(t){return new d2(t.radius,t.length,t.capSegments,t.radialSegments)}}class p2 extends wi{constructor(t=1,i=32,r=0,n=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:t,segments:i,thetaStart:r,thetaLength:n},i=Math.max(3,i);const s=[],a=[],o=[],l=[],c=new oe,u=new ot;a.push(0,0,0),o.push(0,0,1),l.push(.5,.5);for(let h=0,d=3;h<=i;h++,d+=3){const p=r+h/i*n;c.x=t*Math.cos(p),c.y=t*Math.sin(p),a.push(c.x,c.y,c.z),o.push(0,0,1),u.x=(a[d]/t+1)/2,u.y=(a[d+1]/t+1)/2,l.push(u.x,u.y)}for(let h=1;h<=i;h++)s.push(h,h+1,0);this.setIndex(s),this.setAttribute("position",new kt(a,3)),this.setAttribute("normal",new kt(o,3)),this.setAttribute("uv",new kt(l,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new p2(t.radius,t.segments,t.thetaStart,t.thetaLength)}}class H0 extends wi{constructor(t=1,i=1,r=1,n=32,s=1,a=!1,o=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:i,height:r,radialSegments:n,heightSegments:s,openEnded:a,thetaStart:o,thetaLength:l};const c=this;n=Math.floor(n),s=Math.floor(s);const u=[],h=[],d=[],p=[];let f=0;const v=[],g=r/2;let m=0;x(),a===!1&&(t>0&&w(!0),i>0&&w(!1)),this.setIndex(u),this.setAttribute("position",new kt(h,3)),this.setAttribute("normal",new kt(d,3)),this.setAttribute("uv",new kt(p,2));function x(){const _=new oe,M=new oe;let S=0;const A=(i-t)/r;for(let T=0;T<=s;T++){const E=[],C=T/s,D=C*(i-t)+t;for(let I=0;I<=n;I++){const L=I/n,z=L*l+o,F=Math.sin(z),Q=Math.cos(z);M.x=D*F,M.y=-C*r+g,M.z=D*Q,h.push(M.x,M.y,M.z),_.set(F,A,Q).normalize(),d.push(_.x,_.y,_.z),p.push(L,1-C),E.push(f++)}v.push(E)}for(let T=0;T<n;T++)for(let E=0;E<s;E++){const C=v[E][T],D=v[E+1][T],I=v[E+1][T+1],L=v[E][T+1];u.push(C,D,L),u.push(D,I,L),S+=6}c.addGroup(m,S,0),m+=S}function w(_){const M=f,S=new ot,A=new oe;let T=0;const E=_===!0?t:i,C=_===!0?1:-1;for(let I=1;I<=n;I++)h.push(0,g*C,0),d.push(0,C,0),p.push(.5,.5),f++;const D=f;for(let I=0;I<=n;I++){const z=I/n*l+o,F=Math.cos(z),Q=Math.sin(z);A.x=E*Q,A.y=g*C,A.z=E*F,h.push(A.x,A.y,A.z),d.push(0,C,0),S.x=F*.5+.5,S.y=Q*.5*C+.5,p.push(S.x,S.y),f++}for(let I=0;I<n;I++){const L=M+I,z=D+I;_===!0?u.push(z,z+1,L):u.push(z+1,z,L),T+=3}c.addGroup(m,T,_===!0?1:2),m+=T}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new H0(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class f2 extends H0{constructor(t=1,i=1,r=32,n=1,s=!1,a=0,o=Math.PI*2){super(0,t,i,r,n,s,a,o),this.type="ConeGeometry",this.parameters={radius:t,height:i,radialSegments:r,heightSegments:n,openEnded:s,thetaStart:a,thetaLength:o}}static fromJSON(t){return new f2(t.radius,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class op extends wi{constructor(t=[],i=[],r=1,n=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:i,radius:r,detail:n};const s=[],a=[];o(n),c(r),u(),this.setAttribute("position",new kt(s,3)),this.setAttribute("normal",new kt(s.slice(),3)),this.setAttribute("uv",new kt(a,2)),n===0?this.computeVertexNormals():this.normalizeNormals();function o(x){const w=new oe,_=new oe,M=new oe;for(let S=0;S<i.length;S+=3)p(i[S+0],w),p(i[S+1],_),p(i[S+2],M),l(w,_,M,x)}function l(x,w,_,M){const S=M+1,A=[];for(let T=0;T<=S;T++){A[T]=[];const E=x.clone().lerp(_,T/S),C=w.clone().lerp(_,T/S),D=S-T;for(let I=0;I<=D;I++)I===0&&T===S?A[T][I]=E:A[T][I]=E.clone().lerp(C,I/D)}for(let T=0;T<S;T++)for(let E=0;E<2*(S-T)-1;E++){const C=Math.floor(E/2);E%2===0?(d(A[T][C+1]),d(A[T+1][C]),d(A[T][C])):(d(A[T][C+1]),d(A[T+1][C+1]),d(A[T+1][C]))}}function c(x){const w=new oe;for(let _=0;_<s.length;_+=3)w.x=s[_+0],w.y=s[_+1],w.z=s[_+2],w.normalize().multiplyScalar(x),s[_+0]=w.x,s[_+1]=w.y,s[_+2]=w.z}function u(){const x=new oe;for(let w=0;w<s.length;w+=3){x.x=s[w+0],x.y=s[w+1],x.z=s[w+2];const _=g(x)/2/Math.PI+.5,M=m(x)/Math.PI+.5;a.push(_,1-M)}f(),h()}function h(){for(let x=0;x<a.length;x+=6){const w=a[x+0],_=a[x+2],M=a[x+4],S=Math.max(w,_,M),A=Math.min(w,_,M);S>.9&&A<.1&&(w<.2&&(a[x+0]+=1),_<.2&&(a[x+2]+=1),M<.2&&(a[x+4]+=1))}}function d(x){s.push(x.x,x.y,x.z)}function p(x,w){const _=x*3;w.x=t[_+0],w.y=t[_+1],w.z=t[_+2]}function f(){const x=new oe,w=new oe,_=new oe,M=new oe,S=new ot,A=new ot,T=new ot;for(let E=0,C=0;E<s.length;E+=9,C+=6){x.set(s[E+0],s[E+1],s[E+2]),w.set(s[E+3],s[E+4],s[E+5]),_.set(s[E+6],s[E+7],s[E+8]),S.set(a[C+0],a[C+1]),A.set(a[C+2],a[C+3]),T.set(a[C+4],a[C+5]),M.copy(x).add(w).add(_).divideScalar(3);const D=g(M);v(S,C+0,x,D),v(A,C+2,w,D),v(T,C+4,_,D)}}function v(x,w,_,M){M<0&&x.x===1&&(a[w]=x.x-1),_.x===0&&_.z===0&&(a[w]=M/2/Math.PI+.5)}function g(x){return Math.atan2(x.z,-x.x)}function m(x){return Math.atan2(-x.y,Math.sqrt(x.x*x.x+x.z*x.z))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new op(t.vertices,t.indices,t.radius,t.details)}}class m2 extends op{constructor(t=1,i=0){const r=(1+Math.sqrt(5))/2,n=1/r,s=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-r,0,-n,r,0,n,-r,0,n,r,-n,-r,0,-n,r,0,n,-r,0,n,r,0,-r,0,-n,r,0,-n,-r,0,n,r,0,n],a=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(s,a,t,i),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:i}}static fromJSON(t){return new m2(t.radius,t.detail)}}const AM=new oe,CM=new oe,lI=new oe,TM=new oo;class Gee extends wi{constructor(t=null,i=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:t,thresholdAngle:i},t!==null){const n=Math.pow(10,4),s=Math.cos(Rf*i),a=t.getIndex(),o=t.getAttribute("position"),l=a?a.count:o.count,c=[0,0,0],u=["a","b","c"],h=new Array(3),d={},p=[];for(let f=0;f<l;f+=3){a?(c[0]=a.getX(f),c[1]=a.getX(f+1),c[2]=a.getX(f+2)):(c[0]=f,c[1]=f+1,c[2]=f+2);const{a:v,b:g,c:m}=TM;if(v.fromBufferAttribute(o,c[0]),g.fromBufferAttribute(o,c[1]),m.fromBufferAttribute(o,c[2]),TM.getNormal(lI),h[0]=`${Math.round(v.x*n)},${Math.round(v.y*n)},${Math.round(v.z*n)}`,h[1]=`${Math.round(g.x*n)},${Math.round(g.y*n)},${Math.round(g.z*n)}`,h[2]=`${Math.round(m.x*n)},${Math.round(m.y*n)},${Math.round(m.z*n)}`,!(h[0]===h[1]||h[1]===h[2]||h[2]===h[0]))for(let x=0;x<3;x++){const w=(x+1)%3,_=h[x],M=h[w],S=TM[u[x]],A=TM[u[w]],T=`${_}_${M}`,E=`${M}_${_}`;E in d&&d[E]?(lI.dot(d[E].normal)<=s&&(p.push(S.x,S.y,S.z),p.push(A.x,A.y,A.z)),d[E]=null):T in d||(d[T]={index0:c[x],index1:c[w],normal:lI.clone()})}}for(const f in d)if(d[f]){const{index0:v,index1:g}=d[f];AM.fromBufferAttribute(o,v),CM.fromBufferAttribute(o,g),p.push(AM.x,AM.y,AM.z),p.push(CM.x,CM.y,CM.z)}this.setAttribute("position",new kt(p,3))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}}class Lf extends pw{constructor(t){super(t),this.uuid=po(),this.type="Shape",this.holes=[]}getPointsHoles(t){const i=[];for(let r=0,n=this.holes.length;r<n;r++)i[r]=this.holes[r].getPoints(t);return i}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let i=0,r=t.holes.length;i<r;i++){const n=t.holes[i];this.holes.push(n.clone())}return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let i=0,r=this.holes.length;i<r;i++){const n=this.holes[i];t.holes.push(n.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let i=0,r=t.holes.length;i<r;i++){const n=t.holes[i];this.holes.push(new pw().fromJSON(n))}return this}}const dUe={triangulate:function(e,t,i=2){const r=t&&t.length,n=r?t[0]*i:e.length;let s=jee(e,0,n,i,!0);const a=[];if(!s||s.next===s.prev)return a;let o,l,c,u,h,d,p;if(r&&(s=vUe(e,t,s,i)),e.length>80*i){o=c=e[0],l=u=e[1];for(let f=i;f<n;f+=i)h=e[f],d=e[f+1],h<o&&(o=h),d<l&&(l=d),h>c&&(c=h),d>u&&(u=d);p=Math.max(c-o,u-l),p=p!==0?32767/p:0}return fw(s,a,i,o,l,p,0),a}};function jee(e,t,i,r,n){let s,a;if(n===TUe(e,t,i,r)>0)for(s=t;s<i;s+=r)a=n9(s,e[s],e[s+1],a);else for(s=i-r;s>=t;s-=r)a=n9(s,e[s],e[s+1],a);return a&&g2(a,a.next)&&(gw(a),a=a.next),a}function Zf(e,t){if(!e)return e;t||(t=e);let i=e,r;do if(r=!1,!i.steiner&&(g2(i,i.next)||Or(i.prev,i,i.next)===0)){if(gw(i),i=t=i.prev,i===i.next)break;r=!0}else i=i.next;while(r||i!==t);return t}function fw(e,t,i,r,n,s,a){if(!e)return;!a&&s&&_Ue(e,r,n,s);let o=e,l,c;for(;e.prev!==e.next;){if(l=e.prev,c=e.next,s?fUe(e,r,n,s):pUe(e)){t.push(l.i/i|0),t.push(e.i/i|0),t.push(c.i/i|0),gw(e),e=c.next,o=c.next;continue}if(e=c,e===o){a?a===1?(e=mUe(Zf(e),t,i),fw(e,t,i,r,n,s,2)):a===2&&gUe(e,t,i,r,n,s):fw(Zf(e),t,i,r,n,s,1);break}}}function pUe(e){const t=e.prev,i=e,r=e.next;if(Or(t,i,r)>=0)return!1;const n=t.x,s=i.x,a=r.x,o=t.y,l=i.y,c=r.y,u=n<s?n<a?n:a:s<a?s:a,h=o<l?o<c?o:c:l<c?l:c,d=n>s?n>a?n:a:s>a?s:a,p=o>l?o>c?o:c:l>c?l:c;let f=r.next;for(;f!==t;){if(f.x>=u&&f.x<=d&&f.y>=h&&f.y<=p&&dv(n,o,s,l,a,c,f.x,f.y)&&Or(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function fUe(e,t,i,r){const n=e.prev,s=e,a=e.next;if(Or(n,s,a)>=0)return!1;const o=n.x,l=s.x,c=a.x,u=n.y,h=s.y,d=a.y,p=o<l?o<c?o:c:l<c?l:c,f=u<h?u<d?u:d:h<d?h:d,v=o>l?o>c?o:c:l>c?l:c,g=u>h?u>d?u:d:h>d?h:d,m=Hz(p,f,t,i,r),x=Hz(v,g,t,i,r);let w=e.prevZ,_=e.nextZ;for(;w&&w.z>=m&&_&&_.z<=x;){if(w.x>=p&&w.x<=v&&w.y>=f&&w.y<=g&&w!==n&&w!==a&&dv(o,u,l,h,c,d,w.x,w.y)&&Or(w.prev,w,w.next)>=0||(w=w.prevZ,_.x>=p&&_.x<=v&&_.y>=f&&_.y<=g&&_!==n&&_!==a&&dv(o,u,l,h,c,d,_.x,_.y)&&Or(_.prev,_,_.next)>=0))return!1;_=_.nextZ}for(;w&&w.z>=m;){if(w.x>=p&&w.x<=v&&w.y>=f&&w.y<=g&&w!==n&&w!==a&&dv(o,u,l,h,c,d,w.x,w.y)&&Or(w.prev,w,w.next)>=0)return!1;w=w.prevZ}for(;_&&_.z<=x;){if(_.x>=p&&_.x<=v&&_.y>=f&&_.y<=g&&_!==n&&_!==a&&dv(o,u,l,h,c,d,_.x,_.y)&&Or(_.prev,_,_.next)>=0)return!1;_=_.nextZ}return!0}function mUe(e,t,i){let r=e;do{const n=r.prev,s=r.next.next;!g2(n,s)&&Wee(n,r,r.next,s)&&mw(n,s)&&mw(s,n)&&(t.push(n.i/i|0),t.push(r.i/i|0),t.push(s.i/i|0),gw(r),gw(r.next),r=e=s),r=r.next}while(r!==e);return Zf(r)}function gUe(e,t,i,r,n,s){let a=e;do{let o=a.next.next;for(;o!==a.prev;){if(a.i!==o.i&&EUe(a,o)){let l=Xee(a,o);a=Zf(a,a.next),l=Zf(l,l.next),fw(a,t,i,r,n,s,0),fw(l,t,i,r,n,s,0);return}o=o.next}a=a.next}while(a!==e)}function vUe(e,t,i,r){const n=[];let s,a,o,l,c;for(s=0,a=t.length;s<a;s++)o=t[s]*r,l=s<a-1?t[s+1]*r:e.length,c=jee(e,o,l,r,!1),c===c.next&&(c.steiner=!0),n.push(MUe(c));for(n.sort(yUe),s=0;s<n.length;s++)i=xUe(n[s],i);return i}function yUe(e,t){return e.x-t.x}function xUe(e,t){const i=wUe(e,t);if(!i)return t;const r=Xee(i,e);return Zf(r,r.next),Zf(i,i.next)}function wUe(e,t){let i=t,r=-1/0,n;const s=e.x,a=e.y;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){const d=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(d<=s&&d>r&&(r=d,n=i.x<i.next.x?i:i.next,d===s))return n}i=i.next}while(i!==t);if(!n)return null;const o=n,l=n.x,c=n.y;let u=1/0,h;i=n;do s>=i.x&&i.x>=l&&s!==i.x&&dv(a<c?s:r,a,l,c,a<c?r:s,a,i.x,i.y)&&(h=Math.abs(a-i.y)/(s-i.x),mw(i,e)&&(h<u||h===u&&(i.x>n.x||i.x===n.x&&bUe(n,i)))&&(n=i,u=h)),i=i.next;while(i!==o);return n}function bUe(e,t){return Or(e.prev,e,t.prev)<0&&Or(t.next,e,e.next)<0}function _Ue(e,t,i,r){let n=e;do n.z===0&&(n.z=Hz(n.x,n.y,t,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,SUe(n)}function SUe(e){let t,i,r,n,s,a,o,l,c=1;do{for(i=e,e=null,s=null,a=0;i;){for(a++,r=i,o=0,t=0;t<c&&(o++,r=r.nextZ,!!r);t++);for(l=c;o>0||l>0&&r;)o!==0&&(l===0||!r||i.z<=r.z)?(n=i,i=i.nextZ,o--):(n=r,r=r.nextZ,l--),s?s.nextZ=n:e=n,n.prevZ=s,s=n;i=r}s.nextZ=null,c*=2}while(a>1);return e}function Hz(e,t,i,r,n){return e=(e-i)*n|0,t=(t-r)*n|0,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function MUe(e){let t=e,i=e;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==e);return i}function dv(e,t,i,r,n,s,a,o){return(n-a)*(t-o)>=(e-a)*(s-o)&&(e-a)*(r-o)>=(i-a)*(t-o)&&(i-a)*(s-o)>=(n-a)*(r-o)}function EUe(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!AUe(e,t)&&(mw(e,t)&&mw(t,e)&&CUe(e,t)&&(Or(e.prev,e,t.prev)||Or(e,t.prev,t))||g2(e,t)&&Or(e.prev,e,e.next)>0&&Or(t.prev,t,t.next)>0)}function Or(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function g2(e,t){return e.x===t.x&&e.y===t.y}function Wee(e,t,i,r){const n=DM(Or(e,t,i)),s=DM(Or(e,t,r)),a=DM(Or(i,r,e)),o=DM(Or(i,r,t));return!!(n!==s&&a!==o||n===0&&PM(e,i,t)||s===0&&PM(e,r,t)||a===0&&PM(i,e,r)||o===0&&PM(i,t,r))}function PM(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function DM(e){return e>0?1:e<0?-1:0}function AUe(e,t){let i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&Wee(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}function mw(e,t){return Or(e.prev,e,e.next)<0?Or(e,t,e.next)>=0&&Or(e,e.prev,t)>=0:Or(e,t,e.prev)<0||Or(e,e.next,t)<0}function CUe(e,t){let i=e,r=!1;const n=(e.x+t.x)/2,s=(e.y+t.y)/2;do i.y>s!=i.next.y>s&&i.next.y!==i.y&&n<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next;while(i!==e);return r}function Xee(e,t){const i=new Gz(e.i,e.x,e.y),r=new Gz(t.i,t.x,t.y),n=e.next,s=t.prev;return e.next=t,t.prev=e,i.next=n,n.prev=i,r.next=i,i.prev=r,s.next=r,r.prev=s,r}function n9(e,t,i,r){const n=new Gz(e,t,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function gw(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Gz(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function TUe(e,t,i,r){let n=0;for(let s=t,a=i-r;s<i;s+=r)n+=(e[a]-e[s])*(e[s+1]+e[a+1]),a=s;return n}class jc{static area(t){const i=t.length;let r=0;for(let n=i-1,s=0;s<i;n=s++)r+=t[n].x*t[s].y-t[s].x*t[n].y;return r*.5}static isClockWise(t){return jc.area(t)<0}static triangulateShape(t,i){const r=[],n=[],s=[];s9(t),a9(r,t);let a=t.length;i.forEach(s9);for(let l=0;l<i.length;l++)n.push(a),a+=i[l].length,a9(r,i[l]);const o=dUe.triangulate(r,n);for(let l=0;l<o.length;l+=3)s.push(o.slice(l,l+3));return s}}function s9(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function a9(e,t){for(let i=0;i<t.length;i++)e.push(t[i].x),e.push(t[i].y)}class v2 extends wi{constructor(t=new Lf([new ot(.5,.5),new ot(-.5,.5),new ot(-.5,-.5),new ot(.5,-.5)]),i={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:i},t=Array.isArray(t)?t:[t];const r=this,n=[],s=[];for(let o=0,l=t.length;o<l;o++){const c=t[o];a(c)}this.setAttribute("position",new kt(n,3)),this.setAttribute("uv",new kt(s,2)),this.computeVertexNormals();function a(o){const l=[],c=i.curveSegments!==void 0?i.curveSegments:12,u=i.steps!==void 0?i.steps:1,h=i.depth!==void 0?i.depth:1;let d=i.bevelEnabled!==void 0?i.bevelEnabled:!0,p=i.bevelThickness!==void 0?i.bevelThickness:.2,f=i.bevelSize!==void 0?i.bevelSize:p-.1,v=i.bevelOffset!==void 0?i.bevelOffset:0,g=i.bevelSegments!==void 0?i.bevelSegments:3;const m=i.extrudePath,x=i.UVGenerator!==void 0?i.UVGenerator:PUe;let w,_=!1,M,S,A,T;m&&(w=m.getSpacedPoints(u),_=!0,d=!1,M=m.computeFrenetFrames(u,!1),S=new oe,A=new oe,T=new oe),d||(g=0,p=0,f=0,v=0);const E=o.extractPoints(c);let C=E.shape;const D=E.holes;if(!jc.isClockWise(C)){C=C.reverse();for(let X=0,ge=D.length;X<ge;X++){const Oe=D[X];jc.isClockWise(Oe)&&(D[X]=Oe.reverse())}}const L=jc.triangulateShape(C,D),z=C;for(let X=0,ge=D.length;X<ge;X++){const Oe=D[X];C=C.concat(Oe)}function F(X,ge,Oe){return ge||console.error("THREE.ExtrudeGeometry: vec does not exist"),X.clone().addScaledVector(ge,Oe)}const Q=C.length,Y=L.length;function O(X,ge,Oe){let Ie,Pe,Ye;const ke=X.x-ge.x,Fe=X.y-ge.y,se=Oe.x-X.x,Z=Oe.y-X.y,K=ke*ke+Fe*Fe,k=ke*Z-Fe*se;if(Math.abs(k)>Number.EPSILON){const re=Math.sqrt(K),he=Math.sqrt(se*se+Z*Z),G=ge.x-Fe/re,Te=ge.y+ke/re,ze=Oe.x-Z/he,Qe=Oe.y+se/he,ye=((ze-G)*Z-(Qe-Te)*se)/(ke*Z-Fe*se);Ie=G+ke*ye-X.x,Pe=Te+Fe*ye-X.y;const je=Ie*Ie+Pe*Pe;if(je<=2)return new ot(Ie,Pe);Ye=Math.sqrt(je/2)}else{let re=!1;ke>Number.EPSILON?se>Number.EPSILON&&(re=!0):ke<-Number.EPSILON?se<-Number.EPSILON&&(re=!0):Math.sign(Fe)===Math.sign(Z)&&(re=!0),re?(Ie=-Fe,Pe=ke,Ye=Math.sqrt(K)):(Ie=ke,Pe=Fe,Ye=Math.sqrt(K/2))}return new ot(Ie/Ye,Pe/Ye)}const j=[];for(let X=0,ge=z.length,Oe=ge-1,Ie=X+1;X<ge;X++,Oe++,Ie++)Oe===ge&&(Oe=0),Ie===ge&&(Ie=0),j[X]=O(z[X],z[Oe],z[Ie]);const V=[];let W,J=j.concat();for(let X=0,ge=D.length;X<ge;X++){const Oe=D[X];W=[];for(let Ie=0,Pe=Oe.length,Ye=Pe-1,ke=Ie+1;Ie<Pe;Ie++,Ye++,ke++)Ye===Pe&&(Ye=0),ke===Pe&&(ke=0),W[Ie]=O(Oe[Ie],Oe[Ye],Oe[ke]);V.push(W),J=J.concat(W)}for(let X=0;X<g;X++){const ge=X/g,Oe=p*Math.cos(ge*Math.PI/2),Ie=f*Math.sin(ge*Math.PI/2)+v;for(let Pe=0,Ye=z.length;Pe<Ye;Pe++){const ke=F(z[Pe],j[Pe],Ie);de(ke.x,ke.y,-Oe)}for(let Pe=0,Ye=D.length;Pe<Ye;Pe++){const ke=D[Pe];W=V[Pe];for(let Fe=0,se=ke.length;Fe<se;Fe++){const Z=F(ke[Fe],W[Fe],Ie);de(Z.x,Z.y,-Oe)}}}const ce=f+v;for(let X=0;X<Q;X++){const ge=d?F(C[X],J[X],ce):C[X];_?(A.copy(M.normals[0]).multiplyScalar(ge.x),S.copy(M.binormals[0]).multiplyScalar(ge.y),T.copy(w[0]).add(A).add(S),de(T.x,T.y,T.z)):de(ge.x,ge.y,0)}for(let X=1;X<=u;X++)for(let ge=0;ge<Q;ge++){const Oe=d?F(C[ge],J[ge],ce):C[ge];_?(A.copy(M.normals[X]).multiplyScalar(Oe.x),S.copy(M.binormals[X]).multiplyScalar(Oe.y),T.copy(w[X]).add(A).add(S),de(T.x,T.y,T.z)):de(Oe.x,Oe.y,h/u*X)}for(let X=g-1;X>=0;X--){const ge=X/g,Oe=p*Math.cos(ge*Math.PI/2),Ie=f*Math.sin(ge*Math.PI/2)+v;for(let Pe=0,Ye=z.length;Pe<Ye;Pe++){const ke=F(z[Pe],j[Pe],Ie);de(ke.x,ke.y,h+Oe)}for(let Pe=0,Ye=D.length;Pe<Ye;Pe++){const ke=D[Pe];W=V[Pe];for(let Fe=0,se=ke.length;Fe<se;Fe++){const Z=F(ke[Fe],W[Fe],Ie);_?de(Z.x,Z.y+w[u-1].y,w[u-1].x+Oe):de(Z.x,Z.y,h+Oe)}}}$(),ne();function $(){const X=n.length/3;if(d){let ge=0,Oe=Q*ge;for(let Ie=0;Ie<Y;Ie++){const Pe=L[Ie];be(Pe[2]+Oe,Pe[1]+Oe,Pe[0]+Oe)}ge=u+g*2,Oe=Q*ge;for(let Ie=0;Ie<Y;Ie++){const Pe=L[Ie];be(Pe[0]+Oe,Pe[1]+Oe,Pe[2]+Oe)}}else{for(let ge=0;ge<Y;ge++){const Oe=L[ge];be(Oe[2],Oe[1],Oe[0])}for(let ge=0;ge<Y;ge++){const Oe=L[ge];be(Oe[0]+Q*u,Oe[1]+Q*u,Oe[2]+Q*u)}}r.addGroup(X,n.length/3-X,0)}function ne(){const X=n.length/3;let ge=0;ie(z,ge),ge+=z.length;for(let Oe=0,Ie=D.length;Oe<Ie;Oe++){const Pe=D[Oe];ie(Pe,ge),ge+=Pe.length}r.addGroup(X,n.length/3-X,1)}function ie(X,ge){let Oe=X.length;for(;--Oe>=0;){const Ie=Oe;let Pe=Oe-1;Pe<0&&(Pe=X.length-1);for(let Ye=0,ke=u+g*2;Ye<ke;Ye++){const Fe=Q*Ye,se=Q*(Ye+1),Z=ge+Ie+Fe,K=ge+Pe+Fe,k=ge+Pe+se,re=ge+Ie+se;we(Z,K,k,re)}}}function de(X,ge,Oe){l.push(X),l.push(ge),l.push(Oe)}function be(X,ge,Oe){_e(X),_e(ge),_e(Oe);const Ie=n.length/3,Pe=x.generateTopUV(r,n,Ie-3,Ie-2,Ie-1);Me(Pe[0]),Me(Pe[1]),Me(Pe[2])}function we(X,ge,Oe,Ie){_e(X),_e(ge),_e(Ie),_e(ge),_e(Oe),_e(Ie);const Pe=n.length/3,Ye=x.generateSideWallUV(r,n,Pe-6,Pe-3,Pe-2,Pe-1);Me(Ye[0]),Me(Ye[1]),Me(Ye[3]),Me(Ye[1]),Me(Ye[2]),Me(Ye[3])}function _e(X){n.push(l[X*3+0]),n.push(l[X*3+1]),n.push(l[X*3+2])}function Me(X){s.push(X.x),s.push(X.y)}}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON(),i=this.parameters.shapes,r=this.parameters.options;return DUe(i,r,t)}static fromJSON(t,i){const r=[];for(let s=0,a=t.shapes.length;s<a;s++){const o=i[t.shapes[s]];r.push(o)}const n=t.options.extrudePath;return n!==void 0&&(t.options.extrudePath=new QC[n.type]().fromJSON(n)),new v2(r,t.options)}}const PUe={generateTopUV:function(e,t,i,r,n){const s=t[i*3],a=t[i*3+1],o=t[r*3],l=t[r*3+1],c=t[n*3],u=t[n*3+1];return[new ot(s,a),new ot(o,l),new ot(c,u)]},generateSideWallUV:function(e,t,i,r,n,s){const a=t[i*3],o=t[i*3+1],l=t[i*3+2],c=t[r*3],u=t[r*3+1],h=t[r*3+2],d=t[n*3],p=t[n*3+1],f=t[n*3+2],v=t[s*3],g=t[s*3+1],m=t[s*3+2];return Math.abs(o-u)<Math.abs(a-c)?[new ot(a,1-l),new ot(c,1-h),new ot(d,1-f),new ot(v,1-m)]:[new ot(o,1-l),new ot(u,1-h),new ot(p,1-f),new ot(g,1-m)]}};function DUe(e,t,i){if(i.shapes=[],Array.isArray(e))for(let r=0,n=e.length;r<n;r++){const s=e[r];i.shapes.push(s.uuid)}else i.shapes.push(e.uuid);return i.options=Object.assign({},t),t.extrudePath!==void 0&&(i.options.extrudePath=t.extrudePath.toJSON()),i}class y2 extends op{constructor(t=1,i=0){const r=(1+Math.sqrt(5))/2,n=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(n,s,t,i),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:i}}static fromJSON(t){return new y2(t.radius,t.detail)}}class rb extends op{constructor(t=1,i=0){const r=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],n=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(r,n,t,i),this.type="OctahedronGeometry",this.parameters={radius:t,detail:i}}static fromJSON(t){return new rb(t.radius,t.detail)}}class x2 extends wi{constructor(t=.5,i=1,r=32,n=1,s=0,a=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:i,thetaSegments:r,phiSegments:n,thetaStart:s,thetaLength:a},r=Math.max(3,r),n=Math.max(1,n);const o=[],l=[],c=[],u=[];let h=t;const d=(i-t)/n,p=new oe,f=new ot;for(let v=0;v<=n;v++){for(let g=0;g<=r;g++){const m=s+g/r*a;p.x=h*Math.cos(m),p.y=h*Math.sin(m),l.push(p.x,p.y,p.z),c.push(0,0,1),f.x=(p.x/i+1)/2,f.y=(p.y/i+1)/2,u.push(f.x,f.y)}h+=d}for(let v=0;v<n;v++){const g=v*(r+1);for(let m=0;m<r;m++){const x=m+g,w=x,_=x+r+1,M=x+r+2,S=x+1;o.push(w,_,S),o.push(_,M,S)}}this.setIndex(o),this.setAttribute("position",new kt(l,3)),this.setAttribute("normal",new kt(c,3)),this.setAttribute("uv",new kt(u,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new x2(t.innerRadius,t.outerRadius,t.thetaSegments,t.phiSegments,t.thetaStart,t.thetaLength)}}class w2 extends wi{constructor(t=new Lf([new ot(0,.5),new ot(-.5,-.5),new ot(.5,-.5)]),i=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:i};const r=[],n=[],s=[],a=[];let o=0,l=0;if(Array.isArray(t)===!1)c(t);else for(let u=0;u<t.length;u++)c(t[u]),this.addGroup(o,l,u),o+=l,l=0;this.setIndex(r),this.setAttribute("position",new kt(n,3)),this.setAttribute("normal",new kt(s,3)),this.setAttribute("uv",new kt(a,2));function c(u){const h=n.length/3,d=u.extractPoints(i);let p=d.shape;const f=d.holes;jc.isClockWise(p)===!1&&(p=p.reverse());for(let g=0,m=f.length;g<m;g++){const x=f[g];jc.isClockWise(x)===!0&&(f[g]=x.reverse())}const v=jc.triangulateShape(p,f);for(let g=0,m=f.length;g<m;g++){const x=f[g];p=p.concat(x)}for(let g=0,m=p.length;g<m;g++){const x=p[g];n.push(x.x,x.y,0),s.push(0,0,1),a.push(x.x,x.y)}for(let g=0,m=v.length;g<m;g++){const x=v[g],w=x[0]+h,_=x[1]+h,M=x[2]+h;r.push(w,_,M),l+=3}}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON(),i=this.parameters.shapes;return RUe(i,t)}static fromJSON(t,i){const r=[];for(let n=0,s=t.shapes.length;n<s;n++){const a=i[t.shapes[n]];r.push(a)}return new w2(r,t.curveSegments)}}function RUe(e,t){if(t.shapes=[],Array.isArray(e))for(let i=0,r=e.length;i<r;i++){const n=e[i];t.shapes.push(n.uuid)}else t.shapes.push(e.uuid);return t}class nb extends wi{constructor(t=1,i=32,r=16,n=0,s=Math.PI*2,a=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:i,heightSegments:r,phiStart:n,phiLength:s,thetaStart:a,thetaLength:o},i=Math.max(3,Math.floor(i)),r=Math.max(2,Math.floor(r));const l=Math.min(a+o,Math.PI);let c=0;const u=[],h=new oe,d=new oe,p=[],f=[],v=[],g=[];for(let m=0;m<=r;m++){const x=[],w=m/r;let _=0;m===0&&a===0?_=.5/i:m===r&&l===Math.PI&&(_=-.5/i);for(let M=0;M<=i;M++){const S=M/i;h.x=-t*Math.cos(n+S*s)*Math.sin(a+w*o),h.y=t*Math.cos(a+w*o),h.z=t*Math.sin(n+S*s)*Math.sin(a+w*o),f.push(h.x,h.y,h.z),d.copy(h).normalize(),v.push(d.x,d.y,d.z),g.push(S+_,1-w),x.push(c++)}u.push(x)}for(let m=0;m<r;m++)for(let x=0;x<i;x++){const w=u[m][x+1],_=u[m][x],M=u[m+1][x],S=u[m+1][x+1];(m!==0||a>0)&&p.push(w,_,S),(m!==r-1||l<Math.PI)&&p.push(_,M,S)}this.setIndex(p),this.setAttribute("position",new kt(f,3)),this.setAttribute("normal",new kt(v,3)),this.setAttribute("uv",new kt(g,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new nb(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}}class b2 extends op{constructor(t=1,i=0){const r=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],n=[2,1,0,0,3,2,1,3,0,2,3,1];super(r,n,t,i),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:i}}static fromJSON(t){return new b2(t.radius,t.detail)}}class _2 extends wi{constructor(t=1,i=.4,r=12,n=48,s=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:t,tube:i,radialSegments:r,tubularSegments:n,arc:s},r=Math.floor(r),n=Math.floor(n);const a=[],o=[],l=[],c=[],u=new oe,h=new oe,d=new oe;for(let p=0;p<=r;p++)for(let f=0;f<=n;f++){const v=f/n*s,g=p/r*Math.PI*2;h.x=(t+i*Math.cos(g))*Math.cos(v),h.y=(t+i*Math.cos(g))*Math.sin(v),h.z=i*Math.sin(g),o.push(h.x,h.y,h.z),u.x=t*Math.cos(v),u.y=t*Math.sin(v),d.subVectors(h,u).normalize(),l.push(d.x,d.y,d.z),c.push(f/n),c.push(p/r)}for(let p=1;p<=r;p++)for(let f=1;f<=n;f++){const v=(n+1)*p+f-1,g=(n+1)*(p-1)+f-1,m=(n+1)*(p-1)+f,x=(n+1)*p+f;a.push(v,g,x),a.push(g,m,x)}this.setIndex(a),this.setAttribute("position",new kt(o,3)),this.setAttribute("normal",new kt(l,3)),this.setAttribute("uv",new kt(c,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new _2(t.radius,t.tube,t.radialSegments,t.tubularSegments,t.arc)}}class S2 extends wi{constructor(t=1,i=.4,r=64,n=8,s=2,a=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:i,tubularSegments:r,radialSegments:n,p:s,q:a},r=Math.floor(r),n=Math.floor(n);const o=[],l=[],c=[],u=[],h=new oe,d=new oe,p=new oe,f=new oe,v=new oe,g=new oe,m=new oe;for(let w=0;w<=r;++w){const _=w/r*s*Math.PI*2;x(_,s,a,t,p),x(_+.01,s,a,t,f),g.subVectors(f,p),m.addVectors(f,p),v.crossVectors(g,m),m.crossVectors(v,g),v.normalize(),m.normalize();for(let M=0;M<=n;++M){const S=M/n*Math.PI*2,A=-i*Math.cos(S),T=i*Math.sin(S);h.x=p.x+(A*m.x+T*v.x),h.y=p.y+(A*m.y+T*v.y),h.z=p.z+(A*m.z+T*v.z),l.push(h.x,h.y,h.z),d.subVectors(h,p).normalize(),c.push(d.x,d.y,d.z),u.push(w/r),u.push(M/n)}}for(let w=1;w<=r;w++)for(let _=1;_<=n;_++){const M=(n+1)*(w-1)+(_-1),S=(n+1)*w+(_-1),A=(n+1)*w+_,T=(n+1)*(w-1)+_;o.push(M,S,T),o.push(S,A,T)}this.setIndex(o),this.setAttribute("position",new kt(l,3)),this.setAttribute("normal",new kt(c,3)),this.setAttribute("uv",new kt(u,2));function x(w,_,M,S,A){const T=Math.cos(w),E=Math.sin(w),C=M/_*w,D=Math.cos(C);A.x=S*(2+D)*.5*T,A.y=S*(2+D)*E*.5,A.z=S*Math.sin(C)*.5}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new S2(t.radius,t.tube,t.tubularSegments,t.radialSegments,t.p,t.q)}}class M2 extends wi{constructor(t=new wU(new oe(-1,-1,0),new oe(-1,1,0),new oe(1,1,0)),i=64,r=1,n=8,s=!1){super(),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:i,radius:r,radialSegments:n,closed:s};const a=t.computeFrenetFrames(i,s);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;const o=new oe,l=new oe,c=new ot;let u=new oe;const h=[],d=[],p=[],f=[];v(),this.setIndex(f),this.setAttribute("position",new kt(h,3)),this.setAttribute("normal",new kt(d,3)),this.setAttribute("uv",new kt(p,2));function v(){for(let w=0;w<i;w++)g(w);g(s===!1?i:0),x(),m()}function g(w){u=t.getPointAt(w/i,u);const _=a.normals[w],M=a.binormals[w];for(let S=0;S<=n;S++){const A=S/n*Math.PI*2,T=Math.sin(A),E=-Math.cos(A);l.x=E*_.x+T*M.x,l.y=E*_.y+T*M.y,l.z=E*_.z+T*M.z,l.normalize(),d.push(l.x,l.y,l.z),o.x=u.x+r*l.x,o.y=u.y+r*l.y,o.z=u.z+r*l.z,h.push(o.x,o.y,o.z)}}function m(){for(let w=1;w<=i;w++)for(let _=1;_<=n;_++){const M=(n+1)*(w-1)+(_-1),S=(n+1)*w+(_-1),A=(n+1)*w+_,T=(n+1)*(w-1)+_;f.push(M,S,T),f.push(S,A,T)}}function x(){for(let w=0;w<=i;w++)for(let _=0;_<=n;_++)c.x=w/i,c.y=_/n,p.push(c.x,c.y)}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON();return t.path=this.parameters.path.toJSON(),t}static fromJSON(t){return new M2(new QC[t.path.type]().fromJSON(t.path),t.tubularSegments,t.radius,t.radialSegments,t.closed)}}class qee extends wi{constructor(t=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:t},t!==null){const i=[],r=new Set,n=new oe,s=new oe;if(t.index!==null){const a=t.attributes.position,o=t.index;let l=t.groups;l.length===0&&(l=[{start:0,count:o.count,materialIndex:0}]);for(let c=0,u=l.length;c<u;++c){const h=l[c],d=h.start,p=h.count;for(let f=d,v=d+p;f<v;f+=3)for(let g=0;g<3;g++){const m=o.getX(f+g),x=o.getX(f+(g+1)%3);n.fromBufferAttribute(a,m),s.fromBufferAttribute(a,x),o9(n,s,r)===!0&&(i.push(n.x,n.y,n.z),i.push(s.x,s.y,s.z))}}}else{const a=t.attributes.position;for(let o=0,l=a.count/3;o<l;o++)for(let c=0;c<3;c++){const u=3*o+c,h=3*o+(c+1)%3;n.fromBufferAttribute(a,u),s.fromBufferAttribute(a,h),o9(n,s,r)===!0&&(i.push(n.x,n.y,n.z),i.push(s.x,s.y,s.z))}}this.setAttribute("position",new kt(i,3))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}}function o9(e,t,i){const r=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`,n=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`;return i.has(r)===!0||i.has(n)===!0?!1:(i.add(r),i.add(n),!0)}var l9=Object.freeze({__proto__:null,BoxGeometry:lm,CapsuleGeometry:d2,CircleGeometry:p2,ConeGeometry:f2,CylinderGeometry:H0,DodecahedronGeometry:m2,EdgesGeometry:Gee,ExtrudeGeometry:v2,IcosahedronGeometry:y2,LatheGeometry:ib,OctahedronGeometry:rb,PlaneGeometry:F0,PolyhedronGeometry:op,RingGeometry:x2,ShapeGeometry:w2,SphereGeometry:nb,TetrahedronGeometry:b2,TorusGeometry:_2,TorusKnotGeometry:S2,TubeGeometry:M2,WireframeGeometry:qee});class Yee extends Ts{constructor(t){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Rt(0),this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.fog=t.fog,this}}class Qee extends Xl{constructor(t){super(t),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class _U extends Ts{constructor(t){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Rt(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Rt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=sp,this.normalScale=new ot(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new yo,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class Kee extends _U{constructor(t){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new ot(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Qr(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(i){this.ior=(1+.4*i)/(1-.4*i)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Rt(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Rt(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Rt(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(t)}get anisotropy(){return this._anisotropy}set anisotropy(t){this._anisotropy>0!=t>0&&this.version++,this._anisotropy=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get iridescence(){return this._iridescence}set iridescence(t){this._iridescence>0!=t>0&&this.version++,this._iridescence=t}get dispersion(){return this._dispersion}set dispersion(t){this._dispersion>0!=t>0&&this.version++,this._dispersion=t}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=t.anisotropy,this.anisotropyRotation=t.anisotropyRotation,this.anisotropyMap=t.anisotropyMap,this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.dispersion=t.dispersion,this.ior=t.ior,this.iridescence=t.iridescence,this.iridescenceMap=t.iridescenceMap,this.iridescenceIOR=t.iridescenceIOR,this.iridescenceThicknessRange=[...t.iridescenceThicknessRange],this.iridescenceThicknessMap=t.iridescenceThicknessMap,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}class Zee extends Ts{constructor(t){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Rt(16777215),this.specular=new Rt(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Rt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=sp,this.normalScale=new ot(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new yo,this.combine=Kw,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class $ee extends Ts{constructor(t){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Rt(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Rt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=sp,this.normalScale=new ot(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}class Jee extends Ts{constructor(t){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=sp,this.normalScale=new ot(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}}class ete extends Ts{constructor(t){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Rt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Rt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=sp,this.normalScale=new ot(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new yo,this.combine=Kw,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class tte extends Ts{constructor(t){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Rt(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=sp,this.normalScale=new ot(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.flatShading=t.flatShading,this.fog=t.fog,this}}class ite extends Ma{constructor(t){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}function yf(e,t,i){return!e||!i&&e.constructor===t?e:typeof t.BYTES_PER_ELEMENT=="number"?new t(e):Array.prototype.slice.call(e)}function rte(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function nte(e){function t(n,s){return e[n]-e[s]}const i=e.length,r=new Array(i);for(let n=0;n!==i;++n)r[n]=n;return r.sort(t),r}function jz(e,t,i){const r=e.length,n=new e.constructor(r);for(let s=0,a=0;a!==r;++s){const o=i[s]*t;for(let l=0;l!==t;++l)n[a++]=e[o+l]}return n}function SU(e,t,i,r){let n=1,s=e[0];for(;s!==void 0&&s[r]===void 0;)s=e[n++];if(s===void 0)return;let a=s[r];if(a!==void 0)if(Array.isArray(a))do a=s[r],a!==void 0&&(t.push(s.time),i.push.apply(i,a)),s=e[n++];while(s!==void 0);else if(a.toArray!==void 0)do a=s[r],a!==void 0&&(t.push(s.time),a.toArray(i,i.length)),s=e[n++];while(s!==void 0);else do a=s[r],a!==void 0&&(t.push(s.time),i.push(a)),s=e[n++];while(s!==void 0)}function IUe(e,t,i,r,n=30){const s=e.clone();s.name=t;const a=[];for(let l=0;l<s.tracks.length;++l){const c=s.tracks[l],u=c.getValueSize(),h=[],d=[];for(let p=0;p<c.times.length;++p){const f=c.times[p]*n;if(!(f<i||f>=r)){h.push(c.times[p]);for(let v=0;v<u;++v)d.push(c.values[p*u+v])}}h.length!==0&&(c.times=yf(h,c.times.constructor),c.values=yf(d,c.values.constructor),a.push(c))}s.tracks=a;let o=1/0;for(let l=0;l<s.tracks.length;++l)o>s.tracks[l].times[0]&&(o=s.tracks[l].times[0]);for(let l=0;l<s.tracks.length;++l)s.tracks[l].shift(-1*o);return s.resetDuration(),s}function LUe(e,t=0,i=e,r=30){r<=0&&(r=30);const n=i.tracks.length,s=t/r;for(let a=0;a<n;++a){const o=i.tracks[a],l=o.ValueTypeName;if(l==="bool"||l==="string")continue;const c=e.tracks.find(function(m){return m.name===o.name&&m.ValueTypeName===l});if(c===void 0)continue;let u=0;const h=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(u=h/3);let d=0;const p=c.getValueSize();c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(d=p/3);const f=o.times.length-1;let v;if(s<=o.times[0]){const m=u,x=h-u;v=o.values.slice(m,x)}else if(s>=o.times[f]){const m=f*h+u,x=m+h-u;v=o.values.slice(m,x)}else{const m=o.createInterpolant(),x=u,w=h-u;m.evaluate(s),v=m.resultBuffer.slice(x,w)}l==="quaternion"&&new Ks().fromArray(v).normalize().conjugate().toArray(v);const g=c.times.length;for(let m=0;m<g;++m){const x=m*p+d;if(l==="quaternion")Ks.multiplyQuaternionsFlat(c.values,x,v,0,c.values,x);else{const w=p-d*2;for(let _=0;_<w;++_)c.values[x+_]-=v[_]}}}return e.blendMode=rU,e}const OUe={convertArray:yf,isTypedArray:rte,getKeyframeOrder:nte,sortedArray:jz,flattenJSON:SU,subclip:IUe,makeClipAdditive:LUe};class sb{constructor(t,i,r,n){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=n!==void 0?n:new i.constructor(r),this.sampleValues=i,this.valueSize=r,this.settings=null,this.DefaultSettings_={}}evaluate(t){const i=this.parameterPositions;let r=this._cachedIndex,n=i[r],s=i[r-1];e:{t:{let a;i:{r:if(!(t<n)){for(let o=r+2;;){if(n===void 0){if(t<s)break r;return r=i.length,this._cachedIndex=r,this.copySampleValue_(r-1)}if(r===o)break;if(s=n,n=i[++r],t<n)break t}a=i.length;break i}if(!(t>=s)){const o=i[1];t<o&&(r=2,s=o);for(let l=r-2;;){if(s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===l)break;if(n=s,s=i[--r-1],t>=s)break t}a=r,r=0;break i}break e}for(;r<a;){const o=r+a>>>1;t<i[o]?a=o:r=o+1}if(n=i[r],s=i[r-1],s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(n===void 0)return r=i.length,this._cachedIndex=r,this.copySampleValue_(r-1)}this._cachedIndex=r,this.intervalChanged_(r,s,n)}return this.interpolate_(r,s,t,n)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const i=this.resultBuffer,r=this.sampleValues,n=this.valueSize,s=t*n;for(let a=0;a!==n;++a)i[a]=r[s+a];return i}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class ste extends sb{constructor(t,i,r,n){super(t,i,r,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:mf,endingEnd:mf}}intervalChanged_(t,i,r){const n=this.parameterPositions;let s=t-2,a=t+1,o=n[s],l=n[a];if(o===void 0)switch(this.getSettings_().endingStart){case gf:s=t,o=2*i-r;break;case aw:s=n.length-2,o=i+n[s]-n[s+1];break;default:s=t,o=r}if(l===void 0)switch(this.getSettings_().endingEnd){case gf:a=t,l=2*r-i;break;case aw:a=1,l=r+n[1]-n[0];break;default:a=t-1,l=i}const c=(r-i)*.5,u=this.valueSize;this._weightPrev=c/(i-o),this._weightNext=c/(l-r),this._offsetPrev=s*u,this._offsetNext=a*u}interpolate_(t,i,r,n){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=t*o,c=l-o,u=this._offsetPrev,h=this._offsetNext,d=this._weightPrev,p=this._weightNext,f=(r-i)/(n-i),v=f*f,g=v*f,m=-d*g+2*d*v-d*f,x=(1+d)*g+(-1.5-2*d)*v+(-.5+d)*f+1,w=(-1-p)*g+(1.5+p)*v+.5*f,_=p*g-p*v;for(let M=0;M!==o;++M)s[M]=m*a[u+M]+x*a[c+M]+w*a[l+M]+_*a[h+M];return s}}class MU extends sb{constructor(t,i,r,n){super(t,i,r,n)}interpolate_(t,i,r,n){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=t*o,c=l-o,u=(r-i)/(n-i),h=1-u;for(let d=0;d!==o;++d)s[d]=a[c+d]*h+a[l+d]*u;return s}}class ate extends sb{constructor(t,i,r,n){super(t,i,r,n)}interpolate_(t){return this.copySampleValue_(t-1)}}class Kl{constructor(t,i,r,n){if(t===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(i===void 0||i.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=yf(i,this.TimeBufferType),this.values=yf(r,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}static toJSON(t){const i=t.constructor;let r;if(i.toJSON!==this.toJSON)r=i.toJSON(t);else{r={name:t.name,times:yf(t.times,Array),values:yf(t.values,Array)};const n=t.getInterpolation();n!==t.DefaultInterpolation&&(r.interpolation=n)}return r.type=t.ValueTypeName,r}InterpolantFactoryMethodDiscrete(t){return new ate(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new MU(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new ste(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let i;switch(t){case sw:i=this.InterpolantFactoryMethodDiscrete;break;case WC:i=this.InterpolantFactoryMethodLinear;break;case PE:i=this.InterpolantFactoryMethodSmooth;break}if(i===void 0){const r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(t!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(r);return console.warn("THREE.KeyframeTrack:",r),this}return this.createInterpolant=i,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return sw;case this.InterpolantFactoryMethodLinear:return WC;case this.InterpolantFactoryMethodSmooth:return PE}}getValueSize(){return this.values.length/this.times.length}shift(t){if(t!==0){const i=this.times;for(let r=0,n=i.length;r!==n;++r)i[r]+=t}return this}scale(t){if(t!==1){const i=this.times;for(let r=0,n=i.length;r!==n;++r)i[r]*=t}return this}trim(t,i){const r=this.times,n=r.length;let s=0,a=n-1;for(;s!==n&&r[s]<t;)++s;for(;a!==-1&&r[a]>i;)--a;if(++a,s!==0||a!==n){s>=a&&(a=Math.max(a,1),s=a-1);const o=this.getValueSize();this.times=r.slice(s,a),this.values=this.values.slice(s*o,a*o)}return this}validate(){let t=!0;const i=this.getValueSize();i-Math.floor(i)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const r=this.times,n=this.values,s=r.length;s===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let a=null;for(let o=0;o!==s;o++){const l=r[o];if(typeof l=="number"&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,l),t=!1;break}if(a!==null&&a>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,l,a),t=!1;break}a=l}if(n!==void 0&&rte(n))for(let o=0,l=n.length;o!==l;++o){const c=n[o];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,c),t=!1;break}}return t}optimize(){const t=this.times.slice(),i=this.values.slice(),r=this.getValueSize(),n=this.getInterpolation()===PE,s=t.length-1;let a=1;for(let o=1;o<s;++o){let l=!1;const c=t[o],u=t[o+1];if(c!==u&&(o!==1||c!==t[0]))if(n)l=!0;else{const h=o*r,d=h-r,p=h+r;for(let f=0;f!==r;++f){const v=i[h+f];if(v!==i[d+f]||v!==i[p+f]){l=!0;break}}}if(l){if(o!==a){t[a]=t[o];const h=o*r,d=a*r;for(let p=0;p!==r;++p)i[d+p]=i[h+p]}++a}}if(s>0){t[a]=t[s];for(let o=s*r,l=a*r,c=0;c!==r;++c)i[l+c]=i[o+c];++a}return a!==t.length?(this.times=t.slice(0,a),this.values=i.slice(0,a*r)):(this.times=t,this.values=i),this}clone(){const t=this.times.slice(),i=this.values.slice(),r=this.constructor,n=new r(this.name,t,i);return n.createInterpolant=this.createInterpolant,n}}Kl.prototype.TimeBufferType=Float32Array;Kl.prototype.ValueBufferType=Float32Array;Kl.prototype.DefaultInterpolation=WC;class cm extends Kl{constructor(t,i,r){super(t,i,r)}}cm.prototype.ValueTypeName="bool";cm.prototype.ValueBufferType=Array;cm.prototype.DefaultInterpolation=sw;cm.prototype.InterpolantFactoryMethodLinear=void 0;cm.prototype.InterpolantFactoryMethodSmooth=void 0;class EU extends Kl{}EU.prototype.ValueTypeName="color";class vw extends Kl{}vw.prototype.ValueTypeName="number";class ote extends sb{constructor(t,i,r,n){super(t,i,r,n)}interpolate_(t,i,r,n){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=(r-i)/(n-i);let c=t*o;for(let u=c+o;c!==u;c+=4)Ks.slerpFlat(s,0,a,c-o,a,c,l);return s}}class ab extends Kl{InterpolantFactoryMethodLinear(t){return new ote(this.times,this.values,this.getValueSize(),t)}}ab.prototype.ValueTypeName="quaternion";ab.prototype.InterpolantFactoryMethodSmooth=void 0;class um extends Kl{constructor(t,i,r){super(t,i,r)}}um.prototype.ValueTypeName="string";um.prototype.ValueBufferType=Array;um.prototype.DefaultInterpolation=sw;um.prototype.InterpolantFactoryMethodLinear=void 0;um.prototype.InterpolantFactoryMethodSmooth=void 0;class yw extends Kl{}yw.prototype.ValueTypeName="vector";class xw{constructor(t="",i=-1,r=[],n=i2){this.name=t,this.tracks=r,this.duration=i,this.blendMode=n,this.uuid=po(),this.duration<0&&this.resetDuration()}static parse(t){const i=[],r=t.tracks,n=1/(t.fps||1);for(let a=0,o=r.length;a!==o;++a)i.push(NUe(r[a]).scale(n));const s=new this(t.name,t.duration,i,t.blendMode);return s.uuid=t.uuid,s}static toJSON(t){const i=[],r=t.tracks,n={name:t.name,duration:t.duration,tracks:i,uuid:t.uuid,blendMode:t.blendMode};for(let s=0,a=r.length;s!==a;++s)i.push(Kl.toJSON(r[s]));return n}static CreateFromMorphTargetSequence(t,i,r,n){const s=i.length,a=[];for(let o=0;o<s;o++){let l=[],c=[];l.push((o+s-1)%s,o,(o+1)%s),c.push(0,1,0);const u=nte(l);l=jz(l,1,u),c=jz(c,1,u),!n&&l[0]===0&&(l.push(s),c.push(c[0])),a.push(new vw(".morphTargetInfluences["+i[o].name+"]",l,c).scale(1/r))}return new this(t,-1,a)}static findByName(t,i){let r=t;if(!Array.isArray(t)){const n=t;r=n.geometry&&n.geometry.animations||n.animations}for(let n=0;n<r.length;n++)if(r[n].name===i)return r[n];return null}static CreateClipsFromMorphTargetSequences(t,i,r){const n={},s=/^([\w-]*?)([\d]+)$/;for(let o=0,l=t.length;o<l;o++){const c=t[o],u=c.name.match(s);if(u&&u.length>1){const h=u[1];let d=n[h];d||(n[h]=d=[]),d.push(c)}}const a=[];for(const o in n)a.push(this.CreateFromMorphTargetSequence(o,n[o],i,r));return a}static parseAnimation(t,i){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const r=function(h,d,p,f,v){if(p.length!==0){const g=[],m=[];SU(p,g,m,f),g.length!==0&&v.push(new h(d,g,m))}},n=[],s=t.name||"default",a=t.fps||30,o=t.blendMode;let l=t.length||-1;const c=t.hierarchy||[];for(let h=0;h<c.length;h++){const d=c[h].keys;if(!(!d||d.length===0))if(d[0].morphTargets){const p={};let f;for(f=0;f<d.length;f++)if(d[f].morphTargets)for(let v=0;v<d[f].morphTargets.length;v++)p[d[f].morphTargets[v]]=-1;for(const v in p){const g=[],m=[];for(let x=0;x!==d[f].morphTargets.length;++x){const w=d[f];g.push(w.time),m.push(w.morphTarget===v?1:0)}n.push(new vw(".morphTargetInfluence["+v+"]",g,m))}l=p.length*a}else{const p=".bones["+i[h].name+"]";r(yw,p+".position",d,"pos",n),r(ab,p+".quaternion",d,"rot",n),r(yw,p+".scale",d,"scl",n)}}return n.length===0?null:new this(s,l,n,o)}resetDuration(){const t=this.tracks;let i=0;for(let r=0,n=t.length;r!==n;++r){const s=this.tracks[r];i=Math.max(i,s.times[s.times.length-1])}return this.duration=i,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let i=0;i<this.tracks.length;i++)t=t&&this.tracks[i].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let i=0;i<this.tracks.length;i++)t.push(this.tracks[i].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function zUe(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return vw;case"vector":case"vector2":case"vector3":case"vector4":return yw;case"color":return EU;case"quaternion":return ab;case"bool":case"boolean":return cm;case"string":return um}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}function NUe(e){if(e.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=zUe(e.type);if(e.times===void 0){const i=[],r=[];SU(e.keys,i,r,"value"),e.times=i,e.values=r}return t.parse!==void 0?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}const Ju={enabled:!1,files:{},add:function(e,t){this.enabled!==!1&&(this.files[e]=t)},get:function(e){if(this.enabled!==!1)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class AU{constructor(t,i,r){const n=this;let s=!1,a=0,o=0,l;const c=[];this.onStart=void 0,this.onLoad=t,this.onProgress=i,this.onError=r,this.itemStart=function(u){o++,s===!1&&n.onStart!==void 0&&n.onStart(u,a,o),s=!0},this.itemEnd=function(u){a++,n.onProgress!==void 0&&n.onProgress(u,a,o),a===o&&(s=!1,n.onLoad!==void 0&&n.onLoad())},this.itemError=function(u){n.onError!==void 0&&n.onError(u)},this.resolveURL=function(u){return l?l(u):u},this.setURLModifier=function(u){return l=u,this},this.addHandler=function(u,h){return c.push(u,h),this},this.removeHandler=function(u){const h=c.indexOf(u);return h!==-1&&c.splice(h,2),this},this.getHandler=function(u){for(let h=0,d=c.length;h<d;h+=2){const p=c[h],f=c[h+1];if(p.global&&(p.lastIndex=0),p.test(u))return f}return null}}}const lte=new AU;class Ya{constructor(t){this.manager=t!==void 0?t:lte,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,i){const r=this;return new Promise(function(n,s){r.load(t,n,i,s)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}Ya.DEFAULT_MATERIAL_NAME="__DEFAULT";const Mu={};class BUe extends Error{constructor(t,i){super(t),this.response=i}}class xh extends Ya{constructor(t){super(t)}load(t,i,r,n){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const s=Ju.get(t);if(s!==void 0)return this.manager.itemStart(t),setTimeout(()=>{i&&i(s),this.manager.itemEnd(t)},0),s;if(Mu[t]!==void 0){Mu[t].push({onLoad:i,onProgress:r,onError:n});return}Mu[t]=[],Mu[t].push({onLoad:i,onProgress:r,onError:n});const a=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),o=this.mimeType,l=this.responseType;fetch(a).then(c=>{if(c.status===200||c.status===0){if(c.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||c.body===void 0||c.body.getReader===void 0)return c;const u=Mu[t],h=c.body.getReader(),d=c.headers.get("X-File-Size")||c.headers.get("Content-Length"),p=d?parseInt(d):0,f=p!==0;let v=0;const g=new ReadableStream({start(m){x();function x(){h.read().then(({done:w,value:_})=>{if(w)m.close();else{v+=_.byteLength;const M=new ProgressEvent("progress",{lengthComputable:f,loaded:v,total:p});for(let S=0,A=u.length;S<A;S++){const T=u[S];T.onProgress&&T.onProgress(M)}m.enqueue(_),x()}},w=>{m.error(w)})}}});return new Response(g)}else throw new BUe(`fetch for "${c.url}" responded with ${c.status}: ${c.statusText}`,c)}).then(c=>{switch(l){case"arraybuffer":return c.arrayBuffer();case"blob":return c.blob();case"document":return c.text().then(u=>new DOMParser().parseFromString(u,o));case"json":return c.json();default:if(o===void 0)return c.text();{const h=/charset="?([^;"\s]*)"?/i.exec(o),d=h&&h[1]?h[1].toLowerCase():void 0,p=new TextDecoder(d);return c.arrayBuffer().then(f=>p.decode(f))}}}).then(c=>{Ju.add(t,c);const u=Mu[t];delete Mu[t];for(let h=0,d=u.length;h<d;h++){const p=u[h];p.onLoad&&p.onLoad(c)}}).catch(c=>{const u=Mu[t];if(u===void 0)throw this.manager.itemError(t),c;delete Mu[t];for(let h=0,d=u.length;h<d;h++){const p=u[h];p.onError&&p.onError(c)}this.manager.itemError(t)}).finally(()=>{this.manager.itemEnd(t)}),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}class kUe extends Ya{constructor(t){super(t)}load(t,i,r,n){const s=this,a=new xh(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,function(o){try{i(s.parse(JSON.parse(o)))}catch(l){n?n(l):console.error(l),s.manager.itemError(t)}},r,n)}parse(t){const i=[];for(let r=0;r<t.length;r++){const n=xw.parse(t[r]);i.push(n)}return i}}class UUe extends Ya{constructor(t){super(t)}load(t,i,r,n){const s=this,a=[],o=new u2,l=new xh(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(s.withCredentials);let c=0;function u(h){l.load(t[h],function(d){const p=s.parse(d,!0);a[h]={width:p.width,height:p.height,format:p.format,mipmaps:p.mipmaps},c+=1,c===6&&(p.mipmapCount===1&&(o.minFilter=_n),o.image=a,o.format=p.format,o.needsUpdate=!0,i&&i(o))},r,n)}if(Array.isArray(t))for(let h=0,d=t.length;h<d;++h)u(h);else l.load(t,function(h){const d=s.parse(h,!0);if(d.isCubemap){const p=d.mipmaps.length/d.mipmapCount;for(let f=0;f<p;f++){a[f]={mipmaps:[]};for(let v=0;v<d.mipmapCount;v++)a[f].mipmaps.push(d.mipmaps[f*d.mipmapCount+v]),a[f].format=d.format,a[f].width=d.width,a[f].height=d.height}o.image=a}else o.image.width=d.width,o.image.height=d.height,o.mipmaps=d.mipmaps;d.mipmapCount===1&&(o.minFilter=_n),o.format=d.format,o.needsUpdate=!0,i&&i(o)},r,n);return o}}class ww extends Ya{constructor(t){super(t)}load(t,i,r,n){this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const s=this,a=Ju.get(t);if(a!==void 0)return s.manager.itemStart(t),setTimeout(function(){i&&i(a),s.manager.itemEnd(t)},0),a;const o=dw("img");function l(){u(),Ju.add(t,this),i&&i(this),s.manager.itemEnd(t)}function c(h){u(),n&&n(h),s.manager.itemError(t),s.manager.itemEnd(t)}function u(){o.removeEventListener("load",l,!1),o.removeEventListener("error",c,!1)}return o.addEventListener("load",l,!1),o.addEventListener("error",c,!1),t.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(o.crossOrigin=this.crossOrigin),s.manager.itemStart(t),o.src=t,o}}class FUe extends Ya{constructor(t){super(t)}load(t,i,r,n){const s=new eb;s.colorSpace=Vo;const a=new ww(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);let o=0;function l(c){a.load(t[c],function(u){s.images[c]=u,o++,o===6&&(s.needsUpdate=!0,i&&i(s))},void 0,n)}for(let c=0;c<t.length;++c)l(c);return s}}class VUe extends Ya{constructor(t){super(t)}load(t,i,r,n){const s=this,a=new Gc,o=new xh(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(s.withCredentials),o.load(t,function(l){let c;try{c=s.parse(l)}catch(u){if(n!==void 0)n(u);else{console.error(u);return}}c.image!==void 0?a.image=c.image:c.data!==void 0&&(a.image.width=c.width,a.image.height=c.height,a.image.data=c.data),a.wrapS=c.wrapS!==void 0?c.wrapS:Qo,a.wrapT=c.wrapT!==void 0?c.wrapT:Qo,a.magFilter=c.magFilter!==void 0?c.magFilter:_n,a.minFilter=c.minFilter!==void 0?c.minFilter:_n,a.anisotropy=c.anisotropy!==void 0?c.anisotropy:1,c.colorSpace!==void 0&&(a.colorSpace=c.colorSpace),c.flipY!==void 0&&(a.flipY=c.flipY),c.format!==void 0&&(a.format=c.format),c.type!==void 0&&(a.type=c.type),c.mipmaps!==void 0&&(a.mipmaps=c.mipmaps,a.minFilter=Lc),c.mipmapCount===1&&(a.minFilter=_n),c.generateMipmaps!==void 0&&(a.generateMipmaps=c.generateMipmaps),a.needsUpdate=!0,i&&i(a,c)},r,n),a}}class HUe extends Ya{constructor(t){super(t)}load(t,i,r,n){const s=new kr,a=new ww(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(t,function(o){s.image=o,s.needsUpdate=!0,i!==void 0&&i(s)},r,n),s}}class lp extends ki{constructor(t,i=1){super(),this.isLight=!0,this.type="Light",this.color=new Rt(t),this.intensity=i}dispose(){}copy(t,i){return super.copy(t,i),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const i=super.toJSON(t);return i.object.color=this.color.getHex(),i.object.intensity=this.intensity,this.groundColor!==void 0&&(i.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(i.object.distance=this.distance),this.angle!==void 0&&(i.object.angle=this.angle),this.decay!==void 0&&(i.object.decay=this.decay),this.penumbra!==void 0&&(i.object.penumbra=this.penumbra),this.shadow!==void 0&&(i.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(i.object.target=this.target.uuid),i}}class cte extends lp{constructor(t,i,r){super(t,r),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(ki.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Rt(i)}copy(t,i){return super.copy(t,i),this.groundColor.copy(t.groundColor),this}}const cI=new ii,c9=new oe,u9=new oe;class CU{constructor(t){this.camera=t,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new ot(512,512),this.map=null,this.mapPass=null,this.matrix=new ii,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new tb,this._frameExtents=new ot(1,1),this._viewportCount=1,this._viewports=[new tr(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const i=this.camera,r=this.matrix;c9.setFromMatrixPosition(t.matrixWorld),i.position.copy(c9),u9.setFromMatrixPosition(t.target.matrixWorld),i.lookAt(u9),i.updateMatrixWorld(),cI.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(cI),r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(cI)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.intensity=t.intensity,this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const t={};return this.intensity!==1&&(t.intensity=this.intensity),this.bias!==0&&(t.bias=this.bias),this.normalBias!==0&&(t.normalBias=this.normalBias),this.radius!==1&&(t.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class GUe extends CU{constructor(){super(new Kr(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(t){const i=this.camera,r=o0*2*t.angle*this.focus,n=this.mapSize.width/this.mapSize.height,s=t.distance||i.far;(r!==i.fov||n!==i.aspect||s!==i.far)&&(i.fov=r,i.aspect=n,i.far=s,i.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}class ute extends lp{constructor(t,i,r=0,n=Math.PI/3,s=0,a=2){super(t,i),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(ki.DEFAULT_UP),this.updateMatrix(),this.target=new ki,this.distance=r,this.angle=n,this.penumbra=s,this.decay=a,this.map=null,this.shadow=new GUe}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t,i){return super.copy(t,i),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}const h9=new ii,ox=new oe,uI=new oe;class jUe extends CU{constructor(){super(new Kr(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new ot(4,2),this._viewportCount=6,this._viewports=[new tr(2,1,1,1),new tr(0,1,1,1),new tr(3,1,1,1),new tr(1,1,1,1),new tr(3,0,1,1),new tr(1,0,1,1)],this._cubeDirections=[new oe(1,0,0),new oe(-1,0,0),new oe(0,0,1),new oe(0,0,-1),new oe(0,1,0),new oe(0,-1,0)],this._cubeUps=[new oe(0,1,0),new oe(0,1,0),new oe(0,1,0),new oe(0,1,0),new oe(0,0,1),new oe(0,0,-1)]}updateMatrices(t,i=0){const r=this.camera,n=this.matrix,s=t.distance||r.far;s!==r.far&&(r.far=s,r.updateProjectionMatrix()),ox.setFromMatrixPosition(t.matrixWorld),r.position.copy(ox),uI.copy(r.position),uI.add(this._cubeDirections[i]),r.up.copy(this._cubeUps[i]),r.lookAt(uI),r.updateMatrixWorld(),n.makeTranslation(-ox.x,-ox.y,-ox.z),h9.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),this._frustum.setFromProjectionMatrix(h9)}}class hte extends lp{constructor(t,i,r=0,n=2){super(t,i),this.isPointLight=!0,this.type="PointLight",this.distance=r,this.decay=n,this.shadow=new jUe}get power(){return this.intensity*4*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t,i){return super.copy(t,i),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}class WUe extends CU{constructor(){super(new $u(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class dte extends lp{constructor(t,i){super(t,i),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(ki.DEFAULT_UP),this.updateMatrix(),this.target=new ki,this.shadow=new WUe}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}class pte extends lp{constructor(t,i){super(t,i),this.isAmbientLight=!0,this.type="AmbientLight"}}class fte extends lp{constructor(t,i,r=10,n=10){super(t,i),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=r,this.height=n}get power(){return this.intensity*this.width*this.height*Math.PI}set power(t){this.intensity=t/(this.width*this.height*Math.PI)}copy(t){return super.copy(t),this.width=t.width,this.height=t.height,this}toJSON(t){const i=super.toJSON(t);return i.object.width=this.width,i.object.height=this.height,i}}class mte{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new oe)}set(t){for(let i=0;i<9;i++)this.coefficients[i].copy(t[i]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,i){const r=t.x,n=t.y,s=t.z,a=this.coefficients;return i.copy(a[0]).multiplyScalar(.282095),i.addScaledVector(a[1],.488603*n),i.addScaledVector(a[2],.488603*s),i.addScaledVector(a[3],.488603*r),i.addScaledVector(a[4],1.092548*(r*n)),i.addScaledVector(a[5],1.092548*(n*s)),i.addScaledVector(a[6],.315392*(3*s*s-1)),i.addScaledVector(a[7],1.092548*(r*s)),i.addScaledVector(a[8],.546274*(r*r-n*n)),i}getIrradianceAt(t,i){const r=t.x,n=t.y,s=t.z,a=this.coefficients;return i.copy(a[0]).multiplyScalar(.886227),i.addScaledVector(a[1],2*.511664*n),i.addScaledVector(a[2],2*.511664*s),i.addScaledVector(a[3],2*.511664*r),i.addScaledVector(a[4],2*.429043*r*n),i.addScaledVector(a[5],2*.429043*n*s),i.addScaledVector(a[6],.743125*s*s-.247708),i.addScaledVector(a[7],2*.429043*r*s),i.addScaledVector(a[8],.429043*(r*r-n*n)),i}add(t){for(let i=0;i<9;i++)this.coefficients[i].add(t.coefficients[i]);return this}addScaledSH(t,i){for(let r=0;r<9;r++)this.coefficients[r].addScaledVector(t.coefficients[r],i);return this}scale(t){for(let i=0;i<9;i++)this.coefficients[i].multiplyScalar(t);return this}lerp(t,i){for(let r=0;r<9;r++)this.coefficients[r].lerp(t.coefficients[r],i);return this}equals(t){for(let i=0;i<9;i++)if(!this.coefficients[i].equals(t.coefficients[i]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(t,i=0){const r=this.coefficients;for(let n=0;n<9;n++)r[n].fromArray(t,i+n*3);return this}toArray(t=[],i=0){const r=this.coefficients;for(let n=0;n<9;n++)r[n].toArray(t,i+n*3);return t}static getBasisAt(t,i){const r=t.x,n=t.y,s=t.z;i[0]=.282095,i[1]=.488603*n,i[2]=.488603*s,i[3]=.488603*r,i[4]=1.092548*r*n,i[5]=1.092548*n*s,i[6]=.315392*(3*s*s-1),i[7]=1.092548*r*s,i[8]=.546274*(r*r-n*n)}}class gte extends lp{constructor(t=new mte,i=1){super(void 0,i),this.isLightProbe=!0,this.sh=t}copy(t){return super.copy(t),this.sh.copy(t.sh),this}fromJSON(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this}toJSON(t){const i=super.toJSON(t);return i.object.sh=this.sh.toArray(),i}}class E2 extends Ya{constructor(t){super(t),this.textures={}}load(t,i,r,n){const s=this,a=new xh(s.manager);a.setPath(s.path),a.setRequestHeader(s.requestHeader),a.setWithCredentials(s.withCredentials),a.load(t,function(o){try{i(s.parse(JSON.parse(o)))}catch(l){n?n(l):console.error(l),s.manager.itemError(t)}},r,n)}parse(t){const i=this.textures;function r(s){return i[s]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",s),i[s]}const n=E2.createMaterialFromType(t.type);if(t.uuid!==void 0&&(n.uuid=t.uuid),t.name!==void 0&&(n.name=t.name),t.color!==void 0&&n.color!==void 0&&n.color.setHex(t.color),t.roughness!==void 0&&(n.roughness=t.roughness),t.metalness!==void 0&&(n.metalness=t.metalness),t.sheen!==void 0&&(n.sheen=t.sheen),t.sheenColor!==void 0&&(n.sheenColor=new Rt().setHex(t.sheenColor)),t.sheenRoughness!==void 0&&(n.sheenRoughness=t.sheenRoughness),t.emissive!==void 0&&n.emissive!==void 0&&n.emissive.setHex(t.emissive),t.specular!==void 0&&n.specular!==void 0&&n.specular.setHex(t.specular),t.specularIntensity!==void 0&&(n.specularIntensity=t.specularIntensity),t.specularColor!==void 0&&n.specularColor!==void 0&&n.specularColor.setHex(t.specularColor),t.shininess!==void 0&&(n.shininess=t.shininess),t.clearcoat!==void 0&&(n.clearcoat=t.clearcoat),t.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=t.clearcoatRoughness),t.dispersion!==void 0&&(n.dispersion=t.dispersion),t.iridescence!==void 0&&(n.iridescence=t.iridescence),t.iridescenceIOR!==void 0&&(n.iridescenceIOR=t.iridescenceIOR),t.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=t.iridescenceThicknessRange),t.transmission!==void 0&&(n.transmission=t.transmission),t.thickness!==void 0&&(n.thickness=t.thickness),t.attenuationDistance!==void 0&&(n.attenuationDistance=t.attenuationDistance),t.attenuationColor!==void 0&&n.attenuationColor!==void 0&&n.attenuationColor.setHex(t.attenuationColor),t.anisotropy!==void 0&&(n.anisotropy=t.anisotropy),t.anisotropyRotation!==void 0&&(n.anisotropyRotation=t.anisotropyRotation),t.fog!==void 0&&(n.fog=t.fog),t.flatShading!==void 0&&(n.flatShading=t.flatShading),t.blending!==void 0&&(n.blending=t.blending),t.combine!==void 0&&(n.combine=t.combine),t.side!==void 0&&(n.side=t.side),t.shadowSide!==void 0&&(n.shadowSide=t.shadowSide),t.opacity!==void 0&&(n.opacity=t.opacity),t.transparent!==void 0&&(n.transparent=t.transparent),t.alphaTest!==void 0&&(n.alphaTest=t.alphaTest),t.alphaHash!==void 0&&(n.alphaHash=t.alphaHash),t.depthFunc!==void 0&&(n.depthFunc=t.depthFunc),t.depthTest!==void 0&&(n.depthTest=t.depthTest),t.depthWrite!==void 0&&(n.depthWrite=t.depthWrite),t.colorWrite!==void 0&&(n.colorWrite=t.colorWrite),t.blendSrc!==void 0&&(n.blendSrc=t.blendSrc),t.blendDst!==void 0&&(n.blendDst=t.blendDst),t.blendEquation!==void 0&&(n.blendEquation=t.blendEquation),t.blendSrcAlpha!==void 0&&(n.blendSrcAlpha=t.blendSrcAlpha),t.blendDstAlpha!==void 0&&(n.blendDstAlpha=t.blendDstAlpha),t.blendEquationAlpha!==void 0&&(n.blendEquationAlpha=t.blendEquationAlpha),t.blendColor!==void 0&&n.blendColor!==void 0&&n.blendColor.setHex(t.blendColor),t.blendAlpha!==void 0&&(n.blendAlpha=t.blendAlpha),t.stencilWriteMask!==void 0&&(n.stencilWriteMask=t.stencilWriteMask),t.stencilFunc!==void 0&&(n.stencilFunc=t.stencilFunc),t.stencilRef!==void 0&&(n.stencilRef=t.stencilRef),t.stencilFuncMask!==void 0&&(n.stencilFuncMask=t.stencilFuncMask),t.stencilFail!==void 0&&(n.stencilFail=t.stencilFail),t.stencilZFail!==void 0&&(n.stencilZFail=t.stencilZFail),t.stencilZPass!==void 0&&(n.stencilZPass=t.stencilZPass),t.stencilWrite!==void 0&&(n.stencilWrite=t.stencilWrite),t.wireframe!==void 0&&(n.wireframe=t.wireframe),t.wireframeLinewidth!==void 0&&(n.wireframeLinewidth=t.wireframeLinewidth),t.wireframeLinecap!==void 0&&(n.wireframeLinecap=t.wireframeLinecap),t.wireframeLinejoin!==void 0&&(n.wireframeLinejoin=t.wireframeLinejoin),t.rotation!==void 0&&(n.rotation=t.rotation),t.linewidth!==void 0&&(n.linewidth=t.linewidth),t.dashSize!==void 0&&(n.dashSize=t.dashSize),t.gapSize!==void 0&&(n.gapSize=t.gapSize),t.scale!==void 0&&(n.scale=t.scale),t.polygonOffset!==void 0&&(n.polygonOffset=t.polygonOffset),t.polygonOffsetFactor!==void 0&&(n.polygonOffsetFactor=t.polygonOffsetFactor),t.polygonOffsetUnits!==void 0&&(n.polygonOffsetUnits=t.polygonOffsetUnits),t.dithering!==void 0&&(n.dithering=t.dithering),t.alphaToCoverage!==void 0&&(n.alphaToCoverage=t.alphaToCoverage),t.premultipliedAlpha!==void 0&&(n.premultipliedAlpha=t.premultipliedAlpha),t.forceSinglePass!==void 0&&(n.forceSinglePass=t.forceSinglePass),t.visible!==void 0&&(n.visible=t.visible),t.toneMapped!==void 0&&(n.toneMapped=t.toneMapped),t.userData!==void 0&&(n.userData=t.userData),t.vertexColors!==void 0&&(typeof t.vertexColors=="number"?n.vertexColors=t.vertexColors>0:n.vertexColors=t.vertexColors),t.uniforms!==void 0)for(const s in t.uniforms){const a=t.uniforms[s];switch(n.uniforms[s]={},a.type){case"t":n.uniforms[s].value=r(a.value);break;case"c":n.uniforms[s].value=new Rt().setHex(a.value);break;case"v2":n.uniforms[s].value=new ot().fromArray(a.value);break;case"v3":n.uniforms[s].value=new oe().fromArray(a.value);break;case"v4":n.uniforms[s].value=new tr().fromArray(a.value);break;case"m3":n.uniforms[s].value=new vi().fromArray(a.value);break;case"m4":n.uniforms[s].value=new ii().fromArray(a.value);break;default:n.uniforms[s].value=a.value}}if(t.defines!==void 0&&(n.defines=t.defines),t.vertexShader!==void 0&&(n.vertexShader=t.vertexShader),t.fragmentShader!==void 0&&(n.fragmentShader=t.fragmentShader),t.glslVersion!==void 0&&(n.glslVersion=t.glslVersion),t.extensions!==void 0)for(const s in t.extensions)n.extensions[s]=t.extensions[s];if(t.lights!==void 0&&(n.lights=t.lights),t.clipping!==void 0&&(n.clipping=t.clipping),t.size!==void 0&&(n.size=t.size),t.sizeAttenuation!==void 0&&(n.sizeAttenuation=t.sizeAttenuation),t.map!==void 0&&(n.map=r(t.map)),t.matcap!==void 0&&(n.matcap=r(t.matcap)),t.alphaMap!==void 0&&(n.alphaMap=r(t.alphaMap)),t.bumpMap!==void 0&&(n.bumpMap=r(t.bumpMap)),t.bumpScale!==void 0&&(n.bumpScale=t.bumpScale),t.normalMap!==void 0&&(n.normalMap=r(t.normalMap)),t.normalMapType!==void 0&&(n.normalMapType=t.normalMapType),t.normalScale!==void 0){let s=t.normalScale;Array.isArray(s)===!1&&(s=[s,s]),n.normalScale=new ot().fromArray(s)}return t.displacementMap!==void 0&&(n.displacementMap=r(t.displacementMap)),t.displacementScale!==void 0&&(n.displacementScale=t.displacementScale),t.displacementBias!==void 0&&(n.displacementBias=t.displacementBias),t.roughnessMap!==void 0&&(n.roughnessMap=r(t.roughnessMap)),t.metalnessMap!==void 0&&(n.metalnessMap=r(t.metalnessMap)),t.emissiveMap!==void 0&&(n.emissiveMap=r(t.emissiveMap)),t.emissiveIntensity!==void 0&&(n.emissiveIntensity=t.emissiveIntensity),t.specularMap!==void 0&&(n.specularMap=r(t.specularMap)),t.specularIntensityMap!==void 0&&(n.specularIntensityMap=r(t.specularIntensityMap)),t.specularColorMap!==void 0&&(n.specularColorMap=r(t.specularColorMap)),t.envMap!==void 0&&(n.envMap=r(t.envMap)),t.envMapRotation!==void 0&&n.envMapRotation.fromArray(t.envMapRotation),t.envMapIntensity!==void 0&&(n.envMapIntensity=t.envMapIntensity),t.reflectivity!==void 0&&(n.reflectivity=t.reflectivity),t.refractionRatio!==void 0&&(n.refractionRatio=t.refractionRatio),t.lightMap!==void 0&&(n.lightMap=r(t.lightMap)),t.lightMapIntensity!==void 0&&(n.lightMapIntensity=t.lightMapIntensity),t.aoMap!==void 0&&(n.aoMap=r(t.aoMap)),t.aoMapIntensity!==void 0&&(n.aoMapIntensity=t.aoMapIntensity),t.gradientMap!==void 0&&(n.gradientMap=r(t.gradientMap)),t.clearcoatMap!==void 0&&(n.clearcoatMap=r(t.clearcoatMap)),t.clearcoatRoughnessMap!==void 0&&(n.clearcoatRoughnessMap=r(t.clearcoatRoughnessMap)),t.clearcoatNormalMap!==void 0&&(n.clearcoatNormalMap=r(t.clearcoatNormalMap)),t.clearcoatNormalScale!==void 0&&(n.clearcoatNormalScale=new ot().fromArray(t.clearcoatNormalScale)),t.iridescenceMap!==void 0&&(n.iridescenceMap=r(t.iridescenceMap)),t.iridescenceThicknessMap!==void 0&&(n.iridescenceThicknessMap=r(t.iridescenceThicknessMap)),t.transmissionMap!==void 0&&(n.transmissionMap=r(t.transmissionMap)),t.thicknessMap!==void 0&&(n.thicknessMap=r(t.thicknessMap)),t.anisotropyMap!==void 0&&(n.anisotropyMap=r(t.anisotropyMap)),t.sheenColorMap!==void 0&&(n.sheenColorMap=r(t.sheenColorMap)),t.sheenRoughnessMap!==void 0&&(n.sheenRoughnessMap=r(t.sheenRoughnessMap)),n}setTextures(t){return this.textures=t,this}static createMaterialFromType(t){const i={ShadowMaterial:Yee,SpriteMaterial:pU,RawShaderMaterial:Qee,ShaderMaterial:Xl,PointsMaterial:mU,MeshPhysicalMaterial:Kee,MeshStandardMaterial:_U,MeshPhongMaterial:Zee,MeshToonMaterial:$ee,MeshNormalMaterial:Jee,MeshLambertMaterial:ete,MeshDepthMaterial:hU,MeshDistanceMaterial:dU,MeshBasicMaterial:ap,MeshMatcapMaterial:tte,LineDashedMaterial:ite,LineBasicMaterial:Ma,Material:Ts};return new i[t]}}class Wz{static decodeText(t){if(console.warn("THREE.LoaderUtils: decodeText() has been deprecated with r165 and will be removed with r175. Use TextDecoder instead."),typeof TextDecoder<"u")return new TextDecoder().decode(t);let i="";for(let r=0,n=t.length;r<n;r++)i+=String.fromCharCode(t[r]);try{return decodeURIComponent(escape(i))}catch{return i}}static extractUrlBase(t){const i=t.lastIndexOf("/");return i===-1?"./":t.slice(0,i+1)}static resolveURL(t,i){return typeof t!="string"||t===""?"":(/^https?:\/\//i.test(i)&&/^\//.test(t)&&(i=i.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:i+t)}}class vte extends wi{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(t){return super.copy(t),this.instanceCount=t.instanceCount,this}toJSON(){const t=super.toJSON();return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}class yte extends Ya{constructor(t){super(t)}load(t,i,r,n){const s=this,a=new xh(s.manager);a.setPath(s.path),a.setRequestHeader(s.requestHeader),a.setWithCredentials(s.withCredentials),a.load(t,function(o){try{i(s.parse(JSON.parse(o)))}catch(l){n?n(l):console.error(l),s.manager.itemError(t)}},r,n)}parse(t){const i={},r={};function n(p,f){if(i[f]!==void 0)return i[f];const g=p.interleavedBuffers[f],m=s(p,g.buffer),x=cv(g.type,m),w=new l2(x,g.stride);return w.uuid=g.uuid,i[f]=w,w}function s(p,f){if(r[f]!==void 0)return r[f];const g=p.arrayBuffers[f],m=new Uint32Array(g).buffer;return r[f]=m,m}const a=t.isInstancedBufferGeometry?new vte:new wi,o=t.data.index;if(o!==void 0){const p=cv(o.type,o.array);a.setIndex(new dr(p,1))}const l=t.data.attributes;for(const p in l){const f=l[p];let v;if(f.isInterleavedBufferAttribute){const g=n(t.data,f.data);v=new Kf(g,f.itemSize,f.offset,f.normalized)}else{const g=cv(f.type,f.array),m=f.isInstancedBufferAttribute?c0:dr;v=new m(g,f.itemSize,f.normalized)}f.name!==void 0&&(v.name=f.name),f.usage!==void 0&&v.setUsage(f.usage),a.setAttribute(p,v)}const c=t.data.morphAttributes;if(c)for(const p in c){const f=c[p],v=[];for(let g=0,m=f.length;g<m;g++){const x=f[g];let w;if(x.isInterleavedBufferAttribute){const _=n(t.data,x.data);w=new Kf(_,x.itemSize,x.offset,x.normalized)}else{const _=cv(x.type,x.array);w=new dr(_,x.itemSize,x.normalized)}x.name!==void 0&&(w.name=x.name),v.push(w)}a.morphAttributes[p]=v}t.data.morphTargetsRelative&&(a.morphTargetsRelative=!0);const h=t.data.groups||t.data.drawcalls||t.data.offsets;if(h!==void 0)for(let p=0,f=h.length;p!==f;++p){const v=h[p];a.addGroup(v.start,v.count,v.materialIndex)}const d=t.data.boundingSphere;if(d!==void 0){const p=new oe;d.center!==void 0&&p.fromArray(d.center),a.boundingSphere=new Zs(p,d.radius)}return t.name&&(a.name=t.name),t.userData&&(a.userData=t.userData),a}}class XUe extends Ya{constructor(t){super(t)}load(t,i,r,n){const s=this,a=this.path===""?Wz.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||a;const o=new xh(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,function(l){let c=null;try{c=JSON.parse(l)}catch(h){n!==void 0&&n(h),console.error("THREE:ObjectLoader: Can't parse "+t+".",h.message);return}const u=c.metadata;if(u===void 0||u.type===void 0||u.type.toLowerCase()==="geometry"){n!==void 0&&n(new Error("THREE.ObjectLoader: Can't load "+t)),console.error("THREE.ObjectLoader: Can't load "+t);return}s.parse(c,i)},r,n)}async loadAsync(t,i){const r=this,n=this.path===""?Wz.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||n;const s=new xh(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials);const a=await s.loadAsync(t,i),o=JSON.parse(a),l=o.metadata;if(l===void 0||l.type===void 0||l.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+t);return await r.parseAsync(o)}parse(t,i){const r=this.parseAnimations(t.animations),n=this.parseShapes(t.shapes),s=this.parseGeometries(t.geometries,n),a=this.parseImages(t.images,function(){i!==void 0&&i(c)}),o=this.parseTextures(t.textures,a),l=this.parseMaterials(t.materials,o),c=this.parseObject(t.object,s,l,o,r),u=this.parseSkeletons(t.skeletons,c);if(this.bindSkeletons(c,u),this.bindLightTargets(c),i!==void 0){let h=!1;for(const d in a)if(a[d].data instanceof HTMLImageElement){h=!0;break}h===!1&&i(c)}return c}async parseAsync(t){const i=this.parseAnimations(t.animations),r=this.parseShapes(t.shapes),n=this.parseGeometries(t.geometries,r),s=await this.parseImagesAsync(t.images),a=this.parseTextures(t.textures,s),o=this.parseMaterials(t.materials,a),l=this.parseObject(t.object,n,o,a,i),c=this.parseSkeletons(t.skeletons,l);return this.bindSkeletons(l,c),this.bindLightTargets(l),l}parseShapes(t){const i={};if(t!==void 0)for(let r=0,n=t.length;r<n;r++){const s=new Lf().fromJSON(t[r]);i[s.uuid]=s}return i}parseSkeletons(t,i){const r={},n={};if(i.traverse(function(s){s.isBone&&(n[s.uuid]=s)}),t!==void 0)for(let s=0,a=t.length;s<a;s++){const o=new c2().fromJSON(t[s],n);r[o.uuid]=o}return r}parseGeometries(t,i){const r={};if(t!==void 0){const n=new yte;for(let s=0,a=t.length;s<a;s++){let o;const l=t[s];switch(l.type){case"BufferGeometry":case"InstancedBufferGeometry":o=n.parse(l);break;default:l.type in l9?o=l9[l.type].fromJSON(l,i):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${l.type}"`)}o.uuid=l.uuid,l.name!==void 0&&(o.name=l.name),l.userData!==void 0&&(o.userData=l.userData),r[l.uuid]=o}}return r}parseMaterials(t,i){const r={},n={};if(t!==void 0){const s=new E2;s.setTextures(i);for(let a=0,o=t.length;a<o;a++){const l=t[a];r[l.uuid]===void 0&&(r[l.uuid]=s.parse(l)),n[l.uuid]=r[l.uuid]}}return n}parseAnimations(t){const i={};if(t!==void 0)for(let r=0;r<t.length;r++){const n=t[r],s=xw.parse(n);i[s.uuid]=s}return i}parseImages(t,i){const r=this,n={};let s;function a(l){return r.manager.itemStart(l),s.load(l,function(){r.manager.itemEnd(l)},void 0,function(){r.manager.itemError(l),r.manager.itemEnd(l)})}function o(l){if(typeof l=="string"){const c=l,u=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(c)?c:r.resourcePath+c;return a(u)}else return l.data?{data:cv(l.type,l.data),width:l.width,height:l.height}:null}if(t!==void 0&&t.length>0){const l=new AU(i);s=new ww(l),s.setCrossOrigin(this.crossOrigin);for(let c=0,u=t.length;c<u;c++){const h=t[c],d=h.url;if(Array.isArray(d)){const p=[];for(let f=0,v=d.length;f<v;f++){const g=d[f],m=o(g);m!==null&&(m instanceof HTMLImageElement?p.push(m):p.push(new Gc(m.data,m.width,m.height)))}n[h.uuid]=new vf(p)}else{const p=o(h.url);n[h.uuid]=new vf(p)}}}return n}async parseImagesAsync(t){const i=this,r={};let n;async function s(a){if(typeof a=="string"){const o=a,l=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(o)?o:i.resourcePath+o;return await n.loadAsync(l)}else return a.data?{data:cv(a.type,a.data),width:a.width,height:a.height}:null}if(t!==void 0&&t.length>0){n=new ww(this.manager),n.setCrossOrigin(this.crossOrigin);for(let a=0,o=t.length;a<o;a++){const l=t[a],c=l.url;if(Array.isArray(c)){const u=[];for(let h=0,d=c.length;h<d;h++){const p=c[h],f=await s(p);f!==null&&(f instanceof HTMLImageElement?u.push(f):u.push(new Gc(f.data,f.width,f.height)))}r[l.uuid]=new vf(u)}else{const u=await s(l.url);r[l.uuid]=new vf(u)}}}return r}parseTextures(t,i){function r(s,a){return typeof s=="number"?s:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",s),a[s])}const n={};if(t!==void 0)for(let s=0,a=t.length;s<a;s++){const o=t[s];o.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',o.uuid),i[o.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",o.image);const l=i[o.image],c=l.data;let u;Array.isArray(c)?(u=new eb,c.length===6&&(u.needsUpdate=!0)):(c&&c.data?u=new Gc:u=new kr,c&&(u.needsUpdate=!0)),u.source=l,u.uuid=o.uuid,o.name!==void 0&&(u.name=o.name),o.mapping!==void 0&&(u.mapping=r(o.mapping,qUe)),o.channel!==void 0&&(u.channel=o.channel),o.offset!==void 0&&u.offset.fromArray(o.offset),o.repeat!==void 0&&u.repeat.fromArray(o.repeat),o.center!==void 0&&u.center.fromArray(o.center),o.rotation!==void 0&&(u.rotation=o.rotation),o.wrap!==void 0&&(u.wrapS=r(o.wrap[0],d9),u.wrapT=r(o.wrap[1],d9)),o.format!==void 0&&(u.format=o.format),o.internalFormat!==void 0&&(u.internalFormat=o.internalFormat),o.type!==void 0&&(u.type=o.type),o.colorSpace!==void 0&&(u.colorSpace=o.colorSpace),o.minFilter!==void 0&&(u.minFilter=r(o.minFilter,p9)),o.magFilter!==void 0&&(u.magFilter=r(o.magFilter,p9)),o.anisotropy!==void 0&&(u.anisotropy=o.anisotropy),o.flipY!==void 0&&(u.flipY=o.flipY),o.generateMipmaps!==void 0&&(u.generateMipmaps=o.generateMipmaps),o.premultiplyAlpha!==void 0&&(u.premultiplyAlpha=o.premultiplyAlpha),o.unpackAlignment!==void 0&&(u.unpackAlignment=o.unpackAlignment),o.compareFunction!==void 0&&(u.compareFunction=o.compareFunction),o.userData!==void 0&&(u.userData=o.userData),n[o.uuid]=u}return n}parseObject(t,i,r,n,s){let a;function o(d){return i[d]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",d),i[d]}function l(d){if(d!==void 0){if(Array.isArray(d)){const p=[];for(let f=0,v=d.length;f<v;f++){const g=d[f];r[g]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",g),p.push(r[g])}return p}return r[d]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",d),r[d]}}function c(d){return n[d]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",d),n[d]}let u,h;switch(t.type){case"Scene":a=new XC,t.background!==void 0&&(Number.isInteger(t.background)?a.background=new Rt(t.background):a.background=c(t.background)),t.environment!==void 0&&(a.environment=c(t.environment)),t.fog!==void 0&&(t.fog.type==="Fog"?a.fog=new o2(t.fog.color,t.fog.near,t.fog.far):t.fog.type==="FogExp2"&&(a.fog=new a2(t.fog.color,t.fog.density)),t.fog.name!==""&&(a.fog.name=t.fog.name)),t.backgroundBlurriness!==void 0&&(a.backgroundBlurriness=t.backgroundBlurriness),t.backgroundIntensity!==void 0&&(a.backgroundIntensity=t.backgroundIntensity),t.backgroundRotation!==void 0&&a.backgroundRotation.fromArray(t.backgroundRotation),t.environmentIntensity!==void 0&&(a.environmentIntensity=t.environmentIntensity),t.environmentRotation!==void 0&&a.environmentRotation.fromArray(t.environmentRotation);break;case"PerspectiveCamera":a=new Kr(t.fov,t.aspect,t.near,t.far),t.focus!==void 0&&(a.focus=t.focus),t.zoom!==void 0&&(a.zoom=t.zoom),t.filmGauge!==void 0&&(a.filmGauge=t.filmGauge),t.filmOffset!==void 0&&(a.filmOffset=t.filmOffset),t.view!==void 0&&(a.view=Object.assign({},t.view));break;case"OrthographicCamera":a=new $u(t.left,t.right,t.top,t.bottom,t.near,t.far),t.zoom!==void 0&&(a.zoom=t.zoom),t.view!==void 0&&(a.view=Object.assign({},t.view));break;case"AmbientLight":a=new pte(t.color,t.intensity);break;case"DirectionalLight":a=new dte(t.color,t.intensity),a.target=t.target||"";break;case"PointLight":a=new hte(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":a=new fte(t.color,t.intensity,t.width,t.height);break;case"SpotLight":a=new ute(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay),a.target=t.target||"";break;case"HemisphereLight":a=new cte(t.color,t.groundColor,t.intensity);break;case"LightProbe":a=new gte().fromJSON(t);break;case"SkinnedMesh":u=o(t.geometry),h=l(t.material),a=new Lee(u,h),t.bindMode!==void 0&&(a.bindMode=t.bindMode),t.bindMatrix!==void 0&&a.bindMatrix.fromArray(t.bindMatrix),t.skeleton!==void 0&&(a.skeleton=t.skeleton);break;case"Mesh":u=o(t.geometry),h=l(t.material),a=new En(u,h);break;case"InstancedMesh":u=o(t.geometry),h=l(t.material);const d=t.count,p=t.instanceMatrix,f=t.instanceColor;a=new Oee(u,h,d),a.instanceMatrix=new c0(new Float32Array(p.array),16),f!==void 0&&(a.instanceColor=new c0(new Float32Array(f.array),f.itemSize));break;case"BatchedMesh":u=o(t.geometry),h=l(t.material),a=new zee(t.maxInstanceCount,t.maxVertexCount,t.maxIndexCount,h),a.geometry=u,a.perObjectFrustumCulled=t.perObjectFrustumCulled,a.sortObjects=t.sortObjects,a._drawRanges=t.drawRanges,a._reservedRanges=t.reservedRanges,a._visibility=t.visibility,a._active=t.active,a._bounds=t.bounds.map(v=>{const g=new ya;g.min.fromArray(v.boxMin),g.max.fromArray(v.boxMax);const m=new Zs;return m.radius=v.sphereRadius,m.center.fromArray(v.sphereCenter),{boxInitialized:v.boxInitialized,box:g,sphereInitialized:v.sphereInitialized,sphere:m}}),a._maxInstanceCount=t.maxInstanceCount,a._maxVertexCount=t.maxVertexCount,a._maxIndexCount=t.maxIndexCount,a._geometryInitialized=t.geometryInitialized,a._geometryCount=t.geometryCount,a._matricesTexture=c(t.matricesTexture.uuid),t.colorsTexture!==void 0&&(a._colorsTexture=c(t.colorsTexture.uuid));break;case"LOD":a=new Iee;break;case"Line":a=new Zd(o(t.geometry),l(t.material));break;case"LineLoop":a=new Nee(o(t.geometry),l(t.material));break;case"LineSegments":a=new Jc(o(t.geometry),l(t.material));break;case"PointCloud":case"Points":a=new Bee(o(t.geometry),l(t.material));break;case"Sprite":a=new Ree(l(t.material));break;case"Group":a=new hv;break;case"Bone":a=new fU;break;default:a=new ki}if(a.uuid=t.uuid,t.name!==void 0&&(a.name=t.name),t.matrix!==void 0?(a.matrix.fromArray(t.matrix),t.matrixAutoUpdate!==void 0&&(a.matrixAutoUpdate=t.matrixAutoUpdate),a.matrixAutoUpdate&&a.matrix.decompose(a.position,a.quaternion,a.scale)):(t.position!==void 0&&a.position.fromArray(t.position),t.rotation!==void 0&&a.rotation.fromArray(t.rotation),t.quaternion!==void 0&&a.quaternion.fromArray(t.quaternion),t.scale!==void 0&&a.scale.fromArray(t.scale)),t.up!==void 0&&a.up.fromArray(t.up),t.castShadow!==void 0&&(a.castShadow=t.castShadow),t.receiveShadow!==void 0&&(a.receiveShadow=t.receiveShadow),t.shadow&&(t.shadow.intensity!==void 0&&(a.shadow.intensity=t.shadow.intensity),t.shadow.bias!==void 0&&(a.shadow.bias=t.shadow.bias),t.shadow.normalBias!==void 0&&(a.shadow.normalBias=t.shadow.normalBias),t.shadow.radius!==void 0&&(a.shadow.radius=t.shadow.radius),t.shadow.mapSize!==void 0&&a.shadow.mapSize.fromArray(t.shadow.mapSize),t.shadow.camera!==void 0&&(a.shadow.camera=this.parseObject(t.shadow.camera))),t.visible!==void 0&&(a.visible=t.visible),t.frustumCulled!==void 0&&(a.frustumCulled=t.frustumCulled),t.renderOrder!==void 0&&(a.renderOrder=t.renderOrder),t.userData!==void 0&&(a.userData=t.userData),t.layers!==void 0&&(a.layers.mask=t.layers),t.children!==void 0){const d=t.children;for(let p=0;p<d.length;p++)a.add(this.parseObject(d[p],i,r,n,s))}if(t.animations!==void 0){const d=t.animations;for(let p=0;p<d.length;p++){const f=d[p];a.animations.push(s[f])}}if(t.type==="LOD"){t.autoUpdate!==void 0&&(a.autoUpdate=t.autoUpdate);const d=t.levels;for(let p=0;p<d.length;p++){const f=d[p],v=a.getObjectByProperty("uuid",f.object);v!==void 0&&a.addLevel(v,f.distance,f.hysteresis)}}return a}bindSkeletons(t,i){Object.keys(i).length!==0&&t.traverse(function(r){if(r.isSkinnedMesh===!0&&r.skeleton!==void 0){const n=i[r.skeleton];n===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",r.skeleton):r.bind(n,r.bindMatrix)}})}bindLightTargets(t){t.traverse(function(i){if(i.isDirectionalLight||i.isSpotLight){const r=i.target,n=t.getObjectByProperty("uuid",r);n!==void 0?i.target=n:i.target=new ki}})}}const qUe={UVMapping:QT,CubeReflectionMapping:vh,CubeRefractionMapping:Kd,EquirectangularReflectionMapping:tw,EquirectangularRefractionMapping:iw,CubeUVReflectionMapping:k0},d9={RepeatWrapping:rw,ClampToEdgeWrapping:Qo,MirroredRepeatWrapping:nw},p9={NearestFilter:os,NearestMipmapNearestFilter:qk,NearestMipmapLinearFilter:lv,LinearFilter:_n,LinearMipmapNearestFilter:i1,LinearMipmapLinearFilter:Lc};class YUe extends Ya{constructor(t){super(t),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(t){return this.options=t,this}load(t,i,r,n){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const s=this,a=Ju.get(t);if(a!==void 0){if(s.manager.itemStart(t),a.then){a.then(c=>{i&&i(c),s.manager.itemEnd(t)}).catch(c=>{n&&n(c)});return}return setTimeout(function(){i&&i(a),s.manager.itemEnd(t)},0),a}const o={};o.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",o.headers=this.requestHeader;const l=fetch(t,o).then(function(c){return c.blob()}).then(function(c){return createImageBitmap(c,Object.assign(s.options,{colorSpaceConversion:"none"}))}).then(function(c){return Ju.add(t,c),i&&i(c),s.manager.itemEnd(t),c}).catch(function(c){n&&n(c),Ju.remove(t),s.manager.itemError(t),s.manager.itemEnd(t)});Ju.add(t,l),s.manager.itemStart(t)}}let RM;class TU{static getContext(){return RM===void 0&&(RM=new(window.AudioContext||window.webkitAudioContext)),RM}static setContext(t){RM=t}}class QUe extends Ya{constructor(t){super(t)}load(t,i,r,n){const s=this,a=new xh(this.manager);a.setResponseType("arraybuffer"),a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,function(l){try{const c=l.slice(0);TU.getContext().decodeAudioData(c,function(h){i(h)}).catch(o)}catch(c){o(c)}},r,n);function o(l){n?n(l):console.error(l),s.manager.itemError(t)}}}const f9=new ii,m9=new ii,Op=new ii;class KUe{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Kr,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Kr,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(t){const i=this._cache;if(i.focus!==t.focus||i.fov!==t.fov||i.aspect!==t.aspect*this.aspect||i.near!==t.near||i.far!==t.far||i.zoom!==t.zoom||i.eyeSep!==this.eyeSep){i.focus=t.focus,i.fov=t.fov,i.aspect=t.aspect*this.aspect,i.near=t.near,i.far=t.far,i.zoom=t.zoom,i.eyeSep=this.eyeSep,Op.copy(t.projectionMatrix);const n=i.eyeSep/2,s=n*i.near/i.focus,a=i.near*Math.tan(Rf*i.fov*.5)/i.zoom;let o,l;m9.elements[12]=-n,f9.elements[12]=n,o=-a*i.aspect+s,l=a*i.aspect+s,Op.elements[0]=2*i.near/(l-o),Op.elements[8]=(l+o)/(l-o),this.cameraL.projectionMatrix.copy(Op),o=-a*i.aspect-s,l=a*i.aspect-s,Op.elements[0]=2*i.near/(l-o),Op.elements[8]=(l+o)/(l-o),this.cameraR.projectionMatrix.copy(Op)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(m9),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(f9)}}class PU{constructor(t=!0){this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=g9(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const i=g9();t=(i-this.oldTime)/1e3,this.oldTime=i,this.elapsedTime+=t}return t}}function g9(){return(typeof performance>"u"?Date:performance).now()}const zp=new oe,v9=new Ks,ZUe=new oe,Np=new oe;class $Ue extends ki{constructor(){super(),this.type="AudioListener",this.context=TU.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new PU}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(t){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}updateMatrixWorld(t){super.updateMatrixWorld(t);const i=this.context.listener,r=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(zp,v9,ZUe),Np.set(0,0,-1).applyQuaternion(v9),i.positionX){const n=this.context.currentTime+this.timeDelta;i.positionX.linearRampToValueAtTime(zp.x,n),i.positionY.linearRampToValueAtTime(zp.y,n),i.positionZ.linearRampToValueAtTime(zp.z,n),i.forwardX.linearRampToValueAtTime(Np.x,n),i.forwardY.linearRampToValueAtTime(Np.y,n),i.forwardZ.linearRampToValueAtTime(Np.z,n),i.upX.linearRampToValueAtTime(r.x,n),i.upY.linearRampToValueAtTime(r.y,n),i.upZ.linearRampToValueAtTime(r.z,n)}else i.setPosition(zp.x,zp.y,zp.z),i.setOrientation(Np.x,Np.y,Np.z,r.x,r.y,r.z)}}class xte extends ki{constructor(t){super(),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this}setMediaElementSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this}setMediaStreamSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this}setBuffer(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this}play(t=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+t;const i=this.context.createBufferSource();return i.buffer=this.buffer,i.loop=this.loop,i.loopStart=this.loopStart,i.loopEnd=this.loopEnd,i.onended=this.onEnded.bind(this),i.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=i,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,i=this.filters.length;t<i;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this._connected!==!1){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,i=this.filters.length;t<i;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(t){return t||(t=[]),this._connected===!0?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this}setDetune(t){return this.detune=t,this.isPlaying===!0&&this.source.detune!==void 0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(t){return this.setFilters(t?[t]:[])}setPlaybackRate(t){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=t,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(t){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=t,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(t){return this.loopStart=t,this}setLoopEnd(t){return this.loopEnd=t,this}getVolume(){return this.gain.gain.value}setVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}}const Bp=new oe,y9=new Ks,JUe=new oe,kp=new oe;class eFe extends xte{constructor(t){super(t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(t){return this.panner.refDistance=t,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(t){return this.panner.rolloffFactor=t,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(t){return this.panner.distanceModel=t,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(t){return this.panner.maxDistance=t,this}setDirectionalCone(t,i,r){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=i,this.panner.coneOuterGain=r,this}updateMatrixWorld(t){if(super.updateMatrixWorld(t),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(Bp,y9,JUe),kp.set(0,0,1).applyQuaternion(y9);const i=this.panner;if(i.positionX){const r=this.context.currentTime+this.listener.timeDelta;i.positionX.linearRampToValueAtTime(Bp.x,r),i.positionY.linearRampToValueAtTime(Bp.y,r),i.positionZ.linearRampToValueAtTime(Bp.z,r),i.orientationX.linearRampToValueAtTime(kp.x,r),i.orientationY.linearRampToValueAtTime(kp.y,r),i.orientationZ.linearRampToValueAtTime(kp.z,r)}else i.setPosition(Bp.x,Bp.y,Bp.z),i.setOrientation(kp.x,kp.y,kp.z)}}class tFe{constructor(t,i=2048){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=i,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let t=0;const i=this.getFrequencyData();for(let r=0;r<i.length;r++)t+=i[r];return t/i.length}}class wte{constructor(t,i,r){this.binding=t,this.valueSize=r;let n,s,a;switch(i){case"quaternion":n=this._slerp,s=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(r*6),this._workIndex=5;break;case"string":case"bool":n=this._select,s=this._select,a=this._setAdditiveIdentityOther,this.buffer=new Array(r*5);break;default:n=this._lerp,s=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(r*5)}this._mixBufferRegion=n,this._mixBufferRegionAdditive=s,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,i){const r=this.buffer,n=this.valueSize,s=t*n+n;let a=this.cumulativeWeight;if(a===0){for(let o=0;o!==n;++o)r[s+o]=r[o];a=i}else{a+=i;const o=i/a;this._mixBufferRegion(r,s,0,o,n)}this.cumulativeWeight=a}accumulateAdditive(t){const i=this.buffer,r=this.valueSize,n=r*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(i,n,0,t,r),this.cumulativeWeightAdditive+=t}apply(t){const i=this.valueSize,r=this.buffer,n=t*i+i,s=this.cumulativeWeight,a=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,s<1){const l=i*this._origIndex;this._mixBufferRegion(r,n,l,1-s,i)}a>0&&this._mixBufferRegionAdditive(r,n,this._addIndex*i,1,i);for(let l=i,c=i+i;l!==c;++l)if(r[l]!==r[l+i]){o.setValue(r,n);break}}saveOriginalState(){const t=this.binding,i=this.buffer,r=this.valueSize,n=r*this._origIndex;t.getValue(i,n);for(let s=r,a=n;s!==a;++s)i[s]=i[n+s%r];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const t=this.valueSize*3;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){const t=this._addIndex*this.valueSize,i=t+this.valueSize;for(let r=t;r<i;r++)this.buffer[r]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const t=this._origIndex*this.valueSize,i=this._addIndex*this.valueSize;for(let r=0;r<this.valueSize;r++)this.buffer[i+r]=this.buffer[t+r]}_select(t,i,r,n,s){if(n>=.5)for(let a=0;a!==s;++a)t[i+a]=t[r+a]}_slerp(t,i,r,n){Ks.slerpFlat(t,i,t,i,t,r,n)}_slerpAdditive(t,i,r,n,s){const a=this._workIndex*s;Ks.multiplyQuaternionsFlat(t,a,t,i,t,r),Ks.slerpFlat(t,i,t,i,t,a,n)}_lerp(t,i,r,n,s){const a=1-n;for(let o=0;o!==s;++o){const l=i+o;t[l]=t[l]*a+t[r+o]*n}}_lerpAdditive(t,i,r,n,s){for(let a=0;a!==s;++a){const o=i+a;t[o]=t[o]+t[r+a]*n}}}const DU="\\[\\]\\.:\\/",iFe=new RegExp("["+DU+"]","g"),RU="[^"+DU+"]",rFe="[^"+DU.replace("\\.","")+"]",nFe=/((?:WC+[\/:])*)/.source.replace("WC",RU),sFe=/(WCOD+)?/.source.replace("WCOD",rFe),aFe=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",RU),oFe=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",RU),lFe=new RegExp("^"+nFe+sFe+aFe+oFe+"$"),cFe=["material","materials","bones","map"];class uFe{constructor(t,i,r){const n=r||Ni.parseTrackName(i);this._targetGroup=t,this._bindings=t.subscribe_(i,n)}getValue(t,i){this.bind();const r=this._targetGroup.nCachedObjects_,n=this._bindings[r];n!==void 0&&n.getValue(t,i)}setValue(t,i){const r=this._bindings;for(let n=this._targetGroup.nCachedObjects_,s=r.length;n!==s;++n)r[n].setValue(t,i)}bind(){const t=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=t.length;i!==r;++i)t[i].bind()}unbind(){const t=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=t.length;i!==r;++i)t[i].unbind()}}class Ni{constructor(t,i,r){this.path=i,this.parsedPath=r||Ni.parseTrackName(i),this.node=Ni.findNode(t,this.parsedPath.nodeName),this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,i,r){return t&&t.isAnimationObjectGroup?new Ni.Composite(t,i,r):new Ni(t,i,r)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(iFe,"")}static parseTrackName(t){const i=lFe.exec(t);if(i===null)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const r={nodeName:i[2],objectName:i[3],objectIndex:i[4],propertyName:i[5],propertyIndex:i[6]},n=r.nodeName&&r.nodeName.lastIndexOf(".");if(n!==void 0&&n!==-1){const s=r.nodeName.substring(n+1);cFe.indexOf(s)!==-1&&(r.nodeName=r.nodeName.substring(0,n),r.objectName=s)}if(r.propertyName===null||r.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return r}static findNode(t,i){if(i===void 0||i===""||i==="."||i===-1||i===t.name||i===t.uuid)return t;if(t.skeleton){const r=t.skeleton.getBoneByName(i);if(r!==void 0)return r}if(t.children){const r=function(s){for(let a=0;a<s.length;a++){const o=s[a];if(o.name===i||o.uuid===i)return o;const l=r(o.children);if(l)return l}return null},n=r(t.children);if(n)return n}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,i){t[i]=this.targetObject[this.propertyName]}_getValue_array(t,i){const r=this.resolvedProperty;for(let n=0,s=r.length;n!==s;++n)t[i++]=r[n]}_getValue_arrayElement(t,i){t[i]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,i){this.resolvedProperty.toArray(t,i)}_setValue_direct(t,i){this.targetObject[this.propertyName]=t[i]}_setValue_direct_setNeedsUpdate(t,i){this.targetObject[this.propertyName]=t[i],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,i){this.targetObject[this.propertyName]=t[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,i){const r=this.resolvedProperty;for(let n=0,s=r.length;n!==s;++n)r[n]=t[i++]}_setValue_array_setNeedsUpdate(t,i){const r=this.resolvedProperty;for(let n=0,s=r.length;n!==s;++n)r[n]=t[i++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,i){const r=this.resolvedProperty;for(let n=0,s=r.length;n!==s;++n)r[n]=t[i++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,i){this.resolvedProperty[this.propertyIndex]=t[i]}_setValue_arrayElement_setNeedsUpdate(t,i){this.resolvedProperty[this.propertyIndex]=t[i],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,i){this.resolvedProperty[this.propertyIndex]=t[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,i){this.resolvedProperty.fromArray(t,i)}_setValue_fromArray_setNeedsUpdate(t,i){this.resolvedProperty.fromArray(t,i),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,i){this.resolvedProperty.fromArray(t,i),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,i){this.bind(),this.getValue(t,i)}_setValue_unbound(t,i){this.bind(),this.setValue(t,i)}bind(){let t=this.node;const i=this.parsedPath,r=i.objectName,n=i.propertyName;let s=i.propertyIndex;if(t||(t=Ni.findNode(this.rootNode,i.nodeName),this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(r){let c=i.objectIndex;switch(r){case"materials":if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}t=t.material.materials;break;case"bones":if(!t.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}t=t.skeleton.bones;for(let u=0;u<t.length;u++)if(t[u].name===c){c=u;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}t=t.material.map;break;default:if(t[r]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}t=t[r]}if(c!==void 0){if(t[c]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);return}t=t[c]}}const a=t[n];if(a===void 0){const c=i.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+n+" but it wasn't found.",t);return}let o=this.Versioning.None;this.targetObject=t,t.needsUpdate!==void 0?o=this.Versioning.NeedsUpdate:t.matrixWorldNeedsUpdate!==void 0&&(o=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(s!==void 0){if(n==="morphTargetInfluences"){if(!t.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!t.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}t.morphTargetDictionary[s]!==void 0&&(s=t.morphTargetDictionary[s])}l=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=s}else a.fromArray!==void 0&&a.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(l=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=n;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Ni.Composite=uFe;Ni.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};Ni.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};Ni.prototype.GetterByBindingType=[Ni.prototype._getValue_direct,Ni.prototype._getValue_array,Ni.prototype._getValue_arrayElement,Ni.prototype._getValue_toArray];Ni.prototype.SetterByBindingTypeAndVersioning=[[Ni.prototype._setValue_direct,Ni.prototype._setValue_direct_setNeedsUpdate,Ni.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Ni.prototype._setValue_array,Ni.prototype._setValue_array_setNeedsUpdate,Ni.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Ni.prototype._setValue_arrayElement,Ni.prototype._setValue_arrayElement_setNeedsUpdate,Ni.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Ni.prototype._setValue_fromArray,Ni.prototype._setValue_fromArray_setNeedsUpdate,Ni.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class hFe{constructor(){this.isAnimationObjectGroup=!0,this.uuid=po(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const t={};this._indicesByUUID=t;for(let r=0,n=arguments.length;r!==n;++r)t[arguments[r].uuid]=r;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const i=this;this.stats={objects:{get total(){return i._objects.length},get inUse(){return this.total-i.nCachedObjects_}},get bindingsPerObject(){return i._bindings.length}}}add(){const t=this._objects,i=this._indicesByUUID,r=this._paths,n=this._parsedPaths,s=this._bindings,a=s.length;let o,l=t.length,c=this.nCachedObjects_;for(let u=0,h=arguments.length;u!==h;++u){const d=arguments[u],p=d.uuid;let f=i[p];if(f===void 0){f=l++,i[p]=f,t.push(d);for(let v=0,g=a;v!==g;++v)s[v].push(new Ni(d,r[v],n[v]))}else if(f<c){o=t[f];const v=--c,g=t[v];i[g.uuid]=f,t[f]=g,i[p]=v,t[v]=d;for(let m=0,x=a;m!==x;++m){const w=s[m],_=w[v];let M=w[f];w[f]=_,M===void 0&&(M=new Ni(d,r[m],n[m])),w[v]=M}}else t[f]!==o&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=c}remove(){const t=this._objects,i=this._indicesByUUID,r=this._bindings,n=r.length;let s=this.nCachedObjects_;for(let a=0,o=arguments.length;a!==o;++a){const l=arguments[a],c=l.uuid,u=i[c];if(u!==void 0&&u>=s){const h=s++,d=t[h];i[d.uuid]=u,t[u]=d,i[c]=h,t[h]=l;for(let p=0,f=n;p!==f;++p){const v=r[p],g=v[h],m=v[u];v[u]=g,v[h]=m}}}this.nCachedObjects_=s}uncache(){const t=this._objects,i=this._indicesByUUID,r=this._bindings,n=r.length;let s=this.nCachedObjects_,a=t.length;for(let o=0,l=arguments.length;o!==l;++o){const c=arguments[o],u=c.uuid,h=i[u];if(h!==void 0)if(delete i[u],h<s){const d=--s,p=t[d],f=--a,v=t[f];i[p.uuid]=h,t[h]=p,i[v.uuid]=d,t[d]=v,t.pop();for(let g=0,m=n;g!==m;++g){const x=r[g],w=x[d],_=x[f];x[h]=w,x[d]=_,x.pop()}}else{const d=--a,p=t[d];d>0&&(i[p.uuid]=h),t[h]=p,t.pop();for(let f=0,v=n;f!==v;++f){const g=r[f];g[h]=g[d],g.pop()}}}this.nCachedObjects_=s}subscribe_(t,i){const r=this._bindingsIndicesByPath;let n=r[t];const s=this._bindings;if(n!==void 0)return s[n];const a=this._paths,o=this._parsedPaths,l=this._objects,c=l.length,u=this.nCachedObjects_,h=new Array(c);n=s.length,r[t]=n,a.push(t),o.push(i),s.push(h);for(let d=u,p=l.length;d!==p;++d){const f=l[d];h[d]=new Ni(f,t,i)}return h}unsubscribe_(t){const i=this._bindingsIndicesByPath,r=i[t];if(r!==void 0){const n=this._paths,s=this._parsedPaths,a=this._bindings,o=a.length-1,l=a[o],c=t[o];i[c]=r,a[r]=l,a.pop(),s[r]=s[o],s.pop(),n[r]=n[o],n.pop()}}}class bte{constructor(t,i,r=null,n=i.blendMode){this._mixer=t,this._clip=i,this._localRoot=r,this.blendMode=n;const s=i.tracks,a=s.length,o=new Array(a),l={endingStart:mf,endingEnd:mf};for(let c=0;c!==a;++c){const u=s[c].createInterpolant(null);o[c]=u,u.settings=l}this._interpolantSettings=l,this._interpolants=o,this._propertyBindings=new Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=tee,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,i){return this.loop=t,this.repetitions=i,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,i,r){if(t.fadeOut(i),this.fadeIn(i),r){const n=this._clip.duration,s=t._clip.duration,a=s/n,o=n/s;t.warp(1,a,i),this.warp(o,1,i)}return this}crossFadeTo(t,i,r){return t.crossFadeFrom(this,i,r)}stopFading(){const t=this._weightInterpolant;return t!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,i,r){const n=this._mixer,s=n.time,a=this.timeScale;let o=this._timeScaleInterpolant;o===null&&(o=n._lendControlInterpolant(),this._timeScaleInterpolant=o);const l=o.parameterPositions,c=o.sampleValues;return l[0]=s,l[1]=s+r,c[0]=t/a,c[1]=i/a,this}stopWarping(){const t=this._timeScaleInterpolant;return t!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,i,r,n){if(!this.enabled){this._updateWeight(t);return}const s=this._startTime;if(s!==null){const l=(t-s)*r;l<0||r===0?i=0:(this._startTime=null,i=r*l)}i*=this._updateTimeScale(t);const a=this._updateTime(i),o=this._updateWeight(t);if(o>0){const l=this._interpolants,c=this._propertyBindings;switch(this.blendMode){case rU:for(let u=0,h=l.length;u!==h;++u)l[u].evaluate(a),c[u].accumulateAdditive(o);break;case i2:default:for(let u=0,h=l.length;u!==h;++u)l[u].evaluate(a),c[u].accumulate(n,o)}}}_updateWeight(t){let i=0;if(this.enabled){i=this.weight;const r=this._weightInterpolant;if(r!==null){const n=r.evaluate(t)[0];i*=n,t>r.parameterPositions[1]&&(this.stopFading(),n===0&&(this.enabled=!1))}}return this._effectiveWeight=i,i}_updateTimeScale(t){let i=0;if(!this.paused){i=this.timeScale;const r=this._timeScaleInterpolant;if(r!==null){const n=r.evaluate(t)[0];i*=n,t>r.parameterPositions[1]&&(this.stopWarping(),i===0?this.paused=!0:this.timeScale=i)}}return this._effectiveTimeScale=i,i}_updateTime(t){const i=this._clip.duration,r=this.loop;let n=this.time+t,s=this._loopCount;const a=r===iee;if(t===0)return s===-1?n:a&&(s&1)===1?i-n:n;if(r===eee){s===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(n>=i)n=i;else if(n<0)n=0;else{this.time=n;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(s===-1&&(t>=0?(s=0,this._setEndings(!0,this.repetitions===0,a)):this._setEndings(this.repetitions===0,!0,a)),n>=i||n<0){const o=Math.floor(n/i);n-=i*o,s+=Math.abs(o);const l=this.repetitions-s;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,n=t>0?i:0,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(l===1){const c=t<0;this._setEndings(c,!c,a)}else this._setEndings(!1,!1,a);this._loopCount=s,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=n;if(a&&(s&1)===1)return i-n}return n}_setEndings(t,i,r){const n=this._interpolantSettings;r?(n.endingStart=gf,n.endingEnd=gf):(t?n.endingStart=this.zeroSlopeAtStart?gf:mf:n.endingStart=aw,i?n.endingEnd=this.zeroSlopeAtEnd?gf:mf:n.endingEnd=aw)}_scheduleFading(t,i,r){const n=this._mixer,s=n.time;let a=this._weightInterpolant;a===null&&(a=n._lendControlInterpolant(),this._weightInterpolant=a);const o=a.parameterPositions,l=a.sampleValues;return o[0]=s,l[0]=i,o[1]=s+t,l[1]=r,this}}const dFe=new Float32Array(1);class pFe extends $c{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,i){const r=t._localRoot||this._root,n=t._clip.tracks,s=n.length,a=t._propertyBindings,o=t._interpolants,l=r.uuid,c=this._bindingsByRootAndName;let u=c[l];u===void 0&&(u={},c[l]=u);for(let h=0;h!==s;++h){const d=n[h],p=d.name;let f=u[p];if(f!==void 0)++f.referenceCount,a[h]=f;else{if(f=a[h],f!==void 0){f._cacheIndex===null&&(++f.referenceCount,this._addInactiveBinding(f,l,p));continue}const v=i&&i._propertyBindings[h].binding.parsedPath;f=new wte(Ni.create(r,p,v),d.ValueTypeName,d.getValueSize()),++f.referenceCount,this._addInactiveBinding(f,l,p),a[h]=f}o[h].resultBuffer=f.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(t._cacheIndex===null){const r=(t._localRoot||this._root).uuid,n=t._clip.uuid,s=this._actionsByClip[n];this._bindAction(t,s&&s.knownActions[0]),this._addInactiveAction(t,n,r)}const i=t._propertyBindings;for(let r=0,n=i.length;r!==n;++r){const s=i[r];s.useCount++===0&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){const i=t._propertyBindings;for(let r=0,n=i.length;r!==n;++r){const s=i[r];--s.useCount===0&&(s.restoreOriginalState(),this._takeBackBinding(s))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){const i=t._cacheIndex;return i!==null&&i<this._nActiveActions}_addInactiveAction(t,i,r){const n=this._actions,s=this._actionsByClip;let a=s[i];if(a===void 0)a={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,s[i]=a;else{const o=a.knownActions;t._byClipCacheIndex=o.length,o.push(t)}t._cacheIndex=n.length,n.push(t),a.actionByRoot[r]=t}_removeInactiveAction(t){const i=this._actions,r=i[i.length-1],n=t._cacheIndex;r._cacheIndex=n,i[n]=r,i.pop(),t._cacheIndex=null;const s=t._clip.uuid,a=this._actionsByClip,o=a[s],l=o.knownActions,c=l[l.length-1],u=t._byClipCacheIndex;c._byClipCacheIndex=u,l[u]=c,l.pop(),t._byClipCacheIndex=null;const h=o.actionByRoot,d=(t._localRoot||this._root).uuid;delete h[d],l.length===0&&delete a[s],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){const i=t._propertyBindings;for(let r=0,n=i.length;r!==n;++r){const s=i[r];--s.referenceCount===0&&this._removeInactiveBinding(s)}}_lendAction(t){const i=this._actions,r=t._cacheIndex,n=this._nActiveActions++,s=i[n];t._cacheIndex=n,i[n]=t,s._cacheIndex=r,i[r]=s}_takeBackAction(t){const i=this._actions,r=t._cacheIndex,n=--this._nActiveActions,s=i[n];t._cacheIndex=n,i[n]=t,s._cacheIndex=r,i[r]=s}_addInactiveBinding(t,i,r){const n=this._bindingsByRootAndName,s=this._bindings;let a=n[i];a===void 0&&(a={},n[i]=a),a[r]=t,t._cacheIndex=s.length,s.push(t)}_removeInactiveBinding(t){const i=this._bindings,r=t.binding,n=r.rootNode.uuid,s=r.path,a=this._bindingsByRootAndName,o=a[n],l=i[i.length-1],c=t._cacheIndex;l._cacheIndex=c,i[c]=l,i.pop(),delete o[s],Object.keys(o).length===0&&delete a[n]}_lendBinding(t){const i=this._bindings,r=t._cacheIndex,n=this._nActiveBindings++,s=i[n];t._cacheIndex=n,i[n]=t,s._cacheIndex=r,i[r]=s}_takeBackBinding(t){const i=this._bindings,r=t._cacheIndex,n=--this._nActiveBindings,s=i[n];t._cacheIndex=n,i[n]=t,s._cacheIndex=r,i[r]=s}_lendControlInterpolant(){const t=this._controlInterpolants,i=this._nActiveControlInterpolants++;let r=t[i];return r===void 0&&(r=new MU(new Float32Array(2),new Float32Array(2),1,dFe),r.__cacheIndex=i,t[i]=r),r}_takeBackControlInterpolant(t){const i=this._controlInterpolants,r=t.__cacheIndex,n=--this._nActiveControlInterpolants,s=i[n];t.__cacheIndex=n,i[n]=t,s.__cacheIndex=r,i[r]=s}clipAction(t,i,r){const n=i||this._root,s=n.uuid;let a=typeof t=="string"?xw.findByName(n,t):t;const o=a!==null?a.uuid:t,l=this._actionsByClip[o];let c=null;if(r===void 0&&(a!==null?r=a.blendMode:r=i2),l!==void 0){const h=l.actionByRoot[s];if(h!==void 0&&h.blendMode===r)return h;c=l.knownActions[0],a===null&&(a=c._clip)}if(a===null)return null;const u=new bte(this,a,i,r);return this._bindAction(u,c),this._addInactiveAction(u,o,s),u}existingAction(t,i){const r=i||this._root,n=r.uuid,s=typeof t=="string"?xw.findByName(r,t):t,a=s?s.uuid:t,o=this._actionsByClip[a];return o!==void 0&&o.actionByRoot[n]||null}stopAllAction(){const t=this._actions,i=this._nActiveActions;for(let r=i-1;r>=0;--r)t[r].stop();return this}update(t){t*=this.timeScale;const i=this._actions,r=this._nActiveActions,n=this.time+=t,s=Math.sign(t),a=this._accuIndex^=1;for(let c=0;c!==r;++c)i[c]._update(n,t,s,a);const o=this._bindings,l=this._nActiveBindings;for(let c=0;c!==l;++c)o[c].apply(a);return this}setTime(t){this.time=0;for(let i=0;i<this._actions.length;i++)this._actions[i].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){const i=this._actions,r=t.uuid,n=this._actionsByClip,s=n[r];if(s!==void 0){const a=s.knownActions;for(let o=0,l=a.length;o!==l;++o){const c=a[o];this._deactivateAction(c);const u=c._cacheIndex,h=i[i.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,h._cacheIndex=u,i[u]=h,i.pop(),this._removeInactiveBindingsForAction(c)}delete n[r]}}uncacheRoot(t){const i=t.uuid,r=this._actionsByClip;for(const a in r){const o=r[a].actionByRoot,l=o[i];l!==void 0&&(this._deactivateAction(l),this._removeInactiveAction(l))}const n=this._bindingsByRootAndName,s=n[i];if(s!==void 0)for(const a in s){const o=s[a];o.restoreOriginalState(),this._removeInactiveBinding(o)}}uncacheAction(t,i){const r=this.existingAction(t,i);r!==null&&(this._deactivateAction(r),this._removeInactiveAction(r))}}class IU{constructor(t){this.value=t}clone(){return new IU(this.value.clone===void 0?this.value:this.value.clone())}}let fFe=0;class mFe extends $c{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:fFe++}),this.name="",this.usage=uw,this.uniforms=[]}add(t){return this.uniforms.push(t),this}remove(t){const i=this.uniforms.indexOf(t);return i!==-1&&this.uniforms.splice(i,1),this}setName(t){return this.name=t,this}setUsage(t){return this.usage=t,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(t){this.name=t.name,this.usage=t.usage;const i=t.uniforms;this.uniforms.length=0;for(let r=0,n=i.length;r<n;r++){const s=Array.isArray(i[r])?i[r]:[i[r]];for(let a=0;a<s.length;a++)this.uniforms.push(s[a].clone())}return this}clone(){return new this.constructor().copy(this)}}class gFe extends l2{constructor(t,i,r=1){super(t,i),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=r}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}clone(t){const i=super.clone(t);return i.meshPerAttribute=this.meshPerAttribute,i}toJSON(t){const i=super.toJSON(t);return i.isInstancedInterleavedBuffer=!0,i.meshPerAttribute=this.meshPerAttribute,i}}class vFe{constructor(t,i,r,n,s){this.isGLBufferAttribute=!0,this.name="",this.buffer=t,this.type=i,this.itemSize=r,this.elementSize=n,this.count=s,this.version=0}set needsUpdate(t){t===!0&&this.version++}setBuffer(t){return this.buffer=t,this}setType(t,i){return this.type=t,this.elementSize=i,this}setItemSize(t){return this.itemSize=t,this}setCount(t){return this.count=t,this}}const x9=new ii;class _te{constructor(t,i,r=0,n=1/0){this.ray=new om(t,i),this.near=r,this.far=n,this.camera=null,this.layers=new If,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,i){this.ray.set(t,i)}setFromCamera(t,i){i.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(i.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(i).sub(this.ray.origin).normalize(),this.camera=i):i.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(i.near+i.far)/(i.near-i.far)).unproject(i),this.ray.direction.set(0,0,-1).transformDirection(i.matrixWorld),this.camera=i):console.error("THREE.Raycaster: Unsupported camera type: "+i.type)}setFromXRController(t){return x9.identity().extractRotation(t.matrixWorld),this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(x9),this}intersectObject(t,i=!0,r=[]){return Xz(t,this,r,i),r.sort(w9),r}intersectObjects(t,i=!0,r=[]){for(let n=0,s=t.length;n<s;n++)Xz(t[n],this,r,i);return r.sort(w9),r}}function w9(e,t){return e.distance-t.distance}function Xz(e,t,i,r){let n=!0;if(e.layers.test(t.layers)&&e.raycast(t,i)===!1&&(n=!1),n===!0&&r===!0){const s=e.children;for(let a=0,o=s.length;a<o;a++)Xz(s[a],t,i,!0)}}class qz{constructor(t=1,i=0,r=0){return this.radius=t,this.phi=i,this.theta=r,this}set(t,i,r){return this.radius=t,this.phi=i,this.theta=r,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,i,r){return this.radius=Math.sqrt(t*t+i*i+r*r),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,r),this.phi=Math.acos(Qr(i/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class yFe{constructor(t=1,i=0,r=0){return this.radius=t,this.theta=i,this.y=r,this}set(t,i,r){return this.radius=t,this.theta=i,this.y=r,this}copy(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,i,r){return this.radius=Math.sqrt(t*t+r*r),this.theta=Math.atan2(t,r),this.y=i,this}clone(){return new this.constructor().copy(this)}}class LU{constructor(t,i,r,n){LU.prototype.isMatrix2=!0,this.elements=[1,0,0,1],t!==void 0&&this.set(t,i,r,n)}identity(){return this.set(1,0,0,1),this}fromArray(t,i=0){for(let r=0;r<4;r++)this.elements[r]=t[r+i];return this}set(t,i,r,n){const s=this.elements;return s[0]=t,s[2]=i,s[1]=r,s[3]=n,this}}const b9=new ot;class xFe{constructor(t=new ot(1/0,1/0),i=new ot(-1/0,-1/0)){this.isBox2=!0,this.min=t,this.max=i}set(t,i){return this.min.copy(t),this.max.copy(i),this}setFromPoints(t){this.makeEmpty();for(let i=0,r=t.length;i<r;i++)this.expandByPoint(t[i]);return this}setFromCenterAndSize(t,i){const r=b9.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t){return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,i){return i.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return t.max.x>=this.min.x&&t.min.x<=this.max.x&&t.max.y>=this.min.y&&t.min.y<=this.max.y}clampPoint(t,i){return i.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,b9).distanceTo(t)}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const _9=new oe,IM=new oe;class wFe{constructor(t=new oe,i=new oe){this.start=t,this.end=i}set(t,i){return this.start.copy(t),this.end.copy(i),this}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,i){return this.delta(i).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,i){_9.subVectors(t,this.start),IM.subVectors(this.end,this.start);const r=IM.dot(IM);let s=IM.dot(_9)/r;return i&&(s=Qr(s,0,1)),s}closestPointToPoint(t,i,r){const n=this.closestPointToPointParameter(t,i);return this.delta(r).multiplyScalar(n).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const S9=new oe;class bFe extends ki{constructor(t,i){super(),this.light=t,this.matrixAutoUpdate=!1,this.color=i,this.type="SpotLightHelper";const r=new wi,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let a=0,o=1,l=32;a<l;a++,o++){const c=a/l*Math.PI*2,u=o/l*Math.PI*2;n.push(Math.cos(c),Math.sin(c),1,Math.cos(u),Math.sin(u),1)}r.setAttribute("position",new kt(n,3));const s=new Ma({fog:!1,toneMapped:!1});this.cone=new Jc(r,s),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const t=this.light.distance?this.light.distance:1e3,i=t*Math.tan(this.light.angle);this.cone.scale.set(i,i,t),S9.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(S9),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const rd=new oe,LM=new ii,hI=new ii;class _Fe extends Jc{constructor(t){const i=Ste(t),r=new wi,n=[],s=[],a=new Rt(0,0,1),o=new Rt(0,1,0);for(let c=0;c<i.length;c++){const u=i[c];u.parent&&u.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),s.push(a.r,a.g,a.b),s.push(o.r,o.g,o.b))}r.setAttribute("position",new kt(n,3)),r.setAttribute("color",new kt(s,3));const l=new Ma({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(r,l),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=t,this.bones=i,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(t){const i=this.bones,r=this.geometry,n=r.getAttribute("position");hI.copy(this.root.matrixWorld).invert();for(let s=0,a=0;s<i.length;s++){const o=i[s];o.parent&&o.parent.isBone&&(LM.multiplyMatrices(hI,o.matrixWorld),rd.setFromMatrixPosition(LM),n.setXYZ(a,rd.x,rd.y,rd.z),LM.multiplyMatrices(hI,o.parent.matrixWorld),rd.setFromMatrixPosition(LM),n.setXYZ(a+1,rd.x,rd.y,rd.z),a+=2)}r.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(t)}dispose(){this.geometry.dispose(),this.material.dispose()}}function Ste(e){const t=[];e.isBone===!0&&t.push(e);for(let i=0;i<e.children.length;i++)t.push.apply(t,Ste(e.children[i]));return t}class SFe extends En{constructor(t,i,r){const n=new nb(i,4,2),s=new ap({wireframe:!0,fog:!1,toneMapped:!1});super(n,s),this.light=t,this.color=r,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const MFe=new oe,M9=new Rt,E9=new Rt;class EFe extends ki{constructor(t,i,r){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,this.type="HemisphereLightHelper";const n=new rb(i);n.rotateY(Math.PI*.5),this.material=new ap({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const s=n.getAttribute("position"),a=new Float32Array(s.count*3);n.setAttribute("color",new dr(a,3)),this.add(new En(n,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const t=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const i=t.geometry.getAttribute("color");M9.copy(this.light.color),E9.copy(this.light.groundColor);for(let r=0,n=i.count;r<n;r++){const s=r<n/2?M9:E9;i.setXYZ(r,s.r,s.g,s.b)}i.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),t.lookAt(MFe.setFromMatrixPosition(this.light.matrixWorld).negate())}}class AFe extends Jc{constructor(t=10,i=10,r=4473924,n=8947848){r=new Rt(r),n=new Rt(n);const s=i/2,a=t/i,o=t/2,l=[],c=[];for(let d=0,p=0,f=-o;d<=i;d++,f+=a){l.push(-o,0,f,o,0,f),l.push(f,0,-o,f,0,o);const v=d===s?r:n;v.toArray(c,p),p+=3,v.toArray(c,p),p+=3,v.toArray(c,p),p+=3,v.toArray(c,p),p+=3}const u=new wi;u.setAttribute("position",new kt(l,3)),u.setAttribute("color",new kt(c,3));const h=new Ma({vertexColors:!0,toneMapped:!1});super(u,h),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class CFe extends Jc{constructor(t=10,i=16,r=8,n=64,s=4473924,a=8947848){s=new Rt(s),a=new Rt(a);const o=[],l=[];if(i>1)for(let h=0;h<i;h++){const d=h/i*(Math.PI*2),p=Math.sin(d)*t,f=Math.cos(d)*t;o.push(0,0,0),o.push(p,0,f);const v=h&1?s:a;l.push(v.r,v.g,v.b),l.push(v.r,v.g,v.b)}for(let h=0;h<r;h++){const d=h&1?s:a,p=t-t/r*h;for(let f=0;f<n;f++){let v=f/n*(Math.PI*2),g=Math.sin(v)*p,m=Math.cos(v)*p;o.push(g,0,m),l.push(d.r,d.g,d.b),v=(f+1)/n*(Math.PI*2),g=Math.sin(v)*p,m=Math.cos(v)*p,o.push(g,0,m),l.push(d.r,d.g,d.b)}}const c=new wi;c.setAttribute("position",new kt(o,3)),c.setAttribute("color",new kt(l,3));const u=new Ma({vertexColors:!0,toneMapped:!1});super(c,u),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const A9=new oe,OM=new oe,C9=new oe;class TFe extends ki{constructor(t,i,r){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,this.type="DirectionalLightHelper",i===void 0&&(i=1);let n=new wi;n.setAttribute("position",new kt([-i,i,0,i,i,0,i,-i,0,-i,-i,0,-i,i,0],3));const s=new Ma({fog:!1,toneMapped:!1});this.lightPlane=new Zd(n,s),this.add(this.lightPlane),n=new wi,n.setAttribute("position",new kt([0,0,0,0,0,1],3)),this.targetLine=new Zd(n,s),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),A9.setFromMatrixPosition(this.light.matrixWorld),OM.setFromMatrixPosition(this.light.target.matrixWorld),C9.subVectors(OM,A9),this.lightPlane.lookAt(OM),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(OM),this.targetLine.scale.z=C9.length()}}const zM=new oe,Gr=new Jw;class PFe extends Jc{constructor(t){const i=new wi,r=new Ma({color:16777215,vertexColors:!0,toneMapped:!1}),n=[],s=[],a={};o("n1","n2"),o("n2","n4"),o("n4","n3"),o("n3","n1"),o("f1","f2"),o("f2","f4"),o("f4","f3"),o("f3","f1"),o("n1","f1"),o("n2","f2"),o("n3","f3"),o("n4","f4"),o("p","n1"),o("p","n2"),o("p","n3"),o("p","n4"),o("u1","u2"),o("u2","u3"),o("u3","u1"),o("c","t"),o("p","c"),o("cn1","cn2"),o("cn3","cn4"),o("cf1","cf2"),o("cf3","cf4");function o(f,v){l(f),l(v)}function l(f){n.push(0,0,0),s.push(0,0,0),a[f]===void 0&&(a[f]=[]),a[f].push(n.length/3-1)}i.setAttribute("position",new kt(n,3)),i.setAttribute("color",new kt(s,3)),super(i,r),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update();const c=new Rt(16755200),u=new Rt(16711680),h=new Rt(43775),d=new Rt(16777215),p=new Rt(3355443);this.setColors(c,u,h,d,p)}setColors(t,i,r,n,s){const o=this.geometry.getAttribute("color");o.setXYZ(0,t.r,t.g,t.b),o.setXYZ(1,t.r,t.g,t.b),o.setXYZ(2,t.r,t.g,t.b),o.setXYZ(3,t.r,t.g,t.b),o.setXYZ(4,t.r,t.g,t.b),o.setXYZ(5,t.r,t.g,t.b),o.setXYZ(6,t.r,t.g,t.b),o.setXYZ(7,t.r,t.g,t.b),o.setXYZ(8,t.r,t.g,t.b),o.setXYZ(9,t.r,t.g,t.b),o.setXYZ(10,t.r,t.g,t.b),o.setXYZ(11,t.r,t.g,t.b),o.setXYZ(12,t.r,t.g,t.b),o.setXYZ(13,t.r,t.g,t.b),o.setXYZ(14,t.r,t.g,t.b),o.setXYZ(15,t.r,t.g,t.b),o.setXYZ(16,t.r,t.g,t.b),o.setXYZ(17,t.r,t.g,t.b),o.setXYZ(18,t.r,t.g,t.b),o.setXYZ(19,t.r,t.g,t.b),o.setXYZ(20,t.r,t.g,t.b),o.setXYZ(21,t.r,t.g,t.b),o.setXYZ(22,t.r,t.g,t.b),o.setXYZ(23,t.r,t.g,t.b),o.setXYZ(24,i.r,i.g,i.b),o.setXYZ(25,i.r,i.g,i.b),o.setXYZ(26,i.r,i.g,i.b),o.setXYZ(27,i.r,i.g,i.b),o.setXYZ(28,i.r,i.g,i.b),o.setXYZ(29,i.r,i.g,i.b),o.setXYZ(30,i.r,i.g,i.b),o.setXYZ(31,i.r,i.g,i.b),o.setXYZ(32,r.r,r.g,r.b),o.setXYZ(33,r.r,r.g,r.b),o.setXYZ(34,r.r,r.g,r.b),o.setXYZ(35,r.r,r.g,r.b),o.setXYZ(36,r.r,r.g,r.b),o.setXYZ(37,r.r,r.g,r.b),o.setXYZ(38,n.r,n.g,n.b),o.setXYZ(39,n.r,n.g,n.b),o.setXYZ(40,s.r,s.g,s.b),o.setXYZ(41,s.r,s.g,s.b),o.setXYZ(42,s.r,s.g,s.b),o.setXYZ(43,s.r,s.g,s.b),o.setXYZ(44,s.r,s.g,s.b),o.setXYZ(45,s.r,s.g,s.b),o.setXYZ(46,s.r,s.g,s.b),o.setXYZ(47,s.r,s.g,s.b),o.setXYZ(48,s.r,s.g,s.b),o.setXYZ(49,s.r,s.g,s.b),o.needsUpdate=!0}update(){const t=this.geometry,i=this.pointMap,r=1,n=1;Gr.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),sn("c",i,t,Gr,0,0,-1),sn("t",i,t,Gr,0,0,1),sn("n1",i,t,Gr,-r,-n,-1),sn("n2",i,t,Gr,r,-n,-1),sn("n3",i,t,Gr,-r,n,-1),sn("n4",i,t,Gr,r,n,-1),sn("f1",i,t,Gr,-r,-n,1),sn("f2",i,t,Gr,r,-n,1),sn("f3",i,t,Gr,-r,n,1),sn("f4",i,t,Gr,r,n,1),sn("u1",i,t,Gr,r*.7,n*1.1,-1),sn("u2",i,t,Gr,-r*.7,n*1.1,-1),sn("u3",i,t,Gr,0,n*2,-1),sn("cf1",i,t,Gr,-r,0,1),sn("cf2",i,t,Gr,r,0,1),sn("cf3",i,t,Gr,0,-n,1),sn("cf4",i,t,Gr,0,n,1),sn("cn1",i,t,Gr,-r,0,-1),sn("cn2",i,t,Gr,r,0,-1),sn("cn3",i,t,Gr,0,-n,-1),sn("cn4",i,t,Gr,0,n,-1),t.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function sn(e,t,i,r,n,s,a){zM.set(n,s,a).unproject(r);const o=t[e];if(o!==void 0){const l=i.getAttribute("position");for(let c=0,u=o.length;c<u;c++)l.setXYZ(o[c],zM.x,zM.y,zM.z)}}const NM=new ya;class DFe extends Jc{constructor(t,i=16776960){const r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(8*3),s=new wi;s.setIndex(new dr(r,1)),s.setAttribute("position",new dr(n,3)),super(s,new Ma({color:i,toneMapped:!1})),this.object=t,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(t){if(t!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&NM.setFromObject(this.object),NM.isEmpty())return;const i=NM.min,r=NM.max,n=this.geometry.attributes.position,s=n.array;s[0]=r.x,s[1]=r.y,s[2]=r.z,s[3]=i.x,s[4]=r.y,s[5]=r.z,s[6]=i.x,s[7]=i.y,s[8]=r.z,s[9]=r.x,s[10]=i.y,s[11]=r.z,s[12]=r.x,s[13]=r.y,s[14]=i.z,s[15]=i.x,s[16]=r.y,s[17]=i.z,s[18]=i.x,s[19]=i.y,s[20]=i.z,s[21]=r.x,s[22]=i.y,s[23]=i.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(t){return this.object=t,this.update(),this}copy(t,i){return super.copy(t,i),this.object=t.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class RFe extends Jc{constructor(t,i=16776960){const r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],s=new wi;s.setIndex(new dr(r,1)),s.setAttribute("position",new kt(n,3)),super(s,new Ma({color:i,toneMapped:!1})),this.box=t,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(t){const i=this.box;i.isEmpty()||(i.getCenter(this.position),i.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(t))}dispose(){this.geometry.dispose(),this.material.dispose()}}class IFe extends Zd{constructor(t,i=1,r=16776960){const n=r,s=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],a=new wi;a.setAttribute("position",new kt(s,3)),a.computeBoundingSphere(),super(a,new Ma({color:n,toneMapped:!1})),this.type="PlaneHelper",this.plane=t,this.size=i;const o=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],l=new wi;l.setAttribute("position",new kt(o,3)),l.computeBoundingSphere(),this.add(new En(l,new ap({color:n,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(t){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(t)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const T9=new oe;let BM,dI;class LFe extends ki{constructor(t=new oe(0,0,1),i=new oe(0,0,0),r=1,n=16776960,s=r*.2,a=s*.2){super(),this.type="ArrowHelper",BM===void 0&&(BM=new wi,BM.setAttribute("position",new kt([0,0,0,0,1,0],3)),dI=new H0(0,.5,1,5,1),dI.translate(0,-.5,0)),this.position.copy(i),this.line=new Zd(BM,new Ma({color:n,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new En(dI,new ap({color:n,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(r,s,a)}setDirection(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{T9.set(t.z,0,-t.x).normalize();const i=Math.acos(t.y);this.quaternion.setFromAxisAngle(T9,i)}}setLength(t,i=t*.2,r=i*.2){this.line.scale.set(1,Math.max(1e-4,t-i),1),this.line.updateMatrix(),this.cone.scale.set(r,i,r),this.cone.position.y=t,this.cone.updateMatrix()}setColor(t){this.line.material.color.set(t),this.cone.material.color.set(t)}copy(t){return super.copy(t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class OFe extends Jc{constructor(t=1){const i=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],r=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],n=new wi;n.setAttribute("position",new kt(i,3)),n.setAttribute("color",new kt(r,3));const s=new Ma({vertexColors:!0,toneMapped:!1});super(n,s),this.type="AxesHelper"}setColors(t,i,r){const n=new Rt,s=this.geometry.attributes.color.array;return n.set(t),n.toArray(s,0),n.toArray(s,3),n.set(i),n.toArray(s,6),n.toArray(s,9),n.set(r),n.toArray(s,12),n.toArray(s,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class zFe{constructor(){this.type="ShapePath",this.color=new Rt,this.subPaths=[],this.currentPath=null}moveTo(t,i){return this.currentPath=new pw,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,i),this}lineTo(t,i){return this.currentPath.lineTo(t,i),this}quadraticCurveTo(t,i,r,n){return this.currentPath.quadraticCurveTo(t,i,r,n),this}bezierCurveTo(t,i,r,n,s,a){return this.currentPath.bezierCurveTo(t,i,r,n,s,a),this}splineThru(t){return this.currentPath.splineThru(t),this}toShapes(t){function i(m){const x=[];for(let w=0,_=m.length;w<_;w++){const M=m[w],S=new Lf;S.curves=M.curves,x.push(S)}return x}function r(m,x){const w=x.length;let _=!1;for(let M=w-1,S=0;S<w;M=S++){let A=x[M],T=x[S],E=T.x-A.x,C=T.y-A.y;if(Math.abs(C)>Number.EPSILON){if(C<0&&(A=x[S],E=-E,T=x[M],C=-C),m.y<A.y||m.y>T.y)continue;if(m.y===A.y){if(m.x===A.x)return!0}else{const D=C*(m.x-A.x)-E*(m.y-A.y);if(D===0)return!0;if(D<0)continue;_=!_}}else{if(m.y!==A.y)continue;if(T.x<=m.x&&m.x<=A.x||A.x<=m.x&&m.x<=T.x)return!0}}return _}const n=jc.isClockWise,s=this.subPaths;if(s.length===0)return[];let a,o,l;const c=[];if(s.length===1)return o=s[0],l=new Lf,l.curves=o.curves,c.push(l),c;let u=!n(s[0].getPoints());u=t?!u:u;const h=[],d=[];let p=[],f=0,v;d[f]=void 0,p[f]=[];for(let m=0,x=s.length;m<x;m++)o=s[m],v=o.getPoints(),a=n(v),a=t?!a:a,a?(!u&&d[f]&&f++,d[f]={s:new Lf,p:v},d[f].s.curves=o.curves,u&&f++,p[f]=[]):p[f].push({h:o,p:v[0]});if(!d[0])return i(s);if(d.length>1){let m=!1,x=0;for(let w=0,_=d.length;w<_;w++)h[w]=[];for(let w=0,_=d.length;w<_;w++){const M=p[w];for(let S=0;S<M.length;S++){const A=M[S];let T=!0;for(let E=0;E<d.length;E++)r(A.p,d[E].p)&&(w!==E&&x++,T?(T=!1,h[E].push(A)):m=!0);T&&h[w].push(A)}}x>0&&m===!1&&(p=h)}let g;for(let m=0,x=d.length;m<x;m++){l=d[m].s,c.push(l),g=p[m];for(let w=0,_=g.length;w<_;w++)l.holes.push(g[w].h)}return c}}class NFe extends Wl{constructor(t=1,i=1,r=1,n={}){console.warn('THREE.WebGLMultipleRenderTargets has been deprecated and will be removed in r172. Use THREE.WebGLRenderTarget and set the "count" parameter to enable MRT.'),super(t,i,{...n,count:r}),this.isWebGLMultipleRenderTargets=!0}get texture(){return this.textures}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:qT}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=qT);const BFe=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:Xk,AddEquation:vd,AddOperation:XJ,AdditiveAnimationBlendMode:rU,AdditiveBlending:Rz,AgXToneMapping:ZJ,AlphaFormat:Zk,AlwaysCompare:dee,AlwaysDepth:UJ,AlwaysStencilFunc:zz,AmbientLight:pte,AnimationAction:bte,AnimationClip:xw,AnimationLoader:kUe,AnimationMixer:pFe,AnimationObjectGroup:hFe,AnimationUtils:OUe,ArcCurve:kee,ArrayCamera:Tee,ArrowHelper:LFe,AttachedBindMode:Oz,Audio:xte,AudioAnalyser:tFe,AudioContext:TU,AudioListener:$Ue,AudioLoader:QUe,AxesHelper:OFe,BackSide:va,BasicDepthPacking:ree,BasicShadowMap:xJ,BatchedMesh:zee,Bone:fU,BooleanKeyframeTrack:cm,Box2:xFe,Box3:ya,Box3Helper:RFe,BoxGeometry:lm,BoxHelper:DFe,BufferAttribute:dr,BufferGeometry:wi,BufferGeometryLoader:yte,ByteType:Yk,Cache:Ju,Camera:Jw,CameraHelper:PFe,CanvasTexture:nUe,CapsuleGeometry:d2,CatmullRomCurve3:Uee,CineonToneMapping:QJ,CircleGeometry:p2,ClampToEdgeWrapping:Qo,Clock:PU,Color:Rt,ColorKeyframeTrack:EU,ColorManagement:Gi,CompressedArrayTexture:iUe,CompressedCubeTexture:rUe,CompressedTexture:u2,CompressedTextureLoader:UUe,ConeGeometry:f2,ConstantAlphaFactor:NJ,ConstantColorFactor:OJ,CubeCamera:wee,CubeReflectionMapping:vh,CubeRefractionMapping:Kd,CubeTexture:eb,CubeTextureLoader:FUe,CubeUVReflectionMapping:k0,CubicBezierCurve:vU,CubicBezierCurve3:Fee,CubicInterpolant:ste,CullFaceBack:Dz,CullFaceFront:yJ,CullFaceFrontBack:OIe,CullFaceNone:vJ,Curve:Ql,CurvePath:Hee,CustomBlending:wJ,CustomToneMapping:KJ,CylinderGeometry:H0,Cylindrical:yFe,Data3DTexture:aU,DataArrayTexture:n2,DataTexture:Gc,DataTextureLoader:VUe,DataUtils:XLe,DecrementStencilOp:YIe,DecrementWrapStencilOp:KIe,DefaultLoadingManager:lte,DepthFormat:Df,DepthStencilFormat:Qf,DepthTexture:uU,DetachedBindMode:JJ,DirectionalLight:dte,DirectionalLightHelper:TFe,DiscreteInterpolant:ate,DisplayP3ColorSpace:r2,DodecahedronGeometry:m2,DoubleSide:Dc,DstAlphaFactor:PJ,DstColorFactor:RJ,DynamicCopyUsage:hLe,DynamicDrawUsage:sLe,DynamicReadUsage:lLe,EdgesGeometry:Gee,EllipseCurve:h2,EqualCompare:lee,EqualDepth:VJ,EqualStencilFunc:eLe,EquirectangularReflectionMapping:tw,EquirectangularRefractionMapping:iw,Euler:yo,EventDispatcher:$c,ExtrudeGeometry:v2,FileLoader:xh,Float16BufferAttribute:$Le,Float32BufferAttribute:kt,FloatType:Ua,Fog:o2,FogExp2:a2,FramebufferTexture:tUe,FrontSide:gh,Frustum:tb,GLBufferAttribute:vFe,GLSL1:pLe,GLSL3:Nz,GreaterCompare:cee,GreaterDepth:GJ,GreaterEqualCompare:hee,GreaterEqualDepth:HJ,GreaterEqualStencilFunc:nLe,GreaterStencilFunc:iLe,GridHelper:AFe,Group:hv,HalfFloatType:U0,HemisphereLight:cte,HemisphereLightHelper:EFe,IcosahedronGeometry:y2,ImageBitmapLoader:YUe,ImageLoader:ww,ImageUtils:mee,IncrementStencilOp:qIe,IncrementWrapStencilOp:QIe,InstancedBufferAttribute:c0,InstancedBufferGeometry:vte,InstancedInterleavedBuffer:gFe,InstancedMesh:Oee,Int16BufferAttribute:KLe,Int32BufferAttribute:ZLe,Int8BufferAttribute:qLe,IntType:KT,InterleavedBuffer:l2,InterleavedBufferAttribute:Kf,Interpolant:sb,InterpolateDiscrete:sw,InterpolateLinear:WC,InterpolateSmooth:PE,InvertStencilOp:ZIe,KeepStencilOp:qp,KeyframeTrack:Kl,LOD:Iee,LatheGeometry:ib,Layers:If,LessCompare:oee,LessDepth:FJ,LessEqualCompare:nU,LessEqualDepth:ew,LessEqualStencilFunc:tLe,LessStencilFunc:JIe,Light:lp,LightProbe:gte,Line:Zd,Line3:wFe,LineBasicMaterial:Ma,LineCurve:yU,LineCurve3:Vee,LineDashedMaterial:ite,LineLoop:Nee,LineSegments:Jc,LinearDisplayP3ColorSpace:$w,LinearFilter:_n,LinearInterpolant:MU,LinearMipMapLinearFilter:kIe,LinearMipMapNearestFilter:BIe,LinearMipmapLinearFilter:Lc,LinearMipmapNearestFilter:i1,LinearSRGBColorSpace:Ah,LinearToneMapping:qJ,LinearTransfer:ow,Loader:Ya,LoaderUtils:Wz,LoadingManager:AU,LoopOnce:eee,LoopPingPong:iee,LoopRepeat:tee,LuminanceAlphaFormat:eU,LuminanceFormat:Jk,MOUSE:Wp,Material:Ts,MaterialLoader:E2,MathUtils:Bz,Matrix2:LU,Matrix3:vi,Matrix4:ii,MaxEquation:MJ,Mesh:En,MeshBasicMaterial:ap,MeshDepthMaterial:hU,MeshDistanceMaterial:dU,MeshLambertMaterial:ete,MeshMatcapMaterial:tte,MeshNormalMaterial:Jee,MeshPhongMaterial:Zee,MeshPhysicalMaterial:Kee,MeshStandardMaterial:_U,MeshToonMaterial:$ee,MinEquation:SJ,MirroredRepeatWrapping:nw,MixOperation:WJ,MultiplyBlending:Lz,MultiplyOperation:Kw,NearestFilter:os,NearestMipMapLinearFilter:NIe,NearestMipMapNearestFilter:zIe,NearestMipmapLinearFilter:lv,NearestMipmapNearestFilter:qk,NeutralToneMapping:$J,NeverCompare:aee,NeverDepth:kJ,NeverStencilFunc:$Ie,NoBlending:nh,NoColorSpace:Vu,NoToneMapping:Hc,NormalAnimationBlendMode:i2,NormalBlending:Pf,NotEqualCompare:uee,NotEqualDepth:jJ,NotEqualStencilFunc:rLe,NumberKeyframeTrack:vw,Object3D:ki,ObjectLoader:XUe,ObjectSpaceNormalMap:see,OctahedronGeometry:rb,OneFactor:AJ,OneMinusConstantAlphaFactor:BJ,OneMinusConstantColorFactor:zJ,OneMinusDstAlphaFactor:DJ,OneMinusDstColorFactor:IJ,OneMinusSrcAlphaFactor:yC,OneMinusSrcColorFactor:TJ,OrthographicCamera:$u,P3Primaries:cw,PCFShadowMap:YT,PCFSoftShadowMap:t1,PMREMGenerator:kz,Path:pw,PerspectiveCamera:Kr,Plane:ku,PlaneGeometry:F0,PlaneHelper:IFe,PointLight:hte,PointLightHelper:SFe,Points:Bee,PointsMaterial:mU,PolarGridHelper:CFe,PolyhedronGeometry:op,PositionalAudio:eFe,PropertyBinding:Ni,PropertyMixer:wte,QuadraticBezierCurve:xU,QuadraticBezierCurve3:wU,Quaternion:Ks,QuaternionKeyframeTrack:ab,QuaternionLinearInterpolant:ote,RED_GREEN_RGTC2_Format:GC,RED_RGTC1_Format:iU,REVISION:qT,RGBADepthPacking:nee,RGBAFormat:Ys,RGBAIntegerFormat:t2,RGBA_ASTC_10x10_Format:BC,RGBA_ASTC_10x5_Format:OC,RGBA_ASTC_10x6_Format:zC,RGBA_ASTC_10x8_Format:NC,RGBA_ASTC_12x10_Format:kC,RGBA_ASTC_12x12_Format:UC,RGBA_ASTC_4x4_Format:AC,RGBA_ASTC_5x4_Format:CC,RGBA_ASTC_5x5_Format:TC,RGBA_ASTC_6x5_Format:PC,RGBA_ASTC_6x6_Format:DC,RGBA_ASTC_8x5_Format:RC,RGBA_ASTC_8x6_Format:IC,RGBA_ASTC_8x8_Format:LC,RGBA_BPTC_Format:o1,RGBA_ETC2_EAC_Format:EC,RGBA_PVRTC_2BPPV1_Format:_C,RGBA_PVRTC_4BPPV1_Format:bC,RGBA_S3TC_DXT1_Format:n1,RGBA_S3TC_DXT3_Format:s1,RGBA_S3TC_DXT5_Format:a1,RGBDepthPacking:GIe,RGBFormat:$k,RGBIntegerFormat:UIe,RGB_BPTC_SIGNED_Format:FC,RGB_BPTC_UNSIGNED_Format:VC,RGB_ETC1_Format:SC,RGB_ETC2_Format:MC,RGB_PVRTC_2BPPV1_Format:wC,RGB_PVRTC_4BPPV1_Format:xC,RGB_S3TC_DXT1_Format:r1,RGDepthPacking:jIe,RGFormat:tU,RGIntegerFormat:e2,RawShaderMaterial:Qee,Ray:om,Raycaster:_te,Rec709Primaries:lw,RectAreaLight:fte,RedFormat:JT,RedIntegerFormat:Zw,ReinhardToneMapping:YJ,RenderTarget:gee,RepeatWrapping:rw,ReplaceStencilOp:XIe,ReverseSubtractEquation:_J,RingGeometry:x2,SIGNED_RED_GREEN_RGTC2_Format:jC,SIGNED_RED_RGTC1_Format:HC,SRGBColorSpace:Vo,SRGBTransfer:yr,Scene:XC,ShaderChunk:xi,ShaderLib:Tl,ShaderMaterial:Xl,ShadowMaterial:Yee,Shape:Lf,ShapeGeometry:w2,ShapePath:zFe,ShapeUtils:jc,ShortType:Qk,Skeleton:c2,SkeletonHelper:_Fe,SkinnedMesh:Lee,Source:vf,Sphere:Zs,SphereGeometry:nb,Spherical:qz,SphericalHarmonics3:mte,SplineCurve:bU,SpotLight:ute,SpotLightHelper:bFe,Sprite:Ree,SpriteMaterial:pU,SrcAlphaFactor:vC,SrcAlphaSaturateFactor:LJ,SrcColorFactor:CJ,StaticCopyUsage:uLe,StaticDrawUsage:uw,StaticReadUsage:oLe,StereoCamera:KUe,StreamCopyUsage:dLe,StreamDrawUsage:aLe,StreamReadUsage:cLe,StringKeyframeTrack:um,SubtractEquation:bJ,SubtractiveBlending:Iz,TOUCH:Xp,TangentSpaceNormalMap:sp,TetrahedronGeometry:b2,Texture:kr,TextureLoader:HUe,TextureUtils:Oke,TorusGeometry:_2,TorusKnotGeometry:S2,Triangle:oo,TriangleFanDrawMode:HIe,TriangleStripDrawMode:VIe,TrianglesDrawMode:FIe,TubeGeometry:M2,UVMapping:QT,Uint16BufferAttribute:oU,Uint32BufferAttribute:lU,Uint8BufferAttribute:YLe,Uint8ClampedBufferAttribute:QLe,Uniform:IU,UniformsGroup:mFe,UniformsLib:Mt,UniformsUtils:xee,UnsignedByteType:jl,UnsignedInt248Type:Yf,UnsignedInt5999Type:Kk,UnsignedIntType:yh,UnsignedShort4444Type:ZT,UnsignedShort5551Type:$T,UnsignedShortType:a0,VSMShadowMap:El,Vector2:ot,Vector3:oe,Vector4:tr,VectorKeyframeTrack:yw,VideoTexture:eUe,WebGL3DRenderTarget:NLe,WebGLArrayRenderTarget:zLe,WebGLCoordinateSystem:Oc,WebGLCubeRenderTarget:bee,WebGLMultipleRenderTargets:NFe,WebGLRenderTarget:Wl,WebGLRenderer:Pee,WebGLUtils:Cee,WebGPUCoordinateSystem:hw,WireframeGeometry:qee,WrapAroundEnding:aw,ZeroCurvatureEnding:mf,ZeroFactor:EJ,ZeroSlopeEnding:gf,ZeroStencilOp:WIe,createCanvasElement:fee},Symbol.toStringTag,{value:"Module"}));var Mte={exports:{}},hm={};/**
 * @license React
 * react-reconciler-constants.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */hm.ConcurrentRoot=1;hm.ContinuousEventPriority=4;hm.DefaultEventPriority=16;hm.DiscreteEventPriority=1;hm.IdleEventPriority=536870912;hm.LegacyRoot=0;Mte.exports=hm;var pv=Mte.exports;function kFe(e){let t;const i=new Set,r=(c,u)=>{const h=typeof c=="function"?c(t):c;if(h!==t){const d=t;t=u?h:Object.assign({},t,h),i.forEach(p=>p(t,d))}},n=()=>t,s=(c,u=n,h=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let d=u(t);function p(){const f=u(t);if(!h(d,f)){const v=d;c(d=f,v)}}return i.add(p),()=>i.delete(p)},l={setState:r,getState:n,subscribe:(c,u,h)=>u||h?s(c,u,h):(i.add(c),()=>i.delete(c)),destroy:()=>i.clear()};return t=e(r,n,l),l}const UFe=typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),P9=UFe?qe.useEffect:qe.useLayoutEffect;function FFe(e){const t=typeof e=="function"?kFe(e):e,i=(r=t.getState,n=Object.is)=>{const[,s]=qe.useReducer(g=>g+1,0),a=t.getState(),o=qe.useRef(a),l=qe.useRef(r),c=qe.useRef(n),u=qe.useRef(!1),h=qe.useRef();h.current===void 0&&(h.current=r(a));let d,p=!1;(o.current!==a||l.current!==r||c.current!==n||u.current)&&(d=r(a),p=!n(h.current,d)),P9(()=>{p&&(h.current=d),o.current=a,l.current=r,c.current=n,u.current=!1});const f=qe.useRef(a);P9(()=>{const g=()=>{try{const x=t.getState(),w=l.current(x);c.current(h.current,w)||(o.current=x,h.current=w,s())}catch{u.current=!0,s()}},m=t.subscribe(g);return t.getState()!==f.current&&g(),m},[]);const v=p?d:h.current;return qe.useDebugValue(v),v};return Object.assign(i,t),i[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const r=[i,t];return{next(){const n=r.length<=0;return{value:r.shift(),done:n}}}},i}var Ete={exports:{}},pI={exports:{}},fI={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var D9;function VFe(){return D9||(D9=1,function(e){function t(O,j){var V=O.length;O.push(j);e:for(;0<V;){var W=V-1>>>1,J=O[W];if(0<n(J,j))O[W]=j,O[V]=J,V=W;else break e}}function i(O){return O.length===0?null:O[0]}function r(O){if(O.length===0)return null;var j=O[0],V=O.pop();if(V!==j){O[0]=V;e:for(var W=0,J=O.length,ce=J>>>1;W<ce;){var $=2*(W+1)-1,ne=O[$],ie=$+1,de=O[ie];if(0>n(ne,V))ie<J&&0>n(de,ne)?(O[W]=de,O[ie]=V,W=ie):(O[W]=ne,O[$]=V,W=$);else if(ie<J&&0>n(de,V))O[W]=de,O[ie]=V,W=ie;else break e}}return j}function n(O,j){var V=O.sortIndex-j.sortIndex;return V!==0?V:O.id-j.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;e.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();e.unstable_now=function(){return a.now()-o}}var l=[],c=[],u=1,h=null,d=3,p=!1,f=!1,v=!1,g=typeof setTimeout=="function"?setTimeout:null,m=typeof clearTimeout=="function"?clearTimeout:null,x=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function w(O){for(var j=i(c);j!==null;){if(j.callback===null)r(c);else if(j.startTime<=O)r(c),j.sortIndex=j.expirationTime,t(l,j);else break;j=i(c)}}function _(O){if(v=!1,w(O),!f)if(i(l)!==null)f=!0,Q(M);else{var j=i(c);j!==null&&Y(_,j.startTime-O)}}function M(O,j){f=!1,v&&(v=!1,m(T),T=-1),p=!0;var V=d;try{for(w(j),h=i(l);h!==null&&(!(h.expirationTime>j)||O&&!D());){var W=h.callback;if(typeof W=="function"){h.callback=null,d=h.priorityLevel;var J=W(h.expirationTime<=j);j=e.unstable_now(),typeof J=="function"?h.callback=J:h===i(l)&&r(l),w(j)}else r(l);h=i(l)}if(h!==null)var ce=!0;else{var $=i(c);$!==null&&Y(_,$.startTime-j),ce=!1}return ce}finally{h=null,d=V,p=!1}}var S=!1,A=null,T=-1,E=5,C=-1;function D(){return!(e.unstable_now()-C<E)}function I(){if(A!==null){var O=e.unstable_now();C=O;var j=!0;try{j=A(!0,O)}finally{j?L():(S=!1,A=null)}}else S=!1}var L;if(typeof x=="function")L=function(){x(I)};else if(typeof MessageChannel<"u"){var z=new MessageChannel,F=z.port2;z.port1.onmessage=I,L=function(){F.postMessage(null)}}else L=function(){g(I,0)};function Q(O){A=O,S||(S=!0,L())}function Y(O,j){T=g(function(){O(e.unstable_now())},j)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(O){O.callback=null},e.unstable_continueExecution=function(){f||p||(f=!0,Q(M))},e.unstable_forceFrameRate=function(O){0>O||125<O?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):E=0<O?Math.floor(1e3/O):5},e.unstable_getCurrentPriorityLevel=function(){return d},e.unstable_getFirstCallbackNode=function(){return i(l)},e.unstable_next=function(O){switch(d){case 1:case 2:case 3:var j=3;break;default:j=d}var V=d;d=j;try{return O()}finally{d=V}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(O,j){switch(O){case 1:case 2:case 3:case 4:case 5:break;default:O=3}var V=d;d=O;try{return j()}finally{d=V}},e.unstable_scheduleCallback=function(O,j,V){var W=e.unstable_now();switch(typeof V=="object"&&V!==null?(V=V.delay,V=typeof V=="number"&&0<V?W+V:W):V=W,O){case 1:var J=-1;break;case 2:J=250;break;case 5:J=1073741823;break;case 4:J=1e4;break;default:J=5e3}return J=V+J,O={id:u++,callback:j,priorityLevel:O,startTime:V,expirationTime:J,sortIndex:-1},V>W?(O.sortIndex=V,t(c,O),i(l)===null&&O===i(c)&&(v?(m(T),T=-1):v=!0,Y(_,V-W))):(O.sortIndex=J,t(l,O),f||p||(f=!0,Q(M))),O},e.unstable_shouldYield=D,e.unstable_wrapCallback=function(O){var j=d;return function(){var V=d;d=j;try{return O.apply(this,arguments)}finally{d=V}}}}(fI)),fI}var R9;function HFe(){return R9||(R9=1,pI.exports=VFe()),pI.exports}/**
 * @license React
 * react-reconciler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var GFe=function(t){var i={},r=qe,n=HFe(),s=Object.assign;function a(y){for(var b="https://reactjs.org/docs/error-decoder.html?invariant="+y,P=1;P<arguments.length;P++)b+="&args[]="+encodeURIComponent(arguments[P]);return"Minified React error #"+y+"; visit "+b+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,l=Symbol.for("react.element"),c=Symbol.for("react.portal"),u=Symbol.for("react.fragment"),h=Symbol.for("react.strict_mode"),d=Symbol.for("react.profiler"),p=Symbol.for("react.provider"),f=Symbol.for("react.context"),v=Symbol.for("react.forward_ref"),g=Symbol.for("react.suspense"),m=Symbol.for("react.suspense_list"),x=Symbol.for("react.memo"),w=Symbol.for("react.lazy"),_=Symbol.for("react.offscreen"),M=Symbol.iterator;function S(y){return y===null||typeof y!="object"?null:(y=M&&y[M]||y["@@iterator"],typeof y=="function"?y:null)}function A(y){if(y==null)return null;if(typeof y=="function")return y.displayName||y.name||null;if(typeof y=="string")return y;switch(y){case u:return"Fragment";case c:return"Portal";case d:return"Profiler";case h:return"StrictMode";case g:return"Suspense";case m:return"SuspenseList"}if(typeof y=="object")switch(y.$$typeof){case f:return(y.displayName||"Context")+".Consumer";case p:return(y._context.displayName||"Context")+".Provider";case v:var b=y.render;return y=y.displayName,y||(y=b.displayName||b.name||"",y=y!==""?"ForwardRef("+y+")":"ForwardRef"),y;case x:return b=y.displayName||null,b!==null?b:A(y.type)||"Memo";case w:b=y._payload,y=y._init;try{return A(y(b))}catch{}}return null}function T(y){var b=y.type;switch(y.tag){case 24:return"Cache";case 9:return(b.displayName||"Context")+".Consumer";case 10:return(b._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return y=b.render,y=y.displayName||y.name||"",b.displayName||(y!==""?"ForwardRef("+y+")":"ForwardRef");case 7:return"Fragment";case 5:return b;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return A(b);case 8:return b===h?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof b=="function")return b.displayName||b.name||null;if(typeof b=="string")return b}return null}function E(y){var b=y,P=y;if(y.alternate)for(;b.return;)b=b.return;else{y=b;do b=y,b.flags&4098&&(P=b.return),y=b.return;while(y)}return b.tag===3?P:null}function C(y){if(E(y)!==y)throw Error(a(188))}function D(y){var b=y.alternate;if(!b){if(b=E(y),b===null)throw Error(a(188));return b!==y?null:y}for(var P=y,R=b;;){var N=P.return;if(N===null)break;var U=N.alternate;if(U===null){if(R=N.return,R!==null){P=R;continue}break}if(N.child===U.child){for(U=N.child;U;){if(U===P)return C(N),y;if(U===R)return C(N),b;U=U.sibling}throw Error(a(188))}if(P.return!==R.return)P=N,R=U;else{for(var pe=!1,Re=N.child;Re;){if(Re===P){pe=!0,P=N,R=U;break}if(Re===R){pe=!0,R=N,P=U;break}Re=Re.sibling}if(!pe){for(Re=U.child;Re;){if(Re===P){pe=!0,P=U,R=N;break}if(Re===R){pe=!0,R=U,P=N;break}Re=Re.sibling}if(!pe)throw Error(a(189))}}if(P.alternate!==R)throw Error(a(190))}if(P.tag!==3)throw Error(a(188));return P.stateNode.current===P?y:b}function I(y){return y=D(y),y!==null?L(y):null}function L(y){if(y.tag===5||y.tag===6)return y;for(y=y.child;y!==null;){var b=L(y);if(b!==null)return b;y=y.sibling}return null}function z(y){if(y.tag===5||y.tag===6)return y;for(y=y.child;y!==null;){if(y.tag!==4){var b=z(y);if(b!==null)return b}y=y.sibling}return null}var F=Array.isArray,Q=t.getPublicInstance,Y=t.getRootHostContext,O=t.getChildHostContext,j=t.prepareForCommit,V=t.resetAfterCommit,W=t.createInstance,J=t.appendInitialChild,ce=t.finalizeInitialChildren,$=t.prepareUpdate,ne=t.shouldSetTextContent,ie=t.createTextInstance,de=t.scheduleTimeout,be=t.cancelTimeout,we=t.noTimeout,_e=t.isPrimaryRenderer,Me=t.supportsMutation,X=t.supportsPersistence,ge=t.supportsHydration,Oe=t.getInstanceFromNode,Ie=t.preparePortalMount,Pe=t.getCurrentEventPriority,Ye=t.detachDeletedInstance,ke=t.supportsMicrotasks,Fe=t.scheduleMicrotask,se=t.supportsTestSelectors,Z=t.findFiberRoot,K=t.getBoundingRect,k=t.getTextContent,re=t.isHiddenSubtree,he=t.matchAccessibilityRole,G=t.setFocusIfFocusable,Te=t.setupIntersectionObserver,ze=t.appendChild,Qe=t.appendChildToContainer,ye=t.commitTextUpdate,je=t.commitMount,nt=t.commitUpdate,ct=t.insertBefore,tt=t.insertInContainerBefore,ue=t.removeChild,Ue=t.removeChildFromContainer,dt=t.resetTextContent,xe=t.hideInstance,ae=t.hideTextInstance,fe=t.unhideInstance,Se=t.unhideTextInstance,Ne=t.clearContainer,st=t.cloneInstance,vt=t.createContainerChildSet,Ut=t.appendChildToContainerChildSet,Wt=t.finalizeContainerChildren,Jt=t.replaceContainerChildren,ci=t.cloneHiddenInstance,Ki=t.cloneHiddenTextInstance,Tn=t.canHydrateInstance,Ps=t.canHydrateTextInstance,eu=t.canHydrateSuspenseInstance,tu=t.isSuspenseInstancePending,bo=t.isSuspenseInstanceFallback,le=t.registerSuspenseInstanceRetry,Ge=t.getNextHydratableSibling,$e=t.getFirstHydratableChild,Ve=t.getFirstHydratableChildWithinContainer,et=t.getFirstHydratableChildWithinSuspenseInstance,Ot=t.hydrateInstance,ri=t.hydrateTextInstance,oi=t.hydrateSuspenseInstance,ee=t.getNextHydratableInstanceAfterSuspenseInstance,Ce=t.commitHydratedContainer,De=t.commitHydratedSuspenseInstance,Le=t.clearSuspenseBoundary,Ee=t.clearSuspenseBoundaryFromContainer,pt=t.shouldDeleteUnhydratedTailInstances,bt=t.didNotMatchHydratedContainerTextInstance,Ct=t.didNotMatchHydratedTextInstance,yt;function gt(y){if(yt===void 0)try{throw Error()}catch(P){var b=P.stack.trim().match(/\n( *(at )?)/);yt=b&&b[1]||""}return`
`+yt+y}var zt=!1;function ft(y,b){if(!y||zt)return"";zt=!0;var P=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(b)if(b=function(){throw Error()},Object.defineProperty(b.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(b,[])}catch(xt){var R=xt}Reflect.construct(y,[],b)}else{try{b.call()}catch(xt){R=xt}y.call(b.prototype)}else{try{throw Error()}catch(xt){R=xt}y()}}catch(xt){if(xt&&R&&typeof xt.stack=="string"){for(var N=xt.stack.split(`
`),U=R.stack.split(`
`),pe=N.length-1,Re=U.length-1;1<=pe&&0<=Re&&N[pe]!==U[Re];)Re--;for(;1<=pe&&0<=Re;pe--,Re--)if(N[pe]!==U[Re]){if(pe!==1||Re!==1)do if(pe--,Re--,0>Re||N[pe]!==U[Re]){var Je=`
`+N[pe].replace(" at new "," at ");return y.displayName&&Je.includes("<anonymous>")&&(Je=Je.replace("<anonymous>",y.displayName)),Je}while(1<=pe&&0<=Re);break}}}finally{zt=!1,Error.prepareStackTrace=P}return(y=y?y.displayName||y.name:"")?gt(y):""}var gi=Object.prototype.hasOwnProperty,Ii=[],Ei=-1;function zi(y){return{current:y}}function H(y){0>Ei||(y.current=Ii[Ei],Ii[Ei]=null,Ei--)}function q(y,b){Ei++,Ii[Ei]=y.current,y.current=b}var me={},te=zi(me),Ae=zi(!1),ut=me;function Zi(y,b){var P=y.type.contextTypes;if(!P)return me;var R=y.stateNode;if(R&&R.__reactInternalMemoizedUnmaskedChildContext===b)return R.__reactInternalMemoizedMaskedChildContext;var N={},U;for(U in P)N[U]=b[U];return R&&(y=y.stateNode,y.__reactInternalMemoizedUnmaskedChildContext=b,y.__reactInternalMemoizedMaskedChildContext=N),N}function Fr(y){return y=y.childContextTypes,y!=null}function $i(){H(Ae),H(te)}function ea(y,b,P){if(te.current!==me)throw Error(a(168));q(te,b),q(Ae,P)}function ol(y,b,P){var R=y.stateNode;if(b=b.childContextTypes,typeof R.getChildContext!="function")return P;R=R.getChildContext();for(var N in R)if(!(N in b))throw Error(a(108,T(y)||"Unknown",N));return s({},P,R)}function Jr(y){return y=(y=y.stateNode)&&y.__reactInternalMemoizedMergedChildContext||me,ut=te.current,q(te,y),q(Ae,Ae.current),!0}function pm(y,b,P){var R=y.stateNode;if(!R)throw Error(a(169));P?(y=ol(y,b,ut),R.__reactInternalMemoizedMergedChildContext=y,H(Ae),H(te),q(te,y)):H(Ae),q(Ae,P)}var Qa=Math.clz32?Math.clz32:ere,pb=Math.log,Jie=Math.LN2;function ere(y){return y>>>=0,y===0?32:31-(pb(y)/Jie|0)|0}var fb=64,mb=4194304;function X0(y){switch(y&-y){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return y&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return y&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return y}}function gb(y,b){var P=y.pendingLanes;if(P===0)return 0;var R=0,N=y.suspendedLanes,U=y.pingedLanes,pe=P&268435455;if(pe!==0){var Re=pe&~N;Re!==0?R=X0(Re):(U&=pe,U!==0&&(R=X0(U)))}else pe=P&~N,pe!==0?R=X0(pe):U!==0&&(R=X0(U));if(R===0)return 0;if(b!==0&&b!==R&&!(b&N)&&(N=R&-R,U=b&-b,N>=U||N===16&&(U&4194240)!==0))return b;if(R&4&&(R|=P&16),b=y.entangledLanes,b!==0)for(y=y.entanglements,b&=R;0<b;)P=31-Qa(b),N=1<<P,R|=y[P],b&=~N;return R}function tre(y,b){switch(y){case 1:case 2:case 4:return b+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return b+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ire(y,b){for(var P=y.suspendedLanes,R=y.pingedLanes,N=y.expirationTimes,U=y.pendingLanes;0<U;){var pe=31-Qa(U),Re=1<<pe,Je=N[pe];Je===-1?(!(Re&P)||Re&R)&&(N[pe]=tre(Re,b)):Je<=b&&(y.expiredLanes|=Re),U&=~Re}}function W2(y){return y=y.pendingLanes&-1073741825,y!==0?y:y&1073741824?1073741824:0}function X2(y){for(var b=[],P=0;31>P;P++)b.push(y);return b}function q0(y,b,P){y.pendingLanes|=b,b!==536870912&&(y.suspendedLanes=0,y.pingedLanes=0),y=y.eventTimes,b=31-Qa(b),y[b]=P}function rre(y,b){var P=y.pendingLanes&~b;y.pendingLanes=b,y.suspendedLanes=0,y.pingedLanes=0,y.expiredLanes&=b,y.mutableReadLanes&=b,y.entangledLanes&=b,b=y.entanglements;var R=y.eventTimes;for(y=y.expirationTimes;0<P;){var N=31-Qa(P),U=1<<N;b[N]=0,R[N]=-1,y[N]=-1,P&=~U}}function q2(y,b){var P=y.entangledLanes|=b;for(y=y.entanglements;P;){var R=31-Qa(P),N=1<<R;N&b|y[R]&b&&(y[R]|=b),P&=~N}}var Fi=0;function JU(y){return y&=-y,1<y?4<y?y&268435455?16:536870912:4:1}var Y2=n.unstable_scheduleCallback,eF=n.unstable_cancelCallback,nre=n.unstable_shouldYield,sre=n.unstable_requestPaint,jn=n.unstable_now,Q2=n.unstable_ImmediatePriority,are=n.unstable_UserBlockingPriority,K2=n.unstable_NormalPriority,ore=n.unstable_IdlePriority,vb=null,Zl=null;function lre(y){if(Zl&&typeof Zl.onCommitFiberRoot=="function")try{Zl.onCommitFiberRoot(vb,y,void 0,(y.current.flags&128)===128)}catch{}}function cre(y,b){return y===b&&(y!==0||1/y===1/b)||y!==y&&b!==b}var $l=typeof Object.is=="function"?Object.is:cre,iu=null,yb=!1,Z2=!1;function tF(y){iu===null?iu=[y]:iu.push(y)}function ure(y){yb=!0,tF(y)}function Jl(){if(!Z2&&iu!==null){Z2=!0;var y=0,b=Fi;try{var P=iu;for(Fi=1;y<P.length;y++){var R=P[y];do R=R(!0);while(R!==null)}iu=null,yb=!1}catch(N){throw iu!==null&&(iu=iu.slice(y+1)),Y2(Q2,Jl),N}finally{Fi=b,Z2=!1}}return null}var hre=o.ReactCurrentBatchConfig;function xb(y,b){if($l(y,b))return!0;if(typeof y!="object"||y===null||typeof b!="object"||b===null)return!1;var P=Object.keys(y),R=Object.keys(b);if(P.length!==R.length)return!1;for(R=0;R<P.length;R++){var N=P[R];if(!gi.call(b,N)||!$l(y[N],b[N]))return!1}return!0}function dre(y){switch(y.tag){case 5:return gt(y.type);case 16:return gt("Lazy");case 13:return gt("Suspense");case 19:return gt("SuspenseList");case 0:case 2:case 15:return y=ft(y.type,!1),y;case 11:return y=ft(y.type.render,!1),y;case 1:return y=ft(y.type,!0),y;default:return""}}function ll(y,b){if(y&&y.defaultProps){b=s({},b),y=y.defaultProps;for(var P in y)b[P]===void 0&&(b[P]=y[P]);return b}return b}var wb=zi(null),bb=null,fm=null,$2=null;function J2(){$2=fm=bb=null}function iF(y,b,P){_e?(q(wb,b._currentValue),b._currentValue=P):(q(wb,b._currentValue2),b._currentValue2=P)}function eP(y){var b=wb.current;H(wb),_e?y._currentValue=b:y._currentValue2=b}function tP(y,b,P){for(;y!==null;){var R=y.alternate;if((y.childLanes&b)!==b?(y.childLanes|=b,R!==null&&(R.childLanes|=b)):R!==null&&(R.childLanes&b)!==b&&(R.childLanes|=b),y===P)break;y=y.return}}function mm(y,b){bb=y,$2=fm=null,y=y.dependencies,y!==null&&y.firstContext!==null&&(y.lanes&b&&($a=!0),y.firstContext=null)}function _o(y){var b=_e?y._currentValue:y._currentValue2;if($2!==y)if(y={context:y,memoizedValue:b,next:null},fm===null){if(bb===null)throw Error(a(308));fm=y,bb.dependencies={lanes:0,firstContext:y}}else fm=fm.next=y;return b}var ec=null,Ch=!1;function iP(y){y.updateQueue={baseState:y.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function rF(y,b){y=y.updateQueue,b.updateQueue===y&&(b.updateQueue={baseState:y.baseState,firstBaseUpdate:y.firstBaseUpdate,lastBaseUpdate:y.lastBaseUpdate,shared:y.shared,effects:y.effects})}function ru(y,b){return{eventTime:y,lane:b,tag:0,payload:null,callback:null,next:null}}function Th(y,b){var P=y.updateQueue;P!==null&&(P=P.shared,dn!==null&&y.mode&1&&!(Mi&2)?(y=P.interleaved,y===null?(b.next=b,ec===null?ec=[P]:ec.push(P)):(b.next=y.next,y.next=b),P.interleaved=b):(y=P.pending,y===null?b.next=b:(b.next=y.next,y.next=b),P.pending=b))}function _b(y,b,P){if(b=b.updateQueue,b!==null&&(b=b.shared,(P&4194240)!==0)){var R=b.lanes;R&=y.pendingLanes,P|=R,b.lanes=P,q2(y,P)}}function nF(y,b){var P=y.updateQueue,R=y.alternate;if(R!==null&&(R=R.updateQueue,P===R)){var N=null,U=null;if(P=P.firstBaseUpdate,P!==null){do{var pe={eventTime:P.eventTime,lane:P.lane,tag:P.tag,payload:P.payload,callback:P.callback,next:null};U===null?N=U=pe:U=U.next=pe,P=P.next}while(P!==null);U===null?N=U=b:U=U.next=b}else N=U=b;P={baseState:R.baseState,firstBaseUpdate:N,lastBaseUpdate:U,shared:R.shared,effects:R.effects},y.updateQueue=P;return}y=P.lastBaseUpdate,y===null?P.firstBaseUpdate=b:y.next=b,P.lastBaseUpdate=b}function Sb(y,b,P,R){var N=y.updateQueue;Ch=!1;var U=N.firstBaseUpdate,pe=N.lastBaseUpdate,Re=N.shared.pending;if(Re!==null){N.shared.pending=null;var Je=Re,xt=Je.next;Je.next=null,pe===null?U=xt:pe.next=xt,pe=Je;var Lt=y.alternate;Lt!==null&&(Lt=Lt.updateQueue,Re=Lt.lastBaseUpdate,Re!==pe&&(Re===null?Lt.firstBaseUpdate=xt:Re.next=xt,Lt.lastBaseUpdate=Je))}if(U!==null){var fi=N.baseState;pe=0,Lt=xt=Je=null,Re=U;do{var Qt=Re.lane,pr=Re.eventTime;if((R&Qt)===Qt){Lt!==null&&(Lt=Lt.next={eventTime:pr,lane:0,tag:Re.tag,payload:Re.payload,callback:Re.callback,next:null});e:{var Vt=y,Ls=Re;switch(Qt=b,pr=P,Ls.tag){case 1:if(Vt=Ls.payload,typeof Vt=="function"){fi=Vt.call(pr,fi,Qt);break e}fi=Vt;break e;case 3:Vt.flags=Vt.flags&-65537|128;case 0:if(Vt=Ls.payload,Qt=typeof Vt=="function"?Vt.call(pr,fi,Qt):Vt,Qt==null)break e;fi=s({},fi,Qt);break e;case 2:Ch=!0}}Re.callback!==null&&Re.lane!==0&&(y.flags|=64,Qt=N.effects,Qt===null?N.effects=[Re]:Qt.push(Re))}else pr={eventTime:pr,lane:Qt,tag:Re.tag,payload:Re.payload,callback:Re.callback,next:null},Lt===null?(xt=Lt=pr,Je=fi):Lt=Lt.next=pr,pe|=Qt;if(Re=Re.next,Re===null){if(Re=N.shared.pending,Re===null)break;Qt=Re,Re=Qt.next,Qt.next=null,N.lastBaseUpdate=Qt,N.shared.pending=null}}while(!0);if(Lt===null&&(Je=fi),N.baseState=Je,N.firstBaseUpdate=xt,N.lastBaseUpdate=Lt,b=N.shared.interleaved,b!==null){N=b;do pe|=N.lane,N=N.next;while(N!==b)}else U===null&&(N.shared.lanes=0);Mm|=pe,y.lanes=pe,y.memoizedState=fi}}function sF(y,b,P){if(y=b.effects,b.effects=null,y!==null)for(b=0;b<y.length;b++){var R=y[b],N=R.callback;if(N!==null){if(R.callback=null,R=P,typeof N!="function")throw Error(a(191,N));N.call(R)}}}var aF=new r.Component().refs;function rP(y,b,P,R){b=y.memoizedState,P=P(R,b),P=P==null?b:s({},b,P),y.memoizedState=P,y.lanes===0&&(y.updateQueue.baseState=P)}var Mb={isMounted:function(y){return(y=y._reactInternals)?E(y)===y:!1},enqueueSetState:function(y,b,P){y=y._reactInternals;var R=ia(),N=Rh(y),U=ru(R,N);U.payload=b,P!=null&&(U.callback=P),Th(y,U),b=Co(y,N,R),b!==null&&_b(b,y,N)},enqueueReplaceState:function(y,b,P){y=y._reactInternals;var R=ia(),N=Rh(y),U=ru(R,N);U.tag=1,U.payload=b,P!=null&&(U.callback=P),Th(y,U),b=Co(y,N,R),b!==null&&_b(b,y,N)},enqueueForceUpdate:function(y,b){y=y._reactInternals;var P=ia(),R=Rh(y),N=ru(P,R);N.tag=2,b!=null&&(N.callback=b),Th(y,N),b=Co(y,R,P),b!==null&&_b(b,y,R)}};function oF(y,b,P,R,N,U,pe){return y=y.stateNode,typeof y.shouldComponentUpdate=="function"?y.shouldComponentUpdate(R,U,pe):b.prototype&&b.prototype.isPureReactComponent?!xb(P,R)||!xb(N,U):!0}function lF(y,b,P){var R=!1,N=me,U=b.contextType;return typeof U=="object"&&U!==null?U=_o(U):(N=Fr(b)?ut:te.current,R=b.contextTypes,U=(R=R!=null)?Zi(y,N):me),b=new b(P,U),y.memoizedState=b.state!==null&&b.state!==void 0?b.state:null,b.updater=Mb,y.stateNode=b,b._reactInternals=y,R&&(y=y.stateNode,y.__reactInternalMemoizedUnmaskedChildContext=N,y.__reactInternalMemoizedMaskedChildContext=U),b}function cF(y,b,P,R){y=b.state,typeof b.componentWillReceiveProps=="function"&&b.componentWillReceiveProps(P,R),typeof b.UNSAFE_componentWillReceiveProps=="function"&&b.UNSAFE_componentWillReceiveProps(P,R),b.state!==y&&Mb.enqueueReplaceState(b,b.state,null)}function nP(y,b,P,R){var N=y.stateNode;N.props=P,N.state=y.memoizedState,N.refs=aF,iP(y);var U=b.contextType;typeof U=="object"&&U!==null?N.context=_o(U):(U=Fr(b)?ut:te.current,N.context=Zi(y,U)),N.state=y.memoizedState,U=b.getDerivedStateFromProps,typeof U=="function"&&(rP(y,b,U,P),N.state=y.memoizedState),typeof b.getDerivedStateFromProps=="function"||typeof N.getSnapshotBeforeUpdate=="function"||typeof N.UNSAFE_componentWillMount!="function"&&typeof N.componentWillMount!="function"||(b=N.state,typeof N.componentWillMount=="function"&&N.componentWillMount(),typeof N.UNSAFE_componentWillMount=="function"&&N.UNSAFE_componentWillMount(),b!==N.state&&Mb.enqueueReplaceState(N,N.state,null),Sb(y,P,N,R),N.state=y.memoizedState),typeof N.componentDidMount=="function"&&(y.flags|=4194308)}var gm=[],vm=0,Eb=null,Ab=0,So=[],Mo=0,cp=null,nu=1,su="";function up(y,b){gm[vm++]=Ab,gm[vm++]=Eb,Eb=y,Ab=b}function uF(y,b,P){So[Mo++]=nu,So[Mo++]=su,So[Mo++]=cp,cp=y;var R=nu;y=su;var N=32-Qa(R)-1;R&=~(1<<N),P+=1;var U=32-Qa(b)+N;if(30<U){var pe=N-N%5;U=(R&(1<<pe)-1).toString(32),R>>=pe,N-=pe,nu=1<<32-Qa(b)+N|P<<N|R,su=U+y}else nu=1<<U|P<<N|R,su=y}function sP(y){y.return!==null&&(up(y,1),uF(y,1,0))}function aP(y){for(;y===Eb;)Eb=gm[--vm],gm[vm]=null,Ab=gm[--vm],gm[vm]=null;for(;y===cp;)cp=So[--Mo],So[Mo]=null,su=So[--Mo],So[Mo]=null,nu=So[--Mo],So[Mo]=null}var Ka=null,Za=null,Tr=!1,Y0=!1,cl=null;function hF(y,b){var P=To(5,null,null,0);P.elementType="DELETED",P.stateNode=b,P.return=y,b=y.deletions,b===null?(y.deletions=[P],y.flags|=16):b.push(P)}function dF(y,b){switch(y.tag){case 5:return b=Tn(b,y.type,y.pendingProps),b!==null?(y.stateNode=b,Ka=y,Za=$e(b),!0):!1;case 6:return b=Ps(b,y.pendingProps),b!==null?(y.stateNode=b,Ka=y,Za=null,!0):!1;case 13:if(b=eu(b),b!==null){var P=cp!==null?{id:nu,overflow:su}:null;return y.memoizedState={dehydrated:b,treeContext:P,retryLane:1073741824},P=To(18,null,null,0),P.stateNode=b,P.return=y,y.child=P,Ka=y,Za=null,!0}return!1;default:return!1}}function oP(y){return(y.mode&1)!==0&&(y.flags&128)===0}function lP(y){if(Tr){var b=Za;if(b){var P=b;if(!dF(y,b)){if(oP(y))throw Error(a(418));b=Ge(P);var R=Ka;b&&dF(y,b)?hF(R,P):(y.flags=y.flags&-4097|2,Tr=!1,Ka=y)}}else{if(oP(y))throw Error(a(418));y.flags=y.flags&-4097|2,Tr=!1,Ka=y}}}function pF(y){for(y=y.return;y!==null&&y.tag!==5&&y.tag!==3&&y.tag!==13;)y=y.return;Ka=y}function Q0(y){if(!ge||y!==Ka)return!1;if(!Tr)return pF(y),Tr=!0,!1;if(y.tag!==3&&(y.tag!==5||pt(y.type)&&!ne(y.type,y.memoizedProps))){var b=Za;if(b){if(oP(y)){for(y=Za;y;)y=Ge(y);throw Error(a(418))}for(;b;)hF(y,b),b=Ge(b)}}if(pF(y),y.tag===13){if(!ge)throw Error(a(316));if(y=y.memoizedState,y=y!==null?y.dehydrated:null,!y)throw Error(a(317));Za=ee(y)}else Za=Ka?Ge(y.stateNode):null;return!0}function ym(){ge&&(Za=Ka=null,Y0=Tr=!1)}function cP(y){cl===null?cl=[y]:cl.push(y)}function K0(y,b,P){if(y=P.ref,y!==null&&typeof y!="function"&&typeof y!="object"){if(P._owner){if(P=P._owner,P){if(P.tag!==1)throw Error(a(309));var R=P.stateNode}if(!R)throw Error(a(147,y));var N=R,U=""+y;return b!==null&&b.ref!==null&&typeof b.ref=="function"&&b.ref._stringRef===U?b.ref:(b=function(pe){var Re=N.refs;Re===aF&&(Re=N.refs={}),pe===null?delete Re[U]:Re[U]=pe},b._stringRef=U,b)}if(typeof y!="string")throw Error(a(284));if(!P._owner)throw Error(a(290,y))}return y}function Cb(y,b){throw y=Object.prototype.toString.call(b),Error(a(31,y==="[object Object]"?"object with keys {"+Object.keys(b).join(", ")+"}":y))}function fF(y){var b=y._init;return b(y._payload)}function mF(y){function b(We,Be){if(y){var Ke=We.deletions;Ke===null?(We.deletions=[Be],We.flags|=16):Ke.push(Be)}}function P(We,Be){if(!y)return null;for(;Be!==null;)b(We,Be),Be=Be.sibling;return null}function R(We,Be){for(We=new Map;Be!==null;)Be.key!==null?We.set(Be.key,Be):We.set(Be.index,Be),Be=Be.sibling;return We}function N(We,Be){return We=Lh(We,Be),We.index=0,We.sibling=null,We}function U(We,Be,Ke){return We.index=Ke,y?(Ke=We.alternate,Ke!==null?(Ke=Ke.index,Ke<Be?(We.flags|=2,Be):Ke):(We.flags|=2,Be)):(We.flags|=1048576,Be)}function pe(We){return y&&We.alternate===null&&(We.flags|=2),We}function Re(We,Be,Ke,Pt){return Be===null||Be.tag!==6?(Be=XP(Ke,We.mode,Pt),Be.return=We,Be):(Be=N(Be,Ke),Be.return=We,Be)}function Je(We,Be,Ke,Pt){var Ft=Ke.type;return Ft===u?Lt(We,Be,Ke.props.children,Pt,Ke.key):Be!==null&&(Be.elementType===Ft||typeof Ft=="object"&&Ft!==null&&Ft.$$typeof===w&&fF(Ft)===Be.type)?(Pt=N(Be,Ke.props),Pt.ref=K0(We,Be,Ke),Pt.return=We,Pt):(Pt=n_(Ke.type,Ke.key,Ke.props,null,We.mode,Pt),Pt.ref=K0(We,Be,Ke),Pt.return=We,Pt)}function xt(We,Be,Ke,Pt){return Be===null||Be.tag!==4||Be.stateNode.containerInfo!==Ke.containerInfo||Be.stateNode.implementation!==Ke.implementation?(Be=qP(Ke,We.mode,Pt),Be.return=We,Be):(Be=N(Be,Ke.children||[]),Be.return=We,Be)}function Lt(We,Be,Ke,Pt,Ft){return Be===null||Be.tag!==7?(Be=vp(Ke,We.mode,Pt,Ft),Be.return=We,Be):(Be=N(Be,Ke),Be.return=We,Be)}function fi(We,Be,Ke){if(typeof Be=="string"&&Be!==""||typeof Be=="number")return Be=XP(""+Be,We.mode,Ke),Be.return=We,Be;if(typeof Be=="object"&&Be!==null){switch(Be.$$typeof){case l:return Ke=n_(Be.type,Be.key,Be.props,null,We.mode,Ke),Ke.ref=K0(We,null,Be),Ke.return=We,Ke;case c:return Be=qP(Be,We.mode,Ke),Be.return=We,Be;case w:var Pt=Be._init;return fi(We,Pt(Be._payload),Ke)}if(F(Be)||S(Be))return Be=vp(Be,We.mode,Ke,null),Be.return=We,Be;Cb(We,Be)}return null}function Qt(We,Be,Ke,Pt){var Ft=Be!==null?Be.key:null;if(typeof Ke=="string"&&Ke!==""||typeof Ke=="number")return Ft!==null?null:Re(We,Be,""+Ke,Pt);if(typeof Ke=="object"&&Ke!==null){switch(Ke.$$typeof){case l:return Ke.key===Ft?Je(We,Be,Ke,Pt):null;case c:return Ke.key===Ft?xt(We,Be,Ke,Pt):null;case w:return Ft=Ke._init,Qt(We,Be,Ft(Ke._payload),Pt)}if(F(Ke)||S(Ke))return Ft!==null?null:Lt(We,Be,Ke,Pt,null);Cb(We,Ke)}return null}function pr(We,Be,Ke,Pt,Ft){if(typeof Pt=="string"&&Pt!==""||typeof Pt=="number")return We=We.get(Ke)||null,Re(Be,We,""+Pt,Ft);if(typeof Pt=="object"&&Pt!==null){switch(Pt.$$typeof){case l:return We=We.get(Pt.key===null?Ke:Pt.key)||null,Je(Be,We,Pt,Ft);case c:return We=We.get(Pt.key===null?Ke:Pt.key)||null,xt(Be,We,Pt,Ft);case w:var bi=Pt._init;return pr(We,Be,Ke,bi(Pt._payload),Ft)}if(F(Pt)||S(Pt))return We=We.get(Ke)||null,Lt(Be,We,Pt,Ft,null);Cb(Be,Pt)}return null}function Vt(We,Be,Ke,Pt){for(var Ft=null,bi=null,mi=Be,Vi=Be=0,Xn=null;mi!==null&&Vi<Ke.length;Vi++){mi.index>Vi?(Xn=mi,mi=null):Xn=mi.sibling;var Hi=Qt(We,mi,Ke[Vi],Pt);if(Hi===null){mi===null&&(mi=Xn);break}y&&mi&&Hi.alternate===null&&b(We,mi),Be=U(Hi,Be,Vi),bi===null?Ft=Hi:bi.sibling=Hi,bi=Hi,mi=Xn}if(Vi===Ke.length)return P(We,mi),Tr&&up(We,Vi),Ft;if(mi===null){for(;Vi<Ke.length;Vi++)mi=fi(We,Ke[Vi],Pt),mi!==null&&(Be=U(mi,Be,Vi),bi===null?Ft=mi:bi.sibling=mi,bi=mi);return Tr&&up(We,Vi),Ft}for(mi=R(We,mi);Vi<Ke.length;Vi++)Xn=pr(mi,We,Vi,Ke[Vi],Pt),Xn!==null&&(y&&Xn.alternate!==null&&mi.delete(Xn.key===null?Vi:Xn.key),Be=U(Xn,Be,Vi),bi===null?Ft=Xn:bi.sibling=Xn,bi=Xn);return y&&mi.forEach(function(Oh){return b(We,Oh)}),Tr&&up(We,Vi),Ft}function Ls(We,Be,Ke,Pt){var Ft=S(Ke);if(typeof Ft!="function")throw Error(a(150));if(Ke=Ft.call(Ke),Ke==null)throw Error(a(151));for(var bi=Ft=null,mi=Be,Vi=Be=0,Xn=null,Hi=Ke.next();mi!==null&&!Hi.done;Vi++,Hi=Ke.next()){mi.index>Vi?(Xn=mi,mi=null):Xn=mi.sibling;var Oh=Qt(We,mi,Hi.value,Pt);if(Oh===null){mi===null&&(mi=Xn);break}y&&mi&&Oh.alternate===null&&b(We,mi),Be=U(Oh,Be,Vi),bi===null?Ft=Oh:bi.sibling=Oh,bi=Oh,mi=Xn}if(Hi.done)return P(We,mi),Tr&&up(We,Vi),Ft;if(mi===null){for(;!Hi.done;Vi++,Hi=Ke.next())Hi=fi(We,Hi.value,Pt),Hi!==null&&(Be=U(Hi,Be,Vi),bi===null?Ft=Hi:bi.sibling=Hi,bi=Hi);return Tr&&up(We,Vi),Ft}for(mi=R(We,mi);!Hi.done;Vi++,Hi=Ke.next())Hi=pr(mi,We,Vi,Hi.value,Pt),Hi!==null&&(y&&Hi.alternate!==null&&mi.delete(Hi.key===null?Vi:Hi.key),Be=U(Hi,Be,Vi),bi===null?Ft=Hi:bi.sibling=Hi,bi=Hi);return y&&mi.forEach(function(Hre){return b(We,Hre)}),Tr&&up(We,Vi),Ft}function Po(We,Be,Ke,Pt){if(typeof Ke=="object"&&Ke!==null&&Ke.type===u&&Ke.key===null&&(Ke=Ke.props.children),typeof Ke=="object"&&Ke!==null){switch(Ke.$$typeof){case l:e:{for(var Ft=Ke.key,bi=Be;bi!==null;){if(bi.key===Ft){if(Ft=Ke.type,Ft===u){if(bi.tag===7){P(We,bi.sibling),Be=N(bi,Ke.props.children),Be.return=We,We=Be;break e}}else if(bi.elementType===Ft||typeof Ft=="object"&&Ft!==null&&Ft.$$typeof===w&&fF(Ft)===bi.type){P(We,bi.sibling),Be=N(bi,Ke.props),Be.ref=K0(We,bi,Ke),Be.return=We,We=Be;break e}P(We,bi);break}else b(We,bi);bi=bi.sibling}Ke.type===u?(Be=vp(Ke.props.children,We.mode,Pt,Ke.key),Be.return=We,We=Be):(Pt=n_(Ke.type,Ke.key,Ke.props,null,We.mode,Pt),Pt.ref=K0(We,Be,Ke),Pt.return=We,We=Pt)}return pe(We);case c:e:{for(bi=Ke.key;Be!==null;){if(Be.key===bi)if(Be.tag===4&&Be.stateNode.containerInfo===Ke.containerInfo&&Be.stateNode.implementation===Ke.implementation){P(We,Be.sibling),Be=N(Be,Ke.children||[]),Be.return=We,We=Be;break e}else{P(We,Be);break}else b(We,Be);Be=Be.sibling}Be=qP(Ke,We.mode,Pt),Be.return=We,We=Be}return pe(We);case w:return bi=Ke._init,Po(We,Be,bi(Ke._payload),Pt)}if(F(Ke))return Vt(We,Be,Ke,Pt);if(S(Ke))return Ls(We,Be,Ke,Pt);Cb(We,Ke)}return typeof Ke=="string"&&Ke!==""||typeof Ke=="number"?(Ke=""+Ke,Be!==null&&Be.tag===6?(P(We,Be.sibling),Be=N(Be,Ke),Be.return=We,We=Be):(P(We,Be),Be=XP(Ke,We.mode,Pt),Be.return=We,We=Be),pe(We)):P(We,Be)}return Po}var xm=mF(!0),gF=mF(!1),Z0={},Eo=zi(Z0),$0=zi(Z0),wm=zi(Z0);function tc(y){if(y===Z0)throw Error(a(174));return y}function uP(y,b){q(wm,b),q($0,y),q(Eo,Z0),y=Y(b),H(Eo),q(Eo,y)}function bm(){H(Eo),H($0),H(wm)}function vF(y){var b=tc(wm.current),P=tc(Eo.current);b=O(P,y.type,b),P!==b&&(q($0,y),q(Eo,b))}function hP(y){$0.current===y&&(H(Eo),H($0))}var Rr=zi(0);function Tb(y){for(var b=y;b!==null;){if(b.tag===13){var P=b.memoizedState;if(P!==null&&(P=P.dehydrated,P===null||tu(P)||bo(P)))return b}else if(b.tag===19&&b.memoizedProps.revealOrder!==void 0){if(b.flags&128)return b}else if(b.child!==null){b.child.return=b,b=b.child;continue}if(b===y)break;for(;b.sibling===null;){if(b.return===null||b.return===y)return null;b=b.return}b.sibling.return=b.return,b=b.sibling}return null}var dP=[];function pP(){for(var y=0;y<dP.length;y++){var b=dP[y];_e?b._workInProgressVersionPrimary=null:b._workInProgressVersionSecondary=null}dP.length=0}var Pb=o.ReactCurrentDispatcher,Ao=o.ReactCurrentBatchConfig,_m=0,Vr=null,Ds=null,Wn=null,Db=!1,J0=!1,ey=0,pre=0;function Rs(){throw Error(a(321))}function fP(y,b){if(b===null)return!1;for(var P=0;P<b.length&&P<y.length;P++)if(!$l(y[P],b[P]))return!1;return!0}function mP(y,b,P,R,N,U){if(_m=U,Vr=b,b.memoizedState=null,b.updateQueue=null,b.lanes=0,Pb.current=y===null||y.memoizedState===null?vre:yre,y=P(R,N),J0){U=0;do{if(J0=!1,ey=0,25<=U)throw Error(a(301));U+=1,Wn=Ds=null,b.updateQueue=null,Pb.current=xre,y=P(R,N)}while(J0)}if(Pb.current=zb,b=Ds!==null&&Ds.next!==null,_m=0,Wn=Ds=Vr=null,Db=!1,b)throw Error(a(300));return y}function gP(){var y=ey!==0;return ey=0,y}function au(){var y={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Wn===null?Vr.memoizedState=Wn=y:Wn=Wn.next=y,Wn}function ic(){if(Ds===null){var y=Vr.alternate;y=y!==null?y.memoizedState:null}else y=Ds.next;var b=Wn===null?Vr.memoizedState:Wn.next;if(b!==null)Wn=b,Ds=y;else{if(y===null)throw Error(a(310));Ds=y,y={memoizedState:Ds.memoizedState,baseState:Ds.baseState,baseQueue:Ds.baseQueue,queue:Ds.queue,next:null},Wn===null?Vr.memoizedState=Wn=y:Wn=Wn.next=y}return Wn}function hp(y,b){return typeof b=="function"?b(y):b}function Rb(y){var b=ic(),P=b.queue;if(P===null)throw Error(a(311));P.lastRenderedReducer=y;var R=Ds,N=R.baseQueue,U=P.pending;if(U!==null){if(N!==null){var pe=N.next;N.next=U.next,U.next=pe}R.baseQueue=N=U,P.pending=null}if(N!==null){U=N.next,R=R.baseState;var Re=pe=null,Je=null,xt=U;do{var Lt=xt.lane;if((_m&Lt)===Lt)Je!==null&&(Je=Je.next={lane:0,action:xt.action,hasEagerState:xt.hasEagerState,eagerState:xt.eagerState,next:null}),R=xt.hasEagerState?xt.eagerState:y(R,xt.action);else{var fi={lane:Lt,action:xt.action,hasEagerState:xt.hasEagerState,eagerState:xt.eagerState,next:null};Je===null?(Re=Je=fi,pe=R):Je=Je.next=fi,Vr.lanes|=Lt,Mm|=Lt}xt=xt.next}while(xt!==null&&xt!==U);Je===null?pe=R:Je.next=Re,$l(R,b.memoizedState)||($a=!0),b.memoizedState=R,b.baseState=pe,b.baseQueue=Je,P.lastRenderedState=R}if(y=P.interleaved,y!==null){N=y;do U=N.lane,Vr.lanes|=U,Mm|=U,N=N.next;while(N!==y)}else N===null&&(P.lanes=0);return[b.memoizedState,P.dispatch]}function Ib(y){var b=ic(),P=b.queue;if(P===null)throw Error(a(311));P.lastRenderedReducer=y;var R=P.dispatch,N=P.pending,U=b.memoizedState;if(N!==null){P.pending=null;var pe=N=N.next;do U=y(U,pe.action),pe=pe.next;while(pe!==N);$l(U,b.memoizedState)||($a=!0),b.memoizedState=U,b.baseQueue===null&&(b.baseState=U),P.lastRenderedState=U}return[U,R]}function yF(){}function xF(y,b){var P=Vr,R=ic(),N=b(),U=!$l(R.memoizedState,N);if(U&&(R.memoizedState=N,$a=!0),R=R.queue,iy(_F.bind(null,P,R,y),[y]),R.getSnapshot!==b||U||Wn!==null&&Wn.memoizedState.tag&1){if(P.flags|=2048,ty(9,bF.bind(null,P,R,N,b),void 0,null),dn===null)throw Error(a(349));_m&30||wF(P,b,N)}return N}function wF(y,b,P){y.flags|=16384,y={getSnapshot:b,value:P},b=Vr.updateQueue,b===null?(b={lastEffect:null,stores:null},Vr.updateQueue=b,b.stores=[y]):(P=b.stores,P===null?b.stores=[y]:P.push(y))}function bF(y,b,P,R){b.value=P,b.getSnapshot=R,SF(b)&&Co(y,1,-1)}function _F(y,b,P){return P(function(){SF(b)&&Co(y,1,-1)})}function SF(y){var b=y.getSnapshot;y=y.value;try{var P=b();return!$l(y,P)}catch{return!0}}function vP(y){var b=au();return typeof y=="function"&&(y=y()),b.memoizedState=b.baseState=y,y={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:hp,lastRenderedState:y},b.queue=y,y=y.dispatch=gre.bind(null,Vr,y),[b.memoizedState,y]}function ty(y,b,P,R){return y={tag:y,create:b,destroy:P,deps:R,next:null},b=Vr.updateQueue,b===null?(b={lastEffect:null,stores:null},Vr.updateQueue=b,b.lastEffect=y.next=y):(P=b.lastEffect,P===null?b.lastEffect=y.next=y:(R=P.next,P.next=y,y.next=R,b.lastEffect=y)),y}function MF(){return ic().memoizedState}function Lb(y,b,P,R){var N=au();Vr.flags|=y,N.memoizedState=ty(1|b,P,void 0,R===void 0?null:R)}function Ob(y,b,P,R){var N=ic();R=R===void 0?null:R;var U=void 0;if(Ds!==null){var pe=Ds.memoizedState;if(U=pe.destroy,R!==null&&fP(R,pe.deps)){N.memoizedState=ty(b,P,U,R);return}}Vr.flags|=y,N.memoizedState=ty(1|b,P,U,R)}function yP(y,b){return Lb(8390656,8,y,b)}function iy(y,b){return Ob(2048,8,y,b)}function EF(y,b){return Ob(4,2,y,b)}function AF(y,b){return Ob(4,4,y,b)}function CF(y,b){if(typeof b=="function")return y=y(),b(y),function(){b(null)};if(b!=null)return y=y(),b.current=y,function(){b.current=null}}function TF(y,b,P){return P=P!=null?P.concat([y]):null,Ob(4,4,CF.bind(null,b,y),P)}function xP(){}function PF(y,b){var P=ic();b=b===void 0?null:b;var R=P.memoizedState;return R!==null&&b!==null&&fP(b,R[1])?R[0]:(P.memoizedState=[y,b],y)}function DF(y,b){var P=ic();b=b===void 0?null:b;var R=P.memoizedState;return R!==null&&b!==null&&fP(b,R[1])?R[0]:(y=y(),P.memoizedState=[y,b],y)}function fre(y,b){var P=Fi;Fi=P!==0&&4>P?P:4,y(!0);var R=Ao.transition;Ao.transition={};try{y(!1),b()}finally{Fi=P,Ao.transition=R}}function RF(){return ic().memoizedState}function mre(y,b,P){var R=Rh(y);P={lane:R,action:P,hasEagerState:!1,eagerState:null,next:null},IF(y)?LF(b,P):(OF(y,b,P),P=ia(),y=Co(y,R,P),y!==null&&zF(y,b,R))}function gre(y,b,P){var R=Rh(y),N={lane:R,action:P,hasEagerState:!1,eagerState:null,next:null};if(IF(y))LF(b,N);else{OF(y,b,N);var U=y.alternate;if(y.lanes===0&&(U===null||U.lanes===0)&&(U=b.lastRenderedReducer,U!==null))try{var pe=b.lastRenderedState,Re=U(pe,P);if(N.hasEagerState=!0,N.eagerState=Re,$l(Re,pe))return}catch{}finally{}P=ia(),y=Co(y,R,P),y!==null&&zF(y,b,R)}}function IF(y){var b=y.alternate;return y===Vr||b!==null&&b===Vr}function LF(y,b){J0=Db=!0;var P=y.pending;P===null?b.next=b:(b.next=P.next,P.next=b),y.pending=b}function OF(y,b,P){dn!==null&&y.mode&1&&!(Mi&2)?(y=b.interleaved,y===null?(P.next=P,ec===null?ec=[b]:ec.push(b)):(P.next=y.next,y.next=P),b.interleaved=P):(y=b.pending,y===null?P.next=P:(P.next=y.next,y.next=P),b.pending=P)}function zF(y,b,P){if(P&4194240){var R=b.lanes;R&=y.pendingLanes,P|=R,b.lanes=P,q2(y,P)}}var zb={readContext:_o,useCallback:Rs,useContext:Rs,useEffect:Rs,useImperativeHandle:Rs,useInsertionEffect:Rs,useLayoutEffect:Rs,useMemo:Rs,useReducer:Rs,useRef:Rs,useState:Rs,useDebugValue:Rs,useDeferredValue:Rs,useTransition:Rs,useMutableSource:Rs,useSyncExternalStore:Rs,useId:Rs,unstable_isNewReconciler:!1},vre={readContext:_o,useCallback:function(y,b){return au().memoizedState=[y,b===void 0?null:b],y},useContext:_o,useEffect:yP,useImperativeHandle:function(y,b,P){return P=P!=null?P.concat([y]):null,Lb(4194308,4,CF.bind(null,b,y),P)},useLayoutEffect:function(y,b){return Lb(4194308,4,y,b)},useInsertionEffect:function(y,b){return Lb(4,2,y,b)},useMemo:function(y,b){var P=au();return b=b===void 0?null:b,y=y(),P.memoizedState=[y,b],y},useReducer:function(y,b,P){var R=au();return b=P!==void 0?P(b):b,R.memoizedState=R.baseState=b,y={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:y,lastRenderedState:b},R.queue=y,y=y.dispatch=mre.bind(null,Vr,y),[R.memoizedState,y]},useRef:function(y){var b=au();return y={current:y},b.memoizedState=y},useState:vP,useDebugValue:xP,useDeferredValue:function(y){var b=vP(y),P=b[0],R=b[1];return yP(function(){var N=Ao.transition;Ao.transition={};try{R(y)}finally{Ao.transition=N}},[y]),P},useTransition:function(){var y=vP(!1),b=y[0];return y=fre.bind(null,y[1]),au().memoizedState=y,[b,y]},useMutableSource:function(){},useSyncExternalStore:function(y,b,P){var R=Vr,N=au();if(Tr){if(P===void 0)throw Error(a(407));P=P()}else{if(P=b(),dn===null)throw Error(a(349));_m&30||wF(R,b,P)}N.memoizedState=P;var U={value:P,getSnapshot:b};return N.queue=U,yP(_F.bind(null,R,U,y),[y]),R.flags|=2048,ty(9,bF.bind(null,R,U,P,b),void 0,null),P},useId:function(){var y=au(),b=dn.identifierPrefix;if(Tr){var P=su,R=nu;P=(R&~(1<<32-Qa(R)-1)).toString(32)+P,b=":"+b+"R"+P,P=ey++,0<P&&(b+="H"+P.toString(32)),b+=":"}else P=pre++,b=":"+b+"r"+P.toString(32)+":";return y.memoizedState=b},unstable_isNewReconciler:!1},yre={readContext:_o,useCallback:PF,useContext:_o,useEffect:iy,useImperativeHandle:TF,useInsertionEffect:EF,useLayoutEffect:AF,useMemo:DF,useReducer:Rb,useRef:MF,useState:function(){return Rb(hp)},useDebugValue:xP,useDeferredValue:function(y){var b=Rb(hp),P=b[0],R=b[1];return iy(function(){var N=Ao.transition;Ao.transition={};try{R(y)}finally{Ao.transition=N}},[y]),P},useTransition:function(){var y=Rb(hp)[0],b=ic().memoizedState;return[y,b]},useMutableSource:yF,useSyncExternalStore:xF,useId:RF,unstable_isNewReconciler:!1},xre={readContext:_o,useCallback:PF,useContext:_o,useEffect:iy,useImperativeHandle:TF,useInsertionEffect:EF,useLayoutEffect:AF,useMemo:DF,useReducer:Ib,useRef:MF,useState:function(){return Ib(hp)},useDebugValue:xP,useDeferredValue:function(y){var b=Ib(hp),P=b[0],R=b[1];return iy(function(){var N=Ao.transition;Ao.transition={};try{R(y)}finally{Ao.transition=N}},[y]),P},useTransition:function(){var y=Ib(hp)[0],b=ic().memoizedState;return[y,b]},useMutableSource:yF,useSyncExternalStore:xF,useId:RF,unstable_isNewReconciler:!1};function wP(y,b){try{var P="",R=b;do P+=dre(R),R=R.return;while(R);var N=P}catch(U){N=`
Error generating stack: `+U.message+`
`+U.stack}return{value:y,source:b,stack:N}}function bP(y,b){try{console.error(b.value)}catch(P){setTimeout(function(){throw P})}}var wre=typeof WeakMap=="function"?WeakMap:Map;function NF(y,b,P){P=ru(-1,P),P.tag=3,P.payload={element:null};var R=b.value;return P.callback=function(){Zb||(Zb=!0,UP=R),bP(y,b)},P}function BF(y,b,P){P=ru(-1,P),P.tag=3;var R=y.type.getDerivedStateFromError;if(typeof R=="function"){var N=b.value;P.payload=function(){return R(N)},P.callback=function(){bP(y,b)}}var U=y.stateNode;return U!==null&&typeof U.componentDidCatch=="function"&&(P.callback=function(){bP(y,b),typeof R!="function"&&(Ph===null?Ph=new Set([this]):Ph.add(this));var pe=b.stack;this.componentDidCatch(b.value,{componentStack:pe!==null?pe:""})}),P}function kF(y,b,P){var R=y.pingCache;if(R===null){R=y.pingCache=new wre;var N=new Set;R.set(b,N)}else N=R.get(b),N===void 0&&(N=new Set,R.set(b,N));N.has(P)||(N.add(P),y=Ore.bind(null,y,b,P),b.then(y,y))}function UF(y){do{var b;if((b=y.tag===13)&&(b=y.memoizedState,b=b!==null?b.dehydrated!==null:!0),b)return y;y=y.return}while(y!==null);return null}function FF(y,b,P,R,N){return y.mode&1?(y.flags|=65536,y.lanes=N,y):(y===b?y.flags|=65536:(y.flags|=128,P.flags|=131072,P.flags&=-52805,P.tag===1&&(P.alternate===null?P.tag=17:(b=ru(-1,1),b.tag=2,Th(P,b))),P.lanes|=1),y)}function rc(y){y.flags|=4}function VF(y,b){if(y!==null&&y.child===b.child)return!0;if(b.flags&16)return!1;for(y=b.child;y!==null;){if(y.flags&12854||y.subtreeFlags&12854)return!1;y=y.sibling}return!0}var ry,ny,Nb,Bb;if(Me)ry=function(y,b){for(var P=b.child;P!==null;){if(P.tag===5||P.tag===6)J(y,P.stateNode);else if(P.tag!==4&&P.child!==null){P.child.return=P,P=P.child;continue}if(P===b)break;for(;P.sibling===null;){if(P.return===null||P.return===b)return;P=P.return}P.sibling.return=P.return,P=P.sibling}},ny=function(){},Nb=function(y,b,P,R,N){if(y=y.memoizedProps,y!==R){var U=b.stateNode,pe=tc(Eo.current);P=$(U,P,y,R,N,pe),(b.updateQueue=P)&&rc(b)}},Bb=function(y,b,P,R){P!==R&&rc(b)};else if(X){ry=function(y,b,P,R){for(var N=b.child;N!==null;){if(N.tag===5){var U=N.stateNode;P&&R&&(U=ci(U,N.type,N.memoizedProps,N)),J(y,U)}else if(N.tag===6)U=N.stateNode,P&&R&&(U=Ki(U,N.memoizedProps,N)),J(y,U);else if(N.tag!==4){if(N.tag===22&&N.memoizedState!==null)U=N.child,U!==null&&(U.return=N),ry(y,N,!0,!0);else if(N.child!==null){N.child.return=N,N=N.child;continue}}if(N===b)break;for(;N.sibling===null;){if(N.return===null||N.return===b)return;N=N.return}N.sibling.return=N.return,N=N.sibling}};var HF=function(y,b,P,R){for(var N=b.child;N!==null;){if(N.tag===5){var U=N.stateNode;P&&R&&(U=ci(U,N.type,N.memoizedProps,N)),Ut(y,U)}else if(N.tag===6)U=N.stateNode,P&&R&&(U=Ki(U,N.memoizedProps,N)),Ut(y,U);else if(N.tag!==4){if(N.tag===22&&N.memoizedState!==null)U=N.child,U!==null&&(U.return=N),HF(y,N,!0,!0);else if(N.child!==null){N.child.return=N,N=N.child;continue}}if(N===b)break;for(;N.sibling===null;){if(N.return===null||N.return===b)return;N=N.return}N.sibling.return=N.return,N=N.sibling}};ny=function(y,b){var P=b.stateNode;if(!VF(y,b)){y=P.containerInfo;var R=vt(y);HF(R,b,!1,!1),P.pendingChildren=R,rc(b),Wt(y,R)}},Nb=function(y,b,P,R,N){var U=y.stateNode,pe=y.memoizedProps;if((y=VF(y,b))&&pe===R)b.stateNode=U;else{var Re=b.stateNode,Je=tc(Eo.current),xt=null;pe!==R&&(xt=$(Re,P,pe,R,N,Je)),y&&xt===null?b.stateNode=U:(U=st(U,xt,P,pe,R,b,y,Re),ce(U,P,R,N,Je)&&rc(b),b.stateNode=U,y?rc(b):ry(U,b,!1,!1))}},Bb=function(y,b,P,R){P!==R?(y=tc(wm.current),P=tc(Eo.current),b.stateNode=ie(R,y,P,b),rc(b)):b.stateNode=y.stateNode}}else ny=function(){},Nb=function(){},Bb=function(){};function sy(y,b){if(!Tr)switch(y.tailMode){case"hidden":b=y.tail;for(var P=null;b!==null;)b.alternate!==null&&(P=b),b=b.sibling;P===null?y.tail=null:P.sibling=null;break;case"collapsed":P=y.tail;for(var R=null;P!==null;)P.alternate!==null&&(R=P),P=P.sibling;R===null?b||y.tail===null?y.tail=null:y.tail.sibling=null:R.sibling=null}}function Is(y){var b=y.alternate!==null&&y.alternate.child===y.child,P=0,R=0;if(b)for(var N=y.child;N!==null;)P|=N.lanes|N.childLanes,R|=N.subtreeFlags&14680064,R|=N.flags&14680064,N.return=y,N=N.sibling;else for(N=y.child;N!==null;)P|=N.lanes|N.childLanes,R|=N.subtreeFlags,R|=N.flags,N.return=y,N=N.sibling;return y.subtreeFlags|=R,y.childLanes=P,b}function bre(y,b,P){var R=b.pendingProps;switch(aP(b),b.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Is(b),null;case 1:return Fr(b.type)&&$i(),Is(b),null;case 3:return R=b.stateNode,bm(),H(Ae),H(te),pP(),R.pendingContext&&(R.context=R.pendingContext,R.pendingContext=null),(y===null||y.child===null)&&(Q0(b)?rc(b):y===null||y.memoizedState.isDehydrated&&!(b.flags&256)||(b.flags|=1024,cl!==null&&(HP(cl),cl=null))),ny(y,b),Is(b),null;case 5:hP(b),P=tc(wm.current);var N=b.type;if(y!==null&&b.stateNode!=null)Nb(y,b,N,R,P),y.ref!==b.ref&&(b.flags|=512,b.flags|=2097152);else{if(!R){if(b.stateNode===null)throw Error(a(166));return Is(b),null}if(y=tc(Eo.current),Q0(b)){if(!ge)throw Error(a(175));y=Ot(b.stateNode,b.type,b.memoizedProps,P,y,b,!Y0),b.updateQueue=y,y!==null&&rc(b)}else{var U=W(N,R,P,y,b);ry(U,b,!1,!1),b.stateNode=U,ce(U,N,R,P,y)&&rc(b)}b.ref!==null&&(b.flags|=512,b.flags|=2097152)}return Is(b),null;case 6:if(y&&b.stateNode!=null)Bb(y,b,y.memoizedProps,R);else{if(typeof R!="string"&&b.stateNode===null)throw Error(a(166));if(y=tc(wm.current),P=tc(Eo.current),Q0(b)){if(!ge)throw Error(a(176));if(y=b.stateNode,R=b.memoizedProps,(P=ri(y,R,b,!Y0))&&(N=Ka,N!==null))switch(U=(N.mode&1)!==0,N.tag){case 3:bt(N.stateNode.containerInfo,y,R,U);break;case 5:Ct(N.type,N.memoizedProps,N.stateNode,y,R,U)}P&&rc(b)}else b.stateNode=ie(R,y,P,b)}return Is(b),null;case 13:if(H(Rr),R=b.memoizedState,Tr&&Za!==null&&b.mode&1&&!(b.flags&128)){for(y=Za;y;)y=Ge(y);return ym(),b.flags|=98560,b}if(R!==null&&R.dehydrated!==null){if(R=Q0(b),y===null){if(!R)throw Error(a(318));if(!ge)throw Error(a(344));if(y=b.memoizedState,y=y!==null?y.dehydrated:null,!y)throw Error(a(317));oi(y,b)}else ym(),!(b.flags&128)&&(b.memoizedState=null),b.flags|=4;return Is(b),null}return cl!==null&&(HP(cl),cl=null),b.flags&128?(b.lanes=P,b):(R=R!==null,P=!1,y===null?Q0(b):P=y.memoizedState!==null,R&&!P&&(b.child.flags|=8192,b.mode&1&&(y===null||Rr.current&1?Pn===0&&(Pn=3):jP())),b.updateQueue!==null&&(b.flags|=4),Is(b),null);case 4:return bm(),ny(y,b),y===null&&Ie(b.stateNode.containerInfo),Is(b),null;case 10:return eP(b.type._context),Is(b),null;case 17:return Fr(b.type)&&$i(),Is(b),null;case 19:if(H(Rr),N=b.memoizedState,N===null)return Is(b),null;if(R=(b.flags&128)!==0,U=N.rendering,U===null)if(R)sy(N,!1);else{if(Pn!==0||y!==null&&y.flags&128)for(y=b.child;y!==null;){if(U=Tb(y),U!==null){for(b.flags|=128,sy(N,!1),y=U.updateQueue,y!==null&&(b.updateQueue=y,b.flags|=4),b.subtreeFlags=0,y=P,R=b.child;R!==null;)P=R,N=y,P.flags&=14680066,U=P.alternate,U===null?(P.childLanes=0,P.lanes=N,P.child=null,P.subtreeFlags=0,P.memoizedProps=null,P.memoizedState=null,P.updateQueue=null,P.dependencies=null,P.stateNode=null):(P.childLanes=U.childLanes,P.lanes=U.lanes,P.child=U.child,P.subtreeFlags=0,P.deletions=null,P.memoizedProps=U.memoizedProps,P.memoizedState=U.memoizedState,P.updateQueue=U.updateQueue,P.type=U.type,N=U.dependencies,P.dependencies=N===null?null:{lanes:N.lanes,firstContext:N.firstContext}),R=R.sibling;return q(Rr,Rr.current&1|2),b.child}y=y.sibling}N.tail!==null&&jn()>kP&&(b.flags|=128,R=!0,sy(N,!1),b.lanes=4194304)}else{if(!R)if(y=Tb(U),y!==null){if(b.flags|=128,R=!0,y=y.updateQueue,y!==null&&(b.updateQueue=y,b.flags|=4),sy(N,!0),N.tail===null&&N.tailMode==="hidden"&&!U.alternate&&!Tr)return Is(b),null}else 2*jn()-N.renderingStartTime>kP&&P!==1073741824&&(b.flags|=128,R=!0,sy(N,!1),b.lanes=4194304);N.isBackwards?(U.sibling=b.child,b.child=U):(y=N.last,y!==null?y.sibling=U:b.child=U,N.last=U)}return N.tail!==null?(b=N.tail,N.rendering=b,N.tail=b.sibling,N.renderingStartTime=jn(),b.sibling=null,y=Rr.current,q(Rr,R?y&1|2:y&1),b):(Is(b),null);case 22:case 23:return GP(),R=b.memoizedState!==null,y!==null&&y.memoizedState!==null!==R&&(b.flags|=8192),R&&b.mode&1?Ja&1073741824&&(Is(b),Me&&b.subtreeFlags&6&&(b.flags|=8192)):Is(b),null;case 24:return null;case 25:return null}throw Error(a(156,b.tag))}var _re=o.ReactCurrentOwner,$a=!1;function ta(y,b,P,R){b.child=y===null?gF(b,null,P,R):xm(b,y.child,P,R)}function GF(y,b,P,R,N){P=P.render;var U=b.ref;return mm(b,N),R=mP(y,b,P,R,U,N),P=gP(),y!==null&&!$a?(b.updateQueue=y.updateQueue,b.flags&=-2053,y.lanes&=~N,ou(y,b,N)):(Tr&&P&&sP(b),b.flags|=1,ta(y,b,R,N),b.child)}function jF(y,b,P,R,N){if(y===null){var U=P.type;return typeof U=="function"&&!WP(U)&&U.defaultProps===void 0&&P.compare===null&&P.defaultProps===void 0?(b.tag=15,b.type=U,WF(y,b,U,R,N)):(y=n_(P.type,null,R,b,b.mode,N),y.ref=b.ref,y.return=b,b.child=y)}if(U=y.child,!(y.lanes&N)){var pe=U.memoizedProps;if(P=P.compare,P=P!==null?P:xb,P(pe,R)&&y.ref===b.ref)return ou(y,b,N)}return b.flags|=1,y=Lh(U,R),y.ref=b.ref,y.return=b,b.child=y}function WF(y,b,P,R,N){if(y!==null&&xb(y.memoizedProps,R)&&y.ref===b.ref)if($a=!1,(y.lanes&N)!==0)y.flags&131072&&($a=!0);else return b.lanes=y.lanes,ou(y,b,N);return _P(y,b,P,R,N)}function XF(y,b,P){var R=b.pendingProps,N=R.children,U=y!==null?y.memoizedState:null;if(R.mode==="hidden")if(!(b.mode&1))b.memoizedState={baseLanes:0,cachePool:null},q(Sm,Ja),Ja|=P;else if(P&1073741824)b.memoizedState={baseLanes:0,cachePool:null},R=U!==null?U.baseLanes:P,q(Sm,Ja),Ja|=R;else return y=U!==null?U.baseLanes|P:P,b.lanes=b.childLanes=1073741824,b.memoizedState={baseLanes:y,cachePool:null},b.updateQueue=null,q(Sm,Ja),Ja|=y,null;else U!==null?(R=U.baseLanes|P,b.memoizedState=null):R=P,q(Sm,Ja),Ja|=R;return ta(y,b,N,P),b.child}function qF(y,b){var P=b.ref;(y===null&&P!==null||y!==null&&y.ref!==P)&&(b.flags|=512,b.flags|=2097152)}function _P(y,b,P,R,N){var U=Fr(P)?ut:te.current;return U=Zi(b,U),mm(b,N),P=mP(y,b,P,R,U,N),R=gP(),y!==null&&!$a?(b.updateQueue=y.updateQueue,b.flags&=-2053,y.lanes&=~N,ou(y,b,N)):(Tr&&R&&sP(b),b.flags|=1,ta(y,b,P,N),b.child)}function YF(y,b,P,R,N){if(Fr(P)){var U=!0;Jr(b)}else U=!1;if(mm(b,N),b.stateNode===null)y!==null&&(y.alternate=null,b.alternate=null,b.flags|=2),lF(b,P,R),nP(b,P,R,N),R=!0;else if(y===null){var pe=b.stateNode,Re=b.memoizedProps;pe.props=Re;var Je=pe.context,xt=P.contextType;typeof xt=="object"&&xt!==null?xt=_o(xt):(xt=Fr(P)?ut:te.current,xt=Zi(b,xt));var Lt=P.getDerivedStateFromProps,fi=typeof Lt=="function"||typeof pe.getSnapshotBeforeUpdate=="function";fi||typeof pe.UNSAFE_componentWillReceiveProps!="function"&&typeof pe.componentWillReceiveProps!="function"||(Re!==R||Je!==xt)&&cF(b,pe,R,xt),Ch=!1;var Qt=b.memoizedState;pe.state=Qt,Sb(b,R,pe,N),Je=b.memoizedState,Re!==R||Qt!==Je||Ae.current||Ch?(typeof Lt=="function"&&(rP(b,P,Lt,R),Je=b.memoizedState),(Re=Ch||oF(b,P,Re,R,Qt,Je,xt))?(fi||typeof pe.UNSAFE_componentWillMount!="function"&&typeof pe.componentWillMount!="function"||(typeof pe.componentWillMount=="function"&&pe.componentWillMount(),typeof pe.UNSAFE_componentWillMount=="function"&&pe.UNSAFE_componentWillMount()),typeof pe.componentDidMount=="function"&&(b.flags|=4194308)):(typeof pe.componentDidMount=="function"&&(b.flags|=4194308),b.memoizedProps=R,b.memoizedState=Je),pe.props=R,pe.state=Je,pe.context=xt,R=Re):(typeof pe.componentDidMount=="function"&&(b.flags|=4194308),R=!1)}else{pe=b.stateNode,rF(y,b),Re=b.memoizedProps,xt=b.type===b.elementType?Re:ll(b.type,Re),pe.props=xt,fi=b.pendingProps,Qt=pe.context,Je=P.contextType,typeof Je=="object"&&Je!==null?Je=_o(Je):(Je=Fr(P)?ut:te.current,Je=Zi(b,Je));var pr=P.getDerivedStateFromProps;(Lt=typeof pr=="function"||typeof pe.getSnapshotBeforeUpdate=="function")||typeof pe.UNSAFE_componentWillReceiveProps!="function"&&typeof pe.componentWillReceiveProps!="function"||(Re!==fi||Qt!==Je)&&cF(b,pe,R,Je),Ch=!1,Qt=b.memoizedState,pe.state=Qt,Sb(b,R,pe,N);var Vt=b.memoizedState;Re!==fi||Qt!==Vt||Ae.current||Ch?(typeof pr=="function"&&(rP(b,P,pr,R),Vt=b.memoizedState),(xt=Ch||oF(b,P,xt,R,Qt,Vt,Je)||!1)?(Lt||typeof pe.UNSAFE_componentWillUpdate!="function"&&typeof pe.componentWillUpdate!="function"||(typeof pe.componentWillUpdate=="function"&&pe.componentWillUpdate(R,Vt,Je),typeof pe.UNSAFE_componentWillUpdate=="function"&&pe.UNSAFE_componentWillUpdate(R,Vt,Je)),typeof pe.componentDidUpdate=="function"&&(b.flags|=4),typeof pe.getSnapshotBeforeUpdate=="function"&&(b.flags|=1024)):(typeof pe.componentDidUpdate!="function"||Re===y.memoizedProps&&Qt===y.memoizedState||(b.flags|=4),typeof pe.getSnapshotBeforeUpdate!="function"||Re===y.memoizedProps&&Qt===y.memoizedState||(b.flags|=1024),b.memoizedProps=R,b.memoizedState=Vt),pe.props=R,pe.state=Vt,pe.context=Je,R=xt):(typeof pe.componentDidUpdate!="function"||Re===y.memoizedProps&&Qt===y.memoizedState||(b.flags|=4),typeof pe.getSnapshotBeforeUpdate!="function"||Re===y.memoizedProps&&Qt===y.memoizedState||(b.flags|=1024),R=!1)}return SP(y,b,P,R,U,N)}function SP(y,b,P,R,N,U){qF(y,b);var pe=(b.flags&128)!==0;if(!R&&!pe)return N&&pm(b,P,!1),ou(y,b,U);R=b.stateNode,_re.current=b;var Re=pe&&typeof P.getDerivedStateFromError!="function"?null:R.render();return b.flags|=1,y!==null&&pe?(b.child=xm(b,y.child,null,U),b.child=xm(b,null,Re,U)):ta(y,b,Re,U),b.memoizedState=R.state,N&&pm(b,P,!0),b.child}function QF(y){var b=y.stateNode;b.pendingContext?ea(y,b.pendingContext,b.pendingContext!==b.context):b.context&&ea(y,b.context,!1),uP(y,b.containerInfo)}function KF(y,b,P,R,N){return ym(),cP(N),b.flags|=256,ta(y,b,P,R),b.child}var kb={dehydrated:null,treeContext:null,retryLane:0};function Ub(y){return{baseLanes:y,cachePool:null}}function ZF(y,b,P){var R=b.pendingProps,N=Rr.current,U=!1,pe=(b.flags&128)!==0,Re;if((Re=pe)||(Re=y!==null&&y.memoizedState===null?!1:(N&2)!==0),Re?(U=!0,b.flags&=-129):(y===null||y.memoizedState!==null)&&(N|=1),q(Rr,N&1),y===null)return lP(b),y=b.memoizedState,y!==null&&(y=y.dehydrated,y!==null)?(b.mode&1?bo(y)?b.lanes=8:b.lanes=1073741824:b.lanes=1,null):(N=R.children,y=R.fallback,U?(R=b.mode,U=b.child,N={mode:"hidden",children:N},!(R&1)&&U!==null?(U.childLanes=0,U.pendingProps=N):U=s_(N,R,0,null),y=vp(y,R,P,null),U.return=b,y.return=b,U.sibling=y,b.child=U,b.child.memoizedState=Ub(P),b.memoizedState=kb,y):MP(b,N));if(N=y.memoizedState,N!==null){if(Re=N.dehydrated,Re!==null){if(pe)return b.flags&256?(b.flags&=-257,Fb(y,b,P,Error(a(422)))):b.memoizedState!==null?(b.child=y.child,b.flags|=128,null):(U=R.fallback,N=b.mode,R=s_({mode:"visible",children:R.children},N,0,null),U=vp(U,N,P,null),U.flags|=2,R.return=b,U.return=b,R.sibling=U,b.child=R,b.mode&1&&xm(b,y.child,null,P),b.child.memoizedState=Ub(P),b.memoizedState=kb,U);if(!(b.mode&1))b=Fb(y,b,P,null);else if(bo(Re))b=Fb(y,b,P,Error(a(419)));else if(R=(P&y.childLanes)!==0,$a||R){if(R=dn,R!==null){switch(P&-P){case 4:U=2;break;case 16:U=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:U=32;break;case 536870912:U=268435456;break;default:U=0}R=U&(R.suspendedLanes|P)?0:U,R!==0&&R!==N.retryLane&&(N.retryLane=R,Co(y,R,-1))}jP(),b=Fb(y,b,P,Error(a(421)))}else tu(Re)?(b.flags|=128,b.child=y.child,b=zre.bind(null,y),le(Re,b),b=null):(P=N.treeContext,ge&&(Za=et(Re),Ka=b,Tr=!0,cl=null,Y0=!1,P!==null&&(So[Mo++]=nu,So[Mo++]=su,So[Mo++]=cp,nu=P.id,su=P.overflow,cp=b)),b=MP(b,b.pendingProps.children),b.flags|=4096);return b}return U?(R=JF(y,b,R.children,R.fallback,P),U=b.child,N=y.child.memoizedState,U.memoizedState=N===null?Ub(P):{baseLanes:N.baseLanes|P,cachePool:null},U.childLanes=y.childLanes&~P,b.memoizedState=kb,R):(P=$F(y,b,R.children,P),b.memoizedState=null,P)}return U?(R=JF(y,b,R.children,R.fallback,P),U=b.child,N=y.child.memoizedState,U.memoizedState=N===null?Ub(P):{baseLanes:N.baseLanes|P,cachePool:null},U.childLanes=y.childLanes&~P,b.memoizedState=kb,R):(P=$F(y,b,R.children,P),b.memoizedState=null,P)}function MP(y,b){return b=s_({mode:"visible",children:b},y.mode,0,null),b.return=y,y.child=b}function $F(y,b,P,R){var N=y.child;return y=N.sibling,P=Lh(N,{mode:"visible",children:P}),!(b.mode&1)&&(P.lanes=R),P.return=b,P.sibling=null,y!==null&&(R=b.deletions,R===null?(b.deletions=[y],b.flags|=16):R.push(y)),b.child=P}function JF(y,b,P,R,N){var U=b.mode;y=y.child;var pe=y.sibling,Re={mode:"hidden",children:P};return!(U&1)&&b.child!==y?(P=b.child,P.childLanes=0,P.pendingProps=Re,b.deletions=null):(P=Lh(y,Re),P.subtreeFlags=y.subtreeFlags&14680064),pe!==null?R=Lh(pe,R):(R=vp(R,U,N,null),R.flags|=2),R.return=b,P.return=b,P.sibling=R,b.child=P,R}function Fb(y,b,P,R){return R!==null&&cP(R),xm(b,y.child,null,P),y=MP(b,b.pendingProps.children),y.flags|=2,b.memoizedState=null,y}function e4(y,b,P){y.lanes|=b;var R=y.alternate;R!==null&&(R.lanes|=b),tP(y.return,b,P)}function EP(y,b,P,R,N){var U=y.memoizedState;U===null?y.memoizedState={isBackwards:b,rendering:null,renderingStartTime:0,last:R,tail:P,tailMode:N}:(U.isBackwards=b,U.rendering=null,U.renderingStartTime=0,U.last=R,U.tail=P,U.tailMode=N)}function t4(y,b,P){var R=b.pendingProps,N=R.revealOrder,U=R.tail;if(ta(y,b,R.children,P),R=Rr.current,R&2)R=R&1|2,b.flags|=128;else{if(y!==null&&y.flags&128)e:for(y=b.child;y!==null;){if(y.tag===13)y.memoizedState!==null&&e4(y,P,b);else if(y.tag===19)e4(y,P,b);else if(y.child!==null){y.child.return=y,y=y.child;continue}if(y===b)break e;for(;y.sibling===null;){if(y.return===null||y.return===b)break e;y=y.return}y.sibling.return=y.return,y=y.sibling}R&=1}if(q(Rr,R),!(b.mode&1))b.memoizedState=null;else switch(N){case"forwards":for(P=b.child,N=null;P!==null;)y=P.alternate,y!==null&&Tb(y)===null&&(N=P),P=P.sibling;P=N,P===null?(N=b.child,b.child=null):(N=P.sibling,P.sibling=null),EP(b,!1,N,P,U);break;case"backwards":for(P=null,N=b.child,b.child=null;N!==null;){if(y=N.alternate,y!==null&&Tb(y)===null){b.child=N;break}y=N.sibling,N.sibling=P,P=N,N=y}EP(b,!0,P,null,U);break;case"together":EP(b,!1,null,null,void 0);break;default:b.memoizedState=null}return b.child}function ou(y,b,P){if(y!==null&&(b.dependencies=y.dependencies),Mm|=b.lanes,!(P&b.childLanes))return null;if(y!==null&&b.child!==y.child)throw Error(a(153));if(b.child!==null){for(y=b.child,P=Lh(y,y.pendingProps),b.child=P,P.return=b;y.sibling!==null;)y=y.sibling,P=P.sibling=Lh(y,y.pendingProps),P.return=b;P.sibling=null}return b.child}function Sre(y,b,P){switch(b.tag){case 3:QF(b),ym();break;case 5:vF(b);break;case 1:Fr(b.type)&&Jr(b);break;case 4:uP(b,b.stateNode.containerInfo);break;case 10:iF(b,b.type._context,b.memoizedProps.value);break;case 13:var R=b.memoizedState;if(R!==null)return R.dehydrated!==null?(q(Rr,Rr.current&1),b.flags|=128,null):P&b.child.childLanes?ZF(y,b,P):(q(Rr,Rr.current&1),y=ou(y,b,P),y!==null?y.sibling:null);q(Rr,Rr.current&1);break;case 19:if(R=(P&b.childLanes)!==0,y.flags&128){if(R)return t4(y,b,P);b.flags|=128}var N=b.memoizedState;if(N!==null&&(N.rendering=null,N.tail=null,N.lastEffect=null),q(Rr,Rr.current),R)break;return null;case 22:case 23:return b.lanes=0,XF(y,b,P)}return ou(y,b,P)}function Mre(y,b){switch(aP(b),b.tag){case 1:return Fr(b.type)&&$i(),y=b.flags,y&65536?(b.flags=y&-65537|128,b):null;case 3:return bm(),H(Ae),H(te),pP(),y=b.flags,y&65536&&!(y&128)?(b.flags=y&-65537|128,b):null;case 5:return hP(b),null;case 13:if(H(Rr),y=b.memoizedState,y!==null&&y.dehydrated!==null){if(b.alternate===null)throw Error(a(340));ym()}return y=b.flags,y&65536?(b.flags=y&-65537|128,b):null;case 19:return H(Rr),null;case 4:return bm(),null;case 10:return eP(b.type._context),null;case 22:case 23:return GP(),null;case 24:return null;default:return null}}var Vb=!1,dp=!1,Ere=typeof WeakSet=="function"?WeakSet:Set,At=null;function Hb(y,b){var P=y.ref;if(P!==null)if(typeof P=="function")try{P(null)}catch(R){Ca(y,b,R)}else P.current=null}function AP(y,b,P){try{P()}catch(R){Ca(y,b,R)}}var i4=!1;function Are(y,b){for(j(y.containerInfo),At=b;At!==null;)if(y=At,b=y.child,(y.subtreeFlags&1028)!==0&&b!==null)b.return=y,At=b;else for(;At!==null;){y=At;try{var P=y.alternate;if(y.flags&1024)switch(y.tag){case 0:case 11:case 15:break;case 1:if(P!==null){var R=P.memoizedProps,N=P.memoizedState,U=y.stateNode,pe=U.getSnapshotBeforeUpdate(y.elementType===y.type?R:ll(y.type,R),N);U.__reactInternalSnapshotBeforeUpdate=pe}break;case 3:Me&&Ne(y.stateNode.containerInfo);break;case 5:case 6:case 4:case 17:break;default:throw Error(a(163))}}catch(Re){Ca(y,y.return,Re)}if(b=y.sibling,b!==null){b.return=y.return,At=b;break}At=y.return}return P=i4,i4=!1,P}function pp(y,b,P){var R=b.updateQueue;if(R=R!==null?R.lastEffect:null,R!==null){var N=R=R.next;do{if((N.tag&y)===y){var U=N.destroy;N.destroy=void 0,U!==void 0&&AP(b,P,U)}N=N.next}while(N!==R)}}function ay(y,b){if(b=b.updateQueue,b=b!==null?b.lastEffect:null,b!==null){var P=b=b.next;do{if((P.tag&y)===y){var R=P.create;P.destroy=R()}P=P.next}while(P!==b)}}function CP(y){var b=y.ref;if(b!==null){var P=y.stateNode;switch(y.tag){case 5:y=Q(P);break;default:y=P}typeof b=="function"?b(y):b.current=y}}function r4(y,b,P){if(Zl&&typeof Zl.onCommitFiberUnmount=="function")try{Zl.onCommitFiberUnmount(vb,b)}catch{}switch(b.tag){case 0:case 11:case 14:case 15:if(y=b.updateQueue,y!==null&&(y=y.lastEffect,y!==null)){var R=y=y.next;do{var N=R,U=N.destroy;N=N.tag,U!==void 0&&(N&2||N&4)&&AP(b,P,U),R=R.next}while(R!==y)}break;case 1:if(Hb(b,P),y=b.stateNode,typeof y.componentWillUnmount=="function")try{y.props=b.memoizedProps,y.state=b.memoizedState,y.componentWillUnmount()}catch(pe){Ca(b,P,pe)}break;case 5:Hb(b,P);break;case 4:Me?c4(y,b,P):X&&X&&(b=b.stateNode.containerInfo,P=vt(b),Jt(b,P))}}function n4(y,b,P){for(var R=b;;)if(r4(y,R,P),R.child===null||Me&&R.tag===4){if(R===b)break;for(;R.sibling===null;){if(R.return===null||R.return===b)return;R=R.return}R.sibling.return=R.return,R=R.sibling}else R.child.return=R,R=R.child}function s4(y){var b=y.alternate;b!==null&&(y.alternate=null,s4(b)),y.child=null,y.deletions=null,y.sibling=null,y.tag===5&&(b=y.stateNode,b!==null&&Ye(b)),y.stateNode=null,y.return=null,y.dependencies=null,y.memoizedProps=null,y.memoizedState=null,y.pendingProps=null,y.stateNode=null,y.updateQueue=null}function a4(y){return y.tag===5||y.tag===3||y.tag===4}function o4(y){e:for(;;){for(;y.sibling===null;){if(y.return===null||a4(y.return))return null;y=y.return}for(y.sibling.return=y.return,y=y.sibling;y.tag!==5&&y.tag!==6&&y.tag!==18;){if(y.flags&2||y.child===null||y.tag===4)continue e;y.child.return=y,y=y.child}if(!(y.flags&2))return y.stateNode}}function l4(y){if(Me){e:{for(var b=y.return;b!==null;){if(a4(b))break e;b=b.return}throw Error(a(160))}var P=b;switch(P.tag){case 5:b=P.stateNode,P.flags&32&&(dt(b),P.flags&=-33),P=o4(y),PP(y,P,b);break;case 3:case 4:b=P.stateNode.containerInfo,P=o4(y),TP(y,P,b);break;default:throw Error(a(161))}}}function TP(y,b,P){var R=y.tag;if(R===5||R===6)y=y.stateNode,b?tt(P,y,b):Qe(P,y);else if(R!==4&&(y=y.child,y!==null))for(TP(y,b,P),y=y.sibling;y!==null;)TP(y,b,P),y=y.sibling}function PP(y,b,P){var R=y.tag;if(R===5||R===6)y=y.stateNode,b?ct(P,y,b):ze(P,y);else if(R!==4&&(y=y.child,y!==null))for(PP(y,b,P),y=y.sibling;y!==null;)PP(y,b,P),y=y.sibling}function c4(y,b,P){for(var R=b,N=!1,U,pe;;){if(!N){N=R.return;e:for(;;){if(N===null)throw Error(a(160));switch(U=N.stateNode,N.tag){case 5:pe=!1;break e;case 3:U=U.containerInfo,pe=!0;break e;case 4:U=U.containerInfo,pe=!0;break e}N=N.return}N=!0}if(R.tag===5||R.tag===6)n4(y,R,P),pe?Ue(U,R.stateNode):ue(U,R.stateNode);else if(R.tag===18)pe?Ee(U,R.stateNode):Le(U,R.stateNode);else if(R.tag===4){if(R.child!==null){U=R.stateNode.containerInfo,pe=!0,R.child.return=R,R=R.child;continue}}else if(r4(y,R,P),R.child!==null){R.child.return=R,R=R.child;continue}if(R===b)break;for(;R.sibling===null;){if(R.return===null||R.return===b)return;R=R.return,R.tag===4&&(N=!1)}R.sibling.return=R.return,R=R.sibling}}function DP(y,b){if(Me){switch(b.tag){case 0:case 11:case 14:case 15:pp(3,b,b.return),ay(3,b),pp(5,b,b.return);return;case 1:return;case 5:var P=b.stateNode;if(P!=null){var R=b.memoizedProps;y=y!==null?y.memoizedProps:R;var N=b.type,U=b.updateQueue;b.updateQueue=null,U!==null&&nt(P,U,N,y,R,b)}return;case 6:if(b.stateNode===null)throw Error(a(162));P=b.memoizedProps,ye(b.stateNode,y!==null?y.memoizedProps:P,P);return;case 3:ge&&y!==null&&y.memoizedState.isDehydrated&&Ce(b.stateNode.containerInfo);return;case 12:return;case 13:Gb(b);return;case 19:Gb(b);return;case 17:return}throw Error(a(163))}switch(b.tag){case 0:case 11:case 14:case 15:pp(3,b,b.return),ay(3,b),pp(5,b,b.return);return;case 12:return;case 13:Gb(b);return;case 19:Gb(b);return;case 3:ge&&y!==null&&y.memoizedState.isDehydrated&&Ce(b.stateNode.containerInfo);break;case 22:case 23:return}e:if(X){switch(b.tag){case 1:case 5:case 6:break e;case 3:case 4:b=b.stateNode,Jt(b.containerInfo,b.pendingChildren);break e}throw Error(a(163))}}function Gb(y){var b=y.updateQueue;if(b!==null){y.updateQueue=null;var P=y.stateNode;P===null&&(P=y.stateNode=new Ere),b.forEach(function(R){var N=Nre.bind(null,y,R);P.has(R)||(P.add(R),R.then(N,N))})}}function Cre(y,b){for(At=b;At!==null;){b=At;var P=b.deletions;if(P!==null)for(var R=0;R<P.length;R++){var N=P[R];try{var U=y;Me?c4(U,N,b):n4(U,N,b);var pe=N.alternate;pe!==null&&(pe.return=null),N.return=null}catch(Ft){Ca(N,b,Ft)}}if(P=b.child,b.subtreeFlags&12854&&P!==null)P.return=b,At=P;else for(;At!==null;){b=At;try{var Re=b.flags;if(Re&32&&Me&&dt(b.stateNode),Re&512){var Je=b.alternate;if(Je!==null){var xt=Je.ref;xt!==null&&(typeof xt=="function"?xt(null):xt.current=null)}}if(Re&8192)switch(b.tag){case 13:if(b.memoizedState!==null){var Lt=b.alternate;(Lt===null||Lt.memoizedState===null)&&(BP=jn())}break;case 22:var fi=b.memoizedState!==null,Qt=b.alternate,pr=Qt!==null&&Qt.memoizedState!==null;if(P=b,Me){e:if(R=P,N=fi,U=null,Me)for(var Vt=R;;){if(Vt.tag===5){if(U===null){U=Vt;var Ls=Vt.stateNode;N?xe(Ls):fe(Vt.stateNode,Vt.memoizedProps)}}else if(Vt.tag===6){if(U===null){var Po=Vt.stateNode;N?ae(Po):Se(Po,Vt.memoizedProps)}}else if((Vt.tag!==22&&Vt.tag!==23||Vt.memoizedState===null||Vt===R)&&Vt.child!==null){Vt.child.return=Vt,Vt=Vt.child;continue}if(Vt===R)break;for(;Vt.sibling===null;){if(Vt.return===null||Vt.return===R)break e;U===Vt&&(U=null),Vt=Vt.return}U===Vt&&(U=null),Vt.sibling.return=Vt.return,Vt=Vt.sibling}}if(fi&&!pr&&P.mode&1){At=P;for(var We=P.child;We!==null;){for(P=At=We;At!==null;){R=At;var Be=R.child;switch(R.tag){case 0:case 11:case 14:case 15:pp(4,R,R.return);break;case 1:Hb(R,R.return);var Ke=R.stateNode;if(typeof Ke.componentWillUnmount=="function"){var Pt=R.return;try{Ke.props=R.memoizedProps,Ke.state=R.memoizedState,Ke.componentWillUnmount()}catch(Ft){Ca(R,Pt,Ft)}}break;case 5:Hb(R,R.return);break;case 22:if(R.memoizedState!==null){d4(P);continue}}Be!==null?(Be.return=R,At=Be):d4(P)}We=We.sibling}}}switch(Re&4102){case 2:l4(b),b.flags&=-3;break;case 6:l4(b),b.flags&=-3,DP(b.alternate,b);break;case 4096:b.flags&=-4097;break;case 4100:b.flags&=-4097,DP(b.alternate,b);break;case 4:DP(b.alternate,b)}}catch(Ft){Ca(b,b.return,Ft)}if(P=b.sibling,P!==null){P.return=b.return,At=P;break}At=b.return}}}function Tre(y,b,P){At=y,u4(y)}function u4(y,b,P){for(var R=(y.mode&1)!==0;At!==null;){var N=At,U=N.child;if(N.tag===22&&R){var pe=N.memoizedState!==null||Vb;if(!pe){var Re=N.alternate,Je=Re!==null&&Re.memoizedState!==null||dp;Re=Vb;var xt=dp;if(Vb=pe,(dp=Je)&&!xt)for(At=N;At!==null;)pe=At,Je=pe.child,pe.tag===22&&pe.memoizedState!==null?p4(N):Je!==null?(Je.return=pe,At=Je):p4(N);for(;U!==null;)At=U,u4(U),U=U.sibling;At=N,Vb=Re,dp=xt}h4(y)}else N.subtreeFlags&8772&&U!==null?(U.return=N,At=U):h4(y)}}function h4(y){for(;At!==null;){var b=At;if(b.flags&8772){var P=b.alternate;try{if(b.flags&8772)switch(b.tag){case 0:case 11:case 15:dp||ay(5,b);break;case 1:var R=b.stateNode;if(b.flags&4&&!dp)if(P===null)R.componentDidMount();else{var N=b.elementType===b.type?P.memoizedProps:ll(b.type,P.memoizedProps);R.componentDidUpdate(N,P.memoizedState,R.__reactInternalSnapshotBeforeUpdate)}var U=b.updateQueue;U!==null&&sF(b,U,R);break;case 3:var pe=b.updateQueue;if(pe!==null){if(P=null,b.child!==null)switch(b.child.tag){case 5:P=Q(b.child.stateNode);break;case 1:P=b.child.stateNode}sF(b,pe,P)}break;case 5:var Re=b.stateNode;P===null&&b.flags&4&&je(Re,b.type,b.memoizedProps,b);break;case 6:break;case 4:break;case 12:break;case 13:if(ge&&b.memoizedState===null){var Je=b.alternate;if(Je!==null){var xt=Je.memoizedState;if(xt!==null){var Lt=xt.dehydrated;Lt!==null&&De(Lt)}}}break;case 19:case 17:case 21:case 22:case 23:break;default:throw Error(a(163))}dp||b.flags&512&&CP(b)}catch(fi){Ca(b,b.return,fi)}}if(b===y){At=null;break}if(P=b.sibling,P!==null){P.return=b.return,At=P;break}At=b.return}}function d4(y){for(;At!==null;){var b=At;if(b===y){At=null;break}var P=b.sibling;if(P!==null){P.return=b.return,At=P;break}At=b.return}}function p4(y){for(;At!==null;){var b=At;try{switch(b.tag){case 0:case 11:case 15:var P=b.return;try{ay(4,b)}catch(Je){Ca(b,P,Je)}break;case 1:var R=b.stateNode;if(typeof R.componentDidMount=="function"){var N=b.return;try{R.componentDidMount()}catch(Je){Ca(b,N,Je)}}var U=b.return;try{CP(b)}catch(Je){Ca(b,U,Je)}break;case 5:var pe=b.return;try{CP(b)}catch(Je){Ca(b,pe,Je)}}}catch(Je){Ca(b,b.return,Je)}if(b===y){At=null;break}var Re=b.sibling;if(Re!==null){Re.return=b.return,At=Re;break}At=b.return}}var jb=0,Wb=1,Xb=2,qb=3,Yb=4;if(typeof Symbol=="function"&&Symbol.for){var oy=Symbol.for;jb=oy("selector.component"),Wb=oy("selector.has_pseudo_class"),Xb=oy("selector.role"),qb=oy("selector.test_id"),Yb=oy("selector.text")}function RP(y){var b=Oe(y);if(b!=null){if(typeof b.memoizedProps["data-testname"]!="string")throw Error(a(364));return b}if(y=Z(y),y===null)throw Error(a(362));return y.stateNode.current}function IP(y,b){switch(b.$$typeof){case jb:if(y.type===b.value)return!0;break;case Wb:e:{b=b.value,y=[y,0];for(var P=0;P<y.length;){var R=y[P++],N=y[P++],U=b[N];if(R.tag!==5||!re(R)){for(;U!=null&&IP(R,U);)N++,U=b[N];if(N===b.length){b=!0;break e}else for(R=R.child;R!==null;)y.push(R,N),R=R.sibling}}b=!1}return b;case Xb:if(y.tag===5&&he(y.stateNode,b.value))return!0;break;case Yb:if((y.tag===5||y.tag===6)&&(y=k(y),y!==null&&0<=y.indexOf(b.value)))return!0;break;case qb:if(y.tag===5&&(y=y.memoizedProps["data-testname"],typeof y=="string"&&y.toLowerCase()===b.value.toLowerCase()))return!0;break;default:throw Error(a(365))}return!1}function LP(y){switch(y.$$typeof){case jb:return"<"+(A(y.value)||"Unknown")+">";case Wb:return":has("+(LP(y)||"")+")";case Xb:return'[role="'+y.value+'"]';case Yb:return'"'+y.value+'"';case qb:return'[data-testname="'+y.value+'"]';default:throw Error(a(365))}}function f4(y,b){var P=[];y=[y,0];for(var R=0;R<y.length;){var N=y[R++],U=y[R++],pe=b[U];if(N.tag!==5||!re(N)){for(;pe!=null&&IP(N,pe);)U++,pe=b[U];if(U===b.length)P.push(N);else for(N=N.child;N!==null;)y.push(N,U),N=N.sibling}}return P}function OP(y,b){if(!se)throw Error(a(363));y=RP(y),y=f4(y,b),b=[],y=Array.from(y);for(var P=0;P<y.length;){var R=y[P++];if(R.tag===5)re(R)||b.push(R.stateNode);else for(R=R.child;R!==null;)y.push(R),R=R.sibling}return b}var Pre=Math.ceil,Qb=o.ReactCurrentDispatcher,zP=o.ReactCurrentOwner,en=o.ReactCurrentBatchConfig,Mi=0,dn=null,pn=null,ds=0,Ja=0,Sm=zi(0),Pn=0,ly=null,Mm=0,Kb=0,NP=0,cy=null,Ea=null,BP=0,kP=1/0;function Em(){kP=jn()+500}var Zb=!1,UP=null,Ph=null,$b=!1,Dh=null,Jb=0,uy=0,FP=null,e_=-1,t_=0;function ia(){return Mi&6?jn():e_!==-1?e_:e_=jn()}function Rh(y){return y.mode&1?Mi&2&&ds!==0?ds&-ds:hre.transition!==null?(t_===0&&(y=fb,fb<<=1,!(fb&4194240)&&(fb=64),t_=y),t_):(y=Fi,y!==0?y:Pe()):1}function Co(y,b,P){if(50<uy)throw uy=0,FP=null,Error(a(185));var R=i_(y,b);return R===null?null:(q0(R,b,P),(!(Mi&2)||R!==dn)&&(R===dn&&(!(Mi&2)&&(Kb|=b),Pn===4&&Ih(R,ds)),Aa(R,P),b===1&&Mi===0&&!(y.mode&1)&&(Em(),yb&&Jl())),R)}function i_(y,b){y.lanes|=b;var P=y.alternate;for(P!==null&&(P.lanes|=b),P=y,y=y.return;y!==null;)y.childLanes|=b,P=y.alternate,P!==null&&(P.childLanes|=b),P=y,y=y.return;return P.tag===3?P.stateNode:null}function Aa(y,b){var P=y.callbackNode;ire(y,b);var R=gb(y,y===dn?ds:0);if(R===0)P!==null&&eF(P),y.callbackNode=null,y.callbackPriority=0;else if(b=R&-R,y.callbackPriority!==b){if(P!=null&&eF(P),b===1)y.tag===0?ure(g4.bind(null,y)):tF(g4.bind(null,y)),ke?Fe(function(){Mi===0&&Jl()}):Y2(Q2,Jl),P=null;else{switch(JU(R)){case 1:P=Q2;break;case 4:P=are;break;case 16:P=K2;break;case 536870912:P=ore;break;default:P=K2}P=E4(P,m4.bind(null,y))}y.callbackPriority=b,y.callbackNode=P}}function m4(y,b){if(e_=-1,t_=0,Mi&6)throw Error(a(327));var P=y.callbackNode;if(gp()&&y.callbackNode!==P)return null;var R=gb(y,y===dn?ds:0);if(R===0)return null;if(R&30||R&y.expiredLanes||b)b=r_(y,R);else{b=R;var N=Mi;Mi|=2;var U=x4();(dn!==y||ds!==b)&&(Em(),fp(y,b));do try{Ire();break}catch(Re){y4(y,Re)}while(!0);J2(),Qb.current=U,Mi=N,pn!==null?b=0:(dn=null,ds=0,b=Pn)}if(b!==0){if(b===2&&(N=W2(y),N!==0&&(R=N,b=VP(y,N))),b===1)throw P=ly,fp(y,0),Ih(y,R),Aa(y,jn()),P;if(b===6)Ih(y,R);else{if(N=y.current.alternate,!(R&30)&&!Dre(N)&&(b=r_(y,R),b===2&&(U=W2(y),U!==0&&(R=U,b=VP(y,U))),b===1))throw P=ly,fp(y,0),Ih(y,R),Aa(y,jn()),P;switch(y.finishedWork=N,y.finishedLanes=R,b){case 0:case 1:throw Error(a(345));case 2:mp(y,Ea);break;case 3:if(Ih(y,R),(R&130023424)===R&&(b=BP+500-jn(),10<b)){if(gb(y,0)!==0)break;if(N=y.suspendedLanes,(N&R)!==R){ia(),y.pingedLanes|=y.suspendedLanes&N;break}y.timeoutHandle=de(mp.bind(null,y,Ea),b);break}mp(y,Ea);break;case 4:if(Ih(y,R),(R&4194240)===R)break;for(b=y.eventTimes,N=-1;0<R;){var pe=31-Qa(R);U=1<<pe,pe=b[pe],pe>N&&(N=pe),R&=~U}if(R=N,R=jn()-R,R=(120>R?120:480>R?480:1080>R?1080:1920>R?1920:3e3>R?3e3:4320>R?4320:1960*Pre(R/1960))-R,10<R){y.timeoutHandle=de(mp.bind(null,y,Ea),R);break}mp(y,Ea);break;case 5:mp(y,Ea);break;default:throw Error(a(329))}}}return Aa(y,jn()),y.callbackNode===P?m4.bind(null,y):null}function VP(y,b){var P=cy;return y.current.memoizedState.isDehydrated&&(fp(y,b).flags|=256),y=r_(y,b),y!==2&&(b=Ea,Ea=P,b!==null&&HP(b)),y}function HP(y){Ea===null?Ea=y:Ea.push.apply(Ea,y)}function Dre(y){for(var b=y;;){if(b.flags&16384){var P=b.updateQueue;if(P!==null&&(P=P.stores,P!==null))for(var R=0;R<P.length;R++){var N=P[R],U=N.getSnapshot;N=N.value;try{if(!$l(U(),N))return!1}catch{return!1}}}if(P=b.child,b.subtreeFlags&16384&&P!==null)P.return=b,b=P;else{if(b===y)break;for(;b.sibling===null;){if(b.return===null||b.return===y)return!0;b=b.return}b.sibling.return=b.return,b=b.sibling}}return!0}function Ih(y,b){for(b&=~NP,b&=~Kb,y.suspendedLanes|=b,y.pingedLanes&=~b,y=y.expirationTimes;0<b;){var P=31-Qa(b),R=1<<P;y[P]=-1,b&=~R}}function g4(y){if(Mi&6)throw Error(a(327));gp();var b=gb(y,0);if(!(b&1))return Aa(y,jn()),null;var P=r_(y,b);if(y.tag!==0&&P===2){var R=W2(y);R!==0&&(b=R,P=VP(y,R))}if(P===1)throw P=ly,fp(y,0),Ih(y,b),Aa(y,jn()),P;if(P===6)throw Error(a(345));return y.finishedWork=y.current.alternate,y.finishedLanes=b,mp(y,Ea),Aa(y,jn()),null}function v4(y){Dh!==null&&Dh.tag===0&&!(Mi&6)&&gp();var b=Mi;Mi|=1;var P=en.transition,R=Fi;try{if(en.transition=null,Fi=1,y)return y()}finally{Fi=R,en.transition=P,Mi=b,!(Mi&6)&&Jl()}}function GP(){Ja=Sm.current,H(Sm)}function fp(y,b){y.finishedWork=null,y.finishedLanes=0;var P=y.timeoutHandle;if(P!==we&&(y.timeoutHandle=we,be(P)),pn!==null)for(P=pn.return;P!==null;){var R=P;switch(aP(R),R.tag){case 1:R=R.type.childContextTypes,R!=null&&$i();break;case 3:bm(),H(Ae),H(te),pP();break;case 5:hP(R);break;case 4:bm();break;case 13:H(Rr);break;case 19:H(Rr);break;case 10:eP(R.type._context);break;case 22:case 23:GP()}P=P.return}if(dn=y,pn=y=Lh(y.current,null),ds=Ja=b,Pn=0,ly=null,NP=Kb=Mm=0,Ea=cy=null,ec!==null){for(b=0;b<ec.length;b++)if(P=ec[b],R=P.interleaved,R!==null){P.interleaved=null;var N=R.next,U=P.pending;if(U!==null){var pe=U.next;U.next=N,R.next=pe}P.pending=R}ec=null}return y}function y4(y,b){do{var P=pn;try{if(J2(),Pb.current=zb,Db){for(var R=Vr.memoizedState;R!==null;){var N=R.queue;N!==null&&(N.pending=null),R=R.next}Db=!1}if(_m=0,Wn=Ds=Vr=null,J0=!1,ey=0,zP.current=null,P===null||P.return===null){Pn=1,ly=b,pn=null;break}e:{var U=y,pe=P.return,Re=P,Je=b;if(b=ds,Re.flags|=32768,Je!==null&&typeof Je=="object"&&typeof Je.then=="function"){var xt=Je,Lt=Re,fi=Lt.tag;if(!(Lt.mode&1)&&(fi===0||fi===11||fi===15)){var Qt=Lt.alternate;Qt?(Lt.updateQueue=Qt.updateQueue,Lt.memoizedState=Qt.memoizedState,Lt.lanes=Qt.lanes):(Lt.updateQueue=null,Lt.memoizedState=null)}var pr=UF(pe);if(pr!==null){pr.flags&=-257,FF(pr,pe,Re,U,b),pr.mode&1&&kF(U,xt,b),b=pr,Je=xt;var Vt=b.updateQueue;if(Vt===null){var Ls=new Set;Ls.add(Je),b.updateQueue=Ls}else Vt.add(Je);break e}else{if(!(b&1)){kF(U,xt,b),jP();break e}Je=Error(a(426))}}else if(Tr&&Re.mode&1){var Po=UF(pe);if(Po!==null){!(Po.flags&65536)&&(Po.flags|=256),FF(Po,pe,Re,U,b),cP(Je);break e}}U=Je,Pn!==4&&(Pn=2),cy===null?cy=[U]:cy.push(U),Je=wP(Je,Re),Re=pe;do{switch(Re.tag){case 3:Re.flags|=65536,b&=-b,Re.lanes|=b;var We=NF(Re,Je,b);nF(Re,We);break e;case 1:U=Je;var Be=Re.type,Ke=Re.stateNode;if(!(Re.flags&128)&&(typeof Be.getDerivedStateFromError=="function"||Ke!==null&&typeof Ke.componentDidCatch=="function"&&(Ph===null||!Ph.has(Ke)))){Re.flags|=65536,b&=-b,Re.lanes|=b;var Pt=BF(Re,U,b);nF(Re,Pt);break e}}Re=Re.return}while(Re!==null)}b4(P)}catch(Ft){b=Ft,pn===P&&P!==null&&(pn=P=P.return);continue}break}while(!0)}function x4(){var y=Qb.current;return Qb.current=zb,y===null?zb:y}function jP(){(Pn===0||Pn===3||Pn===2)&&(Pn=4),dn===null||!(Mm&268435455)&&!(Kb&268435455)||Ih(dn,ds)}function r_(y,b){var P=Mi;Mi|=2;var R=x4();dn===y&&ds===b||fp(y,b);do try{Rre();break}catch(N){y4(y,N)}while(!0);if(J2(),Mi=P,Qb.current=R,pn!==null)throw Error(a(261));return dn=null,ds=0,Pn}function Rre(){for(;pn!==null;)w4(pn)}function Ire(){for(;pn!==null&&!nre();)w4(pn)}function w4(y){var b=M4(y.alternate,y,Ja);y.memoizedProps=y.pendingProps,b===null?b4(y):pn=b,zP.current=null}function b4(y){var b=y;do{var P=b.alternate;if(y=b.return,b.flags&32768){if(P=Mre(P,b),P!==null){P.flags&=32767,pn=P;return}if(y!==null)y.flags|=32768,y.subtreeFlags=0,y.deletions=null;else{Pn=6,pn=null;return}}else if(P=bre(P,b,Ja),P!==null){pn=P;return}if(b=b.sibling,b!==null){pn=b;return}pn=b=y}while(b!==null);Pn===0&&(Pn=5)}function mp(y,b){var P=Fi,R=en.transition;try{en.transition=null,Fi=1,Lre(y,b,P)}finally{en.transition=R,Fi=P}return null}function Lre(y,b,P){do gp();while(Dh!==null);if(Mi&6)throw Error(a(327));var R=y.finishedWork,N=y.finishedLanes;if(R===null)return null;if(y.finishedWork=null,y.finishedLanes=0,R===y.current)throw Error(a(177));y.callbackNode=null,y.callbackPriority=0;var U=R.lanes|R.childLanes;if(rre(y,U),y===dn&&(pn=dn=null,ds=0),!(R.subtreeFlags&2064)&&!(R.flags&2064)||$b||($b=!0,E4(K2,function(){return gp(),null})),U=(R.flags&15990)!==0,R.subtreeFlags&15990||U){U=en.transition,en.transition=null;var pe=Fi;Fi=1;var Re=Mi;Mi|=4,zP.current=null,Are(y,R),Cre(y,R),V(y.containerInfo),y.current=R,Tre(R),sre(),Mi=Re,Fi=pe,en.transition=U}else y.current=R;if($b&&($b=!1,Dh=y,Jb=N),U=y.pendingLanes,U===0&&(Ph=null),lre(R.stateNode),Aa(y,jn()),b!==null)for(P=y.onRecoverableError,R=0;R<b.length;R++)P(b[R]);if(Zb)throw Zb=!1,y=UP,UP=null,y;return Jb&1&&y.tag!==0&&gp(),U=y.pendingLanes,U&1?y===FP?uy++:(uy=0,FP=y):uy=0,Jl(),null}function gp(){if(Dh!==null){var y=JU(Jb),b=en.transition,P=Fi;try{if(en.transition=null,Fi=16>y?16:y,Dh===null)var R=!1;else{if(y=Dh,Dh=null,Jb=0,Mi&6)throw Error(a(331));var N=Mi;for(Mi|=4,At=y.current;At!==null;){var U=At,pe=U.child;if(At.flags&16){var Re=U.deletions;if(Re!==null){for(var Je=0;Je<Re.length;Je++){var xt=Re[Je];for(At=xt;At!==null;){var Lt=At;switch(Lt.tag){case 0:case 11:case 15:pp(8,Lt,U)}var fi=Lt.child;if(fi!==null)fi.return=Lt,At=fi;else for(;At!==null;){Lt=At;var Qt=Lt.sibling,pr=Lt.return;if(s4(Lt),Lt===xt){At=null;break}if(Qt!==null){Qt.return=pr,At=Qt;break}At=pr}}}var Vt=U.alternate;if(Vt!==null){var Ls=Vt.child;if(Ls!==null){Vt.child=null;do{var Po=Ls.sibling;Ls.sibling=null,Ls=Po}while(Ls!==null)}}At=U}}if(U.subtreeFlags&2064&&pe!==null)pe.return=U,At=pe;else e:for(;At!==null;){if(U=At,U.flags&2048)switch(U.tag){case 0:case 11:case 15:pp(9,U,U.return)}var We=U.sibling;if(We!==null){We.return=U.return,At=We;break e}At=U.return}}var Be=y.current;for(At=Be;At!==null;){pe=At;var Ke=pe.child;if(pe.subtreeFlags&2064&&Ke!==null)Ke.return=pe,At=Ke;else e:for(pe=Be;At!==null;){if(Re=At,Re.flags&2048)try{switch(Re.tag){case 0:case 11:case 15:ay(9,Re)}}catch(Ft){Ca(Re,Re.return,Ft)}if(Re===pe){At=null;break e}var Pt=Re.sibling;if(Pt!==null){Pt.return=Re.return,At=Pt;break e}At=Re.return}}if(Mi=N,Jl(),Zl&&typeof Zl.onPostCommitFiberRoot=="function")try{Zl.onPostCommitFiberRoot(vb,y)}catch{}R=!0}return R}finally{Fi=P,en.transition=b}}return!1}function _4(y,b,P){b=wP(P,b),b=NF(y,b,1),Th(y,b),b=ia(),y=i_(y,1),y!==null&&(q0(y,1,b),Aa(y,b))}function Ca(y,b,P){if(y.tag===3)_4(y,y,P);else for(;b!==null;){if(b.tag===3){_4(b,y,P);break}else if(b.tag===1){var R=b.stateNode;if(typeof b.type.getDerivedStateFromError=="function"||typeof R.componentDidCatch=="function"&&(Ph===null||!Ph.has(R))){y=wP(P,y),y=BF(b,y,1),Th(b,y),y=ia(),b=i_(b,1),b!==null&&(q0(b,1,y),Aa(b,y));break}}b=b.return}}function Ore(y,b,P){var R=y.pingCache;R!==null&&R.delete(b),b=ia(),y.pingedLanes|=y.suspendedLanes&P,dn===y&&(ds&P)===P&&(Pn===4||Pn===3&&(ds&130023424)===ds&&500>jn()-BP?fp(y,0):NP|=P),Aa(y,b)}function S4(y,b){b===0&&(y.mode&1?(b=mb,mb<<=1,!(mb&130023424)&&(mb=4194304)):b=1);var P=ia();y=i_(y,b),y!==null&&(q0(y,b,P),Aa(y,P))}function zre(y){var b=y.memoizedState,P=0;b!==null&&(P=b.retryLane),S4(y,P)}function Nre(y,b){var P=0;switch(y.tag){case 13:var R=y.stateNode,N=y.memoizedState;N!==null&&(P=N.retryLane);break;case 19:R=y.stateNode;break;default:throw Error(a(314))}R!==null&&R.delete(b),S4(y,P)}var M4;M4=function(y,b,P){if(y!==null)if(y.memoizedProps!==b.pendingProps||Ae.current)$a=!0;else{if(!(y.lanes&P)&&!(b.flags&128))return $a=!1,Sre(y,b,P);$a=!!(y.flags&131072)}else $a=!1,Tr&&b.flags&1048576&&uF(b,Ab,b.index);switch(b.lanes=0,b.tag){case 2:var R=b.type;y!==null&&(y.alternate=null,b.alternate=null,b.flags|=2),y=b.pendingProps;var N=Zi(b,te.current);mm(b,P),N=mP(null,b,R,y,N,P);var U=gP();return b.flags|=1,typeof N=="object"&&N!==null&&typeof N.render=="function"&&N.$$typeof===void 0?(b.tag=1,b.memoizedState=null,b.updateQueue=null,Fr(R)?(U=!0,Jr(b)):U=!1,b.memoizedState=N.state!==null&&N.state!==void 0?N.state:null,iP(b),N.updater=Mb,b.stateNode=N,N._reactInternals=b,nP(b,R,y,P),b=SP(null,b,R,!0,U,P)):(b.tag=0,Tr&&U&&sP(b),ta(null,b,N,P),b=b.child),b;case 16:R=b.elementType;e:{switch(y!==null&&(y.alternate=null,b.alternate=null,b.flags|=2),y=b.pendingProps,N=R._init,R=N(R._payload),b.type=R,N=b.tag=kre(R),y=ll(R,y),N){case 0:b=_P(null,b,R,y,P);break e;case 1:b=YF(null,b,R,y,P);break e;case 11:b=GF(null,b,R,y,P);break e;case 14:b=jF(null,b,R,ll(R.type,y),P);break e}throw Error(a(306,R,""))}return b;case 0:return R=b.type,N=b.pendingProps,N=b.elementType===R?N:ll(R,N),_P(y,b,R,N,P);case 1:return R=b.type,N=b.pendingProps,N=b.elementType===R?N:ll(R,N),YF(y,b,R,N,P);case 3:e:{if(QF(b),y===null)throw Error(a(387));R=b.pendingProps,U=b.memoizedState,N=U.element,rF(y,b),Sb(b,R,null,P);var pe=b.memoizedState;if(R=pe.element,ge&&U.isDehydrated)if(U={element:R,isDehydrated:!1,cache:pe.cache,transitions:pe.transitions},b.updateQueue.baseState=U,b.memoizedState=U,b.flags&256){N=Error(a(423)),b=KF(y,b,R,P,N);break e}else if(R!==N){N=Error(a(424)),b=KF(y,b,R,P,N);break e}else for(ge&&(Za=Ve(b.stateNode.containerInfo),Ka=b,Tr=!0,cl=null,Y0=!1),P=gF(b,null,R,P),b.child=P;P;)P.flags=P.flags&-3|4096,P=P.sibling;else{if(ym(),R===N){b=ou(y,b,P);break e}ta(y,b,R,P)}b=b.child}return b;case 5:return vF(b),y===null&&lP(b),R=b.type,N=b.pendingProps,U=y!==null?y.memoizedProps:null,pe=N.children,ne(R,N)?pe=null:U!==null&&ne(R,U)&&(b.flags|=32),qF(y,b),ta(y,b,pe,P),b.child;case 6:return y===null&&lP(b),null;case 13:return ZF(y,b,P);case 4:return uP(b,b.stateNode.containerInfo),R=b.pendingProps,y===null?b.child=xm(b,null,R,P):ta(y,b,R,P),b.child;case 11:return R=b.type,N=b.pendingProps,N=b.elementType===R?N:ll(R,N),GF(y,b,R,N,P);case 7:return ta(y,b,b.pendingProps,P),b.child;case 8:return ta(y,b,b.pendingProps.children,P),b.child;case 12:return ta(y,b,b.pendingProps.children,P),b.child;case 10:e:{if(R=b.type._context,N=b.pendingProps,U=b.memoizedProps,pe=N.value,iF(b,R,pe),U!==null)if($l(U.value,pe)){if(U.children===N.children&&!Ae.current){b=ou(y,b,P);break e}}else for(U=b.child,U!==null&&(U.return=b);U!==null;){var Re=U.dependencies;if(Re!==null){pe=U.child;for(var Je=Re.firstContext;Je!==null;){if(Je.context===R){if(U.tag===1){Je=ru(-1,P&-P),Je.tag=2;var xt=U.updateQueue;if(xt!==null){xt=xt.shared;var Lt=xt.pending;Lt===null?Je.next=Je:(Je.next=Lt.next,Lt.next=Je),xt.pending=Je}}U.lanes|=P,Je=U.alternate,Je!==null&&(Je.lanes|=P),tP(U.return,P,b),Re.lanes|=P;break}Je=Je.next}}else if(U.tag===10)pe=U.type===b.type?null:U.child;else if(U.tag===18){if(pe=U.return,pe===null)throw Error(a(341));pe.lanes|=P,Re=pe.alternate,Re!==null&&(Re.lanes|=P),tP(pe,P,b),pe=U.sibling}else pe=U.child;if(pe!==null)pe.return=U;else for(pe=U;pe!==null;){if(pe===b){pe=null;break}if(U=pe.sibling,U!==null){U.return=pe.return,pe=U;break}pe=pe.return}U=pe}ta(y,b,N.children,P),b=b.child}return b;case 9:return N=b.type,R=b.pendingProps.children,mm(b,P),N=_o(N),R=R(N),b.flags|=1,ta(y,b,R,P),b.child;case 14:return R=b.type,N=ll(R,b.pendingProps),N=ll(R.type,N),jF(y,b,R,N,P);case 15:return WF(y,b,b.type,b.pendingProps,P);case 17:return R=b.type,N=b.pendingProps,N=b.elementType===R?N:ll(R,N),y!==null&&(y.alternate=null,b.alternate=null,b.flags|=2),b.tag=1,Fr(R)?(y=!0,Jr(b)):y=!1,mm(b,P),lF(b,R,N),nP(b,R,N,P),SP(null,b,R,!0,y,P);case 19:return t4(y,b,P);case 22:return XF(y,b,P)}throw Error(a(156,b.tag))};function E4(y,b){return Y2(y,b)}function Bre(y,b,P,R){this.tag=y,this.key=P,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=b,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=R,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function To(y,b,P,R){return new Bre(y,b,P,R)}function WP(y){return y=y.prototype,!(!y||!y.isReactComponent)}function kre(y){if(typeof y=="function")return WP(y)?1:0;if(y!=null){if(y=y.$$typeof,y===v)return 11;if(y===x)return 14}return 2}function Lh(y,b){var P=y.alternate;return P===null?(P=To(y.tag,b,y.key,y.mode),P.elementType=y.elementType,P.type=y.type,P.stateNode=y.stateNode,P.alternate=y,y.alternate=P):(P.pendingProps=b,P.type=y.type,P.flags=0,P.subtreeFlags=0,P.deletions=null),P.flags=y.flags&14680064,P.childLanes=y.childLanes,P.lanes=y.lanes,P.child=y.child,P.memoizedProps=y.memoizedProps,P.memoizedState=y.memoizedState,P.updateQueue=y.updateQueue,b=y.dependencies,P.dependencies=b===null?null:{lanes:b.lanes,firstContext:b.firstContext},P.sibling=y.sibling,P.index=y.index,P.ref=y.ref,P}function n_(y,b,P,R,N,U){var pe=2;if(R=y,typeof y=="function")WP(y)&&(pe=1);else if(typeof y=="string")pe=5;else e:switch(y){case u:return vp(P.children,N,U,b);case h:pe=8,N|=8;break;case d:return y=To(12,P,b,N|2),y.elementType=d,y.lanes=U,y;case g:return y=To(13,P,b,N),y.elementType=g,y.lanes=U,y;case m:return y=To(19,P,b,N),y.elementType=m,y.lanes=U,y;case _:return s_(P,N,U,b);default:if(typeof y=="object"&&y!==null)switch(y.$$typeof){case p:pe=10;break e;case f:pe=9;break e;case v:pe=11;break e;case x:pe=14;break e;case w:pe=16,R=null;break e}throw Error(a(130,y==null?y:typeof y,""))}return b=To(pe,P,b,N),b.elementType=y,b.type=R,b.lanes=U,b}function vp(y,b,P,R){return y=To(7,y,R,b),y.lanes=P,y}function s_(y,b,P,R){return y=To(22,y,R,b),y.elementType=_,y.lanes=P,y.stateNode={},y}function XP(y,b,P){return y=To(6,y,null,b),y.lanes=P,y}function qP(y,b,P){return b=To(4,y.children!==null?y.children:[],y.key,b),b.lanes=P,b.stateNode={containerInfo:y.containerInfo,pendingChildren:null,implementation:y.implementation},b}function Ure(y,b,P,R,N){this.tag=b,this.containerInfo=y,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=we,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=X2(0),this.expirationTimes=X2(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=X2(0),this.identifierPrefix=R,this.onRecoverableError=N,ge&&(this.mutableSourceEagerHydrationData=null)}function A4(y,b,P,R,N,U,pe,Re,Je){return y=new Ure(y,b,P,Re,Je),b===1?(b=1,U===!0&&(b|=8)):b=0,U=To(3,null,null,b),y.current=U,U.stateNode=y,U.memoizedState={element:R,isDehydrated:P,cache:null,transitions:null},iP(U),y}function C4(y){if(!y)return me;y=y._reactInternals;e:{if(E(y)!==y||y.tag!==1)throw Error(a(170));var b=y;do{switch(b.tag){case 3:b=b.stateNode.context;break e;case 1:if(Fr(b.type)){b=b.stateNode.__reactInternalMemoizedMergedChildContext;break e}}b=b.return}while(b!==null);throw Error(a(171))}if(y.tag===1){var P=y.type;if(Fr(P))return ol(y,P,b)}return b}function T4(y){var b=y._reactInternals;if(b===void 0)throw typeof y.render=="function"?Error(a(188)):(y=Object.keys(y).join(","),Error(a(268,y)));return y=I(b),y===null?null:y.stateNode}function P4(y,b){if(y=y.memoizedState,y!==null&&y.dehydrated!==null){var P=y.retryLane;y.retryLane=P!==0&&P<b?P:b}}function YP(y,b){P4(y,b),(y=y.alternate)&&P4(y,b)}function Fre(y){return y=I(y),y===null?null:y.stateNode}function Vre(){return null}return i.attemptContinuousHydration=function(y){if(y.tag===13){var b=ia();Co(y,134217728,b),YP(y,134217728)}},i.attemptHydrationAtCurrentPriority=function(y){if(y.tag===13){var b=ia(),P=Rh(y);Co(y,P,b),YP(y,P)}},i.attemptSynchronousHydration=function(y){switch(y.tag){case 3:var b=y.stateNode;if(b.current.memoizedState.isDehydrated){var P=X0(b.pendingLanes);P!==0&&(q2(b,P|1),Aa(b,jn()),!(Mi&6)&&(Em(),Jl()))}break;case 13:var R=ia();v4(function(){return Co(y,1,R)}),YP(y,1)}},i.batchedUpdates=function(y,b){var P=Mi;Mi|=1;try{return y(b)}finally{Mi=P,Mi===0&&(Em(),yb&&Jl())}},i.createComponentSelector=function(y){return{$$typeof:jb,value:y}},i.createContainer=function(y,b,P,R,N,U,pe){return A4(y,b,!1,null,P,R,N,U,pe)},i.createHasPseudoClassSelector=function(y){return{$$typeof:Wb,value:y}},i.createHydrationContainer=function(y,b,P,R,N,U,pe,Re,Je){return y=A4(P,R,!0,y,N,U,pe,Re,Je),y.context=C4(null),P=y.current,R=ia(),N=Rh(P),U=ru(R,N),U.callback=b??null,Th(P,U),y.current.lanes=N,q0(y,N,R),Aa(y,R),y},i.createPortal=function(y,b,P){var R=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:c,key:R==null?null:""+R,children:y,containerInfo:b,implementation:P}},i.createRoleSelector=function(y){return{$$typeof:Xb,value:y}},i.createTestNameSelector=function(y){return{$$typeof:qb,value:y}},i.createTextSelector=function(y){return{$$typeof:Yb,value:y}},i.deferredUpdates=function(y){var b=Fi,P=en.transition;try{return en.transition=null,Fi=16,y()}finally{Fi=b,en.transition=P}},i.discreteUpdates=function(y,b,P,R,N){var U=Fi,pe=en.transition;try{return en.transition=null,Fi=1,y(b,P,R,N)}finally{Fi=U,en.transition=pe,Mi===0&&Em()}},i.findAllNodes=OP,i.findBoundingRects=function(y,b){if(!se)throw Error(a(363));b=OP(y,b),y=[];for(var P=0;P<b.length;P++)y.push(K(b[P]));for(b=y.length-1;0<b;b--){P=y[b];for(var R=P.x,N=R+P.width,U=P.y,pe=U+P.height,Re=b-1;0<=Re;Re--)if(b!==Re){var Je=y[Re],xt=Je.x,Lt=xt+Je.width,fi=Je.y,Qt=fi+Je.height;if(R>=xt&&U>=fi&&N<=Lt&&pe<=Qt){y.splice(b,1);break}else if(R!==xt||P.width!==Je.width||Qt<U||fi>pe){if(!(U!==fi||P.height!==Je.height||Lt<R||xt>N)){xt>R&&(Je.width+=xt-R,Je.x=R),Lt<N&&(Je.width=N-xt),y.splice(b,1);break}}else{fi>U&&(Je.height+=fi-U,Je.y=U),Qt<pe&&(Je.height=pe-fi),y.splice(b,1);break}}}return y},i.findHostInstance=T4,i.findHostInstanceWithNoPortals=function(y){return y=D(y),y=y!==null?z(y):null,y===null?null:y.stateNode},i.findHostInstanceWithWarning=function(y){return T4(y)},i.flushControlled=function(y){var b=Mi;Mi|=1;var P=en.transition,R=Fi;try{en.transition=null,Fi=1,y()}finally{Fi=R,en.transition=P,Mi=b,Mi===0&&(Em(),Jl())}},i.flushPassiveEffects=gp,i.flushSync=v4,i.focusWithin=function(y,b){if(!se)throw Error(a(363));for(y=RP(y),b=f4(y,b),b=Array.from(b),y=0;y<b.length;){var P=b[y++];if(!re(P)){if(P.tag===5&&G(P.stateNode))return!0;for(P=P.child;P!==null;)b.push(P),P=P.sibling}}return!1},i.getCurrentUpdatePriority=function(){return Fi},i.getFindAllNodesFailureDescription=function(y,b){if(!se)throw Error(a(363));var P=0,R=[];y=[RP(y),0];for(var N=0;N<y.length;){var U=y[N++],pe=y[N++],Re=b[pe];if((U.tag!==5||!re(U))&&(IP(U,Re)&&(R.push(LP(Re)),pe++,pe>P&&(P=pe)),pe<b.length))for(U=U.child;U!==null;)y.push(U,pe),U=U.sibling}if(P<b.length){for(y=[];P<b.length;P++)y.push(LP(b[P]));return`findAllNodes was able to match part of the selector:
  `+(R.join(" > ")+`

No matching component was found for:
  `)+y.join(" > ")}return null},i.getPublicRootInstance=function(y){if(y=y.current,!y.child)return null;switch(y.child.tag){case 5:return Q(y.child.stateNode);default:return y.child.stateNode}},i.injectIntoDevTools=function(y){if(y={bundleType:y.bundleType,version:y.version,rendererPackageName:y.rendererPackageName,rendererConfig:y.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:o.ReactCurrentDispatcher,findHostInstanceByFiber:Fre,findFiberByHostInstance:y.findFiberByHostInstance||Vre,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.0.0-fc46dba67-20220329"},typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")y=!1;else{var b=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(b.isDisabled||!b.supportsFiber)y=!0;else{try{vb=b.inject(y),Zl=b}catch{}y=!!b.checkDCE}}return y},i.isAlreadyRendering=function(){return!1},i.observeVisibleRects=function(y,b,P,R){if(!se)throw Error(a(363));y=OP(y,b);var N=Te(y,P,R).disconnect;return{disconnect:function(){N()}}},i.registerMutableSourceForHydration=function(y,b){var P=b._getVersion;P=P(b._source),y.mutableSourceEagerHydrationData==null?y.mutableSourceEagerHydrationData=[b,P]:y.mutableSourceEagerHydrationData.push(b,P)},i.runWithPriority=function(y,b){var P=Fi;try{return Fi=y,b()}finally{Fi=P}},i.shouldError=function(){return null},i.shouldSuspend=function(){return!1},i.updateContainer=function(y,b,P,R){var N=b.current,U=ia(),pe=Rh(N);return P=C4(P),b.context===null?b.context=P:b.pendingContext=P,b=ru(U,pe),b.payload={element:y},R=R===void 0?null:R,R!==null&&(b.callback=R),Th(N,b),y=Co(N,pe,U),y!==null&&_b(y,N,pe),pe},i};Ete.exports=GFe;var jFe=Ete.exports;const WFe=v0(jFe);var Ate={exports:{}},Cte={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(O,j){var V=O.length;O.push(j);e:for(;0<V;){var W=V-1>>>1,J=O[W];if(0<n(J,j))O[W]=j,O[V]=J,V=W;else break e}}function i(O){return O.length===0?null:O[0]}function r(O){if(O.length===0)return null;var j=O[0],V=O.pop();if(V!==j){O[0]=V;e:for(var W=0,J=O.length,ce=J>>>1;W<ce;){var $=2*(W+1)-1,ne=O[$],ie=$+1,de=O[ie];if(0>n(ne,V))ie<J&&0>n(de,ne)?(O[W]=de,O[ie]=V,W=ie):(O[W]=ne,O[$]=V,W=$);else if(ie<J&&0>n(de,V))O[W]=de,O[ie]=V,W=ie;else break e}}return j}function n(O,j){var V=O.sortIndex-j.sortIndex;return V!==0?V:O.id-j.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;e.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();e.unstable_now=function(){return a.now()-o}}var l=[],c=[],u=1,h=null,d=3,p=!1,f=!1,v=!1,g=typeof setTimeout=="function"?setTimeout:null,m=typeof clearTimeout=="function"?clearTimeout:null,x=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function w(O){for(var j=i(c);j!==null;){if(j.callback===null)r(c);else if(j.startTime<=O)r(c),j.sortIndex=j.expirationTime,t(l,j);else break;j=i(c)}}function _(O){if(v=!1,w(O),!f)if(i(l)!==null)f=!0,Q(M);else{var j=i(c);j!==null&&Y(_,j.startTime-O)}}function M(O,j){f=!1,v&&(v=!1,m(T),T=-1),p=!0;var V=d;try{for(w(j),h=i(l);h!==null&&(!(h.expirationTime>j)||O&&!D());){var W=h.callback;if(typeof W=="function"){h.callback=null,d=h.priorityLevel;var J=W(h.expirationTime<=j);j=e.unstable_now(),typeof J=="function"?h.callback=J:h===i(l)&&r(l),w(j)}else r(l);h=i(l)}if(h!==null)var ce=!0;else{var $=i(c);$!==null&&Y(_,$.startTime-j),ce=!1}return ce}finally{h=null,d=V,p=!1}}var S=!1,A=null,T=-1,E=5,C=-1;function D(){return!(e.unstable_now()-C<E)}function I(){if(A!==null){var O=e.unstable_now();C=O;var j=!0;try{j=A(!0,O)}finally{j?L():(S=!1,A=null)}}else S=!1}var L;if(typeof x=="function")L=function(){x(I)};else if(typeof MessageChannel<"u"){var z=new MessageChannel,F=z.port2;z.port1.onmessage=I,L=function(){F.postMessage(null)}}else L=function(){g(I,0)};function Q(O){A=O,S||(S=!0,L())}function Y(O,j){T=g(function(){O(e.unstable_now())},j)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(O){O.callback=null},e.unstable_continueExecution=function(){f||p||(f=!0,Q(M))},e.unstable_forceFrameRate=function(O){0>O||125<O?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):E=0<O?Math.floor(1e3/O):5},e.unstable_getCurrentPriorityLevel=function(){return d},e.unstable_getFirstCallbackNode=function(){return i(l)},e.unstable_next=function(O){switch(d){case 1:case 2:case 3:var j=3;break;default:j=d}var V=d;d=j;try{return O()}finally{d=V}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(O,j){switch(O){case 1:case 2:case 3:case 4:case 5:break;default:O=3}var V=d;d=O;try{return j()}finally{d=V}},e.unstable_scheduleCallback=function(O,j,V){var W=e.unstable_now();switch(typeof V=="object"&&V!==null?(V=V.delay,V=typeof V=="number"&&0<V?W+V:W):V=W,O){case 1:var J=-1;break;case 2:J=250;break;case 5:J=1073741823;break;case 4:J=1e4;break;default:J=5e3}return J=V+J,O={id:u++,callback:j,priorityLevel:O,startTime:V,expirationTime:J,sortIndex:-1},V>W?(O.sortIndex=V,t(c,O),i(l)===null&&O===i(c)&&(v?(m(T),T=-1):v=!0,Y(_,V-W))):(O.sortIndex=J,t(l,O),f||p||(f=!0,Q(M))),O},e.unstable_shouldYield=D,e.unstable_wrapCallback=function(O){var j=d;return function(){var V=d;d=j;try{return O.apply(this,arguments)}finally{d=V}}}})(Cte);Ate.exports=Cte;var I9=Ate.exports;const OU={},XFe=e=>void Object.assign(OU,e);function qFe(e,t){function i(u,{args:h=[],attach:d,...p},f){let v=`${u[0].toUpperCase()}${u.slice(1)}`,g;if(u==="primitive"){if(p.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const m=p.object;g=Fg(m,{type:u,root:f,attach:d,primitive:!0})}else{const m=OU[v];if(!m)throw new Error(`R3F: ${v} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(h))throw new Error("R3F: The args prop must be an array!");g=Fg(new m(...h),{type:u,root:f,attach:d,memoizedProps:{args:h}})}return g.__r3f.attach===void 0&&(g instanceof wi?g.__r3f.attach="geometry":g instanceof Ts&&(g.__r3f.attach="material")),v!=="inject"&&vI(g,p),g}function r(u,h){let d=!1;if(h){var p,f;(p=h.__r3f)!=null&&p.attach?gI(u,h,h.__r3f.attach):h.isObject3D&&u.isObject3D&&(u.add(h),d=!0),d||(f=u.__r3f)==null||f.objects.push(h),h.__r3f||Fg(h,{}),h.__r3f.parent=u,Qz(h),Vg(h)}}function n(u,h,d){let p=!1;if(h){var f,v;if((f=h.__r3f)!=null&&f.attach)gI(u,h,h.__r3f.attach);else if(h.isObject3D&&u.isObject3D){h.parent=u,h.dispatchEvent({type:"added"}),u.dispatchEvent({type:"childadded",child:h});const g=u.children.filter(x=>x!==h),m=g.indexOf(d);u.children=[...g.slice(0,m),h,...g.slice(m)],p=!0}p||(v=u.__r3f)==null||v.objects.push(h),h.__r3f||Fg(h,{}),h.__r3f.parent=u,Qz(h),Vg(h)}}function s(u,h,d=!1){u&&[...u].forEach(p=>a(h,p,d))}function a(u,h,d){if(h){var p,f,v;if(h.__r3f&&(h.__r3f.parent=null),(p=u.__r3f)!=null&&p.objects&&(u.__r3f.objects=u.__r3f.objects.filter(_=>_!==h)),(f=h.__r3f)!=null&&f.attach)B9(u,h,h.__r3f.attach);else if(h.isObject3D&&u.isObject3D){var g;u.remove(h),(g=h.__r3f)!=null&&g.root&&t4e(RE(h),h)}const x=(v=h.__r3f)==null?void 0:v.primitive,w=!x&&(d===void 0?h.dispose!==null:d);if(!x){var m;s((m=h.__r3f)==null?void 0:m.objects,h,w),s(h.children,h,w)}if(delete h.__r3f,w&&h.dispose&&h.type!=="Scene"){const _=()=>{try{h.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?I9.unstable_scheduleCallback(I9.unstable_IdlePriority,_):_()}Vg(u)}}function o(u,h,d,p){var f;const v=(f=u.__r3f)==null?void 0:f.parent;if(!v)return;const g=i(h,d,u.__r3f.root);if(u.children){for(const m of u.children)m.__r3f&&r(g,m);u.children=u.children.filter(m=>!m.__r3f)}u.__r3f.objects.forEach(m=>r(g,m)),u.__r3f.objects=[],u.__r3f.autoRemovedBeforeAppend||a(v,u),g.parent&&(g.__r3f.autoRemovedBeforeAppend=!0),r(v,g),g.raycast&&g.__r3f.eventCount&&RE(g).getState().internal.interaction.push(g),[p,p.alternate].forEach(m=>{m!==null&&(m.stateNode=g,m.ref&&(typeof m.ref=="function"?m.ref(g):m.ref.current=g))})}const l=()=>console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.");return{reconciler:WFe({createInstance:i,removeChild:a,appendChild:r,appendInitialChild:r,insertBefore:n,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(u,h)=>{if(!h)return;const d=u.getState().scene;d.__r3f&&(d.__r3f.root=u,r(d,h))},removeChildFromContainer:(u,h)=>{h&&a(u.getState().scene,h)},insertInContainerBefore:(u,h,d)=>{if(!h||!d)return;const p=u.getState().scene;p.__r3f&&n(p,h,d)},getRootHostContext:()=>null,getChildHostContext:u=>u,finalizeInitialChildren(u){var h;return!!((h=u==null?void 0:u.__r3f)!=null?h:{}).handlers},prepareUpdate(u,h,d,p){var f;if(((f=u==null?void 0:u.__r3f)!=null?f:{}).primitive&&p.object&&p.object!==u)return[!0];{const{args:g=[],children:m,...x}=p,{args:w=[],children:_,...M}=d;if(!Array.isArray(g))throw new Error("R3F: the args prop must be an array!");if(g.some((A,T)=>A!==w[T]))return[!0];const S=Ote(u,x,M,!0);return S.changes.length?[!1,S]:null}},commitUpdate(u,[h,d],p,f,v,g){h?o(u,p,v,g):vI(u,d)},commitMount(u,h,d,p){var f;const v=(f=u.__r3f)!=null?f:{};u.raycast&&v.handlers&&v.eventCount&&RE(u).getState().internal.interaction.push(u)},getPublicInstance:u=>u,prepareForCommit:()=>null,preparePortalMount:u=>Fg(u.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(u){var h;const{attach:d,parent:p}=(h=u.__r3f)!=null?h:{};d&&p&&B9(p,u,d),u.isObject3D&&(u.visible=!1),Vg(u)},unhideInstance(u,h){var d;const{attach:p,parent:f}=(d=u.__r3f)!=null?d:{};p&&f&&gI(f,u,p),(u.isObject3D&&h.visible==null||h.visible)&&(u.visible=!0),Vg(u)},createTextInstance:l,hideTextInstance:l,unhideTextInstance:l,getCurrentEventPriority:()=>t?t():pv.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&Er.fun(performance.now)?performance.now:Er.fun(Date.now)?Date.now:()=>0,scheduleTimeout:Er.fun(setTimeout)?setTimeout:void 0,cancelTimeout:Er.fun(clearTimeout)?clearTimeout:void 0}),applyProps:vI}}var L9,O9;const mI=e=>"colorSpace"in e||"outputColorSpace"in e,Tte=()=>{var e;return(e=OU.ColorManagement)!=null?e:null},Pte=e=>e&&e.isOrthographicCamera,YFe=e=>e&&e.hasOwnProperty("current"),ob=typeof window<"u"&&((L9=window.document)!=null&&L9.createElement||((O9=window.navigator)==null?void 0:O9.product)==="ReactNative")?qe.useLayoutEffect:qe.useEffect;function Dte(e){const t=qe.useRef(e);return ob(()=>void(t.current=e),[e]),t}function QFe({set:e}){return ob(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class Rte extends qe.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}}Rte.getDerivedStateFromError=()=>({error:!0});const Ite="__default",z9=new Map,KFe=e=>e&&!!e.memoized&&!!e.changes;function Lte(e){var t;const i=typeof window<"u"?(t=window.devicePixelRatio)!=null?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],i),e[1]):e}const lx=e=>{var t;return(t=e.__r3f)==null?void 0:t.root.getState()};function RE(e){let t=e.__r3f.root;for(;t.getState().previousRoot;)t=t.getState().previousRoot;return t}const Er={obj:e=>e===Object(e)&&!Er.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,t,{arrays:i="shallow",objects:r="reference",strict:n=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(Er.str(e)||Er.num(e)||Er.boo(e))return e===t;const s=Er.obj(e);if(s&&r==="reference")return e===t;const a=Er.arr(e);if(a&&i==="reference")return e===t;if((a||s)&&e===t)return!0;let o;for(o in e)if(!(o in t))return!1;if(s&&i==="shallow"&&r==="shallow"){for(o in n?t:e)if(!Er.equ(e[o],t[o],{strict:n,objects:"reference"}))return!1}else for(o in n?t:e)if(e[o]!==t[o])return!1;if(Er.und(o)){if(a&&e.length===0&&t.length===0||s&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}};function ZFe(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const t in e)t.dispose==null||t.dispose(),delete e[t]}function Fg(e,t){const i=e;return i.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t},e}function Yz(e,t){let i=e;if(t.includes("-")){const r=t.split("-"),n=r.pop();return i=r.reduce((s,a)=>s[a],e),{target:i,key:n}}else return{target:i,key:t}}const N9=/-\d+$/;function gI(e,t,i){if(Er.str(i)){if(N9.test(i)){const s=i.replace(N9,""),{target:a,key:o}=Yz(e,s);Array.isArray(a[o])||(a[o]=[])}const{target:r,key:n}=Yz(e,i);t.__r3f.previousAttach=r[n],r[n]=t}else t.__r3f.previousAttach=i(e,t)}function B9(e,t,i){var r,n;if(Er.str(i)){const{target:s,key:a}=Yz(e,i),o=t.__r3f.previousAttach;o===void 0?delete s[a]:s[a]=o}else(r=t.__r3f)==null||r.previousAttach==null||r.previousAttach(e,t);(n=t.__r3f)==null||delete n.previousAttach}function Ote(e,{children:t,key:i,ref:r,...n},{children:s,key:a,ref:o,...l}={},c=!1){const u=e.__r3f,h=Object.entries(n),d=[];if(c){const f=Object.keys(l);for(let v=0;v<f.length;v++)n.hasOwnProperty(f[v])||h.unshift([f[v],Ite+"remove"])}h.forEach(([f,v])=>{var g;if((g=e.__r3f)!=null&&g.primitive&&f==="object"||Er.equ(v,l[f]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(f))return d.push([f,v,!0,[]]);let m=[];f.includes("-")&&(m=f.split("-")),d.push([f,v,!1,m]);for(const x in n){const w=n[x];x.startsWith(`${f}-`)&&d.push([x,w,!1,x.split("-")])}});const p={...n};return u!=null&&u.memoizedProps&&u!=null&&u.memoizedProps.args&&(p.args=u.memoizedProps.args),u!=null&&u.memoizedProps&&u!=null&&u.memoizedProps.attach&&(p.attach=u.memoizedProps.attach),{memoized:p,changes:d}}const $Fe=typeof process<"u"&&!1;function vI(e,t){var i;const r=e.__r3f,n=r==null?void 0:r.root,s=n==null||n.getState==null?void 0:n.getState(),{memoized:a,changes:o}=KFe(t)?t:Ote(e,t),l=r==null?void 0:r.eventCount;e.__r3f&&(e.__r3f.memoizedProps=a);for(let u=0;u<o.length;u++){let[h,d,p,f]=o[u];if(mI(e)){const x="srgb",w="srgb-linear";h==="encoding"?(h="colorSpace",d=d===3001?x:w):h==="outputEncoding"&&(h="outputColorSpace",d=d===3001?x:w)}let v=e,g=v[h];if(f.length&&(g=f.reduce((m,x)=>m[x],e),!(g&&g.set))){const[m,...x]=f.reverse();v=x.reverse().reduce((w,_)=>w[_],e),h=m}if(d===Ite+"remove")if(v.constructor){let m=z9.get(v.constructor);m||(m=new v.constructor,z9.set(v.constructor,m)),d=m[h]}else d=0;if(p&&r)d?r.handlers[h]=d:delete r.handlers[h],r.eventCount=Object.keys(r.handlers).length;else if(g&&g.set&&(g.copy||g instanceof If)){if(Array.isArray(d))g.fromArray?g.fromArray(d):g.set(...d);else if(g.copy&&d&&d.constructor&&($Fe?g.constructor.name===d.constructor.name:g.constructor===d.constructor))g.copy(d);else if(d!==void 0){const m=g instanceof Rt;!m&&g.setScalar?g.setScalar(d):g instanceof If&&d instanceof If?g.mask=d.mask:g.set(d),!Tte()&&s&&!s.linear&&m&&g.convertSRGBToLinear()}}else if(v[h]=d,v[h]instanceof kr&&v[h].format===Ys&&v[h].type===jl&&s){const m=v[h];mI(m)&&mI(s.gl)?m.colorSpace=s.gl.outputColorSpace:m.encoding=s.gl.outputEncoding}Vg(e)}if(r&&r.parent&&e.raycast&&l!==r.eventCount){const u=RE(e).getState().internal,h=u.interaction.indexOf(e);h>-1&&u.interaction.splice(h,1),r.eventCount&&u.interaction.push(e)}return!(o.length===1&&o[0][0]==="onUpdate")&&o.length&&(i=e.__r3f)!=null&&i.parent&&Qz(e),e}function Vg(e){var t,i;const r=(t=e.__r3f)==null||(i=t.root)==null||i.getState==null?void 0:i.getState();r&&r.internal.frames===0&&r.invalidate()}function Qz(e){e.onUpdate==null||e.onUpdate(e)}function JFe(e,t){e.manual||(Pte(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function kM(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function e4e(){var e;const t=typeof self<"u"&&self||typeof window<"u"&&window;if(!t)return pv.DefaultEventPriority;switch((e=t.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return pv.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return pv.ContinuousEventPriority;default:return pv.DefaultEventPriority}}function zte(e,t,i,r){const n=i.get(t);n&&(i.delete(t),i.size===0&&(e.delete(r),n.target.releasePointerCapture(r)))}function t4e(e,t){const{internal:i}=e.getState();i.interaction=i.interaction.filter(r=>r!==t),i.initialHits=i.initialHits.filter(r=>r!==t),i.hovered.forEach((r,n)=>{(r.eventObject===t||r.object===t)&&i.hovered.delete(n)}),i.capturedMap.forEach((r,n)=>{zte(i.capturedMap,t,r,n)})}function i4e(e){function t(l){const{internal:c}=e.getState(),u=l.offsetX-c.initialClick[0],h=l.offsetY-c.initialClick[1];return Math.round(Math.sqrt(u*u+h*h))}function i(l){return l.filter(c=>["Move","Over","Enter","Out","Leave"].some(u=>{var h;return(h=c.__r3f)==null?void 0:h.handlers["onPointer"+u]}))}function r(l,c){const u=e.getState(),h=new Set,d=[],p=c?c(u.internal.interaction):u.internal.interaction;for(let m=0;m<p.length;m++){const x=lx(p[m]);x&&(x.raycaster.camera=void 0)}u.previousRoot||u.events.compute==null||u.events.compute(l,u);function f(m){const x=lx(m);if(!x||!x.events.enabled||x.raycaster.camera===null)return[];if(x.raycaster.camera===void 0){var w;x.events.compute==null||x.events.compute(l,x,(w=x.previousRoot)==null?void 0:w.getState()),x.raycaster.camera===void 0&&(x.raycaster.camera=null)}return x.raycaster.camera?x.raycaster.intersectObject(m,!0):[]}let v=p.flatMap(f).sort((m,x)=>{const w=lx(m.object),_=lx(x.object);return!w||!_?m.distance-x.distance:_.events.priority-w.events.priority||m.distance-x.distance}).filter(m=>{const x=kM(m);return h.has(x)?!1:(h.add(x),!0)});u.events.filter&&(v=u.events.filter(v,u));for(const m of v){let x=m.object;for(;x;){var g;(g=x.__r3f)!=null&&g.eventCount&&d.push({...m,eventObject:x}),x=x.parent}}if("pointerId"in l&&u.internal.capturedMap.has(l.pointerId))for(let m of u.internal.capturedMap.get(l.pointerId).values())h.has(kM(m.intersection))||d.push(m.intersection);return d}function n(l,c,u,h){const d=e.getState();if(l.length){const p={stopped:!1};for(const f of l){const v=lx(f.object)||d,{raycaster:g,pointer:m,camera:x,internal:w}=v,_=new oe(m.x,m.y,0).unproject(x),M=C=>{var D,I;return(D=(I=w.capturedMap.get(C))==null?void 0:I.has(f.eventObject))!=null?D:!1},S=C=>{const D={intersection:f,target:c.target};w.capturedMap.has(C)?w.capturedMap.get(C).set(f.eventObject,D):w.capturedMap.set(C,new Map([[f.eventObject,D]])),c.target.setPointerCapture(C)},A=C=>{const D=w.capturedMap.get(C);D&&zte(w.capturedMap,f.eventObject,D,C)};let T={};for(let C in c){let D=c[C];typeof D!="function"&&(T[C]=D)}let E={...f,...T,pointer:m,intersections:l,stopped:p.stopped,delta:u,unprojectedPoint:_,ray:g.ray,camera:x,stopPropagation(){const C="pointerId"in c&&w.capturedMap.get(c.pointerId);if((!C||C.has(f.eventObject))&&(E.stopped=p.stopped=!0,w.hovered.size&&Array.from(w.hovered.values()).find(D=>D.eventObject===f.eventObject))){const D=l.slice(0,l.indexOf(f));s([...D,f])}},target:{hasPointerCapture:M,setPointerCapture:S,releasePointerCapture:A},currentTarget:{hasPointerCapture:M,setPointerCapture:S,releasePointerCapture:A},nativeEvent:c};if(h(E),p.stopped===!0)break}}return l}function s(l){const{internal:c}=e.getState();for(const u of c.hovered.values())if(!l.length||!l.find(h=>h.object===u.object&&h.index===u.index&&h.instanceId===u.instanceId)){const d=u.eventObject.__r3f,p=d==null?void 0:d.handlers;if(c.hovered.delete(kM(u)),d!=null&&d.eventCount){const f={...u,intersections:l};p.onPointerOut==null||p.onPointerOut(f),p.onPointerLeave==null||p.onPointerLeave(f)}}}function a(l,c){for(let u=0;u<c.length;u++){const h=c[u].__r3f;h==null||h.handlers.onPointerMissed==null||h.handlers.onPointerMissed(l)}}function o(l){switch(l){case"onPointerLeave":case"onPointerCancel":return()=>s([]);case"onLostPointerCapture":return c=>{const{internal:u}=e.getState();"pointerId"in c&&u.capturedMap.has(c.pointerId)&&requestAnimationFrame(()=>{u.capturedMap.has(c.pointerId)&&(u.capturedMap.delete(c.pointerId),s([]))})}}return function(u){const{onPointerMissed:h,internal:d}=e.getState();d.lastEvent.current=u;const p=l==="onPointerMove",f=l==="onClick"||l==="onContextMenu"||l==="onDoubleClick",g=r(u,p?i:void 0),m=f?t(u):0;l==="onPointerDown"&&(d.initialClick=[u.offsetX,u.offsetY],d.initialHits=g.map(w=>w.eventObject)),f&&!g.length&&m<=2&&(a(u,d.interaction),h&&h(u)),p&&s(g);function x(w){const _=w.eventObject,M=_.__r3f,S=M==null?void 0:M.handlers;if(M!=null&&M.eventCount)if(p){if(S.onPointerOver||S.onPointerEnter||S.onPointerOut||S.onPointerLeave){const A=kM(w),T=d.hovered.get(A);T?T.stopped&&w.stopPropagation():(d.hovered.set(A,w),S.onPointerOver==null||S.onPointerOver(w),S.onPointerEnter==null||S.onPointerEnter(w))}S.onPointerMove==null||S.onPointerMove(w)}else{const A=S[l];A?(!f||d.initialHits.includes(_))&&(a(u,d.interaction.filter(T=>!d.initialHits.includes(T))),A(w)):f&&d.initialHits.includes(_)&&a(u,d.interaction.filter(T=>!d.initialHits.includes(T)))}}n(g,u,m,x)}}return{handlePointer:o}}const Nte=e=>!!(e!=null&&e.render),Bte=qe.createContext(null),r4e=(e,t)=>{const i=FFe((o,l)=>{const c=new oe,u=new oe,h=new oe;function d(m=l().camera,x=u,w=l().size){const{width:_,height:M,top:S,left:A}=w,T=_/M;x instanceof oe?h.copy(x):h.set(...x);const E=m.getWorldPosition(c).distanceTo(h);if(Pte(m))return{width:_/m.zoom,height:M/m.zoom,top:S,left:A,factor:1,distance:E,aspect:T};{const C=m.fov*Math.PI/180,D=2*Math.tan(C/2)*E,I=D*(_/M);return{width:I,height:D,top:S,left:A,factor:_/I,distance:E,aspect:T}}}let p;const f=m=>o(x=>({performance:{...x.performance,current:m}})),v=new ot;return{set:o,get:l,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(m=1)=>e(l(),m),advance:(m,x)=>t(m,x,l()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new PU,pointer:v,mouse:v,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const m=l();p&&clearTimeout(p),m.performance.current!==m.performance.min&&f(m.performance.min),p=setTimeout(()=>f(l().performance.max),m.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:d},setEvents:m=>o(x=>({...x,events:{...x.events,...m}})),setSize:(m,x,w,_,M)=>{const S=l().camera,A={width:m,height:x,top:_||0,left:M||0,updateStyle:w};o(T=>({size:A,viewport:{...T.viewport,...d(S,u,A)}}))},setDpr:m=>o(x=>{const w=Lte(m);return{viewport:{...x.viewport,dpr:w,initialDpr:x.viewport.initialDpr||w}}}),setFrameloop:(m="always")=>{const x=l().clock;x.stop(),x.elapsedTime=0,m!=="never"&&(x.start(),x.elapsedTime=0),o(()=>({frameloop:m}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:qe.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(m,x,w)=>{const _=l().internal;return _.priority=_.priority+(x>0?1:0),_.subscribers.push({ref:m,priority:x,store:w}),_.subscribers=_.subscribers.sort((M,S)=>M.priority-S.priority),()=>{const M=l().internal;M!=null&&M.subscribers&&(M.priority=M.priority-(x>0?1:0),M.subscribers=M.subscribers.filter(S=>S.ref!==m))}}}}}),r=i.getState();let n=r.size,s=r.viewport.dpr,a=r.camera;return i.subscribe(()=>{const{camera:o,size:l,viewport:c,gl:u,set:h}=i.getState();if(l.width!==n.width||l.height!==n.height||c.dpr!==s){var d;n=l,s=c.dpr,JFe(o,l),u.setPixelRatio(c.dpr);const p=(d=l.updateStyle)!=null?d:typeof HTMLCanvasElement<"u"&&u.domElement instanceof HTMLCanvasElement;u.setSize(l.width,l.height,p)}o!==a&&(a=o,h(p=>({viewport:{...p.viewport,...p.viewport.getCurrentViewport(o)}})))}),i.subscribe(o=>e(o)),i};let UM,n4e=new Set,s4e=new Set,a4e=new Set;function yI(e,t){if(e.size)for(const{callback:i}of e.values())i(t)}function cx(e,t){switch(e){case"before":return yI(n4e,t);case"after":return yI(s4e,t);case"tail":return yI(a4e,t)}}let xI,wI;function bI(e,t,i){let r=t.clock.getDelta();for(t.frameloop==="never"&&typeof e=="number"&&(r=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),xI=t.internal.subscribers,UM=0;UM<xI.length;UM++)wI=xI[UM],wI.ref.current(wI.store.getState(),r,i);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}function o4e(e){let t=!1,i=!1,r,n,s;function a(c){n=requestAnimationFrame(a),t=!0,r=0,cx("before",c),i=!0;for(const h of e.values()){var u;s=h.store.getState(),s.internal.active&&(s.frameloop==="always"||s.internal.frames>0)&&!((u=s.gl.xr)!=null&&u.isPresenting)&&(r+=bI(c,s))}if(i=!1,cx("after",c),r===0)return cx("tail",c),t=!1,cancelAnimationFrame(n)}function o(c,u=1){var h;if(!c)return e.forEach(d=>o(d.store.getState(),u));(h=c.gl.xr)!=null&&h.isPresenting||!c.internal.active||c.frameloop==="never"||(u>1?c.internal.frames=Math.min(60,c.internal.frames+u):i?c.internal.frames=2:c.internal.frames=1,t||(t=!0,requestAnimationFrame(a)))}function l(c,u=!0,h,d){if(u&&cx("before",c),h)bI(c,h,d);else for(const p of e.values())bI(c,p.store.getState());u&&cx("after",c)}return{loop:a,invalidate:o,advance:l}}function kte(){const e=qe.useContext(Bte);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function nd(e=i=>i,t){return kte()(e,t)}function zU(e,t=0){const i=kte(),r=i.getState().internal.subscribe,n=Dte(e);return ob(()=>r(n,t,i),[t,r,i]),null}const u0=new Map,{invalidate:k9,advance:U9}=o4e(u0),{reconciler:KC,applyProps:Eg}=qFe(u0,e4e),Ag={objects:"shallow",strict:!1},l4e=(e,t)=>{const i=typeof e=="function"?e(t):e;return Nte(i)?i:new Pee({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function c4e(e,t){const i=typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement;if(t){const{width:r,height:n,top:s,left:a,updateStyle:o=i}=t;return{width:r,height:n,top:s,left:a,updateStyle:o}}else if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:r,height:n,top:s,left:a}=e.parentElement.getBoundingClientRect();return{width:r,height:n,top:s,left:a,updateStyle:i}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0,updateStyle:i};return{width:0,height:0,top:0,left:0}}function u4e(e){const t=u0.get(e),i=t==null?void 0:t.fiber,r=t==null?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const n=typeof reportError=="function"?reportError:console.error,s=r||r4e(k9,U9),a=i||KC.createContainer(s,pv.ConcurrentRoot,null,!1,null,"",n,null);t||u0.set(e,{fiber:a,store:s});let o,l=!1,c;return{configure(u={}){let{gl:h,size:d,scene:p,events:f,onCreated:v,shadows:g=!1,linear:m=!1,flat:x=!1,legacy:w=!1,orthographic:_=!1,frameloop:M="always",dpr:S=[1,2],performance:A,raycaster:T,camera:E,onPointerMissed:C}=u,D=s.getState(),I=D.gl;D.gl||D.set({gl:I=l4e(h,e)});let L=D.raycaster;L||D.set({raycaster:L=new _te});const{params:z,...F}=T||{};if(Er.equ(F,L,Ag)||Eg(L,{...F}),Er.equ(z,L.params,Ag)||Eg(L,{params:{...L.params,...z}}),!D.camera||D.camera===c&&!Er.equ(c,E,Ag)){c=E;const V=E instanceof Jw,W=V?E:_?new $u(0,0,0,0,.1,1e3):new Kr(75,0,.1,1e3);V||(W.position.z=5,E&&(Eg(W,E),("aspect"in E||"left"in E||"right"in E||"bottom"in E||"top"in E)&&(W.manual=!0,W.updateProjectionMatrix())),!D.camera&&!(E!=null&&E.rotation)&&W.lookAt(0,0,0)),D.set({camera:W}),L.camera=W}if(!D.scene){let V;p instanceof XC?V=p:(V=new XC,p&&Eg(V,p)),D.set({scene:Fg(V)})}if(!D.xr){var Q;const V=(ce,$)=>{const ne=s.getState();ne.frameloop!=="never"&&U9(ce,!0,ne,$)},W=()=>{const ce=s.getState();ce.gl.xr.enabled=ce.gl.xr.isPresenting,ce.gl.xr.setAnimationLoop(ce.gl.xr.isPresenting?V:null),ce.gl.xr.isPresenting||k9(ce)},J={connect(){const ce=s.getState().gl;ce.xr.addEventListener("sessionstart",W),ce.xr.addEventListener("sessionend",W)},disconnect(){const ce=s.getState().gl;ce.xr.removeEventListener("sessionstart",W),ce.xr.removeEventListener("sessionend",W)}};typeof((Q=I.xr)==null?void 0:Q.addEventListener)=="function"&&J.connect(),D.set({xr:J})}if(I.shadowMap){const V=I.shadowMap.enabled,W=I.shadowMap.type;if(I.shadowMap.enabled=!!g,Er.boo(g))I.shadowMap.type=t1;else if(Er.str(g)){var Y;const J={basic:xJ,percentage:YT,soft:t1,variance:El};I.shadowMap.type=(Y=J[g])!=null?Y:t1}else Er.obj(g)&&Object.assign(I.shadowMap,g);(V!==I.shadowMap.enabled||W!==I.shadowMap.type)&&(I.shadowMap.needsUpdate=!0)}const O=Tte();O&&("enabled"in O?O.enabled=!w:"legacyMode"in O&&(O.legacyMode=w)),l||Eg(I,{outputEncoding:m?3e3:3001,toneMapping:x?Hc:Xk}),D.legacy!==w&&D.set(()=>({legacy:w})),D.linear!==m&&D.set(()=>({linear:m})),D.flat!==x&&D.set(()=>({flat:x})),h&&!Er.fun(h)&&!Nte(h)&&!Er.equ(h,I,Ag)&&Eg(I,h),f&&!D.events.handlers&&D.set({events:f(s)});const j=c4e(e,d);return Er.equ(j,D.size,Ag)||D.setSize(j.width,j.height,j.updateStyle,j.top,j.left),S&&D.viewport.dpr!==Lte(S)&&D.setDpr(S),D.frameloop!==M&&D.setFrameloop(M),D.onPointerMissed||D.set({onPointerMissed:C}),A&&!Er.equ(A,D.performance,Ag)&&D.set(V=>({performance:{...V.performance,...A}})),o=v,l=!0,this},render(u){return l||this.configure(),KC.updateContainer(rt.jsx(h4e,{store:s,children:u,onCreated:o,rootElement:e}),a,null,()=>{}),s},unmount(){Ute(e)}}}function h4e({store:e,children:t,onCreated:i,rootElement:r}){return ob(()=>{const n=e.getState();n.set(s=>({internal:{...s.internal,active:!0}})),i&&i(n),e.getState().events.connected||n.events.connect==null||n.events.connect(r)},[]),rt.jsx(Bte.Provider,{value:e,children:t})}function Ute(e,t){const i=u0.get(e),r=i==null?void 0:i.fiber;if(r){const n=i==null?void 0:i.store.getState();n&&(n.internal.active=!1),KC.updateContainer(null,r,null,()=>{n&&setTimeout(()=>{try{var s,a,o,l;n.events.disconnect==null||n.events.disconnect(),(s=n.gl)==null||(a=s.renderLists)==null||a.dispose==null||a.dispose(),(o=n.gl)==null||o.forceContextLoss==null||o.forceContextLoss(),(l=n.gl)!=null&&l.xr&&n.xr.disconnect(),ZFe(n),u0.delete(e)}catch{}},500)})}}KC.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:qe.version});const _I={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function d4e(e){const{handlePointer:t}=i4e(e);return{priority:1,enabled:!0,compute(i,r,n){r.pointer.set(i.offsetX/r.size.width*2-1,-(i.offsetY/r.size.height)*2+1),r.raycaster.setFromCamera(r.pointer,r.camera)},connected:void 0,handlers:Object.keys(_I).reduce((i,r)=>({...i,[r]:t(r)}),{}),update:()=>{var i;const{events:r,internal:n}=e.getState();(i=n.lastEvent)!=null&&i.current&&r.handlers&&r.handlers.onPointerMove(n.lastEvent.current)},connect:i=>{var r;const{set:n,events:s}=e.getState();s.disconnect==null||s.disconnect(),n(a=>({events:{...a.events,connected:i}})),Object.entries((r=s.handlers)!=null?r:[]).forEach(([a,o])=>{const[l,c]=_I[a];i.addEventListener(l,o,{passive:c})})},disconnect:()=>{const{set:i,events:r}=e.getState();if(r.connected){var n;Object.entries((n=r.handlers)!=null?n:[]).forEach(([s,a])=>{if(r&&r.connected instanceof HTMLElement){const[o]=_I[s];r.connected.removeEventListener(o,a)}}),i(s=>({events:{...s.events,connected:void 0}}))}}}}function Kz(e,t,i){var r,n,s,a,o;t==null&&(t=100);function l(){var u=Date.now()-a;u<t&&u>=0?r=setTimeout(l,t-u):(r=null,i||(o=e.apply(s,n),s=n=null))}var c=function(){s=this,n=arguments,a=Date.now();var u=i&&!r;return r||(r=setTimeout(l,t)),u&&(o=e.apply(s,n),s=n=null),o};return c.clear=function(){r&&(clearTimeout(r),r=null)},c.flush=function(){r&&(o=e.apply(s,n),s=n=null,clearTimeout(r),r=null)},c}Kz.debounce=Kz;var p4e=Kz;const F9=v0(p4e);var f4e=Object.defineProperty,m4e=Object.defineProperties,g4e=Object.getOwnPropertyDescriptors,V9=Object.getOwnPropertySymbols,v4e=Object.prototype.hasOwnProperty,y4e=Object.prototype.propertyIsEnumerable,H9=(e,t,i)=>t in e?f4e(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,G9=(e,t)=>{for(var i in t||(t={}))v4e.call(t,i)&&H9(e,i,t[i]);if(V9)for(var i of V9(t))y4e.call(t,i)&&H9(e,i,t[i]);return e},x4e=(e,t)=>m4e(e,g4e(t)),j9,W9;typeof window<"u"&&((j9=window.document)!=null&&j9.createElement||((W9=window.navigator)==null?void 0:W9.product)==="ReactNative")?qe.useLayoutEffect:qe.useEffect;function Fte(e,t,i){if(!e)return;if(i(e)===!0)return e;let r=e.child;for(;r;){const n=Fte(r,t,i);if(n)return n;r=r.sibling}}function Vte(e){try{return Object.defineProperties(e,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return e}}const X9=console.error;console.error=function(){const e=[...arguments].join("");if(e!=null&&e.startsWith("Warning:")&&e.includes("useContext")){console.error=X9;return}return X9.apply(this,arguments)};const NU=Vte(qe.createContext(null));class Hte extends qe.Component{render(){return qe.createElement(NU.Provider,{value:this._reactInternals},this.props.children)}}function w4e(){const e=qe.useContext(NU);if(e===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const t=qe.useId();return qe.useMemo(()=>{for(const r of[e,e==null?void 0:e.alternate]){if(!r)continue;const n=Fte(r,!1,s=>{let a=s.memoizedState;for(;a;){if(a.memoizedState===t)return!0;a=a.next}});if(n)return n}},[e,t])}function b4e(){const e=w4e(),[t]=qe.useState(()=>new Map);t.clear();let i=e;for(;i;){if(i.type&&typeof i.type=="object"){const n=i.type._context===void 0&&i.type.Provider===i.type?i.type:i.type._context;n&&n!==NU&&!t.has(n)&&t.set(n,qe.useContext(Vte(n)))}i=i.return}return t}function _4e(){const e=b4e();return qe.useMemo(()=>Array.from(e.keys()).reduce((t,i)=>r=>qe.createElement(t,null,qe.createElement(i.Provider,x4e(G9({},r),{value:e.get(i)}))),t=>qe.createElement(Hte,G9({},t))),[e])}function S4e({debounce:e,scroll:t,polyfill:i,offsetSize:r}={debounce:0,scroll:!1,offsetSize:!1}){const n=i||typeof window<"u"&&window.ResizeObserver,[s,a]=qe.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0});if(!n)return s.width=1280,s.height=800,[()=>{},s,()=>{}];const o=qe.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:s}),l=e?typeof e=="number"?e:e.scroll:null,c=e?typeof e=="number"?e:e.resize:null,u=qe.useRef(!1);qe.useEffect(()=>(u.current=!0,()=>void(u.current=!1)));const[h,d,p]=qe.useMemo(()=>{const m=()=>{if(!o.current.element)return;const{left:x,top:w,width:_,height:M,bottom:S,right:A,x:T,y:E}=o.current.element.getBoundingClientRect(),C={left:x,top:w,width:_,height:M,bottom:S,right:A,x:T,y:E};o.current.element instanceof HTMLElement&&r&&(C.height=o.current.element.offsetHeight,C.width=o.current.element.offsetWidth),Object.freeze(C),u.current&&!C4e(o.current.lastBounds,C)&&a(o.current.lastBounds=C)};return[m,c?F9(m,c):m,l?F9(m,l):m]},[a,r,l,c]);function f(){o.current.scrollContainers&&(o.current.scrollContainers.forEach(m=>m.removeEventListener("scroll",p,!0)),o.current.scrollContainers=null),o.current.resizeObserver&&(o.current.resizeObserver.disconnect(),o.current.resizeObserver=null)}function v(){o.current.element&&(o.current.resizeObserver=new n(p),o.current.resizeObserver.observe(o.current.element),t&&o.current.scrollContainers&&o.current.scrollContainers.forEach(m=>m.addEventListener("scroll",p,{capture:!0,passive:!0})))}const g=m=>{!m||m===o.current.element||(f(),o.current.element=m,o.current.scrollContainers=Gte(m),v())};return E4e(p,!!t),M4e(d),qe.useEffect(()=>{f(),v()},[t,p,d]),qe.useEffect(()=>f,[]),[g,s,h]}function M4e(e){qe.useEffect(()=>{const t=e;return window.addEventListener("resize",t),()=>void window.removeEventListener("resize",t)},[e])}function E4e(e,t){qe.useEffect(()=>{if(t){const i=e;return window.addEventListener("scroll",i,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",i,!0)}},[e,t])}function Gte(e){const t=[];if(!e||e===document.body)return t;const{overflow:i,overflowX:r,overflowY:n}=window.getComputedStyle(e);return[i,r,n].some(s=>s==="auto"||s==="scroll")&&t.push(e),[...t,...Gte(e.parentElement)]}const A4e=["x","y","top","bottom","left","right","width","height"],C4e=(e,t)=>A4e.every(i=>e[i]===t[i]),T4e=qe.forwardRef(function({children:t,fallback:i,resize:r,style:n,gl:s,events:a=d4e,eventSource:o,eventPrefix:l,shadows:c,linear:u,flat:h,legacy:d,orthographic:p,frameloop:f,dpr:v,performance:g,raycaster:m,camera:x,scene:w,onPointerMissed:_,onCreated:M,...S},A){qe.useMemo(()=>XFe(BFe),[]);const T=_4e(),[E,C]=S4e({scroll:!0,debounce:{scroll:50,resize:0},...r}),D=qe.useRef(null),I=qe.useRef(null);qe.useImperativeHandle(A,()=>D.current);const L=Dte(_),[z,F]=qe.useState(!1),[Q,Y]=qe.useState(!1);if(z)throw z;if(Q)throw Q;const O=qe.useRef(null);ob(()=>{const V=D.current;C.width>0&&C.height>0&&V&&(O.current||(O.current=u4e(V)),O.current.configure({gl:s,events:a,shadows:c,linear:u,flat:h,legacy:d,orthographic:p,frameloop:f,dpr:v,performance:g,raycaster:m,camera:x,scene:w,size:C,onPointerMissed:(...W)=>L.current==null?void 0:L.current(...W),onCreated:W=>{W.events.connect==null||W.events.connect(o?YFe(o)?o.current:o:I.current),l&&W.setEvents({compute:(J,ce)=>{const $=J[l+"X"],ne=J[l+"Y"];ce.pointer.set($/ce.size.width*2-1,-(ne/ce.size.height)*2+1),ce.raycaster.setFromCamera(ce.pointer,ce.camera)}}),M==null||M(W)}}),O.current.render(rt.jsx(T,{children:rt.jsx(Rte,{set:Y,children:rt.jsx(qe.Suspense,{fallback:rt.jsx(QFe,{set:F}),children:t})})})))}),qe.useEffect(()=>{const V=D.current;if(V)return()=>Ute(V)},[]);const j=o?"none":"auto";return rt.jsx("div",{ref:I,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:j,...n},...S,children:rt.jsx("div",{ref:E,style:{width:"100%",height:"100%"},children:rt.jsx("canvas",{ref:D,style:{display:"block"},children:i})})})}),jte=qe.forwardRef(function(t,i){return rt.jsx(Hte,{children:rt.jsx(T4e,{...t,ref:i})})});function P4e(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var BU=P4e,D4e=typeof yd=="object"&&yd&&yd.Object===Object&&yd,R4e=D4e,I4e=R4e,L4e=typeof self=="object"&&self&&self.Object===Object&&self,O4e=I4e||L4e||Function("return this")(),Wte=O4e,z4e=Wte,N4e=function(){return z4e.Date.now()},B4e=N4e,k4e=/\s/;function U4e(e){for(var t=e.length;t--&&k4e.test(e.charAt(t)););return t}var F4e=U4e,V4e=F4e,H4e=/^\s+/;function G4e(e){return e&&e.slice(0,V4e(e)+1).replace(H4e,"")}var j4e=G4e,W4e=Wte,X4e=W4e.Symbol,Xte=X4e,q9=Xte,qte=Object.prototype,q4e=qte.hasOwnProperty,Y4e=qte.toString,ux=q9?q9.toStringTag:void 0;function Q4e(e){var t=q4e.call(e,ux),i=e[ux];try{e[ux]=void 0;var r=!0}catch{}var n=Y4e.call(e);return r&&(t?e[ux]=i:delete e[ux]),n}var K4e=Q4e,Z4e=Object.prototype,$4e=Z4e.toString;function J4e(e){return $4e.call(e)}var e5e=J4e,Y9=Xte,t5e=K4e,i5e=e5e,r5e="[object Null]",n5e="[object Undefined]",Q9=Y9?Y9.toStringTag:void 0;function s5e(e){return e==null?e===void 0?n5e:r5e:Q9&&Q9 in Object(e)?t5e(e):i5e(e)}var a5e=s5e;function o5e(e){return e!=null&&typeof e=="object"}var l5e=o5e,c5e=a5e,u5e=l5e,h5e="[object Symbol]";function d5e(e){return typeof e=="symbol"||u5e(e)&&c5e(e)==h5e}var p5e=d5e,f5e=j4e,K9=BU,m5e=p5e,Z9=NaN,g5e=/^[-+]0x[0-9a-f]+$/i,v5e=/^0b[01]+$/i,y5e=/^0o[0-7]+$/i,x5e=parseInt;function w5e(e){if(typeof e=="number")return e;if(m5e(e))return Z9;if(K9(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=K9(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=f5e(e);var i=v5e.test(e);return i||y5e.test(e)?x5e(e.slice(2),i?2:8):g5e.test(e)?Z9:+e}var b5e=w5e,_5e=BU,SI=B4e,$9=b5e,S5e="Expected a function",M5e=Math.max,E5e=Math.min;function A5e(e,t,i){var r,n,s,a,o,l,c=0,u=!1,h=!1,d=!0;if(typeof e!="function")throw new TypeError(S5e);t=$9(t)||0,_5e(i)&&(u=!!i.leading,h="maxWait"in i,s=h?M5e($9(i.maxWait)||0,t):s,d="trailing"in i?!!i.trailing:d);function p(S){var A=r,T=n;return r=n=void 0,c=S,a=e.apply(T,A),a}function f(S){return c=S,o=setTimeout(m,t),u?p(S):a}function v(S){var A=S-l,T=S-c,E=t-A;return h?E5e(E,s-T):E}function g(S){var A=S-l,T=S-c;return l===void 0||A>=t||A<0||h&&T>=s}function m(){var S=SI();if(g(S))return x(S);o=setTimeout(m,v(S))}function x(S){return o=void 0,d&&r?p(S):(r=n=void 0,a)}function w(){o!==void 0&&clearTimeout(o),c=0,r=l=n=o=void 0}function _(){return o===void 0?a:x(SI())}function M(){var S=SI(),A=g(S);if(r=arguments,n=this,l=S,A){if(o===void 0)return f(l);if(h)return clearTimeout(o),o=setTimeout(m,t),p(l)}return o===void 0&&(o=setTimeout(m,t)),a}return M.cancel=w,M.flush=_,M}var Yte=A5e;const C5e=v0(Yte);var T5e=Yte,P5e=BU,D5e="Expected a function";function R5e(e,t,i){var r=!0,n=!0;if(typeof e!="function")throw new TypeError(D5e);return P5e(i)&&(r="leading"in i?!!i.leading:r,n="trailing"in i?!!i.trailing:n),T5e(e,t,{leading:r,maxWait:t,trailing:n})}var I5e=R5e;const L5e=v0(I5e),O5e=(e,t,i,r)=>{switch(t){case"debounce":return C5e(e,i,r);case"throttle":return L5e(e,i,r);default:return e}},z5e=e=>{const t=qe.useRef(e);return qe.useEffect(()=>{t.current=e}),qe.useMemo(()=>(...i)=>{var r;return(r=t.current)===null||r===void 0?void 0:r.call(t,...i)},[])},N5e=e=>{const[t,i]=qe.useState((e==null?void 0:e.current)||null);return e&&setTimeout(()=>{e.current!==t&&i(e.current)},0),{refProxy:qe.useMemo(()=>new Proxy(n=>{n!==t&&i(n)},{get(n,s){return s==="current"?t:n[s]},set(n,s,a){return s==="current"?i(a):n[s]=a,!0}}),[t]),refElement:t,setRefElement:i}},B5e=(e,t)=>t==="border-box"?{width:e.borderBoxSize[0].inlineSize,height:e.borderBoxSize[0].blockSize}:t==="content-box"?{width:e.contentBoxSize[0].inlineSize,height:e.contentBoxSize[0].blockSize}:{width:e.contentRect.width,height:e.contentRect.height};function k5e({skipOnMount:e=!1,refreshMode:t,refreshRate:i=1e3,refreshOptions:r,handleWidth:n=!0,handleHeight:s=!0,targetRef:a,observerOptions:o,onResize:l}={}){const c=qe.useRef(e),u=z5e(l),[h,d]=qe.useState({width:void 0,height:void 0}),{refProxy:p,refElement:f}=N5e(a),{box:v}=o||{},g=qe.useCallback(x=>{if(!n&&!s)return;if(c.current){c.current=!1;return}const w=(_,M)=>n&&_.width!==M.width||s&&_.height!==M.height;x.forEach(_=>{const M=B5e(_,v);d(S=>w(S,M)?(u==null||u({width:M.width,height:M.height,entry:_}),M):S)})},[n,s,c,v]),m=qe.useCallback(O5e(g,t,i,r),[g,t,i,r]);return qe.useEffect(()=>{let x;return f?(x=new window.ResizeObserver(m),x.observe(f,o)):(h.width||h.height)&&(u==null||u({width:null,height:null,entry:null}),d({width:void 0,height:void 0})),()=>{var w,_,M;(w=x==null?void 0:x.disconnect)===null||w===void 0||w.call(x),(M=(_=m).cancel)===null||M===void 0||M.call(_)}},[m,f]),Object.assign({ref:p},h)}const U5e=`
uniform float u_intensity;
uniform float u_time;
uniform int u_shader_type;

varying vec2 vUv;
varying float vDisplacement;

varying vec3 vPosition;
varying vec3 vNormal;

#define PI 3.1415926535897932384626433832795



vec4 permute(vec4 x) {
    return mod(((x*34.0)+1.0)*x, 289.0);
}

vec4 taylorInvSqrt(vec4 r) {
    return 1.79284291400159 - 0.85373472095314 * r;
}

vec3 fade(vec3 t) {
    return t*t*t*(t*(t*6.0-15.0)+10.0);
}

float cnoise(vec3 P) {
    vec3 Pi0 = floor(P); // Integer part for indexing
    vec3 Pi1 = Pi0 + vec3(1.0); // Integer part + 1
    Pi0 = mod(Pi0, 289.0);
    Pi1 = mod(Pi1, 289.0);
    vec3 Pf0 = fract(P); // Fractional part for interpolation
    vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0
    vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);
    vec4 iy = vec4(Pi0.yy, Pi1.yy);
    vec4 iz0 = Pi0.zzzz;
    vec4 iz1 = Pi1.zzzz;

    vec4 ixy = permute(permute(ix) + iy);
    vec4 ixy0 = permute(ixy + iz0);
    vec4 ixy1 = permute(ixy + iz1);

    vec4 gx0 = ixy0 / 7.0;
    vec4 gy0 = fract(floor(gx0) / 7.0) - 0.5;
    gx0 = fract(gx0);
    vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);
    vec4 sz0 = step(gz0, vec4(0.0));
    gx0 -= sz0 * (step(0.0, gx0) - 0.5);
    gy0 -= sz0 * (step(0.0, gy0) - 0.5);

    vec4 gx1 = ixy1 / 7.0;
    vec4 gy1 = fract(floor(gx1) / 7.0) - 0.5;
    gx1 = fract(gx1);
    vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);
    vec4 sz1 = step(gz1, vec4(0.0));
    gx1 -= sz1 * (step(0.0, gx1) - 0.5);
    gy1 -= sz1 * (step(0.0, gy1) - 0.5);

    vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);
    vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);
    vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);
    vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);
    vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);
    vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);
    vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);
    vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);

    vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));
    g000 *= norm0.x;
    g010 *= norm0.y;
    g100 *= norm0.z;
    g110 *= norm0.w;
    vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));
    g001 *= norm1.x;
    g011 *= norm1.y;
    g101 *= norm1.z;
    g111 *= norm1.w;

    float n000 = dot(g000, Pf0);
    float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));
    float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));
    float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));
    float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));
    float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));
    float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));
    float n111 = dot(g111, Pf1);

    vec3 fade_xyz = fade(Pf0);
    vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);
    vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);
    float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); 
    return 2.2 * n_xyz;
}







//	Classic Perlin 3D Noise 


float noise(vec3 P){
  vec3 Pi0 = floor(P); // Integer part for indexing
  vec3 Pi1 = Pi0 + vec3(1.0); // Integer part + 1
  Pi0 = mod(Pi0, 289.0);
  Pi1 = mod(Pi1, 289.0);
  vec3 Pf0 = fract(P); // Fractional part for interpolation
  vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0
  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);
  vec4 iy = vec4(Pi0.yy, Pi1.yy);
  vec4 iz0 = Pi0.zzzz;
  vec4 iz1 = Pi1.zzzz;

  vec4 ixy = permute(permute(ix) + iy);
  vec4 ixy0 = permute(ixy + iz0);
  vec4 ixy1 = permute(ixy + iz1);

  vec4 gx0 = ixy0 / 7.0;
  vec4 gy0 = fract(floor(gx0) / 7.0) - 0.5;
  gx0 = fract(gx0);
  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);
  vec4 sz0 = step(gz0, vec4(0.0));
  gx0 -= sz0 * (step(0.0, gx0) - 0.5);
  gy0 -= sz0 * (step(0.0, gy0) - 0.5);

  vec4 gx1 = ixy1 / 7.0;
  vec4 gy1 = fract(floor(gx1) / 7.0) - 0.5;
  gx1 = fract(gx1);
  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);
  vec4 sz1 = step(gz1, vec4(0.0));
  gx1 -= sz1 * (step(0.0, gx1) - 0.5);
  gy1 -= sz1 * (step(0.0, gy1) - 0.5);

  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);
  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);
  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);
  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);
  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);
  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);
  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);
  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);

  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));
  g000 *= norm0.x;
  g010 *= norm0.y;
  g100 *= norm0.z;
  g110 *= norm0.w;
  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));
  g001 *= norm1.x;
  g011 *= norm1.y;
  g101 *= norm1.z;
  g111 *= norm1.w;

  float n000 = dot(g000, Pf0);
  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));
  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));
  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));
  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));
  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));
  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));
  float n111 = dot(g111, Pf1);

  vec3 fade_xyz = fade(Pf0);
  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);
  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);
  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); 
  return 2.2 * n_xyz;
}


/* 
* SMOOTH MOD
* - authored by @charstiles -
* based on https://math.stackexchange.com/questions/2491494/does-there-exist-a-smooth-approximation-of-x-bmod-y
* (axis) input axis to modify
* (amp) amplitude of each edge/tip
* (rad) radius of each edge/tip
* returns => smooth edges
*/


float smoothMod(float axis, float amp, float rad){
    float top = cos(PI * (axis / amp)) * sin(PI * (axis / amp));
    float bottom = pow(sin(PI * (axis / amp)), 2.0) + pow(rad, 2.0);
    float at = atan(top / bottom);
    return amp * (1.0 / 2.0) - (1.0 / PI) * at;
}

float fit(float unscaled, float originalMin, float originalMax, float minAllowed, float maxAllowed) {
  return (maxAllowed - minAllowed) * (unscaled - originalMin) / (originalMax - originalMin) + minAllowed;
}

float wave(vec3 position) {
  return fit(smoothMod(position.y * 6.0, 1.0, 1.5), 0.35, 0.6, 0.0, 1.0);
}




float snoise(vec3 v){ 
  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;
  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);

// First corner
  vec3 i  = floor(v + dot(v, C.yyy) );
  vec3 x0 =   v - i + dot(i, C.xxx) ;

// Other corners
  vec3 g = step(x0.yzx, x0.xyz);
  vec3 l = 1.0 - g;
  vec3 i1 = min( g.xyz, l.zxy );
  vec3 i2 = max( g.xyz, l.zxy );

  //  x0 = x0 - 0. + 0.0 * C 
  vec3 x1 = x0 - i1 + 1.0 * C.xxx;
  vec3 x2 = x0 - i2 + 2.0 * C.xxx;
  vec3 x3 = x0 - 1. + 3.0 * C.xxx;

// Permutations
  i = mod(i, 289.0 ); 
  vec4 p = permute( permute( permute( 
             i.z + vec4(0.0, i1.z, i2.z, 1.0 ))
           + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) 
           + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));

// Gradients
// ( N*N points uniformly over a square, mapped onto an octahedron.)
  float n_ = 1.0/7.0; // N=7
  vec3  ns = n_ * D.wyz - D.xzx;

  vec4 j = p - 49.0 * floor(p * ns.z *ns.z);  //  mod(p,N*N)

  vec4 x_ = floor(j * ns.z);
  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)

  vec4 x = x_ *ns.x + ns.yyyy;
  vec4 y = y_ *ns.x + ns.yyyy;
  vec4 h = 1.0 - abs(x) - abs(y);

  vec4 b0 = vec4( x.xy, y.xy );
  vec4 b1 = vec4( x.zw, y.zw );

  vec4 s0 = floor(b0)*2.0 + 1.0;
  vec4 s1 = floor(b1)*2.0 + 1.0;
  vec4 sh = -step(h, vec4(0.0));

  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;
  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;

  vec3 p0 = vec3(a0.xy,h.x);
  vec3 p1 = vec3(a0.zw,h.y);
  vec3 p2 = vec3(a1.xy,h.z);
  vec3 p3 = vec3(a1.zw,h.w);

//Normalise gradients
  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));
  p0 *= norm.x;
  p1 *= norm.y;
  p2 *= norm.z;
  p3 *= norm.w;

// Mix final noise value
  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
  m = m * m;
  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), 
                                dot(p2,x2), dot(p3,x3) ) );
}

// End of Perlin Noise Code

void main() {
  vUv = uv;
  vPosition = position;
  vNormal = normal;

  if (u_shader_type == 1){
    vDisplacement = snoise(position + vec3(2.0 * u_time));
  } else if (u_shader_type == 2) {
    vec3 noisePattern = vec3(noise(vNormal + vec3(0,(u_time), 0)));
    float pattern = wave(noisePattern);
    vDisplacement = pattern;
  } else if (u_shader_type == 3) {
    vDisplacement = cnoise(position + vec3(2.0 * u_time));
   }


  vec3 newPosition = position + normal * (u_intensity * vDisplacement);

  vec4 modelPosition = modelMatrix * vec4(newPosition, 1.0);
  vec4 viewPosition = viewMatrix * modelPosition;
  vec4 projectedPosition = projectionMatrix * viewPosition;

  gl_Position = projectedPosition;
}




//start 
`,F5e=`
uniform float u_intensity;
uniform float u_time;
uniform int u_texture_type;

varying vec2 vUv;
varying float vDisplacement;

void main() {
    float distort = 2.0 * vDisplacement * u_intensity * sin(vUv.y * 10.0 + u_time);
// this defines our gradient
    vec3 color;
    if (u_texture_type == 1){
        color = vec3(abs( vec2(0.95, 0.65) - 0.5) * 2.0  * (1.0 - distort), 0.35); //last coefficent 1.0 to default color
    } else if (u_texture_type == 2) {
        color = vec3(abs( vUv - 0.5) * 2.0  * (1.0 - distort), 0.27); //last coefficent 1.0 to default color
    } else {
        color = vec3(abs( vUv - 0.5) * 2.0  * (1.0 - distort), 1.0); //last coefficent 1.0 to default color
    }
    gl_FragColor = vec4(color, 1.0);
}

`;function ZC(){return ZC=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)({}).hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},ZC.apply(null,arguments)}var V5e=Object.defineProperty,H5e=(e,t,i)=>t in e?V5e(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,si=(e,t,i)=>(H5e(e,typeof t!="symbol"?t+"":t,i),i);const FM=new om,J9=new ku,G5e=Math.cos(70*(Math.PI/180)),e7=(e,t)=>(e%t+t)%t;let j5e=class extends $c{constructor(t,i){super(),si(this,"object"),si(this,"domElement"),si(this,"enabled",!0),si(this,"target",new oe),si(this,"minDistance",0),si(this,"maxDistance",1/0),si(this,"minZoom",0),si(this,"maxZoom",1/0),si(this,"minPolarAngle",0),si(this,"maxPolarAngle",Math.PI),si(this,"minAzimuthAngle",-1/0),si(this,"maxAzimuthAngle",1/0),si(this,"enableDamping",!1),si(this,"dampingFactor",.05),si(this,"enableZoom",!0),si(this,"zoomSpeed",1),si(this,"enableRotate",!0),si(this,"rotateSpeed",1),si(this,"enablePan",!0),si(this,"panSpeed",1),si(this,"screenSpacePanning",!0),si(this,"keyPanSpeed",7),si(this,"zoomToCursor",!1),si(this,"autoRotate",!1),si(this,"autoRotateSpeed",2),si(this,"reverseOrbit",!1),si(this,"reverseHorizontalOrbit",!1),si(this,"reverseVerticalOrbit",!1),si(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),si(this,"mouseButtons",{LEFT:Wp.ROTATE,MIDDLE:Wp.DOLLY,RIGHT:Wp.PAN}),si(this,"touches",{ONE:Xp.ROTATE,TWO:Xp.DOLLY_PAN}),si(this,"target0"),si(this,"position0"),si(this,"zoom0"),si(this,"_domElementKeyEvents",null),si(this,"getPolarAngle"),si(this,"getAzimuthalAngle"),si(this,"setPolarAngle"),si(this,"setAzimuthalAngle"),si(this,"getDistance"),si(this,"listenToKeyEvents"),si(this,"stopListenToKeyEvents"),si(this,"saveState"),si(this,"reset"),si(this,"update"),si(this,"connect"),si(this,"dispose"),this.object=t,this.domElement=i,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>u.phi,this.getAzimuthalAngle=()=>u.theta,this.setPolarAngle=ue=>{let Ue=e7(ue,2*Math.PI),dt=u.phi;dt<0&&(dt+=2*Math.PI),Ue<0&&(Ue+=2*Math.PI);let xe=Math.abs(Ue-dt);2*Math.PI-xe<xe&&(Ue<dt?Ue+=2*Math.PI:dt+=2*Math.PI),h.phi=Ue-dt,r.update()},this.setAzimuthalAngle=ue=>{let Ue=e7(ue,2*Math.PI),dt=u.theta;dt<0&&(dt+=2*Math.PI),Ue<0&&(Ue+=2*Math.PI);let xe=Math.abs(Ue-dt);2*Math.PI-xe<xe&&(Ue<dt?Ue+=2*Math.PI:dt+=2*Math.PI),h.theta=Ue-dt,r.update()},this.getDistance=()=>r.object.position.distanceTo(r.target),this.listenToKeyEvents=ue=>{ue.addEventListener("keydown",Te),this._domElementKeyEvents=ue},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",Te),this._domElementKeyEvents=null},this.saveState=()=>{r.target0.copy(r.target),r.position0.copy(r.object.position),r.zoom0=r.object.zoom},this.reset=()=>{r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.zoom=r.zoom0,r.object.updateProjectionMatrix(),r.dispatchEvent(n),r.update(),l=o.NONE},this.update=(()=>{const ue=new oe,Ue=new oe(0,1,0),dt=new Ks().setFromUnitVectors(t.up,Ue),xe=dt.clone().invert(),ae=new oe,fe=new Ks,Se=2*Math.PI;return function(){const st=r.object.position;dt.setFromUnitVectors(t.up,Ue),xe.copy(dt).invert(),ue.copy(st).sub(r.target),ue.applyQuaternion(dt),u.setFromVector3(ue),r.autoRotate&&l===o.NONE&&z(I()),r.enableDamping?(u.theta+=h.theta*r.dampingFactor,u.phi+=h.phi*r.dampingFactor):(u.theta+=h.theta,u.phi+=h.phi);let vt=r.minAzimuthAngle,Ut=r.maxAzimuthAngle;isFinite(vt)&&isFinite(Ut)&&(vt<-Math.PI?vt+=Se:vt>Math.PI&&(vt-=Se),Ut<-Math.PI?Ut+=Se:Ut>Math.PI&&(Ut-=Se),vt<=Ut?u.theta=Math.max(vt,Math.min(Ut,u.theta)):u.theta=u.theta>(vt+Ut)/2?Math.max(vt,u.theta):Math.min(Ut,u.theta)),u.phi=Math.max(r.minPolarAngle,Math.min(r.maxPolarAngle,u.phi)),u.makeSafe(),r.enableDamping===!0?r.target.addScaledVector(p,r.dampingFactor):r.target.add(p),r.zoomToCursor&&E||r.object.isOrthographicCamera?u.radius=J(u.radius):u.radius=J(u.radius*d),ue.setFromSpherical(u),ue.applyQuaternion(xe),st.copy(r.target).add(ue),r.object.matrixAutoUpdate||r.object.updateMatrix(),r.object.lookAt(r.target),r.enableDamping===!0?(h.theta*=1-r.dampingFactor,h.phi*=1-r.dampingFactor,p.multiplyScalar(1-r.dampingFactor)):(h.set(0,0,0),p.set(0,0,0));let Wt=!1;if(r.zoomToCursor&&E){let Jt=null;if(r.object instanceof Kr&&r.object.isPerspectiveCamera){const ci=ue.length();Jt=J(ci*d);const Ki=ci-Jt;r.object.position.addScaledVector(A,Ki),r.object.updateMatrixWorld()}else if(r.object.isOrthographicCamera){const ci=new oe(T.x,T.y,0);ci.unproject(r.object),r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/d)),r.object.updateProjectionMatrix(),Wt=!0;const Ki=new oe(T.x,T.y,0);Ki.unproject(r.object),r.object.position.sub(Ki).add(ci),r.object.updateMatrixWorld(),Jt=ue.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),r.zoomToCursor=!1;Jt!==null&&(r.screenSpacePanning?r.target.set(0,0,-1).transformDirection(r.object.matrix).multiplyScalar(Jt).add(r.object.position):(FM.origin.copy(r.object.position),FM.direction.set(0,0,-1).transformDirection(r.object.matrix),Math.abs(r.object.up.dot(FM.direction))<G5e?t.lookAt(r.target):(J9.setFromNormalAndCoplanarPoint(r.object.up,r.target),FM.intersectPlane(J9,r.target))))}else r.object instanceof $u&&r.object.isOrthographicCamera&&(Wt=d!==1,Wt&&(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/d)),r.object.updateProjectionMatrix()));return d=1,E=!1,Wt||ae.distanceToSquared(r.object.position)>c||8*(1-fe.dot(r.object.quaternion))>c?(r.dispatchEvent(n),ae.copy(r.object.position),fe.copy(r.object.quaternion),Wt=!1,!0):!1}})(),this.connect=ue=>{r.domElement=ue,r.domElement.style.touchAction="none",r.domElement.addEventListener("contextmenu",ye),r.domElement.addEventListener("pointerdown",Z),r.domElement.addEventListener("pointercancel",k),r.domElement.addEventListener("wheel",G)},this.dispose=()=>{var ue,Ue,dt,xe,ae,fe;r.domElement&&(r.domElement.style.touchAction="auto"),(ue=r.domElement)==null||ue.removeEventListener("contextmenu",ye),(Ue=r.domElement)==null||Ue.removeEventListener("pointerdown",Z),(dt=r.domElement)==null||dt.removeEventListener("pointercancel",k),(xe=r.domElement)==null||xe.removeEventListener("wheel",G),(ae=r.domElement)==null||ae.ownerDocument.removeEventListener("pointermove",K),(fe=r.domElement)==null||fe.ownerDocument.removeEventListener("pointerup",k),r._domElementKeyEvents!==null&&r._domElementKeyEvents.removeEventListener("keydown",Te)};const r=this,n={type:"change"},s={type:"start"},a={type:"end"},o={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let l=o.NONE;const c=1e-6,u=new qz,h=new qz;let d=1;const p=new oe,f=new ot,v=new ot,g=new ot,m=new ot,x=new ot,w=new ot,_=new ot,M=new ot,S=new ot,A=new oe,T=new ot;let E=!1;const C=[],D={};function I(){return 2*Math.PI/60/60*r.autoRotateSpeed}function L(){return Math.pow(.95,r.zoomSpeed)}function z(ue){r.reverseOrbit||r.reverseHorizontalOrbit?h.theta+=ue:h.theta-=ue}function F(ue){r.reverseOrbit||r.reverseVerticalOrbit?h.phi+=ue:h.phi-=ue}const Q=(()=>{const ue=new oe;return function(dt,xe){ue.setFromMatrixColumn(xe,0),ue.multiplyScalar(-dt),p.add(ue)}})(),Y=(()=>{const ue=new oe;return function(dt,xe){r.screenSpacePanning===!0?ue.setFromMatrixColumn(xe,1):(ue.setFromMatrixColumn(xe,0),ue.crossVectors(r.object.up,ue)),ue.multiplyScalar(dt),p.add(ue)}})(),O=(()=>{const ue=new oe;return function(dt,xe){const ae=r.domElement;if(ae&&r.object instanceof Kr&&r.object.isPerspectiveCamera){const fe=r.object.position;ue.copy(fe).sub(r.target);let Se=ue.length();Se*=Math.tan(r.object.fov/2*Math.PI/180),Q(2*dt*Se/ae.clientHeight,r.object.matrix),Y(2*xe*Se/ae.clientHeight,r.object.matrix)}else ae&&r.object instanceof $u&&r.object.isOrthographicCamera?(Q(dt*(r.object.right-r.object.left)/r.object.zoom/ae.clientWidth,r.object.matrix),Y(xe*(r.object.top-r.object.bottom)/r.object.zoom/ae.clientHeight,r.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),r.enablePan=!1)}})();function j(ue){r.object instanceof Kr&&r.object.isPerspectiveCamera||r.object instanceof $u&&r.object.isOrthographicCamera?d/=ue:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function V(ue){r.object instanceof Kr&&r.object.isPerspectiveCamera||r.object instanceof $u&&r.object.isOrthographicCamera?d*=ue:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function W(ue){if(!r.zoomToCursor||!r.domElement)return;E=!0;const Ue=r.domElement.getBoundingClientRect(),dt=ue.clientX-Ue.left,xe=ue.clientY-Ue.top,ae=Ue.width,fe=Ue.height;T.x=dt/ae*2-1,T.y=-(xe/fe)*2+1,A.set(T.x,T.y,1).unproject(r.object).sub(r.object.position).normalize()}function J(ue){return Math.max(r.minDistance,Math.min(r.maxDistance,ue))}function ce(ue){f.set(ue.clientX,ue.clientY)}function $(ue){W(ue),_.set(ue.clientX,ue.clientY)}function ne(ue){m.set(ue.clientX,ue.clientY)}function ie(ue){v.set(ue.clientX,ue.clientY),g.subVectors(v,f).multiplyScalar(r.rotateSpeed);const Ue=r.domElement;Ue&&(z(2*Math.PI*g.x/Ue.clientHeight),F(2*Math.PI*g.y/Ue.clientHeight)),f.copy(v),r.update()}function de(ue){M.set(ue.clientX,ue.clientY),S.subVectors(M,_),S.y>0?j(L()):S.y<0&&V(L()),_.copy(M),r.update()}function be(ue){x.set(ue.clientX,ue.clientY),w.subVectors(x,m).multiplyScalar(r.panSpeed),O(w.x,w.y),m.copy(x),r.update()}function we(ue){W(ue),ue.deltaY<0?V(L()):ue.deltaY>0&&j(L()),r.update()}function _e(ue){let Ue=!1;switch(ue.code){case r.keys.UP:O(0,r.keyPanSpeed),Ue=!0;break;case r.keys.BOTTOM:O(0,-r.keyPanSpeed),Ue=!0;break;case r.keys.LEFT:O(r.keyPanSpeed,0),Ue=!0;break;case r.keys.RIGHT:O(-r.keyPanSpeed,0),Ue=!0;break}Ue&&(ue.preventDefault(),r.update())}function Me(){if(C.length==1)f.set(C[0].pageX,C[0].pageY);else{const ue=.5*(C[0].pageX+C[1].pageX),Ue=.5*(C[0].pageY+C[1].pageY);f.set(ue,Ue)}}function X(){if(C.length==1)m.set(C[0].pageX,C[0].pageY);else{const ue=.5*(C[0].pageX+C[1].pageX),Ue=.5*(C[0].pageY+C[1].pageY);m.set(ue,Ue)}}function ge(){const ue=C[0].pageX-C[1].pageX,Ue=C[0].pageY-C[1].pageY,dt=Math.sqrt(ue*ue+Ue*Ue);_.set(0,dt)}function Oe(){r.enableZoom&&ge(),r.enablePan&&X()}function Ie(){r.enableZoom&&ge(),r.enableRotate&&Me()}function Pe(ue){if(C.length==1)v.set(ue.pageX,ue.pageY);else{const dt=tt(ue),xe=.5*(ue.pageX+dt.x),ae=.5*(ue.pageY+dt.y);v.set(xe,ae)}g.subVectors(v,f).multiplyScalar(r.rotateSpeed);const Ue=r.domElement;Ue&&(z(2*Math.PI*g.x/Ue.clientHeight),F(2*Math.PI*g.y/Ue.clientHeight)),f.copy(v)}function Ye(ue){if(C.length==1)x.set(ue.pageX,ue.pageY);else{const Ue=tt(ue),dt=.5*(ue.pageX+Ue.x),xe=.5*(ue.pageY+Ue.y);x.set(dt,xe)}w.subVectors(x,m).multiplyScalar(r.panSpeed),O(w.x,w.y),m.copy(x)}function ke(ue){const Ue=tt(ue),dt=ue.pageX-Ue.x,xe=ue.pageY-Ue.y,ae=Math.sqrt(dt*dt+xe*xe);M.set(0,ae),S.set(0,Math.pow(M.y/_.y,r.zoomSpeed)),j(S.y),_.copy(M)}function Fe(ue){r.enableZoom&&ke(ue),r.enablePan&&Ye(ue)}function se(ue){r.enableZoom&&ke(ue),r.enableRotate&&Pe(ue)}function Z(ue){var Ue,dt;r.enabled!==!1&&(C.length===0&&((Ue=r.domElement)==null||Ue.ownerDocument.addEventListener("pointermove",K),(dt=r.domElement)==null||dt.ownerDocument.addEventListener("pointerup",k)),je(ue),ue.pointerType==="touch"?ze(ue):re(ue))}function K(ue){r.enabled!==!1&&(ue.pointerType==="touch"?Qe(ue):he(ue))}function k(ue){var Ue,dt,xe;nt(ue),C.length===0&&((Ue=r.domElement)==null||Ue.releasePointerCapture(ue.pointerId),(dt=r.domElement)==null||dt.ownerDocument.removeEventListener("pointermove",K),(xe=r.domElement)==null||xe.ownerDocument.removeEventListener("pointerup",k)),r.dispatchEvent(a),l=o.NONE}function re(ue){let Ue;switch(ue.button){case 0:Ue=r.mouseButtons.LEFT;break;case 1:Ue=r.mouseButtons.MIDDLE;break;case 2:Ue=r.mouseButtons.RIGHT;break;default:Ue=-1}switch(Ue){case Wp.DOLLY:if(r.enableZoom===!1)return;$(ue),l=o.DOLLY;break;case Wp.ROTATE:if(ue.ctrlKey||ue.metaKey||ue.shiftKey){if(r.enablePan===!1)return;ne(ue),l=o.PAN}else{if(r.enableRotate===!1)return;ce(ue),l=o.ROTATE}break;case Wp.PAN:if(ue.ctrlKey||ue.metaKey||ue.shiftKey){if(r.enableRotate===!1)return;ce(ue),l=o.ROTATE}else{if(r.enablePan===!1)return;ne(ue),l=o.PAN}break;default:l=o.NONE}l!==o.NONE&&r.dispatchEvent(s)}function he(ue){if(r.enabled!==!1)switch(l){case o.ROTATE:if(r.enableRotate===!1)return;ie(ue);break;case o.DOLLY:if(r.enableZoom===!1)return;de(ue);break;case o.PAN:if(r.enablePan===!1)return;be(ue);break}}function G(ue){r.enabled===!1||r.enableZoom===!1||l!==o.NONE&&l!==o.ROTATE||(ue.preventDefault(),r.dispatchEvent(s),we(ue),r.dispatchEvent(a))}function Te(ue){r.enabled===!1||r.enablePan===!1||_e(ue)}function ze(ue){switch(ct(ue),C.length){case 1:switch(r.touches.ONE){case Xp.ROTATE:if(r.enableRotate===!1)return;Me(),l=o.TOUCH_ROTATE;break;case Xp.PAN:if(r.enablePan===!1)return;X(),l=o.TOUCH_PAN;break;default:l=o.NONE}break;case 2:switch(r.touches.TWO){case Xp.DOLLY_PAN:if(r.enableZoom===!1&&r.enablePan===!1)return;Oe(),l=o.TOUCH_DOLLY_PAN;break;case Xp.DOLLY_ROTATE:if(r.enableZoom===!1&&r.enableRotate===!1)return;Ie(),l=o.TOUCH_DOLLY_ROTATE;break;default:l=o.NONE}break;default:l=o.NONE}l!==o.NONE&&r.dispatchEvent(s)}function Qe(ue){switch(ct(ue),l){case o.TOUCH_ROTATE:if(r.enableRotate===!1)return;Pe(ue),r.update();break;case o.TOUCH_PAN:if(r.enablePan===!1)return;Ye(ue),r.update();break;case o.TOUCH_DOLLY_PAN:if(r.enableZoom===!1&&r.enablePan===!1)return;Fe(ue),r.update();break;case o.TOUCH_DOLLY_ROTATE:if(r.enableZoom===!1&&r.enableRotate===!1)return;se(ue),r.update();break;default:l=o.NONE}}function ye(ue){r.enabled!==!1&&ue.preventDefault()}function je(ue){C.push(ue)}function nt(ue){delete D[ue.pointerId];for(let Ue=0;Ue<C.length;Ue++)if(C[Ue].pointerId==ue.pointerId){C.splice(Ue,1);return}}function ct(ue){let Ue=D[ue.pointerId];Ue===void 0&&(Ue=new ot,D[ue.pointerId]=Ue),Ue.set(ue.pageX,ue.pageY)}function tt(ue){const Ue=ue.pointerId===C[0].pointerId?C[1]:C[0];return D[Ue.pointerId]}i!==void 0&&this.connect(i),this.update()}};const Qte=qe.forwardRef(({makeDefault:e,camera:t,regress:i,domElement:r,enableDamping:n=!0,keyEvents:s=!1,onChange:a,onStart:o,onEnd:l,...c},u)=>{const h=nd(S=>S.invalidate),d=nd(S=>S.camera),p=nd(S=>S.gl),f=nd(S=>S.events),v=nd(S=>S.setEvents),g=nd(S=>S.set),m=nd(S=>S.get),x=nd(S=>S.performance),w=t||d,_=r||f.connected||p.domElement,M=qe.useMemo(()=>new j5e(w),[w]);return zU(()=>{M.enabled&&M.update()},-1),qe.useEffect(()=>(s&&M.connect(s===!0?_:s),M.connect(_),()=>void M.dispose()),[s,_,i,M,h]),qe.useEffect(()=>{const S=E=>{h(),i&&x.regress(),a&&a(E)},A=E=>{o&&o(E)},T=E=>{l&&l(E)};return M.addEventListener("change",S),M.addEventListener("start",A),M.addEventListener("end",T),()=>{M.removeEventListener("start",A),M.removeEventListener("end",T),M.removeEventListener("change",S)}},[a,o,l,M,h,v]),qe.useEffect(()=>{if(e){const S=m().controls;return g({controls:M}),()=>g({controls:S})}},[e,M]),qe.createElement("primitive",ZC({ref:u,object:M,enableDamping:n},c))});function t7(e,t){return e.map(function(i,r){return i+t[r]})}function Kte(e,t){return e.map(function(i,r){return i-t[r]})}function W5e(e,t,i){return i=i||Math.hypot.apply(Math,e),t?i/t:0}function X5e(e,t){return t?e.map(function(i){return i/t}):Array(e.length).fill(0)}function Zte(e){return Math.hypot.apply(Math,e)}function q5e(e,t){return t=t||Math.hypot.apply(Math,e)||1,e.map(function(i){return i/t})}function Y5e(e,t,i){var r=Math.hypot.apply(Math,t);return{velocities:X5e(t,i),velocity:W5e(t,i,r),distance:Zte(e),direction:q5e(t,r)}}function Zz(e){return Math.sign?Math.sign(e):+(e>0)-+(e<0)||+e}function i7(e,t){var i=Math.abs(e);return i>=t?Zz(e)*t:!1}function Q5e(e,t,i){return Math.max(t,Math.min(e,i))}function K5e(e,t){return Math.pow(e,t*5)}function r7(e,t,i){return t===0||Math.abs(t)===1/0?K5e(e,i):e*t*i/(t+i*e)}function Z5e(e,t,i,r){return r===void 0&&(r=.15),r===0?Q5e(e,t,i):e<t?-r7(t-e,i-t,r)+t:e>i?r7(e-i,i-t,r)+i:e}function $5e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function J5e(e,t,i){return t&&$5e(e.prototype,t),e}function ai(){return ai=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},ai.apply(this,arguments)}function $te(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function A2(e,t){if(e==null)return{};var i={},r=Object.keys(e),n,s;for(s=0;s<r.length;s++)n=r[s],!(t.indexOf(n)>=0)&&(i[n]=e[n]);return i}function eVe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function tVe(e,t){if(e){if(typeof e=="string")return n7(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor&&(i=e.constructor.name),i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return n7(e,t)}}function n7(e,t){(t==null||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}function iVe(e){var t=0;if(typeof Symbol>"u"||e[Symbol.iterator]==null){if(Array.isArray(e)||(e=tVe(e)))return function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}};throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}return t=e[Symbol.iterator](),t.next.bind(t)}function Jte(){}var s7=function(){for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];return function(){for(var n=arguments.length,s=new Array(n),a=0;a<n;a++)s[a]=arguments[a];return i.forEach(function(o){return o.apply(void 0,s)})}},Dd={array:function(t){return Array.isArray(t)?t:[t,t]},withDefault:function(t,i){return t!==void 0?t:i}};function eie(e,t){var i={};return Object.entries(e).forEach(function(r){var n=r[0],s=r[1];return(s!==void 0||n in t)&&(i[n]=s)}),i}function VM(e){return typeof e=="function"?e():e}function tie(){var e={_active:!1,_blocked:!1,_intentional:[!1,!1],_movement:[0,0],_initial:[0,0],_lastEventType:void 0,event:void 0,values:[0,0],velocities:[0,0],delta:[0,0],movement:[0,0],offset:[0,0],lastOffset:[0,0],direction:[0,0],initial:[0,0],previous:[0,0],first:!1,last:!1,active:!1,timeStamp:0,startTime:0,elapsedTime:0,cancel:Jte,canceled:!1,memo:void 0,args:void 0},t={axis:void 0,xy:[0,0],vxvy:[0,0],velocity:0,distance:0},i={da:[0,0],vdva:[0,0],origin:void 0,turns:0};return{shared:{hovering:!1,scrolling:!1,wheeling:!1,dragging:!1,moving:!1,pinching:!1,touches:0,buttons:0,down:!1,shiftKey:!1,altKey:!1,metaKey:!1,ctrlKey:!1},drag:ai(ai(ai({},e),t),{},{_isTap:!0,_delayedEvent:!1,tap:!1,swipe:[0,0]}),pinch:ai(ai({},e),i),wheel:ai(ai({},e),t),move:ai(ai({},e),t),scroll:ai(ai({},e),t)}}var iie=function(t){return function(i,r,n){var s=t?"addEventListener":"removeEventListener";r.forEach(function(a){var o=a[0],l=a[1];return i[s](o,l,n)})}},a7=iie(!0),o7=iie(!1);function rVe(e){var t=e.shiftKey,i=e.altKey,r=e.metaKey,n=e.ctrlKey;return{shiftKey:t,altKey:i,metaKey:r,ctrlKey:n}}function rie(e){if("touches"in e){var t=e.touches,i=e.changedTouches;return t.length>0?t:i}return null}function MI(e){var t="buttons"in e?e.buttons:0,i=rie(e),r=i&&i.length||0,n=r>0||t>0;return ai({touches:r,down:n,buttons:t},rVe(e))}function l7(e){var t=rie(e),i=t?t[0]:e,r=i.clientX,n=i.clientY;return{values:[r,n]}}var nVe=function(){var t=this;this.state=tie(),this.timeouts={},this.domListeners=[],this.windowListeners={},this.bindings={},this.clean=function(){t.resetBindings(),Object.values(t.timeouts).forEach(clearTimeout),Object.keys(t.windowListeners).forEach(function(i){return t.removeWindowListeners(i)})},this.resetBindings=function(){t.bindings={};var i=t.getDomTarget();i&&(o7(i,t.domListeners,t.config.eventOptions),t.domListeners=[])},this.getDomTarget=function(){var i=t.config.domTarget;return i&&"current"in i?i.current:i},this.addWindowListeners=function(i,r){t.config.window&&(t.windowListeners[i]=r,a7(t.config.window,r,t.config.eventOptions))},this.removeWindowListeners=function(i){if(t.config.window){var r=t.windowListeners[i];r&&(o7(t.config.window,r,t.config.eventOptions),delete t.windowListeners[i])}},this.addDomTargetListeners=function(i){Object.entries(t.bindings).forEach(function(r){var n=r[0],s=r[1];t.domListeners.push([n.substr(2).toLowerCase(),s7.apply(void 0,s)])}),a7(i,t.domListeners,t.config.eventOptions)},this.addBindings=function(i,r){var n=Array.isArray(i)?i:[i];n.forEach(function(s){t.bindings[s]?t.bindings[s].push(r):t.bindings[s]=[r]})},this.getBindings=function(){var i={},r=t.config.captureString;return Object.entries(t.bindings).forEach(function(n){var s=n[0],a=n[1],o=Array.isArray(a)?a:[a],l=s+r;i[l]=s7.apply(void 0,o)}),i},this.getBind=function(){if(t.config.domTarget){var i=t.getDomTarget();return i&&t.addDomTargetListeners(i),t.clean}return t.getBindings()}};function sVe(e,t,i,r){var n=Ci.useMemo(function(){var s=new nVe,a=function(){s.resetBindings();for(var l=arguments.length,c=new Array(l),u=0;u<l;u++)c[u]=arguments[u];for(var h=iVe(t),d;!(d=h()).done;){var p=d.value;new p(s,c).addBindings()}if(n.nativeRefs)for(var f in n.nativeRefs)s.addBindings(f,n.nativeRefs[f]);return s.getBind()};return{nativeRefs:r,current:s,bind:a}},[]);return n.current.config=i,n.current.handlers=e,n.nativeRefs=r,Ci.useEffect(function(){return n.current.clean},[]),n.bind}var aVe=function(){function e(i,r,n){var s=this;n===void 0&&(n=[]),this.stateKey=i,this.controller=r,this.args=n,this.debounced=!0,this.setTimeout=function(a,o){var l;o===void 0&&(o=140);for(var c=arguments.length,u=new Array(c>2?c-2:0),h=2;h<c;h++)u[h-2]=arguments[h];s.controller.timeouts[s.stateKey]=(l=window).setTimeout.apply(l,[a,o].concat(u))},this.clearTimeout=function(){clearTimeout(s.controller.timeouts[s.stateKey])},this.addWindowListeners=function(a){s.controller.addWindowListeners(s.stateKey,a)},this.removeWindowListeners=function(){s.controller.removeWindowListeners(s.stateKey)},this.getStartGestureState=function(a,o){return ai(ai({},tie()[s.stateKey]),{},{_active:!0,values:a,initial:a,offset:s.state.offset,lastOffset:s.state.offset,startTime:o.timeStamp})},this.rubberband=function(a,o){var l=s.config.bounds;return a.map(function(c,u){return Z5e(c,l[u][0],l[u][1],o[u])})},this.fireGestureHandler=function(a){if(s.state._blocked)return s.debounced||(s.state._active=!1,s.clean()),null;var o=s.state._intentional,l=o[0],c=o[1];if(!a&&l===!1&&c===!1)return null;var u=s.state,h=u._active,d=u.active;s.state.active=h,s.state.first=h&&!d,s.state.last=d&&!h,s.controller.state.shared[s.ingKey]=h;var p=ai(ai(ai({},s.controller.state.shared),s.state),s.mapStateValues(s.state)),f=s.handler(p);return s.state.memo=f!==void 0?f:s.state.memo,h||s.clean(),p}}var t=e.prototype;return t.updateSharedState=function(r){Object.assign(this.controller.state.shared,r)},t.updateGestureState=function(r){Object.assign(this.state,r)},t.getGenericPayload=function(r,n){var s=r.timeStamp,a=r.type,o=this.state,l=o.values,c=o.startTime;return{_lastEventType:a,event:r,timeStamp:s,elapsedTime:n?0:s-c,args:this.args,previous:l}},t.checkIntentionality=function(r,n,s){return{_intentional:r,_blocked:!1}},t.getMovement=function(r,n){n===void 0&&(n=this.state);var s=this.config,a=s.initial,o=s.threshold,l=s.rubberband,c=o[0],u=o[1],h=n,d=h._initial,p=h._active,f=h._intentional,v=h.lastOffset,g=h.movement,m=f[0],x=f[1],w=this.getInternalMovement(r,n),_=w[0],M=w[1];m===!1&&(m=i7(_,c)),x===!1&&(x=i7(M,u));var S=this.checkIntentionality([m,x],[_,M],n),A=S._intentional,T=S._blocked,E=A[0],C=A[1],D=[_,M];if(E!==!1&&f[0]===!1&&(d[0]=VM(a)[0]),C!==!1&&f[1]===!1&&(d[1]=VM(a)[1]),T)return ai(ai({},S),{},{_movement:D,delta:[0,0]});var I=[E!==!1?_-E:VM(a)[0],C!==!1?M-C:VM(a)[1]],L=t7(I,v),z=p?l:[0,0];return I=this.rubberband(t7(I,d),z),ai(ai({},S),{},{_initial:d,_movement:D,movement:I,offset:this.rubberband(L,z),delta:Kte(I,g)})},t.clean=function(){this.clearTimeout(),this.removeWindowListeners()},J5e(e,[{key:"config",get:function(){return this.controller.config[this.stateKey]}},{key:"enabled",get:function(){return this.controller.config.enabled&&this.config.enabled}},{key:"state",get:function(){return this.controller.state[this.stateKey]}},{key:"handler",get:function(){return this.controller.handlers[this.stateKey]}}]),e}(),oVe=function(e){$te(t,e);function t(){return e.apply(this,arguments)||this}var i=t.prototype;return i.getInternalMovement=function(n,s){return Kte(n,s.initial)},i.checkIntentionality=function(n,s,a){var o=n,l=o[0],c=o[1],u=l!==!1||c!==!1,h=a.axis,d=!1;if(u){var p=s.map(Math.abs),f=p[0],v=p[1],g=this.config,m=g.axis,x=g.lockDirection;if(h=h||(f>v?"x":f<v?"y":void 0),m||x)if(h)if(m&&h!==m)d=!0;else{var w=h==="x"?1:0;n[w]=!1}else n=[!1,!1]}return{_intentional:n,_blocked:d,axis:h}},i.getKinematics=function(n,s){var a=this.state.timeStamp,o=this.getMovement(n,this.state),l=o._blocked,c=o.delta,u=o.movement;if(l)return o;var h=s.timeStamp-a,d=Y5e(u,c,h);return ai(ai({values:n,delta:c},o),d)},i.mapStateValues=function(n){return{xy:n.values,vxvy:n.velocities}},t}(aVe),lVe=3,cVe=220,uVe=200,hVe=function(e){$te(t,e);function t(r,n){var s;return s=e.call(this,"drag",r,n)||this,s.ingKey="dragging",s.wasTouch=!1,s.isEventTypeTouch=function(a){return!!a&&a.indexOf("touch")===0},s.dragShouldStart=function(a){var o=MI(a),l=o.touches,c=s.state._lastEventType;if(!s.controller.config.pointer&&s.isEventTypeTouch(c)&&!s.isEventTypeTouch(a.type)){var u=Math.abs(a.timeStamp-s.state.startTime);if(u<uVe)return!1}return s.enabled&&l<2},s.setPointers=function(a){var o=a.currentTarget,l=a.pointerId;o&&o.setPointerCapture(l),s.updateGestureState({currentTarget:o,pointerId:l})},s.removePointers=function(){var a=s.state,o=a.currentTarget,l=a.pointerId;o&&l&&o.releasePointerCapture(l)},s.setListeners=function(a){s.removeWindowListeners();var o=a?[["touchmove",s.onDragChange],["touchend",s.onDragEnd],["touchcancel",s.onDragEnd]]:[["mousemove",s.onDragChange],["mouseup",s.onDragEnd]];s.addWindowListeners(o)},s.onDragStart=function(a){s.dragShouldStart(a)&&(s.controller.config.pointer?s.setPointers(a):s.setListeners(s.isEventTypeTouch(a.type)),s.config.delay>0?(s.state._delayedEvent=!0,typeof a.persist=="function"&&a.persist(),s.setTimeout(function(){return s.startDrag(a)},s.config.delay)):s.startDrag(a))},s.onDragChange=function(a){var o=s.state.canceled;if(!o){if(!s.state._active){s.state._delayedEvent&&(s.clearTimeout(),s.startDrag(a));return}var l=MI(a);if(!l.down){s.onDragEnd(a);return}s.updateSharedState(l);var c=l7(a),u=c.values,h=s.getKinematics(u,a),d=s.state._isTap;d&&Zte(h._movement)>=lVe&&(d=!1),s.updateGestureState(ai(ai(ai({},s.getGenericPayload(a)),h),{},{_isTap:d,cancel:function(){return s.onCancel()}})),s.fireGestureHandler()}},s.onDragEnd=function(a){s.state._active=!1,s.updateSharedState({down:!1,buttons:0,touches:0});var o=s.state,l=o._isTap,c=o.values,u=o.velocities,h=u[0],d=u[1],p=o.movement,f=p[0],v=p[1],g=o._intentional,m=g[0],x=g[1],w=ai(ai({},s.getGenericPayload(a)),s.getMovement(c)),_=w.elapsedTime,M=s.config,S=M.swipeVelocity,A=S[0],T=S[1],E=M.swipeDistance,C=E[0],D=E[1],I=[0,0];_<cVe&&(m!==!1&&Math.abs(h)>A&&Math.abs(f)>C&&(I[0]=Zz(h)),x!==!1&&Math.abs(d)>T&&Math.abs(v)>D&&(I[1]=Zz(d))),s.updateGestureState(ai(ai({event:a},w),{},{tap:l,swipe:I})),s.fireGestureHandler(s.config.filterTaps&&s.state._isTap)},s.clean=function(){e.prototype.clean.call(eVe(s)),s.state._delayedEvent=!1,s.controller.config.pointer&&s.removePointers()},s.onCancel=function(){s.updateGestureState({canceled:!0,cancel:Jte}),s.state._active=!1,s.updateSharedState({down:!1,buttons:0,touches:0}),requestAnimationFrame(function(){return s.fireGestureHandler()})},s}var i=t.prototype;return i.startDrag=function(n){var s=this,a=l7(n),o=a.values;this.updateSharedState(MI(n));var l=ai(ai({},this.getStartGestureState(o,n)),this.getGenericPayload(n,!0));this.updateGestureState(ai(ai(ai({},l),this.getMovement(o,l)),{},{cancel:function(){return s.onCancel()}})),this.fireGestureHandler()},i.addBindings=function(){this.controller.config.pointer?(this.controller.addBindings("onPointerDown",this.onDragStart),this.controller.addBindings("onPointerMove",this.onDragChange),this.controller.addBindings(["onPointerUp","onPointerCancel"],this.onDragEnd)):this.controller.addBindings(["onTouchStart","onMouseDown"],this.onDragStart)},t}(oVe),dVe=180,pVe=.15,fVe=.5,mVe=60,gVe=typeof window<"u"?window:void 0,vVe={lockDirection:!1,axis:void 0,bounds:void 0};function yVe(e){e===void 0&&(e={});var t=e,i=t.eventOptions;i=i===void 0?{}:i;var r=i.passive,n=r===void 0?!0:r,s=i.capture,a=s===void 0?!1:s,o=i.pointer,l=o===void 0?!1:o,c=t.window,u=c===void 0?gVe:c,h=t.domTarget,d=h===void 0?void 0:h,p=t.enabled,f=p===void 0?!0:p,v=A2(t,["eventOptions","window","domTarget","enabled"]);return ai(ai({},v),{},{enabled:f,domTarget:d,window:u,eventOptions:{passive:!d||!!n,capture:!!a},captureString:a?"Capture":"",pointer:!!l})}function xVe(e){var t=e.threshold,i=t===void 0?void 0:t,r=e.rubberband,n=r===void 0?0:r,s=e.enabled,a=s===void 0?!0:s,o=e.initial,l=o===void 0?[0,0]:o;return typeof n=="boolean"&&(n=n?pVe:0),i===void 0&&(i=0),{enabled:a,initial:l,threshold:Dd.array(i),rubberband:Dd.array(n)}}function wVe(e){e===void 0&&(e={});var t=e,i=t.axis,r=t.lockDirection,n=t.bounds,s=n===void 0?{}:n,a=A2(t,["axis","lockDirection","bounds"]),o=[[Dd.withDefault(s.left,-1/0),Dd.withDefault(s.right,1/0)],[Dd.withDefault(s.top,-1/0),Dd.withDefault(s.bottom,1/0)]];return ai(ai(ai(ai({},xVe(a)),vVe),eie({axis:i,lockDirection:r},e)),{},{bounds:o})}function bVe(e){e===void 0&&(e={});var t=e,i=t.enabled,r=t.threshold,n=t.bounds,s=t.rubberband,a=t.initial,o=A2(t,["enabled","threshold","bounds","rubberband","initial"]),l=o.swipeVelocity,c=l===void 0?fVe:l,u=o.swipeDistance,h=u===void 0?mVe:u,d=o.delay,p=d===void 0?!1:d,f=o.filterTaps,v=f===void 0?!1:f,g=o.axis,m=o.lockDirection;r===void 0?r=Math.max(0,v?3:0,m||g?1:0):v=!0;var x=wVe(eie({enabled:i,threshold:r,bounds:n,rubberband:s,axis:g,lockDirection:m,initial:a},e));return ai(ai({},x),{},{filterTaps:v||x.threshold[0]+x.threshold[1]>0,swipeVelocity:Dd.array(c),swipeDistance:Dd.array(h),delay:typeof p=="number"?p:p?dVe:0})}function _Ve(e,t){t===void 0&&(t={});var i=t,r=i.domTarget,n=i.eventOptions,s=i.window,a=A2(i,["domTarget","eventOptions","window"]),o=ai(ai({},yVe({domTarget:r,eventOptions:n,window:s})),{},{drag:bVe(a)});return sVe({drag:e},[hVe],o)}var EI=256,$z=[];for(;EI--;)$z[EI]=(EI+256).toString(16).substring(1);function SVe(e){e=e||16;var t="",i=0;return function(){if(!t||i===256){for(t="",i=(1+e)/2|0;i--;)t+=$z[256*Math.random()|0];t=t.substring(i=0,e-2)}return t+$z[i++]}}var Fa=function(){return Fa=Object.assign||function(t){for(var i,r=1,n=arguments.length;r<n;r++){i=arguments[r];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t},Fa.apply(this,arguments)};function $C(e,t,i){if(i||arguments.length===2)for(var r=0,n=t.length,s;r<n;r++)(s||!(r in t))&&(s||(s=Array.prototype.slice.call(t,0,r)),s[r]=t[r]);return e.concat(s||Array.prototype.slice.call(t))}var Sr="-ms-",h1="-moz-",Ji="-webkit-",nie="comm",C2="rule",kU="decl",MVe="@import",sie="@keyframes",EVe="@layer",aie=Math.abs,UU=String.fromCharCode,Jz=Object.assign;function AVe(e,t){return Jn(e,0)^45?(((t<<2^Jn(e,0))<<2^Jn(e,1))<<2^Jn(e,2))<<2^Jn(e,3):0}function oie(e){return e.trim()}function Iu(e,t){return(e=t.exec(e))?e[0]:e}function _i(e,t,i){return e.replace(t,i)}function IE(e,t,i){return e.indexOf(t,i)}function Jn(e,t){return e.charCodeAt(t)|0}function h0(e,t,i){return e.slice(t,i)}function Sc(e){return e.length}function lie(e){return e.length}function Dx(e,t){return t.push(e),e}function CVe(e,t){return e.map(t).join("")}function c7(e,t){return e.filter(function(i){return!Iu(i,t)})}var T2=1,d0=1,cie=0,sl=0,yn=0,G0="";function P2(e,t,i,r,n,s,a,o){return{value:e,root:t,parent:i,type:r,props:n,children:s,line:T2,column:d0,length:a,return:"",siblings:o}}function ad(e,t){return Jz(P2("",null,null,"",null,null,0,e.siblings),e,{length:-e.length},t)}function Cg(e){for(;e.root;)e=ad(e.root,{children:[e]});Dx(e,e.siblings)}function TVe(){return yn}function PVe(){return yn=sl>0?Jn(G0,--sl):0,d0--,yn===10&&(d0=1,T2--),yn}function kl(){return yn=sl<cie?Jn(G0,sl++):0,d0++,yn===10&&(d0=1,T2++),yn}function Of(){return Jn(G0,sl)}function LE(){return sl}function D2(e,t){return h0(G0,e,t)}function eN(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function DVe(e){return T2=d0=1,cie=Sc(G0=e),sl=0,[]}function RVe(e){return G0="",e}function AI(e){return oie(D2(sl-1,tN(e===91?e+2:e===40?e+1:e)))}function IVe(e){for(;(yn=Of())&&yn<33;)kl();return eN(e)>2||eN(yn)>3?"":" "}function LVe(e,t){for(;--t&&kl()&&!(yn<48||yn>102||yn>57&&yn<65||yn>70&&yn<97););return D2(e,LE()+(t<6&&Of()==32&&kl()==32))}function tN(e){for(;kl();)switch(yn){case e:return sl;case 34:case 39:e!==34&&e!==39&&tN(yn);break;case 40:e===41&&tN(e);break;case 92:kl();break}return sl}function OVe(e,t){for(;kl()&&e+yn!==57;)if(e+yn===84&&Of()===47)break;return"/*"+D2(t,sl-1)+"*"+UU(e===47?e:kl())}function zVe(e){for(;!eN(Of());)kl();return D2(e,sl)}function NVe(e){return RVe(OE("",null,null,null,[""],e=DVe(e),0,[0],e))}function OE(e,t,i,r,n,s,a,o,l){for(var c=0,u=0,h=a,d=0,p=0,f=0,v=1,g=1,m=1,x=0,w="",_=n,M=s,S=r,A=w;g;)switch(f=x,x=kl()){case 40:if(f!=108&&Jn(A,h-1)==58){IE(A+=_i(AI(x),"&","&\f"),"&\f",aie(c?o[c-1]:0))!=-1&&(m=-1);break}case 34:case 39:case 91:A+=AI(x);break;case 9:case 10:case 13:case 32:A+=IVe(f);break;case 92:A+=LVe(LE()-1,7);continue;case 47:switch(Of()){case 42:case 47:Dx(BVe(OVe(kl(),LE()),t,i,l),l);break;default:A+="/"}break;case 123*v:o[c++]=Sc(A)*m;case 125*v:case 59:case 0:switch(x){case 0:case 125:g=0;case 59+u:m==-1&&(A=_i(A,/\f/g,"")),p>0&&Sc(A)-h&&Dx(p>32?h7(A+";",r,i,h-1,l):h7(_i(A," ","")+";",r,i,h-2,l),l);break;case 59:A+=";";default:if(Dx(S=u7(A,t,i,c,u,n,o,w,_=[],M=[],h,s),s),x===123)if(u===0)OE(A,t,S,S,_,s,h,o,M);else switch(d===99&&Jn(A,3)===110?100:d){case 100:case 108:case 109:case 115:OE(e,S,S,r&&Dx(u7(e,S,S,0,0,n,o,w,n,_=[],h,M),M),n,M,h,o,r?_:M);break;default:OE(A,S,S,S,[""],M,0,o,M)}}c=u=p=0,v=m=1,w=A="",h=a;break;case 58:h=1+Sc(A),p=f;default:if(v<1){if(x==123)--v;else if(x==125&&v++==0&&PVe()==125)continue}switch(A+=UU(x),x*v){case 38:m=u>0?1:(A+="\f",-1);break;case 44:o[c++]=(Sc(A)-1)*m,m=1;break;case 64:Of()===45&&(A+=AI(kl())),d=Of(),u=h=Sc(w=A+=zVe(LE())),x++;break;case 45:f===45&&Sc(A)==2&&(v=0)}}return s}function u7(e,t,i,r,n,s,a,o,l,c,u,h){for(var d=n-1,p=n===0?s:[""],f=lie(p),v=0,g=0,m=0;v<r;++v)for(var x=0,w=h0(e,d+1,d=aie(g=a[v])),_=e;x<f;++x)(_=oie(g>0?p[x]+" "+w:_i(w,/&\f/g,p[x])))&&(l[m++]=_);return P2(e,t,i,n===0?C2:o,l,c,u,h)}function BVe(e,t,i,r){return P2(e,t,i,nie,UU(TVe()),h0(e,2,-2),0,r)}function h7(e,t,i,r,n){return P2(e,t,i,kU,h0(e,0,r),h0(e,r+1,-1),r,n)}function uie(e,t,i){switch(AVe(e,t)){case 5103:return Ji+"print-"+e+e;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return Ji+e+e;case 4789:return h1+e+e;case 5349:case 4246:case 4810:case 6968:case 2756:return Ji+e+h1+e+Sr+e+e;case 5936:switch(Jn(e,t+11)){case 114:return Ji+e+Sr+_i(e,/[svh]\w+-[tblr]{2}/,"tb")+e;case 108:return Ji+e+Sr+_i(e,/[svh]\w+-[tblr]{2}/,"tb-rl")+e;case 45:return Ji+e+Sr+_i(e,/[svh]\w+-[tblr]{2}/,"lr")+e}case 6828:case 4268:case 2903:return Ji+e+Sr+e+e;case 6165:return Ji+e+Sr+"flex-"+e+e;case 5187:return Ji+e+_i(e,/(\w+).+(:[^]+)/,Ji+"box-$1$2"+Sr+"flex-$1$2")+e;case 5443:return Ji+e+Sr+"flex-item-"+_i(e,/flex-|-self/g,"")+(Iu(e,/flex-|baseline/)?"":Sr+"grid-row-"+_i(e,/flex-|-self/g,""))+e;case 4675:return Ji+e+Sr+"flex-line-pack"+_i(e,/align-content|flex-|-self/g,"")+e;case 5548:return Ji+e+Sr+_i(e,"shrink","negative")+e;case 5292:return Ji+e+Sr+_i(e,"basis","preferred-size")+e;case 6060:return Ji+"box-"+_i(e,"-grow","")+Ji+e+Sr+_i(e,"grow","positive")+e;case 4554:return Ji+_i(e,/([^-])(transform)/g,"$1"+Ji+"$2")+e;case 6187:return _i(_i(_i(e,/(zoom-|grab)/,Ji+"$1"),/(image-set)/,Ji+"$1"),e,"")+e;case 5495:case 3959:return _i(e,/(image-set\([^]*)/,Ji+"$1$`$1");case 4968:return _i(_i(e,/(.+:)(flex-)?(.*)/,Ji+"box-pack:$3"+Sr+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+Ji+e+e;case 4200:if(!Iu(e,/flex-|baseline/))return Sr+"grid-column-align"+h0(e,t)+e;break;case 2592:case 3360:return Sr+_i(e,"template-","")+e;case 4384:case 3616:return i&&i.some(function(r,n){return t=n,Iu(r.props,/grid-\w+-end/)})?~IE(e+(i=i[t].value),"span",0)?e:Sr+_i(e,"-start","")+e+Sr+"grid-row-span:"+(~IE(i,"span",0)?Iu(i,/\d+/):+Iu(i,/\d+/)-+Iu(e,/\d+/))+";":Sr+_i(e,"-start","")+e;case 4896:case 4128:return i&&i.some(function(r){return Iu(r.props,/grid-\w+-start/)})?e:Sr+_i(_i(e,"-end","-span"),"span ","")+e;case 4095:case 3583:case 4068:case 2532:return _i(e,/(.+)-inline(.+)/,Ji+"$1$2")+e;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(Sc(e)-1-t>6)switch(Jn(e,t+1)){case 109:if(Jn(e,t+4)!==45)break;case 102:return _i(e,/(.+:)(.+)-([^]+)/,"$1"+Ji+"$2-$3$1"+h1+(Jn(e,t+3)==108?"$3":"$2-$3"))+e;case 115:return~IE(e,"stretch",0)?uie(_i(e,"stretch","fill-available"),t,i)+e:e}break;case 5152:case 5920:return _i(e,/(.+?):(\d+)(\s*\/\s*(span)?\s*(\d+))?(.*)/,function(r,n,s,a,o,l,c){return Sr+n+":"+s+c+(a?Sr+n+"-span:"+(o?l:+l-+s)+c:"")+e});case 4949:if(Jn(e,t+6)===121)return _i(e,":",":"+Ji)+e;break;case 6444:switch(Jn(e,Jn(e,14)===45?18:11)){case 120:return _i(e,/(.+:)([^;\s!]+)(;|(\s+)?!.+)?/,"$1"+Ji+(Jn(e,14)===45?"inline-":"")+"box$3$1"+Ji+"$2$3$1"+Sr+"$2box$3")+e;case 100:return _i(e,":",":"+Sr)+e}break;case 5719:case 2647:case 2135:case 3927:case 2391:return _i(e,"scroll-","scroll-snap-")+e}return e}function JC(e,t){for(var i="",r=0;r<e.length;r++)i+=t(e[r],r,e,t)||"";return i}function kVe(e,t,i,r){switch(e.type){case EVe:if(e.children.length)break;case MVe:case kU:return e.return=e.return||e.value;case nie:return"";case sie:return e.return=e.value+"{"+JC(e.children,r)+"}";case C2:if(!Sc(e.value=e.props.join(",")))return""}return Sc(i=JC(e.children,r))?e.return=e.value+"{"+i+"}":""}function UVe(e){var t=lie(e);return function(i,r,n,s){for(var a="",o=0;o<t;o++)a+=e[o](i,r,n,s)||"";return a}}function FVe(e){return function(t){t.root||(t=t.return)&&e(t)}}function VVe(e,t,i,r){if(e.length>-1&&!e.return)switch(e.type){case kU:e.return=uie(e.value,e.length,i);return;case sie:return JC([ad(e,{value:_i(e.value,"@","@"+Ji)})],r);case C2:if(e.length)return CVe(i=e.props,function(n){switch(Iu(n,r=/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":Cg(ad(e,{props:[_i(n,/:(read-\w+)/,":"+h1+"$1")]})),Cg(ad(e,{props:[n]})),Jz(e,{props:c7(i,r)});break;case"::placeholder":Cg(ad(e,{props:[_i(n,/:(plac\w+)/,":"+Ji+"input-$1")]})),Cg(ad(e,{props:[_i(n,/:(plac\w+)/,":"+h1+"$1")]})),Cg(ad(e,{props:[_i(n,/:(plac\w+)/,Sr+"input-$1")]})),Cg(ad(e,{props:[n]})),Jz(e,{props:c7(i,r)});break}return""})}}var HVe={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},no={},p0=typeof process<"u"&&no!==void 0&&(no.REACT_APP_SC_ATTR||no.SC_ATTR)||"data-styled",hie="active",die="data-styled-version",R2="6.1.12",FU=`/*!sc*/
`,eT=typeof window<"u"&&"HTMLElement"in window,GVe=!!(typeof SC_DISABLE_SPEEDY=="boolean"?SC_DISABLE_SPEEDY:typeof process<"u"&&no!==void 0&&no.REACT_APP_SC_DISABLE_SPEEDY!==void 0&&no.REACT_APP_SC_DISABLE_SPEEDY!==""?no.REACT_APP_SC_DISABLE_SPEEDY!=="false"&&no.REACT_APP_SC_DISABLE_SPEEDY:typeof process<"u"&&no!==void 0&&no.SC_DISABLE_SPEEDY!==void 0&&no.SC_DISABLE_SPEEDY!==""&&no.SC_DISABLE_SPEEDY!=="false"&&no.SC_DISABLE_SPEEDY),I2=Object.freeze([]),f0=Object.freeze({});function jVe(e,t,i){return i===void 0&&(i=f0),e.theme!==i.theme&&e.theme||t||i.theme}var pie=new Set(["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","tr","track","u","ul","use","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","marker","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"]),WVe=/[!"#$%&'()*+,./:;<=>?@[\\\]^`{|}~-]+/g,XVe=/(^-|-$)/g;function d7(e){return e.replace(WVe,"-").replace(XVe,"")}var qVe=/(a)(d)/gi,HM=52,p7=function(e){return String.fromCharCode(e+(e>25?39:97))};function iN(e){var t,i="";for(t=Math.abs(e);t>HM;t=t/HM|0)i=p7(t%HM)+i;return(p7(t%HM)+i).replace(qVe,"$1-$2")}var CI,fie=5381,fv=function(e,t){for(var i=t.length;i;)e=33*e^t.charCodeAt(--i);return e},mie=function(e){return fv(fie,e)};function YVe(e){return iN(mie(e)>>>0)}function QVe(e){return e.displayName||e.name||"Component"}function TI(e){return typeof e=="string"&&!0}var gie=typeof Symbol=="function"&&Symbol.for,vie=gie?Symbol.for("react.memo"):60115,KVe=gie?Symbol.for("react.forward_ref"):60112,ZVe={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},$Ve={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},yie={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},JVe=((CI={})[KVe]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},CI[vie]=yie,CI);function f7(e){return("type"in(t=e)&&t.type.$$typeof)===vie?yie:"$$typeof"in e?JVe[e.$$typeof]:ZVe;var t}var eHe=Object.defineProperty,tHe=Object.getOwnPropertyNames,m7=Object.getOwnPropertySymbols,iHe=Object.getOwnPropertyDescriptor,rHe=Object.getPrototypeOf,g7=Object.prototype;function xie(e,t,i){if(typeof t!="string"){if(g7){var r=rHe(t);r&&r!==g7&&xie(e,r,i)}var n=tHe(t);m7&&(n=n.concat(m7(t)));for(var s=f7(e),a=f7(t),o=0;o<n.length;++o){var l=n[o];if(!(l in $Ve||i&&i[l]||a&&l in a||s&&l in s)){var c=iHe(t,l);try{eHe(e,l,c)}catch{}}}}return e}function m0(e){return typeof e=="function"}function VU(e){return typeof e=="object"&&"styledComponentId"in e}function xf(e,t){return e&&t?"".concat(e," ").concat(t):e||t||""}function v7(e,t){if(e.length===0)return"";for(var i=e[0],r=1;r<e.length;r++)i+=e[r];return i}function bw(e){return e!==null&&typeof e=="object"&&e.constructor.name===Object.name&&!("props"in e&&e.$$typeof)}function rN(e,t,i){if(i===void 0&&(i=!1),!i&&!bw(e)&&!Array.isArray(e))return t;if(Array.isArray(t))for(var r=0;r<t.length;r++)e[r]=rN(e[r],t[r]);else if(bw(t))for(var r in t)e[r]=rN(e[r],t[r]);return e}function HU(e,t){Object.defineProperty(e,"toString",{value:t})}function lb(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];return new Error("An error occurred. See https://github.com/styled-components/styled-components/blob/main/packages/styled-components/src/utils/errors.md#".concat(e," for more information.").concat(t.length>0?" Args: ".concat(t.join(", ")):""))}var nHe=function(){function e(t){this.groupSizes=new Uint32Array(512),this.length=512,this.tag=t}return e.prototype.indexOfGroup=function(t){for(var i=0,r=0;r<t;r++)i+=this.groupSizes[r];return i},e.prototype.insertRules=function(t,i){if(t>=this.groupSizes.length){for(var r=this.groupSizes,n=r.length,s=n;t>=s;)if((s<<=1)<0)throw lb(16,"".concat(t));this.groupSizes=new Uint32Array(s),this.groupSizes.set(r),this.length=s;for(var a=n;a<s;a++)this.groupSizes[a]=0}for(var o=this.indexOfGroup(t+1),l=(a=0,i.length);a<l;a++)this.tag.insertRule(o,i[a])&&(this.groupSizes[t]++,o++)},e.prototype.clearGroup=function(t){if(t<this.length){var i=this.groupSizes[t],r=this.indexOfGroup(t),n=r+i;this.groupSizes[t]=0;for(var s=r;s<n;s++)this.tag.deleteRule(r)}},e.prototype.getGroup=function(t){var i="";if(t>=this.length||this.groupSizes[t]===0)return i;for(var r=this.groupSizes[t],n=this.indexOfGroup(t),s=n+r,a=n;a<s;a++)i+="".concat(this.tag.getRule(a)).concat(FU);return i},e}(),zE=new Map,tT=new Map,NE=1,GM=function(e){if(zE.has(e))return zE.get(e);for(;tT.has(NE);)NE++;var t=NE++;return zE.set(e,t),tT.set(t,e),t},sHe=function(e,t){NE=t+1,zE.set(e,t),tT.set(t,e)},aHe="style[".concat(p0,"][").concat(die,'="').concat(R2,'"]'),oHe=new RegExp("^".concat(p0,'\\.g(\\d+)\\[id="([\\w\\d-]+)"\\].*?"([^"]*)')),lHe=function(e,t,i){for(var r,n=i.split(","),s=0,a=n.length;s<a;s++)(r=n[s])&&e.registerName(t,r)},cHe=function(e,t){for(var i,r=((i=t.textContent)!==null&&i!==void 0?i:"").split(FU),n=[],s=0,a=r.length;s<a;s++){var o=r[s].trim();if(o){var l=o.match(oHe);if(l){var c=0|parseInt(l[1],10),u=l[2];c!==0&&(sHe(u,c),lHe(e,u,l[3]),e.getTag().insertRules(c,n)),n.length=0}else n.push(o)}}},y7=function(e){for(var t=document.querySelectorAll(aHe),i=0,r=t.length;i<r;i++){var n=t[i];n&&n.getAttribute(p0)!==hie&&(cHe(e,n),n.parentNode&&n.parentNode.removeChild(n))}};function uHe(){return typeof __webpack_nonce__<"u"?__webpack_nonce__:null}var wie=function(e){var t=document.head,i=e||t,r=document.createElement("style"),n=function(o){var l=Array.from(o.querySelectorAll("style[".concat(p0,"]")));return l[l.length-1]}(i),s=n!==void 0?n.nextSibling:null;r.setAttribute(p0,hie),r.setAttribute(die,R2);var a=uHe();return a&&r.setAttribute("nonce",a),i.insertBefore(r,s),r},hHe=function(){function e(t){this.element=wie(t),this.element.appendChild(document.createTextNode("")),this.sheet=function(i){if(i.sheet)return i.sheet;for(var r=document.styleSheets,n=0,s=r.length;n<s;n++){var a=r[n];if(a.ownerNode===i)return a}throw lb(17)}(this.element),this.length=0}return e.prototype.insertRule=function(t,i){try{return this.sheet.insertRule(i,t),this.length++,!0}catch{return!1}},e.prototype.deleteRule=function(t){this.sheet.deleteRule(t),this.length--},e.prototype.getRule=function(t){var i=this.sheet.cssRules[t];return i&&i.cssText?i.cssText:""},e}(),dHe=function(){function e(t){this.element=wie(t),this.nodes=this.element.childNodes,this.length=0}return e.prototype.insertRule=function(t,i){if(t<=this.length&&t>=0){var r=document.createTextNode(i);return this.element.insertBefore(r,this.nodes[t]||null),this.length++,!0}return!1},e.prototype.deleteRule=function(t){this.element.removeChild(this.nodes[t]),this.length--},e.prototype.getRule=function(t){return t<this.length?this.nodes[t].textContent:""},e}(),pHe=function(){function e(t){this.rules=[],this.length=0}return e.prototype.insertRule=function(t,i){return t<=this.length&&(this.rules.splice(t,0,i),this.length++,!0)},e.prototype.deleteRule=function(t){this.rules.splice(t,1),this.length--},e.prototype.getRule=function(t){return t<this.length?this.rules[t]:""},e}(),x7=eT,fHe={isServer:!eT,useCSSOMInjection:!GVe},bie=function(){function e(t,i,r){t===void 0&&(t=f0),i===void 0&&(i={});var n=this;this.options=Fa(Fa({},fHe),t),this.gs=i,this.names=new Map(r),this.server=!!t.isServer,!this.server&&eT&&x7&&(x7=!1,y7(this)),HU(this,function(){return function(s){for(var a=s.getTag(),o=a.length,l="",c=function(h){var d=function(m){return tT.get(m)}(h);if(d===void 0)return"continue";var p=s.names.get(d),f=a.getGroup(h);if(p===void 0||!p.size||f.length===0)return"continue";var v="".concat(p0,".g").concat(h,'[id="').concat(d,'"]'),g="";p!==void 0&&p.forEach(function(m){m.length>0&&(g+="".concat(m,","))}),l+="".concat(f).concat(v,'{content:"').concat(g,'"}').concat(FU)},u=0;u<o;u++)c(u);return l}(n)})}return e.registerId=function(t){return GM(t)},e.prototype.rehydrate=function(){!this.server&&eT&&y7(this)},e.prototype.reconstructWithOptions=function(t,i){return i===void 0&&(i=!0),new e(Fa(Fa({},this.options),t),this.gs,i&&this.names||void 0)},e.prototype.allocateGSInstance=function(t){return this.gs[t]=(this.gs[t]||0)+1},e.prototype.getTag=function(){return this.tag||(this.tag=(t=function(i){var r=i.useCSSOMInjection,n=i.target;return i.isServer?new pHe(n):r?new hHe(n):new dHe(n)}(this.options),new nHe(t)));var t},e.prototype.hasNameForId=function(t,i){return this.names.has(t)&&this.names.get(t).has(i)},e.prototype.registerName=function(t,i){if(GM(t),this.names.has(t))this.names.get(t).add(i);else{var r=new Set;r.add(i),this.names.set(t,r)}},e.prototype.insertRules=function(t,i,r){this.registerName(t,i),this.getTag().insertRules(GM(t),r)},e.prototype.clearNames=function(t){this.names.has(t)&&this.names.get(t).clear()},e.prototype.clearRules=function(t){this.getTag().clearGroup(GM(t)),this.clearNames(t)},e.prototype.clearTag=function(){this.tag=void 0},e}(),mHe=/&/g,gHe=/^\s*\/\/.*$/gm;function _ie(e,t){return e.map(function(i){return i.type==="rule"&&(i.value="".concat(t," ").concat(i.value),i.value=i.value.replaceAll(",",",".concat(t," ")),i.props=i.props.map(function(r){return"".concat(t," ").concat(r)})),Array.isArray(i.children)&&i.type!=="@keyframes"&&(i.children=_ie(i.children,t)),i})}function vHe(e){var t,i,r,n=f0,s=n.options,a=s===void 0?f0:s,o=n.plugins,l=o===void 0?I2:o,c=function(d,p,f){return f.startsWith(i)&&f.endsWith(i)&&f.replaceAll(i,"").length>0?".".concat(t):d},u=l.slice();u.push(function(d){d.type===C2&&d.value.includes("&")&&(d.props[0]=d.props[0].replace(mHe,i).replace(r,c))}),a.prefix&&u.push(VVe),u.push(kVe);var h=function(d,p,f,v){p===void 0&&(p=""),f===void 0&&(f=""),v===void 0&&(v="&"),t=v,i=p,r=new RegExp("\\".concat(i,"\\b"),"g");var g=d.replace(gHe,""),m=NVe(f||p?"".concat(f," ").concat(p," { ").concat(g," }"):g);a.namespace&&(m=_ie(m,a.namespace));var x=[];return JC(m,UVe(u.concat(FVe(function(w){return x.push(w)})))),x};return h.hash=l.length?l.reduce(function(d,p){return p.name||lb(15),fv(d,p.name)},fie).toString():"",h}var yHe=new bie,nN=vHe(),Sie=Ci.createContext({shouldForwardProp:void 0,styleSheet:yHe,stylis:nN});Sie.Consumer;Ci.createContext(void 0);function w7(){return qe.useContext(Sie)}var xHe=function(){function e(t,i){var r=this;this.inject=function(n,s){s===void 0&&(s=nN);var a=r.name+s.hash;n.hasNameForId(r.id,a)||n.insertRules(r.id,a,s(r.rules,a,"@keyframes"))},this.name=t,this.id="sc-keyframes-".concat(t),this.rules=i,HU(this,function(){throw lb(12,String(r.name))})}return e.prototype.getName=function(t){return t===void 0&&(t=nN),this.name+t.hash},e}(),wHe=function(e){return e>="A"&&e<="Z"};function b7(e){for(var t="",i=0;i<e.length;i++){var r=e[i];if(i===1&&r==="-"&&e[0]==="-")return e;wHe(r)?t+="-"+r.toLowerCase():t+=r}return t.startsWith("ms-")?"-"+t:t}var Mie=function(e){return e==null||e===!1||e===""},Eie=function(e){var t,i,r=[];for(var n in e){var s=e[n];e.hasOwnProperty(n)&&!Mie(s)&&(Array.isArray(s)&&s.isCss||m0(s)?r.push("".concat(b7(n),":"),s,";"):bw(s)?r.push.apply(r,$C($C(["".concat(n," {")],Eie(s),!1),["}"],!1)):r.push("".concat(b7(n),": ").concat((t=n,(i=s)==null||typeof i=="boolean"||i===""?"":typeof i!="number"||i===0||t in HVe||t.startsWith("--")?String(i).trim():"".concat(i,"px")),";")))}return r};function zf(e,t,i,r){if(Mie(e))return[];if(VU(e))return[".".concat(e.styledComponentId)];if(m0(e)){if(!m0(s=e)||s.prototype&&s.prototype.isReactComponent||!t)return[e];var n=e(t);return zf(n,t,i,r)}var s;return e instanceof xHe?i?(e.inject(i,r),[e.getName(r)]):[e]:bw(e)?Eie(e):Array.isArray(e)?Array.prototype.concat.apply(I2,e.map(function(a){return zf(a,t,i,r)})):[e.toString()]}function bHe(e){for(var t=0;t<e.length;t+=1){var i=e[t];if(m0(i)&&!VU(i))return!1}return!0}var _He=mie(R2),SHe=function(){function e(t,i,r){this.rules=t,this.staticRulesId="",this.isStatic=(r===void 0||r.isStatic)&&bHe(t),this.componentId=i,this.baseHash=fv(_He,i),this.baseStyle=r,bie.registerId(i)}return e.prototype.generateAndInjectStyles=function(t,i,r){var n=this.baseStyle?this.baseStyle.generateAndInjectStyles(t,i,r):"";if(this.isStatic&&!r.hash)if(this.staticRulesId&&i.hasNameForId(this.componentId,this.staticRulesId))n=xf(n,this.staticRulesId);else{var s=v7(zf(this.rules,t,i,r)),a=iN(fv(this.baseHash,s)>>>0);if(!i.hasNameForId(this.componentId,a)){var o=r(s,".".concat(a),void 0,this.componentId);i.insertRules(this.componentId,a,o)}n=xf(n,a),this.staticRulesId=a}else{for(var l=fv(this.baseHash,r.hash),c="",u=0;u<this.rules.length;u++){var h=this.rules[u];if(typeof h=="string")c+=h;else if(h){var d=v7(zf(h,t,i,r));l=fv(l,d+u),c+=d}}if(c){var p=iN(l>>>0);i.hasNameForId(this.componentId,p)||i.insertRules(this.componentId,p,r(c,".".concat(p),void 0,this.componentId)),n=xf(n,p)}}return n},e}(),Aie=Ci.createContext(void 0);Aie.Consumer;var PI={};function MHe(e,t,i){var r=VU(e),n=e,s=!TI(e),a=t.attrs,o=a===void 0?I2:a,l=t.componentId,c=l===void 0?function(_,M){var S=typeof _!="string"?"sc":d7(_);PI[S]=(PI[S]||0)+1;var A="".concat(S,"-").concat(YVe(R2+S+PI[S]));return M?"".concat(M,"-").concat(A):A}(t.displayName,t.parentComponentId):l,u=t.displayName,h=u===void 0?function(_){return TI(_)?"styled.".concat(_):"Styled(".concat(QVe(_),")")}(e):u,d=t.displayName&&t.componentId?"".concat(d7(t.displayName),"-").concat(t.componentId):t.componentId||c,p=r&&n.attrs?n.attrs.concat(o).filter(Boolean):o,f=t.shouldForwardProp;if(r&&n.shouldForwardProp){var v=n.shouldForwardProp;if(t.shouldForwardProp){var g=t.shouldForwardProp;f=function(_,M){return v(_,M)&&g(_,M)}}else f=v}var m=new SHe(i,d,r?n.componentStyle:void 0);function x(_,M){return function(S,A,T){var E=S.attrs,C=S.componentStyle,D=S.defaultProps,I=S.foldedComponentIds,L=S.styledComponentId,z=S.target,F=Ci.useContext(Aie),Q=w7(),Y=S.shouldForwardProp||Q.shouldForwardProp,O=jVe(A,F,D)||f0,j=function(ne,ie,de){for(var be,we=Fa(Fa({},ie),{className:void 0,theme:de}),_e=0;_e<ne.length;_e+=1){var Me=m0(be=ne[_e])?be(we):be;for(var X in Me)we[X]=X==="className"?xf(we[X],Me[X]):X==="style"?Fa(Fa({},we[X]),Me[X]):Me[X]}return ie.className&&(we.className=xf(we.className,ie.className)),we}(E,A,O),V=j.as||z,W={};for(var J in j)j[J]===void 0||J[0]==="$"||J==="as"||J==="theme"&&j.theme===O||(J==="forwardedAs"?W.as=j.forwardedAs:Y&&!Y(J,V)||(W[J]=j[J]));var ce=function(ne,ie){var de=w7(),be=ne.generateAndInjectStyles(ie,de.styleSheet,de.stylis);return be}(C,j),$=xf(I,L);return ce&&($+=" "+ce),j.className&&($+=" "+j.className),W[TI(V)&&!pie.has(V)?"class":"className"]=$,W.ref=T,qe.createElement(V,W)}(w,_,M)}x.displayName=h;var w=Ci.forwardRef(x);return w.attrs=p,w.componentStyle=m,w.displayName=h,w.shouldForwardProp=f,w.foldedComponentIds=r?xf(n.foldedComponentIds,n.styledComponentId):"",w.styledComponentId=d,w.target=r?n.target:e,Object.defineProperty(w,"defaultProps",{get:function(){return this._foldedDefaultProps},set:function(_){this._foldedDefaultProps=r?function(M){for(var S=[],A=1;A<arguments.length;A++)S[A-1]=arguments[A];for(var T=0,E=S;T<E.length;T++)rN(M,E[T],!0);return M}({},n.defaultProps,_):_}}),HU(w,function(){return".".concat(w.styledComponentId)}),s&&xie(w,e,{attrs:!0,componentStyle:!0,displayName:!0,foldedComponentIds:!0,shouldForwardProp:!0,styledComponentId:!0,target:!0}),w}function _7(e,t){for(var i=[e[0]],r=0,n=t.length;r<n;r+=1)i.push(t[r],e[r+1]);return i}var S7=function(e){return Object.assign(e,{isCss:!0})};function EHe(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];if(m0(e)||bw(e))return S7(zf(_7(I2,$C([e],t,!0))));var r=e;return t.length===0&&r.length===1&&typeof r[0]=="string"?zf(r):S7(zf(_7(r,t)))}function sN(e,t,i){if(i===void 0&&(i=f0),!t)throw lb(1,t);var r=function(n){for(var s=[],a=1;a<arguments.length;a++)s[a-1]=arguments[a];return e(t,i,EHe.apply(void 0,$C([n],s,!1)))};return r.attrs=function(n){return sN(e,t,Fa(Fa({},i),{attrs:Array.prototype.concat(i.attrs,n).filter(Boolean)}))},r.withConfig=function(n){return sN(e,t,Fa(Fa({},i),n))},r}var Cie=function(e){return sN(MHe,e)},Tie=Cie;pie.forEach(function(e){Tie[e]=Cie(e)});function d1(){return d1=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},d1.apply(this,arguments)}function AHe(e,t){return t||(t=e.slice(0)),e.raw=t,e}var M7,CHe=Tie.div(M7||(M7=AHe([`
  display: inline-block;
  position: relative;
  svg path {
    opacity: 0.7;
  }
  .sliderHandle {
    width: 50%;
    pointer-events: all;
    position: absolute;
    left: 50%;
    top: 50%;
    transform-origin: 0 50%;
    &:after {
      content: '';
      display: block;
      width: 30px;
      height: 30px;
      border-radius: 30px;
      position: absolute;
      right: 3px;
      background: linear-gradient(to top, #fff, #f2f2f2);
      border: 1px solid #ccc;
      top: -10px;
      transform: all ease 0.4s;
    }
    &:hover:after {
      box-shadow: 0 0 10px rgb(37, 205, 247);
    }
  }
  `,`
`])),function(e){var t=e.overrideStyle;return t}),THe=Math.PI/180,DI=function(t,i){t===void 0&&(t=0);var r=i.max,n=i.min,s=i.arcSize,a=(t-n)/(r-n)*s;return a},E7=function(t,i,r){var n=r.radius,s=r.strokeWidth,a=n-s/2,o=A7(a,t,n),l=A7(a,i,n),c=t<=180?0:1;return"M "+o+" A "+a+" "+a+" 0 "+c+" 0 "+l},A7=function(t,i,r){var n=(i-180)*THe,s=r+t*Math.cos(n),a=r+t*Math.sin(n);return s+" "+a},PHe=function(t,i){var r=t.current.getBoundingClientRect();return{top:r.top+i,left:r.left+i}},C7=function(t,i,r){return t<i&&(t=i),t>r&&(t=r),t},DHe=function(t){return t*(180/Math.PI)},RHe=function(t,i,r){var n=DHe(Math.atan2(t,i))+180-r;return n>360&&(n=n-360),n<0&&(n=360+n),n},T7=function(t,i){var r=i.min,n=i.max,s=i.arcSize,a=t/s*(n-r)+r;return a},IHe="RoundSlider",LHe={color:"purple",bgColor:"#ccc",max:100,min:0,stepSize:0,steps:0,sliced:!0,strokeWidth:35,rotationOffset:0,arcSize:360,value:50,radius:100};function P7(e){var t=d1({},LHe,e),i=SVe(7)(),r=t.color,n=t.bgColor,s=t.max,a=t.min,o=t.steps,l=t.stepSize,c=t.strokeWidth,u=t.radius,h=t.sliced,d=t.style,p=t.arcSize,f=t.rotationOffset,v=t.onAfterChange,g=t.allowClick,m=t.render,x=t.overrideStyle,w=t.onChange,_=qe.useRef(null),M=qe.useRef(null),S=qe.useRef(!1),A=qe.useState({value:t.value,angle:DI(t.value,t)}),T=A[0],E=A[1],C=_Ve(function(W){var J=W.down,ce=W.xy,$=ce[0],ne=ce[1];Y($,ne,J?void 0:function(ie){S.current=J,v&&v(ie,t)})});qe.useEffect(function(){if(t.value!==T.value){var W={value:t.value,angle:DI(t.value,t)};E(W)}},[t.value]);var D=function(J){return E(function(ce){return d1({},ce,J)})},I=T.angle,L=o||(l?Math.floor((s-a)/l):0),z=IHe+"_"+i,F=u*2,Q={transform:"rotate("+f+"deg)",transformOrigin:"50% 50%"},Y=function(J,ce,$){var ne=PHe(_,u),ie=ne.left,de=ne.top,be=J-ie,we=ce-de,_e=V(RHe(we,be,f)),Me=_e.value,X=_e.angle,ge={value:Me,angle:X};D(ge),$&&$(ge),w&&w(Me,t)},O=function(J){if(!S.current){var ce=J.clientX,$=J.clientY,ne=ce,ie=$;ne=ce,ie=$,Y(ne,ie,function(de){v&&v(de,t)})}},j=function(J,ce){var $=t.radius,ne=t.arcSize,ie=ne/J*ce+180,de="rotate("+ie.toString()+","+$+","+$+")";return qe.createElement("g",{key:ce,transform:de},qe.createElement("line",{x1:$,y1:$,x2:$*2,y2:$,style:{stroke:"rgb(0,0,0)",strokeWidth:2}}))},V=function(J){var ce=t.stepSize,$=t.steps,ne=t.min,ie=t.max,de=t.arcSize,be=ce||($?(ie-ne)/$:1),we=T.angle,_e=ne;S.current?_e=T7(we>de-20&&J<de/4?Math.max(J,de):we<20&&J>de-20?Math.min(J,0):J,t):_e=T7(J,t);var Me,X=(_e-ne)%be,ge=_e-X,Oe=C7(ge+be,ne,ie),Ie=C7(ge-be,ne,ie);_e>=ge?Me=_e-ge<Oe-_e?ge:Oe:Me=ge-_e>_e-Ie?ge:Ie,Me=Math.round(Me);var Pe=DI(Me,t);return{value:Me,angle:Pe}};return qe.createElement(CHe,{className:"roundy",onClick:O,overrideStyle:x,style:g||m?d:d1({},d||{},{pointerEvents:"none"})},m?qe.createElement("div",Object.assign({className:"roundyRenderPropsParent",ref:_},C(),{style:{width:F,height:F,display:"inline-block"}}),m(T,t)):qe.createElement(qe.Fragment,null,qe.createElement("svg",{ref:_,width:F,height:F},h&&qe.createElement("defs",null,qe.createElement("mask",{id:z,maskUnits:"userSpaceOnUse",style:Q},qe.createElement("rect",{x:0,y:0,width:F,height:F,fill:"white"}),Array.from({length:L}).map(function(W,J){return j(L,J)}))),qe.createElement("path",{fill:"transparent",strokeDashoffset:"0",strokeWidth:c,stroke:n,mask:h?"url(#"+z+")":void 0,style:Q,d:E7(Math.min(p,359.9999),0,t)}),qe.createElement("path",{fill:"none",strokeWidth:c,stroke:r,mask:h?"url(#"+z+")":void 0,style:Q,d:E7(Math.min(I,359.9999),0,t)})),qe.createElement("div",Object.assign({ref:M,className:"sliderHandle"},C(),{style:{transform:"rotate("+(I+f)+"deg) scaleX(-1)"}}))))}const OHe=e=>{const t=qe.useRef(),i=qe.useRef(!1),r=qe.useRef(!1),[n,s]=Ci.useState(1),[a,o]=Ci.useState(1),[l,c]=Ci.useState(!1);async function u(p){e.setAdditionalAngle(e.additionalAngle+(3*Math.PI/180).toFixed(15)*p),await e.setRotation(e.rotation+1*p)}function h(){setTimeout(()=>{switch(n){case 1:s(2);break;case 2:s(3);break;default:s(1)}c(!0)},200),setTimeout(()=>{switch(a){case 1:o(2);break;case 2:o(3);break;default:o(1)}},200)}const d=qe.useMemo(()=>({u_intensity:{value:.3},u_time:{value:0},u_shader_type:{value:1},u_texture_type:{value:3}}),[]);return zU(p=>{const{clock:f}=p;e.rotation<0&&u(1),e.rotation>0&&u(-1),t.current.material.uniforms.u_time.value=f.getElapsedTime()*e.speed*.01,r.current?(t.current.material.uniforms.u_shader_type.value=n,t.current.material.uniforms.u_texture_type.value=a,l&&(c(!1),r.current=!1),t.current.material.uniforms.u_intensity.value=Bz.lerp(t.current.material.uniforms.u_intensity.value,0,.22)):t.current.material.uniforms.u_intensity.value=Bz.lerp(t.current.material.uniforms.u_intensity.value,i.current?e.intensity*2.3*.01:e.intensity*.01,.06)}),rt.jsxs("mesh",{ref:t,position:[0,0,0],scale:.73,onPointerOver:()=>i.current=!0,onPointerOut:()=>i.current=!1,onClick:()=>{h(),r.current=!0},children:[rt.jsx("sphereGeometry",{args:[2.3,256,256]}),rt.jsx("shaderMaterial",{fragmentShader:F5e,vertexShader:U5e,uniforms:d,wireframe:!1})]})};function zHe(e){const[t,i]=Ci.useState(0),[r,n]=Ci.useState(0),{width:s=300,height:a,ref:o}=k5e();function l(u){e.setSpeedSlider(u),document.querySelector(".round-slider").speedvalue=u}function c(u){e.setProcessingSlider(u),document.querySelector(".round-slider").processingvalue=u}return rt.jsxs("div",{className:"textures-section",children:[rt.jsxs("div",{className:"blob",children:[rt.jsxs(jte,{camera:{position:[0,0,5]},children:[rt.jsx(OHe,{rotation:t,setRotation:i,additionalAngle:r,setAdditionalAngle:n,speed:e.speedSlider,intensity:e.processingSlider}),rt.jsx("ambientLight",{args:[16711680],intensity:.1}),rt.jsx("directionalLight",{position:[0,0,5],intensity:.5}),rt.jsx(Qte,{minPolarAngle:Math.PI/2,maxPolarAngle:Math.PI/2,enableZoom:!1})]}),rt.jsxs("div",{ref:o,className:"round-slider",speedvalue:e.speedSlider,spikesvalue:e.spikesSlider,processingvalue:e.processingSlider,children:[rt.jsx(P7,{className:"round-slider_speed",value:e.speedSlider,min:1,max:100,color:"#FF5733",bgColor:"#7C3C2F",radius:s/2*.8,arcSize:110,rotationOffset:-55,sliced:!1,step:1,strokeWidth:4,thumbSize:1,overrideStyle:"position:absolute; top:50%; left:50%; transform: translateX(-50%) translateY(-50%); .sliderHandle::after{ width:20px; height:10px; right: -9px;}",onChange:l}),rt.jsx(P7,{className:"round-slider_processing",value:e.processingSlider,min:10,max:85,color:"#FF5733",bgColor:"#7C3C2F",radius:s/2*.8,arcSize:110,rotationOffset:125,sliced:!1,step:1,strokeWidth:4,thumbSize:10,overrideStyle:"position:absolute; top:50%; left:50%; transform: translateX(-50%) translateY(-50%);.sliderHandle::after{ width:20px; height:10px; right: -9px;}",onChange:c})]}),rt.jsxs("div",{className:"blob__color-selectors",children:[rt.jsx("div",{className:"blob__color-selector blob__color-selector_multicolor"}),rt.jsx("div",{className:"blob__color-selector blob__color-selector_peach"}),rt.jsx("div",{className:"blob__color-selector blob__color-selector_sea"})]})]}),rt.jsxs("div",{className:"blob-description",children:[rt.jsx("p",{className:"blob-description__texture-name",children:"Some Noize"}),rt.jsxs("p",{className:"blob-description__texture-description",children:["Colors and gradients which a 3D model is wrapped into are fully a work done by fragment shaders.",rt.jsx("br",{}),rt.jsx("br",{}),"Are usually defined considering distortion of object to highlight its volume "]})]}),rt.jsxs("div",{className:"blob-description blob__description_second",children:[rt.jsx("p",{className:"blob-description__texture-name",children:"Some Noize"}),rt.jsx("p",{className:"blob-description__texture-description",children:"Lorem ipsum dolor sit amet consectetur adipisicing elit. Officia totam pariatur, voluptate corporis asperiores non expedita molestiae, soluta iure iusto, recusandae illum repellat? Natus ut cumque enim animi libero unde."})]}),rt.jsx("div",{className:"textures-section__background-circle textures-section__background-circle_one"}),rt.jsx("div",{className:"textures-section__background-circle textures-section__background-circle_two"}),rt.jsx("div",{className:"textures-section__background-circle textures-section__background-circle_three"}),rt.jsx("div",{className:"textures-section__background-circle textures-section__background-circle_four"}),rt.jsx("div",{className:"textures-section__background-circle textures-section__background-circle_five"}),rt.jsx("div",{className:"textures-section__background-circle textures-section__background-circle_small-right-top"})]})}function NHe({active:e,children:t}){let r=0;return rt.jsx(rt.Fragment,{children:rt.jsx("div",{className:"carousel",children:Ci.Children.map(t,(n,s)=>(r+=1,rt.jsx("div",{className:"card-container",style:{"--active":s===e?1:0,"--offset":(e-s)/3,"--direction":e-s,pointerEvents:e===s?"auto":"none",opacity:Math.abs(e-s)>=1?"0":"1",visibility:Math.abs(e-s)>1?"invisible":"visible"},children:n},r)))})})}function BHe({mesh:e,wireframe:t}){const i=Ci.useRef();return zU(({clock:r})=>{const n=r.getElapsedTime()/3;i.current.rotation.y=n/6,i.current.rotation.x=Math.PI/6}),rt.jsxs(rt.Fragment,{children:[rt.jsxs("mesh",{ref:i,position:[0,0,0],children:[e.geometry,rt.jsx("meshStandardMaterial",{wireframe:t,color:"white"})]}),rt.jsx("ambientLight",{args:[16777215],intensity:.35}),rt.jsx("directionalLight",{position:[-5,-5,-5],intensity:.8,color:"#D8A25E"}),rt.jsx("directionalLight",{position:[5,5,5],intensity:.5,color:"#A04747"}),rt.jsx(Qte,{enableZoom:!1})]})}function Pie(e){var t,i,r="";if(typeof e=="string"||typeof e=="number")r+=e;else if(typeof e=="object")if(Array.isArray(e)){var n=e.length;for(t=0;t<n;t++)e[t]&&(i=Pie(e[t]))&&(r&&(r+=" "),r+=i)}else for(i in e)e[i]&&(r&&(r+=" "),r+=i);return r}function Gd(){for(var e,t,i=0,r="",n=arguments.length;i<n;i++)(e=arguments[i])&&(t=Pie(e))&&(r&&(r+=" "),r+=t);return r}function kHe(e,t,i=void 0){const r={};for(const n in e){const s=e[n];let a="";for(let o=0;o<s.length;o+=1){const l=s[o];l&&(a+=t(l)+" ",i&&i[l]&&(a+=i[l]+" "))}r[n]=a}return r}function $f(e){let t="https://mui.com/production-error/?code="+e;for(let i=1;i<arguments.length;i+=1)t+="&args[]="+encodeURIComponent(arguments[i]);return"Minified MUI error #"+e+"; visit "+t+" for the full message."}function Hg(e,t=Number.MIN_SAFE_INTEGER,i=Number.MAX_SAFE_INTEGER){return Math.max(t,Math.min(e,i))}function GU(e,t=0,i=1){return Hg(e,t,i)}function UHe(e){e=e.slice(1);const t=new RegExp(`.{1,${e.length>=6?2:1}}`,"g");let i=e.match(t);return i&&i[0].length===1&&(i=i.map(r=>r+r)),i?`rgb${i.length===4?"a":""}(${i.map((r,n)=>n<3?parseInt(r,16):Math.round(parseInt(r,16)/255*1e3)/1e3).join(", ")})`:""}function $d(e){if(e.type)return e;if(e.charAt(0)==="#")return $d(UHe(e));const t=e.indexOf("("),i=e.substring(0,t);if(!["rgb","rgba","hsl","hsla","color"].includes(i))throw new Error($f(9,e));let r=e.substring(t+1,e.length-1),n;if(i==="color"){if(r=r.split(" "),n=r.shift(),r.length===4&&r[3].charAt(0)==="/"&&(r[3]=r[3].slice(1)),!["srgb","display-p3","a98-rgb","prophoto-rgb","rec-2020"].includes(n))throw new Error($f(10,n))}else r=r.split(",");return r=r.map(s=>parseFloat(s)),{type:i,values:r,colorSpace:n}}const FHe=e=>{const t=$d(e);return t.values.slice(0,3).map((i,r)=>t.type.includes("hsl")&&r!==0?`${i}%`:i).join(" ")},Rx=(e,t)=>{try{return FHe(e)}catch{return e}};function L2(e){const{type:t,colorSpace:i}=e;let{values:r}=e;return t.includes("rgb")?r=r.map((n,s)=>s<3?parseInt(n,10):n):t.includes("hsl")&&(r[1]=`${r[1]}%`,r[2]=`${r[2]}%`),t.includes("color")?r=`${i} ${r.join(" ")}`:r=`${r.join(", ")}`,`${t}(${r})`}function Die(e){e=$d(e);const{values:t}=e,i=t[0],r=t[1]/100,n=t[2]/100,s=r*Math.min(n,1-n),a=(c,u=(c+i/30)%12)=>n-s*Math.max(Math.min(u-3,9-u,1),-1);let o="rgb";const l=[Math.round(a(0)*255),Math.round(a(8)*255),Math.round(a(4)*255)];return e.type==="hsla"&&(o+="a",l.push(t[3])),L2({type:o,values:l})}function aN(e){e=$d(e);let t=e.type==="hsl"||e.type==="hsla"?$d(Die(e)).values:e.values;return t=t.map(i=>(e.type!=="color"&&(i/=255),i<=.03928?i/12.92:((i+.055)/1.055)**2.4)),Number((.2126*t[0]+.7152*t[1]+.0722*t[2]).toFixed(3))}function VHe(e,t){const i=aN(e),r=aN(t);return(Math.max(i,r)+.05)/(Math.min(i,r)+.05)}function oN(e,t){return e=$d(e),t=GU(t),(e.type==="rgb"||e.type==="hsl")&&(e.type+="a"),e.type==="color"?e.values[3]=`/${t}`:e.values[3]=t,L2(e)}function jM(e,t,i){try{return oN(e,t)}catch{return e}}function _w(e,t){if(e=$d(e),t=GU(t),e.type.includes("hsl"))e.values[2]*=1-t;else if(e.type.includes("rgb")||e.type.includes("color"))for(let i=0;i<3;i+=1)e.values[i]*=1-t;return L2(e)}function fr(e,t,i){try{return _w(e,t)}catch{return e}}function Sw(e,t){if(e=$d(e),t=GU(t),e.type.includes("hsl"))e.values[2]+=(100-e.values[2])*t;else if(e.type.includes("rgb"))for(let i=0;i<3;i+=1)e.values[i]+=(255-e.values[i])*t;else if(e.type.includes("color"))for(let i=0;i<3;i+=1)e.values[i]+=(1-e.values[i])*t;return L2(e)}function mr(e,t,i){try{return Sw(e,t)}catch{return e}}function HHe(e,t=.15){return aN(e)>.5?_w(e,t):Sw(e,t)}function WM(e,t,i){try{return HHe(e,t)}catch{return e}}const GHe=qe.createContext(),jHe=()=>qe.useContext(GHe)??!1;function WHe(e,t){typeof e=="function"?e(t):e&&(e.current=t)}function Rie(...e){return qe.useMemo(()=>e.every(t=>t==null)?null:t=>{e.forEach(i=>{WHe(i,t)})},e)}function XHe(e){return typeof e=="string"}function qHe(e,t,i){return e===void 0||XHe(e)?t:{...t,ownerState:{...t.ownerState,...i}}}function BE(e,t=[]){if(e===void 0)return{};const i={};return Object.keys(e).filter(r=>r.match(/^on[A-Z]/)&&typeof e[r]=="function"&&!t.includes(r)).forEach(r=>{i[r]=e[r]}),i}function D7(e){if(e===void 0)return{};const t={};return Object.keys(e).filter(i=>!(i.match(/^on[A-Z]/)&&typeof e[i]=="function")).forEach(i=>{t[i]=e[i]}),t}function YHe(e){const{getSlotProps:t,additionalProps:i,externalSlotProps:r,externalForwardedProps:n,className:s}=e;if(!t){const p=Gd(i==null?void 0:i.className,s,n==null?void 0:n.className,r==null?void 0:r.className),f={...i==null?void 0:i.style,...n==null?void 0:n.style,...r==null?void 0:r.style},v={...i,...n,...r};return p.length>0&&(v.className=p),Object.keys(f).length>0&&(v.style=f),{props:v,internalRef:void 0}}const a=BE({...n,...r}),o=D7(r),l=D7(n),c=t(a),u=Gd(c==null?void 0:c.className,i==null?void 0:i.className,s,n==null?void 0:n.className,r==null?void 0:r.className),h={...c==null?void 0:c.style,...i==null?void 0:i.style,...n==null?void 0:n.style,...r==null?void 0:r.style},d={...c,...i,...l,...o};return u.length>0&&(d.className=u),Object.keys(h).length>0&&(d.style=h),{props:d,internalRef:c.ref}}function QHe(e,t,i){return typeof e=="function"?e(t,i):e}function sd(e){var h;const{elementType:t,externalSlotProps:i,ownerState:r,skipResolvingSlotProps:n=!1,...s}=e,a=n?{}:QHe(i,r),{props:o,internalRef:l}=YHe({...s,externalSlotProps:a}),c=Rie(l,a==null?void 0:a.ref,(h=e.additionalProps)==null?void 0:h.ref);return qHe(t,{...o,ref:c},r)}function Gu(e){if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)}function Iie(e){if(!Gu(e))return e;const t={};return Object.keys(e).forEach(i=>{t[i]=Iie(e[i])}),t}function fo(e,t,i={clone:!0}){const r=i.clone?{...e}:e;return Gu(e)&&Gu(t)&&Object.keys(t).forEach(n=>{Gu(t[n])&&Object.prototype.hasOwnProperty.call(e,n)&&Gu(e[n])?r[n]=fo(e[n],t[n],i):i.clone?r[n]=Gu(t[n])?Iie(t[n]):t[n]:r[n]=t[n]}),r}function zc(e){if(typeof e!="string")throw new Error($f(7));return e.charAt(0).toUpperCase()+e.slice(1)}function kE(e){return e&&e.ownerDocument||document}const Lie=typeof window<"u"?qe.useLayoutEffect:qe.useEffect;function KHe({controlled:e,default:t,name:i,state:r="value"}){const{current:n}=qe.useRef(e!==void 0),[s,a]=qe.useState(t),o=n?e:s,l=qe.useCallback(c=>{n||a(c)},[]);return[o,l]}function RI(e){const t=qe.useRef(e);return Lie(()=>{t.current=e}),qe.useRef((...i)=>(0,t.current)(...i)).current}function R7(e){try{return e.matches(":focus-visible")}catch{}return!1}const ZHe={border:0,clip:"rect(0 0 0 0)",height:"1px",margin:"-1px",overflow:"hidden",padding:0,position:"absolute",whiteSpace:"nowrap",width:"1px"};function lN(e,t){const i={...t};for(const r in e)if(Object.prototype.hasOwnProperty.call(e,r)){const n=r;if(n==="components"||n==="slots")i[n]={...e[n],...i[n]};else if(n==="componentsProps"||n==="slotProps"){const s=e[n],a=t[n];if(!a)i[n]=s||{};else if(!s)i[n]=a;else{i[n]={...a};for(const o in s)if(Object.prototype.hasOwnProperty.call(s,o)){const l=o;i[n][l]=lN(s[l],a[l])}}}else i[n]===void 0&&(i[n]=e[n])}return i}const I7=e=>e,$He=()=>{let e=I7;return{configure(t){e=t},generate(t){return e(t)},reset(){e=I7}}},JHe=$He(),eGe={active:"active",checked:"checked",completed:"completed",disabled:"disabled",error:"error",expanded:"expanded",focused:"focused",focusVisible:"focusVisible",open:"open",readOnly:"readOnly",required:"required",selected:"selected"};function Oie(e,t,i="Mui"){const r=eGe[t];return r?`${i}-${r}`:`${JHe.generate(e)}-${t}`}function tGe(e,t,i="Mui"){const r={};return t.forEach(n=>{r[n]=Oie(e,n,i)}),r}function iGe(e,t,i=(r,n)=>r===n){return e.length===t.length&&e.every((r,n)=>i(r,t[n]))}const rGe=2;function zie(e,t){return e-t}function L7(e,t){const{index:i}=e.reduce((r,n,s)=>{const a=Math.abs(t-n);return r===null||a<r.distance||a===r.distance?{distance:a,index:s}:r},null)??{};return i}function XM(e,t){if(t.current!==void 0&&e.changedTouches){const i=e;for(let r=0;r<i.changedTouches.length;r+=1){const n=i.changedTouches[r];if(n.identifier===t.current)return{x:n.clientX,y:n.clientY}}return!1}return{x:e.clientX,y:e.clientY}}function iT(e,t,i){return(e-t)*100/(i-t)}function nGe(e,t,i){return(i-t)*e+t}function sGe(e){if(Math.abs(e)<1){const i=e.toExponential().split("e-"),r=i[0].split(".")[1];return(r?r.length:0)+parseInt(i[1],10)}const t=e.toString().split(".")[1];return t?t.length:0}function aGe(e,t,i){const r=Math.round((e-i)/t)*t+i;return Number(r.toFixed(sGe(t)))}function O7({values:e,newValue:t,index:i}){const r=e.slice();return r[i]=t,r.sort(zie)}function qM({sliderRef:e,activeIndex:t,setActive:i}){var n,s,a;const r=kE(e.current);(!((n=e.current)!=null&&n.contains(r.activeElement))||Number((s=r==null?void 0:r.activeElement)==null?void 0:s.getAttribute("data-index"))!==t)&&((a=e.current)==null||a.querySelector(`[type="range"][data-index="${t}"]`).focus()),i&&i(t)}function YM(e,t){return typeof e=="number"&&typeof t=="number"?e===t:typeof e=="object"&&typeof t=="object"?iGe(e,t):!1}const oGe={horizontal:{offset:e=>({left:`${e}%`}),leap:e=>({width:`${e}%`})},"horizontal-reverse":{offset:e=>({right:`${e}%`}),leap:e=>({width:`${e}%`})},vertical:{offset:e=>({bottom:`${e}%`}),leap:e=>({height:`${e}%`})}},lGe=e=>e;let QM;function z7(){return QM===void 0&&(typeof CSS<"u"&&typeof CSS.supports=="function"?QM=CSS.supports("touch-action","none"):QM=!0),QM}function cGe(e){const{"aria-labelledby":t,defaultValue:i,disabled:r=!1,disableSwap:n=!1,isRtl:s=!1,marks:a=!1,max:o=100,min:l=0,name:c,onChange:u,onChangeCommitted:h,orientation:d="horizontal",rootRef:p,scale:f=lGe,step:v=1,shiftStep:g=10,tabIndex:m,value:x}=e,w=qe.useRef(void 0),[_,M]=qe.useState(-1),[S,A]=qe.useState(-1),[T,E]=qe.useState(!1),C=qe.useRef(0),[D,I]=KHe({controlled:x,default:i??l,name:"Slider"}),L=u&&((k,re,he)=>{const G=k.nativeEvent||k,Te=new G.constructor(G.type,G);Object.defineProperty(Te,"target",{writable:!0,value:{value:re,name:c}}),u(Te,re,he)}),z=Array.isArray(D);let F=z?D.slice().sort(zie):[D];F=F.map(k=>k==null?l:Hg(k,l,o));const Q=a===!0&&v!==null?[...Array(Math.floor((o-l)/v)+1)].map((k,re)=>({value:l+v*re})):a||[],Y=Q.map(k=>k.value),[O,j]=qe.useState(-1),V=qe.useRef(null),W=Rie(p,V),J=k=>re=>{var G;const he=Number(re.currentTarget.getAttribute("data-index"));R7(re.target)&&j(he),A(he),(G=k==null?void 0:k.onFocus)==null||G.call(k,re)},ce=k=>re=>{var he;R7(re.target)||j(-1),A(-1),(he=k==null?void 0:k.onBlur)==null||he.call(k,re)},$=(k,re)=>{const he=Number(k.currentTarget.getAttribute("data-index")),G=F[he],Te=Y.indexOf(G);let ze=re;if(Q&&v==null){const Qe=Y[Y.length-1];ze>Qe?ze=Qe:ze<Y[0]?ze=Y[0]:ze=ze<G?Y[Te-1]:Y[Te+1]}if(ze=Hg(ze,l,o),z){n&&(ze=Hg(ze,F[he-1]||-1/0,F[he+1]||1/0));const Qe=ze;ze=O7({values:F,newValue:ze,index:he});let ye=he;n||(ye=ze.indexOf(Qe)),qM({sliderRef:V,activeIndex:ye})}I(ze),j(he),L&&!YM(ze,D)&&L(k,ze,he),h&&h(k,ze)},ne=k=>re=>{var he;if(v!==null){const G=Number(re.currentTarget.getAttribute("data-index")),Te=F[G];let ze=null;(re.key==="ArrowLeft"||re.key==="ArrowDown")&&re.shiftKey||re.key==="PageDown"?ze=Math.max(Te-g,l):((re.key==="ArrowRight"||re.key==="ArrowUp")&&re.shiftKey||re.key==="PageUp")&&(ze=Math.min(Te+g,o)),ze!==null&&($(re,ze),re.preventDefault())}(he=k==null?void 0:k.onKeyDown)==null||he.call(k,re)};Lie(()=>{var k;r&&V.current.contains(document.activeElement)&&((k=document.activeElement)==null||k.blur())},[r]),r&&_!==-1&&M(-1),r&&O!==-1&&j(-1);const ie=k=>re=>{var he;(he=k.onChange)==null||he.call(k,re),$(re,re.target.valueAsNumber)},de=qe.useRef(void 0);let be=d;s&&d==="horizontal"&&(be+="-reverse");const we=({finger:k,move:re=!1})=>{const{current:he}=V,{width:G,height:Te,bottom:ze,left:Qe}=he.getBoundingClientRect();let ye;be.indexOf("vertical")===0?ye=(ze-k.y)/Te:ye=(k.x-Qe)/G,be.indexOf("-reverse")!==-1&&(ye=1-ye);let je;if(je=nGe(ye,l,o),v)je=aGe(je,v,l);else{const ct=L7(Y,je);je=Y[ct]}je=Hg(je,l,o);let nt=0;if(z){re?nt=de.current:nt=L7(F,je),n&&(je=Hg(je,F[nt-1]||-1/0,F[nt+1]||1/0));const ct=je;je=O7({values:F,newValue:je,index:nt}),n&&re||(nt=je.indexOf(ct),de.current=nt)}return{newValue:je,activeIndex:nt}},_e=RI(k=>{const re=XM(k,w);if(!re)return;if(C.current+=1,k.type==="mousemove"&&k.buttons===0){Me(k);return}const{newValue:he,activeIndex:G}=we({finger:re,move:!0});qM({sliderRef:V,activeIndex:G,setActive:M}),I(he),!T&&C.current>rGe&&E(!0),L&&!YM(he,D)&&L(k,he,G)}),Me=RI(k=>{const re=XM(k,w);if(E(!1),!re)return;const{newValue:he}=we({finger:re,move:!0});M(-1),k.type==="touchend"&&A(-1),h&&h(k,he),w.current=void 0,ge()}),X=RI(k=>{if(r)return;z7()||k.preventDefault();const re=k.changedTouches[0];re!=null&&(w.current=re.identifier);const he=XM(k,w);if(he!==!1){const{newValue:Te,activeIndex:ze}=we({finger:he});qM({sliderRef:V,activeIndex:ze,setActive:M}),I(Te),L&&!YM(Te,D)&&L(k,Te,ze)}C.current=0;const G=kE(V.current);G.addEventListener("touchmove",_e,{passive:!0}),G.addEventListener("touchend",Me,{passive:!0})}),ge=qe.useCallback(()=>{const k=kE(V.current);k.removeEventListener("mousemove",_e),k.removeEventListener("mouseup",Me),k.removeEventListener("touchmove",_e),k.removeEventListener("touchend",Me)},[Me,_e]);qe.useEffect(()=>{const{current:k}=V;return k.addEventListener("touchstart",X,{passive:z7()}),()=>{k.removeEventListener("touchstart",X),ge()}},[ge,X]),qe.useEffect(()=>{r&&ge()},[r,ge]);const Oe=k=>re=>{var Te;if((Te=k.onMouseDown)==null||Te.call(k,re),r||re.defaultPrevented||re.button!==0)return;re.preventDefault();const he=XM(re,w);if(he!==!1){const{newValue:ze,activeIndex:Qe}=we({finger:he});qM({sliderRef:V,activeIndex:Qe,setActive:M}),I(ze),L&&!YM(ze,D)&&L(re,ze,Qe)}C.current=0;const G=kE(V.current);G.addEventListener("mousemove",_e,{passive:!0}),G.addEventListener("mouseup",Me)},Ie=iT(z?F[0]:l,l,o),Pe=iT(F[F.length-1],l,o)-Ie,Ye=(k={})=>{const re=BE(k),he={onMouseDown:Oe(re||{})},G={...re,...he};return{...k,ref:W,...G}},ke=k=>re=>{var G;(G=k.onMouseOver)==null||G.call(k,re);const he=Number(re.currentTarget.getAttribute("data-index"));A(he)},Fe=k=>re=>{var he;(he=k.onMouseLeave)==null||he.call(k,re),A(-1)};return{active:_,axis:be,axisProps:oGe,dragging:T,focusedThumbIndex:O,getHiddenInputProps:(k={})=>{const re=BE(k),he={onChange:ie(re||{}),onFocus:J(re||{}),onBlur:ce(re||{}),onKeyDown:ne(re||{})},G={...re,...he};return{tabIndex:m,"aria-labelledby":t,"aria-orientation":d,"aria-valuemax":f(o),"aria-valuemin":f(l),name:c,type:"range",min:e.min,max:e.max,step:e.step===null&&e.marks?"any":e.step??void 0,disabled:r,...k,...G,style:{...ZHe,direction:s?"rtl":"ltr",width:"100%",height:"100%"}}},getRootProps:Ye,getThumbProps:(k={})=>{const re=BE(k),he={onMouseOver:ke(re||{}),onMouseLeave:Fe(re||{})};return{...k,...re,...he}},marks:Q,open:S,range:z,rootRef:W,trackLeap:Pe,trackOffset:Ie,values:F,getThumbStyle:k=>({pointerEvents:_!==-1&&_!==k?"none":void 0})}}function UE(e){return typeof e=="string"}function p1(e,t){return t?fo(e,t,{clone:!1}):e}function uGe(e,t){if(!e.containerQueries)return t;const i=Object.keys(t).filter(r=>r.startsWith("@container")).sort((r,n)=>{var a,o;const s=/min-width:\s*([0-9.]+)/;return+(((a=r.match(s))==null?void 0:a[1])||0)-+(((o=n.match(s))==null?void 0:o[1])||0)});return i.length?i.reduce((r,n)=>{const s=t[n];return delete r[n],r[n]=s,r},{...t}):t}function hGe(e,t){return t==="@"||t.startsWith("@")&&(e.some(i=>t.startsWith(`@${i}`))||!!t.match(/^@\d/))}function dGe(e,t){const i=t.match(/^@([^/]+)?\/?(.+)?$/);if(!i)return null;const[,r,n]=i,s=Number.isNaN(+r)?r||0:+r;return e.containerQueries(n).up(s)}function pGe(e){const t=(s,a)=>s.replace("@media",a?`@container ${a}`:"@container");function i(s,a){s.up=(...o)=>t(e.breakpoints.up(...o),a),s.down=(...o)=>t(e.breakpoints.down(...o),a),s.between=(...o)=>t(e.breakpoints.between(...o),a),s.only=(...o)=>t(e.breakpoints.only(...o),a),s.not=(...o)=>{const l=t(e.breakpoints.not(...o),a);return l.includes("not all and")?l.replace("not all and ","").replace("min-width:","width<").replace("max-width:","width>").replace("and","or"):l}}const r={},n=s=>(i(r,s),r);return i(n),{...e,containerQueries:n}}const O2={xs:0,sm:600,md:900,lg:1200,xl:1536},N7={keys:["xs","sm","md","lg","xl"],up:e=>`@media (min-width:${O2[e]}px)`},fGe={containerQueries:e=>({up:t=>{let i=typeof t=="number"?t:O2[t]||t;return typeof i=="number"&&(i=`${i}px`),e?`@container ${e} (min-width:${i})`:`@container (min-width:${i})`}})};function wh(e,t,i){const r=e.theme||{};if(Array.isArray(t)){const s=r.breakpoints||N7;return t.reduce((a,o,l)=>(a[s.up(s.keys[l])]=i(t[l]),a),{})}if(typeof t=="object"){const s=r.breakpoints||N7;return Object.keys(t).reduce((a,o)=>{if(hGe(s.keys,o)){const l=dGe(r.containerQueries?r:fGe,o);l&&(a[l]=i(t[o],o))}else if(Object.keys(s.values||O2).includes(o)){const l=s.up(o);a[l]=i(t[o],o)}else{const l=o;a[l]=t[l]}return a},{})}return i(t)}function mGe(e={}){var i;return((i=e.keys)==null?void 0:i.reduce((r,n)=>{const s=e.up(n);return r[s]={},r},{}))||{}}function gGe(e,t){return e.reduce((i,r)=>{const n=i[r];return(!n||Object.keys(n).length===0)&&delete i[r],i},t)}function z2(e,t,i=!0){if(!t||typeof t!="string")return null;if(e&&e.vars&&i){const r=`vars.${t}`.split(".").reduce((n,s)=>n&&n[s]?n[s]:null,e);if(r!=null)return r}return t.split(".").reduce((r,n)=>r&&r[n]!=null?r[n]:null,e)}function rT(e,t,i,r=i){let n;return typeof e=="function"?n=e(i):Array.isArray(e)?n=e[i]||r:n=z2(e,i)||r,t&&(n=t(n,r,e)),n}function hn(e){const{prop:t,cssProperty:i=e.prop,themeKey:r,transform:n}=e,s=a=>{if(a[t]==null)return null;const o=a[t],l=a.theme,c=z2(l,r)||{};return wh(a,o,h=>{let d=rT(c,n,h);return h===d&&typeof h=="string"&&(d=rT(c,n,`${t}${h==="default"?"":zc(h)}`,h)),i===!1?d:{[i]:d}})};return s.propTypes={},s.filterProps=[t],s}function vGe(e){const t={};return i=>(t[i]===void 0&&(t[i]=e(i)),t[i])}const yGe={m:"margin",p:"padding"},xGe={t:"Top",r:"Right",b:"Bottom",l:"Left",x:["Left","Right"],y:["Top","Bottom"]},B7={marginX:"mx",marginY:"my",paddingX:"px",paddingY:"py"},wGe=vGe(e=>{if(e.length>2)if(B7[e])e=B7[e];else return[e];const[t,i]=e.split(""),r=yGe[t],n=xGe[i]||"";return Array.isArray(n)?n.map(s=>r+s):[r+n]}),jU=["m","mt","mr","mb","ml","mx","my","margin","marginTop","marginRight","marginBottom","marginLeft","marginX","marginY","marginInline","marginInlineStart","marginInlineEnd","marginBlock","marginBlockStart","marginBlockEnd"],WU=["p","pt","pr","pb","pl","px","py","padding","paddingTop","paddingRight","paddingBottom","paddingLeft","paddingX","paddingY","paddingInline","paddingInlineStart","paddingInlineEnd","paddingBlock","paddingBlockStart","paddingBlockEnd"];[...jU,...WU];function cb(e,t,i,r){const n=z2(e,t,!0)??i;return typeof n=="number"||typeof n=="string"?s=>typeof s=="string"?s:typeof n=="string"?`calc(${s} * ${n})`:n*s:Array.isArray(n)?s=>{if(typeof s=="string")return s;const a=Math.abs(s),o=n[a];return s>=0?o:typeof o=="number"?-o:`-${o}`}:typeof n=="function"?n:()=>{}}function XU(e){return cb(e,"spacing",8)}function ub(e,t){return typeof t=="string"||t==null?t:e(t)}function bGe(e,t){return i=>e.reduce((r,n)=>(r[n]=ub(t,i),r),{})}function _Ge(e,t,i,r){if(!t.includes(i))return null;const n=wGe(i),s=bGe(n,r),a=e[i];return wh(e,a,s)}function Nie(e,t){const i=XU(e.theme);return Object.keys(e).map(r=>_Ge(e,t,r,i)).reduce(p1,{})}function jr(e){return Nie(e,jU)}jr.propTypes={};jr.filterProps=jU;function Wr(e){return Nie(e,WU)}Wr.propTypes={};Wr.filterProps=WU;function N2(...e){const t=e.reduce((r,n)=>(n.filterProps.forEach(s=>{r[s]=n}),r),{}),i=r=>Object.keys(r).reduce((n,s)=>t[s]?p1(n,t[s](r)):n,{});return i.propTypes={},i.filterProps=e.reduce((r,n)=>r.concat(n.filterProps),[]),i}function Xo(e){return typeof e!="number"?e:`${e}px solid`}function al(e,t){return hn({prop:e,themeKey:"borders",transform:t})}const SGe=al("border",Xo),MGe=al("borderTop",Xo),EGe=al("borderRight",Xo),AGe=al("borderBottom",Xo),CGe=al("borderLeft",Xo),TGe=al("borderColor"),PGe=al("borderTopColor"),DGe=al("borderRightColor"),RGe=al("borderBottomColor"),IGe=al("borderLeftColor"),LGe=al("outline",Xo),OGe=al("outlineColor"),B2=e=>{if(e.borderRadius!==void 0&&e.borderRadius!==null){const t=cb(e.theme,"shape.borderRadius",4),i=r=>({borderRadius:ub(t,r)});return wh(e,e.borderRadius,i)}return null};B2.propTypes={};B2.filterProps=["borderRadius"];N2(SGe,MGe,EGe,AGe,CGe,TGe,PGe,DGe,RGe,IGe,B2,LGe,OGe);const k2=e=>{if(e.gap!==void 0&&e.gap!==null){const t=cb(e.theme,"spacing",8),i=r=>({gap:ub(t,r)});return wh(e,e.gap,i)}return null};k2.propTypes={};k2.filterProps=["gap"];const U2=e=>{if(e.columnGap!==void 0&&e.columnGap!==null){const t=cb(e.theme,"spacing",8),i=r=>({columnGap:ub(t,r)});return wh(e,e.columnGap,i)}return null};U2.propTypes={};U2.filterProps=["columnGap"];const F2=e=>{if(e.rowGap!==void 0&&e.rowGap!==null){const t=cb(e.theme,"spacing",8),i=r=>({rowGap:ub(t,r)});return wh(e,e.rowGap,i)}return null};F2.propTypes={};F2.filterProps=["rowGap"];const zGe=hn({prop:"gridColumn"}),NGe=hn({prop:"gridRow"}),BGe=hn({prop:"gridAutoFlow"}),kGe=hn({prop:"gridAutoColumns"}),UGe=hn({prop:"gridAutoRows"}),FGe=hn({prop:"gridTemplateColumns"}),VGe=hn({prop:"gridTemplateRows"}),HGe=hn({prop:"gridTemplateAreas"}),GGe=hn({prop:"gridArea"});N2(k2,U2,F2,zGe,NGe,BGe,kGe,UGe,FGe,VGe,HGe,GGe);function Nv(e,t){return t==="grey"?t:e}const jGe=hn({prop:"color",themeKey:"palette",transform:Nv}),WGe=hn({prop:"bgcolor",cssProperty:"backgroundColor",themeKey:"palette",transform:Nv}),XGe=hn({prop:"backgroundColor",themeKey:"palette",transform:Nv});N2(jGe,WGe,XGe);function lo(e){return e<=1&&e!==0?`${e*100}%`:e}const qGe=hn({prop:"width",transform:lo}),qU=e=>{if(e.maxWidth!==void 0&&e.maxWidth!==null){const t=i=>{var n,s,a,o,l;const r=((a=(s=(n=e.theme)==null?void 0:n.breakpoints)==null?void 0:s.values)==null?void 0:a[i])||O2[i];return r?((l=(o=e.theme)==null?void 0:o.breakpoints)==null?void 0:l.unit)!=="px"?{maxWidth:`${r}${e.theme.breakpoints.unit}`}:{maxWidth:r}:{maxWidth:lo(i)}};return wh(e,e.maxWidth,t)}return null};qU.filterProps=["maxWidth"];const YGe=hn({prop:"minWidth",transform:lo}),QGe=hn({prop:"height",transform:lo}),KGe=hn({prop:"maxHeight",transform:lo}),ZGe=hn({prop:"minHeight",transform:lo});hn({prop:"size",cssProperty:"width",transform:lo});hn({prop:"size",cssProperty:"height",transform:lo});const $Ge=hn({prop:"boxSizing"});N2(qGe,qU,YGe,QGe,KGe,ZGe,$Ge);const V2={border:{themeKey:"borders",transform:Xo},borderTop:{themeKey:"borders",transform:Xo},borderRight:{themeKey:"borders",transform:Xo},borderBottom:{themeKey:"borders",transform:Xo},borderLeft:{themeKey:"borders",transform:Xo},borderColor:{themeKey:"palette"},borderTopColor:{themeKey:"palette"},borderRightColor:{themeKey:"palette"},borderBottomColor:{themeKey:"palette"},borderLeftColor:{themeKey:"palette"},outline:{themeKey:"borders",transform:Xo},outlineColor:{themeKey:"palette"},borderRadius:{themeKey:"shape.borderRadius",style:B2},color:{themeKey:"palette",transform:Nv},bgcolor:{themeKey:"palette",cssProperty:"backgroundColor",transform:Nv},backgroundColor:{themeKey:"palette",transform:Nv},p:{style:Wr},pt:{style:Wr},pr:{style:Wr},pb:{style:Wr},pl:{style:Wr},px:{style:Wr},py:{style:Wr},padding:{style:Wr},paddingTop:{style:Wr},paddingRight:{style:Wr},paddingBottom:{style:Wr},paddingLeft:{style:Wr},paddingX:{style:Wr},paddingY:{style:Wr},paddingInline:{style:Wr},paddingInlineStart:{style:Wr},paddingInlineEnd:{style:Wr},paddingBlock:{style:Wr},paddingBlockStart:{style:Wr},paddingBlockEnd:{style:Wr},m:{style:jr},mt:{style:jr},mr:{style:jr},mb:{style:jr},ml:{style:jr},mx:{style:jr},my:{style:jr},margin:{style:jr},marginTop:{style:jr},marginRight:{style:jr},marginBottom:{style:jr},marginLeft:{style:jr},marginX:{style:jr},marginY:{style:jr},marginInline:{style:jr},marginInlineStart:{style:jr},marginInlineEnd:{style:jr},marginBlock:{style:jr},marginBlockStart:{style:jr},marginBlockEnd:{style:jr},displayPrint:{cssProperty:!1,transform:e=>({"@media print":{display:e}})},display:{},overflow:{},textOverflow:{},visibility:{},whiteSpace:{},flexBasis:{},flexDirection:{},flexWrap:{},justifyContent:{},alignItems:{},alignContent:{},order:{},flex:{},flexGrow:{},flexShrink:{},alignSelf:{},justifyItems:{},justifySelf:{},gap:{style:k2},rowGap:{style:F2},columnGap:{style:U2},gridColumn:{},gridRow:{},gridAutoFlow:{},gridAutoColumns:{},gridAutoRows:{},gridTemplateColumns:{},gridTemplateRows:{},gridTemplateAreas:{},gridArea:{},position:{},zIndex:{themeKey:"zIndex"},top:{},right:{},bottom:{},left:{},boxShadow:{themeKey:"shadows"},width:{transform:lo},maxWidth:{style:qU},minWidth:{transform:lo},height:{transform:lo},maxHeight:{transform:lo},minHeight:{transform:lo},boxSizing:{},font:{themeKey:"font"},fontFamily:{themeKey:"typography"},fontSize:{themeKey:"typography"},fontStyle:{themeKey:"typography"},fontWeight:{themeKey:"typography"},letterSpacing:{},textTransform:{},lineHeight:{},textAlign:{},typography:{cssProperty:!1,themeKey:"typography"}};function JGe(...e){const t=e.reduce((r,n)=>r.concat(Object.keys(n)),[]),i=new Set(t);return e.every(r=>i.size===Object.keys(r).length)}function e6e(e,t){return typeof e=="function"?e(t):e}function t6e(){function e(i,r,n,s){const a={[i]:r,theme:n},o=s[i];if(!o)return{[i]:r};const{cssProperty:l=i,themeKey:c,transform:u,style:h}=o;if(r==null)return null;if(c==="typography"&&r==="inherit")return{[i]:r};const d=z2(n,c)||{};return h?h(a):wh(a,r,f=>{let v=rT(d,u,f);return f===v&&typeof f=="string"&&(v=rT(d,u,`${i}${f==="default"?"":zc(f)}`,f)),l===!1?v:{[l]:v}})}function t(i){const{sx:r,theme:n={}}=i||{};if(!r)return null;const s=n.unstable_sxConfig??V2;function a(o){let l=o;if(typeof o=="function")l=o(n);else if(typeof o!="object")return o;if(!l)return null;const c=mGe(n.breakpoints),u=Object.keys(c);let h=c;return Object.keys(l).forEach(d=>{const p=e6e(l[d],n);if(p!=null)if(typeof p=="object")if(s[d])h=p1(h,e(d,p,n,s));else{const f=wh({theme:n},p,v=>({[d]:v}));JGe(f,p)?h[d]=t({sx:p,theme:n}):h=p1(h,f)}else h=p1(h,e(d,p,n,s))}),uGe(n,gGe(u,h))}return Array.isArray(r)?r.map(a):a(r)}return t}const hb=t6e();hb.filterProps=["sx"];function i6e(e){var t=Object.create(null);return function(i){return t[i]===void 0&&(t[i]=e(i)),t[i]}}var r6e=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|disableRemotePlayback|download|draggable|encType|enterKeyHint|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,n6e=i6e(function(e){return r6e.test(e)||e.charCodeAt(0)===111&&e.charCodeAt(1)===110&&e.charCodeAt(2)<91}),s6e=!1;function a6e(e){if(e.sheet)return e.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===e)return document.styleSheets[t]}function o6e(e){var t=document.createElement("style");return t.setAttribute("data-emotion",e.key),e.nonce!==void 0&&t.setAttribute("nonce",e.nonce),t.appendChild(document.createTextNode("")),t.setAttribute("data-s",""),t}var l6e=function(){function e(i){var r=this;this._insertTag=function(n){var s;r.tags.length===0?r.insertionPoint?s=r.insertionPoint.nextSibling:r.prepend?s=r.container.firstChild:s=r.before:s=r.tags[r.tags.length-1].nextSibling,r.container.insertBefore(n,s),r.tags.push(n)},this.isSpeedy=i.speedy===void 0?!s6e:i.speedy,this.tags=[],this.ctr=0,this.nonce=i.nonce,this.key=i.key,this.container=i.container,this.prepend=i.prepend,this.insertionPoint=i.insertionPoint,this.before=null}var t=e.prototype;return t.hydrate=function(r){r.forEach(this._insertTag)},t.insert=function(r){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(o6e(this));var n=this.tags[this.tags.length-1];if(this.isSpeedy){var s=a6e(n);try{s.insertRule(r,s.cssRules.length)}catch{}}else n.appendChild(document.createTextNode(r));this.ctr++},t.flush=function(){this.tags.forEach(function(r){var n;return(n=r.parentNode)==null?void 0:n.removeChild(r)}),this.tags=[],this.ctr=0},e}(),Vs="-ms-",nT="-moz-",qi="-webkit-",Bie="comm",YU="rule",QU="decl",c6e="@import",kie="@keyframes",u6e="@layer",h6e=Math.abs,H2=String.fromCharCode,d6e=Object.assign;function p6e(e,t){return xs(e,0)^45?(((t<<2^xs(e,0))<<2^xs(e,1))<<2^xs(e,2))<<2^xs(e,3):0}function Uie(e){return e.trim()}function f6e(e,t){return(e=t.exec(e))?e[0]:e}function Yi(e,t,i){return e.replace(t,i)}function cN(e,t){return e.indexOf(t)}function xs(e,t){return e.charCodeAt(t)|0}function Mw(e,t,i){return e.slice(t,i)}function Mc(e){return e.length}function KU(e){return e.length}function KM(e,t){return t.push(e),e}function m6e(e,t){return e.map(t).join("")}var G2=1,g0=1,Fie=0,Wa=0,xn=0,j0="";function j2(e,t,i,r,n,s,a){return{value:e,root:t,parent:i,type:r,props:n,children:s,line:G2,column:g0,length:a,return:""}}function hx(e,t){return d6e(j2("",null,null,"",null,null,0),e,{length:-e.length},t)}function g6e(){return xn}function v6e(){return xn=Wa>0?xs(j0,--Wa):0,g0--,xn===10&&(g0=1,G2--),xn}function mo(){return xn=Wa<Fie?xs(j0,Wa++):0,g0++,xn===10&&(g0=1,G2++),xn}function Wc(){return xs(j0,Wa)}function FE(){return Wa}function db(e,t){return Mw(j0,e,t)}function Ew(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function Vie(e){return G2=g0=1,Fie=Mc(j0=e),Wa=0,[]}function Hie(e){return j0="",e}function VE(e){return Uie(db(Wa-1,uN(e===91?e+2:e===40?e+1:e)))}function y6e(e){for(;(xn=Wc())&&xn<33;)mo();return Ew(e)>2||Ew(xn)>3?"":" "}function x6e(e,t){for(;--t&&mo()&&!(xn<48||xn>102||xn>57&&xn<65||xn>70&&xn<97););return db(e,FE()+(t<6&&Wc()==32&&mo()==32))}function uN(e){for(;mo();)switch(xn){case e:return Wa;case 34:case 39:e!==34&&e!==39&&uN(xn);break;case 40:e===41&&uN(e);break;case 92:mo();break}return Wa}function w6e(e,t){for(;mo()&&e+xn!==57;)if(e+xn===84&&Wc()===47)break;return"/*"+db(t,Wa-1)+"*"+H2(e===47?e:mo())}function b6e(e){for(;!Ew(Wc());)mo();return db(e,Wa)}function _6e(e){return Hie(HE("",null,null,null,[""],e=Vie(e),0,[0],e))}function HE(e,t,i,r,n,s,a,o,l){for(var c=0,u=0,h=a,d=0,p=0,f=0,v=1,g=1,m=1,x=0,w="",_=n,M=s,S=r,A=w;g;)switch(f=x,x=mo()){case 40:if(f!=108&&xs(A,h-1)==58){cN(A+=Yi(VE(x),"&","&\f"),"&\f")!=-1&&(m=-1);break}case 34:case 39:case 91:A+=VE(x);break;case 9:case 10:case 13:case 32:A+=y6e(f);break;case 92:A+=x6e(FE()-1,7);continue;case 47:switch(Wc()){case 42:case 47:KM(S6e(w6e(mo(),FE()),t,i),l);break;default:A+="/"}break;case 123*v:o[c++]=Mc(A)*m;case 125*v:case 59:case 0:switch(x){case 0:case 125:g=0;case 59+u:m==-1&&(A=Yi(A,/\f/g,"")),p>0&&Mc(A)-h&&KM(p>32?U7(A+";",r,i,h-1):U7(Yi(A," ","")+";",r,i,h-2),l);break;case 59:A+=";";default:if(KM(S=k7(A,t,i,c,u,n,o,w,_=[],M=[],h),s),x===123)if(u===0)HE(A,t,S,S,_,s,h,o,M);else switch(d===99&&xs(A,3)===110?100:d){case 100:case 108:case 109:case 115:HE(e,S,S,r&&KM(k7(e,S,S,0,0,n,o,w,n,_=[],h),M),n,M,h,o,r?_:M);break;default:HE(A,S,S,S,[""],M,0,o,M)}}c=u=p=0,v=m=1,w=A="",h=a;break;case 58:h=1+Mc(A),p=f;default:if(v<1){if(x==123)--v;else if(x==125&&v++==0&&v6e()==125)continue}switch(A+=H2(x),x*v){case 38:m=u>0?1:(A+="\f",-1);break;case 44:o[c++]=(Mc(A)-1)*m,m=1;break;case 64:Wc()===45&&(A+=VE(mo())),d=Wc(),u=h=Mc(w=A+=b6e(FE())),x++;break;case 45:f===45&&Mc(A)==2&&(v=0)}}return s}function k7(e,t,i,r,n,s,a,o,l,c,u){for(var h=n-1,d=n===0?s:[""],p=KU(d),f=0,v=0,g=0;f<r;++f)for(var m=0,x=Mw(e,h+1,h=h6e(v=a[f])),w=e;m<p;++m)(w=Uie(v>0?d[m]+" "+x:Yi(x,/&\f/g,d[m])))&&(l[g++]=w);return j2(e,t,i,n===0?YU:o,l,c,u)}function S6e(e,t,i){return j2(e,t,i,Bie,H2(g6e()),Mw(e,2,-2),0)}function U7(e,t,i,r){return j2(e,t,i,QU,Mw(e,0,r),Mw(e,r+1,-1),r)}function Bv(e,t){for(var i="",r=KU(e),n=0;n<r;n++)i+=t(e[n],n,e,t)||"";return i}function M6e(e,t,i,r){switch(e.type){case u6e:if(e.children.length)break;case c6e:case QU:return e.return=e.return||e.value;case Bie:return"";case kie:return e.return=e.value+"{"+Bv(e.children,r)+"}";case YU:e.value=e.props.join(",")}return Mc(i=Bv(e.children,r))?e.return=e.value+"{"+i+"}":""}function E6e(e){var t=KU(e);return function(i,r,n,s){for(var a="",o=0;o<t;o++)a+=e[o](i,r,n,s)||"";return a}}function A6e(e){return function(t){t.root||(t=t.return)&&e(t)}}var C6e=function(t,i,r){for(var n=0,s=0;n=s,s=Wc(),n===38&&s===12&&(i[r]=1),!Ew(s);)mo();return db(t,Wa)},T6e=function(t,i){var r=-1,n=44;do switch(Ew(n)){case 0:n===38&&Wc()===12&&(i[r]=1),t[r]+=C6e(Wa-1,i,r);break;case 2:t[r]+=VE(n);break;case 4:if(n===44){t[++r]=Wc()===58?"&\f":"",i[r]=t[r].length;break}default:t[r]+=H2(n)}while(n=mo());return t},P6e=function(t,i){return Hie(T6e(Vie(t),i))},F7=new WeakMap,D6e=function(t){if(!(t.type!=="rule"||!t.parent||t.length<1)){for(var i=t.value,r=t.parent,n=t.column===r.column&&t.line===r.line;r.type!=="rule";)if(r=r.parent,!r)return;if(!(t.props.length===1&&i.charCodeAt(0)!==58&&!F7.get(r))&&!n){F7.set(t,!0);for(var s=[],a=P6e(i,s),o=r.props,l=0,c=0;l<a.length;l++)for(var u=0;u<o.length;u++,c++)t.props[c]=s[l]?a[l].replace(/&\f/g,o[u]):o[u]+" "+a[l]}}},R6e=function(t){if(t.type==="decl"){var i=t.value;i.charCodeAt(0)===108&&i.charCodeAt(2)===98&&(t.return="",t.value="")}};function Gie(e,t){switch(p6e(e,t)){case 5103:return qi+"print-"+e+e;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return qi+e+e;case 5349:case 4246:case 4810:case 6968:case 2756:return qi+e+nT+e+Vs+e+e;case 6828:case 4268:return qi+e+Vs+e+e;case 6165:return qi+e+Vs+"flex-"+e+e;case 5187:return qi+e+Yi(e,/(\w+).+(:[^]+)/,qi+"box-$1$2"+Vs+"flex-$1$2")+e;case 5443:return qi+e+Vs+"flex-item-"+Yi(e,/flex-|-self/,"")+e;case 4675:return qi+e+Vs+"flex-line-pack"+Yi(e,/align-content|flex-|-self/,"")+e;case 5548:return qi+e+Vs+Yi(e,"shrink","negative")+e;case 5292:return qi+e+Vs+Yi(e,"basis","preferred-size")+e;case 6060:return qi+"box-"+Yi(e,"-grow","")+qi+e+Vs+Yi(e,"grow","positive")+e;case 4554:return qi+Yi(e,/([^-])(transform)/g,"$1"+qi+"$2")+e;case 6187:return Yi(Yi(Yi(e,/(zoom-|grab)/,qi+"$1"),/(image-set)/,qi+"$1"),e,"")+e;case 5495:case 3959:return Yi(e,/(image-set\([^]*)/,qi+"$1$`$1");case 4968:return Yi(Yi(e,/(.+:)(flex-)?(.*)/,qi+"box-pack:$3"+Vs+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+qi+e+e;case 4095:case 3583:case 4068:case 2532:return Yi(e,/(.+)-inline(.+)/,qi+"$1$2")+e;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(Mc(e)-1-t>6)switch(xs(e,t+1)){case 109:if(xs(e,t+4)!==45)break;case 102:return Yi(e,/(.+:)(.+)-([^]+)/,"$1"+qi+"$2-$3$1"+nT+(xs(e,t+3)==108?"$3":"$2-$3"))+e;case 115:return~cN(e,"stretch")?Gie(Yi(e,"stretch","fill-available"),t)+e:e}break;case 4949:if(xs(e,t+1)!==115)break;case 6444:switch(xs(e,Mc(e)-3-(~cN(e,"!important")&&10))){case 107:return Yi(e,":",":"+qi)+e;case 101:return Yi(e,/(.+:)([^;!]+)(;|!.+)?/,"$1"+qi+(xs(e,14)===45?"inline-":"")+"box$3$1"+qi+"$2$3$1"+Vs+"$2box$3")+e}break;case 5936:switch(xs(e,t+11)){case 114:return qi+e+Vs+Yi(e,/[svh]\w+-[tblr]{2}/,"tb")+e;case 108:return qi+e+Vs+Yi(e,/[svh]\w+-[tblr]{2}/,"tb-rl")+e;case 45:return qi+e+Vs+Yi(e,/[svh]\w+-[tblr]{2}/,"lr")+e}return qi+e+Vs+e+e}return e}var I6e=function(t,i,r,n){if(t.length>-1&&!t.return)switch(t.type){case QU:t.return=Gie(t.value,t.length);break;case kie:return Bv([hx(t,{value:Yi(t.value,"@","@"+qi)})],n);case YU:if(t.length)return m6e(t.props,function(s){switch(f6e(s,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return Bv([hx(t,{props:[Yi(s,/:(read-\w+)/,":"+nT+"$1")]})],n);case"::placeholder":return Bv([hx(t,{props:[Yi(s,/:(plac\w+)/,":"+qi+"input-$1")]}),hx(t,{props:[Yi(s,/:(plac\w+)/,":"+nT+"$1")]}),hx(t,{props:[Yi(s,/:(plac\w+)/,Vs+"input-$1")]})],n)}return""})}},L6e=[I6e],O6e=function(t){var i=t.key;if(i==="css"){var r=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(r,function(v){var g=v.getAttribute("data-emotion");g.indexOf(" ")!==-1&&(document.head.appendChild(v),v.setAttribute("data-s",""))})}var n=t.stylisPlugins||L6e,s={},a,o=[];a=t.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+i+' "]'),function(v){for(var g=v.getAttribute("data-emotion").split(" "),m=1;m<g.length;m++)s[g[m]]=!0;o.push(v)});var l,c=[D6e,R6e];{var u,h=[M6e,A6e(function(v){u.insert(v)})],d=E6e(c.concat(n,h)),p=function(g){return Bv(_6e(g),d)};l=function(g,m,x,w){u=x,p(g?g+"{"+m.styles+"}":m.styles),w&&(f.inserted[m.name]=!0)}}var f={key:i,sheet:new l6e({key:i,container:a,nonce:t.nonce,speedy:t.speedy,prepend:t.prepend,insertionPoint:t.insertionPoint}),nonce:t.nonce,inserted:s,registered:{},insert:l};return f.sheet.hydrate(o),f},z6e=!0;function N6e(e,t,i){var r="";return i.split(" ").forEach(function(n){e[n]!==void 0?t.push(e[n]+";"):r+=n+" "}),r}var jie=function(t,i,r){var n=t.key+"-"+i.name;(r===!1||z6e===!1)&&t.registered[n]===void 0&&(t.registered[n]=i.styles)},B6e=function(t,i,r){jie(t,i,r);var n=t.key+"-"+i.name;if(t.inserted[i.name]===void 0){var s=i;do t.insert(i===s?"."+n:"",s,t.sheet,!0),s=s.next;while(s!==void 0)}};function k6e(e){for(var t=0,i,r=0,n=e.length;n>=4;++r,n-=4)i=e.charCodeAt(r)&255|(e.charCodeAt(++r)&255)<<8|(e.charCodeAt(++r)&255)<<16|(e.charCodeAt(++r)&255)<<24,i=(i&65535)*1540483477+((i>>>16)*59797<<16),i^=i>>>24,t=(i&65535)*1540483477+((i>>>16)*59797<<16)^(t&65535)*1540483477+((t>>>16)*59797<<16);switch(n){case 3:t^=(e.charCodeAt(r+2)&255)<<16;case 2:t^=(e.charCodeAt(r+1)&255)<<8;case 1:t^=e.charCodeAt(r)&255,t=(t&65535)*1540483477+((t>>>16)*59797<<16)}return t^=t>>>13,t=(t&65535)*1540483477+((t>>>16)*59797<<16),((t^t>>>15)>>>0).toString(36)}var U6e={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,scale:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1};function F6e(e){var t=Object.create(null);return function(i){return t[i]===void 0&&(t[i]=e(i)),t[i]}}var V6e=!1,H6e=/[A-Z]|^ms/g,G6e=/_EMO_([^_]+?)_([^]*?)_EMO_/g,Wie=function(t){return t.charCodeAt(1)===45},V7=function(t){return t!=null&&typeof t!="boolean"},II=F6e(function(e){return Wie(e)?e:e.replace(H6e,"-$&").toLowerCase()}),H7=function(t,i){switch(t){case"animation":case"animationName":if(typeof i=="string")return i.replace(G6e,function(r,n,s){return Ec={name:n,styles:s,next:Ec},n})}return U6e[t]!==1&&!Wie(t)&&typeof i=="number"&&i!==0?i+"px":i},j6e="Component selectors can only be used in conjunction with @emotion/babel-plugin, the swc Emotion plugin, or another Emotion-aware compiler transform.";function Aw(e,t,i){if(i==null)return"";var r=i;if(r.__emotion_styles!==void 0)return r;switch(typeof i){case"boolean":return"";case"object":{var n=i;if(n.anim===1)return Ec={name:n.name,styles:n.styles,next:Ec},n.name;var s=i;if(s.styles!==void 0){var a=s.next;if(a!==void 0)for(;a!==void 0;)Ec={name:a.name,styles:a.styles,next:Ec},a=a.next;var o=s.styles+";";return o}return W6e(e,t,i)}case"function":{if(e!==void 0){var l=Ec,c=i(e);return Ec=l,Aw(e,t,c)}break}}var u=i;if(t==null)return u;var h=t[u];return h!==void 0?h:u}function W6e(e,t,i){var r="";if(Array.isArray(i))for(var n=0;n<i.length;n++)r+=Aw(e,t,i[n])+";";else for(var s in i){var a=i[s];if(typeof a!="object"){var o=a;t!=null&&t[o]!==void 0?r+=s+"{"+t[o]+"}":V7(o)&&(r+=II(s)+":"+H7(s,o)+";")}else{if(s==="NO_COMPONENT_SELECTOR"&&V6e)throw new Error(j6e);if(Array.isArray(a)&&typeof a[0]=="string"&&(t==null||t[a[0]]===void 0))for(var l=0;l<a.length;l++)V7(a[l])&&(r+=II(s)+":"+H7(s,a[l])+";");else{var c=Aw(e,t,a);switch(s){case"animation":case"animationName":{r+=II(s)+":"+c+";";break}default:r+=s+"{"+c+"}"}}}}return r}var G7=/label:\s*([^\s;\n{]+)\s*(;|$)/g,Ec;function X6e(e,t,i){if(e.length===1&&typeof e[0]=="object"&&e[0]!==null&&e[0].styles!==void 0)return e[0];var r=!0,n="";Ec=void 0;var s=e[0];if(s==null||s.raw===void 0)r=!1,n+=Aw(i,t,s);else{var a=s;n+=a[0]}for(var o=1;o<e.length;o++)if(n+=Aw(i,t,e[o]),r){var l=s;n+=l[o]}G7.lastIndex=0;for(var c="",u;(u=G7.exec(n))!==null;)c+="-"+u[1];var h=k6e(n)+c;return{name:h,styles:n,next:Ec}}var q6e=function(t){return t()},Y6e=L4.useInsertionEffect?L4.useInsertionEffect:!1,Q6e=Y6e||q6e,Xie=qe.createContext(typeof HTMLElement<"u"?O6e({key:"css"}):null);Xie.Provider;var K6e=function(t){return qe.forwardRef(function(i,r){var n=qe.useContext(Xie);return t(i,n,r)})},Z6e=qe.createContext({}),$6e=n6e,J6e=function(t){return t!=="theme"},j7=function(t){return typeof t=="string"&&t.charCodeAt(0)>96?$6e:J6e},W7=function(t,i,r){var n;if(i){var s=i.shouldForwardProp;n=t.__emotion_forwardProp&&s?function(a){return t.__emotion_forwardProp(a)&&s(a)}:s}return typeof n!="function"&&r&&(n=t.__emotion_forwardProp),n},eje=!1,tje=function(t){var i=t.cache,r=t.serialized,n=t.isStringTag;return jie(i,r,n),Q6e(function(){return B6e(i,r,n)}),null},ije=function e(t,i){var r=t.__emotion_real===t,n=r&&t.__emotion_base||t,s,a;i!==void 0&&(s=i.label,a=i.target);var o=W7(t,i,r),l=o||j7(n),c=!l("as");return function(){var u=arguments,h=r&&t.__emotion_styles!==void 0?t.__emotion_styles.slice(0):[];if(s!==void 0&&h.push("label:"+s+";"),u[0]==null||u[0].raw===void 0)h.push.apply(h,u);else{h.push(u[0][0]);for(var d=u.length,p=1;p<d;p++)h.push(u[p],u[0][p])}var f=K6e(function(v,g,m){var x=c&&v.as||n,w="",_=[],M=v;if(v.theme==null){M={};for(var S in v)M[S]=v[S];M.theme=qe.useContext(Z6e)}typeof v.className=="string"?w=N6e(g.registered,_,v.className):v.className!=null&&(w=v.className+" ");var A=X6e(h.concat(_),g.registered,M);w+=g.key+"-"+A.name,a!==void 0&&(w+=" "+a);var T=c&&o===void 0?j7(x):l,E={};for(var C in v)c&&C==="as"||T(C)&&(E[C]=v[C]);return E.className=w,m&&(E.ref=m),qe.createElement(qe.Fragment,null,qe.createElement(tje,{cache:g,serialized:A,isStringTag:typeof x=="string"}),qe.createElement(x,E))});return f.displayName=s!==void 0?s:"Styled("+(typeof n=="string"?n:n.displayName||n.name||"Component")+")",f.defaultProps=t.defaultProps,f.__emotion_real=f,f.__emotion_base=n,f.__emotion_styles=h,f.__emotion_forwardProp=o,Object.defineProperty(f,"toString",{value:function(){return a===void 0&&eje?"NO_COMPONENT_SELECTOR":"."+a}}),f.withComponent=function(v,g){return e(v,ZC({},i,g,{shouldForwardProp:W7(f,g,!0)})).apply(void 0,h)},f}},rje=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],hN=ije.bind();rje.forEach(function(e){hN[e]=hN(e)});/**
 * @mui/styled-engine v6.0.1
 *
 * @license MIT
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */function nje(e,t){return hN(e,t)}const sje=(e,t)=>{Array.isArray(e.__emotion_styles)&&(e.__emotion_styles=t(e.__emotion_styles))},aje=e=>{const t=Object.keys(e).map(i=>({key:i,val:e[i]}))||[];return t.sort((i,r)=>i.val-r.val),t.reduce((i,r)=>({...i,[r.key]:r.val}),{})};function oje(e){const{values:t={xs:0,sm:600,md:900,lg:1200,xl:1536},unit:i="px",step:r=5,...n}=e,s=aje(t),a=Object.keys(s);function o(d){return`@media (min-width:${typeof t[d]=="number"?t[d]:d}${i})`}function l(d){return`@media (max-width:${(typeof t[d]=="number"?t[d]:d)-r/100}${i})`}function c(d,p){const f=a.indexOf(p);return`@media (min-width:${typeof t[d]=="number"?t[d]:d}${i}) and (max-width:${(f!==-1&&typeof t[a[f]]=="number"?t[a[f]]:p)-r/100}${i})`}function u(d){return a.indexOf(d)+1<a.length?c(d,a[a.indexOf(d)+1]):o(d)}function h(d){const p=a.indexOf(d);return p===0?o(a[1]):p===a.length-1?l(a[p]):c(d,a[a.indexOf(d)+1]).replace("@media","@media not all and")}return{keys:a,values:s,up:o,down:l,between:c,only:u,not:h,unit:i,...n}}const lje={borderRadius:4};function qie(e=8,t=XU({spacing:e})){if(e.mui)return e;const i=(...r)=>(r.length===0?[1]:r).map(s=>{const a=t(s);return typeof a=="number"?`${a}px`:a}).join(" ");return i.mui=!0,i}function cje(e,t){var r;const i=this;if(i.vars){if(!((r=i.colorSchemes)!=null&&r[e])||typeof i.getColorSchemeSelector!="function")return{};let n=i.getColorSchemeSelector(e);return(n.includes("data-")||n.includes("."))&&(n=`*:where(${n.replace(/\s*&$/,"")}) &`),{[n]:t}}return i.palette.mode===e?t:{}}function Yie(e={},...t){const{breakpoints:i={},palette:r={},spacing:n,shape:s={},...a}=e,o=oje(i),l=qie(n);let c=fo({breakpoints:o,direction:"ltr",components:{},palette:{mode:"light",...r},spacing:l,shape:{...lje,...s}},a);return c=pGe(c),c.applyStyles=cje,c=t.reduce((u,h)=>fo(u,h),c),c.unstable_sxConfig={...V2,...a==null?void 0:a.unstable_sxConfig},c.unstable_sx=function(h){return hb({sx:h,theme:this})},c}const uje=Yie();function LI(e){return e!=="ownerState"&&e!=="theme"&&e!=="sx"&&e!=="as"}function dN(e,t,i){return pje(t)?i:t[e]||t}const ZM=Symbol("mui.processed_props");function $M(e,t,i){if(ZM in e)return e[ZM];const r={...e,theme:dN(t,e.theme,i)};return e[ZM]=r,r[ZM]=r,r}function hje(e){return e?(t,i)=>i[e]:null}function GE(e,t){var r;const i=typeof e=="function"?e(t):e;if(Array.isArray(i))return i.flatMap(n=>GE(n,t));if(Array.isArray(i==null?void 0:i.variants)){const{variants:n,...s}=i;let a=s,o;e:for(let l=0;l<n.length;l+=1){const c=n[l];if(typeof c.props=="function"){if(o??(o={...t,...t.ownerState,ownerState:t.ownerState}),!c.props(o))continue}else for(const u in c.props)if(t[u]!==c.props[u]&&((r=t.ownerState)==null?void 0:r[u])!==c.props[u])continue e;Array.isArray(a)||(a=[a]),typeof c.style=="function"?(o??(o={...t,...t.ownerState,ownerState:t.ownerState}),a.push(c.style(o))):a.push(c.style)}return a}return i}function dje(e={}){const{themeId:t,defaultTheme:i=uje,rootShouldForwardProp:r=LI,slotShouldForwardProp:n=LI}=e,s=o=>hb($M(o,t,i));return s.__mui_systemSx=!0,(o,l={})=>{sje(o,S=>S.filter(A=>!(A!=null&&A.__mui_systemSx)));const{name:c,slot:u,skipVariantsResolver:h,skipSx:d,overridesResolver:p=hje(mje(u)),...f}=l,v=h!==void 0?h:u&&u!=="Root"&&u!=="root"||!1,g=d||!1;let m,x=LI;u==="Root"||u==="root"?x=r:u?x=n:fje(o)&&(x=void 0);const w=nje(o,{shouldForwardProp:x,label:m,...f}),_=S=>typeof S=="function"&&S.__emotion_real!==S||Gu(S)?A=>GE(S,$M(A,t,i)):S,M=(S,...A)=>{let T=_(S);const E=A?A.map(_):[];c&&p&&E.push(I=>{const L=dN(t,I.theme,i);if(!L.components||!L.components[c]||!L.components[c].styleOverrides)return null;const z=L.components[c].styleOverrides,F={},Q=$M(I,t,i);for(const Y in z)F[Y]=GE(z[Y],Q);return p(I,F)}),c&&!v&&E.push(I=>{var F,Q;const L=dN(t,I.theme,i),z=(Q=(F=L==null?void 0:L.components)==null?void 0:F[c])==null?void 0:Q.variants;return z?GE({variants:z},$M(I,t,i)):null}),g||E.push(s);const C=E.length-A.length;if(Array.isArray(S)&&C>0){const I=new Array(C).fill("");T=[...S,...I],T.raw=[...S.raw,...I]}const D=w(T,...E);return o.muiName&&(D.muiName=o.muiName),D};return w.withConfig&&(M.withConfig=w.withConfig),M}}function pje(e){for(const t in e)return!1;return!0}function fje(e){return typeof e=="string"&&e.charCodeAt(0)>96}function mje(e){return e&&e.charAt(0).toLowerCase()+e.slice(1)}const gje=qe.createContext(void 0);function vje(e){const{theme:t,name:i,props:r}=e;if(!t||!t.components||!t.components[i])return r;const n=t.components[i];return n.defaultProps?lN(n.defaultProps,r):!n.styleOverrides&&!n.variants?lN(n,r):r}function yje({props:e,name:t}){const i=qe.useContext(gje);return vje({props:e,name:t,theme:{components:i}})}function xje(e=""){function t(...r){if(!r.length)return"";const n=r[0];return typeof n=="string"&&!n.match(/(#|\(|\)|(-?(\d*\.)?\d+)(px|em|%|ex|ch|rem|vw|vh|vmin|vmax|cm|mm|in|pt|pc))|^(-?(\d*\.)?\d+)$|(\d+ \d+ \d+)/)?`, var(--${e?`${e}-`:""}${n}${t(...r.slice(1))})`:`, ${n}`}return(r,...n)=>`var(--${e?`${e}-`:""}${r}${t(...n)})`}const X7=(e,t,i,r=[])=>{let n=e;t.forEach((s,a)=>{a===t.length-1?Array.isArray(n)?n[Number(s)]=i:n&&typeof n=="object"&&(n[s]=i):n&&typeof n=="object"&&(n[s]||(n[s]=r.includes(s)?[]:{}),n=n[s])})},wje=(e,t,i)=>{function r(n,s=[],a=[]){Object.entries(n).forEach(([o,l])=>{(!i||i&&!i([...s,o]))&&l!=null&&(typeof l=="object"&&Object.keys(l).length>0?r(l,[...s,o],Array.isArray(l)?[...a,o]:a):t([...s,o],l,a))})}r(e)},bje=(e,t)=>typeof t=="number"?["lineHeight","fontWeight","opacity","zIndex"].some(r=>e.includes(r))||e[e.length-1].toLowerCase().indexOf("opacity")>=0?t:`${t}px`:t;function OI(e,t){const{prefix:i,shouldSkipGeneratingVar:r}=t||{},n={},s={},a={};return wje(e,(o,l,c)=>{if((typeof l=="string"||typeof l=="number")&&(!r||!r(o,l))){const u=`--${i?`${i}-`:""}${o.join("-")}`,h=bje(o,l);Object.assign(n,{[u]:h}),X7(s,o,`var(${u})`,c),X7(a,o,`var(${u}, ${h})`,c)}},o=>o[0]==="vars"),{css:n,vars:s,varsWithDefaults:a}}function _je(e,t={}){const{getSelector:i=g,disableCssColorScheme:r,colorSchemeSelector:n}=t,{colorSchemes:s={},components:a,defaultColorScheme:o="light",...l}=e,{vars:c,css:u,varsWithDefaults:h}=OI(l,t);let d=h;const p={},{[o]:f,...v}=s;if(Object.entries(v||{}).forEach(([w,_])=>{const{vars:M,css:S,varsWithDefaults:A}=OI(_,t);d=fo(d,A),p[w]={css:S,vars:M}}),f){const{css:w,vars:_,varsWithDefaults:M}=OI(f,t);d=fo(d,M),p[o]={css:w,vars:_}}function g(w,_){var S,A;let M=n;if(n==="class"&&(M=".%s"),n==="data"&&(M="[data-%s]"),n!=null&&n.startsWith("data-")&&!n.includes("%s")&&(M=`[${n}="%s"]`),w){if(M==="media")return e.defaultColorScheme===w?":root":{[`@media (prefers-color-scheme: ${((A=(S=s[w])==null?void 0:S.palette)==null?void 0:A.mode)||w})`]:{":root":_}};if(M)return e.defaultColorScheme===w?`:root, ${M.replace("%s",String(w))}`:M.replace("%s",String(w))}return":root"}return{vars:d,generateThemeVars:()=>{let w={...c};return Object.entries(p).forEach(([,{vars:_}])=>{w=fo(w,_)}),w},generateStyleSheets:()=>{var T,E;const w=[],_=e.defaultColorScheme||"light";function M(C,D){Object.keys(D).length&&w.push(typeof C=="string"?{[C]:{...D}}:C)}M(i(void 0,{...u}),u);const{[_]:S,...A}=p;if(S){const{css:C}=S,D=(E=(T=s[_])==null?void 0:T.palette)==null?void 0:E.mode,I=!r&&D?{colorScheme:D,...C}:{...C};M(i(_,{...I}),I)}return Object.entries(A).forEach(([C,{css:D}])=>{var z,F;const I=(F=(z=s[C])==null?void 0:z.palette)==null?void 0:F.mode,L=!r&&I?{colorScheme:I,...D}:{...D};M(i(C,{...L}),L)}),w}}}function Sje(e){return function(i){return e==="media"?`@media (prefers-color-scheme: ${i})`:e?e.startsWith("data-")&&!e.includes("%s")?`[${e}="${i}"] &`:e==="class"?`.${i} &`:e==="data"?`[data-${i}] &`:`${e.replace("%s",i)} &`:"&"}}const Cw={black:"#000",white:"#fff"},Mje={50:"#fafafa",100:"#f5f5f5",200:"#eeeeee",300:"#e0e0e0",400:"#bdbdbd",500:"#9e9e9e",600:"#757575",700:"#616161",800:"#424242",900:"#212121",A100:"#f5f5f5",A200:"#eeeeee",A400:"#bdbdbd",A700:"#616161"},Tg={50:"#f3e5f5",100:"#e1bee7",200:"#ce93d8",300:"#ba68c8",400:"#ab47bc",500:"#9c27b0",600:"#8e24aa",700:"#7b1fa2",800:"#6a1b9a",900:"#4a148c",A100:"#ea80fc",A200:"#e040fb",A400:"#d500f9",A700:"#aa00ff"},Pg={50:"#ffebee",100:"#ffcdd2",200:"#ef9a9a",300:"#e57373",400:"#ef5350",500:"#f44336",600:"#e53935",700:"#d32f2f",800:"#c62828",900:"#b71c1c",A100:"#ff8a80",A200:"#ff5252",A400:"#ff1744",A700:"#d50000"},dx={50:"#fff3e0",100:"#ffe0b2",200:"#ffcc80",300:"#ffb74d",400:"#ffa726",500:"#ff9800",600:"#fb8c00",700:"#f57c00",800:"#ef6c00",900:"#e65100",A100:"#ffd180",A200:"#ffab40",A400:"#ff9100",A700:"#ff6d00"},Dg={50:"#e3f2fd",100:"#bbdefb",200:"#90caf9",300:"#64b5f6",400:"#42a5f5",500:"#2196f3",600:"#1e88e5",700:"#1976d2",800:"#1565c0",900:"#0d47a1",A100:"#82b1ff",A200:"#448aff",A400:"#2979ff",A700:"#2962ff"},Rg={50:"#e1f5fe",100:"#b3e5fc",200:"#81d4fa",300:"#4fc3f7",400:"#29b6f6",500:"#03a9f4",600:"#039be5",700:"#0288d1",800:"#0277bd",900:"#01579b",A100:"#80d8ff",A200:"#40c4ff",A400:"#00b0ff",A700:"#0091ea"},Ig={50:"#e8f5e9",100:"#c8e6c9",200:"#a5d6a7",300:"#81c784",400:"#66bb6a",500:"#4caf50",600:"#43a047",700:"#388e3c",800:"#2e7d32",900:"#1b5e20",A100:"#b9f6ca",A200:"#69f0ae",A400:"#00e676",A700:"#00c853"},q7={text:{primary:"rgba(0, 0, 0, 0.87)",secondary:"rgba(0, 0, 0, 0.6)",disabled:"rgba(0, 0, 0, 0.38)"},divider:"rgba(0, 0, 0, 0.12)",background:{paper:Cw.white,default:Cw.white},action:{active:"rgba(0, 0, 0, 0.54)",hover:"rgba(0, 0, 0, 0.04)",hoverOpacity:.04,selected:"rgba(0, 0, 0, 0.08)",selectedOpacity:.08,disabled:"rgba(0, 0, 0, 0.26)",disabledBackground:"rgba(0, 0, 0, 0.12)",disabledOpacity:.38,focus:"rgba(0, 0, 0, 0.12)",focusOpacity:.12,activatedOpacity:.12}},zI={text:{primary:Cw.white,secondary:"rgba(255, 255, 255, 0.7)",disabled:"rgba(255, 255, 255, 0.5)",icon:"rgba(255, 255, 255, 0.5)"},divider:"rgba(255, 255, 255, 0.12)",background:{paper:"#121212",default:"#121212"},action:{active:Cw.white,hover:"rgba(255, 255, 255, 0.08)",hoverOpacity:.08,selected:"rgba(255, 255, 255, 0.16)",selectedOpacity:.16,disabled:"rgba(255, 255, 255, 0.3)",disabledBackground:"rgba(255, 255, 255, 0.12)",disabledOpacity:.38,focus:"rgba(255, 255, 255, 0.12)",focusOpacity:.12,activatedOpacity:.24}};function Y7(e,t,i,r){const n=r.light||r,s=r.dark||r*1.5;e[t]||(e.hasOwnProperty(i)?e[t]=e[i]:t==="light"?e.light=Sw(e.main,n):t==="dark"&&(e.dark=_w(e.main,s)))}function Eje(e="light"){return e==="dark"?{main:Dg[200],light:Dg[50],dark:Dg[400]}:{main:Dg[700],light:Dg[400],dark:Dg[800]}}function Aje(e="light"){return e==="dark"?{main:Tg[200],light:Tg[50],dark:Tg[400]}:{main:Tg[500],light:Tg[300],dark:Tg[700]}}function Cje(e="light"){return e==="dark"?{main:Pg[500],light:Pg[300],dark:Pg[700]}:{main:Pg[700],light:Pg[400],dark:Pg[800]}}function Tje(e="light"){return e==="dark"?{main:Rg[400],light:Rg[300],dark:Rg[700]}:{main:Rg[700],light:Rg[500],dark:Rg[900]}}function Pje(e="light"){return e==="dark"?{main:Ig[400],light:Ig[300],dark:Ig[700]}:{main:Ig[800],light:Ig[500],dark:Ig[900]}}function Dje(e="light"){return e==="dark"?{main:dx[400],light:dx[300],dark:dx[700]}:{main:"#ed6c02",light:dx[500],dark:dx[900]}}function ZU(e){const{mode:t="light",contrastThreshold:i=3,tonalOffset:r=.2,...n}=e,s=e.primary||Eje(t),a=e.secondary||Aje(t),o=e.error||Cje(t),l=e.info||Tje(t),c=e.success||Pje(t),u=e.warning||Dje(t);function h(v){return VHe(v,zI.text.primary)>=i?zI.text.primary:q7.text.primary}const d=({color:v,name:g,mainShade:m=500,lightShade:x=300,darkShade:w=700})=>{if(v={...v},!v.main&&v[m]&&(v.main=v[m]),!v.hasOwnProperty("main"))throw new Error($f(11,g?` (${g})`:"",m));if(typeof v.main!="string")throw new Error($f(12,g?` (${g})`:"",JSON.stringify(v.main)));return Y7(v,"light",x,r),Y7(v,"dark",w,r),v.contrastText||(v.contrastText=h(v.main)),v},p={dark:zI,light:q7};return fo({common:{...Cw},mode:t,primary:d({color:s,name:"primary"}),secondary:d({color:a,name:"secondary",mainShade:"A400",lightShade:"A200",darkShade:"A700"}),error:d({color:o,name:"error"}),warning:d({color:u,name:"warning"}),info:d({color:l,name:"info"}),success:d({color:c,name:"success"}),grey:Mje,contrastThreshold:i,getContrastText:h,augmentColor:d,tonalOffset:r,...p[t]},n)}function Rje(e){const t={};return Object.entries(e).forEach(r=>{const[n,s]=r;typeof s=="object"&&(t[n]=`${s.fontStyle?`${s.fontStyle} `:""}${s.fontVariant?`${s.fontVariant} `:""}${s.fontWeight?`${s.fontWeight} `:""}${s.fontStretch?`${s.fontStretch} `:""}${s.fontSize||""}${s.lineHeight?`/${s.lineHeight} `:""}${s.fontFamily||""}`)}),t}function Ije(e,t){return{toolbar:{minHeight:56,[e.up("xs")]:{"@media (orientation: landscape)":{minHeight:48}},[e.up("sm")]:{minHeight:64}},...t}}function Lje(e){return Math.round(e*1e5)/1e5}const Q7={textTransform:"uppercase"},K7='"Roboto", "Helvetica", "Arial", sans-serif';function Oje(e,t){const{fontFamily:i=K7,fontSize:r=14,fontWeightLight:n=300,fontWeightRegular:s=400,fontWeightMedium:a=500,fontWeightBold:o=700,htmlFontSize:l=16,allVariants:c,pxToRem:u,...h}=typeof t=="function"?t(e):t,d=r/14,p=u||(g=>`${g/l*d}rem`),f=(g,m,x,w,_)=>({fontFamily:i,fontWeight:g,fontSize:p(m),lineHeight:x,...i===K7?{letterSpacing:`${Lje(w/m)}em`}:{},..._,...c}),v={h1:f(n,96,1.167,-1.5),h2:f(n,60,1.2,-.5),h3:f(s,48,1.167,0),h4:f(s,34,1.235,.25),h5:f(s,24,1.334,0),h6:f(a,20,1.6,.15),subtitle1:f(s,16,1.75,.15),subtitle2:f(a,14,1.57,.1),body1:f(s,16,1.5,.15),body2:f(s,14,1.43,.15),button:f(a,14,1.75,.4,Q7),caption:f(s,12,1.66,.4),overline:f(s,12,2.66,1,Q7),inherit:{fontFamily:"inherit",fontWeight:"inherit",fontSize:"inherit",lineHeight:"inherit",letterSpacing:"inherit"}};return fo({htmlFontSize:l,pxToRem:p,fontFamily:i,fontSize:r,fontWeightLight:n,fontWeightRegular:s,fontWeightMedium:a,fontWeightBold:o,...v},h,{clone:!1})}const zje=.2,Nje=.14,Bje=.12;function Pr(...e){return[`${e[0]}px ${e[1]}px ${e[2]}px ${e[3]}px rgba(0,0,0,${zje})`,`${e[4]}px ${e[5]}px ${e[6]}px ${e[7]}px rgba(0,0,0,${Nje})`,`${e[8]}px ${e[9]}px ${e[10]}px ${e[11]}px rgba(0,0,0,${Bje})`].join(",")}const kje=["none",Pr(0,2,1,-1,0,1,1,0,0,1,3,0),Pr(0,3,1,-2,0,2,2,0,0,1,5,0),Pr(0,3,3,-2,0,3,4,0,0,1,8,0),Pr(0,2,4,-1,0,4,5,0,0,1,10,0),Pr(0,3,5,-1,0,5,8,0,0,1,14,0),Pr(0,3,5,-1,0,6,10,0,0,1,18,0),Pr(0,4,5,-2,0,7,10,1,0,2,16,1),Pr(0,5,5,-3,0,8,10,1,0,3,14,2),Pr(0,5,6,-3,0,9,12,1,0,3,16,2),Pr(0,6,6,-3,0,10,14,1,0,4,18,3),Pr(0,6,7,-4,0,11,15,1,0,4,20,3),Pr(0,7,8,-4,0,12,17,2,0,5,22,4),Pr(0,7,8,-4,0,13,19,2,0,5,24,4),Pr(0,7,9,-4,0,14,21,2,0,5,26,4),Pr(0,8,9,-5,0,15,22,2,0,6,28,5),Pr(0,8,10,-5,0,16,24,2,0,6,30,5),Pr(0,8,11,-5,0,17,26,2,0,6,32,5),Pr(0,9,11,-5,0,18,28,2,0,7,34,6),Pr(0,9,12,-6,0,19,29,2,0,7,36,6),Pr(0,10,13,-6,0,20,31,3,0,8,38,7),Pr(0,10,13,-6,0,21,33,3,0,8,40,7),Pr(0,10,14,-6,0,22,35,3,0,8,42,7),Pr(0,11,14,-7,0,23,36,3,0,9,44,8),Pr(0,11,15,-7,0,24,38,3,0,9,46,8)],Uje={easeInOut:"cubic-bezier(0.4, 0, 0.2, 1)",easeOut:"cubic-bezier(0.0, 0, 0.2, 1)",easeIn:"cubic-bezier(0.4, 0, 1, 1)",sharp:"cubic-bezier(0.4, 0, 0.6, 1)"},Fje={shortest:150,shorter:200,short:250,standard:300,complex:375,enteringScreen:225,leavingScreen:195};function Z7(e){return`${Math.round(e)}ms`}function Vje(e){if(!e)return 0;const t=e/36;return Math.min(Math.round((4+15*t**.25+t/5)*10),3e3)}function Hje(e){const t={...Uje,...e.easing},i={...Fje,...e.duration};return{getAutoHeightDuration:Vje,create:(n=["all"],s={})=>{const{duration:a=i.standard,easing:o=t.easeInOut,delay:l=0,...c}=s;return(Array.isArray(n)?n:[n]).map(u=>`${u} ${typeof a=="string"?a:Z7(a)} ${o} ${typeof l=="string"?l:Z7(l)}`).join(",")},...e,easing:t,duration:i}}const Gje={mobileStepper:1e3,fab:1050,speedDial:1050,appBar:1100,drawer:1200,modal:1300,snackbar:1400,tooltip:1500};function Qie(e={},...t){const{breakpoints:i,mixins:r={},spacing:n,palette:s={},transitions:a={},typography:o={},shape:l,...c}=e;if(e.vars)throw new Error($f(20));const u=ZU(s),h=Yie(e);let d=fo(h,{mixins:Ije(h.breakpoints,r),palette:u,shadows:kje.slice(),typography:Oje(u,o),transitions:Hje(a),zIndex:{...Gje}});return d=fo(d,c),d=t.reduce((p,f)=>fo(p,f),d),d.unstable_sxConfig={...V2,...c==null?void 0:c.unstable_sxConfig},d.unstable_sx=function(f){return hb({sx:f,theme:this})},d}function jje(e){let t;return e<1?t=5.11916*e**2:t=4.5*Math.log(e+1)+2,Math.round(t*10)/1e3}const Wje=[...Array(25)].map((e,t)=>{if(t===0)return;const i=jje(t);return`linear-gradient(rgba(255 255 255 / ${i}), rgba(255 255 255 / ${i}))`});function Kie(e){return{inputPlaceholder:e==="dark"?.5:.42,inputUnderline:e==="dark"?.7:.42,switchTrackDisabled:e==="dark"?.2:.12,switchTrack:e==="dark"?.3:.38}}function Zie(e){return e==="dark"?Wje:[]}function Xje(e){const{palette:t={mode:"light"},opacity:i,overlays:r,...n}=e,s=ZU(t);return{palette:s,opacity:{...Kie(s.mode),...i},overlays:r||Zie(s.mode),...n}}function qje(e){var t;return!!e[0].match(/(cssVarPrefix|colorSchemeSelector|typography|mixins|breakpoints|direction|transitions)/)||!!e[0].match(/sxConfig$/)||e[0]==="palette"&&!!((t=e[1])!=null&&t.match(/(mode|contrastThreshold|tonalOffset)/))}const Yje=e=>[...[...Array(24)].map((t,i)=>`--${e?`${e}-`:""}overlays-${i+1}`),`--${e?`${e}-`:""}palette-AppBar-darkBg`,`--${e?`${e}-`:""}palette-AppBar-darkColor`],Qje=e=>(t,i)=>{const r=e.colorSchemeSelector;let n=r;if(r==="class"&&(n=".%s"),r==="data"&&(n="[data-%s]"),r!=null&&r.startsWith("data-")&&!r.includes("%s")&&(n=`[${r}="%s"]`),e.defaultColorScheme===t){if(t==="dark"){const s={};return Yje(e.cssVarPrefix).forEach(a=>{s[a]=i[a],delete i[a]}),n==="media"?{":root":i,"@media (prefers-color-scheme: dark)":{":root":s}}:n?{[n.replace("%s",t)]:s,[`:root, ${n.replace("%s",t)}`]:i}:{":root":{...i,...s}}}if(n&&n!=="media")return`:root, ${n.replace("%s",String(t))}`}else if(t){if(n==="media")return{[`@media (prefers-color-scheme: ${String(t)})`]:{":root":i}};if(n)return n.replace("%s",String(t))}return":root"};function Kje(e){return Gu(e)||typeof e>"u"||typeof e=="string"||typeof e=="boolean"||typeof e=="number"||Array.isArray(e)}function Zje(e={}){const t={...e};function i(r){const n=Object.entries(r);for(let s=0;s<n.length;s++){const[a,o]=n[s];!Kje(o)||a.startsWith("unstable_")?delete r[a]:Gu(o)&&(r[a]={...o},i(r[a]))}}return i(t),`import { unstable_createBreakpoints as createBreakpoints, createTransitions } from '@mui/material/styles';

const theme = ${JSON.stringify(t,null,2)};

theme.breakpoints = createBreakpoints(theme.breakpoints || {});
theme.transitions = createTransitions(theme.transitions || {});

export default theme;`}function $je(e,t){t.forEach(i=>{e[i]||(e[i]={})})}function it(e,t,i){!e[t]&&i&&(e[t]=i)}function Ix(e){return!e||!e.startsWith("hsl")?e:Die(e)}function Eu(e,t){`${t}Channel`in e||(e[`${t}Channel`]=Rx(Ix(e[t]),`MUI: Can't create \`palette.${t}Channel\` because \`palette.${t}\` is not one of these formats: #nnn, #nnnnnn, rgb(), rgba(), hsl(), hsla(), color().
To suppress this warning, you need to explicitly provide the \`palette.${t}Channel\` as a string (in rgb format, for example "12 12 12") or undefined if you want to remove the channel token.`))}function Jje(e){return typeof e=="number"?`${e}px`:typeof e=="string"||typeof e=="function"||Array.isArray(e)?e:"8px"}const gc=e=>{try{return e()}catch{}},eWe=(e="mui")=>xje(e);function NI(e,t,i,r){if(!t)return;t=t===!0?{}:t;const n=r==="dark"?"dark":"light";if(!i){e[r]=Xje({...t,palette:{mode:n,...t==null?void 0:t.palette}});return}const{palette:s,...a}=Qie({...i,palette:{mode:n,...t==null?void 0:t.palette}});return e[r]={...t,palette:s,opacity:{...Kie(n),...t==null?void 0:t.opacity},overlays:(t==null?void 0:t.overlays)||Zie(n)},a}function tWe(e={},...t){const{colorSchemes:i={light:!0},defaultColorScheme:r,disableCssColorScheme:n=!1,cssVarPrefix:s="mui",shouldSkipGeneratingVar:a=qje,colorSchemeSelector:o=i.light&&i.dark?"media":void 0,...l}=e,c=Object.keys(i)[0],u=r||(i.light&&c!=="light"?"light":c),h=eWe(s),{[u]:d,light:p,dark:f,...v}=i,g={...v};let m=d;if((u==="dark"&&!("dark"in i)||u==="light"&&!("light"in i))&&(m=!0),!m)throw new Error($f(21,u));const x=NI(g,m,l,u);p&&!g.light&&NI(g,p,void 0,"light"),f&&!g.dark&&NI(g,f,void 0,"dark");let w={defaultColorScheme:u,...x,cssVarPrefix:s,colorSchemeSelector:o,getCssVar:h,colorSchemes:g,font:{...Rje(x.typography),...x.font},spacing:Jje(l.spacing)};Object.keys(w.colorSchemes).forEach(T=>{const E=w.colorSchemes[T].palette,C=D=>{const I=D.split("-"),L=I[1],z=I[2];return h(D,E[L][z])};if(E.mode==="light"&&(it(E.common,"background","#fff"),it(E.common,"onBackground","#000")),E.mode==="dark"&&(it(E.common,"background","#000"),it(E.common,"onBackground","#fff")),$je(E,["Alert","AppBar","Avatar","Button","Chip","FilledInput","LinearProgress","Skeleton","Slider","SnackbarContent","SpeedDialAction","StepConnector","StepContent","Switch","TableCell","Tooltip"]),E.mode==="light"){it(E.Alert,"errorColor",fr(E.error.light,.6)),it(E.Alert,"infoColor",fr(E.info.light,.6)),it(E.Alert,"successColor",fr(E.success.light,.6)),it(E.Alert,"warningColor",fr(E.warning.light,.6)),it(E.Alert,"errorFilledBg",C("palette-error-main")),it(E.Alert,"infoFilledBg",C("palette-info-main")),it(E.Alert,"successFilledBg",C("palette-success-main")),it(E.Alert,"warningFilledBg",C("palette-warning-main")),it(E.Alert,"errorFilledColor",gc(()=>E.getContrastText(E.error.main))),it(E.Alert,"infoFilledColor",gc(()=>E.getContrastText(E.info.main))),it(E.Alert,"successFilledColor",gc(()=>E.getContrastText(E.success.main))),it(E.Alert,"warningFilledColor",gc(()=>E.getContrastText(E.warning.main))),it(E.Alert,"errorStandardBg",mr(E.error.light,.9)),it(E.Alert,"infoStandardBg",mr(E.info.light,.9)),it(E.Alert,"successStandardBg",mr(E.success.light,.9)),it(E.Alert,"warningStandardBg",mr(E.warning.light,.9)),it(E.Alert,"errorIconColor",C("palette-error-main")),it(E.Alert,"infoIconColor",C("palette-info-main")),it(E.Alert,"successIconColor",C("palette-success-main")),it(E.Alert,"warningIconColor",C("palette-warning-main")),it(E.AppBar,"defaultBg",C("palette-grey-100")),it(E.Avatar,"defaultBg",C("palette-grey-400")),it(E.Button,"inheritContainedBg",C("palette-grey-300")),it(E.Button,"inheritContainedHoverBg",C("palette-grey-A100")),it(E.Chip,"defaultBorder",C("palette-grey-400")),it(E.Chip,"defaultAvatarColor",C("palette-grey-700")),it(E.Chip,"defaultIconColor",C("palette-grey-700")),it(E.FilledInput,"bg","rgba(0, 0, 0, 0.06)"),it(E.FilledInput,"hoverBg","rgba(0, 0, 0, 0.09)"),it(E.FilledInput,"disabledBg","rgba(0, 0, 0, 0.12)"),it(E.LinearProgress,"primaryBg",mr(E.primary.main,.62)),it(E.LinearProgress,"secondaryBg",mr(E.secondary.main,.62)),it(E.LinearProgress,"errorBg",mr(E.error.main,.62)),it(E.LinearProgress,"infoBg",mr(E.info.main,.62)),it(E.LinearProgress,"successBg",mr(E.success.main,.62)),it(E.LinearProgress,"warningBg",mr(E.warning.main,.62)),it(E.Skeleton,"bg",`rgba(${C("palette-text-primaryChannel")} / 0.11)`),it(E.Slider,"primaryTrack",mr(E.primary.main,.62)),it(E.Slider,"secondaryTrack",mr(E.secondary.main,.62)),it(E.Slider,"errorTrack",mr(E.error.main,.62)),it(E.Slider,"infoTrack",mr(E.info.main,.62)),it(E.Slider,"successTrack",mr(E.success.main,.62)),it(E.Slider,"warningTrack",mr(E.warning.main,.62));const D=WM(E.background.default,.8);it(E.SnackbarContent,"bg",D),it(E.SnackbarContent,"color",gc(()=>E.getContrastText(D))),it(E.SpeedDialAction,"fabHoverBg",WM(E.background.paper,.15)),it(E.StepConnector,"border",C("palette-grey-400")),it(E.StepContent,"border",C("palette-grey-400")),it(E.Switch,"defaultColor",C("palette-common-white")),it(E.Switch,"defaultDisabledColor",C("palette-grey-100")),it(E.Switch,"primaryDisabledColor",mr(E.primary.main,.62)),it(E.Switch,"secondaryDisabledColor",mr(E.secondary.main,.62)),it(E.Switch,"errorDisabledColor",mr(E.error.main,.62)),it(E.Switch,"infoDisabledColor",mr(E.info.main,.62)),it(E.Switch,"successDisabledColor",mr(E.success.main,.62)),it(E.Switch,"warningDisabledColor",mr(E.warning.main,.62)),it(E.TableCell,"border",mr(jM(E.divider,1),.88)),it(E.Tooltip,"bg",jM(E.grey[700],.92))}if(E.mode==="dark"){it(E.Alert,"errorColor",mr(E.error.light,.6)),it(E.Alert,"infoColor",mr(E.info.light,.6)),it(E.Alert,"successColor",mr(E.success.light,.6)),it(E.Alert,"warningColor",mr(E.warning.light,.6)),it(E.Alert,"errorFilledBg",C("palette-error-dark")),it(E.Alert,"infoFilledBg",C("palette-info-dark")),it(E.Alert,"successFilledBg",C("palette-success-dark")),it(E.Alert,"warningFilledBg",C("palette-warning-dark")),it(E.Alert,"errorFilledColor",gc(()=>E.getContrastText(E.error.dark))),it(E.Alert,"infoFilledColor",gc(()=>E.getContrastText(E.info.dark))),it(E.Alert,"successFilledColor",gc(()=>E.getContrastText(E.success.dark))),it(E.Alert,"warningFilledColor",gc(()=>E.getContrastText(E.warning.dark))),it(E.Alert,"errorStandardBg",fr(E.error.light,.9)),it(E.Alert,"infoStandardBg",fr(E.info.light,.9)),it(E.Alert,"successStandardBg",fr(E.success.light,.9)),it(E.Alert,"warningStandardBg",fr(E.warning.light,.9)),it(E.Alert,"errorIconColor",C("palette-error-main")),it(E.Alert,"infoIconColor",C("palette-info-main")),it(E.Alert,"successIconColor",C("palette-success-main")),it(E.Alert,"warningIconColor",C("palette-warning-main")),it(E.AppBar,"defaultBg",C("palette-grey-900")),it(E.AppBar,"darkBg",C("palette-background-paper")),it(E.AppBar,"darkColor",C("palette-text-primary")),it(E.Avatar,"defaultBg",C("palette-grey-600")),it(E.Button,"inheritContainedBg",C("palette-grey-800")),it(E.Button,"inheritContainedHoverBg",C("palette-grey-700")),it(E.Chip,"defaultBorder",C("palette-grey-700")),it(E.Chip,"defaultAvatarColor",C("palette-grey-300")),it(E.Chip,"defaultIconColor",C("palette-grey-300")),it(E.FilledInput,"bg","rgba(255, 255, 255, 0.09)"),it(E.FilledInput,"hoverBg","rgba(255, 255, 255, 0.13)"),it(E.FilledInput,"disabledBg","rgba(255, 255, 255, 0.12)"),it(E.LinearProgress,"primaryBg",fr(E.primary.main,.5)),it(E.LinearProgress,"secondaryBg",fr(E.secondary.main,.5)),it(E.LinearProgress,"errorBg",fr(E.error.main,.5)),it(E.LinearProgress,"infoBg",fr(E.info.main,.5)),it(E.LinearProgress,"successBg",fr(E.success.main,.5)),it(E.LinearProgress,"warningBg",fr(E.warning.main,.5)),it(E.Skeleton,"bg",`rgba(${C("palette-text-primaryChannel")} / 0.13)`),it(E.Slider,"primaryTrack",fr(E.primary.main,.5)),it(E.Slider,"secondaryTrack",fr(E.secondary.main,.5)),it(E.Slider,"errorTrack",fr(E.error.main,.5)),it(E.Slider,"infoTrack",fr(E.info.main,.5)),it(E.Slider,"successTrack",fr(E.success.main,.5)),it(E.Slider,"warningTrack",fr(E.warning.main,.5));const D=WM(E.background.default,.98);it(E.SnackbarContent,"bg",D),it(E.SnackbarContent,"color",gc(()=>E.getContrastText(D))),it(E.SpeedDialAction,"fabHoverBg",WM(E.background.paper,.15)),it(E.StepConnector,"border",C("palette-grey-600")),it(E.StepContent,"border",C("palette-grey-600")),it(E.Switch,"defaultColor",C("palette-grey-300")),it(E.Switch,"defaultDisabledColor",C("palette-grey-600")),it(E.Switch,"primaryDisabledColor",fr(E.primary.main,.55)),it(E.Switch,"secondaryDisabledColor",fr(E.secondary.main,.55)),it(E.Switch,"errorDisabledColor",fr(E.error.main,.55)),it(E.Switch,"infoDisabledColor",fr(E.info.main,.55)),it(E.Switch,"successDisabledColor",fr(E.success.main,.55)),it(E.Switch,"warningDisabledColor",fr(E.warning.main,.55)),it(E.TableCell,"border",fr(jM(E.divider,1),.68)),it(E.Tooltip,"bg",jM(E.grey[700],.92))}Eu(E.background,"default"),Eu(E.background,"paper"),Eu(E.common,"background"),Eu(E.common,"onBackground"),Eu(E,"divider"),Object.keys(E).forEach(D=>{const I=E[D];I&&typeof I=="object"&&(I.main&&it(E[D],"mainChannel",Rx(Ix(I.main))),I.light&&it(E[D],"lightChannel",Rx(Ix(I.light))),I.dark&&it(E[D],"darkChannel",Rx(Ix(I.dark))),I.contrastText&&it(E[D],"contrastTextChannel",Rx(Ix(I.contrastText))),D==="text"&&(Eu(E[D],"primary"),Eu(E[D],"secondary")),D==="action"&&(I.active&&Eu(E[D],"active"),I.selected&&Eu(E[D],"selected")))})}),w=t.reduce((T,E)=>fo(T,E),w);const _={prefix:s,disableCssColorScheme:n,shouldSkipGeneratingVar:a,getSelector:Qje(w)},{vars:M,generateThemeVars:S,generateStyleSheets:A}=_je(w,_);return w.vars=M,Object.entries(w.colorSchemes[w.defaultColorScheme]).forEach(([T,E])=>{w[T]=E}),w.generateThemeVars=S,w.generateStyleSheets=A,w.generateSpacing=function(){return qie(l.spacing,XU(this))},w.getColorSchemeSelector=Sje(o),w.spacing=w.generateSpacing(),w.shouldSkipGeneratingVar=a,w.unstable_sxConfig={...V2,...l==null?void 0:l.unstable_sxConfig},w.unstable_sx=function(E){return hb({sx:E,theme:this})},w.toRuntimeSource=Zje,w}function $7(e,t,i){e.colorSchemes&&i&&(e.colorSchemes[t]={...i!==!0&&i,palette:ZU({...i===!0?{}:i,mode:t})})}function iWe(e={},...t){const{palette:i,cssVariables:r=!1,colorSchemes:n=i?void 0:{light:!0},defaultColorScheme:s=i==null?void 0:i.mode,...a}=e,o=s||"light",l=n==null?void 0:n[o],c={...n,...i?{[o]:{...typeof l!="boolean"&&l,palette:i}}:void 0};if(r===!1){const u=Qie(e,...t);return"colorSchemes"in e&&(u.defaultColorScheme=o,u.colorSchemes=c,u.palette.mode==="light"&&(u.colorSchemes.light={palette:u.palette},$7(u,"dark",c.dark)),u.palette.mode==="dark"&&(u.colorSchemes.dark={palette:u.palette},$7(u,"light",c.light))),u}return!i&&!("light"in c)&&o==="light"&&(c.light=!0),tWe({...a,colorSchemes:c,defaultColorScheme:o,...typeof r!="boolean"&&r},...t)}const rWe=iWe(),nWe="$$material";function $U(e){return e!=="ownerState"&&e!=="theme"&&e!=="sx"&&e!=="as"}const sWe=e=>$U(e)&&e!=="classes",dm=dje({themeId:nWe,defaultTheme:rWe,rootShouldForwardProp:sWe}),J7={theme:void 0};function W0(e){let t,i;return r=>{let n=t;return(n===void 0||r.theme!==i)&&(J7.theme=r.theme,n=e(J7),t=n,i=r.theme),n}}function aWe(e){return yje(e)}const oWe=e=>!e||!UE(e);function lWe(e){return Oie("MuiSlider",e)}const Ko=tGe("MuiSlider",["root","active","colorPrimary","colorSecondary","colorError","colorInfo","colorSuccess","colorWarning","disabled","dragging","focusVisible","mark","markActive","marked","markLabel","markLabelActive","rail","sizeSmall","thumb","thumbColorPrimary","thumbColorSecondary","thumbColorError","thumbColorSuccess","thumbColorInfo","thumbColorWarning","track","trackInverted","trackFalse","thumbSizeSmall","valueLabel","valueLabelOpen","valueLabelCircle","valueLabelLabel","vertical"]),cWe=e=>{const{open:t}=e;return{offset:Gd(t&&Ko.valueLabelOpen),circle:Ko.valueLabelCircle,label:Ko.valueLabelLabel}};function uWe(e){const{children:t,className:i,value:r}=e,n=cWe(e);return t?qe.cloneElement(t,{className:Gd(t.props.className)},rt.jsxs(qe.Fragment,{children:[t.props.children,rt.jsx("span",{className:Gd(n.offset,i),"aria-hidden":!0,children:rt.jsx("span",{className:n.circle,children:rt.jsx("span",{className:n.label,children:r})})})]})):null}function eX(e){return e}const hWe=dm("span",{name:"MuiSlider",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:i}=e;return[t.root,t[`color${zc(i.color)}`],i.size!=="medium"&&t[`size${zc(i.size)}`],i.marked&&t.marked,i.orientation==="vertical"&&t.vertical,i.track==="inverted"&&t.trackInverted,i.track===!1&&t.trackFalse]}})(W0(({theme:e})=>({borderRadius:12,boxSizing:"content-box",display:"inline-block",position:"relative",cursor:"pointer",touchAction:"none",WebkitTapHighlightColor:"transparent","@media print":{colorAdjust:"exact"},[`&.${Ko.disabled}`]:{pointerEvents:"none",cursor:"default",color:(e.vars||e).palette.grey[400]},[`&.${Ko.dragging}`]:{[`& .${Ko.thumb}, & .${Ko.track}`]:{transition:"none"}},variants:[...Object.entries(e.palette).filter(([,t])=>t&&t.main).map(([t])=>({props:{color:t},style:{color:(e.vars||e).palette[t].main}})),{props:{orientation:"horizontal"},style:{height:4,width:"100%",padding:"13px 0","@media (pointer: coarse)":{padding:"20px 0"}}},{props:{orientation:"horizontal",size:"small"},style:{height:2}},{props:{orientation:"horizontal",marked:!0},style:{marginBottom:20}},{props:{orientation:"vertical"},style:{height:"100%",width:4,padding:"0 13px","@media (pointer: coarse)":{padding:"0 20px"}}},{props:{orientation:"vertical",size:"small"},style:{width:2}},{props:{orientation:"vertical",marked:!0},style:{marginRight:44}}]}))),dWe=dm("span",{name:"MuiSlider",slot:"Rail",overridesResolver:(e,t)=>t.rail})({display:"block",position:"absolute",borderRadius:"inherit",backgroundColor:"currentColor",opacity:.38,variants:[{props:{orientation:"horizontal"},style:{width:"100%",height:"inherit",top:"50%",transform:"translateY(-50%)"}},{props:{orientation:"vertical"},style:{height:"100%",width:"inherit",left:"50%",transform:"translateX(-50%)"}},{props:{track:"inverted"},style:{opacity:1}}]}),pWe=dm("span",{name:"MuiSlider",slot:"Track",overridesResolver:(e,t)=>t.track})(W0(({theme:e})=>({display:"block",position:"absolute",borderRadius:"inherit",border:"1px solid currentColor",backgroundColor:"currentColor",transition:e.transitions.create(["left","width","bottom","height"],{duration:e.transitions.duration.shortest}),variants:[{props:{size:"small"},style:{border:"none"}},{props:{orientation:"horizontal"},style:{height:"inherit",top:"50%",transform:"translateY(-50%)"}},{props:{orientation:"vertical"},style:{width:"inherit",left:"50%",transform:"translateX(-50%)"}},{props:{track:!1},style:{display:"none"}},...Object.entries(e.palette).filter(([,t])=>t&&t.main).map(([t])=>({props:{color:t,track:"inverted"},style:{...e.vars?{backgroundColor:e.vars.palette.Slider[`${t}Track`],borderColor:e.vars.palette.Slider[`${t}Track`]}:{backgroundColor:Sw(e.palette[t].main,.62),borderColor:Sw(e.palette[t].main,.62),...e.applyStyles("dark",{backgroundColor:_w(e.palette[t].main,.5)}),...e.applyStyles("dark",{borderColor:_w(e.palette[t].main,.5)})}}}))]}))),fWe=dm("span",{name:"MuiSlider",slot:"Thumb",overridesResolver:(e,t)=>{const{ownerState:i}=e;return[t.thumb,t[`thumbColor${zc(i.color)}`],i.size!=="medium"&&t[`thumbSize${zc(i.size)}`]]}})(W0(({theme:e})=>({position:"absolute",width:20,height:20,boxSizing:"border-box",borderRadius:"50%",outline:0,backgroundColor:"currentColor",display:"flex",alignItems:"center",justifyContent:"center",transition:e.transitions.create(["box-shadow","left","bottom"],{duration:e.transitions.duration.shortest}),"&::before":{position:"absolute",content:'""',borderRadius:"inherit",width:"100%",height:"100%",boxShadow:(e.vars||e).shadows[2]},"&::after":{position:"absolute",content:'""',borderRadius:"50%",width:42,height:42,top:"50%",left:"50%",transform:"translate(-50%, -50%)"},[`&.${Ko.disabled}`]:{"&:hover":{boxShadow:"none"}},variants:[{props:{size:"small"},style:{width:12,height:12,"&::before":{boxShadow:"none"}}},{props:{orientation:"horizontal"},style:{top:"50%",transform:"translate(-50%, -50%)"}},{props:{orientation:"vertical"},style:{left:"50%",transform:"translate(-50%, 50%)"}},...Object.entries(e.palette).filter(([,t])=>t&&t.main).map(([t])=>({props:{color:t},style:{[`&:hover, &.${Ko.focusVisible}`]:{...e.vars?{boxShadow:`0px 0px 0px 8px rgba(${e.vars.palette[t].mainChannel} / 0.16)`}:{boxShadow:`0px 0px 0px 8px ${oN(e.palette[t].main,.16)}`},"@media (hover: none)":{boxShadow:"none"}},[`&.${Ko.active}`]:{...e.vars?{boxShadow:`0px 0px 0px 14px rgba(${e.vars.palette[t].mainChannel} / 0.16)`}:{boxShadow:`0px 0px 0px 14px ${oN(e.palette[t].main,.16)}`}}}}))]}))),mWe=dm(uWe,{name:"MuiSlider",slot:"ValueLabel",overridesResolver:(e,t)=>t.valueLabel})(W0(({theme:e})=>({zIndex:1,whiteSpace:"nowrap",...e.typography.body2,fontWeight:500,transition:e.transitions.create(["transform"],{duration:e.transitions.duration.shortest}),position:"absolute",backgroundColor:(e.vars||e).palette.grey[600],borderRadius:2,color:(e.vars||e).palette.common.white,display:"flex",alignItems:"center",justifyContent:"center",padding:"0.25rem 0.75rem",variants:[{props:{orientation:"horizontal"},style:{transform:"translateY(-100%) scale(0)",top:"-10px",transformOrigin:"bottom center","&::before":{position:"absolute",content:'""',width:8,height:8,transform:"translate(-50%, 50%) rotate(45deg)",backgroundColor:"inherit",bottom:0,left:"50%"},[`&.${Ko.valueLabelOpen}`]:{transform:"translateY(-100%) scale(1)"}}},{props:{orientation:"vertical"},style:{transform:"translateY(-50%) scale(0)",right:"30px",top:"50%",transformOrigin:"right center","&::before":{position:"absolute",content:'""',width:8,height:8,transform:"translate(-50%, -50%) rotate(45deg)",backgroundColor:"inherit",right:-8,top:"50%"},[`&.${Ko.valueLabelOpen}`]:{transform:"translateY(-50%) scale(1)"}}},{props:{size:"small"},style:{fontSize:e.typography.pxToRem(12),padding:"0.25rem 0.5rem"}},{props:{orientation:"vertical",size:"small"},style:{right:"20px"}}]}))),gWe=dm("span",{name:"MuiSlider",slot:"Mark",shouldForwardProp:e=>$U(e)&&e!=="markActive",overridesResolver:(e,t)=>{const{markActive:i}=e;return[t.mark,i&&t.markActive]}})(W0(({theme:e})=>({position:"absolute",width:2,height:2,borderRadius:1,backgroundColor:"currentColor",variants:[{props:{orientation:"horizontal"},style:{top:"50%",transform:"translate(-1px, -50%)"}},{props:{orientation:"vertical"},style:{left:"50%",transform:"translate(-50%, 1px)"}},{props:{markActive:!0},style:{backgroundColor:(e.vars||e).palette.background.paper,opacity:.8}}]}))),vWe=dm("span",{name:"MuiSlider",slot:"MarkLabel",shouldForwardProp:e=>$U(e)&&e!=="markLabelActive",overridesResolver:(e,t)=>t.markLabel})(W0(({theme:e})=>({...e.typography.body2,color:(e.vars||e).palette.text.secondary,position:"absolute",whiteSpace:"nowrap",variants:[{props:{orientation:"horizontal"},style:{top:30,transform:"translateX(-50%)","@media (pointer: coarse)":{top:40}}},{props:{orientation:"vertical"},style:{left:36,transform:"translateY(50%)","@media (pointer: coarse)":{left:44}}},{props:{markLabelActive:!0},style:{color:(e.vars||e).palette.text.primary}}]}))),yWe=e=>{const{disabled:t,dragging:i,marked:r,orientation:n,track:s,classes:a,color:o,size:l}=e,c={root:["root",t&&"disabled",i&&"dragging",r&&"marked",n==="vertical"&&"vertical",s==="inverted"&&"trackInverted",s===!1&&"trackFalse",o&&`color${zc(o)}`,l&&`size${zc(l)}`],rail:["rail"],track:["track"],mark:["mark"],markActive:["markActive"],markLabel:["markLabel"],markLabelActive:["markLabelActive"],valueLabel:["valueLabel"],thumb:["thumb",t&&"disabled",l&&`thumbSize${zc(l)}`,o&&`thumbColor${zc(o)}`],active:["active"],disabled:["disabled"],focusVisible:["focusVisible"]};return kHe(c,lWe,a)},xWe=({children:e})=>e,wWe=qe.forwardRef(function(t,i){const r=aWe({props:t,name:"MuiSlider"}),n=jHe(),{"aria-label":s,"aria-valuetext":a,"aria-labelledby":o,component:l="span",components:c={},componentsProps:u={},color:h="primary",classes:d,className:p,disableSwap:f=!1,disabled:v=!1,getAriaLabel:g,getAriaValueText:m,marks:x=!1,max:w=100,min:_=0,name:M,onChange:S,onChangeCommitted:A,orientation:T="horizontal",shiftStep:E=10,size:C="medium",step:D=1,scale:I=eX,slotProps:L,slots:z,tabIndex:F,track:Q="normal",value:Y,valueLabelDisplay:O="off",valueLabelFormat:j=eX,...V}=r,W={...r,isRtl:n,max:w,min:_,classes:d,disabled:v,disableSwap:f,orientation:T,marks:x,color:h,size:C,step:D,shiftStep:E,scale:I,track:Q,valueLabelDisplay:O,valueLabelFormat:j},{axisProps:J,getRootProps:ce,getHiddenInputProps:$,getThumbProps:ne,open:ie,active:de,axis:be,focusedThumbIndex:we,range:_e,dragging:Me,marks:X,values:ge,trackOffset:Oe,trackLeap:Ie,getThumbStyle:Pe}=cGe({...W,rootRef:i});W.marked=X.length>0&&X.some(Ne=>Ne.label),W.dragging=Me,W.focusedThumbIndex=we;const Ye=yWe(W),ke=(z==null?void 0:z.root)??c.Root??hWe,Fe=(z==null?void 0:z.rail)??c.Rail??dWe,se=(z==null?void 0:z.track)??c.Track??pWe,Z=(z==null?void 0:z.thumb)??c.Thumb??fWe,K=(z==null?void 0:z.valueLabel)??c.ValueLabel??mWe,k=(z==null?void 0:z.mark)??c.Mark??gWe,re=(z==null?void 0:z.markLabel)??c.MarkLabel??vWe,he=(z==null?void 0:z.input)??c.Input??"input",G=(L==null?void 0:L.root)??u.root,Te=(L==null?void 0:L.rail)??u.rail,ze=(L==null?void 0:L.track)??u.track,Qe=(L==null?void 0:L.thumb)??u.thumb,ye=(L==null?void 0:L.valueLabel)??u.valueLabel,je=(L==null?void 0:L.mark)??u.mark,nt=(L==null?void 0:L.markLabel)??u.markLabel,ct=(L==null?void 0:L.input)??u.input,tt=sd({elementType:ke,getSlotProps:ce,externalSlotProps:G,externalForwardedProps:V,additionalProps:{...oWe(ke)&&{as:l}},ownerState:{...W,...G==null?void 0:G.ownerState},className:[Ye.root,p]}),ue=sd({elementType:Fe,externalSlotProps:Te,ownerState:W,className:Ye.rail}),Ue=sd({elementType:se,externalSlotProps:ze,additionalProps:{style:{...J[be].offset(Oe),...J[be].leap(Ie)}},ownerState:{...W,...ze==null?void 0:ze.ownerState},className:Ye.track}),dt=sd({elementType:Z,getSlotProps:ne,externalSlotProps:Qe,ownerState:{...W,...Qe==null?void 0:Qe.ownerState},className:Ye.thumb}),xe=sd({elementType:K,externalSlotProps:ye,ownerState:{...W,...ye==null?void 0:ye.ownerState},className:Ye.valueLabel}),ae=sd({elementType:k,externalSlotProps:je,ownerState:W,className:Ye.mark}),fe=sd({elementType:re,externalSlotProps:nt,ownerState:W,className:Ye.markLabel}),Se=sd({elementType:he,getSlotProps:$,externalSlotProps:ct,ownerState:W});return rt.jsxs(ke,{...tt,children:[rt.jsx(Fe,{...ue}),rt.jsx(se,{...Ue}),X.filter(Ne=>Ne.value>=_&&Ne.value<=w).map((Ne,st)=>{const vt=iT(Ne.value,_,w),Ut=J[be].offset(vt);let Wt;return Q===!1?Wt=ge.includes(Ne.value):Wt=Q==="normal"&&(_e?Ne.value>=ge[0]&&Ne.value<=ge[ge.length-1]:Ne.value<=ge[0])||Q==="inverted"&&(_e?Ne.value<=ge[0]||Ne.value>=ge[ge.length-1]:Ne.value>=ge[0]),rt.jsxs(qe.Fragment,{children:[rt.jsx(k,{"data-index":st,...ae,...!UE(k)&&{markActive:Wt},style:{...Ut,...ae.style},className:Gd(ae.className,Wt&&Ye.markActive)}),Ne.label!=null?rt.jsx(re,{"aria-hidden":!0,"data-index":st,...fe,...!UE(re)&&{markLabelActive:Wt},style:{...Ut,...fe.style},className:Gd(Ye.markLabel,fe.className,Wt&&Ye.markLabelActive),children:Ne.label}):null]},st)}),ge.map((Ne,st)=>{const vt=iT(Ne,_,w),Ut=J[be].offset(vt),Wt=O==="off"?xWe:K;return rt.jsx(Wt,{...!UE(Wt)&&{valueLabelFormat:j,valueLabelDisplay:O,value:typeof j=="function"?j(I(Ne),st):j,index:st,open:ie===st||de===st||O==="on",disabled:v},...xe,children:rt.jsx(Z,{"data-index":st,...dt,className:Gd(Ye.thumb,dt.className,de===st&&Ye.active,we===st&&Ye.focusVisible),style:{...Ut,...Pe(st),...dt.style},children:rt.jsx(he,{"data-index":st,"aria-label":g?g(st):s,"aria-valuenow":I(Ne),"aria-labelledby":o,"aria-valuetext":m?m(I(Ne),st):a,value:ge[st],...Se})})},st)})]})}),bWe={color:"#ff5733",height:8,"& .MuiSlider-track":{border:"none"},"& .MuiSlider-thumb":{height:16,width:16,backgroundColor:"#fff",border:"2px solid currentColor","&:focus, &:hover, &.Mui-active, &.Mui-focusVisible":{boxShadow:"inherit"},"&::before":{display:"none"}},"& .MuiSlider-valueLabel":{lineHeight:1.2,fontSize:12,background:"unset",padding:0,width:32,height:32,borderRadius:"50% 50% 50% 0",backgroundColor:"#52af77",transformOrigin:"bottom left",transform:"translate(50%, -100%) rotate(-45deg) scale(0)","&::before":{display:"none"},"&.MuiSlider-valueLabelOpen":{transform:"translate(50%, -100%) rotate(-45deg) scale(1)"},"& > *":{transform:"rotate(45deg)"}}},px={cube:[{name:"Width",min:1,max:3.5,step:.05,slider:!0},{name:"Height",min:1,max:3.5,step:.05,slider:!0},{name:"Depth",min:1,max:3.5,step:.05,slider:!0},{name:"PolygonsX",min:1,max:10,step:1,slider:!0},{name:"PolygonsY",min:1,max:10,step:1,slider:!0},{name:"PolygonsZ",min:1,max:10,step:1,slider:!0}],sphere:[{name:"Radius",min:.5,max:2.5,step:.05,slider:!0},{name:"PolygonsX",min:1,max:64,step:1,slider:!0},{name:"PolygonsY",min:1,max:64,step:1,slider:!0},{name:" Start",min:0,max:2*Math.PI,step:.01,slider:!0},{name:" Length",min:0,max:2*Math.PI,step:.01,slider:!0},{name:" Start",min:0,max:2*Math.PI,step:.01,slider:!0},{name:" Length",min:0,max:2*Math.PI,step:.01,slider:!0}],torus:[{name:"Radius",min:.5,max:2,step:.05,slider:!0},{name:"Tube Width",min:.1,max:.9,step:.01,slider:!0},{name:"PolygonsR*",min:2,max:128,step:.05,slider:!0},{name:"PolygonsT*",min:1,max:128,step:.05,slider:!0},{name:"Arc",min:0,max:2*Math.PI,step:.05,slider:!0}],cone:[{name:"Radius",min:.5,max:2.5,step:.05,slider:!0},{name:"Height",min:0,max:3.5,step:.05,slider:!0},{name:"PolygonsR*",min:2,max:128,step:.05,slider:!0},{name:"PolygonsY",min:1,max:64,step:1,slider:!0},{name:"Open Ended",slider:!1},{name:" Start",min:0,max:2*Math.PI,step:.01,slider:!0},{name:" Length",min:0,max:2*Math.PI,step:.01,slider:!0}],torusKnot:[{name:"Radius",min:.5,max:1.5,step:.05,slider:!0},{name:"Tube Width",min:.1,max:.75,step:.01,slider:!0},{name:"PolygonsT*",min:2,max:128,step:.05,slider:!0},{name:"PolygonsR*",min:3,max:128,step:.05,slider:!0},{name:"P",min:1,max:24,step:1,slider:!0},{name:"Q",min:1,max:24,step:1,slider:!0}]},_We="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24px'%20viewBox='0%20-960%20960%20960'%20width='24px'%20fill='%23e8eaed'%3e%3cpath%20d='m370-80-16-128q-13-5-24.5-12T307-235l-119%2050L78-375l103-78q-1-7-1-13.5v-27q0-6.5%201-13.5L78-585l110-190%20119%2050q11-8%2023-15t24-12l16-128h220l16%20128q13%205%2024.5%2012t22.5%2015l119-50%20110%20190-103%2078q1%207%201%2013.5v27q0%206.5-2%2013.5l103%2078-110%20190-118-50q-11%208-23%2015t-24%2012L590-80H370Zm112-260q58%200%2099-41t41-99q0-58-41-99t-99-41q-59%200-99.5%2041T342-480q0%2058%2040.5%2099t99.5%2041Z'/%3e%3c/svg%3e";function pN(){return pN=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},pN.apply(this,arguments)}var SWe=Ci.createElement("svg",{viewBox:"-2 -5 14 20",height:"100%",width:"100%",style:{position:"absolute",top:0}},Ci.createElement("path",{d:"M9.9 2.12L7.78 0 4.95 2.828 2.12 0 0 2.12l2.83 2.83L0 7.776 2.123 9.9 4.95 7.07 7.78 9.9 9.9 7.776 7.072 4.95 9.9 2.12",fill:"#fff",fillRule:"evenodd"})),MWe=Ci.createElement("svg",{height:"100%",width:"100%",viewBox:"-2 -5 17 21",style:{position:"absolute",top:0}},Ci.createElement("path",{d:"M11.264 0L5.26 6.004 2.103 2.847 0 4.95l5.26 5.26 8.108-8.107L11.264 0",fill:"#fff",fillRule:"evenodd"}));function tX(e){if(e.length===7)return e;for(var t="#",i=1;i<4;i+=1)t+=e[i]+e[i];return t}function iX(e,t,i,r,n){return function(s,a,o,l,c){var u=(s-o)/(a-o);if(u===0)return l;if(u===1)return c;for(var h="#",d=1;d<6;d+=2){var p=parseInt(l.substr(d,2),16),f=parseInt(c.substr(d,2),16),v=Math.round((1-u)*p+u*f).toString(16);v.length===1&&(v="0"+v),h+=v}return h}(e,t,i,tX(r),tX(n))}var $ie=function(e){function t(i){e.call(this,i);var r=i.height,n=i.width,s=i.checked;this.t=i.handleDiameter||r-2,this.i=Math.max(n-r,n-(r+this.t)/2),this.o=Math.max(0,(r-this.t)/2),this.state={h:s?this.i:this.o},this.l=0,this.u=0,this.p=this.p.bind(this),this.v=this.v.bind(this),this.g=this.g.bind(this),this.k=this.k.bind(this),this.m=this.m.bind(this),this.M=this.M.bind(this),this.T=this.T.bind(this),this.$=this.$.bind(this),this.C=this.C.bind(this),this.D=this.D.bind(this),this.O=this.O.bind(this),this.S=this.S.bind(this)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.componentDidMount=function(){this.W=!0},t.prototype.componentDidUpdate=function(i){i.checked!==this.props.checked&&this.setState({h:this.props.checked?this.i:this.o})},t.prototype.componentWillUnmount=function(){this.W=!1},t.prototype.I=function(i){this.H.focus(),this.setState({R:i,j:!0,B:Date.now()})},t.prototype.L=function(i){var r=this.state,n=r.R,s=r.h,a=(this.props.checked?this.i:this.o)+i-n;r.N||i===n||this.setState({N:!0});var o=Math.min(this.i,Math.max(this.o,a));o!==s&&this.setState({h:o})},t.prototype.U=function(i){var r=this.state,n=r.h,s=r.N,a=r.B,o=this.props.checked,l=(this.i+this.o)/2;this.setState({h:this.props.checked?this.i:this.o});var c=Date.now()-a;(!s||c<250||o&&n<=l||!o&&n>=l)&&this.A(i),this.W&&this.setState({N:!1,j:!1}),this.l=Date.now()},t.prototype.p=function(i){i.preventDefault(),typeof i.button=="number"&&i.button!==0||(this.I(i.clientX),window.addEventListener("mousemove",this.v),window.addEventListener("mouseup",this.g))},t.prototype.v=function(i){i.preventDefault(),this.L(i.clientX)},t.prototype.g=function(i){this.U(i),window.removeEventListener("mousemove",this.v),window.removeEventListener("mouseup",this.g)},t.prototype.k=function(i){this.X=null,this.I(i.touches[0].clientX)},t.prototype.m=function(i){this.L(i.touches[0].clientX)},t.prototype.M=function(i){i.preventDefault(),this.U(i)},t.prototype.$=function(i){Date.now()-this.l>50&&(this.A(i),Date.now()-this.u>50&&this.W&&this.setState({j:!1}))},t.prototype.C=function(){this.u=Date.now()},t.prototype.D=function(){this.setState({j:!0})},t.prototype.O=function(){this.setState({j:!1})},t.prototype.S=function(i){this.H=i},t.prototype.T=function(i){i.preventDefault(),this.H.focus(),this.A(i),this.W&&this.setState({j:!1})},t.prototype.A=function(i){var r=this.props;(0,r.onChange)(!r.checked,i,r.id)},t.prototype.render=function(){var i=this.props,r=i.checked,n=i.disabled,s=i.className,a=i.offColor,o=i.onColor,l=i.offHandleColor,c=i.onHandleColor,u=i.checkedIcon,h=i.uncheckedIcon,d=i.checkedHandleIcon,p=i.uncheckedHandleIcon,f=i.boxShadow,v=i.activeBoxShadow,g=i.height,m=i.width,x=i.borderRadius,w=function(F,Q){var Y={};for(var O in F)Object.prototype.hasOwnProperty.call(F,O)&&Q.indexOf(O)===-1&&(Y[O]=F[O]);return Y}(i,["checked","disabled","className","offColor","onColor","offHandleColor","onHandleColor","checkedIcon","uncheckedIcon","checkedHandleIcon","uncheckedHandleIcon","boxShadow","activeBoxShadow","height","width","borderRadius","handleDiameter"]),_=this.state,M=_.h,S=_.N,A=_.j,T={position:"relative",display:"inline-block",textAlign:"left",opacity:n?.5:1,direction:"ltr",borderRadius:g/2,WebkitTransition:"opacity 0.25s",MozTransition:"opacity 0.25s",transition:"opacity 0.25s",touchAction:"none",WebkitTapHighlightColor:"rgba(0, 0, 0, 0)",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none",userSelect:"none"},E={height:g,width:m,margin:Math.max(0,(this.t-g)/2),position:"relative",background:iX(M,this.i,this.o,a,o),borderRadius:typeof x=="number"?x:g/2,cursor:n?"default":"pointer",WebkitTransition:S?null:"background 0.25s",MozTransition:S?null:"background 0.25s",transition:S?null:"background 0.25s"},C={height:g,width:Math.min(1.5*g,m-(this.t+g)/2+1),position:"relative",opacity:(M-this.o)/(this.i-this.o),pointerEvents:"none",WebkitTransition:S?null:"opacity 0.25s",MozTransition:S?null:"opacity 0.25s",transition:S?null:"opacity 0.25s"},D={height:g,width:Math.min(1.5*g,m-(this.t+g)/2+1),position:"absolute",opacity:1-(M-this.o)/(this.i-this.o),right:0,top:0,pointerEvents:"none",WebkitTransition:S?null:"opacity 0.25s",MozTransition:S?null:"opacity 0.25s",transition:S?null:"opacity 0.25s"},I={height:this.t,width:this.t,background:iX(M,this.i,this.o,l,c),display:"inline-block",cursor:n?"default":"pointer",borderRadius:typeof x=="number"?x-1:"50%",position:"absolute",transform:"translateX("+M+"px)",top:Math.max(0,(g-this.t)/2),outline:0,boxShadow:A?v:f,border:0,WebkitTransition:S?null:"background-color 0.25s, transform 0.25s, box-shadow 0.15s",MozTransition:S?null:"background-color 0.25s, transform 0.25s, box-shadow 0.15s",transition:S?null:"background-color 0.25s, transform 0.25s, box-shadow 0.15s"},L={height:this.t,width:this.t,opacity:Math.max(2*(1-(M-this.o)/(this.i-this.o)-.5),0),position:"absolute",left:0,top:0,pointerEvents:"none",WebkitTransition:S?null:"opacity 0.25s",MozTransition:S?null:"opacity 0.25s",transition:S?null:"opacity 0.25s"},z={height:this.t,width:this.t,opacity:Math.max(2*((M-this.o)/(this.i-this.o)-.5),0),position:"absolute",left:0,top:0,pointerEvents:"none",WebkitTransition:S?null:"opacity 0.25s",MozTransition:S?null:"opacity 0.25s",transition:S?null:"opacity 0.25s"};return Ci.createElement("div",{className:s,style:T},Ci.createElement("div",{className:"react-switch-bg",style:E,onClick:n?null:this.T,onMouseDown:function(F){return F.preventDefault()}},u&&Ci.createElement("div",{style:C},u),h&&Ci.createElement("div",{style:D},h)),Ci.createElement("div",{className:"react-switch-handle",style:I,onClick:function(F){return F.preventDefault()},onMouseDown:n?null:this.p,onTouchStart:n?null:this.k,onTouchMove:n?null:this.m,onTouchEnd:n?null:this.M,onTouchCancel:n?null:this.O},p&&Ci.createElement("div",{style:L},p),d&&Ci.createElement("div",{style:z},d)),Ci.createElement("input",pN({},{type:"checkbox",role:"switch","aria-checked":r,checked:r,disabled:n,style:{border:0,clip:"rect(0 0 0 0)",height:1,margin:-1,overflow:"hidden",padding:0,position:"absolute",width:1}},w,{ref:this.S,onFocus:this.D,onBlur:this.O,onKeyUp:this.C,onChange:this.$})))},t}(qe.Component);$ie.defaultProps={disabled:!1,offColor:"#888",onColor:"#080",offHandleColor:"#fff",onHandleColor:"#fff",uncheckedIcon:SWe,checkedIcon:MWe,boxShadow:null,activeBoxShadow:"0 0 2px 3px #3bf",height:28,width:56};function EWe(){const[e,t]=Ci.useState(0),[i,r]=Ci.useState(-1),[n,s]=Ci.useState(!1),[a,o]=Ci.useState(0),[l,c]=Ci.useState([{place:0,expanded:!0,options:[3.5,3.5,3.5,8,8,8],optionLimits:px.cube,wireframe:!1},{place:1,expanded:!1,options:[2.5,32,32,0,2*Math.PI,0,Math.PI],optionLimits:px.sphere,wireframe:!1},{place:2,expanded:!1,options:[2,.5,32,32,2*Math.PI],optionLimits:px.torus,wireframe:!1},{place:3,expanded:!1,options:[2.5,2.6,64,10,!1,0,2*Math.PI],optionLimits:px.cone,wireframe:!1},{place:4,expanded:!1,options:[1.5,.44,128,64,2,3],optionLimits:px.torusKnot,wireframe:!1}]),u=[{title:"Cube",geometry:rt.jsx("boxGeometry",{args:l[0].options})},{title:"Sphere",geometry:rt.jsx("sphereGeometry",{args:l[1].options})},{title:"Torus",geometry:rt.jsx("torusGeometry",{args:l[2].options})},{title:"Cone",geometry:rt.jsx("coneGeometry",{args:l[3].options})},{title:"Torus Knot",geometry:rt.jsx("torusKnotGeometry",{args:l[4].options})}];function h(g){let m=l[g].place;if(l[g].place!==0){const x=l.map((w,_)=>_==g?{...w,place:0}:w.place<m?{...w,place:w.place+1,expanded:!1}:w);c(x),r(e),t(g),setTimeout(()=>{c(x.map((w,_)=>_==g?{...w,expanded:!0}:w))},350)}}const d=g=>{n?s(!1):(s(!0),o(g))},p=(g,m)=>{let x=Number(g.target.name);c(l.map((w,_)=>_==a?{...w,options:w.options.map((M,S)=>S==x?m:M)}:w))},f=(g,m,x)=>{let w=Number(x);c(l.map((_,M)=>M==a?{..._,options:_.options.map((S,A)=>A==w?g:S)}:_))},v=g=>{console.log(g),c(l.map((m,x)=>x==a?{...m,wireframe:g}:m))};return rt.jsxs("div",{className:"primitives",children:[rt.jsxs("ul",{className:"primitives__list",children:[" ",u.map((g,m)=>rt.jsxs("li",{className:"primitives__list-item",style:{top:`calc(${l[m].place} * calc((100% - 40%) / ${l.length}) + 20%)`,zIndex:l[m].place==0?2:1,width:l[m].expanded?"calc(100% + 70px)":"100%",height:`calc((100% - 40%) / ${l.length} - 1%)`},children:[rt.jsx("button",{className:l[m].expanded?"primitives__list-item-name primitives__list-item-name_expanded":"primitives__list-item-name",onClick:()=>h(m),children:g.title}),rt.jsx("div",{className:l[m].expanded?"primitives__settings-container primitives__settings-container_expanded":"primitives__settings-container",children:rt.jsx("img",{className:"primitives__settings-button",src:_We,onClick:()=>d(m)})})]},m)),rt.jsxs("div",{className:"primitives__primitive-options",style:{height:`calc(${l.length-1} * calc((100% - 40%) / ${l.length}) - 0.5%)`,left:n?0:"calc((100% + 70px) * -1)",top:`calc(20% + (100% - 40%) / ${l.length})`},children:[rt.jsx("ul",{className:"primitives__primitive-options-list",children:l[a].options.map((g,m)=>l[a].optionLimits[m].slider?rt.jsxs("li",{className:"primitives__primitive-options-item",children:[rt.jsx("p",{className:"primitives__primitive-options-item-name",children:l[a].optionLimits[m].name}),rt.jsx(wWe,{sx:bWe,name:m.toString(),"aria-label":m.toString(),value:g,onChange:p,min:l[a].optionLimits[m].min,max:l[a].optionLimits[m].max,step:l[a].optionLimits[m].step})]},m):rt.jsxs("li",{className:"primitives__primitive-options-item",children:[rt.jsx("p",{className:"primitives__primitive-options-item-name",children:l[a].optionLimits[m].name}),rt.jsx($ie,{className:"primitives__primitive-options-switch",id:m.toString(),onChange:f,checked:g,width:45,height:20,offColor:"#ff5733",onColor:"#ff5733",activeBoxShadow:"0"})]},m))}),rt.jsx("div",{className:"primitives__wireframe-switch",children:rt.jsxs("label",{className:"toggle-switch",style:{background:"#000000"},children:[rt.jsx("input",{className:"toggle-switch__input",checked:l[a].wireframe,onChange:()=>v(!l[a].wireframe),type:"checkbox"}),rt.jsx("div",{className:"toggle-switch__button",style:l[a].wireframe?{}:{left:"calc(100% - 2px)",transform:"translateX(-100%)"}}),rt.jsxs("div",{className:"toggle-switch__labels",children:[rt.jsx("span",{className:"toggle-switch__span toggle-switch__span_left",style:l[a].wireframe?{color:"black"}:{},children:"Shown"}),rt.jsx("span",{className:"toggle-switch__span toggle-switch__span_right",style:l[a].wireframe?{}:{color:"black"},children:"Hidden"})]})]})})]})]}),rt.jsx("div",{className:"primitives__primitive-projection",children:rt.jsx(NHe,{active:e,children:u.map((g,m)=>rt.jsx("div",{className:"carousel__card",children:rt.jsx("div",{className:"carousel__image",children:rt.jsx(jte,{children:e==m||i==m?rt.jsx(BHe,{mesh:g,wireframe:l[m].wireframe,previous:m==i,active:m==e}):rt.jsx(rt.Fragment,{})})})},m))})}),rt.jsx("div",{className:"primitives__primitive-description-wrapper",children:rt.jsxs("div",{className:"primitives__primitive-description-container glass",children:[rt.jsx("h3",{className:"primitives__primitive-description-title",children:u[e].title}),rt.jsx("p",{className:"primitives__primitive-description-about",children:"Lorem ipsum dolor sit amet consectetur adipisicing elit. Iste sapiente adipisci facere est error atque. Accusantium eaque corporis ducimus ut aut, fugiat aliquam similique alias adipisci error et quibusdam temporibus."})]})}),rt.jsx("div",{className:"primitives__background-circle primitives__background-circle_purple"}),rt.jsx("div",{className:"primitives__background-circle primitives__background-circle_green"}),rt.jsx("div",{className:"primitives__background-circle primitives__background-circle_yellow"}),rt.jsx("div",{className:"primitives__background-circle primitives__background-circle_white"}),rt.jsx("div",{className:"primitives__background-circle primitives__background-circle_lime"}),rt.jsx("div",{className:"primitives__background-circle primitives__background-circle_blue"}),rt.jsx("div",{className:"primitives__background-circle primitives__background-circle_small-left-bottom"}),rt.jsx("div",{className:"primitives__background-circle primitives__background-circle_small-right-top"}),rt.jsx("div",{className:"primitives__background-circle primitives__background-circle_central"})]})}function AWe(){const[e,t]=Ci.useState(40),[i,r]=Ci.useState(15),[n,s]=Ci.useState(15),[a,o]=Ci.useState(window.innerWidth),[l,c]=Ci.useState(!1);Ci.useEffect(()=>{localStorage.setItem("variable_144ebfe4-de0d-4dae-9d86-aa2411cfa302","false"),u(),window.addEventListener("storage",()=>{const h=localStorage.getItem("variable_144ebfe4-de0d-4dae-9d86-aa2411cfa302");console.log(h),c(h)})},[]);async function u(){if(!l){const h=JSON.parse(localStorage.getItem("variable_144ebfe4-de0d-4dae-9d86-aa2411cfa302"));h?c(h):setTimeout(u,1e3)}}return rt.jsxs("div",{className:"App",children:[rt.jsx(LIe,{scene:"https://draft.spline.design/uCFvIdqD0zv2ZR5v/scene.splinecode"}),rt.jsxs("div",{className:"main__content",children:[rt.jsx(EWe,{}),rt.jsx(zHe,{speedSlider:e,setSpeedSlider:t,spikesSlider:i,setSpikesSlider:r,processingSlider:n,setProcessingSlider:s,type:"simplex",screenWidth:a,setScreenWidth:o})]})]})}mY(document.getElementById("root")).render(rt.jsx(AWe,{}));export{yd as c,v0 as g};
